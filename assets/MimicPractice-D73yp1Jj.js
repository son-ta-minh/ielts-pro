import{c as Ae,r as s,j as e,X as re,_ as ce,i as Re,l as $e,aj as _e,a as Fe,bw as Le,E as Oe,t as ne,bx as Ue,V as Qe,s as De,by as We,b4 as qe,aC as Ge,a1 as Be,v as Je,aD as Ve,ac as Ye,G as ue,a0 as de,bz as He,D as Ke,bA as Xe,J as Ze,m as et,az as tt,al as st,bB as rt,bC as nt}from"./index-B6aD1nvT.js";import{E as at}from"./ear-JeoUzF8K.js";import{P as lt}from"./pen-BWn9BrWI.js";import{C as ot}from"./chevron-left-DZoFe_di.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=Ae("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),xe=({isOpen:i,onClose:B,onSave:r,initialData:x})=>{const[c,d]=s.useState(""),C=s.useRef(null);s.useEffect(()=>{i&&(d((x==null?void 0:x.text)||""),setTimeout(()=>{var o;return(o=C.current)==null?void 0:o.focus()},100))},[i,x]);const z=o=>{o.preventDefault(),c.trim()&&r(c.trim())};return i?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:z,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:x?"Edit Phrase":"Add New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Enter the text you want to practice mimicking."})]}),e.jsx("button",{type:"button",onClick:B,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(re,{size:20})})]}),e.jsx("main",{className:"p-8",children:e.jsx("textarea",{ref:C,value:c,onChange:o=>d(o.target.value),placeholder:"e.g. It's not a matter of if, but when.",rows:5,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-base leading-relaxed",required:!0})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Ye,{size:14})," Save Phrase"]})})]})}):null},ct=({score:i})=>i===void 0?e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-200",title:"Not practiced yet"}):e.jsx("div",{className:`flex items-center justify-center px-1.5 py-0.5 rounded-md ${i>=80?"bg-green-100 text-green-700":i>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.jsx("span",{className:"text-[9px] font-black",children:i})}),ut=({targetText:i,sourceWord:B,isRecording:r,isRevealed:x,userTranscript:c,userAudioUrl:d,onToggleRecord:C,onPlayTarget:z,onPlayUser:o,onToggleReveal:I,onNext:m,onClearTranscript:ae,isEmpty:X,onClose:f,pagedItems:_,page:p,pageSize:T,totalPages:w,onPageChange:b,onPageSizeChange:Z,onSelect:J,currentAbsoluteIndex:n,autoSpeak:N,onToggleAutoSpeak:F,isGlobalMode:L,localAnalysis:h,onAddItem:O,onEditItem:P,onDeleteItem:ee,onRandomize:U,isModalOpen:E,editingItem:Q,onCloseModal:V,onSaveItem:Y,ipa:H,showIpa:M,isIpaLoading:y,onToggleIpa:D})=>{const[A,R]=s.useState(!0);if(X)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4 relative bg-white",children:[f&&e.jsx("button",{onClick:f,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(re,{size:24})}),e.jsx("div",{className:"p-4 bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(at,{size:40})}),e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Queue is Empty"}),e.jsxs("button",{onClick:O,className:"mt-4 px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(ce,{size:14})," Add New"]})]}),e.jsx(xe,{isOpen:E,onClose:V,onSave:Y,initialData:Q})]});const te=L?"h-full rounded-[2.5rem] shadow-sm border border-neutral-200":"h-full";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex w-full bg-white relative overflow-hidden ${te}`,children:[e.jsxs("div",{className:`h-full border-r border-neutral-100 bg-neutral-50/50 flex flex-col shrink-0 transition-all duration-300 ease-in-out ${A?"w-80 opacity-100":"w-0 opacity-0 border-none overflow-hidden"}`,children:[e.jsx("div",{className:"p-4 border-b border-neutral-100 bg-white space-y-3 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-neutral-500",children:[e.jsx(it,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Queue"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:F,className:`p-2 rounded-lg border transition-all shadow-sm ${N?"bg-amber-100 border-amber-200 text-amber-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Speak: ${N?"ON":"OFF"}`,children:e.jsx(Re,{size:14,fill:N?"currentColor":"none"})}),e.jsx("button",{onClick:U,className:"p-2 bg-white border border-neutral-200 text-neutral-500 rounded-lg hover:text-indigo-600 transition-all shadow-sm",title:"Shuffle Queue",children:e.jsx($e,{size:14})}),e.jsx("button",{onClick:O,className:"p-2 bg-neutral-900 text-white border border-neutral-900 rounded-lg hover:bg-neutral-800 transition-all shadow-sm",children:e.jsx(ce,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:_.map((l,k)=>{const j=p*T+k===n;return e.jsxs("div",{className:`w-full text-left rounded-lg border transition-all group relative ${j?"bg-white border-neutral-900 shadow-sm ring-1 ring-neutral-900/5":"border-transparent hover:bg-neutral-100"}`,children:[e.jsxs("button",{onClick:()=>J(k),className:"w-full px-3 py-3 flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:e.jsx(ct,{score:l.lastScore})}),e.jsx("span",{className:`text-xs font-bold leading-snug line-clamp-2 ${j?"text-neutral-900":"text-neutral-600"}`,children:l.text})]}),e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 right-2 flex items-center bg-white/90 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm border border-neutral-100",children:[e.jsx("button",{onClick:()=>P(l),className:"p-1.5 text-neutral-400 hover:text-indigo-600",children:e.jsx(lt,{size:12})}),e.jsx("button",{onClick:()=>ee(l),className:"p-1.5 text-neutral-400 hover:text-red-600",children:e.jsx(_e,{size:12})})]})]},l.id)})}),e.jsxs("div",{className:"p-3 border-t border-neutral-100 bg-white flex items-center justify-between shrink-0",children:[e.jsx("select",{value:T,onChange:l=>Z(Number(l.target.value)),className:"bg-neutral-50 border border-neutral-200 rounded-lg px-2 py-1 text-[10px] font-bold text-neutral-600 focus:outline-none focus:ring-1 focus:ring-neutral-900",children:[10,15,20,30].map(l=>e.jsx("option",{value:l,children:l},l))}),w>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>b(p-1),disabled:p===0,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(ot,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 tabular-nums",children:[p+1,"/",w]}),e.jsx("button",{onClick:()=>b(p+1),disabled:p>=w-1,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Fe,{size:16})})]})]})]}),e.jsxs("div",{className:"flex-1 h-full flex flex-col relative overflow-y-auto",children:[f&&e.jsx("button",{onClick:f,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full z-50",children:e.jsx(re,{size:24})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 space-y-8 animate-in fade-in",children:[e.jsx("div",{className:"relative w-full max-w-2xl",children:e.jsxs("div",{className:"p-8 md:p-12 rounded-[2.5rem] border-2 text-center transition-all duration-300 min-h-[260px] flex flex-col items-center justify-center relative bg-white border-neutral-200 shadow-xl shadow-neutral-100",children:[L&&e.jsx("div",{className:"absolute top-6 left-6 px-3 py-1 bg-neutral-50 rounded-lg text-[10px] font-black uppercase tracking-widest text-neutral-400 border border-neutral-100",children:"Pronunciation Practice"}),e.jsx("button",{onClick:I,className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-indigo-500",children:x?e.jsx(Le,{size:24}):e.jsx(Oe,{size:24})}),e.jsxs("div",{className:"relative px-4 w-full flex flex-col items-center gap-4",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-x-3 gap-y-2",children:i==null?void 0:i.split(/\s+/).map((l,k)=>{const g=h==null?void 0:h.words[k],j=(g==null?void 0:g.status)==="missing";return e.jsx("span",{onClick:()=>ne(l),className:`text-4xl md:text-5xl font-black cursor-pointer hover:underline decoration-neutral-200 transition-all flex ${x||h?"opacity-100":"text-transparent blur-lg select-none"}`,children:g!=null&&g.chars?g.chars.map((v,W)=>e.jsx("span",{className:v.status==="correct"?"text-emerald-500":v.status==="wrong"?"text-rose-500":"text-rose-300",children:v.char},W)):e.jsx("span",{className:j?"text-neutral-300":"text-neutral-900",children:l})},k)})}),M&&H&&e.jsx("div",{className:"px-6 py-2 bg-neutral-50 border border-neutral-100 rounded-2xl text-xl font-mono font-medium text-neutral-500 animate-in slide-in-from-top-2 duration-500",children:H}),!x&&!h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-200 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Speak to reveal result"})})]}),h&&e.jsxs("div",{className:"mt-6 flex flex-col items-center gap-1 animate-in slide-in-from-top-2",children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Pronunciation Accuracy"}),e.jsxs("div",{className:`text-5xl font-black ${h.score>80?"text-emerald-500":h.score>50?"text-amber-500":"text-rose-500"}`,children:[h.score,"%"]})]})]})}),e.jsxs("div",{className:"min-h-24 flex flex-col items-center justify-center w-full max-w-xl text-center",children:[r?e.jsxs("div",{className:"flex items-center gap-3 text-rose-500 animate-pulse",children:[e.jsx(Ue,{size:32}),e.jsx("span",{className:"font-black text-base uppercase tracking-widest",children:"Listening..."})]}):!c&&e.jsx("p",{className:"text-neutral-300 text-sm font-medium",children:"Tap the microphone and read the phrase aloud"}),c&&!r&&e.jsxs("div",{className:"space-y-1 animate-in fade-in",children:[e.jsx("p",{className:"text-neutral-400 text-[10px] font-black uppercase tracking-widest",children:"What we heard"}),e.jsxs("p",{className:"text-xl font-medium italic text-neutral-600",children:['"',c,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:z,className:"p-6 rounded-3xl bg-white border border-neutral-200 text-neutral-600 hover:text-indigo-600 shadow-sm transition-all active:scale-95",children:e.jsx(Qe,{size:32})}),e.jsx("button",{onClick:D,disabled:y,className:`p-6 rounded-3xl border transition-all shadow-sm ${M?"bg-indigo-600 text-white shadow-lg scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Show Phonetic (IPA)",children:y?e.jsx(De,{size:32,className:"animate-spin"}):e.jsx(We,{size:32})}),e.jsx("button",{onClick:C,className:`w-32 h-32 rounded-full flex items-center justify-center shadow-2xl transition-all transform ${r?"bg-rose-500 text-white scale-110 ring-12 ring-rose-100":"bg-white border-4 border-neutral-100 text-neutral-900 hover:border-neutral-200 hover:scale-105"}`,children:r?e.jsx(qe,{size:40,fill:"currentColor"}):e.jsx(Ge,{size:40})}),e.jsx("button",{onClick:o,disabled:!d||r,className:`p-6 rounded-3xl border transition-all shadow-sm ${d&&!r?"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600":"bg-neutral-50 border-neutral-100 text-neutral-300 cursor-not-allowed"}`,children:e.jsx(Be,{size:32,fill:d&&!r?"currentColor":"none"})})]}),e.jsxs("button",{onClick:m,className:"px-12 py-5 rounded-[2rem] font-black text-sm uppercase tracking-widest flex items-center gap-3 transition-all shadow-xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-95",children:[e.jsx("span",{children:"Next Phrase"}),e.jsx(Je,{size:18})]})]}),e.jsx("div",{className:"px-10 pb-8",children:e.jsxs("div",{className:"p-5 bg-indigo-50 border border-indigo-100 rounded-[2rem] flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-indigo-500 text-white rounded-xl shadow-sm",children:e.jsx(Ve,{size:20})}),e.jsxs("div",{className:"text-[11px] text-indigo-700 leading-relaxed font-medium",children:[e.jsx("b",{className:"text-xs uppercase tracking-wider block mb-1",children:"Visual Feedback Guide:"}),e.jsx("span",{className:"text-emerald-600 font-black",children:"GREEN"}),": Your sound was detected correctly.",e.jsx("br",{}),e.jsx("span",{className:"text-rose-500 font-black",children:"RED"}),": These characters represent sounds that were missing or significantly mispronounced.",e.jsx("br",{}),e.jsx("span",{className:"text-neutral-400 font-black",children:"GRAY"}),": The word was not detected in your speech."]})]})})]})]}),e.jsx(xe,{isOpen:E,onClose:V,onSave:Y,initialData:Q})]})},he="vocab_pro_mimic_practice_queue",ft=({scopedWord:i,onClose:B})=>{const[r,x]=s.useState([]),[c,d]=s.useState(0),[C,z]=s.useState(!1),[o,I]=s.useState(0),[m,ae]=s.useState(10),[X,f]=s.useState(!1),[_,p]=s.useState(null),[T,w]=s.useState(null),[b,Z]=s.useState(()=>ue("vocab_pro_mimic_autospeak",!1)),J=s.useRef(b);s.useEffect(()=>{de("vocab_pro_mimic_autospeak",b),J.current=b},[b]);const n=r[c]||null,[N,F]=s.useState(!1),[L,h]=s.useState(!1),[O,P]=s.useState(""),[ee,U]=s.useState(0),[E,Q]=s.useState(null),[V,Y]=s.useState("audio/webm"),[H,M]=s.useState(null),[y,D]=s.useState(null),[A,R]=s.useState(!1),[te,l]=s.useState(!1),[k,g]=s.useState(!1),[j,v]=s.useState(null),W=s.useRef(new He),$=s.useRef(null),S=s.useRef(null),le=s.useRef(()=>{}),{showToast:q}=Ke(),oe=O.substring(ee).trimStart(),G=t=>{x(t),de(he,t),z(t.length===0)};s.useEffect(()=>{const t=ue(he,[]);x(t),z(t.length===0),d(0)},[]),s.useEffect(()=>{const t=Math.ceil(r.length/m);o>=t&&t>0&&I(t-1)},[r.length,m]),s.useEffect(()=>{const t=Math.floor(c/m);t!==o&&I(t)},[c,m]);const me=t=>{const u=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...r];G(u),d(0),f(!1)},fe=(t,a)=>{G(r.map(u=>u.id===t?{...u,text:a}:u)),f(!1),p(null)},pe=t=>{w(t)},be=()=>{if(!T)return;const t=r.filter(u=>u.id!==T.id);let a=c;a>=t.length&&(a=Math.max(0,t.length-1)),d(a),G(t),w(null),q("Phrase removed.","success")},ge=()=>{if(r.length<2)return;const t=[...r].sort(()=>Math.random()-.5);G(t),d(0),q("Queue shuffled!","success")},je=t=>{ae(t),I(0)},ve=()=>{p(null),f(!0)},we=t=>{p(t),f(!0)},Ne=t=>{_?fe(_.id,t):me(t)},K=s.useCallback(async(t=!1)=>{S.current&&clearTimeout(S.current),F(!1),W.current.stop();try{const a=await Xe();!t&&a&&(Q(a.base64),Y(a.mimeType))}catch(a){console.error("Audio capture failed",a)}},[]);s.useEffect(()=>{le.current=K},[K]);const ye=s.useCallback(async()=>{if(n){if(y&&A){R(!1);return}if(y&&!A){R(!0);return}l(!0);try{const t=n.text.trim().toLowerCase(),a=Ze().find(u=>u.word.toLowerCase()===t);if(a&&a.ipa){D(a.ipa),R(!0),l(!1);return}else{const u=et(),se=tt(u),ie=await fetch(`${se}/api/convert/ipa?text=${encodeURIComponent(n.text)}`);if(ie.ok){const Me=await ie.json();D(Me.ipa),R(!0)}else q("IPA server unavailable","error")}}catch{q("Failed to fetch IPA","error")}finally{l(!1)}}},[n,y,A,q]);s.useEffect(()=>{if(N&&K(!0),h(!1),P(""),U(0),Q(null),M(null),v(null),D(null),R(!1),$.current&&($.current.pause(),$.current=null),J.current&&n){const t=setTimeout(()=>ne(n.text),500);return()=>clearTimeout(t)}},[n==null?void 0:n.id]),s.useEffect(()=>()=>{W.current.stop(),S.current&&clearTimeout(S.current)},[]);const ke=async()=>{if(n)if(N){await K();const t=rt(n.text,oe);v(t);const a=r.map((u,se)=>se===c?{...u,lastScore:t.score}:u);G(a)}else{P(""),U(0),M(null),v(null);try{await nt(),F(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>le.current(),1e4),W.current.start((t,a)=>P(t+a),t=>P(t))}catch(t){console.error("Failed to start recording",t),F(!1)}}},Se=()=>{U(O.length),M(null),v(null)},Ce=()=>n&&ne(n.text),ze=()=>{if(E){$.current&&$.current.pause();const t=new Audio(`data:${V};base64,${E}`);$.current=t,t.play()}},Ie=()=>{r.length>0&&d(t=>(t+1)%r.length)},Te=t=>{t>=0&&t<r.length&&d(t)},Pe=Math.ceil(r.length/m),Ee=r.slice(o*m,(o+1)*m);return e.jsxs(e.Fragment,{children:[e.jsx(ut,{targetText:(n==null?void 0:n.text)||null,sourceWord:(n==null?void 0:n.sourceWord)||"",type:(n==null?void 0:n.type)||"",isRecording:N,isRevealed:L,userTranscript:oe,matchStatus:H,userAudioUrl:E,onToggleRecord:ke,onPlayTarget:Ce,onPlayUser:ze,onToggleReveal:()=>h(!L),onNext:Ie,onClearTranscript:Se,isEmpty:C,onClose:B,pagedItems:Ee,page:o,pageSize:m,totalPages:Pe,onPageChange:I,onPageSizeChange:je,onSelect:t=>Te(o*m+t),currentAbsoluteIndex:c,autoSpeak:b,onToggleAutoSpeak:()=>Z(!b),isGlobalMode:!i,isAnalyzing:k,onAnalyze:()=>{},aiAnalysis:j?{isCorrect:j.score>80,score:j.score,feedbackHtml:""}:null,localAnalysis:j,onAddItem:ve,onEditItem:we,onDeleteItem:pe,onRandomize:ge,isModalOpen:X,editingItem:_,onCloseModal:()=>f(!1),onSaveItem:Ne,ipa:y,showIpa:A,isIpaLoading:te,onToggleIpa:ye}),e.jsx(st,{isOpen:!!T,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:be,onClose:()=>w(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})};export{ft as MimicPractice};
