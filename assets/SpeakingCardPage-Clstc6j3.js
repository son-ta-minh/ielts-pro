import{c as Ae,r as s,o as mt,K as Qe,A as gt,j as e,au as pe,bT as ke,G as ft,a9 as le,y as Ce,ab as Ye,bU as bt,aW as $e,I as Oe,P as Ze,l as vt,ac as et,J as tt,a3 as Ke,bV as jt,bW as wt,bX as yt,bY as ze,bZ as Re,b_ as kt,X as Se,a1 as st,aq as Be,m as at,ax as Nt,i as nt,ap as Ct,D as Ne,C as St,b$ as At,c0 as Tt,as as Ve,bt as It,E as Et,c1 as rt,bv as Mt,c2 as zt,aY as Rt,a as Ot,av as lt,a0 as Pt,c3 as Ut,bw as Lt,by as Ft}from"./index-BeBINpHy.js";import{R as $t,a as Bt}from"./ResourceActions-B4FNr2vj.js";import{T as Vt}from"./TagBrowser-BPRRTge4.js";import{u as _t,G as Gt,S as qe,V as Wt}from"./ShelfSearchBar-BH8nwIhz.js";import{U as ot}from"./UniversalCard-CX67S68Z.js";import{F as Ht,U as Jt,a as Yt,M as Kt,A as qt,R as Dt}from"./ShelfModals-Q9auai6C.js";import{M as Xt}from"./move-BL81twAO.js";import{P as Qt}from"./pen-ChzXJ-2y.js";import{L as Zt}from"./library-Dpx4-dcr.js";import{C as es}from"./chevron-left-D1EVPfk0.js";import{D as ts}from"./download-BWN6cTul.js";import"./search-B1tb4K_3.js";import"./circle-CuWs-sVS.js";import"./palette-Dq3GLoKS.js";import"./square-check-big-qIvMHrqh.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=Ae("AudioLines",[["path",{d:"M2 10v3",key:"1fnikh"}],["path",{d:"M6 6v11",key:"11sgs0"}],["path",{d:"M10 3v18",key:"yhl04a"}],["path",{d:"M14 8v7",key:"3a1oy3"}],["path",{d:"M18 5v13",key:"123xd1"}],["path",{d:"M22 10v3",key:"154ddg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Ae("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Ae("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=Ae("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=Ae("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);function ls(c,A){return`You are an expert English linguist and communication coach.
    
    TASK: Analyze a user's input to identify a core concept and example phrases. You MUST refine the provided phrases and generate additional ones to create a structured set of native-like expressions.

    RAW USER INPUT:
    "${c}"

    USER REFINEMENT REQUEST: "${A||"Generate a variety of expressions."}"

    INSTRUCTIONS:
    1.  **Analyze and Split Input (CRITICAL FIRST STEP)**:
        -   Read the "RAW USER INPUT". It may contain both a core concept and several example phrases, often separated by colons or newlines.
        -   **Identify the Core Concept**: Extract the main idea or topic (e.g., "Disagree", "Expressing excitement"). This will be the value for the "standard" field in your output JSON.
        -   **Extract Example Phrases**: Identify any full example sentences or phrases from the input. These are your primary material.

    2.  **Refine and Augment**:
        -   **MUST REFINE**: Take each "Example Phrase" you extracted. Improve its wording, identify its core 'anchor', and assign it to the most appropriate tone ('casual', 'semi-academic', or 'academic'). These refined phrases will form the base of your "answers" list.
        -   **MUST AUGMENT**: After refining the user's examples, check if you have at least one answer for EACH of the three tones. If any tone is missing, generate a NEW, high-quality expression for that tone.
        -   The final "answers" list must contain a mix of refined user examples and newly generated expressions, with at least one for each tone.

    3.  **Identify Anchor**: For EACH answer in your final list, identify the single most important keyword or short phrase. This is the 'anchor'.
    4.  **Create Sentence**: Write a full, natural example sentence for each expression.
    5.  **Keyword Highlighting**: In the 'sentence' field, you MUST highlight the core lexical chunk using curly braces \`{}\`. Example: "I'm {skeptical about} that."
    6.  **Add Optional Note**: If useful, add a brief 'note'. Use angle brackets \`<...>\` for grammar tips (e.g., preposition variations) inside the sentence. Example: "I'm {skeptical} about that <'skeptical' can be followed by 'about' or 'of'>".
    7.  **Format Final JSON**: The "standard" field must contain ONLY the core concept you identified. The "answers" list must contain the final, combined set of refined and augmented expressions.

    EXAMPLE WALKTHROUGH:
    -   RAW USER INPUT: "Disagree: I‚Äôm not convinced that would work\\nI'm strongly against..."
    -   Step 1 Result:
        -   Core Concept identified: "Expressing disagreement". This becomes the 'standard' value.
        -   Extracted examples: "I'm not convinced that would work", "I'm strongly against...".
    -   Step 2-7: You will now **refine** these two examples, assign them to tones, then **augment** by creating new expressions for any missing tones, and finally format them all into the final JSON.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (The extracted core concept, e.g., 'Expressing disagreement')",
      "answers": [
        {
          "tone": "casual",
          "anchor": "string (e.g., 'not buying it')",
          "sentence": "string (e.g., 'Honestly, I'm {not buying it}.')",
          "note": "string (e.g., 'A very informal way to show disbelief.')"
        },
        {
          "tone": "semi-academic",
          "anchor": "string (e.g., 'skeptical')",
          "sentence": "string (e.g., 'I'm a bit {skeptical of} that claim.')"
        },
        {
          "tone": "academic",
          "anchor": "string (e.g., 'reservations')",
          "sentence": "string (e.g., 'I {have some reservations about} the validity of this data.')",
          "note": "string (e.g., 'Use 'reservations' in formal contexts to express doubt politely.')"
        }
      ]
    }
    `}function os(c){return`You are an expert IELTS coach and scenario designer.
    
    TASK: Generate a natural, realistic English conversation based on the topic: "${c}".
    
    CONSTRAINTS:
    1.  The conversation must involve 2 to 3 distinct speakers.
    2.  Assign each speaker a name and a sex (male or female).
    3.  The conversation should have 10 to 15 sentences in total.
    4.  The language should be appropriate for an IELTS candidate (ranging from casual to semi-formal depending on the topic).
    5.  Use high-value vocabulary and natural lexical chunks.
    6.  Assign an "icon" (emoji string) to EVERY single sentence representing the speaker's specific emotion or tone at that moment. Use emojis exclusively from the "Smiley and Emotion" fluent group.
    
    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object. Do not include any text outside the JSON block.
    
    {
      "title": "string (A catchy title for the conversation)",
      "description": "string (Short context for the conversation)",
      "speakers": [
        { "name": "string (e.g., 'Alice')", "sex": "male" | "female" }
      ],
      "sentences": [
        { "speakerName": "string", "text": "string (verbatim what they say)", "icon": "string (emotional emoji)" }
      ],
      "tags": ["string (3-5 relevant IELTS tags)"]
    }
    `}const Xe="vocab_pro_speaking_card_view",is=({text:c})=>{const A=c.split(/({.*?}|\[.*?\]|<.*?>)/g);return e.jsx(e.Fragment,{children:A.map((r,a)=>r.startsWith("{")&&r.endsWith("}")?e.jsx("span",{className:"mx-0.5 px-1 py-0.5 rounded bg-amber-100 text-amber-800 font-bold font-mono text-[0.9em] border border-amber-200 inline-block shadow-sm",children:r.slice(1,-1)},a):r.startsWith("[")&&r.endsWith("]")?e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-sky-700 bg-sky-100 border border-sky-200 px-2 py-1 rounded-full font-medium",children:[e.jsx(lt,{size:12}),r.slice(1,-1)]},a):e.jsx("span",{children:r},a))})};function cs(c){const A=c.numberOfChannels,r=c.length*A*2+44,a=new ArrayBuffer(r),T=new DataView(a),N=[];let y,d,F=0,l=0;for(i(1179011410),i(r-8),i(1163280727),i(544501094),i(16),f(1),f(A),i(c.sampleRate),i(c.sampleRate*2*A),f(A*2),f(16),i(1635017060),i(r-l-4),y=0;y<c.numberOfChannels;y++)N.push(c.getChannelData(y));for(;l<r;){for(y=0;y<A;y++)d=Math.max(-1,Math.min(1,N[y][F])),d=(d<0?d*32768:d*32767)|0,T.setInt16(l,d,!0),l+=2;F++}return new Blob([a],{type:"audio/wav"});function f(u){T.setUint16(l,u,!0),l+=2}function i(u){T.setUint32(l,u,!0),l+=4}}const ds=({isOpen:c,onClose:A,onSave:r,initialData:a})=>{const[T,N]=s.useState(""),[y,d]=s.useState(""),[F,l]=s.useState(""),[f,i]=s.useState([]);s.useEffect(()=>{var E;c&&(N((a==null?void 0:a.standard)||""),l((a==null?void 0:a.note)||""),d(((E=a==null?void 0:a.tags)==null?void 0:E.join(", "))||""),i((a==null?void 0:a.answers)||[]))},[c,a]);const u=E=>{E.preventDefault(),T.trim()&&r({standard:T.trim(),tags:y.split(",").map(L=>L.trim()).filter(Boolean),note:F.trim(),answers:f})};return c?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("form",{onSubmit:u,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:a?"Edit Expression":"New Expression"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Define context and generate expressions."})]}),e.jsx("button",{type:"button",onClick:A,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Se,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Context / Meaning"}),e.jsx("textarea",{value:T,onChange:E=>N(E.target.value),placeholder:"e.g., Disagreeing politely",rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium focus:ring-2 focus:ring-neutral-900 outline-none resize-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(tt,{size:12})," Tags"]}),e.jsx("input",{value:y,onChange:E=>d(E.target.value),placeholder:"linking, academic...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Answers"}),e.jsx("button",{type:"button",onClick:()=>i([...f,{tone:"semi-academic",anchor:"",sentence:""}]),className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 transition-colors",children:e.jsx(Ce,{size:14})})]}),f.map((E,L)=>e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-xl border border-neutral-200 space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:()=>i(f.filter((M,U)=>U!==L)),className:"absolute top-2 right-2 text-neutral-300 hover:text-red-500 opacity-0 group-hover:opacity-100",children:e.jsx(le,{size:12})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:E.tone,onChange:M=>{const U=[...f];U[L].tone=M.target.value,i(U)},className:"px-2 py-1 bg-white border border-neutral-200 rounded-lg text-[10px] font-bold outline-none",children:[e.jsx("option",{value:"casual",children:"Casual"}),e.jsx("option",{value:"semi-academic",children:"Semi-Academic"}),e.jsx("option",{value:"academic",children:"Academic"})]}),e.jsx("input",{value:E.anchor,onChange:M=>{const U=[...f];U[L].anchor=M.target.value,i(U)},placeholder:"Anchor phrase",className:"flex-1 px-2 py-1 bg-white border border-neutral-200 rounded-lg text-xs font-bold outline-none"})]}),e.jsx("textarea",{value:E.sentence,onChange:M=>{const U=[...f];U[L].sentence=M.target.value,i(U)},placeholder:"Example sentence with {curly braces}",className:"w-full p-2 bg-white border border-neutral-200 rounded-lg text-xs font-medium resize-none outline-none",rows:2})]},L))]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs uppercase tracking-widest",children:[e.jsx(st,{size:14})," Save"]})})]})}):null},us=({isOpen:c,onClose:A,onSave:r,initialData:a,onOpenAiGen:T})=>{const[N,y]=s.useState(""),[d,F]=s.useState(""),[l,f]=s.useState([]),[i,u]=s.useState([]),[E,L]=s.useState(""),[M,U]=s.useState(null);s.useEffect(()=>{var b;if(c){y((a==null?void 0:a.title)||""),F((a==null?void 0:a.description)||""),f((a==null?void 0:a.speakers)||[]),u((a==null?void 0:a.sentences)||[]),L(((b=a==null?void 0:a.tags)==null?void 0:b.join(", "))||"");const C=Be(at());Nt(C).then(U).catch(()=>U(null))}},[c,a]);const W=b=>{b.preventDefault(),N.trim()&&r({title:N.trim(),description:d,speakers:l,sentences:i,tags:E.split(",").map(C=>C.trim()).filter(Boolean)})},te=(b,C)=>{f(v=>v.map((j,q)=>q===b?{...j,...C}:j))},V=s.useMemo(()=>M?M.voices.filter(b=>b.language.startsWith("en")&&(b.name.toLowerCase().includes("enhanced")||b.name.toLowerCase().includes("premium"))):[],[M]);return c?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:W,className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:a?"Edit Conversation":"New Conversation"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Create interactive multi-speaker dialogues."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:T,className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 transition-colors",title:"Generate with AI",children:e.jsx(nt,{size:18})}),e.jsx("button",{type:"button",onClick:A,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Se,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400",children:"Title"}),e.jsx("input",{value:N,onChange:b=>y(b.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold focus:ring-2 focus:ring-neutral-900 outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400",children:"Tags"}),e.jsx("input",{value:E,onChange:b=>L(b.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase flex items-center gap-2",children:[e.jsx(Ct,{size:14})," Speakers (",l.length,"/3)"]}),e.jsx("button",{type:"button",onClick:()=>f([...l,{name:"",sex:"female"}]),disabled:l.length>=3,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 transition-colors disabled:opacity-50",children:e.jsx(Ce,{size:14})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:l.map((b,C)=>e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-2xl border border-neutral-200 relative group animate-in zoom-in-95 grid grid-cols-1 sm:grid-cols-[1fr,auto,2fr] gap-4 items-center",children:[e.jsx("button",{type:"button",onClick:()=>f(l.filter((v,j)=>j!==C)),className:"absolute -top-1.5 -right-1.5 p-1 bg-white text-neutral-300 hover:text-red-500 border border-neutral-200 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(Se,{size:10})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"Speaker Name"}),e.jsx("input",{value:b.name,onChange:v=>te(C,{name:v.target.value}),placeholder:"Name",className:"w-full bg-white border border-neutral-200 rounded-lg px-3 py-1.5 font-bold text-xs outline-none focus:border-neutral-900"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"Sex"}),e.jsxs("div",{className:"flex bg-white rounded-lg p-0.5 border border-neutral-200 h-[32px]",children:[e.jsx("button",{type:"button",onClick:()=>te(C,{sex:"male"}),className:`flex-1 px-3 py-1 text-[8px] font-black uppercase rounded ${b.sex==="male"?"bg-blue-500 text-white shadow-sm":"text-neutral-400"}`,children:"Male"}),e.jsx("button",{type:"button",onClick:()=>te(C,{sex:"female"}),className:`flex-1 px-3 py-1 text-[8px] font-black uppercase rounded ${b.sex==="female"?"bg-pink-500 text-white shadow-sm":"text-neutral-400"}`,children:"Female"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"High Quality Voice"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b.voiceName||"",onChange:v=>{const j=V.find(q=>q.name===v.target.value);te(C,{voiceName:v.target.value,accentCode:j==null?void 0:j.accent}),v.target.value&&Ne(`Hello, this is ${v.target.value}`,!1,"en",v.target.value,j==null?void 0:j.accent)},className:"w-full bg-white border border-neutral-200 rounded-xl px-4 py-3 pr-10 text-[10px] font-bold outline-none focus:border-neutral-900 appearance-none",children:[e.jsx("option",{value:"",children:"Auto Select"}),V.map(v=>e.jsxs("option",{value:v.name,children:[v.name," (",v.accent,")"]},v.name))]}),e.jsx(St,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]})]})]},C))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase flex items-center gap-2",children:[e.jsx($e,{size:14})," Script (",i.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var b;return u([...i,{speakerName:((b=l[0])==null?void 0:b.name)||"",text:""}])},disabled:l.length===0,className:"px-3 py-1.5 bg-neutral-900 text-white rounded-lg font-bold text-xs flex items-center gap-1.5 hover:bg-neutral-800 disabled:opacity-50 transition-colors",children:[e.jsx(Ce,{size:14})," Add Line"]})]}),e.jsx("div",{className:"space-y-2",children:i.map((b,C)=>e.jsxs("div",{className:"flex gap-2 items-start animate-in slide-in-from-top-2",children:[e.jsx("select",{value:b.speakerName,onChange:v=>{const j=[...i];j[C].speakerName=v.target.value,u(j)},className:"w-24 shrink-0 px-2 py-2 bg-neutral-50 border border-neutral-200 rounded-lg text-[10px] font-black uppercase tracking-wider outline-none focus:ring-1 focus:ring-neutral-900",children:l.map(v=>e.jsx("option",{value:v.name,children:v.name||"?"},v.name))}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsx("textarea",{value:b.text,onChange:v=>{const j=[...i];j[C].text=v.target.value,u(j)},rows:2,placeholder:"Speech...",className:"w-full px-3 py-2 bg-neutral-50 border border-neutral-200 rounded-xl text-xs font-medium focus:ring-1 focus:ring-neutral-900 outline-none resize-none"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"text-[8px] font-black text-neutral-400 uppercase",children:"Emoji"}),e.jsx("input",{value:b.icon||"",onChange:v=>{const j=[...i];j[C].icon=v.target.value,u(j)},className:"bg-neutral-50 border border-neutral-100 rounded px-2 py-1 text-xs w-12",placeholder:"üòä"})]})]}),e.jsx("button",{type:"button",onClick:u.bind(null,i.filter((v,j)=>j!==C)),className:"p-2 text-neutral-300 hover:text-red-500",children:e.jsx(le,{size:14})})]},C))})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(st,{size:14})," Save Conversation"]})})]})}):null},xs=({isOpen:c,onClose:A,item:r})=>{const[a,T]=s.useState(new Set),[N,y]=s.useState(null);if(!c||!r)return null;const d=l=>{T(f=>{const i=new Set(f);return i.has(l)?i.delete(l):i.add(l),i})},F=l=>{const f=l.replace(/{|}/g,"");y(f)};return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[85vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:r.standard}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1",children:"Native Expressions Practice"})]}),e.jsx("button",{type:"button",onClick:A,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Se,{size:24})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-8 space-y-4 custom-scrollbar bg-neutral-50/30",children:r.answers.map((l,f)=>e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-3 relative overflow-hidden group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[8px] font-black uppercase border ${l.tone==="academic"?"bg-purple-50 text-purple-700 border-purple-100":l.tone==="semi-academic"?"bg-blue-50 text-blue-700 border-blue-100":"bg-neutral-50 text-neutral-600 border-neutral-100"}`,children:l.tone}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:l.anchor})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Ne(l.sentence.replace(/{|}/g,"")),className:"p-2 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all",title:"Listen",children:e.jsx(Ve,{size:16})}),e.jsx("button",{onClick:()=>F(l.sentence),className:"p-2 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-all",title:"Practice Speaking",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>d(f),className:"p-2 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-all",children:a.has(f)?e.jsx(It,{size:16}):e.jsx(Et,{size:16})})]})]}),e.jsx("div",{className:"min-h-[1.5rem] flex items-center",children:a.has(f)?e.jsx("div",{className:"text-base font-medium text-neutral-800 animate-in fade-in slide-in-from-top-1",children:e.jsx(is,{text:l.sentence})}):e.jsx("div",{className:"flex gap-1 items-center",children:Array.from({length:3}).map((i,u)=>e.jsx("div",{className:"h-1.5 w-8 bg-neutral-100 rounded-full animate-pulse"},u))})}),l.note&&a.has(f)&&e.jsxs("div",{className:"pt-2 mt-2 border-t border-neutral-50 text-[10px] text-neutral-500 font-medium italic",children:['"',l.note,'"']})]},f))}),e.jsx("footer",{className:"px-8 py-4 border-t border-neutral-100 bg-white rounded-b-[2.5rem] flex justify-end",children:e.jsx("button",{onClick:A,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-md",children:"Done"})})]}),N&&e.jsx(rt,{target:N,onClose:()=>y(null)})]})},ps=({isOpen:c,onClose:A,item:r})=>{const[a,T]=s.useState(0),[N,y]=s.useState(!1),[d,F]=s.useState(!1),[l,f]=s.useState(null),[i,u]=s.useState(!1),[E,L]=s.useState(!1),[M,U]=s.useState(!0),[W,te]=s.useState({}),[V,b]=s.useState({}),[C,v]=s.useState(!1),[j,q]=s.useState(""),[$,ae]=s.useState(null),[be,se]=s.useState("audio/webm"),[D,X]=s.useState(!1),[Te,oe]=s.useState(null),[he]=s.useState(()=>at()),ie=s.useRef(null),ce=s.useRef({}),de=s.useRef(new Mt),_=s.useRef(null),{showToast:ne}=Qe(),R=()=>{_.current&&(_.current.pause(),_.current.src="",_.current=null),Ut()},ue=()=>{R(),de.current.stop(),b({}),te({}),ae(null),A()};if(s.useEffect(()=>{if(!(N||d)||!r)return;let n=!1;return(async()=>{if(a>=r.sentences.length||n)return;const k=r.sentences[a];if(!d&&l&&k.speakerName===l){y(!1),u(!0);return}const h=W[a];if(h&&d)R(),await new Promise(I=>{const m=new Audio(`data:${h.mime};base64,${h.base64}`);_.current=m,m.onended=()=>I(!0),m.onerror=()=>I(!1),m.play().catch(()=>I(!1)),n&&(m.pause(),I(!1))});else{const I=V[a];if(I)R(),await new Promise(m=>{const P=new Audio(`data:${I.mime};base64,${I.base64}`);_.current=P,P.onended=()=>m(!0),P.onerror=()=>m(!1),P.play().catch(()=>m(!1)),n&&(P.pause(),m(!1))});else{const m=r.speakers.find(p=>p.name===k.speakerName);let P=m==null?void 0:m.voiceName,G=m==null?void 0:m.accentCode;if(!P){const p=(m==null?void 0:m.sex)==="male"?"male":"female",w=he.audioCoach.coaches[p];P=w.enVoice,G=w.enAccent}try{const p=Be(he),w={text:k.text,language:"en",accent:G,voice:P},H=await fetch(`${p}/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(H.ok){const J=await H.blob(),Y=new FileReader,Z=new Promise(B=>{Y.onloadend=()=>B(Y.result.split(",")[1])});Y.readAsDataURL(J);const z=await Z,ge=H.headers.get("Content-Type")||"audio/aiff";if(b(B=>({...B,[a]:{base64:z,mime:ge}})),!n){R();const B=new Audio(`data:${ge};base64,${z}`);_.current=B,await new Promise(re=>{B.onended=()=>re(!0),B.onerror=()=>re(!1),B.play().catch(()=>re(!1)),n&&(B.pause(),re(!1))})}}else await Ne(k.text,!0,"en",P,G)}catch(p){console.error("Playback error",p)}}}!n&&(N||d)&&(a<r.sentences.length-1?T(I=>I+1):(y(!1),F(!1)))})(),()=>{n=!0}},[N,d,a,r,l]),s.useEffect(()=>{const n=ce.current[a];n&&ie.current&&n.scrollIntoView({behavior:"smooth",block:"center"})},[a,N,d,i,M]),!c||!r||!r.sentences||r.sentences.length===0)return null;const Q=r.sentences,ve=Q[a],Ie=async()=>{if(C){de.current.stop(),X(!1);const n=await Lt();n&&(ae(n.base64),se(n.mimeType)),v(!1)}else{R(),q(""),ae(null);try{await Ft(),v(!0),X(!0),de.current.start((n,S)=>q(n+S),n=>q(n))}catch(n){console.error("Failed to start recording",n),v(!1)}}},me=n=>{const S=n!==void 0?W[n]:$?{base64:$,mime:be}:null;if(S){R();const k=new Audio(`data:${S.mime};base64,${S.base64}`);_.current=k,k.play()}},je=()=>{$&&te(n=>({...n,[a]:{base64:$,mime:be}})),u(!1),q(""),ae(null),a<Q.length-1?(T(n=>n+1),y(!0)):y(!1)},Pe=async(n,S)=>{R();const k=V[S];if(k){const p=new Audio(`data:${k.mime};base64,${k.base64}`);_.current=p,p.play();return}const h=r.speakers.find(p=>p.name===n.speakerName);let I=h==null?void 0:h.voiceName,m=h==null?void 0:h.accentCode;if(!I){const p=(h==null?void 0:h.sex)==="male"?"male":"female",w=he.audioCoach.coaches[p];I=w.enVoice,m=w.enAccent}const P=Be(he),G={text:n.text,language:"en",accent:m,voice:I};try{const p=await fetch(`${P}/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)});if(p.ok){const w=await p.blob(),H=new FileReader;H.onloadend=()=>{const Y=H.result.split(",")[1],Z=p.headers.get("Content-Type")||"audio/aiff";b(z=>({...z,[S]:{base64:Y,mime:Z}}))},H.readAsDataURL(w);const J=new Audio(URL.createObjectURL(w));_.current=J,J.play()}else Ne(n.text,!1,"en",I,m)}catch{Ne(n.text,!1,"en",I,m)}},xe=()=>{d?(F(!1),R()):(R(),y(!1),u(!1),F(!0),T(0))},Ee=async()=>{if(!E){L(!0),ne("T·ªïng h·ª£p file √¢m thanh (To√†n b·ªô)...","info");try{const n=new(window.AudioContext||window.webkitAudioContext),S=[];for(let p=0;p<r.sentences.length;p++){const w=W[p],H=V[p],J=w||H;if(!J)continue;const Y=atob(J.base64),Z=new Uint8Array(Y.length);for(let z=0;z<Y.length;z++)Z[z]=Y.charCodeAt(z);try{const z=await n.decodeAudioData(Z.buffer);S.push(z)}catch(z){console.warn(`Failed to decode segment ${p}`,z)}}if(S.length===0){ne("Ch∆∞a c√≥ ƒëo·∫°n √¢m thanh n√†o s·∫µn s√†ng.","info"),L(!1);return}const k=S.reduce((p,w)=>p+w.length,0),h=n.createBuffer(S[0].numberOfChannels,k,S[0].sampleRate);let I=0;S.forEach(p=>{for(let w=0;w<p.numberOfChannels;w++)h.getChannelData(w).set(p.getChannelData(w),I);I+=p.length});const m=cs(h),P=URL.createObjectURL(m),G=document.createElement("a");G.href=P,G.download=`Full_Dialogue_${r.title.replace(/\s+/g,"_")}.wav`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(P),ne("ƒê√£ l∆∞u file √¢m thanh ho√†n ch·ªânh!","success")}catch(n){console.error("Save All failed",n),ne("L·ªói khi t·∫°o file √¢m thanh.","error")}finally{L(!1)}}},we=Object.keys(W).length>0||Object.keys(V).length>0,Me=M?[Q[a]]:Q;return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white w-full max-w-4xl rounded-[3rem] shadow-2xl border border-neutral-200 flex flex-col h-[85vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0 bg-white z-10",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900 tracking-tight leading-none",children:r.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[9px] font-black uppercase text-neutral-400",children:[e.jsx(as,{size:10})," Role Play:"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-0.5 rounded-lg",children:[e.jsx("button",{onClick:()=>{f(null),u(!1),F(!1),R()},className:`px-2 py-1 rounded-md text-[9px] font-black uppercase transition-all ${!l&&!d?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:"Spectator"}),r.speakers.map(n=>e.jsxs("button",{onClick:()=>{f(n.name),u(!1),F(!1),R()},className:`px-2 py-1 rounded-md text-[9px] font-black uppercase transition-all ${l===n.name?"bg-indigo-600 text-white shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:["Act as ",n.name]},n.name))]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:()=>U(!0),className:`px-3 py-1.5 rounded-lg text-[9px] font-black uppercase flex items-center gap-1.5 transition-all ${M?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Show current turn only",children:[e.jsx(et,{size:12})," Focus"]}),e.jsxs("button",{onClick:()=>U(!1),className:`px-3 py-1.5 rounded-lg text-[9px] font-black uppercase flex items-center gap-1.5 transition-all ${M?"text-neutral-400 hover:text-neutral-600":"bg-white text-neutral-900 shadow-sm"}`,title:"Show full script",children:[e.jsx(ns,{size:12})," Script"]})]}),!i&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:xe,className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${d?"bg-indigo-600 text-white shadow-lg":"text-neutral-500 hover:text-neutral-900"}`,title:"Play whole conversation non-stop",children:[e.jsx(De,{size:14}),d?"Stop":"Play All"]}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{R(),y(!0),F(!1)},className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${N?"bg-neutral-900 text-white shadow-lg":"text-neutral-500 hover:text-neutral-900"}`,children:[e.jsx(Oe,{size:14,fill:"currentColor"})," Play"]}),e.jsxs("button",{onClick:()=>{y(!1),R()},className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${N?"text-neutral-500 hover:text-neutral-900":"bg-neutral-900 text-white shadow-lg"}`,children:[e.jsx(rs,{size:14,fill:"currentColor"})," Pause"]})]})]}),e.jsx("button",{type:"button",onClick:ue,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Se,{size:24})})]})]}),e.jsx("div",{className:"bg-neutral-50/50 py-6 px-8 border-b border-neutral-100 shrink-0",children:e.jsx("div",{className:"flex justify-center items-end gap-10 md:gap-20",children:r.speakers.map((n,S)=>{const k=ve.speakerName===n.name,h=l===n.name;return e.jsxs("div",{className:"flex flex-col items-center relative group",children:[k&&e.jsxs("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-neutral-900 text-white px-3 py-1.5 rounded-xl text-lg animate-bounce shadow-xl whitespace-nowrap z-20",children:[ve.icon||"üí¨",e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-900 rotate-45"})]}),e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center text-3xl md:text-4xl transition-all duration-300 ${k?"bg-white scale-110 shadow-2xl ring-4 ring-indigo-500/20":"bg-neutral-200/50 grayscale opacity-40"} ${h?"border-2 border-indigo-500":""}`,children:n.sex==="male"?"üë®":"üë©"}),e.jsx("div",{className:`mt-2 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest transition-colors ${k?"bg-neutral-900 text-white":"text-neutral-400 bg-neutral-100"} ${h?"ring-1 ring-indigo-500":""}`,children:h?"YOU":n.name})]},S)})})}),e.jsx("main",{ref:ie,className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-4 custom-scrollbar bg-white scroll-smooth pb-32",children:Me.map((n,S)=>{const k=M?a:S,h=M?!0:S===a,I=l===n.speakerName,m=r.speakers.find(w=>w.name===n.speakerName),P=(m==null?void 0:m.sex)==="male",G=W[k]!==void 0,p=i&&k===a;return e.jsxs("div",{ref:w=>{h&&(ce.current[k]=w)},onClick:()=>{!N&&!d&&!i&&!M&&(T(S),R())},className:`flex items-start gap-4 p-4 rounded-[2rem] transition-all border-2 ${h?"bg-indigo-50/30 border-indigo-200 shadow-sm":"border-transparent hover:bg-neutral-50"} ${N||d||i||M?"cursor-default":"cursor-pointer"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-2xl shrink-0 flex items-center justify-center text-xl shadow-sm ${P?"bg-blue-100":"bg-pink-100"} ${h?"scale-110 ring-2 ring-white":""}`,children:I?"üåü":n.icon||(P?"üë®":"üë©")}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${h?"text-indigo-600":"text-neutral-400"}`,children:I?`YOU (as ${n.speakerName})`:n.speakerName}),e.jsxs("div",{className:"flex items-center gap-1",children:[G&&e.jsx("button",{onClick:w=>{w.stopPropagation(),me(k)},className:"p-2 bg-rose-50 text-rose-600 rounded-xl hover:bg-rose-100 transition-all",title:"Listen back to your attempt",children:e.jsx(pe,{size:14})}),h&&!N&&!d&&!i&&e.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in zoom-in-95",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),Pe(n,k)},className:"p-2 bg-neutral-900 text-white rounded-xl hover:scale-105 transition-transform",children:e.jsx(Ve,{size:14})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),oe(n.text)},className:"p-2 bg-rose-500 text-white rounded-xl hover:scale-105 transition-transform",children:e.jsx(pe,{size:14})})]})]})]}),e.jsx("p",{className:`text-sm md:text-lg leading-relaxed font-bold transition-colors ${h?"text-neutral-900":"text-neutral-500"}`,children:n.text}),p&&e.jsxs("div",{className:"mt-4 p-6 bg-white border-2 border-indigo-500 rounded-[2rem] shadow-xl animate-in zoom-in-95 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-600",children:[e.jsx(zt,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Your Turn to Speak"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Pe(n,k),className:"p-2 bg-neutral-100 text-neutral-600 rounded-lg hover:text-neutral-900 transition-all",title:"Listen to Model",children:e.jsx(Ve,{size:16})}),D&&e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-red-500 animate-ping"})]})]}),e.jsx("div",{className:"min-h-[60px] p-4 bg-neutral-50 rounded-2xl border border-neutral-100 flex flex-col items-center justify-center text-center",children:j?e.jsxs("p",{className:"text-sm font-medium italic text-neutral-800 leading-relaxed",children:['"',j,'"']}):e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:"Tap mic and read the sentence aloud"})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:Ie,className:`w-14 h-14 rounded-full flex items-center justify-center transition-all transform active:scale-90 ${C?"bg-red-500 text-white animate-pulse ring-8 ring-red-100":"bg-neutral-900 text-white hover:bg-neutral-800"}`,children:C?e.jsx(Rt,{size:24,fill:"white"}):e.jsx(pe,{size:24})}),$&&e.jsx("button",{onClick:()=>me(),className:"p-4 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:text-indigo-600 hover:border-indigo-300 transition-all",children:e.jsx(Oe,{size:20,fill:"currentColor"})}),e.jsx("button",{onClick:je,disabled:C,className:"px-6 py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-50",children:"Confirm & Continue"})]})]})]})]},`${k}-${S}`)})}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 bg-white/80 backdrop-blur-md flex justify-between items-center shrink-0 absolute bottom-0 left-0 right-0 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>{T(n=>Math.max(0,n-1)),R(),u(!1)},disabled:a===0||i,className:"p-3 rounded-xl border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all",children:e.jsx(es,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-[0.2em] mb-1",children:"Sentence"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[a+1," / ",Q.length]})]}),e.jsx("button",{onClick:()=>{T(n=>Math.min(Q.length-1,n+1)),R(),u(!1)},disabled:a===Q.length-1||i,className:"p-3 rounded-xl border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all",children:e.jsx(Ot,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[d?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-2xl shadow-lg animate-in fade-in",children:[e.jsx(De,{size:14}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Full Playback Mode"})]}):i?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-50 rounded-2xl border border-indigo-100 animate-in slide-in-from-right-2",children:[e.jsx(nt,{size:14,className:"text-indigo-600"}),e.jsx("span",{className:"text-[10px] font-black text-indigo-700 uppercase tracking-widest",children:"Waiting for User"})]}):!N&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-neutral-50 rounded-2xl border border-neutral-100 animate-in fade-in",children:[e.jsx(lt,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-500 uppercase tracking-widest",children:"Manual Mode Active"})]}),e.jsxs("button",{onClick:Ee,disabled:E||!we,className:"px-5 py-3 bg-emerald-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-lg active:scale-95 flex items-center gap-2 disabled:opacity-50",title:"Save all audio (User & AI) to one file",children:[E?e.jsx(Pt,{size:14,className:"animate-spin"}):e.jsx(ts,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Save All"})]}),e.jsx("button",{onClick:ue,className:"px-8 py-3 bg-neutral-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-lg active:scale-95",children:"Finish Session"})]})]})]}),Te&&e.jsx(rt,{target:Te,onClose:()=>oe(null)})]})},hs=({item:c,viewSettings:A,onEdit:r,onDelete:a,onFocusChange:T,onToggleFocus:N,onPractice:y})=>e.jsx(ot,{title:e.jsx("div",{className:"flex items-center gap-2 font-black text-neutral-900",children:c.standard}),badge:{label:"Native Expression",colorClass:"bg-teal-50 text-teal-700 border-teal-100",icon:ss},tags:A.showTags?c.tags:void 0,compact:A.compact,onClick:()=>y(c),focusColor:c.focusColor,onFocusChange:d=>T(c,d),isFocused:c.isFocused,onToggleFocus:N,actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),r()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(Ze,{size:14})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),a()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",children:e.jsx(le,{size:14})})]}),children:e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:[c.answers.length," variations"]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:d=>{d.stopPropagation(),y(c)},className:"flex items-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-lg active:scale-95",children:[e.jsx(Oe,{size:14,fill:"currentColor"})," Practice"]})})]})}),Es=({user:c,onNavigate:A})=>{var He;const[r,a]=s.useState([]),[T,N]=s.useState([]),[y,d]=s.useState(!0),[F,l]=s.useState(!1),[f,i]=s.useState(!1),[u,E]=s.useState(()=>mt(Xe,{showTags:!0,compact:!1,resourceType:"ALL"})),L=(t,o)=>E(O=>({...O,[t]:o})),[M,U]=s.useState(0),[W,te]=s.useState(12),[V,b]=s.useState(null),[C,v]=s.useState(!1),[j,q]=s.useState("all"),[$,ae]=s.useState("all"),[be,se]=s.useState("LIST"),[D,X]=s.useState(null),[Te,oe]=s.useState(!1),[he,ie]=s.useState(!1),[ce,de]=s.useState(null),[_,ne]=s.useState(null),[R,ue]=s.useState(null),[Q,ve]=s.useState(!1),[Ie,me]=s.useState(!1),[je,Pe]=s.useState(null),{showToast:xe}=Qe(),[Ee,we]=s.useState(null),[Me,n]=s.useState(null),{currentShelfName:S,booksOnCurrentShelf:k,allShelves:h,addShelf:I,renameShelf:m,removeShelf:P,nextShelf:G,prevShelf:p,selectShelf:w}=_t(T,"speaking_books_shelves"),[H,J]=s.useState(!1),[Y,Z]=s.useState(!1),[z,ge]=s.useState(null),[B,re]=s.useState(null),K=async()=>{d(!0);const[t,o,O]=await Promise.all([jt(c.id),wt(c.id),yt(c.id)]),x=[...t.map(g=>({type:"card",data:g})),...o.map(g=>({type:"conversation",data:g}))];a(x.sort((g,ee)=>ee.data.createdAt-g.data.createdAt)),N(O.sort((g,ee)=>ee.createdAt-g.createdAt)),d(!1)};s.useEffect(()=>{K()},[c.id]),s.useEffect(()=>{U(0)},[V,W,j,$,u.resourceType]),s.useEffect(()=>{gt(Xe,u)},[u]);const ye=s.useMemo(()=>r.filter(t=>{var o,O;if(u.resourceType!=="ALL"&&t.type.toUpperCase()!==u.resourceType||j==="focused"&&!t.data.isFocused||$!=="all"&&t.data.focusColor!==$)return!1;if(V){if(V==="Uncategorized"){if(t.data.path&&t.data.path!=="/")return!1}else if(!((o=t.data.path)!=null&&o.startsWith(V))&&!((O=t.data.tags)!=null&&O.includes(V)))return!1}return!0}),[r,V,j,$,u.resourceType]),it=s.useMemo(()=>{const t=M*W;return ye.slice(t,t+W)},[ye,M,W]),ct=async t=>{const o=Date.now();ce&&ce.id?await ze({...ce,...t,updatedAt:o}):await ze({id:`ns-${o}-${Math.random()}`,userId:c.id,createdAt:o,updatedAt:o,...t}),oe(!1),K(),xe("Saved!","success")},dt=async t=>{const o=Date.now();_&&_.id?await Re({..._,...t,updatedAt:o}):await Re({id:`conv-${o}-${Math.random()}`,userId:c.id,createdAt:o,updatedAt:o,title:t.title||"",description:t.description||"",speakers:t.speakers||[],sentences:t.sentences||[],tags:t.tags||[]}),ie(!1),K(),xe("Saved!","success")},Ue=t=>{t.type==="card"?(de(t.data),oe(!0)):(ne(t.data),ie(!0))},ut=async()=>{R&&(R.type==="card"?await At(R.id):await Tt(R.id),ue(null),K(),xe("Deleted!","success"))},Le=async(t,o)=>{const O={...t.data,focusColor:o||void 0,updatedAt:Date.now()};o||delete O.focusColor,t.type==="card"?await ze(O):await Re(O),K()},Fe=async t=>{const o={...t.data,isFocused:!t.data.isFocused,updatedAt:Date.now()};t.type==="card"?await ze(o):await Re(o),K()},xt=t=>{ne(o=>({...o||{},title:t.title,description:t.description,speakers:t.speakers,sentences:t.sentences,tags:t.tags})),me(!1),xe("Conversation generated!","success")},_e=t=>{w(t),se("SHELF")},Ge=t=>{X(t),se("BOOK_DETAIL")},We=async()=>{const t={id:`sb-${Date.now()}`,userId:c.id,title:`${S}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#d81b60",icon:"üó£Ô∏è"};await ke(t),await K(),X(t),se("BOOK_DETAIL")},pt=t=>{m(t,async(O,x)=>{d(!0);const g=T.filter(ee=>{const fe=ee.title.split(":");return(fe.length>1?fe[0].trim():"General")===O});await Promise.all(g.map(ee=>{const fe=ee.title.split(":"),Je=fe.length>1?fe.slice(1).join(":").trim():fe[0],ht=`${x}: ${Je}`;return kt({...ee,title:ht,updatedAt:Date.now()})})),await K()})&&Z(!1)};if(be==="BOOK_DETAIL"&&D){const t=new Map(r.map(x=>[x.data.id,x])),o=D.itemIds.map(x=>{const g=t.get(x);return g?{id:x,title:g.type==="card"?g.data.standard:g.data.title,subtitle:g.type==="card"?"Expression":"Conversation",data:g,focusColor:g.data.focusColor,isFocused:g.data.isFocused}:null}).filter(x=>x!==null),O=r.map(x=>({id:x.data.id,title:x.type==="card"?x.data.standard:x.data.title,subtitle:x.type==="card"?"Expression":"Conversation",data:x}));return e.jsx(Gt,{book:D,items:o,availableItems:O,onBack:()=>{X(null),se("SHELF"),K()},onUpdateBook:async x=>{const g={...D,...x};await ke(g),X(g)},onAddItem:async x=>{const g={...D,itemIds:Array.from(new Set([...D.itemIds,...x]))};await ke(g),X(g)},onRemoveItem:async x=>{const g={...D,itemIds:D.itemIds.filter(ee=>ee!==x)};await ke(g),X(g)},onOpenItem:x=>{const g=x.data;g.type==="card"?we(g.data):n(g.data)},onEditItem:x=>Ue(x.data),onFocusChange:(x,g)=>Le(x.data,g),onToggleFocus:x=>Fe(x.data),itemIcon:e.jsx(pe,{size:16})})}return be==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>se("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(ft,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Speaking Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your speaking topics."})]}),e.jsx(qe,{shelves:h,books:T,onNavigateShelf:_e,onNavigateBook:Ge}),e.jsxs("button",{onClick:()=>J(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Ht,{size:14})," Add Shelf"]})]})]}),e.jsxs(Jt,{label:S,onNext:h.length>1?G:void 0,onPrev:h.length>1?p:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Qt,{size:14})}),e.jsx("button",{onClick:P,disabled:k.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(le,{size:14})})]}),isEmpty:k.length===0,emptyAction:e.jsx("button",{onClick:We,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[k.map(t=>{var O;const o=((O=t.title.split(":").pop())==null?void 0:O.trim())||t.title;return e.jsx(Yt,{id:t.id,title:o,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(pe,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{X(t),se("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),ge(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Xt,{size:16})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),re(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(le,{size:16})})]})},t.id)}),e.jsx("div",{className:"group translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:We,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(Ce,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(Ye,{isOpen:!!B,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(He=B==null?void 0:B.title.split(":").pop())==null?void 0:He.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:async()=>{B&&await bt(B.id),re(null),K()},onClose:()=>re(null),icon:e.jsx(le,{size:40,className:"text-red-500"})}),e.jsx(Kt,{isOpen:!!z,onClose:()=>ge(null),onConfirm:async t=>{var o;if(z){const O={...z,title:`${t}: ${(o=z.title.split(":").pop())==null?void 0:o.trim()}`};await ke(O),ge(null),K()}},shelves:h,currentShelf:z?z.title.split(":")[0].trim():"General",bookTitle:(z==null?void 0:z.title)||""}),e.jsx(qt,{isOpen:H,onClose:()=>J(!1),onSave:t=>{I(t)&&J(!1)}}),e.jsx(Dt,{isOpen:Y,onClose:()=>Z(!1),onSave:pt,initialName:S})]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{title:"Speaking Library",subtitle:"Master natural phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Microphone.png",className:"w-8 h-8 object-contain",alt:"Speaking"}),centerContent:e.jsx(qe,{shelves:h,books:T,onNavigateShelf:_e,onNavigateBook:Ge}),config:{},isLoading:y||F,isEmpty:ye.length===0,emptyMessage:"No items found.",activeFilters:{},onFilterChange:()=>{},pagination:{page:M,totalPages:Math.ceil(ye.length/W),onPageChange:U,pageSize:W,onPageSizeChange:te,totalItems:ye.length},aboveGrid:e.jsx(e.Fragment,{children:C&&e.jsx(Vt,{items:r.map(t=>t.data),selectedTag:V,onSelectTag:b,forcedView:"tags",title:"Browse Tags",icon:e.jsx(tt,{size:16})})}),minorSkills:e.jsxs("button",{onClick:()=>A==null?void 0:A("MIMIC"),className:"flex items-center gap-2 px-3 py-2 bg-neutral-100 text-neutral-600 rounded-lg text-xs font-bold hover:bg-neutral-200 transition-colors",children:[e.jsx(pe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Pronunciation"})]}),actions:e.jsx(Bt,{viewMenu:e.jsx(Wt,{isOpen:f,setIsOpen:i,filterOptions:[{label:"All",value:"ALL",isActive:u.resourceType==="ALL",onClick:()=>L("resourceType","ALL")},{label:"Card",value:"CARD",isActive:u.resourceType==="CARD",onClick:()=>L("resourceType","CARD")},{label:"Conv.",value:"CONVERSATION",isActive:u.resourceType==="CONVERSATION",onClick:()=>L("resourceType","CONVERSATION")}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(et,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>q(j==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${j==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:j==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ae($==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${$==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>ae($==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${$==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>ae($==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${$==="red"?"bg-rose-50 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Tags",checked:u.showTags,onChange:()=>E(t=>({...t,showTags:!t.showTags}))},{label:"Compact",checked:u.compact,onChange:()=>E(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:C,onToggle:()=>v(!C)},addActions:[{label:"New Card",icon:Ce,onClick:()=>{de(null),oe(!0)}},{label:"New Conversation",icon:$e,onClick:()=>{ne(null),ie(!0)}}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a([...r].sort(()=>Math.random()-.5)),disabled:r.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(vt,{size:16})}),e.jsxs("button",{onClick:()=>se("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(Zt,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:it.map(t=>t.type==="card"?e.jsx(hs,{item:t.data,viewSettings:u,onEdit:()=>Ue(t),onDelete:()=>ue({id:t.data.id,type:"card"}),onFocusChange:(o,O)=>Le(t,O),onToggleFocus:()=>Fe(t),onPractice:o=>we(o)},t.data.id):e.jsx(ot,{title:t.data.title,badge:{label:"Conversation",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:$e},tags:u.showTags?t.data.tags:void 0,compact:u.compact,onClick:()=>n(t.data),focusColor:t.data.focusColor,onFocusChange:o=>Le(t,o),isFocused:t.data.isFocused,onToggleFocus:Fe.bind(null,t),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Ue(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Ze,{size:14})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),ue({id:t.data.id,type:"conversation"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{size:14})})]}),children:e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:[t.data.sentences.length," lines"]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),n(t.data)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-indigo-200 shadow-indigo-200 active:scale-95",children:[e.jsx(Oe,{size:14})," Practice"]})]})},t.data.id))})}),e.jsx(ds,{isOpen:Te,onClose:()=>oe(!1),onSave:ct,initialData:ce}),e.jsx(us,{isOpen:he,onClose:()=>ie(!1),onSave:dt,initialData:_,onOpenAiGen:()=>me(!0)}),e.jsx(Ye,{isOpen:!!R,title:"Delete Item?",message:"This action cannot be undone.",confirmText:"Delete",isProcessing:!1,onConfirm:ut,onClose:()=>ue(null),icon:e.jsx(le,{size:40,className:"text-red-500"})}),Q&&e.jsx(Ke,{isOpen:Q,onClose:()=>ve(!1),type:"REFINE_UNIT",title:"Refine Expression",description:"Enter instructions for AI refinement.",initialData:{},onGeneratePrompt:t=>ls((je==null?void 0:je.standard)||"",t.request),onJsonReceived:t=>{t.answers&&(de(o=>({...o||{id:"",userId:c.id,createdAt:0,updatedAt:0,standard:"",answers:[],tags:[],note:""},standard:t.standard,answers:t.answers})),ve(!1),xe("Refined!","success"))},actionLabel:"Apply"}),Ie&&e.jsx(Ke,{isOpen:Ie,onClose:()=>me(!1),type:"GENERATE_UNIT",title:"AI Conversation Creator",description:"Enter a topic to generate a dialogue.",initialData:{},onGeneratePrompt:t=>os(t.request),onJsonReceived:xt,actionLabel:"Generate",closeOnSuccess:!0}),e.jsx(xs,{isOpen:!!Ee,onClose:()=>we(null),item:Ee}),e.jsx(ps,{isOpen:!!Me,onClose:()=>n(null),item:Me})]})};export{Es as SpeakingCardPage,Es as default};
