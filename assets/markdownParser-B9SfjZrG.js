import{r as f,j as c,aY as k,X as y,s as j,b5 as $,_ as M}from"./index-D8XBKDkm.js";import{S as v}from"./square-check-big-Td1wNTeG.js";const B=({isOpen:l,onClose:r,onSelect:a,allWords:t,wordsToExclude:i,loading:e})=>{const[n,s]=f.useState(""),[o,h]=f.useState(new Set),g=f.useMemo(()=>{if(!n)return t;const d=n.toLowerCase();return t.filter(p=>p.word.toLowerCase().includes(d))},[t,n]),x=d=>{h(p=>{const u=new Set(p);return u.has(d)?u.delete(d):u.add(d),u})},m=()=>{a(Array.from(o)),r()};return l?c.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm animate-in fade-in duration-200",children:c.jsxs("div",{className:"bg-neutral-50 w-full max-w-lg rounded-[2rem] shadow-2xl border border-neutral-200 flex flex-col h-[70vh]",children:[c.jsxs("header",{className:"p-4 border-b border-neutral-200 flex justify-between items-center shrink-0",children:[c.jsxs("div",{className:"relative flex-1",children:[c.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),c.jsx("input",{type:"text",value:n,onChange:d=>s(d.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-4 py-2 bg-white border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900",autoFocus:!0})]}),c.jsx("button",{onClick:r,className:"p-2 ml-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:c.jsx(y,{size:16})})]}),c.jsx("main",{className:"flex-1 overflow-y-auto p-2",children:e?c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsx(j,{size:24,className:"animate-spin text-neutral-300"})}):c.jsx("div",{className:"flex flex-col gap-1",children:g.map(d=>{const p=o.has(d.word),u=i.has(d.word);return c.jsxs("button",{onClick:()=>!u&&x(d.word),disabled:u,className:`flex items-center justify-between p-3 rounded-lg text-left transition-colors ${u?"bg-neutral-100 opacity-50 cursor-not-allowed":p?"bg-indigo-50 text-indigo-800":"hover:bg-neutral-100"}`,children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"font-bold text-sm",children:d.word}),c.jsx("span",{className:"text-xs text-neutral-500",children:d.meaningVi})]}),u?c.jsx(v,{size:18,className:"text-neutral-400"}):p?c.jsx(v,{size:18,className:"text-indigo-600"}):c.jsx($,{size:18,className:"text-neutral-300"})]},d.id)})})}),c.jsxs("footer",{className:"p-4 border-t border-neutral-200 flex justify-end gap-3 shrink-0 bg-white/50 backdrop-blur-sm",children:[c.jsx("button",{onClick:r,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs hover:bg-neutral-200 transition-all",children:"Cancel"}),c.jsxs("button",{onClick:m,disabled:o.size===0,className:"px-5 py-2.5 bg-neutral-900 text-white rounded-lg font-black text-xs flex items-center space-x-2 hover:bg-neutral-800 transition-all disabled:opacity-50",children:[c.jsx(M,{size:14}),c.jsxs("span",{children:["Add (",o.size,")"]})]})]})]})}):null};typeof window<"u"&&(window.checkMarkdownQuiz=l=>{const r=l.getAttribute("data-answer");if(!r)return;const t=l.value.trim().toLowerCase()===r.trim().toLowerCase();l.classList.remove("border-neutral-300","text-neutral-900","focus:border-indigo-600"),l.classList.remove("border-green-500","text-green-700","bg-green-50"),l.classList.remove("border-red-500","text-red-700","bg-red-50"),t?l.classList.add("border-green-500","text-green-700","bg-green-50"):l.classList.add("border-red-500","text-red-700","bg-red-50")},window.checkDropdownQuiz=l=>{const r=l.parentElement;if(!r)return;const a=r.querySelector("select");if(!a)return;const t=a.getAttribute("data-answer"),i=a.value;if(!i)return;const e=i===t;if(a.disabled=!0,l.disabled=!0,l.classList.add("opacity-0","pointer-events-none"),a.classList.remove("border-neutral-300","text-neutral-900","focus:border-indigo-600"),a.classList.remove("bg-white"),e)a.classList.add("border-green-500","text-green-700","bg-green-50","font-bold");else{a.classList.add("border-red-500","text-red-700","bg-red-50","line-through");const n=document.createElement("span");n.className="ml-2 text-xs font-bold text-green-600 bg-green-50 px-1.5 py-0.5 rounded border border-green-200 animate-in fade-in",n.innerText=t||"",r.appendChild(n)}},window.checkMultiChoice=l=>{var e;const r=l.parentElement;if(!r)return;const a=r.getAttribute("data-answer"),t=(e=l.textContent)==null?void 0:e.trim();r.querySelectorAll("button").forEach(n=>{var s;n.disabled=!0,n.classList.add("opacity-50","cursor-not-allowed"),((s=n.textContent)==null?void 0:s.trim())===a&&(n.classList.remove("bg-white","text-neutral-700","opacity-50"),n.classList.add("bg-green-500","text-white","border-green-600"))}),t===a?(l.classList.remove("opacity-50"),l.classList.add("ring-2","ring-green-300")):(l.classList.remove("bg-white","text-neutral-700","opacity-50"),l.classList.add("bg-red-500","text-white","border-red-600"))});const C=l=>{if(!l[0].trim().startsWith("|"))return null;const r=[];for(const o of l)if(o.trim().startsWith("|"))r.push(o);else break;if(r.length===0)return null;const a=o=>{const h=o.split("|");return o.trim().startsWith("|")&&h.shift(),o.trim().endsWith("|")&&h.pop(),h.map(g=>g.trim())},t=/^\|?(\s*:?-+:?\s*\|)+\s*$/;let i=!1;r.length>1&&t.test(r[1].trim())&&(i=!0);let e='<div class="overflow-x-auto my-4 border border-neutral-200 rounded-xl shadow-sm"><table class="w-full text-sm text-left border-collapse">';const n=a(r[0]);e+='<thead class="bg-neutral-50 text-neutral-900 uppercase font-bold text-xs"><tr>',n.forEach(o=>e+=`<th class="px-6 py-3 border-b border-neutral-200 min-w-[100px]">${o}</th>`),e+="</tr></thead>",e+='<tbody class="divide-y divide-neutral-100 bg-white">';const s=i?2:1;for(let o=s;o<r.length;o++){const h=a(r[o]);e+='<tr class="hover:bg-neutral-50/50 transition-colors">';for(let g=0;g<n.length;g++){const x=h[g]||"";e+=`<td class="px-6 py-4 font-medium text-neutral-600 align-top">${x}</td>`}e+="</tr>"}return e+="</tbody></table></div>",{html:e,consumed:r.length}},L=l=>l.replace(/\[HIDDEN:\s*(.*?)\]/gi,(r,a)=>`<button type="button" onclick="this.outerHTML='<span class=\\'px-1.5 py-0.5 bg-green-50 border border-green-200 text-green-800 rounded-md text-sm font-bold animate-in fade-in zoom-in-95 inline-block align-baseline mx-1\\'>${a.trim().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"\\'")}</span>'" class="inline-flex flex-nowrap whitespace-nowrap items-center gap-1.5 px-2 py-0.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 rounded-md text-[10px] font-black uppercase tracking-wider transition-colors select-none border border-indigo-100 shadow-sm align-middle my-0.5 mx-1"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="shrink-0"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>Reveal</button>`),N=l=>l.replace(/\[Quiz:\s*(.*?)\]/gi,(r,a)=>{const t=a.trim(),i=Math.max(3,t.length);return`<span class="inline-flex items-center gap-1 align-middle mx-1 whitespace-nowrap"><input type="text" data-answer="${t.replace(/"/g,"&quot;")}" placeholder="?" class="border-b-2 border-neutral-300 bg-transparent text-center font-bold text-neutral-900 outline-none focus:border-indigo-600 transition-all rounded-t-md px-1 py-0.5 text-sm" style="width: ${i}ch; min-width: 40px;" onkeydown="if(event.key==='Enter') window.checkMarkdownQuiz(this)" /><button onclick="window.checkMarkdownQuiz(this.previousElementSibling)" class="p-1 text-neutral-400 hover:text-indigo-600 transition-colors bg-neutral-100 hover:bg-indigo-50 rounded-full shadow-sm" title="Check Answer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg></button></span>`}),S=l=>l.replace(/\[Select:\s*(.*?)\]/gi,(r,a)=>{const t=a.split("|").map(s=>s.trim()).filter(s=>s.length>0);if(t.length<2)return`[Invalid Select: ${a}]`;const i=t[0],e=[...t];for(let s=e.length-1;s>0;s--){const o=Math.floor(Math.random()*(s+1));[e[s],e[o]]=[e[o],e[s]]}let n='<span class="inline-flex items-center gap-1 align-middle mx-1 whitespace-nowrap">';return n+=`<select data-answer="${i.replace(/"/g,"&quot;")}" class="border-b-2 border-neutral-300 bg-transparent font-bold text-neutral-900 outline-none focus:border-indigo-600 transition-all rounded-t-md px-2 py-0.5 text-sm cursor-pointer hover:bg-neutral-50 appearance-none pr-6 relative" style="min-width: 80px;">`,n+='<option value="" disabled selected>Select...</option>',e.forEach(s=>{n+=`<option value="${s.replace(/"/g,"&quot;")}">${s}</option>`}),n+="</select>",n+='<button onclick="window.checkDropdownQuiz(this)" class="p-1 text-neutral-400 hover:text-indigo-600 transition-colors bg-neutral-100 hover:bg-indigo-50 rounded-full shadow-sm" title="Check Answer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg></button>',n+="</span>",n}),z=l=>l.replace(/\[Multi:\s*(.*?)\]/gi,(r,a)=>{const t=a.split("|").map(s=>s.trim()).filter(s=>s.length>0);if(t.length<2)return`[Invalid Multi: ${a}]`;const i=t[0],e=[...t];for(let s=e.length-1;s>0;s--){const o=Math.floor(Math.random()*(s+1));[e[s],e[o]]=[e[o],e[s]]}let n=`<span class="inline-flex flex-wrap items-center gap-1.5 align-middle mx-1" data-answer="${i.replace(/"/g,"&quot;")}">`;return e.forEach(s=>{n+=`<button onclick="window.checkMultiChoice(this)" class="px-2 py-1 bg-white border border-neutral-200 text-neutral-700 rounded-md text-xs font-bold hover:bg-neutral-50 hover:border-neutral-300 transition-all shadow-sm select-none">${s}</button>`}),n+="</span>",n}),A=l=>{const r=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/g;return l.replace(r,(a,t,i)=>`<button onclick="window.handleLessonSpeak('${i.replace(/\[HIDDEN:.*?\]/gi,"").replace(/\[Quiz:.*?\]/gi,"").replace(/\[Select:.*?\]/gi,"").replace(/\[Multi:.*?\]/gi,"").replace(/[#*`_~[\]()]/g,"").replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu,"").replace(/\n/g," ").trim().replace(/'/g,"\\'")}')" class="inline-flex items-center justify-center w-6 h-6 mr-1.5 bg-indigo-600 text-white hover:bg-indigo-700 rounded-md transition-all active:scale-90 align-middle shadow-sm" title="Listen"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>`+i.trim())},q=l=>{if(!l)return"";let r=A(l);r=N(r),r=S(r),r=z(r),r=L(r);const a=r.split(`
`),t=[],i=[],e=(n=0)=>{for(;i.length>n;){const s=i.pop();t.push(s.type==="ul"?"</ul>":"</ol>")}};for(let n=0;n<a.length;n++){const s=a[n],o=s.trim();if(!o&&i.length===0){t.push('<br class="block my-2" />');continue}const h=C(a.slice(n));if(h){e(0),t.push(h.html),n+=h.consumed-1;continue}if(/^([-*_])\s*(\1\s*){2,}$/.test(o)){e(0),t.push('<hr class="my-6 border-t-2 border-neutral-100" />');continue}if(o.startsWith("# ")){e(0),t.push(`<h1 class="text-3xl font-black text-neutral-900 mb-4 mt-8 pb-2 border-b border-neutral-100 leading-tight">${o.substring(2)}</h1>`);continue}if(o.startsWith("## ")){e(0),t.push(`<h2 class="text-xl font-extrabold text-neutral-800 mb-3 mt-6 leading-tight">${o.substring(3)}</h2>`);continue}if(o.startsWith("### ")){e(0),t.push(`<h3 class="text-lg font-bold text-neutral-700 mb-2 mt-4 leading-tight">${o.substring(4)}</h3>`);continue}if(o.startsWith("> ")){e(0),t.push(`<blockquote class="border-l-4 border-amber-400 bg-amber-50 pl-4 py-3 pr-2 my-4 rounded-r-lg text-sm text-neutral-700 font-medium italic shadow-sm">${o.substring(2)}</blockquote>`);continue}const g=o.match(/^\[(?!(HIDDEN:|Quiz:|Select:|QUIZ:|Multi:|Audio-|(\/\])))(.*)\]$/);if(g){e(0);const u='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 mt-0.5 text-sky-500"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',b=g[3].trim();t.push(`
                <div class="flex items-start gap-3 my-4 p-4 bg-sky-50 border-l-4 border-sky-400 rounded-r-lg shadow-sm">
                    ${u}
                    <div class="text-sm text-sky-900 font-medium leading-relaxed">
                        ${b}
                    </div>
                </div>
            `);continue}const x=s.match(/^(\s*)/),m=x?x[0].length:0,d=s.match(/^\s*[-*]\s+(.*)/),p=s.match(/^\s*(\d+)\.\s+(.*)/);if(d||p){const u=d?"ul":"ol",b=d?d[1]:p[2],w=p?p[1]:void 0;if(i.length===0||m>i[i.length-1].indent)t.push(u==="ul"?'<ul class="list-disc list-outside pl-5 my-3 space-y-1 text-neutral-700 marker:text-neutral-400">':'<ol class="list-decimal list-outside pl-5 my-3 space-y-1 text-neutral-700 marker:font-bold marker:text-neutral-500">'),i.push({type:u,indent:m});else if(m<i[i.length-1].indent)for(;i.length>0&&m<i[i.length-1].indent;)e(i.length-1);u==="ol"&&w?t.push(`<li value="${w}" class="pl-1">${b}</li>`):t.push(`<li class="pl-1">${b}</li>`);continue}o!==""&&(e(0),t.push(`<p class="mb-2 leading-relaxed text-neutral-600">${s}</p>`))}return e(0),t.join("").replace(/!\[(.*?)\]\((.*?)\)/g,'<img alt="$1" src="$2" class="max-w-full h-auto rounded-lg my-4 shadow-md border border-neutral-200" />').replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-indigo-600 font-bold hover:underline">$1</a>').replace(/\*\*(.*?)\*\*/g,'<strong class="font-black text-neutral-900">$1</strong>').replace(/\*(.*?)\*/g,'<span class="italic font-normal text-inherit">$1</span>').replace(/`([^`]+)`/g,'<code class="bg-neutral-100 text-pink-600 px-1.5 py-0.5 rounded text-xs font-mono font-bold border border-neutral-200">$1</code>')};export{B as W,q as p};
