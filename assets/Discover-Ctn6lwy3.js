import{c as te,j as e,r as l,P as Ke,K as Te,ba as we,Z as J,Y as ue,m as Ne,bb as ke,n as Se,U as Fe,a3 as ge,bc as Xe,bd as Qe,a0 as Ze,H as je,a5 as qe,at as Je,be as de,bf as ze,y as _e,J as le,b2 as Ce,R as Re,X as me,k as et,am as ne,V as De,N as xe,E as be,C as tt,a$ as st,b1 as at,h as Pe,d as $e,aU as Le,T as lt,bg as rt,b6 as nt,bh as it,o as ot,aN as ct,ae as dt}from"./index-KV-c42MW.js";import{C as xt,S as ye,A as mt,T as ut,L as ht}from"./AvatarSelectionModal-DiJqzqNJ.js";import{T as Oe}from"./trophy-BwywcMHk.js";import{C as He}from"./chevron-left-BBkM57BI.js";import{B as Ie,K as ft}from"./keyboard-CqAnRsMS.js";import{S as pt}from"./split-nM0cPUDL.js";import{L as gt}from"./layout-grid-ouIs2BZW.js";import{C as bt,L as jt}from"./list-filter-e0C1S9dK.js";import{S as vt}from"./square-check-big-CsDZjaCI.js";import{S as wt}from"./server-CsRrk_Wf.js";import"./palette-2Bm4rc1r.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=te("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=te("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=te("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=te("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=te("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=te("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=te("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=te("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),Ge=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],St=s=>{let f="Novice Soul";for(const z of Ge)if(s>=z.level)f=z.title;else break;return f},Ct=s=>s>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:s>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:s>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:s>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},It=({user:s,xpToNextLevel:f,onUpdateUser:z,isRecalculatingXp:M})=>{const[N,A]=l.useState(!1),V=f>0?Math.min(100,Math.max(0,s.experience/f*100)):0,w=s.peakLevel||s.level,O=w>0?Math.min(100,Math.max(0,s.level/w*100)):100,E=Ct(s.level),P=s.adventure,R=St(s.level),D=Ge.find(F=>F.level>s.level),H=async F=>{await z({...s,avatar:F}),A(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>A(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${E.frame} shadow-md ${E.shadow}`,children:[e.jsx("img",{src:s.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ke,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:s.name}),M&&e.jsx(Te,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(xt,{size:12,className:"text-yellow-500"})," ",R]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",s.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[s.experience," / ",f," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${V}%`}})})]}),w>s.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[s.level," / ",w," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${O}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(we,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:(P==null?void 0:P.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(Ue,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[(P==null?void 0:P.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(J,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:(P==null?void 0:P.energy)??0})]})]}),D&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",D.level," for: ",e.jsx("strong",{children:D.title})]}),e.jsx(ye,{size:12,className:"text-amber-400"})]})]})]}),e.jsx(mt,{isOpen:N,onClose:()=>A(!1),onSelectAvatar:H,currentUser:s})]})},zt=({user:s,xpToNextLevel:f,onUpdateUser:z,isRecalculatingXp:M,children:N})=>e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(It,{user:s,xpToNextLevel:f,onUpdateUser:z,isRecalculatingXp:M})}),e.jsx("div",{className:"flex-1 min-h-0 relative",children:N})]}),q={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},Mt=s=>{var f,z;switch(s.type){case"boss":return s.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((f=s.boss_details)==null?void 0:f.image)||"üëπ",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(Se,{size:10,className:"text-white"})})]}):((z=s.boss_details)==null?void 0:z.image)||"üëπ";case"treasure":return"üëë";case"key_fragment":return"üóùÔ∏è";default:return"‚òÖ"}},Et=s=>s>=50?4:s>=25?3:s>=10?2:1,At=({user:s})=>{const f=Et(s.peakLevel||1),z=f===1?"shadow-indigo-500/50":f===2?"shadow-cyan-500/60":f===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:q.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:s.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${z}`,children:["Lvl ",s.peakLevel||1]})]})},Tt=({isOpen:s,onClose:f,defeatedBosses:z})=>s?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(Oe,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:f,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ue,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:z.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(We,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map(M=>{var N,A;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(Se,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(N=M.boss_details)==null?void 0:N.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(A=M.boss_details)==null?void 0:A.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",M.id+1]})]},M.id)})})})]})}):null,Ft=({user:s,progress:f,onExit:z,map:M,onMove:N,onNodeClick:A,onOpenInventory:V,onAdminAction:w})=>{const E=M.length,P=5,[R,D]=l.useState(0),[H,F]=l.useState(!1),$=Math.min(E-6,f.currentNodeIndex),L=M.filter(p=>p.type==="boss"&&p.isDefeated);l.useEffect(()=>{i()},[f.currentNodeIndex]);const i=()=>{let p=f.currentNodeIndex-Math.floor(3);p<0&&(p=0),p>$&&(p=$),D(p)},r=p=>{D(b=>{let h=p==="left"?b-1:b+1;return h<0&&(h=0),h>$&&(h=$),h})},C=E/6*100,T=-(R*(100/E)),W=T*.3,U=50/E,d=M[f.currentNodeIndex],y=(d==null?void 0:d.type)==="boss"&&!(d!=null&&d.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${C}%`,transform:`translateX(${W}%)`},children:[e.jsx("img",{src:q.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:q.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:q.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"üåÄ"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"üåö"}),e.jsx("img",{src:q.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:q.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:q.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:q.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:q.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"üåÄ"}),e.jsx("img",{src:q.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"üåö"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(J,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[f.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(we,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:f.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ue,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[f.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>F(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(Oe,{size:18}),L.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:i,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(yt,{size:18})}),e.jsx("button",{onClick:V,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(Be,{size:18})}),e.jsx("button",{onClick:z,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(ue,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>r("left"),disabled:R===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(He,{size:32})}),e.jsx("button",{onClick:()=>r("right"),disabled:R>=$,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(Ne,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${C}%`,transform:`translateX(${T}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${U}%`,right:`${U}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${f.currentNodeIndex/(E-1)*100}%`}})})}),M.map((p,b)=>{if(b>f.currentNodeIndex+P)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/E}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},p.id);const t=b===f.currentNodeIndex,m=b<f.currentNodeIndex,o=p.type==="boss",a=p.isDefeated;let j="w-16 h-16",u="bg-slate-800 border-slate-600 text-slate-500 cursor-default",v="",n="scale(1)";return t?(u="bg-slate-700 border-slate-500 text-slate-300",v="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):m&&(u="bg-emerald-900/80 border-emerald-500 text-emerald-400",v="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),o&&(j="w-24 h-24",a?(u="bg-slate-800 border-slate-600 text-slate-500",t&&(u="bg-slate-700 border-slate-500 text-slate-400")):(u="bg-red-950 border-red-600 text-red-500 cursor-pointer",v="shadow-[0_0_20px_rgba(220,38,38,0.4)]",t&&(u="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",n="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/E}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[t&&e.jsx(At,{user:s}),t&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>A(p),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${j} ${u} ${v}`,style:{transform:n},children:[e.jsx("span",{className:"text-3xl font-black",children:Mt(p)}),o&&t&&!a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(ke,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!t&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${m?"text-emerald-500":"text-slate-600"}`,children:b+1})]})},p.id)})]})})]}),s.isAdmin&&w&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(ut,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>w("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(J,{size:12})," +10"]}),e.jsx("button",{onClick:()=>w("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>w("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(we,{size:12})," +1"]}),e.jsx("button",{onClick:()=>w("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>w("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"üß™+"}),e.jsx("button",{onClick:()=>w("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>w("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"üçé+"}),e.jsx("button",{onClick:()=>w("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>w("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(Se,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",f.currentNodeIndex+1," / ",M.length]}),e.jsxs("button",{onClick:N,disabled:f.energy<=0||y,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(Fe,{size:18})]})]}),e.jsx(Tt,{isOpen:H,onClose:()=>F(!1),defeatedBosses:L})]})},oe=5,_t=({user:s,boss:f,words:z,onVictory:M,onDefeat:N,onExit:A,onUpdateUser:V})=>{const{showToast:w}=ge(),[O,E]=l.useState(f.hp),[P,R]=l.useState(oe),[D,H]=l.useState(0),[F,$]=l.useState("idle"),[L,i]=l.useState("none"),[r,C]=l.useState("intro"),[T,W]=l.useState(600),[U,d]=l.useState(!1),[y,p]=l.useState(!1),b=l.useMemo(()=>[...z].sort(()=>Math.random()-.5),[z]),h=b[D%b.length];l.useEffect(()=>{if(r==="fighting"){const n=setInterval(()=>{W(I=>I<=1?(clearInterval(n),C("lost"),0):I-1)},1e3);return()=>clearInterval(n)}},[r]),l.useEffect(()=>{p(!1)},[D]);const t=async n=>{const I=n!==je.FORGOT;C("animating"),I?($("player-attacking"),setTimeout(()=>{$("idle"),i("boss-hit"),E(x=>Math.max(0,x-1)),setTimeout(()=>{i("none"),m()},800)},600)):($("boss-attacking"),setTimeout(()=>{$("idle"),i("player-hit"),R(x=>Math.max(0,x-1)),setTimeout(()=>{i("none"),m()},800)},600));const Y=I?je.EASY:je.FORGOT,c=qe(h,Y);c.lastReviewSessionType="boss_battle",await Je(c)},m=n=>{E(I=>(R(Y=>(I<=0?C("won"):Y<=0?C("lost"):(H(c=>c+1),C("fighting")),Y)),I))},o=n=>{const I=Math.floor(n/60),Y=n%60;return`${I}:${Y.toString().padStart(2,"0")}`},a=n=>{var I,Y;return!(n.type==="SPELLING"||n.type==="COLLOCATION_QUIZ"&&(((I=n.word.collocationsArray)==null?void 0:I.filter(x=>!x.isIgnored&&x.d))||[]).length>2||n.type==="PARAPHRASE_QUIZ"&&(((Y=n.word.paraphrases)==null?void 0:Y.filter(x=>!x.isIgnored))||[]).length>2)},j=async()=>{if((s.adventure.hpPotions||0)<=0)return;if(P>=oe){w("Health is already full!","info");return}R(I=>Math.min(oe,I+1));const n={...s.adventure};n.hpPotions=(n.hpPotions||0)-1,await V({...s,adventure:n}),w("+1 HP Recovered!","success")},u=async()=>{if((s.adventure.wisdomFruits||0)<=0)return;if(y){w("Hint is already active!","info");return}p(!0);const n={...s.adventure};n.wisdomFruits=(n.wisdomFruits||0)-1,await V({...s,adventure:n}),w("Wisdom Fruit Used! Hint revealed.","success")},v=(s.adventure.hpPotions||0)>0||(s.adventure.wisdomFruits||0)>0;if(r==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:f.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:f.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',f.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>C("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(ke,{size:24})," FIGHT!"]})]});if(r==="won"||r==="lost"){const n=r==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${n?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!n&&"grayscale opacity-50"}`,children:n?"üèÜ":"üíÄ"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${n?"text-emerald-400":"text-red-500"}`,children:n?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:n?`"${f.dialogueWin}"`:`"${f.dialogueLose}"`}),e.jsx("button",{onClick:n?M:N,className:`px-8 py-3 font-bold rounded-xl transition-all ${n?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:n?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:f.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${O/f.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(Me,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[O," / ",f.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${L==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:f.image}),L==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"üí•"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-hidden",children:[F==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(kt,{className:"fill-cyan-400 rotate-45",size:48})}),F==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(We,{className:"fill-red-900",size:48})}),e.jsxs("div",{className:`absolute top-4 right-4 flex items-center gap-2 px-4 py-2 rounded-xl font-mono font-black border-2 backdrop-blur-md z-20 transition-all duration-300 ${T<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(Xe,{size:18,className:T<60?"animate-spin":""}),e.jsx("span",{className:"text-lg tracking-widest",children:o(T)})]}),e.jsx("button",{onClick:()=>d(!U),className:`absolute top-4 left-4 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 z-20 group ${U?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{size:24}),v&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),U&&e.jsxs("div",{className:"absolute top-16 left-4 z-40 bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-left-4 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üß™"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:j,disabled:(s.adventure.hpPotions||0)<=0||P>=oe,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üçé"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:u,disabled:(s.adventure.wisdomFruits||0)<=0||y,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]}),r==="fighting"&&h?e.jsx("div",{className:"w-full max-w-md h-full max-h-[420px] z-10 animate-in zoom-in-95 duration-300 flex items-center",children:e.jsx(Ze,{word:h,isQuickFire:!0,onComplete:t,onClose:A,isModal:!1,disableHints:!y,forceShowHint:y,challengeFilter:a,skipRecap:!0})}):r==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[L==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"üí•"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${L==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:s.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:oe}).map((n,I)=>e.jsx(Me,{size:18,fill:I<P?"#ef4444":"none",className:`transition-all duration-300 ${I<P?"text-red-500 scale-100":"text-slate-600 scale-90"}`},I))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `})]})},Rt=({isOpen:s,onClose:f,badges:z,hpPotions:M,wisdomFruits:N,onUseBadge:A})=>{if(!s)return null;const V=new Set(z.filter(O=>O!=="locked_chest")).size,w=Object.keys(de).filter(O=>O!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(Be,{size:20})," T√∫i ƒë·ªì"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"V·∫≠t ph·∫©m & Huy hi·ªáu thu th·∫≠p ƒë∆∞·ª£c."})]}),e.jsx("button",{type:"button",onClick:f,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ue,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(ke,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üß™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",M]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üçé"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",N]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(J,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[V,"/",w]})]}),z.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Ch∆∞a c√≥ huy hi·ªáu."}),e.jsx("p",{className:"text-xs",children:"M·ªü R∆∞∆°ng ho·∫∑c ƒë√°nh Boss ƒë·ªÉ nh·∫≠n."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:z.map((O,E)=>{const P=de[O];if(!P)return null;const R=O==="locked_chest"||O==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:P.icon}),R&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:P.name}),R&&e.jsxs("button",{onClick:()=>A(O),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(Nt,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${O}-${E}`)})})]})]})]})})},Dt=30,Pt=({onComplete:s,badge:f})=>{const[z]=l.useState(()=>Array.from({length:Dt}).map((M,N)=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return f?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:z.map((M,N)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${M.size}px`,height:`${M.size}px`,backgroundColor:M.color,transform:`rotate(${M.angle}deg) translate(${M.distance}px)`,opacity:0,animation:`explode ${M.duration}s ease-out ${M.delay}s forwards`}},N))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:f.icon}),e.jsx(ye,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx(ye,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:f.name})]}),e.jsx("button",{onClick:s,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(ue,{size:16})]})})]})]}):null},ve=({user:s,onExit:f,onUpdateUser:z,onStartSession:M})=>{const{showToast:N}=ge(),[A,V]=l.useState(null),[w,O]=l.useState(!1),[E,P]=l.useState(null);l.useEffect(()=>{if(!s.adventure.map){const i=ze(100);z({...s,adventure:{...s.adventure,map:i}})}},[]);const R=s.adventure.map||ze(100),D=async()=>{const i={...s.adventure};if(i.energy<=0){N("Not enough energy to move!","error");return}i.energy-=1;const r=i.currentNodeIndex+1;i.currentNodeIndex=r;const C=R[r];C&&(C.type==="standard"?(i.energyShards=(i.energyShards||0)+1,N("+1 Energy Shard ‚ö°","success",2e3)):C.type==="key_fragment"?(i.keyFragments=(i.keyFragments||0)+1,N("Picked up a Key Fragment üóùÔ∏è","success",3e3),i.keyFragments>=3&&(i.keyFragments-=3,i.keys=(i.keys||0)+1,N("‚ú® Key Fragments assembled into a Magic Key!","success",4e3))):C.type==="treasure"&&(i.badges=[...i.badges||[],"locked_chest"],N("Picked up a Locked Chest! üß∞ (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(i.hpPotions=(i.hpPotions||0)+1,N("You found an HP Potion! üß™","success",4e3)):(i.wisdomFruits=(i.wisdomFruits||0)+1,N("You found a Wisdom Fruit! üçé","success",4e3))),Math.random()<.2&&(i.badges=[...i.badges||[],"lucky_dice"],N("You found a Lucky Dice! üé≤","success",4e3)),await z({...s,adventure:i})},H=async i=>{if(i.id===s.adventure.currentNodeIndex&&i.type==="boss"){if(i.isDefeated){N("This boss has already been defeated.","info");return}const r=_e().filter(U=>U.userId===s.id);if(r.length===0){N("You have no words in your library to fight a boss. Add some words first!","error");return}const C=r.filter(U=>U.lastReview);C.length<20&&N("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let T=[...C].sort(()=>.5-Math.random());if(T.length<20){const U=new Set(T.map(p=>p.id)),d=r.filter(p=>!U.has(p.id)),y=20-T.length;T.push(...[...d].sort(()=>.5-Math.random()).slice(0,y))}T=T.slice(0,20);const W={...i.boss_details,hp:20};V({boss:W,words:T})}},F=async()=>{N("Boss defeated! +1 Key Fragment","success");const i={...s.adventure};if(i.keyFragments=(i.keyFragments||0)+1,i.keyFragments>=3&&(i.keyFragments-=3,i.keys=(i.keys||0)+1,N("Key Fragments assembled into a Magic Key!","success",4e3)),i.map){const r=[...i.map],C=i.currentNodeIndex;r[C]&&(r[C]={...r[C],isDefeated:!0}),i.map=r}await z({...s,adventure:i}),V(null)},$=async i=>{const r={...s.adventure};if(r.badges=r.badges||[],i==="locked_chest"){if((r.keys||0)<=0){N("You need a Magic Key üóùÔ∏è to open this chest!","error");return}r.keys-=1;const C=r.badges.indexOf("locked_chest");C>-1&&r.badges.splice(C,1);const T=Object.keys(de).filter(y=>y!=="locked_chest"&&y!=="lucky_dice"),W=r.badges||[],U=T.filter(y=>!W.includes(y));let d;U.length>0?d=U[Math.floor(Math.random()*U.length)]:d=T[Math.floor(Math.random()*T.length)],r.badges.push(d),await z({...s,adventure:r}),P(de[d]),O(!1)}else if(i==="lucky_dice"){const C=r.badges.indexOf("lucky_dice");if(C>-1)r.badges.splice(C,1);else return;const T=Math.random();T<.2?(r.energy+=3,N("Dice rolled! +3 Energy ‚ö°","success",3e3)):T<.4?(r.keys=(r.keys||0)+1,N("Dice rolled! +1 Magic Key üóùÔ∏è","success",3e3)):T<.6?(r.badges.push("locked_chest"),N("Dice rolled! +1 Locked Chest üß∞","success",3e3)):T<.8?(r.hpPotions=(r.hpPotions||0)+1,N("Dice rolled! +1 HP Potion üß™","success",3e3)):(r.wisdomFruits=(r.wisdomFruits||0)+1,N("Dice rolled! +1 Wisdom Fruit üçé","success",3e3)),await z({...s,adventure:r})}else P(de[i])},L=async i=>{const r={...s.adventure};if(i==="add_energy")r.energy=(r.energy||0)+10,N("Admin: +10 Energy","success");else if(i==="remove_energy")r.energy=Math.max(0,(r.energy||0)-1),N("Admin: -1 Energy","info");else if(i==="add_key")r.keys=(r.keys||0)+1,N("Admin: +1 Key","success");else if(i==="remove_key")r.keys=Math.max(0,(r.keys||0)-1),N("Admin: -1 Key","info");else if(i==="add_hp")r.hpPotions=(r.hpPotions||0)+1,N("Admin: +1 HP Potion","success");else if(i==="remove_hp")r.hpPotions=Math.max(0,(r.hpPotions||0)-1),N("Admin: -1 HP Potion","info");else if(i==="add_fruit")r.wisdomFruits=(r.wisdomFruits||0)+1,N("Admin: +1 Wisdom Fruit","success");else if(i==="remove_fruit")r.wisdomFruits=Math.max(0,(r.wisdomFruits||0)-1),N("Admin: -1 Wisdom Fruit","info");else if(i==="pass_boss"){const C=R[r.currentNodeIndex];if(C&&C.type==="boss"){if(A){await F();return}if(N("Admin: Force Boss Victory","success"),r.keyFragments=(r.keyFragments||0)+1,r.keyFragments>=3&&(r.keyFragments-=3,r.keys=(r.keys||0)+1),r.map){const T=[...r.map],W=r.currentNodeIndex;T[W]&&(T[W]={...T[W],isDefeated:!0}),r.map=T}}else N("Not currently at a boss node.","info")}await z({...s,adventure:r})};return A?e.jsx(_t,{user:s,boss:A.boss,words:A.words,onVictory:F,onDefeat:()=>{N("You were defeated. Study more and try again!","error"),V(null)},onExit:()=>V(null),onUpdateUser:z}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{user:s,progress:s.adventure,onExit:f,map:R,onMove:D,onNodeClick:H,onOpenInventory:()=>O(!0),onAdminAction:L}),e.jsx(Rt,{isOpen:w,onClose:()=>O(!1),badges:s.adventure.badges||[],onUseBadge:$,hpPotions:s.adventure.hpPotions||0,wisdomFruits:s.adventure.wisdomFruits||0}),E&&e.jsx(Pt,{badge:E,onComplete:()=>P(null)})]})},fe=[{id:"i_ii",sym1:"…™",sym2:"iÀê",label:"Short i vs Long ee",example:"sit / seat",category:"VOWELS"},{id:"u_uu",sym1:" ä",sym2:"uÀê",label:"Short u vs Long oo",example:"full / fool",category:"VOWELS"},{id:"ae_e",sym1:"√¶",sym2:"e",label:"Short a vs Short e",example:"man / men",category:"VOWELS"},{id:"ae_v",sym1:"√¶",sym2:" å",label:"Short a vs Short u",example:"cat / cut",category:"VOWELS"},{id:"o_or",sym1:"…í",sym2:"…îÀê",label:"Short o vs Long aw",example:"cot / caught",category:"VOWELS"},{id:"er_or",sym1:"…úÀê",sym2:"…îÀê",label:"Stressed er vs aw",example:"bird / board",category:"VOWELS"},{id:"aa_ae",sym1:"…ëÀê",sym2:"√¶",label:"Long a vs Short a",example:"cart / cat",category:"VOWELS"},{id:"th_t",sym1:"Œ∏",sym2:"t",label:"Voiceless TH vs T",example:"think / tin",category:"CONSONANTS"},{id:"dh_d",sym1:"√∞",sym2:"d",label:"Voiced TH vs D",example:"this / dis",category:"CONSONANTS"},{id:"s_sh",sym1:"s",sym2:" É",label:"S vs SH",example:"see / she",category:"CONSONANTS"},{id:"ch_j",sym1:"t É",sym2:"d í",label:"CH vs J",example:"cheap / jeep",category:"CONSONANTS"},{id:"f_v",sym1:"f",sym2:"v",label:"F vs V",example:"fan / van",category:"CONSONANTS"},{id:"b_p",sym1:"b",sym2:"p",label:"B vs P",example:"bat / pat",category:"CONSONANTS"},{id:"k_g",sym1:"k",sym2:"g",label:"K vs G",example:"coat / goat",category:"CONSONANTS"},{id:"s_z",sym1:"s",sym2:"z",label:"S vs Z",example:"rice / rise",category:"CONSONANTS"},{id:"t_d_ed",sym1:"t",sym2:"d",label:"Past tense -ed",example:"worked / played",category:"CONSONANTS"},{id:"ng_n",sym1:"≈ã",sym2:"n",label:"Final NG vs N",example:"sing / sin",category:"CONSONANTS"},{id:"r_l",sym1:"r",sym2:"l",label:"R vs L",example:"right / light",category:"CONSONANTS"},{id:"ay_ae",sym1:"e…™",sym2:"√¶",label:"Diphthong ay vs Short a",example:"face / fat",category:"DIPHTHONGS"},{id:"ai_ii",sym1:"a…™",sym2:"iÀê",label:"Diphthong ai vs Long ee",example:"time / team",category:"DIPHTHONGS"},{id:"oh_aw",sym1:"…ô ä",sym2:"…îÀê",label:"Diphthong oh vs aw",example:"go / saw",category:"DIPHTHONGS"},{id:"ear_ee",sym1:"…™…ô",sym2:"iÀê",label:"ear vs ee",example:"here / he",category:"DIPHTHONGS"},{id:"air_ae",sym1:"e…ô",sym2:"√¶",label:"air vs short a",example:"hair / hat",category:"DIPHTHONGS"}],$t=({words:s,onComplete:f,onExit:z,onBulkUpdate:M})=>{const[N,A]=l.useState("SETUP"),[V,w]=l.useState("MASTER"),[O,E]=l.useState(null),[P,R]=l.useState([]),[D,H]=l.useState(0),[F,$]=l.useState(null),L=l.useRef(new Map),i=(d,y)=>{if(!d)return!1;(y==="t"||y==="d")&&(d.includes("t É")||d.includes("d í"));const p=y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let b;return y==="d"?b=new RegExp(`${p}(?! í)`):y==="t"?b=new RegExp(`${p}(?! É)`):y===" É"?b=new RegExp(`(?<!t)${p}`):y===" í"?b=new RegExp(`(?<!d)${p}`):y==="…™"?b=new RegExp(`(?<![ae…î])${p}(?!…ô)`):y===" ä"?b=new RegExp(`(?<![a…ô])${p}`):y==="e"?b=new RegExp(`${p}(?!…™|…ô)`):y==="…ô"?b=new RegExp(`(?<![…™ äe])${p}(?! ä)`):b=new RegExp(p),b.test(d)},r=l.useMemo(()=>{const d=new Map,y=s.filter(p=>p.ipaUs&&p.ipaUs.length>2);return fe.forEach(p=>{const b=y.filter(o=>i(o.ipaUs,p.sym1)||i(o.ipaUs,p.sym2)),h=b.length,t=b.filter(o=>{const a=`IPA_SORTER:${p.id}`;return o.lastTestResults&&o.lastTestResults[a]===!0}).length,m=b.filter(o=>{const a=`IPA_SORTER:${p.id}`;return!o.lastTestResults||o.lastTestResults[a]!==!0}).length;d.set(p.id,{total:h,correct:t,availableForMaster:m})}),d},[s]),C=d=>{let p=s.filter(t=>t.ipaUs&&t.ipaUs.length>2).filter(t=>i(t.ipaUs,d.sym1)||i(t.ipaUs,d.sym2));if(V==="MASTER"&&(p=p.filter(t=>{const m=`IPA_SORTER:${d.id}`;return!t.lastTestResults||t.lastTestResults[m]!==!0})),p.length<3){alert(`Not enough words found for this mode (${p.length}). Try 'Review All' or add more words.`);return}const b=[],h=p.sort(()=>Math.random()-.5).slice(0,15);for(const t of h){const m=i(t.ipaUs,d.sym1),o=i(t.ipaUs,d.sym2);let a="";m&&o?a=Math.random()>.5?d.sym1:d.sym2:a=m?d.sym1:d.sym2;const j=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let u;a==="d"?u=new RegExp(`${j}(?! í)`,"g"):a==="t"?u=new RegExp(`${j}(?! É)`,"g"):a===" É"?u=new RegExp(`(?<!t)${j}`,"g"):a===" í"?u=new RegExp(`(?<!d)${j}`,"g"):a==="…™"?u=new RegExp(`(?<![ae…î])${j}(?!…ô)`,"g"):a==="e"?u=new RegExp(`${j}(?!…™|…ô)`,"g"):u=new RegExp(j,"g");let v=t.ipaUs.replace(u,"___");v===t.ipaUs&&(v=t.ipaUs.split(a).join("___")),b.push({id:t.id,wordObj:t,word:t.word,ipa:t.ipaUs,maskedIpa:v,targetSymbol:a})}R(b),E(d),H(0),A("PLAYING")},T=d=>{const y=P[0];if(!y||F||!O)return;const p=y.targetSymbol===d;$({symbol:d,correct:p});const b=p?D+10:Math.max(0,D-5);H(b);const h=`IPA_SORTER:${O.id}`,t={...y.wordObj};t.lastTestResults||(t.lastTestResults={}),t.lastTestResults[h]=p,t.updatedAt=Date.now(),L.current.set(t.id,t),setTimeout(()=>{const m=P.slice(1);R(m),$(null),m.length===0&&(M(Array.from(L.current.values())),L.current.clear(),f(b))},800)},W=()=>{L.current.size>0&&(M(Array.from(L.current.values())),L.current.clear()),N==="PLAYING"?A("SETUP"):z()};if(N==="SETUP"){const d=o=>{const a=r.get(o.id)||{total:0,correct:0,availableForMaster:0},j=a.total>=3,u=V==="ALL"?j:a.availableForMaster>=3,v=a.total>0?a.correct/a.total*100:0;let n="text-neutral-500 bg-neutral-100 border-neutral-200";return j?v>=80?n="text-emerald-700 bg-emerald-100 border-emerald-200":v>0?n="text-amber-700 bg-amber-100 border-amber-200":n="text-rose-700 bg-rose-100 border-rose-200":n="text-neutral-300 bg-neutral-50 border-neutral-100",e.jsxs("button",{onClick:()=>u&&C(o),disabled:!u,className:`
                        w-full flex flex-col gap-1 p-3 rounded-xl border transition-all text-left relative overflow-hidden group shrink-0
                        ${u?"bg-white border-neutral-100 hover:border-indigo-400 hover:bg-indigo-50/30 cursor-pointer shadow-sm":"bg-neutral-50 border-neutral-100 opacity-60 cursor-not-allowed"}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-black text-neutral-800 font-serif",children:["/",o.sym1,"/ vs /",o.sym2,"/"]}),!j&&e.jsx(ht,{size:10,className:"text-neutral-400"})]}),j&&e.jsxs("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-full border ${n}`,children:[a.correct,"/",a.total]})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 font-medium truncate",children:o.example})]},o.id)},y=fe.filter(o=>o.category==="VOWELS"),p=fe.filter(o=>o.category==="DIPHTHONGS"),b=fe.filter(o=>o.category==="CONSONANTS"),h=Math.ceil(b.length/2),t=b.slice(0,h),m=b.slice(h);return e.jsxs("div",{className:"flex flex-col h-full relative p-6 bg-white animate-in fade-in",children:[e.jsxs("header",{className:"flex flex-col gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Back"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:"Phonetic Accuracy"}),e.jsx("p",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-widest",children:"Select a pair to practice"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 self-center",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>w("MASTER"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${V==="MASTER"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(J,{size:10,fill:V==="MASTER"?"currentColor":"none"})," Master It"]}),e.jsxs("button",{onClick:()=>w("ALL"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${V==="ALL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(Ce,{size:10})," Review All"]})]}),e.jsx("p",{className:"text-[9px] text-neutral-400 font-bold",children:V==="MASTER"?"Focus on unmastered words":"Practice with full library"})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-indigo-400 tracking-widest px-1 border-b border-neutral-100",children:"Vowels"}),e.jsx("div",{className:"flex flex-col gap-2",children:y.map(d)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map(d)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100 md:text-transparent select-none",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:m.map(d)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-amber-400 tracking-widest px-1 border-b border-neutral-100",children:"Diphthongs"}),e.jsx("div",{className:"flex flex-col gap-2",children:p.map(d)})]})]})})]})}const U=P[0];return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 shrink-0",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Pairs"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:D}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),O&&e.jsx("div",{className:"text-center mb-6 animate-in slide-in-from-top-2",children:e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold border border-indigo-100",children:[O.label," ",e.jsx("span",{className:"opacity-50 mx-1",children:"‚Ä¢"})," ",e.jsx("span",{className:"italic font-normal",children:O.example})]})}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:U?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:U.word}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:U.maskedIpa.split("___").map((d,y,p)=>e.jsxs(Re.Fragment,{children:[d,y<p.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},y))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Which sound fits?"})]}):e.jsxs("div",{className:"text-neutral-300 font-black text-xl flex flex-col items-center gap-2",children:[e.jsx(me,{size:40,className:"text-green-500"}),e.jsx("span",{children:"Session Complete"})]})}),e.jsx("div",{className:"h-40 grid grid-cols-2 gap-6 mt-4 shrink-0 max-w-lg mx-auto w-full",children:[O.sym1,O.sym2].map((d,y)=>{const p=F&&F.symbol===d,b=p&&F.correct,h=p&&!F.correct;let t="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4 shadow-sm",m="text-neutral-400 group-hover:text-indigo-400";return b?(t+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600 ring-4 ring-emerald-100",m="text-emerald-500"):h?(t+=" bg-rose-50 border-solid border-rose-400 text-rose-600 ring-4 ring-rose-100",m="text-rose-500"):t+=" bg-white border-neutral-200 hover:border-indigo-400 hover:shadow-lg hover:-translate-y-1 active:scale-95",e.jsxs("button",{onClick:()=>T(d),disabled:!!F||!U,className:t,children:[e.jsxs("span",{className:"text-6xl font-serif font-medium mb-1",children:["/",d,"/"]}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${m}`,children:"Tap to Select"})]},y)})})]})]})},Lt=({words:s,onComplete:f,onExit:z})=>{const[M,N]=l.useState("SETUP"),[A,V]=l.useState("MEDIUM"),[w,O]=l.useState(10),[E,P]=l.useState([]),[R,D]=l.useState([]),[H,F]=l.useState(new Set),[$,L]=l.useState(null),[i,r]=l.useState(0),C=(b,h)=>{const t=b.split(/\s+/).filter(Boolean);if(h==="HARD")return t;const m=[];let o=0;const a=h==="EASY"?3:2;for(;o<t.length;){const j=Math.floor(Math.random()*a)+1,u=t.slice(o,o+j).join(" ");m.push(u),o+=j}return m},T=()=>{const b=s.filter(m=>m.example&&m.example.trim().split(/\s+/).filter(Boolean).length>=5);if(b.length<5){alert("Not enough words with suitable example sentences (need at least 5).");return}const t=[...b].sort(()=>Math.random()-.5).slice(0,w).map(m=>{const o=m.example.trim(),j=[...C(o,A)].sort(()=>Math.random()-.5);return{id:m.id,word:m.word,originalSentence:o,shuffledChunks:j}});P(t),N("PLAYING"),r(0),D([]),F(new Set),L(null)},W=E[0],U=(b,h)=>{$===null&&(D(t=>[...t,b]),F(t=>new Set(t).add(h)))},d=b=>{if($!==null)return;const h=R[b],t=R.filter((o,a)=>a!==b);D(t);const m=W.shuffledChunks;F(o=>{const a=new Set(o);for(let j=0;j<m.length;j++)if(m[j]===h&&a.has(j))return a.delete(j),a;return a})},y=()=>{const b=R.join(" ").toLowerCase().trim(),h=W.originalSentence.toLowerCase().trim();b===h?(L(!0),r(t=>t+(A==="HARD"?25:A==="MEDIUM"?15:10)),setTimeout(()=>{const t=E.slice(1);P(t),t.length===0?f(i+(A==="HARD"?25:15)):(D([]),F(new Set),L(null))},1e3)):(L(!1),r(t=>Math.max(0,t-5)),setTimeout(()=>L(null),1500))},p=()=>{const b=E.slice(1);P(b),b.length===0?f(i):(D([]),F(new Set),L(null))};if(M==="SETUP"){const b=({id:h,label:t,icon:m,desc:o})=>e.jsxs("button",{onClick:()=>V(h),className:`p-4 rounded-2xl border-2 transition-all text-left flex flex-col gap-2 ${A===h?"border-emerald-500 bg-emerald-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${A===h?"bg-emerald-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(m,{size:16})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${A===h?"text-emerald-700":"text-neutral-500"}`,children:t})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:o})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(et,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Sentence Scramble"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Reconstruct examples to master syntax and flow."})]}),e.jsx("div",{className:"w-full max-w-sm space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(b,{id:"EASY",label:"Easy",icon:Ce,desc:"Chunks of 1-3 words. Great for collocations."}),e.jsx(b,{id:"MEDIUM",label:"Medium",icon:J,desc:"Chunks of 1-2 words. More challenging."}),e.jsx(b,{id:"HARD",label:"Hard",icon:Ie,desc:"Individual words only. True mastery."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-emerald-600",children:w})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:w,onChange:h=>O(parseInt(h.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Back"}),e.jsxs("button",{onClick:T,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(ne,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Scramble ‚Ä¢ ",A]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${(1-E.length/w)*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:i})]}),W?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300 decoration-2 underline-offset-4",children:W.word})]}),e.jsx("button",{onClick:()=>xe(W.originalSentence),className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl hover:bg-emerald-100 transition-all active:scale-90",title:"Hear full sentence",children:e.jsx(De,{size:24})})]}),e.jsx("p",{className:"text-neutral-400 text-xs font-bold uppercase tracking-widest",children:"Tap chunks in order"})]}),e.jsxs("div",{className:`min-h-[140px] w-full max-w-2xl bg-neutral-50 rounded-[2.5rem] border-2 border-dashed p-8 flex flex-wrap gap-3 items-center justify-center transition-all ${$===!0?"border-emerald-400 bg-emerald-50":$===!1?"border-rose-400 bg-rose-50 animate-shake":"border-neutral-200"}`,children:[R.length===0&&e.jsx("span",{className:"text-lg font-bold text-neutral-300 italic opacity-50",children:"Draft your sentence here..."}),R.map((b,h)=>e.jsxs("button",{onClick:()=>d(h),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 animate-in zoom-in-95 ${$===!0?"bg-emerald-600 text-white":$===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-neutral-300"}`,children:[b," ",e.jsx(ue,{size:14,className:"inline-block ml-1 opacity-50"})]},h))]}),e.jsx("div",{className:"w-full max-w-2xl bg-neutral-100 rounded-[2.5rem] p-8 flex flex-wrap gap-3 justify-center",children:W.shuffledChunks.map((b,h)=>e.jsx("button",{onClick:()=>U(b,h),disabled:H.has(h),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${H.has(h)?"bg-neutral-200 text-neutral-400 cursor-not-allowed opacity-30":"bg-white text-neutral-700 border-2 border-white hover:border-emerald-300 hover:text-neutral-900"}`,children:b},h))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:p,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsxs("button",{onClick:y,disabled:R.length===0||$!==null,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(be,{size:18})," Check"]})]}),$===!1&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 p-4 bg-emerald-50 rounded-2xl border border-emerald-100 text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Original Sentence"}),e.jsxs("p",{className:"text-sm font-bold text-emerald-900 italic",children:['"',W.originalSentence,'"']})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Preparing..."})]})},Ot=["in","on","at","to","for","with","of","from","by","about","into","through","over","under","between","among","against","during","without","before","after","toward","upon","within","along"].sort(),Ht=({words:s,onComplete:f,onExit:z})=>{const[M,N]=l.useState("SETUP"),[A,V]=l.useState(10),[w,O]=l.useState([]),[E,P]=l.useState(0),[R,D]=l.useState(""),[H,F]=l.useState(null),[$,L]=l.useState(0),[i,r]=l.useState(!1),[C,T]=l.useState([]),[W,U]=l.useState(0),[d,y]=l.useState(!1),p=l.useRef(null),b=l.useRef(null),h=()=>{const u=s.filter(I=>I.prepositions&&I.prepositions.some(Y=>!Y.isIgnored)&&I.example);if(u.length<3){alert("Not enough vocabulary with prepositions and examples found in your library.");return}const v=[...u].sort(()=>Math.random()-.5),n=[];for(const I of v){if(n.length>=A)break;const c=[...I.prepositions.filter(x=>!x.isIgnored)].sort(()=>Math.random()-.5);for(const x of c){const g=I.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),k=new RegExp(`\\b${g}\\s+${x.prep}\\b`,"i");if(k.test(I.example)){let S=I.example.split(".")[0]+".";if(k.test(S)){const _=S.replace(k,`${I.word} ___`);n.push({id:`${I.id}-${x.prep}`,word:I.word,example:_,answer:x.prep.toLowerCase(),meaning:I.meaningVi});break}}}}if(n.length<1){alert("Could not generate questions from existing data.");return}O(n),N("PLAYING"),P(0),L(0),D(""),F(null),r(!1)},t=w[E];l.useEffect(()=>{M==="PLAYING"&&p.current&&p.current.focus()},[E,M]);const m=u=>{if(!t||H===!0)return;const n=(u!==void 0?u:R).trim().toLowerCase()===t.answer;F(n),y(!1),n?(L(I=>I+15),setTimeout(()=>{E<w.length-1?(P(I=>I+1),D(""),F(null),r(!1)):f($+15)},800)):(L(I=>Math.max(0,I-5)),setTimeout(()=>F(null),800))},o=u=>{if(D(u),u.trim()){const v=Ot.filter(n=>n.startsWith(u.toLowerCase())&&n!==u.toLowerCase());T(v),U(0),y(v.length>0)}else y(!1)},a=u=>{if(!d){u.key==="Enter"&&m();return}switch(u.key){case"ArrowDown":u.preventDefault(),U(n=>(n+1)%C.length);break;case"ArrowUp":u.preventDefault(),U(n=>(n-1+C.length)%C.length);break;case"Enter":case"Tab":u.preventDefault();const v=C[W];D(v),y(!1),m(v);break;case"Escape":y(!1);break}};if(M==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 text-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(J,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Preposition Power"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Master dependent prepositions in IELTS contexts with smart suggestions."})]}),e.jsx("div",{className:"w-full max-w-sm bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-violet-600",children:A})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:A,onChange:u=>V(parseInt(u.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-violet-500"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:h,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(ne,{size:18,fill:"white"})," Start Practice"]})]})]});const j=E/w.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-8 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-10 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Exit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Question ",E+1," / ",w.length]}),e.jsx("div",{className:"h-1.5 w-40 bg-neutral-100 rounded-full mt-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-500",style:{width:`${j}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest min-w-[80px] text-center",children:$})]}),e.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center space-y-12 max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:`w-full bg-neutral-50 border-2 rounded-[3rem] p-10 md:p-16 text-center space-y-8 transition-all duration-300 ${H===!0?"border-emerald-400 bg-emerald-50/30":H===!1?"border-rose-400 bg-rose-50/30 animate-shake":"border-neutral-100 shadow-sm"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:"px-3 py-1 bg-violet-100 text-violet-700 rounded-lg text-[10px] font-black uppercase tracking-widest border border-violet-200",children:"Fill Blank"}),e.jsx("h3",{className:"text-2xl font-black text-neutral-900 tracking-tight",children:t.word}),e.jsx("button",{onClick:()=>xe(t.word),className:"p-2 text-neutral-400 hover:text-violet-600 transition-colors",children:e.jsx(De,{size:18})})]}),i&&e.jsx("p",{className:"text-sm font-bold text-violet-600 animate-in fade-in slide-in-from-top-1",children:t.meaning})]}),e.jsx("div",{className:"text-xl md:text-2xl font-medium text-neutral-700 leading-relaxed min-h-[4rem]",children:t.example.split("___").map((u,v,n)=>e.jsxs(Re.Fragment,{children:[e.jsx("span",{children:u}),v<n.length-1&&e.jsxs("div",{className:"inline-block mx-2 relative",children:[e.jsx("input",{ref:p,type:"text",value:R,onChange:I=>o(I.target.value),onKeyDown:a,disabled:H===!0,placeholder:"...",className:`
                                                w-[5ch] min-w-[100px] text-center bg-transparent border-b-4 outline-none font-black transition-all
                                                ${H===!0?"border-emerald-500 text-emerald-600":H===!1?"border-rose-500 text-rose-600":"border-neutral-300 focus:border-violet-600 text-neutral-900"}
                                            `,autoComplete:"off"}),H===!0&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 animate-bounce text-emerald-500",children:e.jsx(be,{size:20,strokeWidth:4})}),d&&e.jsx("div",{ref:b,className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 w-32 bg-white rounded-2xl shadow-2xl border border-neutral-100 z-50 overflow-hidden animate-in fade-in zoom-in-95",children:C.map((I,Y)=>e.jsx("button",{onClick:()=>{D(I),y(!1),m(I)},className:`w-full px-4 py-2.5 text-sm font-bold text-left transition-colors ${W===Y?"bg-violet-500 text-white":"text-neutral-600 hover:bg-neutral-50"}`,children:I},I))})]})]},v))})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsx("button",{onClick:()=>r(!i),className:"p-4 bg-white border border-neutral-200 text-neutral-400 hover:text-violet-600 hover:border-violet-200 rounded-2xl transition-all shadow-sm",title:"Show meaning",children:e.jsx(tt,{size:24})}),e.jsxs("button",{onClick:()=>{E<w.length-1?(P(u=>u+1),D(""),F(null),r(!1)):f($)},className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all flex items-center gap-2",children:["Skip ",e.jsx(Ne,{size:18})]}),e.jsx("button",{onClick:()=>m(),disabled:R.trim().length===0||H===!0,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-30 flex items-center gap-2",children:"Check Answer"})]})]}),e.jsxs("footer",{className:"mt-auto pt-8 flex items-center justify-between text-[10px] font-black uppercase text-neutral-300 tracking-widest border-t border-neutral-50",children:[e.jsx("span",{children:"IELTS VOCAB PRO ‚Ä¢ PREPOSITION POWER"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{size:12}),e.jsx("span",{children:"Type to see autocomplete suggestions"})]}),e.jsxs("span",{children:["LEVEL ",E+1]})]})]})},Ut=({words:s,onComplete:f,onExit:z})=>{const[M,N]=l.useState("SETUP"),[A,V]=l.useState("MIX"),[w,O]=l.useState("MEDIUM"),[E,P]=l.useState(8),[R,D]=l.useState([]),[H,F]=l.useState([]),[$,L]=l.useState(null),[i,r]=l.useState(null),[C,T]=l.useState(0);l.useRef({});const W=()=>{const t=[];if(s.forEach(v=>{(A==="PARAPHRASE"||A==="MIX")&&(v.paraphrases||[]).filter(n=>!n.isIgnored&&n.context&&n.context.trim()).forEach(n=>{t.push({context:n.context,fullText:n.word,headword:v.word,pairId:`${v.id}-p-${n.word}`})}),(A==="COLLOCATION"||A==="MIX")&&(v.collocationsArray||[]).filter(n=>!n.isIgnored&&n.d&&n.d.trim()).forEach(n=>{t.push({context:n.d,fullText:n.text,headword:v.word,pairId:`${v.id}-c-${n.text}`})}),(A==="IDIOM"||A==="MIX")&&(v.idiomsList||[]).filter(n=>!n.isIgnored&&n.d&&n.d.trim()).forEach(n=>{t.push({context:n.d,fullText:n.text,headword:v.word,pairId:`${v.id}-i-${n.text}`})})}),t.length<5){alert("Not enough items found. Add more variations or idioms to your library.");return}const m=Math.min(t.length,E),o=[...t].sort(()=>.5-Math.random()).slice(0,m),a=o.map(v=>{const n=v.fullText.split(/\s+/);if(n.length>1){const I=n.findIndex(c=>c.toLowerCase().includes(v.headword.toLowerCase())),Y=I===-1?0:I===0?n.length-1:0;return n[Y].replace(/[^a-zA-Z]/g,"")}return v.fullText}),j=[],u=[];o.forEach((v,n)=>{let I=v.fullText,Y=v.fullText;const c=v.fullText.split(/\s+/);if(c.length>1){const S=c.findIndex(B=>B.toLowerCase().includes(v.headword.toLowerCase())),_=S===-1?0:S===0?c.length-1:0;Y=c[_].replace(/[^a-zA-Z]/g,""),I=c.map((B,G)=>G===_?"___":B).join(" ")}else Y=v.fullText,I="___";const x=a.filter((S,_)=>_!==n&&S.toLowerCase()!==Y.toLowerCase()),g=[Y,...Array.from(new Set(x))].sort(()=>.5-Math.random()).slice(0,5);g.includes(Y)||(g[Math.floor(Math.random()*g.length)]=Y);const k={text:I,fullText:v.fullText,headword:v.headword,context:v.context,partnerWord:Y,choices:g,pairId:v.pairId};j.push({...k,id:`ctx-${v.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1}),u.push({...k,id:`itm-${v.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1})}),D(j),F(u.sort(()=>.5-Math.random())),T(0),L(null),r(null),N("PLAYING")},U=(t,m,o)=>{const a=m.find(u=>u.pairId===t),j=o.find(u=>u.pairId===t);a!=null&&a.isLinked&&(j!=null&&j.isFilled)&&(a.isDone=!0,j.isDone=!0,T(v=>v+(w==="HARD"?25:w==="MEDIUM"?15:10)),m.every(v=>v.isDone)&&setTimeout(()=>f(C+25),1e3))},d=(t,m)=>{const o=R.find(j=>j.id===t),a=H.find(j=>j.id===m);if(!(!o||!a))if(o.pairId===a.pairId){const j=R.map(v=>v.id===t?{...v,isLinked:!0,isSelected:!1}:v),u=H.map(v=>v.id===m?{...v,isLinked:!0,isSelected:!1}:v);D(j),F(u),L(null),r(null),U(o.pairId,j,u)}else D(j=>j.map(u=>u.id===t?{...u,error:!0}:u)),F(j=>j.map(u=>u.id===m?{...u,error:!0}:u)),T(j=>Math.max(0,j-5)),setTimeout(()=>{D(j=>j.map(u=>({...u,error:!1,isSelected:!1}))),F(j=>j.map(u=>({...u,error:!1,isSelected:!1}))),L(null),r(null)},600)},y=t=>{const m=R.find(o=>o.id===t);!m||m.isDone||(i?d(t,i):(L(t===$?null:t),D(o=>o.map(a=>({...a,isSelected:a.id===t?!a.isSelected:!1})))))},p=t=>{const m=H.find(o=>o.id===t);!m||m.isDone||($?d($,t):(r(t===i?null:t),F(o=>o.map(a=>({...a,isSelected:a.id===t?!a.isSelected:!1})))))},b=(t,m)=>{const o=H.find(j=>j.pairId===t);if(!o||o.isDone)return;if(m.trim().toLowerCase()===o.partnerWord.toLowerCase()){const j=H.map(v=>v.pairId===t?{...v,isFilled:!0,text:v.fullText}:v),u=[...R];F(j),U(t,u,j)}else m.trim().length>0&&!o.choices.includes(m)&&(F(j=>j.map(u=>u.pairId===t?{...u,error:!0}:u)),setTimeout(()=>F(j=>j.map(u=>({...u,error:!1}))),600))},h=t=>t.isDone?"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default shadow-none":t.error?"bg-red-50 border-red-500 text-red-700 animate-shake":t.isSelected?"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-[1.02]":t.isLinked?"bg-indigo-50 border-indigo-300 text-indigo-900 shadow-sm":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-400 hover:bg-neutral-50 cursor-pointer shadow-sm";if(M==="SETUP"){const t=({type:o,label:a,icon:j})=>e.jsxs("button",{onClick:()=>V(o),className:`flex flex-col items-center justify-center p-4 rounded-2xl border-2 transition-all ${A===o?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-300"}`,children:[e.jsx(j,{size:24,className:"mb-2"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:a})]}),m=({level:o,label:a,desc:j})=>e.jsxs("button",{onClick:()=>O(o),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${w===o?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${w===o?"text-indigo-700":"text-neutral-400"}`,children:a}),w===o&&e.jsx(be,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:j})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(J,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Context Match Setup"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Link meanings and fill the blanks in any order."})]}),e.jsx("div",{className:"w-full max-w-sm space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(t,{type:"PARAPHRASE",label:"Para",icon:J}),e.jsx(t,{type:"COLLOCATION",label:"Colloc",icon:pt}),e.jsx(t,{type:"IDIOM",label:"Idiom",icon:at}),e.jsx(t,{type:"MIX",label:"Mix All",icon:Ce})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(m,{level:"EASY",label:"Easy",desc:"Match definitions to phrases. No typing required."}),e.jsx(m,{level:"MEDIUM",label:"Medium",desc:"Match meanings and select the missing word from a dropdown."}),e.jsx(m,{level:"HARD",label:"Hard",desc:"Match meanings and type the missing word from memory."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Items"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:E,onChange:o=>P(parseInt(o.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:W,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(ne,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Context Match ‚Ä¢ ",w]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:`${R.filter(t=>t.isDone).length/R.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:C})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 no-scrollbar pb-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Pe,{size:12})," Definition & Headword"]}),R.map(t=>e.jsxs("button",{onClick:()=>y(t.id),className:`relative w-full p-5 rounded-[2rem] border-2 text-left transition-all duration-200 flex flex-col gap-2 ${h(t)}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-black tracking-tight ${t.isSelected?"text-white":"text-indigo-600"}`,children:t.headword}),e.jsxs("div",{className:"flex gap-2",children:[t.isLinked&&e.jsx(Ee,{size:16,className:t.isSelected?"text-white":"text-indigo-400"}),t.isDone&&e.jsx(me,{size:18,className:"text-emerald-500"})]})]}),e.jsx("p",{className:`font-medium text-sm leading-relaxed ${t.isSelected?"text-indigo-100":"text-neutral-600"}`,children:t.context})]},t.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Ie,{size:12})," Target Phrase"]}),H.map(t=>e.jsxs("div",{onClick:()=>p(t.id),className:`relative w-full p-6 rounded-[2rem] border-2 text-left transition-all duration-200 ${h(t)}`,children:[e.jsx("div",{className:`text-lg font-bold flex flex-wrap items-center gap-x-2 leading-relaxed ${t.isSelected?"text-white":"text-neutral-900"}`,children:t.text.split(" ").map((m,o)=>m!=="___"?e.jsx("span",{children:m},o):w==="MEDIUM"?e.jsxs("div",{className:"inline-flex items-center gap-1 bg-white border-2 border-indigo-200 rounded-xl px-2 py-1 shadow-sm",onClick:a=>a.stopPropagation(),children:[e.jsxs("select",{disabled:t.isDone,className:`appearance-none bg-transparent text-sm font-black outline-none pr-6 relative ${t.isFilled?"text-emerald-600":"text-indigo-700"}`,onChange:a=>b(t.pairId,a.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),t.choices.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx($e,{size:14,className:"text-indigo-400 pointer-events-none -ml-5"})]},o):w==="HARD"?e.jsx("input",{type:"text",disabled:t.isDone,onClick:a=>a.stopPropagation(),className:`w-32 px-3 py-1 bg-white border-2 rounded-xl text-sm font-black outline-none transition-all ${t.isFilled?"border-emerald-500 text-emerald-600":"border-indigo-200 text-indigo-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"}`,placeholder:"...",onKeyDown:a=>{a.key==="Enter"&&b(t.pairId,a.currentTarget.value)}},o):e.jsx("span",{className:"text-neutral-300 font-black",children:"_____"},o))}),e.jsxs("div",{className:"absolute top-4 right-6 flex gap-2",children:[t.isLinked&&e.jsx(Ee,{size:16,className:t.isSelected?"text-white":"text-indigo-400"}),t.isDone&&e.jsx(me,{size:18,className:"text-emerald-500"})]})]},t.id))]})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsxs("button",{onClick:()=>N("SETUP"),className:"flex items-center gap-2 text-xs font-black uppercase tracking-widest text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(Le,{size:14})," Restart"]})})]})]})},pe=10,Ae=50;function ce(s){const f=[...s];for(let z=f.length-1;z>0;z--){const M=Math.floor(Math.random()*(z+1));[f[z],f[M]]=[f[M],f[z]]}return f}const Bt=({words:s,onComplete:f,onExit:z})=>{const[M,N]=l.useState("SETUP"),[A,V]=l.useState("MATRIX"),[w,O]=l.useState(12),[E,P]=l.useState({library:!0,collocations:!0,idioms:!0}),[R,D]=l.useState([]),[H,F]=l.useState([]),[$,L]=l.useState([]),[i,r]=l.useState([]),[C,T]=l.useState(0),[W,U]=l.useState(0),[d,y]=l.useState(new Set),[p,b]=l.useState(null),[h,t]=l.useState(null),m=l.useMemo(()=>i.map((c,x)=>({...c,originalIndex:x})).filter(c=>!d.has(c.id)),[i,d]);l.useEffect(()=>{if(M!=="PLAYING")return;const c=[];if(s.forEach(G=>{E.library&&G.meaningVi&&G.meaningVi.trim()&&c.push({text:G.word,d:G.meaningVi,cueId:`cue-${G.id}-word`}),E.collocations&&(G.collocationsArray||[]).filter(X=>!X.isIgnored&&X.d&&X.d.trim()).forEach((X,Q)=>{c.push({text:X.text,d:X.d,cueId:`cue-${G.id}-col-${Q}`})}),E.idioms&&(G.idiomsList||[]).filter(X=>!X.isIgnored&&X.d&&X.d.trim()).forEach((X,Q)=>{c.push({text:X.text,d:X.d,cueId:`cue-${G.id}-idm-${Q}`})})}),c.length<pe){alert(`Not enough items found (found ${c.length}, need min ${pe}).`),N("SETUP");return}const g=ce(c).slice(0,w),k=[],S=[],_=[],B=[];g.forEach(G=>{const K=G.cueId;k.push({id:K,text:G.d}),S.push({id:`card-${K}`,text:G.text,cueId:K,pairId:K,state:"default",type:"word"}),_.push({id:`l-${K}`,text:G.text,cueId:K,pairId:K,state:"default",type:"word"}),B.push({id:`r-${K}`,text:G.d,cueId:K,pairId:K,state:"default",type:"meaning"})}),D(ce(S)),F(ce(_)),L(ce(B)),r(ce(k)),T(0),U(0),y(new Set),b(null),t(null)},[M,w,s,E]),l.useEffect(()=>{M==="PLAYING"&&w>0&&d.size===w&&setTimeout(()=>f(W),800)},[M,d,w,W,f]);const o=c=>{const x=i[C];!x||d.has(x.id)||c.state!=="default"||(c.cueId===x.id?(U(g=>g+10),D(g=>g.map(k=>k.id===c.id?{...k,state:"correct"}:k)),F(g=>g.map(k=>k.pairId===c.pairId?{...k,state:"correct"}:k)),L(g=>g.map(k=>k.pairId===c.pairId?{...k,state:"correct"}:k)),setTimeout(()=>{const g=new Set(d).add(x.id);y(g);let k=-1;for(let S=C+1;S<i.length;S++)if(!g.has(i[S].id)){k=S;break}if(k===-1){for(let S=0;S<C;S++)if(!g.has(i[S].id)){k=S;break}}k!==-1&&T(k)},400)):(U(g=>Math.max(0,g-5)),D(g=>g.map(k=>k.id===c.id?{...k,state:"incorrect"}:k)),setTimeout(()=>{D(g=>g.map(k=>k.id===c.id?{...k,state:"default"}:k))},600)))},a=c=>{c.state==="correct"||c.state==="incorrect"||(c.type==="word"?h?j(c.id,h):b(c.id===p?null:c.id):p?j(p,c.id):t(c.id===h?null:c.id))},j=(c,x)=>{const g=H.find(S=>S.id===c),k=$.find(S=>S.id===x);if(g&&k&&g.pairId===k.pairId){U(_=>_+10);const S=new Set(d).add(g.pairId);y(S),F(_=>_.map(B=>B.id===c?{...B,state:"correct"}:B)),L(_=>_.map(B=>B.id===x?{...B,state:"correct"}:B)),D(_=>_.map(B=>B.pairId===g.pairId?{...B,state:"correct"}:B)),b(null),t(null)}else U(S=>Math.max(0,S-5)),F(S=>S.map(_=>_.id===c?{..._,state:"incorrect"}:_)),L(S=>S.map(_=>_.id===x?{..._,state:"incorrect"}:_)),setTimeout(()=>{F(S=>S.map(_=>({..._,state:_.state==="incorrect"?"default":_.state}))),L(S=>S.map(_=>({..._,state:_.state==="incorrect"?"default":_.state}))),b(null),t(null)},600)},u=()=>{const c=m.findIndex(x=>x.originalIndex===C);if(c>0){const x=m[c-1];T(x.originalIndex)}},v=()=>{const c=m.findIndex(x=>x.originalIndex===C);if(c<m.length-1){const x=m[c+1];T(x.originalIndex)}},n=i[C],I=m.findIndex(c=>c.originalIndex===C);if(M==="SETUP"){const c=({label:g,checked:k,onChange:S})=>e.jsxs("label",{className:"flex items-center gap-3 p-4 rounded-2xl bg-neutral-50 border-2 border-transparent hover:border-fuchsia-100 cursor-pointer transition-all",onClick:S,children:[k?e.jsx(vt,{size:20,className:"text-fuchsia-600"}):e.jsx(nt,{size:20,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-sm text-neutral-800",children:g})]}),x=E.library||E.collocations||E.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-fuchsia-100 text-fuchsia-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Le,{size:32})}),e.jsx("h2",{className:"text-4xl font-black text-neutral-900 tracking-tight",children:"Word Scatter"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Match hidden words to their definitions in a structured matrix or column match."})]}),e.jsx("div",{className:"w-full max-w-md space-y-6",children:e.jsxs("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:["Items: ",e.jsx("span",{className:"text-xl font-black text-fuchsia-600",children:w})]}),e.jsx("input",{id:"sessionSize",type:"range",min:pe,max:Ae,value:w,onChange:g=>O(parseInt(g.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-full appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-[10px] font-black text-neutral-300 uppercase px-1",children:[e.jsx("span",{children:pe}),e.jsx("span",{children:Ae})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:"Content Sources"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(c,{label:"Library Definitions",checked:E.library,onChange:()=>P(g=>({...g,library:!g.library}))}),e.jsx(c,{label:"Collocations",checked:E.collocations,onChange:()=>P(g=>({...g,collocations:!g.collocations}))}),e.jsx(c,{label:"Idioms",checked:E.idioms,onChange:()=>P(g=>({...g,idioms:!g.idioms}))})]})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:()=>N("PLAYING"),disabled:!x,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",children:[e.jsx(ne,{size:18,fill:"white"})," Start"]})]})]})}const Y=d.size/w*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>f(W),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Finish"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>V("MATRIX"),className:`p-2 rounded-lg transition-all ${A==="MATRIX"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Matrix View",children:e.jsx(gt,{size:18})}),e.jsx("button",{onClick:()=>V("MATCH"),className:`p-2 rounded-lg transition-all ${A==="MATCH"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Match View",children:e.jsx(bt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:"Progress"}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-500 transition-all duration-300",style:{width:`${Y}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:W})]}),A==="MATRIX"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shrink-0 mb-6 py-6 px-8 bg-neutral-50 border border-neutral-200 rounded-[2rem] shadow-sm relative overflow-hidden flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:u,disabled:I<=0,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(He,{size:24})}),e.jsx("div",{className:"text-center flex-1 px-10",children:n?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-fuchsia-500 tracking-widest flex items-center justify-center gap-1.5 mb-2",children:[e.jsx(lt,{size:12})," Find the term for:"]}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-neutral-800 leading-tight",children:n.text})]}):e.jsx("p",{className:"text-center font-black text-emerald-600 text-xl animate-bounce",children:"CLEARED!"})}),e.jsx("button",{onClick:v,disabled:I>=m.length-1,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(Ne,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-6",children:e.jsx("div",{className:`grid gap-3 ${w<=12?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":w<=24?"grid-cols-3 md:grid-cols-4 lg:grid-cols-6":"grid-cols-4 md:grid-cols-6 lg:grid-cols-8"}`,children:R.map(c=>{const x=c.state==="correct",g=c.state==="incorrect";return e.jsxs("button",{onClick:()=>o(c),disabled:x,className:`
                                            relative aspect-[4/2.5] p-3 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center text-center shadow-sm font-bold text-xs md:text-sm leading-tight
                                            ${x?"bg-emerald-500 border-emerald-500 text-white scale-90 opacity-0 pointer-events-none":g?"bg-rose-50 border-rose-500 text-rose-600 animate-shake":"bg-white border-neutral-100 text-neutral-700 hover:border-fuchsia-300 hover:text-neutral-900 hover:-translate-y-0.5 active:scale-95"}
                                        `,children:[e.jsx("span",{className:"line-clamp-2",children:c.text}),x&&e.jsx(be,{size:20,className:"absolute inset-auto animate-ping"})]},c.id)})})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(Pe,{size:12})," English"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:H.map(c=>{const x=p===c.id,g=c.state==="correct",k=c.state==="incorrect";if(g)return e.jsx("div",{className:"h-16 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(me,{size:32})},c.id);let S="bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-300 hover:-translate-y-0.5";return x&&(S="bg-fuchsia-600 border-fuchsia-600 text-white shadow-lg ring-4 ring-fuchsia-100 scale-105"),k&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>a(c),className:`h-16 px-4 rounded-xl border-b-4 font-bold text-sm transition-all duration-200 flex items-center justify-center text-center leading-tight shadow-sm ${S}`,children:c.text},c.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," Meaning"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:$.map(c=>{const x=h===c.id,g=c.state==="correct",k=c.state==="incorrect";if(g)return e.jsx("div",{className:"h-20 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(me,{size:32})},c.id);let S="bg-white border-neutral-200 text-neutral-700 hover:border-indigo-300 hover:-translate-y-0.5";return x&&(S="bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-105"),k&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>a(c),className:`min-h-20 px-4 py-3 rounded-xl border-b-4 font-medium text-xs transition-all duration-200 flex items-center justify-center text-center leading-relaxed shadow-sm ${S}`,children:c.text},c.id)})})]})]})}),e.jsxs("footer",{className:"shrink-0 mt-2 flex items-center justify-between text-[10px] font-black uppercase text-neutral-400 tracking-widest px-4 border-t border-neutral-100 pt-4",children:[e.jsxs("span",{children:["Total Items: ",w]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Matched"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-neutral-200"})," Hidden"]})]}),e.jsxs("span",{children:["Completed: ",d.size]})]})]})},Z=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),Wt=({words:s,onComplete:f,onExit:z})=>{const[M,N]=l.useState("SETUP"),[A,V]=l.useState(10),[w,O]=l.useState("MEDIUM"),[E,P]=l.useState("LIBRARY"),[R,D]=l.useState(!1),[H,F]=l.useState([]),[$,L]=l.useState(0),[i,r]=l.useState(0),[C,T]=l.useState({}),[W,U]=l.useState(""),[d,y]=l.useState(!1),[p,b]=l.useState(!1),h=l.useRef(null),{showToast:t}=ge(),m=async x=>{const g=ot(),k=ct(g),S="Dictation";try{const _=await fetch(`${k}/api/reading/files/${S}`);if(!_.ok)throw new Error("Could not access 'Dictation' folder on server.");const G=((await _.json()).items||[]).filter(se=>se.type==="file"&&!se.name.startsWith("."));if(G.length===0)throw new Error("No files found in 'Dictation' folder.");const X=G.sort(()=>Math.random()-.5).slice(0,5);let Q=[];if(await Promise.all(X.map(async se=>{try{const ee=await fetch(`${k}/api/reading/content/${S}/${encodeURIComponent(se.name)}`);if(ee.ok){const he=((await ee.json()).essay||"").split(/\r?\n/).map(re=>re.trim()).filter(re=>re.length>0);Q.push(...he)}}catch(ee){console.warn(`Failed to read file ${se.name}`,ee)}})),Q.length===0)throw new Error("No valid text lines found.");return Q.sort(()=>Math.random()-.5).slice(0,x)}catch(_){return t(_.message||"Server Error","error"),[]}},o=async()=>{let x=[];if(E==="SERVER"){if(D(!0),x=await m(A),D(!1),x.length===0)return}else{const B=s.filter(G=>G.example&&G.example.trim().split(/\s+/).length>=4);if(B.length===0){t("No suitable example sentences found in Library.","error");return}x=[...B].sort(()=>Math.random()-.5).slice(0,A).map(G=>G.example.trim())}const g=x.join(" ").split(/\s+/).map(B=>B.replace(/[^a-zA-Z]/g,"")).filter(B=>B.length>3),k=s.slice(0,50).map(B=>B.word),S=[...new Set([...g,...k])],_=x.map((B,G)=>{const K=B.split(/\s+/);let X=w==="MIXED"?Math.random()>.6?"HARD":Math.random()>.5?"MEDIUM":"EASY":w;const Q=new Set;if(X!=="HARD"){const ee=Math.max(1,Math.floor(K.length*.35));let ie=0;for(;Q.size<ee&&ie<100;){ie++;const ae=Math.floor(Math.random()*K.length);/[a-zA-Z]/.test(K[ae])&&K[ae].length>1&&Q.add(ae)}}const se=K.map((ee,ie)=>{const ae=Q.has(ie),he=ee.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");let re;if(ae&&X==="EASY"){const Ve=S.filter(Ye=>Z(Ye)!==Z(he)).sort(()=>Math.random()-.5).slice(0,3);re=[he,...Ve].sort(()=>Math.random()-.5)}return{text:ee,isMasked:ae,choices:re}});return{id:`dict-${G}-${Date.now()}`,originalSentence:B,tokenized:se,mode:X}});F(_),N("PLAYING"),L(0),r(0),T({}),U(""),y(!1),b(!1),setTimeout(()=>xe(_[0].originalSentence),600)},a=H[$];l.useEffect(()=>{M==="PLAYING"&&!d&&setTimeout(()=>{var x;return(x=h.current)==null?void 0:x.focus()},150)},[$,M,d]);const j=()=>{a&&xe(a.originalSentence)},u=()=>{n()},v=()=>{if(d)return;let x=!0;if(a.mode==="HARD"?x=Z(W)===Z(a.originalSentence):a.tokenized.forEach((g,k)=>{if(g.isMasked){const S=g.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");Z(C[k]||"")!==Z(S)&&(x=!1)}}),b(x),y(!0),x){const g=a.mode==="HARD"?25:a.mode==="MEDIUM"?15:10;r(k=>k+g)}},n=()=>{$<H.length-1?(L(x=>x+1),T({}),U(""),y(!1),b(!1),setTimeout(()=>xe(H[$+1].originalSentence),500)):f(i)},I=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-4 justify-center items-center leading-relaxed",children:a.tokenized.map((x,g)=>{var B;if(!x.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:x.text},g);const k=C[g]||"",S=x.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),_=d&&Z(k)===Z(S);return e.jsxs("div",{className:"relative inline-flex items-center min-w-[80px]",children:[e.jsxs("select",{ref:g===a.tokenized.findIndex(G=>G.isMasked)?h:null,value:k,disabled:d,onChange:G=>T(K=>({...K,[g]:G.target.value})),className:`appearance-none w-full px-3 py-1.5 rounded-lg border-2 text-sm font-bold transition-all outline-none pr-8 ${d?_?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-white border-neutral-200 focus:border-indigo-500"}`,children:[e.jsx("option",{value:"",children:"..."}),(B=x.choices)==null?void 0:B.map(G=>e.jsx("option",{value:G,children:G},G))]}),e.jsx($e,{size:14,className:"absolute right-2 text-neutral-400 pointer-events-none"}),d&&!_&&e.jsx("div",{className:"absolute -bottom-5 left-0 text-[10px] font-black text-green-600 uppercase",children:S})]},g)})}),Y=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-5 justify-center items-center leading-relaxed",children:a.tokenized.map((x,g)=>{if(!x.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:x.text},g);const k=C[g]||"",S=x.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),_=d&&Z(k)===Z(S);return e.jsxs("div",{className:"relative inline-flex flex-col items-center",children:[e.jsx("input",{ref:g===a.tokenized.findIndex(B=>B.isMasked)?h:null,type:"text",value:k,disabled:d,onChange:B=>T(G=>({...G,[g]:B.target.value})),onKeyDown:B=>B.key==="Enter"&&v(),className:`w-24 text-center px-2 py-1.5 rounded-lg border-b-2 font-bold text-sm outline-none transition-all ${d?_?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-indigo-600"}`,autoComplete:"off"}),d&&!_&&e.jsx("div",{className:"absolute -bottom-5 text-[10px] font-black text-green-600 uppercase",children:S})]},g)})}),c=()=>e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsx("textarea",{ref:h,value:W,onChange:x=>U(x.target.value),disabled:d,onKeyDown:x=>x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),v()),placeholder:"Type the full sentence...",className:`w-full p-5 rounded-3xl border-2 text-lg font-medium resize-none outline-none transition-all h-32 ${d?p?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800":"bg-white border-neutral-200 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-100"}`}),d&&!p&&e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-2xl animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-base font-bold text-green-900 leading-relaxed",children:a.originalSentence})]})]});if(M==="SETUP"){const x=({id:g,label:k,icon:S,desc:_})=>e.jsxs("button",{onClick:()=>O(g),className:`p-4 rounded-2xl border-2 transition-all text-left flex flex-col gap-2 ${w===g?"border-cyan-500 bg-cyan-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${w===g?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(S,{size:16})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${w===g?"text-cyan-700":"text-neutral-500"}`,children:k})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:_})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ft,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Dictation Lab"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Bridge the gap between hearing and writing."})]}),e.jsxs("div",{className:"w-full max-w-xl grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>P("LIBRARY"),className:`flex flex-col items-center p-3 rounded-xl border-2 transition-all ${E==="LIBRARY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(it,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Library"})]}),e.jsxs("button",{onClick:()=>P("SERVER"),className:`flex flex-col items-center p-3 rounded-xl border-2 transition-all ${E==="SERVER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(wt,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Server"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-cyan-600",children:A})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:A,onChange:g=>V(parseInt(g.target.value)),className:"w-full h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-4",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(x,{id:"EASY",label:"Easy",icon:jt,desc:"Select from dropdown options."}),e.jsx(x,{id:"MEDIUM",label:"Medium",icon:J,desc:"Type in missing words."}),e.jsx(x,{id:"HARD",label:"Hard",icon:Ie,desc:"Transcribe the full sentence."})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Back"}),e.jsxs("button",{onClick:o,disabled:R,className:"px-12 py-4 bg-cyan-600 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-cyan-700 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[R?e.jsx(Te,{size:18,className:"animate-spin"}):e.jsx(ne,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(le,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Level ",$+1," of ",H.length," ‚Ä¢ ",a.mode]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-300",style:{width:`${$/H.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:i})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12",children:[e.jsx("button",{onClick:j,className:"w-28 h-28 bg-cyan-50 text-cyan-600 rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition-all group active:scale-95",children:e.jsx(ne,{size:48,className:"ml-1.5 fill-cyan-600 group-hover:scale-110 transition-transform"})}),e.jsx("div",{className:"w-full min-h-[160px] flex items-center justify-center px-4",children:a.mode==="EASY"?I():a.mode==="MEDIUM"?Y():c()}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:d?e.jsxs("button",{onClick:n,className:`w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 ${p?"bg-emerald-600 text-white shadow-emerald-200":"bg-neutral-900 text-white"}`,children:[e.jsx("span",{children:$===H.length-1?"Finish":"Next Item"}),e.jsx(Fe,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u,className:"flex-1 py-4 bg-white border-2 border-neutral-200 text-neutral-400 font-black text-xs uppercase tracking-widest rounded-2xl hover:text-neutral-600 hover:border-neutral-300 transition-all",children:"Skip"}),e.jsx("button",{onClick:v,className:"flex-[2] py-4 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl shadow-neutral-900/10 active:scale-95",children:"Check Answer"})]})})]})]})},ss=({user:s,onExit:f,onGainXp:z,onRecalculateXp:M,xpGained:N,xpToNextLevel:A,totalWords:V,onStartSession:w,onUpdateUser:O,lastMasteryScoreUpdateTimestamp:E,onBulkUpdate:P,initialGameMode:R,onConsumeGameMode:D})=>{const[H,F]=l.useState("ADVENTURE"),[$,L]=l.useState([]),[i,r]=l.useState(!0),C=l.useRef(0),{showToast:T}=ge();l.useEffect(()=>{R&&R!=="MENU"&&(F(R),D==null||D())},[R,D]);const W=l.useRef(M);l.useEffect(()=>{W.current=M},[M]),l.useEffect(()=>{(async()=>{r(!0);const m=_e().filter(o=>o.userId===s.id).filter(o=>o&&!o.isPassive);if(L(m),E>C.current){const o=m.reduce((a,j)=>a+(j.masteryScore||0),0);await W.current(o),C.current=Date.now()}r(!1)})()},[s.id,E]);const U=h=>{T(`Game Complete! Score: ${h}`,"success"),f()},d=()=>{f()},y=h=>$.filter(t=>t.gameEligibility?t.gameEligibility.includes(h):dt(t).includes(h)),p=()=>$.filter(h=>{const t=h.paraphrases&&h.paraphrases.filter(a=>!a.isIgnored&&a.context&&a.context.trim()).length>=2,m=h.collocationsArray&&h.collocationsArray.filter(a=>!a.isIgnored&&a.d&&a.d.trim()).length>=2,o=h.idiomsList&&h.idiomsList.filter(a=>!a.isIgnored&&a.d&&a.d.trim()).length>=2;return t||m||o}),b=()=>{const h={onComplete:U,onExit:d};switch(H){case"ADVENTURE":return e.jsx(ve,{user:s,onUpdateUser:O,onStartSession:w,onExit:f});case"IPA_SORTER":return e.jsx($t,{...h,words:y("IPA_SORTER"),onBulkUpdate:P});case"SENTENCE_SCRAMBLE":return e.jsx(Lt,{...h,words:y("SENTENCE_SCRAMBLE")});case"DICTATION":return e.jsx(Wt,{...h,words:y("DICTATION")});case"PREPOSITION_POWER":return e.jsx(Ht,{...h,words:y("PREPOSITION_POWER")});case"PARAPHRASE_CONTEXT":return e.jsx(Ut,{...h,words:p()});case"WORD_SCATTER":return e.jsx(Bt,{...h,words:y("MEANING_MATCH")});default:return e.jsx(ve,{user:s,onUpdateUser:O,onStartSession:w,onExit:f})}};return H==="ADVENTURE"?e.jsx(zt,{user:s,xpToNextLevel:A,onUpdateUser:O,isRecalculatingXp:i,children:e.jsx(ve,{user:s,onUpdateUser:O,onStartSession:w,onExit:f})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-neutral-100 p-4 md:p-6 animate-in zoom-in-95 duration-300 flex flex-col",children:e.jsx("div",{className:"w-full h-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-200 relative p-6",children:b()})})};export{ss as default};
