import{c as ke,r as s,j as e,X as J,_ as te,i as Se,l as Ce,aj as ze,a as Te,bv as Ee,E as Me,t as H,bw as Pe,V as Ie,b3 as Re,aD as Ae,a1 as _e,v as $e,aE as Oe,ac as Fe,G as se,a0 as re,bx as Qe,D as De,by as Ue,al as qe,bz as Le,bA as We}from"./index-CFGznW-r.js";import{E as Ge}from"./ear-CI_ryk5X.js";import{P as Ve}from"./pen-C3awYFYx.js";import{C as Ye}from"./chevron-left-BmQ2v7-n.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=ke("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ne=({isOpen:i,onClose:F,onSave:r,initialData:x})=>{const[c,u]=s.useState(""),S=s.useRef(null);s.useEffect(()=>{i&&(u((x==null?void 0:x.text)||""),setTimeout(()=>{var l;return(l=S.current)==null?void 0:l.focus()},100))},[i,x]);const C=l=>{l.preventDefault(),c.trim()&&r(c.trim())};return i?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:C,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:x?"Edit Phrase":"Add New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Enter the text you want to practice mimicking."})]}),e.jsx("button",{type:"button",onClick:F,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(J,{size:20})})]}),e.jsx("main",{className:"p-8",children:e.jsx("textarea",{ref:S,value:c,onChange:l=>u(l.target.value),placeholder:"e.g. It's not a matter of if, but when.",rows:5,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-base leading-relaxed",required:!0})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Fe,{size:14})," Save Phrase"]})})]})}):null},Je=({score:i})=>i===void 0?e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-200",title:"Not practiced yet"}):e.jsx("div",{className:`flex items-center justify-center px-1.5 py-0.5 rounded-md ${i>=80?"bg-green-100 text-green-700":i>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.jsx("span",{className:"text-[9px] font-black",children:i})}),He=({targetText:i,sourceWord:F,isRecording:r,isRevealed:x,userTranscript:c,userAudioUrl:u,onToggleRecord:S,onPlayTarget:C,onPlayUser:l,onToggleReveal:z,onNext:m,onClearTranscript:K,isEmpty:W,onClose:f,pagedItems:P,page:p,pageSize:T,totalPages:y,onPageChange:v,onPageSizeChange:G,onSelect:Q,currentAbsoluteIndex:n,autoSpeak:k,onToggleAutoSpeak:I,isGlobalMode:R,localAnalysis:h,onAddItem:A,onEditItem:E,onDeleteItem:V,onRandomize:_,isModalOpen:M,editingItem:$,onCloseModal:D,onSaveItem:U})=>{const[Y,q]=s.useState(!0);if(W)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4 relative bg-white",children:[f&&e.jsx("button",{onClick:f,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(J,{size:24})}),e.jsx("div",{className:"p-4 bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(Ge,{size:40})}),e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Queue is Empty"}),e.jsxs("button",{onClick:A,className:"mt-4 px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(te,{size:14})," Add New"]})]}),e.jsx(ne,{isOpen:M,onClose:D,onSave:U,initialData:$})]});const B=R?"h-full rounded-[2.5rem] shadow-sm border border-neutral-200":"h-full";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex w-full bg-white relative overflow-hidden ${B}`,children:[e.jsxs("div",{className:`h-full border-r border-neutral-100 bg-neutral-50/50 flex flex-col shrink-0 transition-all duration-300 ease-in-out ${Y?"w-80 opacity-100":"w-0 opacity-0 border-none overflow-hidden"}`,children:[e.jsx("div",{className:"p-4 border-b border-neutral-100 bg-white space-y-3 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-neutral-500",children:[e.jsx(Be,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Queue"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:I,className:`p-2 rounded-lg border transition-all shadow-sm ${k?"bg-amber-100 border-amber-200 text-amber-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Speak: ${k?"ON":"OFF"}`,children:e.jsx(Se,{size:14,fill:k?"currentColor":"none"})}),e.jsx("button",{onClick:_,className:"p-2 bg-white border border-neutral-200 text-neutral-500 rounded-lg hover:text-indigo-600 transition-all shadow-sm",title:"Shuffle Queue",children:e.jsx(Ce,{size:14})}),e.jsx("button",{onClick:A,className:"p-2 bg-neutral-900 text-white border border-neutral-900 rounded-lg hover:bg-neutral-800 transition-all shadow-sm",children:e.jsx(te,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:P.map((o,b)=>{const N=p*T+b===n;return e.jsxs("div",{className:`w-full text-left rounded-lg border transition-all group relative ${N?"bg-white border-neutral-900 shadow-sm ring-1 ring-neutral-900/5":"border-transparent hover:bg-neutral-100"}`,children:[e.jsxs("button",{onClick:()=>Q(b),className:"w-full px-3 py-3 flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:e.jsx(Je,{score:o.lastScore})}),e.jsx("span",{className:`text-xs font-bold leading-snug line-clamp-2 ${N?"text-neutral-900":"text-neutral-600"}`,children:o.text})]}),e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 right-2 flex items-center bg-white/90 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm border border-neutral-100",children:[e.jsx("button",{onClick:()=>E(o),className:"p-1.5 text-neutral-400 hover:text-indigo-600",children:e.jsx(Ve,{size:12})}),e.jsx("button",{onClick:()=>V(o),className:"p-1.5 text-neutral-400 hover:text-red-600",children:e.jsx(ze,{size:12})})]})]},o.id)})}),e.jsxs("div",{className:"p-3 border-t border-neutral-100 bg-white flex items-center justify-between shrink-0",children:[e.jsx("select",{value:T,onChange:o=>G(Number(o.target.value)),className:"bg-neutral-50 border border-neutral-200 rounded-lg px-2 py-1 text-[10px] font-bold text-neutral-600 focus:outline-none focus:ring-1 focus:ring-neutral-900",children:[10,15,20,30].map(o=>e.jsx("option",{value:o,children:o},o))}),y>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>v(p-1),disabled:p===0,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Ye,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 tabular-nums",children:[p+1,"/",y]}),e.jsx("button",{onClick:()=>v(p+1),disabled:p>=y-1,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Te,{size:16})})]})]})]}),e.jsxs("div",{className:"flex-1 h-full flex flex-col relative overflow-y-auto",children:[f&&e.jsx("button",{onClick:f,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:text-neutral-900 rounded-full z-50",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 space-y-10 animate-in fade-in",children:[e.jsx("div",{className:"relative w-full max-w-2xl",children:e.jsxs("div",{className:"p-8 md:p-12 rounded-[2.5rem] border-2 text-center transition-all duration-300 min-h-[220px] flex flex-col items-center justify-center relative bg-white border-neutral-200 shadow-xl shadow-neutral-100",children:[R&&e.jsx("div",{className:"absolute top-6 left-6 px-3 py-1 bg-neutral-50 rounded-lg text-[10px] font-black uppercase tracking-widest text-neutral-400 border border-neutral-100",children:"Pronunciation Practice"}),e.jsx("button",{onClick:z,className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-indigo-500",children:x?e.jsx(Ee,{size:24}):e.jsx(Me,{size:24})}),e.jsxs("div",{className:"relative px-4 w-full flex flex-wrap justify-center gap-x-3 gap-y-2",children:[i==null?void 0:i.split(/\s+/).map((o,b)=>{const d=h==null?void 0:h.words[b],N=(d==null?void 0:d.status)==="missing";return e.jsx("span",{onClick:()=>H(o),className:`text-4xl md:text-5xl font-black cursor-pointer hover:underline decoration-neutral-200 transition-all flex ${x||h?"opacity-100":"text-transparent blur-lg select-none"}`,children:d!=null&&d.chars?d.chars.map((g,w)=>e.jsx("span",{className:g.status==="correct"?"text-emerald-500":g.status==="wrong"?"text-rose-500":"text-rose-300",children:g.char},w)):e.jsx("span",{className:N?"text-neutral-300":"text-neutral-900",children:o})},b)}),!x&&!h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-200 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Speak to reveal result"})})]}),h&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-1 animate-in slide-in-from-top-2",children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Pronunciation Accuracy"}),e.jsxs("div",{className:`text-5xl font-black ${h.score>80?"text-emerald-500":h.score>50?"text-amber-500":"text-rose-500"}`,children:[h.score,"%"]})]})]})}),e.jsxs("div",{className:"min-h-24 flex flex-col items-center justify-center w-full max-w-xl text-center",children:[r?e.jsxs("div",{className:"flex items-center gap-3 text-rose-500 animate-pulse",children:[e.jsx(Pe,{size:32}),e.jsx("span",{className:"font-black text-base uppercase tracking-widest",children:"Listening..."})]}):!c&&e.jsx("p",{className:"text-neutral-300 text-sm font-medium",children:"Tap the microphone and read the phrase aloud"}),c&&!r&&e.jsxs("div",{className:"space-y-1 animate-in fade-in",children:[e.jsx("p",{className:"text-neutral-400 text-[10px] font-black uppercase tracking-widest",children:"What we heard"}),e.jsxs("p",{className:"text-xl font-medium italic text-neutral-600",children:['"',c,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("button",{onClick:C,className:"p-6 rounded-3xl bg-white border border-neutral-200 text-neutral-600 hover:text-indigo-600 shadow-sm transition-all active:scale-95",children:e.jsx(Ie,{size:32})}),e.jsx("button",{onClick:S,className:`w-32 h-32 rounded-full flex items-center justify-center shadow-2xl transition-all transform ${r?"bg-rose-500 text-white scale-110 ring-12 ring-rose-100":"bg-white border-4 border-neutral-100 text-neutral-900 hover:border-neutral-200 hover:scale-105"}`,children:r?e.jsx(Re,{size:40,fill:"currentColor"}):e.jsx(Ae,{size:40})}),e.jsx("button",{onClick:l,disabled:!u||r,className:`p-6 rounded-3xl border transition-all shadow-sm ${u&&!r?"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600":"bg-neutral-50 border-neutral-100 text-neutral-300 cursor-not-allowed"}`,children:e.jsx(_e,{size:28,fill:u&&!r?"currentColor":"none"})})]}),e.jsxs("button",{onClick:m,className:"px-12 py-5 rounded-[2rem] font-black text-sm uppercase tracking-widest flex items-center gap-3 transition-all shadow-xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-95",children:[e.jsx("span",{children:"Next Phrase"}),e.jsx($e,{size:18})]})]}),e.jsx("div",{className:"px-10 pb-8",children:e.jsxs("div",{className:"p-5 bg-indigo-50 border border-indigo-100 rounded-[2rem] flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-indigo-500 text-white rounded-xl shadow-sm",children:e.jsx(Oe,{size:20})}),e.jsxs("div",{className:"text-[11px] text-indigo-700 leading-relaxed font-medium",children:[e.jsx("b",{className:"text-xs uppercase tracking-wider block mb-1",children:"Visual Feedback Guide:"}),e.jsx("span",{className:"text-emerald-600 font-black",children:"GREEN"}),": Your sound was detected correctly.",e.jsx("br",{}),e.jsx("span",{className:"text-rose-500 font-black",children:"RED"}),": These characters represent sounds that were missing or significantly mispronounced.",e.jsx("br",{}),e.jsx("span",{className:"text-neutral-400 font-black",children:"GRAY"}),": The word was not detected in your speech."]})]})})]})]}),e.jsx(ne,{isOpen:M,onClose:D,onSave:U,initialData:$})]})},ae="vocab_pro_mimic_practice_queue",tt=({scopedWord:i,onClose:F})=>{const[r,x]=s.useState([]),[c,u]=s.useState(0),[S,C]=s.useState(!1),[l,z]=s.useState(0),[m,K]=s.useState(10),[W,f]=s.useState(!1),[P,p]=s.useState(null),[T,y]=s.useState(null),[v,G]=s.useState(()=>se("vocab_pro_mimic_autospeak",!1)),Q=s.useRef(v);s.useEffect(()=>{re("vocab_pro_mimic_autospeak",v),Q.current=v},[v]);const n=r[c]||null,[k,I]=s.useState(!1),[R,h]=s.useState(!1),[A,E]=s.useState(""),[V,_]=s.useState(0),[M,$]=s.useState(null),[D,U]=s.useState("audio/webm"),[Y,q]=s.useState(null),[B,o]=s.useState(!1),[b,d]=s.useState(null),N=s.useRef(new Qe),g=s.useRef(null),w=s.useRef(null),X=s.useRef(()=>{}),{showToast:Z}=De(),ee=A.substring(V).trimStart(),O=t=>{x(t),re(ae,t),C(t.length===0)};s.useEffect(()=>{const t=se(ae,[]);x(t),C(t.length===0),u(0)},[]),s.useEffect(()=>{const t=Math.ceil(r.length/m);l>=t&&t>0&&z(t-1)},[r.length,m]),s.useEffect(()=>{const t=Math.floor(c/m);t!==l&&z(t)},[c,m]);const le=t=>{const j=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...r];O(j),u(0),f(!1)},oe=(t,a)=>{O(r.map(j=>j.id===t?{...j,text:a}:j)),f(!1),p(null)},ie=t=>{y(t)},ce=()=>{if(!T)return;const t=r.filter(j=>j.id!==T.id);let a=c;a>=t.length&&(a=Math.max(0,t.length-1)),u(a),O(t),y(null),Z("Phrase removed.","success")},ue=()=>{if(r.length<2)return;const t=[...r].sort(()=>Math.random()-.5);O(t),u(0),Z("Queue shuffled!","success")},de=t=>{K(t),z(0)},xe=()=>{p(null),f(!0)},he=t=>{p(t),f(!0)},me=t=>{P?oe(P.id,t):le(t)},L=s.useCallback(async(t=!1)=>{w.current&&clearTimeout(w.current),I(!1),N.current.stop();try{const a=await Ue();!t&&a&&($(a.base64),U(a.mimeType))}catch(a){console.error("Audio capture failed",a)}},[]);s.useEffect(()=>{X.current=L},[L]),s.useEffect(()=>{if(k&&L(!0),h(!1),E(""),_(0),$(null),q(null),d(null),g.current&&(g.current.pause(),g.current=null),Q.current&&n){const t=setTimeout(()=>H(n.text),500);return()=>clearTimeout(t)}},[n==null?void 0:n.id]),s.useEffect(()=>()=>{N.current.stop(),w.current&&clearTimeout(w.current)},[]);const fe=async()=>{if(n)if(k){await L();const t=Le(n.text,ee);d(t);const a=r.map((j,ye)=>ye===c?{...j,lastScore:t.score}:j);O(a)}else{E(""),_(0),q(null),d(null);try{await We(),I(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>X.current(),1e4),N.current.start((t,a)=>E(t+a),t=>E(t))}catch(t){console.error("Failed to start recording",t),I(!1)}}},pe=()=>{_(A.length),q(null),d(null)},be=()=>n&&H(n.text),ge=()=>{if(M){g.current&&g.current.pause();const t=new Audio(`data:${D};base64,${M}`);g.current=t,t.play()}},je=()=>{r.length>0&&u(t=>(t+1)%r.length)},ve=t=>{t>=0&&t<r.length&&u(t)},we=Math.ceil(r.length/m),Ne=r.slice(l*m,(l+1)*m);return e.jsxs(e.Fragment,{children:[e.jsx(He,{targetText:(n==null?void 0:n.text)||null,sourceWord:(n==null?void 0:n.sourceWord)||"",type:(n==null?void 0:n.type)||"",isRecording:k,isRevealed:R,userTranscript:ee,matchStatus:Y,userAudioUrl:M,onToggleRecord:fe,onPlayTarget:be,onPlayUser:ge,onToggleReveal:()=>h(!R),onNext:je,onClearTranscript:pe,isEmpty:S,onClose:F,pagedItems:Ne,page:l,pageSize:m,totalPages:we,onPageChange:z,onPageSizeChange:de,onSelect:t=>ve(l*m+t),currentAbsoluteIndex:c,autoSpeak:v,onToggleAutoSpeak:()=>G(!v),isGlobalMode:!i,isAnalyzing:B,onAnalyze:()=>{},aiAnalysis:b?{isCorrect:b.score>80,score:b.score,feedbackHtml:""}:null,localAnalysis:b,onAddItem:xe,onEditItem:he,onDeleteItem:ie,onRandomize:ue,isModalOpen:W,editingItem:P,onCloseModal:()=>f(!1),onSaveItem:me}),e.jsx(qe,{isOpen:!!T,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:ce,onClose:()=>y(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})};export{tt as MimicPractice};
