import{c as ne,r as n,bi as ce,N as de,j as e,J as Ce,h as Te,K as Ye,aw as _e,Z as ge,i as se,bJ as ue,S as pe,P as me,O as Ve,aC as xe,aj as Ie,a3 as fe,az as be,o as we,bG as Be,bE as ye,am as We,b6 as Ke,bK as qe,m as Je,bL as He,bM as ee,a4 as Qe,al as Xe,p as Ze,y as et,k as tt,T as st,aD as nt,a$ as at,bN as rt}from"./index-KV-c42MW.js";import{R as ot,a as it}from"./ResourceActions-B1BO0Dhq.js";import{T as lt}from"./TagBrowser-DxRuICam.js";import{U as ct}from"./UniversalCard-BpWB5tTk.js";import{T as ke}from"./tag-CVPBmTqN.js";import{H as he}from"./headphones-DAPVWDTn.js";import{S as Ee}from"./split-nM0cPUDL.js";import{C as dt}from"./chevron-left-BBkM57BI.js";import{V as ut}from"./ViewMenu-Cla_naRw.js";import{L as pt}from"./layout-grid-ouIs2BZW.js";import"./filter-30bfoXZx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ne("FileDiff",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ne("GalleryHorizontalEnd",[["path",{d:"M2 7v10",key:"a2pl2d"}],["path",{d:"M6 5v14",key:"1kq3d7"}],["rect",{width:"12",height:"18",x:"10",y:"3",rx:"2",key:"13i7bc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ne("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ne("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);function Ne(t){const{currentLesson:r,userRequest:x,language:L,tone:w,coachName:o,task:h,topic:u}=t,v=L==="Vietnamese"?"Vietnamese":"English",f=(r==null?void 0:r.type)==="intensity"||(r==null?void 0:r.type)==="comparison"||(u==null?void 0:u.toLowerCase().includes("intensity"))||(u==null?void 0:u.toLowerCase().includes("comparison"));let C="",y="",b="",S="";h==="create_reading"?C=f?`Create a structured study guide for a ${t.targetAudience} comparing nuanced vocabulary related to: "${u}".`:`Create an immersive, high-impact lesson for a ${t.targetAudience} on: "${u}".`:h==="convert_to_listening"?(C="TRANSFORM the provided Reading Lesson into a high-quality NATURAL AUDIO SCRIPT.",b=`SOURCE: ${r==null?void 0:r.title}
${r==null?void 0:r.content}`):(C=f?"REFINE the reading material into a structured analysis table for the current vocabulary set.":"REFINE the lesson to focus on Contextual Nuance and Visual Clarity.",b=`CURRENT: ${r==null?void 0:r.title}
${r==null?void 0:r.content}
REQUEST: "${x||"Improve layout and examples."}"`);const O=`
  METADATA RULES (STRICT):
  1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Frozen Heat", "Moral Compass".
  2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.
  3. **searchKeywords**: Array of strings. Include all primary words/synonyms. For comparison/intensity, include every compared word.`;return f&&h!=="convert_to_listening"?(y=`
      STYLE: SYSTEMATIC ANALYSIS TABLE
      - You MUST use a Markdown Table as the primary structure.
      - COLUMNS: | Word | Explanation | Examples |
      - "Explanation": Keep it short (max 15 words). **Bold important phrases**.
      - "Examples": Provide EXACTLY TWO distinct examples per word.
      ${O}`,S=`
      CONTENT REQUIREMENTS:
      1. Analyze the core words provided.
      2. **EXPANSION**: Introduce 2-3 NEW related high-frequency words.`):h==="convert_to_listening"?y=`
      - STRUCTURE: Natural spoken narrative.
      - AUDIO STRATEGY: Wrap EVERY sentence in [Audio-VN] or [Audio-EN] tags.`:y=`
      STYLE: COMPACT RICH ARTICLE
      - Use Headers (###), Tips [Tip: ...], and Spoilers [HIDDEN: ...].
      - Use Blockquotes (>) for examples.
      ${O}`,`You are expert IELTS coach '${o}', acting as a ${w==="friendly_elementary"?"friendly mentor":"professor"}.
    
  TASK: ${C}

  ${b}
  ${S}
  ${y}

  STRICT CONTENT RULES:
  1. NO generic introductions.
  2. MANDATORY: All coaching/explanations in ${v}.
  3. **TAGS**: Return EXACTLY ONE tag from: ["Grammar", "Pattern", "Speaking", "Listening", "Reading", "Writing", "General", "Comparison", "Vocabulary"].

  CRITICAL OUTPUT RULES:
  1. **MARKDOWN CODE BLOCK**: Wrap entire JSON response in \`\`\`json ... \`\`\`.
  2. **NO RAW NEWLINES**: Use literal '\\n' for line breaks.
  3. **TABLES**: Use \`<br>\` for line breaks inside table cells.

  OUTPUT TEMPLATE:
  \`\`\`json
  {
    "title": "string",
    "description": "string",
    "content": "string",
    "searchKeywords": ["string"],
    "tags": ["string"]
  }
  \`\`\``}function Ae(t,r,x,L=[]){const w=L.join(", ");return`You are an expert IELTS examiner. 
  
  TASK: Generate a creative and comprehensive PRACTICE TEST based on the following lesson content.
  
  LESSON TITLE: "${t}"
  LESSON CONTENT: "${r}"
  USER REQUEST: "${x||""}"
  TAGS: "${w}"

  AVAILABLE INTERACTIVE TAGS:
  1. **Dropdown**: [Select: Correct | Distractor 1 | Distractor 2]
     - Use for sentence completion, synonyms, or choosing the best fit.
  2. **Multiple Choice**: [Multi: Correct | Distractor 1 | Distractor 2]
     - Use for checking definitions, tones, or concepts.
  3. **Fill-in-the-blank**: [Quiz: Answer]
     - **CONSTRAINT**: Use this ONLY if the answer is absolutely unambiguous (e.g. spelling check, specific term recall) OR if the User Request specifically asks for fill-in/typing questions.

  STRUCTURE STRATEGY:
  Analyze the content and tags.

  **CASE A: VOCABULARY LESSON** (e.g. tags include "Vocabulary", "Vocab", or content is a list of words/phrases)
  If this is primarily a vocabulary lesson, follow this structure:
  1. **Section 1: Vocabulary Selection (3-5 items)**: Use [Select: Correct | Wrong 1 | Wrong 2] to test the nuance of collocations or specific words from the lesson.
  2. **Section 2: Meaning Matching (2-4 items)**: Use [Multi: Correct | Option 2 | Option 3] to match a term to its definition.
  3. **Section 3: Contextual Use (2-4 items)**: Provide short sentences with blanks using [Select: ...] where the user chooses the best synonym for a specific tone.

  **CASE B: OTHER LESSONS** (Grammar, General, Skills, etc.)
  - **Creative Flow**: Design a test flow that best suits the specific concepts taught (e.g., rewriting sentences, identifying errors, filling gaps).
  - Do NOT follow the fixed 3-section structure of Case A unless it fits perfectly.
  - **Contextual**: Focus on testing application in context.

  GENERAL GUIDELINES:
  - **No Repetition**: Do not simply repeat the essay text. Create new sentences or scenarios to test the knowledge.
  - **Language**: Instructions in the same language as the lesson's explanations (Vietnamese/English). Target material in English.

  Return a JSON object:
  {
    "content": "string (Markdown with interactive test components)"
  }`}function gt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Word Intensity Scale" table.
    
    INPUT DATA (Existing Rows):
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the existing word(s). 
    2. Complete any missing columns (Softened, Neutral, Intensified) to create a perfect scale.
    3. Ensure the progression is logical (e.g., chilly -> cold -> freezing).
    4. For EACH word, assign a register if it is distinctly "academic" or "casual". Leave empty if neutral.
    5. **EXPANSION**: You MUST introduce 1-2 ADDITIONAL rows of related vocabulary that fit the theme of the provided words. Choose only natural, high-frequency words useful for IELTS (e.g., if input is "hurt, pain", add rows for "anguish", "discomfort", etc.).

    STRICT JSON OUTPUT FORMAT:
    Return a single JSON array of objects, each representing a full row:
    [
      {
        "softened": [{"word": "string", "register": "academic" | "casual" | null}],
        "neutral": [{"word": "string", "register": "academic" | "casual" | null}],
        "intensified": [{"word": "string", "register": "academic" | "casual" | null}]
      }
    ]
    `}function mt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Confusing Word Comparison" table.
    
    INPUT DATA:
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the word(s). 
    2. If a nuance or example is missing, generate high-quality explanations.
    3. The "nuance" should explain exactly WHEN and WHY to use this word compared to its synonyms. Be sharp and IELTS-focused.
    4. Provide one natural, clear example sentence.
    5. **EXPANSION**: If the list is short, you MUST suggest 1-2 ADDITIONAL confusing words that belong to the same semantic group (e.g., if the user compares "Affect vs Effect", suggest "Impact" or "Influence"). Only add natural, high-frequency words.

    STRICT JSON OUTPUT FORMAT:
    Return a single JSON array of objects:
    [
      {
        "word": "string",
        "nuance": "string (The sharp explanation of usage)",
        "example": "string (The example sentence)"
      }
    ]
    `}const ft=t=>{const{type:r,title:x,setTitle:L,description:w,setDescription:o,tagsInput:h,setTagsInput:u,content:E,setContent:v,listeningContent:f,setListeningContent:C,testContent:y,setTestContent:b,intensityRows:S,setIntensityRows:O,comparisonRows:_,setComparisonRows:Q,isSaving:G,onSave:U,onPractice:$,onCancel:V,onOpenAiRefine:j}=t,[p,T]=n.useState("READING"),[z,g]=n.useState(!1);n.useEffect(()=>{T(r==="intensity"?"INTENSITY":"READING")},[r]);const I=n.useMemo(()=>{let c="";return p==="READING"?c=E:p==="LISTENING"?c=f:c=y,ce(c)},[E,f,y,p]);n.useEffect(()=>(window.handleLessonSpeak=c=>de(c),()=>{delete window.handleLessonSpeak}),[]);const A=()=>O([...S,{softened:[],neutral:[],intensified:[]}]),F=c=>O(S.filter((R,D)=>D!==c)),Y=(c,R,D)=>{const l=[...S],i=D.split(/[;,]+/).map(a=>{const m=a.trim();if(!m)return null;const k=m.match(/\[(academic|casual)\]$/i);return k?{word:m.replace(k[0],"").trim(),register:k[1].toLowerCase()}:{word:m}}).filter(a=>a!==null);l[c][R]=i,O(l)},B=c=>c.map(R=>R.register?`${R.word} [${R.register}]`:R.word).join("; ");return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:V,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(Ce,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:$,disabled:G,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Te,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:U,disabled:G,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[G?e.jsx(Ye,{size:14,className:"animate-spin"}):e.jsx(_e,{size:14}),e.jsx("span",{children:G?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:x,onChange:c=>L(c.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(ke,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:h,onChange:c=>u(c.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[r==="intensity"&&e.jsxs("button",{onClick:()=>{T("INTENSITY"),g(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ge,{size:12,className:"inline mr-1"})," Intensity"]}),e.jsxs("button",{onClick:()=>{T("READING"),g(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(se,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{T("LISTENING"),g(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(he,{size:12,className:"inline mr-1"})," Listening"]}),e.jsxs("button",{onClick:()=>{T("TEST"),g(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ue,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p==="INTENSITY"?e.jsxs("button",{onClick:()=>j("intensity"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-orange-50 border border-orange-100 hover:bg-orange-100 transition-all text-[10px] font-black uppercase text-orange-600 shadow-sm",children:[e.jsx(pe,{size:12}),e.jsx("span",{children:"AI Refine Table"})]}):e.jsxs("button",{onClick:()=>j(p==="READING"?"reading":p==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(pe,{size:12}),e.jsx("span",{children:"AI Generate"})]}),p!=="INTENSITY"&&e.jsxs("button",{onClick:()=>g(!z),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[z?e.jsx(me,{size:12}):e.jsx(Ve,{size:12}),e.jsx("span",{children:z?"Edit":"Preview"})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[500px] relative overflow-hidden",children:p==="INTENSITY"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Intensity Rows"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Separate multiple words with semicolons. Use [academic] or [casual] tags for register."})]}),e.jsxs("div",{className:"space-y-4",children:[S.map((c,R)=>e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm grid grid-cols-1 md:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-blue-500 uppercase tracking-wider pl-1",children:"Softened"}),e.jsx("textarea",{value:B(c.softened),onChange:D=>Y(R,"softened",D.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"chilly; cool..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Neutral"}),e.jsx("textarea",{value:B(c.neutral),onChange:D=>Y(R,"neutral",D.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"hot; warm..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-orange-500 uppercase tracking-wider pl-1",children:"Intensified"}),e.jsx("textarea",{value:B(c.intensified),onChange:D=>Y(R,"intensified",D.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"scorching; boiling..."})]}),e.jsx("button",{onClick:()=>F(R),className:"p-2 text-neutral-300 hover:text-red-500 mt-5",children:e.jsx(xe,{size:16})})]},R)),e.jsxs("button",{onClick:A,className:"w-full py-4 border-2 border-dashed border-neutral-200 rounded-[2rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ie,{size:16})," Add Scale Row"]})]})]}):z?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:I}}):e.jsx("textarea",{value:p==="READING"?E:p==="LISTENING"?f:y,onChange:c=>{p==="READING"?v(c.target.value):p==="LISTENING"?C(c.target.value):b(c.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${p.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},bt=({lesson:t,user:r,onSave:x,onPractice:L,onCancel:w})=>{const[o,h]=n.useState(t.title),[u,E]=n.useState(t.description||""),[v,f]=n.useState(t.path||"/"),[C,y]=n.useState((t.tags||[]).join(", ")),[b,S]=n.useState(t.content),[O,_]=n.useState(t.listeningContent||""),[Q,G]=n.useState(t.testContent||""),[U,$]=n.useState(t.intensityRows||[]),[V,j]=n.useState(t.comparisonRows||[]),[p,T]=n.useState(t.searchKeywords||[]),[z,g]=n.useState(!1),[I,A]=n.useState(null),{showToast:F}=fe();n.useEffect(()=>{t.type==="comparison"&&!t.content&&t.id.startsWith("lesson-")&&A({format:"reading"})},[]),n.useEffect(()=>{if(t.path===void 0&&t.tags){const l=t.tags||[],i=l.find(m=>m.startsWith("/")),a=l.filter(m=>!m.startsWith("/"));f(i||"/"),y(a.join(", "))}else f(t.path||"/"),y((t.tags||[]).join(", "))},[t]);const Y=()=>{const l=C.split(",").map(a=>a.trim()).filter(Boolean);let i=t.type||"essay";return U.length>0?i="intensity":t.type==="comparison"&&(i="comparison"),{...t,title:o,description:u,type:i,path:v.trim(),tags:l,content:b,listeningContent:O,testContent:Q,intensityRows:U.length>0?U:void 0,comparisonRows:void 0,searchKeywords:p,updatedAt:Date.now()}},B=()=>{g(!0);const l=Y();x(l)},c=()=>{g(!0);const l=Y();L(l)},R=l=>{var X,H,q;const i=we(),a=i.audioCoach.activeCoach,m=i.audioCoach.coaches[a].name,k=(I==null?void 0:I.format)||l.format;if(k==="intensity")return gt(U);if(k==="comparison")return mt(V);if(k==="test"){const ae=C.split(",").map(re=>re.trim()).filter(Boolean);return Ae(o,b,l.request,ae)}const K=!b&&(t.type==="comparison"||t.type==="intensity"||!t.id.includes("ai"));return Ne({task:K?"create_reading":k==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:o,description:u,content:b,type:t.type,intensityRows:U,comparisonRows:V},topic:l.request||l.topic||o,userRequest:l.request,language:l.language||((X=r.lessonPreferences)==null?void 0:X.language)||"English",targetAudience:((H=r.lessonPreferences)==null?void 0:H.targetAudience)||"Adult",tone:l.tone||((q=r.lessonPreferences)==null?void 0:q.tone)||"professional_professor",coachName:m})},D=l=>{const{result:i}=l,a=i||l,m=I==null?void 0:I.format;m==="intensity"?Array.isArray(a)&&($(a),F("Intensity scale refined!","success")):m==="comparison"?Array.isArray(a)&&(j(a),F("Comparison lab updated!","success")):m==="listening"?a.content&&(_(a.content),F("Listening script updated!","success")):m==="test"?a.content&&(G(a.content),F("Practice test generated!","success")):(a.title&&h(a.title),a.description&&E(a.description),a.content&&S(a.content),a.searchKeywords&&Array.isArray(a.searchKeywords)&&T(a.searchKeywords),!C.trim()&&a.tags&&a.tags.length>0&&y(a.tags.join(", ")),F("Lesson content refined!","success")),A(null)};return e.jsxs(e.Fragment,{children:[e.jsx(ft,{type:t.type||"essay",title:o,setTitle:h,description:u,setDescription:E,path:v,setPath:f,tagsInput:C,setTagsInput:y,content:b,setContent:S,listeningContent:O,setListeningContent:_,testContent:Q,setTestContent:G,intensityRows:U,setIntensityRows:$,comparisonRows:[],setComparisonRows:()=>{},isSaving:z,onSave:B,onPractice:c,onCancel:w,onOpenAiRefine:l=>A({format:l||"reading"})}),I&&e.jsx(be,{isOpen:!!I,onClose:()=>A(null),type:"REFINE_UNIT",title:I.format==="intensity"?"Refine Intensity Scale":t.type==="comparison"?b?"Refine Comparison Analysis":"Generate Comparison Analysis":b?"Refine Lesson":"Generate Lesson",description:I.format==="intensity"?"AI will complete the intensity word scale and suggest new relevant categories.":t.type==="comparison"?"Enter words like 'Hurt, Pain' to generate a structured comparison table.":"Enter topic or instructions for the AI.",initialData:{...r.lessonPreferences,format:I.format},onGeneratePrompt:R,onJsonReceived:D,actionLabel:"Apply Changes"})]})},wt=({register:t})=>{if(!t)return null;const r=t==="academic";return e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[8px] font-black uppercase border ml-1 ${r?"bg-purple-50 text-purple-700 border-purple-100":"bg-sky-50 text-sky-700 border-sky-100"}`,children:t})},le=({item:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-neutral-800",children:t.word}),e.jsx(wt,{register:t.register})]}),Nt=({rows:t,compact:r=!1})=>!t||t.length===0?null:e.jsx("div",{className:`bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm ${r?"scale-95 origin-top":""}`,children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-blue-500 tracking-[0.2em] w-1/3",children:"Softened"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-1/3",children:"Neutral"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-orange-500 tracking-[0.2em] w-1/3",children:"Intensified"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((x,L)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top bg-blue-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.softened.map((w,o)=>e.jsx(le,{item:w},o)),x.softened.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.neutral.map((w,o)=>e.jsx(le,{item:w},o)),x.neutral.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top bg-orange-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.intensified.map((w,o)=>e.jsx(le,{item:w},o)),x.intensified.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})})]},L))})]})}),yt=({rows:t})=>!t||t.length===0?null:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((r,x)=>e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex flex-col gap-3 group hover:border-indigo-200 transition-all",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-neutral-50 pb-2",children:e.jsx("h4",{className:"text-lg font-black text-indigo-900 tracking-tight",children:r.word})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Usage & Nuance"}),e.jsx("p",{className:"text-sm font-medium text-neutral-700 leading-relaxed italic",children:r.nuance||"No nuance specified."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Example"}),e.jsxs("p",{className:"text-xs font-bold text-neutral-800 leading-relaxed bg-neutral-50 p-3 rounded-xl border border-neutral-100",children:['"',r.example||"...",'"']})]})]})]},x))}),St=t=>{if(!t)return[];const r=t.split(`
`),x=[];let L="Introduction",w=[];const o=()=>{(w.length>0||x.length===0&&L==="Introduction")&&(w.join(`
`).trim()||x.length>0)&&x.push({title:L,content:w.join(`
`)})};return r.forEach(h=>{const u=h.trim().match(/^(#{1,3})\s+(.+)/);u?(o(),L=u[2].trim(),w=[h]):w.push(h)}),o(),x.length>1&&x[0].title==="Introduction"&&!x[0].content.trim()&&x.shift(),x.length>0?x:[{title:"Lesson",content:t}]},jt=({lesson:t,onComplete:r,onEdit:x,onAddSound:L,onAddTest:w})=>{const[o,h]=n.useState("READING"),[u,E]=n.useState("SCROLL"),[v,f]=n.useState(0),[C,y]=n.useState("IDLE"),[b,S]=n.useState(-1),[O,_]=n.useState(!1),[Q,G]=n.useState(0),[U,$]=n.useState(!1),V=n.useRef(null),j=n.useRef(!1),p=n.useRef(new Map),T=n.useRef(new Map);n.useEffect(()=>{t.type==="intensity"&&t.intensityRows&&t.intensityRows.length>0?h("INTENSITY"):t.type==="comparison"&&t.comparisonRows&&t.comparisonRows.length>0&&h("COMPARISON")},[t]);const z=n.useMemo(()=>o==="READING"?t.content||"":o==="LISTENING"?t.listeningContent||"":t.testContent||"",[t,o]),g=n.useMemo(()=>St(z),[z]);n.useEffect(()=>{f(0)},[o]),n.useEffect(()=>{const i=a=>{V.current&&!V.current.contains(a.target)&&$(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const I=n.useMemo(()=>{if(u==="SCROLL")return ce(z);{const i=g[v]||g[0];return ce((i==null?void 0:i.content)||"")}},[z,u,g,v]),A=n.useMemo(()=>{if(!t.listeningContent)return[];const i=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,a=[];let m;for(;(m=i.exec(t.listeningContent))!==null;)a.push({lang:m[1].toUpperCase()==="VN"?"vi":"en",text:m[2].replace(/\[.*?\]/g,"").trim()});return a},[t.listeningContent]),F=i=>{if(p.current.has(i))return Promise.resolve(p.current.get(i));if(T.current.has(i))return T.current.get(i);const a=A[i],m=He(a.text,a.lang).then(k=>(k&&(p.current.set(i,k),G(K=>K+1)),k));return T.current.set(i,m),m},Y=async i=>{for(let a=i;a<A.length&&!j.current;a++)await F(a)},B=async()=>{C==="PAUSED"?(y("PLAYING"),j.current=!1):(j.current=!1,y("PLAYING"),Y(0));const i=b===-1?0:b;for(let a=i;a<A.length&&!j.current;a++){S(a);const m=A[a];let k=p.current.get(a);if(k||(_(!0),k=await F(a),_(!1)),j.current)break;try{await de(m.text,!0,m.lang,void 0,void 0,k||void 0)}catch(K){console.error("Speech playback error at index",a,K)}}j.current||(y("IDLE"),S(-1),G(0),p.current.clear(),T.current.clear())},c=()=>{j.current=!0,ye(),y("IDLE"),S(-1),G(0),p.current.clear(),T.current.clear(),_(!1)};n.useEffect(()=>(window.handleLessonSpeak=i=>{de(i)},()=>{c(),delete window.handleLessonSpeak}),[]);const R=A.length>0,D=t.intensityRows&&t.intensityRows.length>0,l=t.comparisonRows&&t.comparisonRows.length>0;return n.useEffect(()=>{u==="PAGED"&&window.scrollTo({top:0,behavior:"smooth"})},[v,u]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300 relative min-h-screen",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("button",{onClick:r,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:"Back to Library"})]}),g.length>1&&o!=="INTENSITY"&&o!=="COMPARISON"&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>E("SCROLL"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${u==="SCROLL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Scroll View",children:[e.jsx(ht,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Scroll"})]}),e.jsxs("button",{onClick:()=>E("PAGED"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${u==="PAGED"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Chapter View",children:[e.jsx(xt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Paged"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:t.title}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[D&&e.jsxs("button",{onClick:()=>h("INTENSITY"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ge,{size:12,className:"inline mr-1"})," Scale"]}),l&&e.jsxs("button",{onClick:()=>h("COMPARISON"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Ee,{size:12,className:"inline mr-1"})," Lab"]}),e.jsxs("button",{onClick:()=>h("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(se,{size:12,className:"inline mr-1"})," Read"]}),e.jsxs("button",{onClick:()=>h("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(he,{size:12,className:"inline mr-1"})," Listen"]}),e.jsxs("button",{onClick:()=>h("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ue,{size:12,className:"inline mr-1"})," Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o==="LISTENING"&&R&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[C==="PLAYING"?e.jsx("button",{onClick:()=>{y("PAUSED"),ye(),j.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(Be,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:B,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(We,{size:20,fill:"currentColor"})}),C!=="IDLE"&&e.jsx("button",{onClick:c,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Ke,{size:20,fill:"currentColor"})})]}),e.jsx("button",{onClick:x,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(me,{size:20})})]})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px] relative",children:o==="INTENSITY"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Intensity Scale"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Analyze how word choices change based on emphasis and context."})]}),e.jsx(Nt,{rows:t.intensityRows||[]})]}):o==="COMPARISON"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Comparison Lab"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Deep dive into the nuances of confusing or similar vocabulary."})]}),e.jsx(yt,{rows:t.comparisonRows||[]})]}):o==="TEST"&&!t.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(ue,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available."})]}):o==="LISTENING"&&!t.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(he,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:I}})}),u==="PAGED"&&o!=="INTENSITY"&&o!=="COMPARISON"&&g.length>1&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-neutral-200 flex items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsx("button",{onClick:()=>f(Math.max(0,v-1)),disabled:v===0,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(dt,{size:18})}),e.jsxs("div",{className:"relative px-2",ref:V,children:[e.jsxs("button",{onClick:()=>$(!U),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-2 py-1 transition-colors",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Chapter"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-sm text-neutral-900 max-w-[120px] truncate",children:g[v].title}),e.jsx(qe,{size:12,className:"text-neutral-400"})]})]}),U&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-56 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-bottom",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:g.map((i,a)=>e.jsx("button",{onClick:()=>{f(a),$(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${a===v?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:i.title},a))})})]}),e.jsx("button",{onClick:()=>f(Math.min(g.length-1,v+1)),disabled:v===g.length-1,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(Je,{size:18})})]})]})},vt=({user:t,lesson:r,onComplete:x,onEdit:L,onUpdate:w})=>{const[o,h]=n.useState(null),{showToast:u}=fe(),E=f=>{var b,S,O;const C=we(),y=C.audioCoach.coaches[C.audioCoach.activeCoach].name;return f.format==="test"||o==="test"?Ae(r.title,r.content,f.request,r.tags):Ne({task:"convert_to_listening",currentLesson:{title:r.title,description:r.description,content:r.content},userRequest:f.request,language:f.language||((b=t.lessonPreferences)==null?void 0:b.language)||"English",targetAudience:((S=t.lessonPreferences)==null?void 0:S.targetAudience)||"Adult",tone:f.tone||((O=t.lessonPreferences)==null?void 0:O.tone)||"professional_professor",coachName:y})},v=async f=>{const C=f.result||f,y=f.format||o,b={...r,updatedAt:Date.now()};y==="listening"?(b.listeningContent=C.content,u("Audio script added successfully!","success")):(b.testContent=C.content,u("Practice test added successfully!","success")),await ee(b),w&&w(b),h(null)};return e.jsxs(e.Fragment,{children:[e.jsx(jt,{lesson:r,onComplete:x,onEdit:L,onAddSound:()=>h("listening"),onAddTest:()=>h("test")}),o&&e.jsx(be,{isOpen:!!o,onClose:()=>h(null),type:"GENERATE_AUDIO_SCRIPT",title:o==="listening"?"Add Lesson Sound":"Add Practice Test",description:o==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...t.lessonPreferences,format:o},onGeneratePrompt:E,onJsonReceived:v,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},Ct={filterSchema:[],viewSchema:[]},ve="vocab_pro_lesson_view_settings",zt=({user:t,onStartSession:r,onNavigate:x,onUpdateUser:L,initialLessonId:w,onConsumeLessonId:o,initialTag:h,onConsumeTag:u})=>{const[E,v]=n.useState([]),[f,C]=n.useState([]),[y,b]=n.useState(!0),[S,O]=n.useState(null),[_,Q]=n.useState(!1),[G,U]=n.useState(!1),[$,V]=n.useState(""),[j,p]=n.useState("ALL"),[T,z]=n.useState("all"),[g,I]=n.useState("all"),[A,F]=n.useState(()=>Qe(ve,{showDesc:!0,compact:!1})),[Y,B]=n.useState(0),[c,R]=n.useState(12),[D,l]=n.useState("list"),[i,a]=n.useState(null),[m,k]=n.useState(null),[K,X]=n.useState(!1),{showToast:H}=fe();n.useEffect(()=>{Xe(ve,A)},[A]);const q=n.useCallback(async()=>{b(!0);try{const[s,d]=await Promise.all([Ze(t.id),et()]),M=[...s.map(N=>{let P="ESSAY";return N.type==="intensity"&&(P="INTENSITY"),N.type==="comparison"&&(P="COMPARISON"),{type:P,data:N,path:N.path,tags:N.tags,date:N.createdAt}})];v(M.sort((N,P)=>P.date-N.date)),C(d)}finally{b(!1)}},[t.id]);n.useEffect(()=>{q()},[q]),n.useEffect(()=>{if(w&&E.length>0){const s=E.find(d=>d.data.id===w);s&&(a(s.data),l("read_lesson"),o==null||o())}},[w,E,o]),n.useEffect(()=>{h&&(O(h),u==null||u())},[h,u]),n.useEffect(()=>{B(0)},[S,$,j,T,g,c]);const ae=n.useCallback(()=>{O(null),p("ALL"),z("all"),I("all")},[]),re=s=>{V(s),s.trim()&&ae()},Re=n.useMemo(()=>j!=="ALL"||T!=="all"||g!=="all",[j,T,g]),Z=n.useMemo(()=>{const s=$.toLowerCase().trim();return E.filter(d=>{var M,N;if(s){const P=(d.data.title||"").toLowerCase().includes(s),te=(d.data.description||"").toLowerCase().includes(s),J=(d.data.searchKeywords||[]).some(ie=>(ie||"").toLowerCase().includes(s)),W=(d.data.tags||[]).some(ie=>(ie||"").toLowerCase().includes(s));return!(!P&&!te&&!J&&!W)}if(j!=="ALL"&&d.type!==j||T==="focused"&&!d.data.isFocused||g!=="all"&&d.data.focusColor!==g)return!1;if(S){if(S==="Uncategorized"){const P=d.path??(d.tags||[]).find(J=>J.startsWith("/"));if(P&&P!=="/")return!1}else if(!((M=d.path)!=null&&M.startsWith(S))&&!((N=d.tags)!=null&&N.includes(S)))return!1}return!0})},[E,S,$,j,T,g]),Le=n.useMemo(()=>{const s=Y*c;return Z.slice(s,s+c)},[Z,Y,c]),Oe=async()=>{m&&(await rt(m.id),H("Lesson deleted.","success"),k(null),q())},Pe=async s=>{await ee(s),H("Lesson saved!","success"),l("list"),a(null),q()},oe=(s="essay")=>{const d={id:`lesson-${Date.now()}`,userId:t.id,topic1:"General",topic2:"General",type:s,title:s==="intensity"?"New Intensity Scale":s==="comparison"?"New Comparison Lab":"New Lesson",description:"",content:"",tags:[],intensityRows:s==="intensity"?[{softened:[],neutral:[],intensified:[]}]:void 0,comparisonRows:s==="comparison"?[{word:"",nuance:"",example:""}]:void 0,createdAt:Date.now(),updatedAt:Date.now()};a(d),l("edit_lesson")},De=async s=>{const{result:d,preferences:M}=s;JSON.stringify(t.lessonPreferences)!==JSON.stringify(M)&&await L({...t,lessonPreferences:M});const N={id:`lesson-ai-${Date.now()}`,userId:t.id,title:d.title,description:d.description,content:d.content,tags:d.tags||[],searchKeywords:d.searchKeywords||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"General",topic2:"General"};await ee(N),H("Lesson created with AI!","success"),X(!1),a(N),l("read_lesson"),q()},Me=async(s,d)=>{const M={...s.data,focusColor:d||void 0,updatedAt:Date.now()};d||delete M.focusColor,await ee(M),v(N=>N.map(P=>P.data.id===s.data.id?{...P,data:{...P.data,focusColor:d||void 0,updatedAt:Date.now()}}:P))},ze=async s=>{const d={...s.data,isFocused:!s.data.isFocused,updatedAt:Date.now()};await ee(d),v(M=>M.map(N=>N.data.id===s.data.id?{...N,data:{...N.data,isFocused:!N.data.isFocused,updatedAt:Date.now()}}:N))},Ge=()=>{v(s=>[...s].sort(()=>Math.random()-.5)),H("Deck shuffled!","success")},Ue=[{label:"Topic Lesson (AI)",icon:pe,onClick:()=>X(!0)},{label:"Intensity Scale",icon:ge,onClick:()=>oe("intensity")},{label:"Comparison Lab",icon:Ee,onClick:()=>oe("comparison")},{label:"New Lesson (Manual)",icon:Ie,onClick:()=>oe("essay")}],$e=s=>{const d=we(),M=d.audioCoach.activeCoach,N=d.audioCoach.coaches[M].name;return Ne({topic:s.topic,language:s.language,targetAudience:s.targetAudience,tone:s.tone,format:s.format,coachName:N,task:"create_reading"})};if(D==="read_lesson"&&i)return e.jsx(vt,{user:t,lesson:i,onComplete:()=>l("list"),onEdit:()=>l("edit_lesson"),onUpdate:s=>a(s)});if(D==="edit_lesson"&&i)return e.jsx(bt,{lesson:i,user:t,onSave:Pe,onPractice:s=>{a(s),l("read_lesson")},onCancel:()=>l("list")});const Fe=()=>e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[_&&e.jsx(lt,{items:E.map(s=>s.data),selectedTag:S,onSelectTag:O,forcedView:"tags",title:"Browse Tags",icon:e.jsx(ke,{size:16})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:flex-1 max-w-sm",children:[e.jsx(at,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:$,onChange:s=>re(s.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-xs font-bold focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto w-full sm:w-auto pb-2 sm:pb-0 no-scrollbar",children:[e.jsxs("button",{onClick:()=>p("ALL"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j==="ALL"?"bg-neutral-900 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-neutral-900"}`,children:[e.jsx(pt,{size:12})," All"]}),e.jsxs("button",{onClick:()=>p("ESSAY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j==="ESSAY"?"bg-emerald-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-emerald-600"}`,children:[e.jsx(se,{size:12})," Lesson"]}),e.jsxs("button",{onClick:()=>p("INTENSITY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j==="INTENSITY"?"bg-orange-500 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-orange-500"}`,children:[e.jsx(je,{size:12})," Scale"]}),e.jsxs("button",{onClick:()=>p("COMPARISON"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${j==="COMPARISON"?"bg-indigo-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-indigo-600"}`,children:[e.jsx(Se,{size:12})," Diff"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(ot,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),pagination:{page:Y,totalPages:Math.ceil(Z.length/c),onPageChange:B,pageSize:c,onPageSizeChange:R,totalItems:Z.length},aboveGrid:e.jsx(Fe,{}),config:Ct,activeFilters:{},onFilterChange:()=>{},isLoading:y,isEmpty:Z.length===0,emptyMessage:"No items found matching your criteria.",actions:e.jsx(it,{viewMenu:e.jsx(ut,{isOpen:G,setIsOpen:U,hasActiveFilters:Re,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(st,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>z(T==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${T==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:T==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>I(g==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>I(g==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>I(g==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:A.showDesc,onChange:()=>F(s=>({...s,showDesc:!s.showDesc}))},{label:"Compact",checked:A.compact,onChange:()=>F(s=>({...s,compact:!s.compact}))}]}),browseTags:{isOpen:_,onToggle:()=>{Q(!_)}},addActions:Ue,extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:Ge,disabled:Z.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Shuffle Deck",children:e.jsx(tt,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:Le.map(s=>{const d=()=>{a(s.data),l("read_lesson")},M=()=>{a(s.data),l("edit_lesson")},N=()=>k(s.data),P=s.type==="INTENSITY",te=s.type==="COMPARISON";let J;return P?J={label:"Scale",colorClass:"bg-orange-50 text-orange-700 border-orange-100",icon:je}:te?J={label:"Diff",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:Se}:J={label:"Lesson",colorClass:"bg-emerald-50 text-emerald-700 border-emerald-100",icon:se},e.jsx(ct,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:s.data.title}),tags:s.data.tags,badge:J,compact:A.compact,onClick:d,focusColor:s.data.focusColor,onFocusChange:W=>Me(s,W),isFocused:s.data.isFocused,onToggleFocus:()=>ze(s),isCompleted:s.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),d()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(Te,{size:14})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),M()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(me,{size:14})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),N()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(xe,{size:14})})]}),children:A.showDesc&&s.data.description&&e.jsx("p",{className:"line-clamp-3 mt-1",children:s.data.description})},`${s.type}-${s.data.id}`)})})}),e.jsx(nt,{isOpen:!!m,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:Oe,onClose:()=>k(null),icon:e.jsx(xe,{size:40,className:"text-red-500"})}),e.jsx(be,{isOpen:K,onClose:()=>X(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:t.lessonPreferences,onGeneratePrompt:$e,onJsonReceived:De,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{zt as LessonLibraryV2,zt as default};
