import{j as e,w as Z,x as c,Z as ee,B as de,R as xe,y as ue,f as pe,z as me,D as fe,V as he,E as ge,H as be,I as je,J as we,K as te,X as re,C as ve,N as ye,O as Ne,T as ke,Q as Se,U as Re,Y as Ce,r as t,_ as se,$ as q,a0 as Q,a1 as Ee}from"./index-6QNaqlSf.js";import{T as ze}from"./trophy-BZs6zLBU.js";const Ie=(r,m,_)=>{if(_)return r?r==="GAVE_UP"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-amber-100 text-amber-700",children:[e.jsx(Re,{size:10})," Gave Up"]}):r==="PASS"||r===c.EASY?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-700",children:[e.jsx(te,{size:10})," Pass"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:[e.jsx(re,{size:10})," Fail"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:[e.jsx(Se,{size:10})," No Answer"]});if(!r)return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:"Skipped"});if(m&&(r===c.EASY||r===c.LEARNED))return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-cyan-100 text-cyan-700",children:"Learned"});switch(r){case c.FORGOT:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:"Forgot"});case c.HARD:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-orange-100 text-orange-600",children:"Hard"});case c.EASY:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-600",children:"Easy"});default:return null}},Me=({score:r})=>{const g=2*Math.PI*16,C=g-r/100*g,E=r>=80?"text-green-500":r>=50?"text-yellow-500":r>0?"text-orange-500":"text-neutral-400";return e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:36,height:36},children:[e.jsxs("svg",{className:"absolute",width:36,height:36,children:[e.jsx("circle",{className:"text-neutral-100",stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2}),e.jsx("circle",{className:E,stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2,strokeDasharray:g,strokeDashoffset:C,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.5s ease-out"}})]}),e.jsx("span",{className:`text-[10px] font-black ${E}`,children:r})]})},Te=({word:r})=>{const m=r.masteryScore??0;return e.jsxs("div",{className:"relative group/score",children:[e.jsx(Me,{score:m}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/score:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Mastery Score",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]})},_e=({complexity:r})=>e.jsxs("div",{className:"relative group/complexity",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 transition-all hover:bg-amber-100 shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black opacity-50",children:"CX"}),e.jsx("span",{className:"text-xs font-black",children:r})]}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/complexity:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Complexity Level",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]}),Ae=r=>{const{user:m,initialWords:_,sessionWords:d,sessionType:g,newWordIds:C,progress:E,setProgress:A,sessionOutcomes:B,sessionFinished:O,wordInModal:S,setWordInModal:R,editingWordInModal:W,setEditingWordInModal:y,isTesting:F,setIsTesting:P,currentWord:x,isNewWord:b,onUpdate:N,onComplete:o,nextItem:U,handleReview:D,handleTestComplete:k,handleRetry:z,handleEndSession:$,handleQuickReview:V,handleManualPractice:J,isQuickReviewMode:Y}=r,{current:L,max:I}=E,p=g==="random_test",M=n=>{R(null),y(n)},l=n=>{N(n),y(null)};if(_.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 py-20 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner",children:e.jsx(Z,{size:32})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"All clear!"}),e.jsx("button",{onClick:o,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-semibold text-sm hover:bg-neutral-800 transition-colors",children:"Back to Dashboard"})]});if(O){if(g==="new"||g==="due"||g==="new_study"||g==="custom"||p){const n=Object.values(B).filter(w=>w==="PASS"||w===c.EASY||w===c.LEARNED).length;return e.jsxs("div",{className:"max-w-2xl mx-auto py-10 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center mb-4 ${p?"bg-amber-100 text-amber-600":"bg-neutral-100 text-neutral-900"}`,children:p?e.jsx(ee,{size:40,fill:"currentColor"}):e.jsx(de,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:p?"Test Result":"Session Recap"}),p&&e.jsxs("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-[0.2em] mt-2",children:["Score: ",n," / ",d.length]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You've completed this focused session."})]}),e.jsx("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm mb-8 overflow-hidden",children:e.jsx("div",{className:"max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 p-2",children:d.map(w=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50/70 p-2.5 rounded-xl border border-neutral-100",children:[e.jsx("span",{className:"font-bold text-neutral-800 text-xs truncate pr-2",children:w.word}),Ie(B[w.id],C.has(w.id),p)]},w.id))})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:o,className:"px-6 py-4 bg-white border border-neutral-200 text-neutral-500 rounded-2xl font-bold text-xs hover:bg-neutral-50 hover:border-neutral-900 transition-all active:scale-95 uppercase tracking-widest",children:"Finish Session"}),e.jsxs("button",{onClick:z,className:"px-6 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center justify-center space-x-2 shadow-lg hover:bg-neutral-800 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Retry This Session"})]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in zoom-in-95 duration-500",children:[e.jsx(ze,{size:64,className:"text-yellow-500 mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You have finished this review session."}),e.jsx("button",{onClick:o,className:"mt-8 px-10 py-3.5 bg-neutral-900 text-white rounded-2xl font-bold shadow-xl hover:scale-105 transition-all text-sm",children:"Return to Dashboard"})]})}if(!x)return null;const K=b?ue:pe,G=b?"text-blue-500":"text-neutral-500",H=x.ipaUs||x.word,T=!!x.ipaUs;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-100px)] flex flex-col animate-in fade-in duration-300",children:[e.jsxs("div",{className:"px-6 shrink-0 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"w-24"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{size:14,className:G}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:[L+1," / ",d.length]})]}),e.jsx("div",{className:"w-24 text-right",children:e.jsx("button",{onClick:$,className:"px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider text-neutral-500 hover:bg-neutral-100 transition-colors",children:"End Session"})})]}),e.jsx("div",{className:"h-1 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-neutral-900 transition-all duration-300 ease-in-out",style:{width:`${(L+1)/d.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative gap-4",children:[e.jsx("button",{onClick:()=>A(n=>({...n,current:(n.current-1+d.length)%d.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Previous word",children:e.jsx(me,{size:28})}),e.jsx("div",{className:"w-full max-w-xl h-full bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col relative overflow-hidden group select-none",children:p?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-4",children:[e.jsx(fe,{className:"animate-spin text-neutral-200",size:32}),e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Loading Next Test..."})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:`font-black text-neutral-900 tracking-tight text-4xl ${T?"font-serif":""}`,children:H}),b?e.jsx(_e,{complexity:x.complexity??0}):e.jsx(Te,{word:x}),e.jsx("button",{onClick:n=>{n.stopPropagation(),ge(x.word)},className:"p-3 text-neutral-400 bg-neutral-50 hover:bg-neutral-100 hover:text-neutral-900 rounded-full transition-colors",title:"Pronounce",children:e.jsx(he,{size:22})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>R(x),className:"flex items-center gap-2 px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-black text-[10px] hover:bg-amber-600 transition-all active:scale-95 uppercase tracking-widest shadow-lg shadow-amber-500/20",children:[e.jsx(je,{size:14}),e.jsx("span",{children:"Practice"})]})]})]})}),e.jsx("button",{onClick:()=>A(n=>({...n,current:(n.current+1)%d.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Next word",children:e.jsx(we,{size:28})})]}),e.jsx("div",{className:"shrink-0 pt-6 pb-2 mt-auto",children:b?e.jsxs("div",{className:"max-w-lg mx-auto grid grid-cols-3 items-stretch gap-4",children:[e.jsx("div",{})," ",e.jsxs("button",{onClick:()=>D(c.LEARNED),className:"py-5 bg-green-500 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 shadow-lg shadow-green-500/20 hover:bg-green-600 transition-all active:scale-95",children:[e.jsx(te,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"LEARNED"})]}),e.jsx("div",{})," "]}):!p&&e.jsxs("div",{className:"max-w-xl mx-auto grid grid-cols-4 items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>D(c.FORGOT),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-red-600 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"FORGOT"})]}),e.jsxs("button",{onClick:()=>D(c.HARD),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-orange-600 hover:bg-orange-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(ve,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Hard"})]}),e.jsxs("button",{onClick:()=>D(c.EASY),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-green-600 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(Z,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Easy"})]}),e.jsxs("button",{onClick:V,className:"py-5 bg-indigo-600 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all hover:bg-indigo-700 shadow-md shadow-indigo-200",children:[e.jsx(ee,{size:20,fill:"currentColor"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Quick Review"})]})]})})]}),S&&e.jsx(ye,{word:S,onUpdate:N,onClose:()=>R(null),onNavigateToWord:R,onEditRequest:M,onGainXp:async()=>0,isViewOnly:!0}),W&&e.jsx(Ne,{user:m,word:W,onSave:l,onClose:()=>y(null),onSwitchToView:n=>{y(null),R(W)}}),F&&x&&e.jsx(ke,{word:x,isQuickFire:p,sessionPosition:p?{current:L+1,total:d.length}:void 0,onPrevWord:()=>A(n=>({...n,current:Math.max(0,n.current-1)})),onClose:()=>{p?o():P(!1)},onComplete:k,skipSetup:Y})]})},Fe=({user:r,sessionWords:m,sessionFocus:_,sessionType:d,onUpdate:g,onBulkUpdate:C,onComplete:E,onRetry:A})=>{const{showToast:B}=Ce(),O=m,S=t.useRef(null),[R,W]=t.useState(new Set),[y,F]=t.useState(()=>{const s=se("vocab_pro_session_progress",null);return s&&typeof s.current=="number"&&typeof s.max=="number"&&s.current<=s.max&&s.max<m.length?s:{current:0,max:0}}),[P,x]=t.useState(()=>se("vocab_pro_session_outcomes",{})),[b,N]=t.useState(new Map),o=t.useRef(null),{current:U,max:D}=y,[k,z]=t.useState(!1),[$,V]=t.useState(null),[J,Y]=t.useState(null),[L,I]=t.useState(d==="random_test"),[p,M]=t.useState(!1),l=O[U],K=t.useMemo(()=>!(l!=null&&l.lastReview),[l]),G=t.useRef(b);t.useEffect(()=>{G.current=b},[b]);const H=t.useRef(k);t.useEffect(()=>{H.current=k},[k]),t.useEffect(()=>{const s=m.map(a=>a.id).sort().join(",");(S.current===null||S.current!==s)&&(S.current=s,W(new Set(m.filter(a=>!a.lastReview).map(a=>a.id))),F({current:0,max:0}),x({}),z(!1),N(new Map),sessionStorage.removeItem("vocab_pro_session_progress"),sessionStorage.removeItem("vocab_pro_session_outcomes"))},[m]),t.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_progress",JSON.stringify(y))},[y]),t.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_outcomes",JSON.stringify(P))},[P]),t.useEffect(()=>{V(null),Y(null),I(d==="random_test"),M(!1)},[U,d]);const T=t.useCallback(async()=>{const s=Array.from(G.current.values());s.length!==0&&(await C(s),N(new Map))},[C]);t.useEffect(()=>()=>{!H.current&&G.current.size>0&&T()},[T]),t.useEffect(()=>{k&&b.size>0&&T()},[k,T,b.size]);const n=()=>{if(U<O.length-1){const s=U+1;F(a=>({current:s,max:Math.max(a.max,s)}))}else z(!0)},w=async s=>{if(!l)return;x(i=>({...i,[l.id]:s}));let a,j;const v=b.get(l.id);v&&v.lastTestResults?(a={...v.lastTestResults},j=v.masteryScore):o.current?(a={...o.current},j=Q({...l,lastTestResults:o.current})):l.lastTestResults&&(a={...l.lastTestResults},j=l.masteryScore);let h=q(l,s);a&&(h={...h,lastTestResults:a,masteryScore:j}),N(i=>new Map(i).set(h.id,h)),o.current=null,n()},ne=()=>{M(!0),I(!0)},ae=()=>{M(!1),I(!0)},le=(s,a)=>{const j={...s.lastTestResults||{}},v=Ee(s);return Object.entries(a).forEach(([h,i])=>{if(j[h]=i,i===!1){const u=v.find(f=>f.testKeys.includes(h));u&&u.testKeys.forEach(f=>{j[f]=!1})}}),j},ie=async(s,a,j=!1,v)=>{if(I(!1),!l)return;let h={...l};if(a&&(o.current=le(h,a)),p&&v){const i=v.tested-v.correct;let u=c.FORGOT;i===0?u=c.EASY:i===1&&(u=c.HARD),x(X=>({...X,[l.id]:u}));const f=q(h,u);a&&(f.lastTestResults=o.current),f.masteryScore=Q(f),N(X=>new Map(X).set(f.id,f)),M(!1),n(),o.current=null;return}if(d==="random_test"){let i=j?"GAVE_UP":s===c.EASY?"PASS":"FAIL";x(f=>({...f,[l.id]:i}));const u=q(h,s);a&&(u.lastTestResults=o.current),u.masteryScore=Q(u),N(f=>new Map(f).set(u.id,u)),j?z(!0):n(),o.current=null}else{const i={...h};a&&(i.lastTestResults=o.current),i.masteryScore=Q(i),N(u=>new Map(u).set(i.id,i)),o.current=null}},oe=()=>{S.current=null,A()},ce=()=>{z(!0)};return e.jsx(Ae,{user:r,initialWords:m,sessionWords:O,sessionType:d,newWordIds:R,progress:y,setProgress:F,sessionOutcomes:P,sessionFinished:k,wordInModal:$,setWordInModal:V,editingWordInModal:J,setEditingWordInModal:Y,isTesting:L,setIsTesting:I,currentWord:l,isNewWord:K,onUpdate:g,onComplete:E,nextItem:n,handleReview:w,handleTestComplete:ie,handleRetry:oe,handleEndSession:ce,handleQuickReview:ne,handleManualPractice:ae,isQuickReviewMode:p})};export{Fe as default};
