import{c as O,Y as ie,r as n,k as b,aK as v,bj as we,j as e,D as L,z as ke,bE as Ne,ai as Y,as as Ce,ad as te,f as se,ay as ce,X as Q,bS as Me,M as Se,G as ze,aI as Te,ba as Oe}from"./index-COTiwjpc.js";import{C as ne}from"./chevron-left-_b4zwDFE.js";import{M as Ue}from"./music-CGwuyxzP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=O("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=O("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=O("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=O("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=O("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=O("PenTool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=O("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),Be=h=>{if(!h)return[];const w=h.split(`
`),P=[];let i=null;const j=()=>{i&&((i.content.trim()||i.title!=="Introduction")&&P.push(i),i=null)};return w.forEach(r=>{const p=r.match(/^#\s+(.+)/),M=r.match(/^##\s+(.+)/);p?(i||(i={title:"Introduction",content:""}),i.content+=r+`
`):M?(j(),i={title:M[1].trim(),content:r+`
`}):(i||(i={title:"Introduction",content:""}),i.content+=r+`
`)}),j(),P.length>0?P:[{title:"General",content:h}]},Ie=({courseId:h,courseTitle:w,isSystem:P,allowReadingUnitCreation:i,currentUser:j})=>{const{showToast:r}=ie(),[p,M]=n.useState([]),[q,H]=n.useState(null),[B,S]=n.useState(""),[g,z]=n.useState("home"),[T,k]=n.useState(!0),[I,U]=n.useState(!1),[f,y]=n.useState(0),[A,R]=n.useState(!1),D=n.useRef(null),[V,N]=n.useState(!1),[W,J]=n.useState(!1),[K,G]=n.useState(null),[C,E]=n.useState(""),[$,t]=n.useState(!1),[l,u]=n.useState(!1),o=n.useMemo(()=>p.find(s=>s.id===q),[p,q]),x=n.useMemo(()=>Be(B),[B]),d=x[f],X=n.useMemo(()=>d!=null&&d.content.match(/^##\s+(.+)/)?2:d!=null&&d.content.match(/^###\s+(.+)/)?3:0,[d]),Z=async()=>{if(!(!o||!d||!j)){t(!0);try{const s=b(),a=v(s),c=await fetch(`${a}/api/units`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:j.id,name:d.title,description:`Created from ${w}/${o.title}`,essay:d.content.replace(/^##\s+(.+)/,"").replace(/^###\s+(.+)/,"").trim(),tags:["reading_unit",w.toLowerCase().replace(/\s/g,"_"),o.title.toLowerCase().replace(/\s/g,"_")]})});if(c.ok)r("Reading unit created successfully!","success"),u(!1);else{const m=await c.json();r(m.error||"Failed to create reading unit","error")}}catch(s){console.error("Failed to create reading unit",s),r("Failed to create reading unit","error")}finally{t(!1)}}},F=n.useCallback(async()=>{k(!0);try{const s=b(),a=v(s),c=await fetch(`${a}/api/courses/${h}/modules`);if(c.ok){const m=await c.json();M(m)}}catch(s){console.error("Failed to load modules",s),r("Failed to load modules","error")}finally{k(!1)}},[h,r]),xe=n.useCallback(async s=>{k(!0);try{const a=b(),c=v(a),m=await fetch(`${c}/api/courses/${h}/modules/${s}`);if(m.ok){const _=await m.json();S(_.content||""),y(0)}}catch(a){console.error("Failed to load module content",a),r("Failed to load module content","error")}finally{k(!1)}},[h,r]);n.useEffect(()=>{F()},[F]);const he=s=>{H(s.id),xe(s.filename),z("module")},me=async()=>{if(o){U(!0);try{const s=b(),a=v(s);if((await fetch(`${a}/api/courses/${h}/modules/${o.filename}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:B})})).ok)r("Module content saved","success"),z("module");else throw new Error("Save failed")}catch(s){console.error("Failed to save content",s),r("Failed to save content","error")}finally{U(!1)}}},pe=async()=>{if(C.trim()){t(!0);try{const s=b(),a=v(s);(await fetch(`${a}/api/courses/${h}/modules`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:C})})).ok?(r("Module created successfully","success"),N(!1),E(""),F()):r("Failed to create module","error")}catch(s){console.error(s),r("Failed to create module","error")}finally{t(!1)}}},ge=async()=>{if(!(!K||!C.trim())){t(!0);try{const s=b(),a=v(s),c=await fetch(`${a}/api/courses/${h}/modules/${K.filename}/rename`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newTitle:C})});if(c.ok)r("Module renamed successfully","success"),J(!1),G(null),E(""),F();else{const m=await c.json();r(m.error||"Failed to rename module","error")}}catch(s){console.error(s),r("Failed to rename module","error")}finally{t(!1)}}},fe=(s,a)=>{a.stopPropagation(),G(s),E(s.title),J(!0)},be=async(s,a)=>{if(a.stopPropagation(),!!window.confirm("Are you sure you want to delete this module?"))try{const c=b(),m=v(c);(await fetch(`${m}/api/courses/${h}/modules/${s}`,{method:"DELETE"})).ok?(r("Module deleted successfully","success"),F()):r("Failed to delete module","error")}catch(c){console.error(c),r("Failed to delete module","error")}},oe=async(s,a,c)=>{if(c.stopPropagation(),a==="up"&&s===0||a==="down"&&s===p.length-1)return;const m=[...p],_=a==="up"?s-1:s+1;[m[s],m[_]]=[m[_],m[s]],M(m);try{const ee=b(),je=v(ee);(await fetch(`${je}/api/courses/${h}/modules/order`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderedFilenames:m.map(ye=>ye.filename)})})).ok||r("Failed to reorder modules","error"),F()}catch(ee){console.error(ee),r("Failed to reorder modules","error"),F()}};n.useEffect(()=>{const s=a=>{D.current&&!D.current.contains(a.target)&&R(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const ve=n.useMemo(()=>we((d==null?void 0:d.content)||""),[d]);return T&&g==="home"&&p.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"h-full flex flex-col bg-neutral-50/30",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 py-3 border-b flex items-center justify-between bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g!=="home"&&e.jsx("button",{onClick:()=>z("home"),className:"p-2 hover:bg-neutral-100 rounded-full transition-colors text-neutral-500",title:"Back to Home",children:e.jsx(ke,{size:20})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-sm font-black text-neutral-900 tracking-tight",children:w}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:g==="home"?"Course Overview":g==="edit"?"Editor":o==null?void 0:o.title})]})]}),g==="module"&&x.length>1&&e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(Math.max(0,f-1)),disabled:f===0,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 disabled:opacity-30 transition-colors",children:e.jsx(ne,{size:16})}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsx("button",{onClick:()=>R(!A),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-4 py-1 transition-colors min-w-[140px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-xs text-neutral-900 truncate max-w-[120px]",children:d==null?void 0:d.title}),e.jsx(Ne,{size:10,className:"text-neutral-400"})]})}),A&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-top z-50",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:x.map((s,a)=>e.jsxs("button",{onClick:()=>{y(a),R(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${a===f?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:[e.jsx("span",{className:"inline-block w-4 text-neutral-300 font-mono text-[10px]",children:a+1}),s.title]},a))})})]}),e.jsx("button",{onClick:()=>y(Math.min(x.length-1,f+1)),disabled:f===x.length-1,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 disabled:opacity-30 transition-colors",children:e.jsx(Y,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g==="edit"?e.jsxs("button",{onClick:me,disabled:I,className:"flex items-center gap-2 px-4 py-2 text-xs font-black bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 transition-all shadow-lg shadow-indigo-200 active:scale-95 uppercase tracking-widest",children:[I?e.jsx(L,{size:14,className:"animate-spin"}):e.jsx(Ce,{size:14}),"Save Changes"]}):g==="module"?e.jsxs("button",{onClick:()=>z("edit"),className:"flex items-center gap-2 px-4 py-2 text-xs font-black border-2 border-neutral-100 bg-white text-neutral-600 rounded-xl hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(ae,{size:14}),"Edit Content"]}):null,g==="module"&&P&&i&&(X===2||X===3)&&e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 text-xs font-black bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 disabled:opacity-50 transition-all shadow-lg shadow-emerald-200 active:scale-95 uppercase tracking-widest",children:[e.jsx(te,{size:14}),"Create Reading Unit"]})]})]}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:g==="home"?e.jsx("div",{className:"h-full overflow-y-auto p-8 md:p-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-10 text-center relative",children:[e.jsx("h1",{className:"text-3xl font-black text-neutral-900 tracking-tight mb-2",children:w}),e.jsx("p",{className:"text-sm font-medium text-neutral-500",children:"Master your skills with structured lessons and interactive practice."}),e.jsx("button",{onClick:()=>N(!0),className:"absolute right-0 top-0 p-3 bg-neutral-900 text-white rounded-xl shadow-lg hover:bg-neutral-800 transition-all active:scale-95",title:"Add Module",children:e.jsx(te,{size:20})})]}),T?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-neutral-300"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map((s,a)=>e.jsxs("div",{onClick:()=>he(s),className:"group relative flex flex-col items-start p-6 bg-white border-2 border-neutral-100 rounded-3xl hover:border-indigo-500 hover:shadow-xl hover:shadow-indigo-500/10 transition-all text-left active:scale-[0.98] cursor-pointer",children:[e.jsxs("div",{className:"w-full flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-neutral-50 flex items-center justify-center text-neutral-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors",children:e.jsx(se,{size:20})}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:c=>oe(a,"up",c),disabled:a===0,className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-30",children:e.jsx(ue,{size:14})}),e.jsx("button",{onClick:c=>oe(a,"down",c),disabled:a===p.length-1,className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-30",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:c=>fe(s,c),className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:e.jsx(ae,{size:14})}),e.jsx("button",{onClick:c=>be(s.filename,c),className:"p-1.5 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(ce,{size:14})})]})]}),e.jsxs("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-1",children:["Module ",a+1]}),e.jsx("h3",{className:"text-base font-black text-neutral-900 group-hover:text-indigo-600 transition-colors leading-tight",children:s.title}),e.jsxs("div",{className:"mt-4 flex items-center gap-1.5 text-[10px] font-bold text-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity",children:["Start Learning ",e.jsx(Y,{size:12})]})]},s.id))})]})}):g==="edit"?e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("textarea",{value:B,onChange:s=>S(s.target.value),className:"flex-grow w-full p-8 text-sm resize-none focus:outline-none font-mono leading-relaxed bg-neutral-50/50",placeholder:"# Module Title\\n\\nIntro content...\\n\\n## Section 1\\n\\nContent..."})}):e.jsx("div",{className:"h-full overflow-y-auto px-6 py-4 md:px-8 md:py-6 bg-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"prose prose-neutral max-w-none prose-headings:font-black prose-headings:tracking-tight prose-p:leading-relaxed prose-strong:font-black prose-a:text-indigo-600 prose-img:rounded-3xl prose-img:shadow-xl",dangerouslySetInnerHTML:{__html:ve}}),e.jsxs("div",{className:"mt-16 pt-8 border-t flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>y(Math.max(0,f-1)),disabled:f===0,className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-sm text-neutral-500 hover:bg-neutral-100 disabled:opacity-0 transition-colors",children:[e.jsx(ne,{size:18})," Previous"]}),e.jsx("button",{onClick:()=>z("home"),className:"px-4 py-2 rounded-xl font-black text-[10px] uppercase tracking-widest text-neutral-400 hover:text-neutral-900 hover:bg-neutral-50 transition-colors",children:"Back to Overview"}),e.jsxs("button",{onClick:()=>y(Math.min(x.length-1,f+1)),disabled:f===x.length-1,className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-sm text-indigo-600 hover:bg-indigo-50 disabled:opacity-0 transition-colors",children:["Next ",e.jsx(Y,{size:18})]})]})]})})}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"New Module"}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(Q,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 uppercase tracking-widest mb-2",children:"Module Title"}),e.jsx("input",{type:"text",value:C,onChange:s=>E(s.target.value),className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-neutral-900 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"e.g. Introduction to Phonetics",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>N(!1),className:"px-6 py-3 rounded-xl font-bold text-neutral-500 hover:bg-neutral-100 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:pe,disabled:!C.trim()||$,className:"px-6 py-3 rounded-xl font-black text-white bg-neutral-900 hover:bg-neutral-800 disabled:opacity-50 transition-colors flex items-center gap-2",children:[$&&e.jsx(L,{size:16,className:"animate-spin"}),"Create Module"]})]})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Create Reading Unit"}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 hover:bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(Q,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-neutral-700",children:"This will create a new Reading Unit from the current section:"}),e.jsxs("p",{className:"font-bold text-neutral-900",children:["Title: ",d==null?void 0:d.title]}),e.jsxs("p",{className:"text-neutral-600",children:["Description: Created from ",w,"/",o==null?void 0:o.title]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-6 py-3 rounded-xl font-bold text-neutral-500 hover:bg-neutral-100 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:Z,disabled:$,className:"px-6 py-3 rounded-xl font-black text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 transition-colors flex items-center gap-2",children:[$&&e.jsx(L,{size:16,className:"animate-spin"}),"Confirm Create"]})]})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Rename Module"}),e.jsx("button",{onClick:()=>J(!1),className:"p-2 hover:bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(Q,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 uppercase tracking-widest mb-2",children:"Module Title"}),e.jsx("input",{type:"text",value:C,onChange:s=>E(s.target.value),className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-neutral-900 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"e.g. Introduction to Phonetics",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>J(!1),className:"px-6 py-3 rounded-xl font-bold text-neutral-500 hover:bg-neutral-100 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:ge,disabled:!C.trim()||$,className:"px-6 py-3 rounded-xl font-black text-white bg-neutral-900 hover:bg-neutral-800 disabled:opacity-50 transition-colors flex items-center gap-2",children:[$&&e.jsx(L,{size:16,className:"animate-spin"}),"Save Changes"]})]})]})]})})]})},re=[{name:"BookOpen",icon:se},{name:"Video",icon:Ee},{name:"Mic",icon:Se},{name:"PenTool",icon:Re},{name:"GraduationCap",icon:ze},{name:"Globe",icon:Te},{name:"Layout",icon:Pe},{name:"Code",icon:Fe},{name:"Music",icon:Ue},{name:"Calculator",icon:$e},{name:"FlaskConical",icon:Le},{name:"Briefcase",icon:Oe}],le=[{bg:"bg-rose-50",text:"text-rose-600",border:"hover:border-rose-200",iconBg:"group-hover:bg-rose-100",hoverText:"group-hover:text-rose-700"},{bg:"bg-orange-50",text:"text-orange-600",border:"hover:border-orange-200",iconBg:"group-hover:bg-orange-100",hoverText:"group-hover:text-orange-700"},{bg:"bg-amber-50",text:"text-amber-600",border:"hover:border-amber-200",iconBg:"group-hover:bg-amber-100",hoverText:"group-hover:text-amber-700"},{bg:"bg-emerald-50",text:"text-emerald-600",border:"hover:border-emerald-200",iconBg:"group-hover:bg-emerald-100",hoverText:"group-hover:text-emerald-700"},{bg:"bg-cyan-50",text:"text-cyan-600",border:"hover:border-cyan-200",iconBg:"group-hover:bg-cyan-100",hoverText:"group-hover:text-cyan-700"},{bg:"bg-blue-50",text:"text-blue-600",border:"hover:border-blue-200",iconBg:"group-hover:bg-blue-100",hoverText:"group-hover:text-blue-700"},{bg:"bg-indigo-50",text:"text-indigo-600",border:"hover:border-indigo-200",iconBg:"group-hover:bg-indigo-100",hoverText:"group-hover:text-indigo-700"},{bg:"bg-violet-50",text:"text-violet-600",border:"hover:border-violet-200",iconBg:"group-hover:bg-violet-100",hoverText:"group-hover:text-violet-700"},{bg:"bg-fuchsia-50",text:"text-fuchsia-600",border:"hover:border-fuchsia-200",iconBg:"group-hover:bg-fuchsia-100",hoverText:"group-hover:text-fuchsia-700"},{bg:"bg-pink-50",text:"text-pink-600",border:"hover:border-pink-200",iconBg:"group-hover:bg-pink-100",hoverText:"group-hover:text-pink-700"}],Ge=({initialCourseId:h,onConsumeInitialCourseId:w,currentUser:P})=>{const{showToast:i}=ie(),[j,r]=n.useState([]),[p,M]=n.useState(null),[q,H]=n.useState(!0),[B,S]=n.useState(!1),[g,z]=n.useState(null),[T,k]=n.useState(""),[I,U]=n.useState("BookOpen"),[f,y]=n.useState(!1),[A,R]=n.useState(!1),[D,V]=n.useState(!1),N=async()=>{H(!0);try{const t=b(),l=v(t),u=await fetch(`${l}/api/courses`);if(u.ok){const o=await u.json();r(o)}}catch(t){console.error("Failed to load courses",t),i("Failed to load courses","error")}finally{H(!1)}};n.useEffect(()=>{N()},[i]),n.useEffect(()=>{if(h&&j.length>0){const t=j.find(l=>l.id===h);t&&(M(t),w&&w())}},[h,j,w]);const W=async()=>{if(T.trim()){V(!0);try{const t=b(),l=v(t),u=await fetch(`${l}/api/courses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:T,icon:I,isSystem:f,allowReadingUnitCreation:A})});if(u.ok)i("Course created successfully","success"),S(!1),k(""),U("BookOpen"),y(!1),N();else{const o=await u.json();i(o.error||"Failed to create course","error")}}catch(t){console.error(t),i("Failed to create course","error")}finally{V(!1)}}},J=async()=>{if(!(!g||!T.trim())){V(!0);try{const t=b(),l=v(t);(await fetch(`${l}/api/courses/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:T,icon:I,isSystem:f,allowReadingUnitCreation:A})})).ok?(i("Course updated successfully","success"),S(!1),z(null),k(""),U("BookOpen"),y(!1),N()):i("Failed to update course","error")}catch(t){console.error(t),i("Failed to update course","error")}finally{V(!1)}}},K=async(t,l)=>{if(l.stopPropagation(),l.preventDefault(),!!window.confirm("Are you sure you want to delete this course? This action cannot be undone."))try{const u=b(),o=v(u),x=await fetch(`${o}/api/courses/${t}`,{method:"DELETE"});if(x.ok)i("Course deleted successfully","success"),N();else{const d=await x.json();i(d.error||"Failed to delete course","error")}}catch(u){console.error(u),i("Failed to delete course","error")}},G=async(t,l,u)=>{u.stopPropagation(),u.preventDefault();const o=[...j];if(l==="up"&&t>0)[o[t],o[t-1]]=[o[t-1],o[t]];else if(l==="down"&&t<o.length-1)[o[t],o[t+1]]=[o[t+1],o[t]];else return;r(o);try{const x=b(),d=v(x),X=o.map(Z=>Z.id);await fetch(`${d}/api/courses/order`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderedIds:X})})}catch(x){console.error("Failed to reorder courses",x),i("Failed to save order","error"),N()}},C=()=>{z(null),k(""),U("BookOpen"),y(!1),R(!1),S(!0)},E=(t,l)=>{l.stopPropagation(),l.preventDefault(),z(t),k(t.title),U(t.icon||"BookOpen"),y(!!t.isSystem),R(!!t.allowReadingUnitCreation),S(!0)},$=t=>{const l=re.find(u=>u.name===t);return l?l.icon:se};return p?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 py-3 border-b flex items-center gap-3 bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[e.jsx("button",{onClick:()=>M(null),className:"text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors",children:"Courses"}),e.jsx(Y,{size:14,className:"text-neutral-300"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:p.title})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(Ie,{courseId:p.id,courseTitle:p.title,currentUser:P,isSystem:p.isSystem,allowReadingUnitCreation:p.allowReadingUnitCreation})})]}):e.jsxs("div",{className:"h-full overflow-y-auto bg-neutral-50/30",children:[e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Course Library"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"Select a course to start learning."})]}),e.jsxs("button",{onClick:C,className:"p-2.5 bg-neutral-900 text-white rounded-xl shadow-lg hover:bg-neutral-800 transition-all active:scale-95 flex items-center gap-2",title:"Create New Course",children:[e.jsx(te,{size:18}),e.jsx("span",{className:"text-xs font-bold hidden sm:inline",children:"New Course"})]})]}),q?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-neutral-300"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:j.map((t,l)=>{const u=$(t.icon),o=le[l%le.length];return e.jsxs("div",{onClick:()=>M(t),className:`group relative flex items-center p-4 bg-white border border-neutral-200 rounded-2xl ${o.border} hover:shadow-md transition-all text-left active:scale-[0.99] cursor-pointer h-24`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl ${o.bg} flex items-center justify-center ${o.text} ${o.iconBg} transition-colors mr-3 shrink-0`,children:e.jsx(u,{size:20})}),e.jsxs("div",{className:"flex-grow min-w-0 pr-16",children:[e.jsx("h3",{className:`text-sm font-black text-neutral-900 ${o.hoverText} transition-colors leading-tight line-clamp-2`,children:t.title}),t.isSystem&&e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-wider mt-1 block",children:"System"})]}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:x=>G(l,"up",x),disabled:l===0,className:"p-1.5 text-neutral-300 hover:text-neutral-600 hover:bg-neutral-100 rounded-lg disabled:opacity-30",title:"Move Up",children:e.jsx(ue,{size:14})}),e.jsx("button",{onClick:x=>G(l,"down",x),disabled:l===j.length-1,className:"p-1.5 text-neutral-300 hover:text-neutral-600 hover:bg-neutral-100 rounded-lg disabled:opacity-30",title:"Move Down",children:e.jsx(de,{size:14})})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:x=>E(t,x),className:"p-1.5 text-neutral-300 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(Me,{size:14})}),!t.isSystem&&e.jsx("button",{onClick:x=>K(t.id,x),className:"p-1.5 text-neutral-300 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(ce,{size:14})})]})]})]},t.id)})})]}),B&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:g?"Edit Course":"New Course"}),e.jsx("button",{onClick:()=>S(!1),className:"p-2 hover:bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(Q,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 uppercase tracking-widest mb-2",children:"Course Title"}),e.jsx("input",{type:"text",value:T,onChange:t=>k(t.target.value),className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-neutral-900 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"e.g. Advanced Grammar",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 uppercase tracking-widest mb-2",children:"Icon"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:re.map(({name:t,icon:l})=>e.jsx("button",{onClick:()=>U(t),className:`p-3 rounded-xl flex items-center justify-center transition-all ${I===t?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 scale-110":"bg-neutral-50 text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600"}`,children:e.jsx(l,{size:20})},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>y(t.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),e.jsx("span",{className:"text-sm font-bold text-neutral-700",children:"Mark as System Course"})]}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1 ml-6",children:"System courses cannot be deleted and have special behaviors."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:t=>R(t.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),e.jsx("span",{className:"text-sm font-bold text-neutral-700",children:"Allow Reading Unit Creation"})]}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1 ml-6",children:"If enabled, users can create Reading Units from level 2/3 sessions in this course."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-6 py-3 rounded-xl font-bold text-neutral-500 hover:bg-neutral-100 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:g?J:W,disabled:!T.trim()||D,className:"px-6 py-3 rounded-xl font-black text-white bg-neutral-900 hover:bg-neutral-800 disabled:opacity-50 transition-colors flex items-center gap-2",children:[D&&e.jsx(L,{size:16,className:"animate-spin"}),g?"Save Changes":"Create Course"]})]})]})]})})]})};export{Ge as CourseList};
