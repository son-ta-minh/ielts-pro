import{c as ce,r as a,y as de,j as e,A as J,a4 as pe,b as se,Y as ae,Z as ue,F as xe,P as K,E as he,G as ne,a0 as oe,g as me,am as Oe,d as Re,i as De,bk as V,h as Pe,x as Fe,bl as Me,bm as ze,a5 as te,q as Ue,e as Ge,a6 as re,bn as Y,bo as We,bp as _e}from"./index-BW-hC1Rh.js";import{R as Ve,a as Be,V as $e}from"./ResourceActions-C0MhwFZ-.js";import{T as ie,F as Ye}from"./TagBrowser-Cbj0Vmto.js";import{U as Je}from"./UniversalCard-C8LUGz8r.js";import{p as ge}from"./markdownParser-NDCOwRTZ.js";import{T as Ke}from"./target-DrQleIR5.js";import{F as He}from"./file-clock-BoefE8ut.js";import"./search-blkVTTR9.js";import"./chevron-left-DgKk1qXL.js";import"./circle-Be_S3Mb1.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ce("CopyPlus",[["line",{x1:"15",x2:"15",y1:"12",y2:"18",key:"1p7wdc"}],["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ce("Puzzle",[["path",{d:"M15.39 4.39a1 1 0 0 0 1.68-.474 2.5 2.5 0 1 1 3.014 3.015 1 1 0 0 0-.474 1.68l1.683 1.682a2.414 2.414 0 0 1 0 3.414L19.61 15.39a1 1 0 0 1-1.68-.474 2.5 2.5 0 1 0-3.014 3.015 1 1 0 0 1 .474 1.68l-1.683 1.682a2.414 2.414 0 0 1-3.414 0L8.61 19.61a1 1 0 0 0-1.68.474 2.5 2.5 0 1 1-3.014-3.015 1 1 0 0 0 .474-1.68l-1.683-1.682a2.414 2.414 0 0 1 0-3.414L4.39 8.61a1 1 0 0 1 1.68.474 2.5 2.5 0 1 0 3.014-3.015 1 1 0 0 1-.474-1.68l1.683-1.682a2.414 2.414 0 0 1 3.414 0z",key:"w46dr5"}]]);function Qe(s,p){const o=p.map(w=>`"${w}"`).join(", ");return`You are an expert IELTS coach and lexicographer, specializing in explaining nuanced differences between similar English words for a Vietnamese learner.

    TASK:
    Analyze a group of confusing English words/phrases. Your primary goal is to clarify the subtle differences in meaning, context, and usage.
    
    GROUP CONCEPT: "${s}"
    WORDS TO ANALYZE: [${o}]

    INSTRUCTIONS:
    1.  **Analyze & Suggest**: Analyze every word in the provided list. Additionally, suggest 1-3 NEW, highly relevant words/phrases that also fit the group concept. **When suggesting new words, prioritize words that represent a DIFFERENT LEVEL OF INTENSITY, especially extreme or high-impact words commonly used in IELTS Writing (e.g., agony, severe, intense).** Include these new suggestions in your analysis.
    2.  **Generate Table Data**: For each word (original and suggested), create a JSON object with four fields: "word", "explanation", "example", and "userNote".
        - **word**: The specific word or phrase being analyzed.
        - **explanation**: This is the most critical part. Follow these rules STRICTLY:
            1.  Focus on **one core idea** only.
            2.  Do NOT give formal dictionary definitions.
            3.  Keep it **short and memory-based** (easy to remember).
            4.  Always explain by **contrast**. Use a format like: "Use X for [core idea], not Y or Z which are for [other ideas]."
            5.  Highlight the single most important keyword or phrase with markdown bold (**key idea**).
        - **example**: A clear, concise example sentence that perfectly illustrates the unique usage of the word.
        - **userNote**: An empty string (""). This is a placeholder for the user's personal notes.
    3.  **Final JSON Output**: Your final response must be a single, strict JSON object with three keys:
        - \`title\`: **CRITICAL**: Identify the **most common, simplest word** in the group (the "anchor word" that everyone knows, e.g., "Big", "Small", "Stop", "Problem"). Set the title to **ONLY that specific word**. Do NOT add phrases like "Words for...". (e.g. if the list is "mitigate, alleviate, reduce", the title MUST be just "Reduce").
        - \`updatedWords\`: An array of strings containing ALL words analyzed (the original list PLUS your new suggestions).
        - \`comparisonData\`: An array of the JSON objects you created in step 2. The order of items in this array will determine the order in the final table.

    EXAMPLE SCENARIO:
    If input words are ["job", "work", "career"], a good explanation for "career" would be: "Use for your **long-term professional journey**, not a single 'job' or the general activity of 'work'."
    The Title would be: "Work".

    STRICT JSON RESPONSE FORMAT:
    {
      "title": "string (The single anchor word)",
      "updatedWords": ["original_word_1", "original_word_2", "new_suggestion_1"],
      "comparisonData": [
        {
          "word": "original_word_1",
          "explanation": "Use for **core idea 1**, not for the ideas of the other words.",
          "example": "A clear example sentence...",
          "userNote": ""
        },
        {
          "word": "original_word_2",
          "explanation": "Use for **core idea 2**, not for the ideas of the other words.",
          "example": "Another distinct example sentence...",
          "userNote": ""
        },
        {
          "word": "new_suggestion_1",
          "explanation": "Use for **new core idea**, not for the ideas of the others.",
          "example": "An example for the new word...",
          "userNote": ""
        }
      ]
    }
    `}function fe(s){const{topic:p,currentLesson:o,userRequest:w,language:c,targetAudience:f,tone:x,coachName:h}=s,i=c==="Vietnamese"?"Audio-VN":"Audio-EN",N=!!o;let b="",n="";return N&&o?(b="Refine and reformat the user's lesson notes into a structured, high-quality study resource.",n=`
    CURRENT CONTENT:
    Title: ${o.title}
    Description: ${o.description}
    Body:
    ${o.content||"(empty)"}
    
    USER INSTRUCTIONS: "${w||"Format deeply, improve structure, correct errors, and add educational value."}"
    `):(b=`Create a brand new lesson for a ${f} on topic: "${p||"General Knowledge"}".`,n=`USER REQUEST: "${w||"Create a comprehensive lesson."}"`),`You are an expert educational content designer and IELTS coach.
  ROLE: You are '${h}', acting as a ${x==="friendly_elementary"?"friendly teacher":"professional professor"}.
    
  TASK: ${b}

  ${n}

  STRICT LANGUAGE RULES:
  1. CORE MATERIAL (Vocabulary Lists, Example Sentences, Exercises): Must be in English.
  2. META CONTENT (Greetings, CONCEPT DEFINITIONS, Explanations, Strategy Tips): In ${c}.

  FORMATTING RULES (CRITICAL):
  - **VOCAB LISTS**: List simple words on a SINGLE line separated by commas.
  - **NUMBERED LISTS**: Use sequential numbering (e.g., 1., 2., 3.) for ordered lists.
  - **DEFINITIONS**: Treat definitions as explanations. They MUST be spoken in ${c}.
  - **CONCISE TITLE**: Keep the title short and direct.
  - **TITLE OVERRIDE RULE**: If it's a pattern, use the BASE form (e.g., "be associated with", not "is associated with").
  - **COMPACT SPACING**: Keep the text dense. No extra empty lines between headings and content.

  INTERACTIVE ELEMENTS SYNTAX:
  1. **Hidden Answer**: Use \`[HIDDEN: content]\` for answers that should be hidden initially.
  2. **Tips**: Use \`[Content]\` (text inside brackets on a NEW LINE) for tips and notes.
  3. **Fill-in Quiz**: Use \`[Quiz: answer]\` for a text input field checking against 'answer'.
  4. **Multiple Choice**: Use \`[Multi: Correct Answer | Wrong Option | Wrong Option]\`. The FIRST option provided must be the correct one. The system will shuffle them automatically.
  5. **Dropdown Select**: Use \`[Select: Correct Answer | Wrong Option | Wrong Option]\`. It renders as a dropdown menu. The FIRST option provided must be the correct one. The system will shuffle them automatically. Use this for "Fill in the blank" exercises where you want to give hints.

  AUDIO BLOCK RULE (TOKEN SAVER - CRITICAL):
  - **WRAP ONLY META CONTENT**: Only wrap your explanations, greetings, and definitions inside \`[${i}]\` and \`[/]\`.
  - **EXCLUDE CORE MATERIAL**: Do NOT wrap vocabulary lists, exercises, or headers (##) inside audio tags.
  
  EXAMPLE OF CORRECT STRUCTURE:
    ## Key Concepts
    [${i}]
    ${c==="Vietnamese"?"Chào con! Hôm nay chúng mình sẽ học về...":"Hello! Today we will learn about..."}
    [/]
    [Make sure to practice these daily!]
    * Word1, Word2, Word3
    
    1. Select the correct word:
    [Multi: Apple | Car | Sky]
    
    2. Type the missing word:
    The sky is [Quiz: blue].
    
    3. Choose the best fit:
    The ocean is [Select: deep | high | tall].

  TAGGING (STRICT): Return exactly ONE tag from: ["Writing", "Speaking", "Listening", "Reading", "Grammar", "Writing Task 1", "Writing Task 2", "Speaking Academic", "Speaking Casual", "Pattern", "Comparison"].

  STRICT JSON OUTPUT FORMAT:
  {
    "title": "string",
    "description": "string",
    "content": "string (Markdown using the tags defined above)",
    "tags": ["string"]
  }`}const Ze=s=>{const{title:p,setTitle:o,description:w,setDescription:c,path:f,setPath:x,tagsInput:h,setTagsInput:i,content:N,setContent:b,isSaving:n,onSave:m,onPractice:k,onCancel:O,onOpenAiRefine:A}=s,[S,D]=a.useState(!1),L=a.useMemo(()=>ge(N),[N]);return a.useEffect(()=>(window.handleLessonSpeak=C=>{de(C)},()=>{delete window.handleLessonSpeak}),[]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:O,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(J,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:k,disabled:n,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(pe,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:A,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(se,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:m,disabled:n,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[n?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(ue,{size:14}),e.jsx("span",{children:n?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:p,onChange:C=>o(C.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Path"}),e.jsx("input",{type:"text",value:f,onChange:C=>x(C.target.value),placeholder:"e.g. /Grammar/Tenses",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(xe,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:h,onChange:C=>i(C.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 mb-1",children:"Short Description"}),e.jsx("textarea",{value:w,onChange:C=>c(C.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Content (Markdown)"}),e.jsxs("button",{onClick:()=>D(!S),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[S?e.jsx(K,{size:12}):e.jsx(he,{size:12}),e.jsx("span",{children:S?"Edit":"Preview"})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[600px] relative overflow-hidden",children:S?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:L}}):e.jsx("textarea",{value:N,onChange:C=>b(C.target.value),className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`# Lesson Heading

Write your lesson content here using Markdown...`,spellCheck:!1})})]})]})]})},et=({lesson:s,user:p,onSave:o,onPractice:w,onCancel:c})=>{const[f,x]=a.useState(s.title),[h,i]=a.useState(s.description||""),[N,b]=a.useState(s.path||"/"),[n,m]=a.useState((s.tags||[]).join(", ")),[k,O]=a.useState(s.content),[A,S]=a.useState(!1),[D,L]=a.useState(!1),{showToast:C}=ne(),l=s.topic1,v=s.topic2;a.useEffect(()=>{if(s.path===void 0&&s.tags){const y=s.tags||[],R=y.find(P=>P.startsWith("/")),j=y.filter(P=>!P.startsWith("/"));b(R||"/"),m(j.join(", "))}else b(s.path||"/"),m((s.tags||[]).join(", "))},[s]);const T=()=>{const y=n.split(",").map(R=>R.trim()).filter(Boolean);return{...s,title:f,description:h,topic1:l,topic2:v,path:N.trim(),tags:y,content:k,updatedAt:Date.now()}},E=()=>{S(!0);const y=T();o(y)},I=()=>{S(!0);const y=T();w(y)},$=y=>{var M,U,G;const R=me(),j=R.audioCoach.activeCoach,P=R.audioCoach.coaches[j].name;return fe({currentLesson:{title:f,description:h,content:k},userRequest:y.request,language:((M=p.lessonPreferences)==null?void 0:M.language)||"English",targetAudience:((U=p.lessonPreferences)==null?void 0:U.targetAudience)||"Adult",tone:((G=p.lessonPreferences)==null?void 0:G.tone)||"professional_professor",coachName:P})},z=y=>{x(y.title),i(y.description),O(y.content),!n.trim()&&y.tags&&y.tags.length>0&&m(y.tags.join(", ")),L(!1),C("Lesson content refined!","success")};return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{title:f,setTitle:x,description:h,setDescription:i,path:N,setPath:b,tagsInput:n,setTagsInput:m,content:k,setContent:O,isSaving:A,onSave:E,onPractice:I,onCancel:c,onOpenAiRefine:()=>L(!0)}),D&&e.jsx(oe,{isOpen:D,onClose:()=>L(!1),type:"REFINE_UNIT",title:"Refine Lesson Content",description:"AI will format your notes into Markdown, fix errors, and add structure.",onGeneratePrompt:$,onJsonReceived:z,actionLabel:"Apply Changes"})]})},tt=({lesson:s,onComplete:p,onEdit:o})=>{const w=a.useMemo(()=>ge(s.content),[s.content]);return a.useEffect(()=>(window.handleLessonSpeak=c=>{de(c)},()=>{delete window.handleLessonSpeak}),[]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-20 animate-in fade-in duration-300",children:[e.jsxs("header",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:p,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(J,{size:14}),e.jsx("span",{children:"Back to Library"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:s.title}),s.description&&e.jsx("p",{className:"text-neutral-500 font-medium",children:s.description})]})]}),e.jsx("button",{onClick:o,className:"p-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(K,{size:18})})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px]",children:e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:w}})})]})},st=({lesson:s,onComplete:p,onEdit:o})=>e.jsx(tt,{lesson:s,onComplete:p,onEdit:o}),at=({text:s})=>{if(!s)return null;const p=s.split(/(\*\*.*?\*\*)/g);return e.jsx(e.Fragment,{children:p.map((o,w)=>o.startsWith("**")&&o.endsWith("**")?e.jsx("strong",{className:"font-bold text-neutral-900",children:o.slice(2,-2)},w):o)})},nt=({group:s,libraryWords:p,noteSavingStatus:o,onBack:w,onEdit:c,onNoteChange:f})=>e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:w,className:"flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(J,{size:14}),e.jsx("span",{children:"Back to Library"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xe,{size:28,className:"text-purple-500"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:s.name})]})]}),e.jsxs("button",{onClick:c,className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(K,{size:14}),e.jsx("span",{children:"Edit Group"})]})]}),e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm overflow-hidden min-h-[400px]",children:s.comparisonData.length===0?e.jsxs("div",{className:"text-center p-20 text-neutral-400",children:[e.jsx(Oe,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold",children:"No analysis data available."}),e.jsx("p",{className:"text-sm",children:'Use "Refine with AI" in Edit mode to generate comparisons.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"bg-neutral-50/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-6 text-[10px] font-black uppercase tracking-widest text-neutral-400 w-1/6",children:"Word"}),e.jsx("th",{className:"p-6 text-[10px] font-black uppercase tracking-widest text-neutral-400 w-1/3",children:"Nuance & Usage"}),e.jsx("th",{className:"p-6 text-[10px] font-black uppercase tracking-widest text-neutral-400 w-1/3",children:"Example"}),e.jsx("th",{className:"p-6 text-[10px] font-black uppercase tracking-widest text-neutral-400 w-1/6",children:"Notes"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:s.comparisonData.map((x,h)=>e.jsxs("tr",{className:"group hover:bg-neutral-50/30 transition-colors",children:[e.jsx("td",{className:"p-6 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg text-neutral-900",children:x.word}),p.has(x.word.toLowerCase())&&e.jsx("span",{title:"In Library",children:e.jsx(he,{size:14,className:"text-neutral-300"})})]})}),e.jsx("td",{className:"p-6 align-top",children:e.jsx("div",{className:"text-sm text-neutral-600 leading-relaxed font-medium",children:e.jsx(at,{text:x.explanation})})}),e.jsx("td",{className:"p-6 align-top",children:e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-xl border border-neutral-100 text-sm italic text-neutral-600",children:['"',x.example,'"']})}),e.jsx("td",{className:"p-6 align-top",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:x.userNote||"",onChange:i=>f(h,i.target.value),placeholder:"Add note...",rows:3,className:"w-full bg-transparent border-b border-transparent focus:border-neutral-300 focus:bg-white p-2 rounded-lg text-xs font-medium text-neutral-600 resize-none outline-none transition-all"}),e.jsxs("div",{className:"absolute top-2 right-2 pointer-events-none",children:[o[h]==="saving"&&e.jsx(ae,{size:12,className:"animate-spin text-neutral-400"}),o[h]==="saved"&&e.jsx(Re,{size:12,className:"text-green-500"})]})]})})]},h))})]})})})]}),ot=({group:s,onBack:p,onEdit:o})=>{const[w,c]=a.useState(new Set),[f,x]=a.useState({}),h=a.useRef({}),[i,N]=a.useState(s);a.useEffect(()=>{const n=De();c(new Set(n.map(m=>m.word.toLowerCase()))),N(s)},[s]);const b=(n,m)=>{const k=[...i.comparisonData];k[n]={...k[n],userNote:m};const O={...i,comparisonData:k};N(O),x(A=>({...A,[n]:"saving"})),h.current[n]&&clearTimeout(h.current[n]),h.current[n]=window.setTimeout(async()=>{await V({...O,updatedAt:Date.now()}),x(A=>({...A,[n]:"saved"})),setTimeout(()=>x(A=>({...A,[n]:null})),2e3)},1e3)};return e.jsx(nt,{group:i,libraryWords:w,noteSavingStatus:f,onBack:p,onEdit:o,onNoteChange:b})},rt=({name:s,setName:p,wordsInput:o,setWordsInput:w,path:c,setPath:f,tagsInput:x,setTagsInput:h,isSaving:i,onSave:N,onCancel:b,onOpenAiRefine:n})=>e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:b,className:"flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider mb-1",children:[e.jsx(J,{size:14}),e.jsx("span",{children:"Cancel"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Comparison"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:n,className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all",children:[e.jsx(se,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:N,disabled:i,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[i?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(ue,{size:14}),e.jsx("span",{children:"Save"})]})]})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Group Name"}),e.jsx("input",{type:"text",value:s,onChange:m=>p(m.target.value),placeholder:"e.g. Words for 'Big'",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Words to Compare"}),e.jsx("textarea",{value:o,onChange:m=>w(m.target.value),rows:8,placeholder:"Enter words (one per line or comma separated)...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none resize-none"}),e.jsx("p",{className:"text-[10px] text-neutral-400 px-1 italic",children:"Tip: Use AI Refine to automatically generate explanations for these words."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Path"}),e.jsx("input",{type:"text",value:c,onChange:m=>f(m.target.value),placeholder:"e.g. /Vocabulary/Nuance",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Tags"}),e.jsx("input",{type:"text",value:x,onChange:m=>h(m.target.value),placeholder:"e.g. Adjectives, Formal",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]})]})]}),it=({group:s,onSave:p,onCancel:o,user:w})=>{const[c,f]=a.useState(s.name),[x,h]=a.useState(s.words.join(`
`)),[i,N]=a.useState(s.path||"/"),[b,n]=a.useState((s.tags||[]).join(", ")),[m,k]=a.useState(!1),[O,A]=a.useState(!1),{showToast:S}=ne();a.useEffect(()=>{if(s.path===void 0&&s.tags){const l=s.tags||[],v=l.find(E=>E.startsWith("/")),T=l.filter(E=>!E.startsWith("/"));N(v||"/"),n(T.join(", "))}else N(s.path||"/"),n((s.tags||[]).join(", "))},[s]);const D=async()=>{k(!0);const l=x.split(/[\n,;]+/).map(I=>I.trim()).filter(Boolean),v=b.split(",").map(I=>I.trim()).filter(Boolean);v.some(I=>I.toLowerCase()==="comparison")||v.push("Comparison");const T=(s.comparisonData||[]).filter(I=>l.includes(I.word)),E={...s,name:c,words:l,path:i.trim(),tags:v,comparisonData:T,updatedAt:Date.now()};await V(E),p(E),k(!1)},L=()=>{const l=x.split(/[\n,;]+/).map(v=>v.trim()).filter(Boolean);return Qe(c,l)},C=l=>{if(l.updatedWords&&l.comparisonData){h(l.updatedWords.join(`
`)),l.title&&f(l.title);const v=b.split(",").map(E=>E.trim()).filter(Boolean);v.some(E=>E.toLowerCase()==="comparison")||(v.push("Comparison"),n(v.join(", ")));const T={...s,name:l.title||c,words:l.updatedWords,comparisonData:l.comparisonData,tags:v,path:i,updatedAt:Date.now()};V(T).then(()=>{p(T),S("Group refined and saved!","success")}),A(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(rt,{name:c,setName:f,wordsInput:x,setWordsInput:h,path:i,setPath:N,tagsInput:b,setTagsInput:n,isSaving:m,onSave:D,onCancel:o,onOpenAiRefine:()=>A(!0)}),O&&e.jsx(oe,{isOpen:O,onClose:()=>A(!1),type:"REFINE_WORDS",title:"Refine Comparison",description:"AI will generate nuanced explanations and examples.",initialData:{},hidePrimaryInput:!0,onGeneratePrompt:L,onJsonReceived:C,actionLabel:"Apply & Save"})]})},lt={filterSchema:[],viewSchema:[]},le="vocab_pro_lesson_view_settings",bt=({user:s,onStartSession:p,onNavigate:o,onUpdateUser:w})=>{const[c,f]=a.useState([]),[x,h]=a.useState(!0),[i,N]=a.useState(null),[b,n]=a.useState(!1),[m,k]=a.useState(!1),[O,A]=a.useState(!1),[S,D]=a.useState("ALL"),[L,C]=a.useState("all"),[l,v]=a.useState("all"),[T,E]=a.useState(()=>Pe(le,{showDesc:!0,compact:!1})),[I,$]=a.useState(0),[z,y]=a.useState(12),[R,j]=a.useState("list"),[P,M]=a.useState(null),[U,G]=a.useState(null),[H,q]=a.useState(null),[X,Q]=a.useState(null),[we,Z]=a.useState(!1),{showToast:_}=ne();a.useEffect(()=>{Fe(le,T)},[T]);const W=a.useCallback(async()=>{h(!0);try{const[t,d]=await Promise.all([Me(s.id),ze(s.id)]),u=[...t.map(r=>({type:"ESSAY",data:r,path:r.path,tags:r.tags,date:r.createdAt})),...d.map(r=>({type:"COMPARISON",data:r,path:r.path,tags:r.tags,date:r.createdAt}))];f(u.sort((r,g)=>g.date-r.date))}finally{h(!1)}},[s.id]);a.useEffect(()=>{W()},[W]),a.useEffect(()=>{$(0)},[i,S,L,l,z]);const B=a.useMemo(()=>c.filter(t=>{var d,u;if(S!=="ALL"&&t.type!==S||L==="focused"&&!t.data.isFocused||l!=="all"&&t.data.focusColor!==l)return!1;if(i){if(i==="Uncategorized"){const r=t.path??(t.tags||[]).find(ee=>ee.startsWith("/"));if(r&&r!=="/")return!1}else if(!((d=t.path)!=null&&d.startsWith(i))&&!((u=t.tags)!=null&&u.includes(i)))return!1}return!0}),[c,i,S,L,l]),be=a.useMemo(()=>{const t=I*z;return B.slice(t,t+z)},[B,I,z]),Ne=()=>{f(t=>[...t].sort(()=>Math.random()-.5)),_("List shuffled!","success")},je=async()=>{H&&(await We(H.id),_("Lesson deleted.","success"),q(null),W())},ye=async()=>{X&&(await _e(X.id),_("Comparison deleted.","success"),Q(null),W())},ve=async t=>{await Y(t),_("Lesson saved!","success"),j("list"),M(null),W()},Se=async t=>{await V(t),_("Comparison saved!","success"),j("read_comparison"),G(t),W()};if(R==="read_lesson"&&P)return e.jsx(st,{lesson:P,onComplete:()=>j("list"),onEdit:()=>j("edit_lesson")});if(R==="edit_lesson"&&P)return e.jsx(et,{lesson:P,user:s,onSave:ve,onPractice:t=>{M(t),j("read_lesson")},onCancel:()=>j("list")});if(R==="read_comparison"&&U)return e.jsx(ot,{group:U,onBack:()=>j("list"),onEdit:()=>j("edit_comparison")});if(R==="edit_comparison"&&U)return e.jsx(it,{group:U,onSave:Se,onCancel:()=>j(U.words.length>0?"read_comparison":"list"),user:s});const Ce=()=>{const t={id:`lesson-${Date.now()}`,userId:s.id,topic1:"",topic2:"",title:"New Lesson",description:"",content:"",tags:[],createdAt:Date.now(),updatedAt:Date.now()};M(t),j("edit_lesson")},Te=()=>{const t={id:`cmp-${Date.now()}`,userId:s.id,name:"New Comparison",words:[],tags:[],comparisonData:[],createdAt:Date.now(),updatedAt:Date.now()};G(t),j("edit_comparison")},ke=async t=>{const{result:d,preferences:u}=t;JSON.stringify(s.lessonPreferences)!==JSON.stringify(u)&&await w({...s,lessonPreferences:u});const r={id:`lesson-ai-${Date.now()}`,userId:s.id,title:d.title,description:d.description,content:d.content,tags:d.tags||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"",topic2:""};await Y(r),_("Lesson created with AI!","success"),Z(!1),M(r),j("read_lesson"),W()},Ae=async(t,d)=>{if(t.type==="ESSAY"){const u={...t.data,focusColor:d||void 0,updatedAt:Date.now()};d||delete u.focusColor,f(r=>r.map(g=>g.type==="ESSAY"&&g.data.id===t.data.id?{...g,data:u}:g)),await Y(u)}else{const u={...t.data,focusColor:d||void 0,updatedAt:Date.now()};d||delete u.focusColor,f(r=>r.map(g=>g.type==="COMPARISON"&&g.data.id===t.data.id?{...g,data:u}:g)),await V(u)}},Ee=async t=>{const d=!t.data.isFocused;if(t.type==="ESSAY"){const u={...t.data,isFocused:d,updatedAt:Date.now()};f(r=>r.map(g=>g.type==="ESSAY"&&g.data.id===t.data.id?{...g,data:u}:g)),await Y(u)}else{const u={...t.data,isFocused:d,updatedAt:Date.now()};f(r=>r.map(g=>g.type==="COMPARISON"&&g.data.id===t.data.id?{...g,data:u}:g)),await V(u)}},Le=[{label:"AI Lesson",icon:se,onClick:()=>Z(!0)},{label:"New Comparison",icon:qe,onClick:Te},{label:"New Lesson",icon:Ue,onClick:Ce}],Ie=t=>{const d=window.CONFIG||me(),u=d.audioCoach.activeCoach,r=d.audioCoach.coaches[u].name;return fe({topic:t.topic,language:t.language,targetAudience:t.targetAudience,tone:t.tone,coachName:r})};return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),minorSkills:e.jsxs("button",{onClick:()=>o("IRREGULAR_VERBS"),className:"flex items-center gap-2 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-xs font-bold hover:bg-orange-100 transition-colors",children:[e.jsx(He,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Irregular Verbs"})]}),pagination:{page:I,totalPages:Math.ceil(B.length/z),onPageChange:$,pageSize:z,onPageSizeChange:y,totalItems:B.length},actions:e.jsx(Be,{viewMenu:e.jsx($e,{isOpen:O,setIsOpen:A,filterOptions:[{label:"All",value:"ALL",isActive:S==="ALL",onClick:()=>D("ALL")},{label:"Lesson",value:"ESSAY",isActive:S==="ESSAY",onClick:()=>D("ESSAY")},{label:"Comp.",value:"COMPARISON",isActive:S==="COMPARISON",onClick:()=>D("COMPARISON")}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Ke,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>C(L==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${L==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:L==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>v(l==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>v(l==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>v(l==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:T.showDesc,onChange:()=>E(t=>({...t,showDesc:!t.showDesc}))},{label:"Compact Mode",checked:T.compact,onChange:()=>E(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:b,onToggle:()=>{n(!b),k(!1)}},browseTags:{isOpen:m,onToggle:()=>{k(!m),n(!1)}},addActions:Le,extraActions:e.jsx("button",{onClick:Ne,disabled:c.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Ge,{size:16})})}),aboveGrid:e.jsxs(e.Fragment,{children:[b&&e.jsx(ie,{items:c,selectedTag:i,onSelectTag:N,forcedView:"groups",title:"Browse Groups",icon:e.jsx(Ye,{size:16})}),m&&e.jsx(ie,{items:c,selectedTag:i,onSelectTag:N,forcedView:"tags",title:"Browse Tags",icon:e.jsx(xe,{size:16})})]}),config:lt,activeFilters:{},onFilterChange:()=>{},isLoading:x,isEmpty:B.length===0,emptyMessage:"No items found matching your criteria.",children:()=>e.jsx(e.Fragment,{children:be.map(t=>{const d=t.type==="ESSAY",u=d?t.data.title:t.data.name,r=d?()=>{M(t.data),j("read_lesson")}:()=>{G(t.data),j("read_comparison")},g=d?()=>{M(t.data),j("edit_lesson")}:()=>{G(t.data),j("edit_comparison")},ee=d?()=>q(t.data):()=>Q(t.data);return e.jsx(Je,{title:u,path:t.path,tags:t.tags,compact:T.compact,onClick:r,focusColor:t.data.focusColor,onFocusChange:F=>Ae(t,F),isFocused:t.data.isFocused,onToggleFocus:()=>Ee(t),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),r()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(pe,{size:14})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),g()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(K,{size:14})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),ee()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(te,{size:14})})]}),children:T.showDesc&&(d?t.data.description&&e.jsx("p",{className:"line-clamp-2",children:t.data.description}):e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.data.words.slice(0,4).map(F=>e.jsx("span",{className:"px-2 py-0.5 bg-neutral-100 text-neutral-600 rounded text-[10px] font-bold",children:F},F)),t.data.words.length>4&&e.jsxs("span",{className:"text-[10px] text-neutral-400 font-bold",children:["+",t.data.words.length-4]})]}))},`${t.type}-${t.data.id}`)})})}),e.jsx(re,{isOpen:!!H,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:je,onClose:()=>q(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(re,{isOpen:!!X,title:"Delete Comparison?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:ye,onClose:()=>Q(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(oe,{isOpen:we,onClose:()=>Z(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:s.lessonPreferences,onGeneratePrompt:Ie,onJsonReceived:ke,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{bt as LessonLibraryV2};
