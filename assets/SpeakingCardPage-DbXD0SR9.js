import{c as Te,r as n,n as ot,z as lt,I as it,j as e,ar as W,D as ct,a7 as $,x as ue,a9 as ke,k as dt,H as Ae,X as xe,aO as ut,_ as xt,a1 as Se,bH as ht,bI as pt,bJ as H,bK as mt,aR as Ee,ap as Me,P as gt,bL as G,h as ft,bM as bt,$ as wt,bN as jt,bO as yt,bo as vt,bm as kt,E as St,A as Nt,a as Ct,aq as It,e as Ne,as as Tt,bp as At,br as Et}from"./index-DYhIwCf6.js";import{u as Mt,G as zt,U as Ot,a as Rt,R as Ft,b as Pt,V as Bt}from"./useShelfLogic-D6pK2ZB1.js";import{T as Ut}from"./TagBrowser-DqZ0x-XN.js";import{F as Lt,M as $t,A as Jt,R as Gt,U as Wt}from"./ShelfModals-BT9_zalU.js";import{M as _t}from"./move-7ay4kvnd.js";import{P as Dt}from"./pen-D5rYf6vN.js";import{L as Ht}from"./library-hIyowAQB.js";import{T as Vt}from"./target-46uWdCmU.js";import{S as qt}from"./square-check-big-DGGNzDvA.js";import{C as Kt}from"./chevron-left-Ck-FfZ7q.js";import{S as Yt}from"./school-mfQ_WyIX.js";import"./search-CZmdTd69.js";import"./circle-DVAJG8mm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=Te("AudioLines",[["path",{d:"M2 10v3",key:"1fnikh"}],["path",{d:"M6 6v11",key:"11sgs0"}],["path",{d:"M10 3v18",key:"yhl04a"}],["path",{d:"M14 8v7",key:"3a1oy3"}],["path",{d:"M18 5v13",key:"123xd1"}],["path",{d:"M22 10v3",key:"154ddg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=Te("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);function Zt(o,x){return`You are an expert English linguist and communication coach.
    
    TASK: Analyze a user's input to identify a core concept and example phrases. You MUST refine the provided phrases and generate additional ones to create a structured set of native-like expressions.

    RAW USER INPUT:
    "${o}"

    USER REFINEMENT REQUEST: "${x||"Generate a variety of expressions."}"

    INSTRUCTIONS:
    1.  **Analyze and Split Input (CRITICAL FIRST STEP)**:
        -   Read the "RAW USER INPUT". It may contain both a core concept and several example phrases, often separated by colons or newlines.
        -   **Identify the Core Concept**: Extract the main idea or topic (e.g., "Disagree", "Expressing excitement"). This will be the value for the "standard" field in your output JSON.
        -   **Extract Example Phrases**: Identify any full example sentences or phrases from the input. These are your primary material.

    2.  **Refine and Augment**:
        -   **MUST REFINE**: Take each "Example Phrase" you extracted. Improve its wording, identify its core 'anchor', and assign it to the most appropriate tone ('casual', 'semi-academic', or 'academic'). These refined phrases will form the base of your "answers" list.
        -   **MUST AUGMENT**: After refining the user's examples, check if you have at least one answer for EACH of the three tones. If any tone is missing, generate a NEW, high-quality expression for that tone.
        -   The final "answers" list must contain a mix of refined user examples and newly generated expressions, with at least one for each tone.

    3.  **Identify Anchor**: For EACH answer in your final list, identify the single most important keyword or short phrase. This is the 'anchor'.
    4.  **Create Sentence**: Write a full, natural example sentence for each expression.
    5.  **Keyword Highlighting**: In the 'sentence' field, you MUST highlight the core lexical chunk using curly braces \`{}\`. Example: "I'm {skeptical about} that."
    6.  **Add Optional Note**: If useful, add a brief 'note'. Use angle brackets \`<...>\` for grammar tips (e.g., preposition variations) inside the sentence. Example: "I'm {skeptical} about that <'skeptical' can be followed by 'about' or 'of'>".
    7.  **Format Final JSON**: The "standard" field must contain ONLY the core concept you identified. The "answers" list must contain the final, combined set of refined and augmented expressions.

    EXAMPLE WALKTHROUGH:
    -   RAW USER INPUT: "Disagree: Iâ€™m not convinced that would work\\nI'm strongly against..."
    -   Step 1 Result:
        -   Core Concept identified: "Expressing disagreement". This becomes the 'standard' value.
        -   Extracted examples: "I'm not convinced that would work", "I'm strongly against...".
    -   Step 2-7: You will now **refine** these two examples, assign them to tones, then **augment** by creating new expressions for any missing tones, and finally format them all into the final JSON.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (The extracted core concept, e.g., 'Expressing disagreement')",
      "answers": [
        {
          "tone": "casual",
          "anchor": "string (e.g., 'not buying it')",
          "sentence": "string (e.g., 'Honestly, I'm {not buying it}.')",
          "note": "string (e.g., 'A very informal way to show disbelief.')"
        },
        {
          "tone": "semi-academic",
          "anchor": "string (e.g., 'skeptical')",
          "sentence": "string (e.g., 'I'm a bit {skeptical of} that claim.')"
        },
        {
          "tone": "academic",
          "anchor": "string (e.g., 'reservations')",
          "sentence": "string (e.g., 'I {have some reservations about} the validity of this data.')",
          "note": "string (e.g., 'Use 'reservations' in formal contexts to express doubt politely.')"
        }
      ]
    }
    `}function es(o){return`You are an expert English linguist and communication coach.
    
    TASK: Merge the following speaking cards into a single, cohesive card.

    CARDS TO MERGE:
    ${JSON.stringify(o.map(a=>({standard:a.standard,answers:a.answers,note:a.note,tags:a.tags})),null,2)}

    INSTRUCTIONS:
    1.  **Synthesize Context**: Analyze the "standard" contexts from all cards and create a new, overarching "standard" context that covers all of them. For example, if you see "Expressing doubt" and "Showing skepticism", the new context could be "Expressing doubt and skepticism".
    2.  **Combine & De-duplicate Expressions**:
        -   Collect all unique expressions ('answers') from all cards.
        -   If two expressions are very similar, keep only the best one.
        -   Organize the final list of expressions logically by tone (casual, semi-academic, academic).
    3.  **Create a New Card**: Format the result as a single JSON object that follows the same structure as the input cards. The goal is to produce one high-quality card that replaces all the input cards.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (The new, synthesized core concept)",
      "answers": [
        {
          "tone": "casual",
          "anchor": "string (The core phrase)",
          "sentence": "string (Example sentence with {highlight})",
          "note": "string (Optional usage note)"
        }
      ]
    }
    `}const Ce="vocab_pro_speaking_card_view",Ie=({text:o})=>{const x=o.split(/({.*?}|\[.*?\]|<.*?>)/g);if(x.length===3&&x[0]===""&&x[2]===""&&x[1].startsWith("[")&&x[1].endsWith("]")){const a=x[1].slice(1,-1);return e.jsxs("div",{className:"flex items-start gap-3 my-2 p-3 bg-sky-50 border-l-4 border-sky-400 rounded-r-lg shadow-sm",children:[e.jsx(Ne,{size:18,className:"shrink-0 mt-0.5 text-sky-500"}),e.jsx("div",{className:"text-xs text-sky-900 font-medium leading-relaxed",children:a})]})}return e.jsx(e.Fragment,{children:x.map((a,i)=>{if(a.startsWith("{")&&a.endsWith("}"))return e.jsx("span",{className:"mx-0.5 px-1 py-0.5 rounded bg-amber-100 text-amber-800 font-bold font-mono text-[0.9em] border border-amber-200 inline-block shadow-sm",children:a.slice(1,-1)},i);if(a.startsWith("[")&&a.endsWith("]")){const f=a.slice(1,-1);return e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-sky-700 bg-sky-100 border border-sky-200 px-2 py-1 rounded-full font-medium",children:[e.jsx(Ne,{size:12}),f]},i)}if(a.startsWith("<")&&a.endsWith(">")){const f=a.slice(1,-1);return e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-slate-600 bg-slate-100 border border-slate-200 px-2 py-1 rounded-full font-medium italic",children:[e.jsx(Tt,{size:12}),f]},i)}return e.jsx("span",{children:a},i)})})},ts=({isOpen:o,onClose:x,onSave:a,initialData:i,onOpenAiRefine:f})=>{const[w,y]=n.useState(""),[j,g]=n.useState(""),[b,v]=n.useState(""),[h,p]=n.useState([]);n.useEffect(()=>{var l;o&&(y((i==null?void 0:i.standard)||""),v((i==null?void 0:i.note)||""),g(((l=i==null?void 0:i.tags)==null?void 0:l.join(", "))||""),p((i==null?void 0:i.answers)||[]))},[o,i]);const R=l=>{if(l.preventDefault(),!w.trim())return;const c=j.split(",").map(d=>d.trim()).filter(Boolean);a({standard:w.trim(),tags:c,note:b.trim(),answers:h})},M=()=>{f({standard:w,tags:j.split(",").map(l=>l.trim()).filter(Boolean),note:b,answers:h})},F=()=>{p(l=>[...l,{tone:"casual",anchor:"",sentence:"",note:""}])},k=(l,c,d)=>{p(P=>{const C=[...P];return C[l]={...C[l],[c]:d},C})},z=l=>{p(c=>c.filter((d,P)=>P!==l))},u=l=>{const c=l.target.value;if(!c.trim()){p([]);return}try{const d=JSON.parse(c);d.standard&&Array.isArray(d.answers)?(y(d.standard),p(d.answers)):Array.isArray(d.answers)&&p(d.answers)}catch{console.warn("Invalid JSON pasted")}};return o?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:R,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:i?"Edit Expression":"New Expression"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Define context and generate expressions."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:M,className:"p-2 bg-amber-50 text-amber-600 rounded-xl hover:bg-amber-100 transition-colors",title:"Generate/Refine with AI",children:e.jsx(ft,{size:18})}),e.jsx("button",{type:"button",onClick:x,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(xe,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Context / Standard Meaning"}),e.jsx("textarea",{value:w,onChange:l=>y(l.target.value),placeholder:"e.g., Expressing skepticism or doubt",rows:3,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium focus:ring-2 focus:ring-neutral-900 outline-none resize-none",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(bt,{size:12})," User Note (Optional)"]}),e.jsx("textarea",{rows:2,value:b,onChange:l=>v(l.target.value),placeholder:"Usage tips, nuance explanation...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none resize-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(Ae,{size:12})," Tags (Optional)"]}),e.jsx("input",{value:j,onChange:l=>g(l.target.value),placeholder:"Business, Casual, Speaking Part 3...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none"})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1.5",children:[e.jsx(Qt,{size:12})," Expressions (",h.length,")"]}),e.jsxs("button",{type:"button",onClick:F,className:"px-3 py-1.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-1.5 hover:bg-neutral-200 transition-colors",children:[e.jsx(ue,{size:14})," Add"]})]}),e.jsxs("div",{className:"space-y-3 max-h-[250px] overflow-y-auto -mr-3 pr-3 stable-scrollbar",children:[h.length===0&&e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-xl",children:[e.jsx("p",{className:"text-sm font-bold text-neutral-400",children:"No expressions yet."}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:'Click "Add" or paste JSON below.'})]}),h.map((l,c)=>e.jsxs("div",{className:"p-3 bg-white border border-neutral-200 rounded-xl space-y-2 relative group animate-in fade-in",children:[e.jsx("button",{type:"button",onClick:()=>z(c),className:"absolute top-2 right-2 p-1 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx($,{size:12})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:l.tone,onChange:d=>k(c,"tone",d.target.value),className:"px-2 py-1 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-bold text-neutral-600 focus:ring-1 focus:ring-neutral-900 outline-none",children:[e.jsx("option",{value:"casual",children:"Casual"}),e.jsx("option",{value:"semi-academic",children:"Semi-Academic"}),e.jsx("option",{value:"academic",children:"Academic"})]}),e.jsx("input",{type:"text",placeholder:"Anchor",value:l.anchor,onChange:d=>k(c,"anchor",d.target.value),className:"flex-1 px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-bold text-neutral-800 focus:ring-1 focus:ring-neutral-900 outline-none"})]}),e.jsx("textarea",{rows:2,placeholder:"Sentence (use {curly braces} to highlight)",value:l.sentence,onChange:d=>k(c,"sentence",d.target.value),className:"w-full px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-medium text-neutral-800 focus:ring-1 focus:ring-neutral-900 outline-none resize-none"}),e.jsx("input",{type:"text",placeholder:"Note (optional)",value:l.note||"",onChange:d=>k(c,"note",d.target.value),className:"w-full px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-[10px] font-medium text-neutral-500 focus:ring-1 focus:ring-neutral-900 outline-none"})]},c))]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Quick-add from JSON"}),e.jsx("textarea",{placeholder:"Paste JSON from AI here to populate expressions...",rows:2,onFocus:l=>l.target.select(),onChange:u,className:"w-full p-3 bg-neutral-50 border border-neutral-200 rounded-xl font-mono text-xs focus:ring-1 focus:ring-neutral-900 outline-none resize-none"})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(wt,{size:14})," Save"]})})]})}):null},ss=({item:o,viewSettings:x,isSelected:a,onSelect:i,onEdit:f,onDelete:w,onFocusChange:y,onToggleFocus:j,onPractice:g})=>{var v;const b=((v=o.answers)==null?void 0:v.length)||0;return e.jsxs(Wt,{title:o.standard,tags:x.showTags?o.tags:void 0,compact:x.compact,onClick:()=>b>0&&g(o),focusColor:o.focusColor,onFocusChange:h=>y(o,h),isFocused:o.isFocused,onToggleFocus:()=>j(o),isCompleted:o.focusColor==="green",className:a?"ring-2 ring-indigo-500 border-indigo-500":"",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),f(o)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(gt,{size:14})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),w(o)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",children:e.jsx($,{size:14})})]}),children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsx("button",{onClick:h=>{h.stopPropagation(),i(o.id)},className:`p-1 rounded-md transition-all duration-200 ${a?"bg-indigo-600 text-white":"bg-white/30 backdrop-blur-sm text-neutral-400 opacity-0 group-hover:opacity-100"}`,"aria-label":a?`Deselect ${o.standard}`:`Select ${o.standard}`,children:a?e.jsx(qt,{size:18}):e.jsx(Ee,{size:18})})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-500",children:b>0?`${b} expressions available`:"No expressions yet. Refine with AI!"}),e.jsxs("button",{onClick:h=>{h.stopPropagation(),g(o)},className:"flex items-center gap-2 px-4 py-2 bg-rose-500 text-white rounded-xl font-black text-xs uppercase tracking-wider hover:bg-rose-600 transition-all shadow-lg shadow-rose-200 active:scale-95 disabled:opacity-50",disabled:b===0,children:[e.jsx(Me,{size:14})," Speak"]})]})]},o.id)},ns=({isOpen:o,onClose:x,item:a})=>{const[i,f]=n.useState(0),[w,y]=n.useState(!1),[j,g]=n.useState(!1),[b,v]=n.useState(""),h=n.useRef(new vt);if(n.useEffect(()=>{o&&(f(0),y(!1),v(""),g(!1))},[o]),!o||!a||!a.answers||a.answers.length===0)return null;const p=a.answers[i],R=i===0,M=i===a.answers.length-1,F=async()=>{if(j)h.current.stop(),await At(),g(!1);else{v("");try{await Et(),g(!0),h.current.start((u,l)=>v(u+l),u=>{v(u),g(!1)})}catch(u){console.error(u),g(!1)}}},z=(u=>{switch(u){case"casual":return{icon:Xt,colorClass:"bg-sky-100 text-sky-700 border-sky-200",label:"Casual"};case"semi-academic":return{icon:Yt,colorClass:"bg-indigo-100 text-indigo-700 border-indigo-200",label:"Semi-Academic"};case"academic":return{icon:It,colorClass:"bg-purple-100 text-purple-700 border-purple-200",label:"Academic"};default:return{icon:W,colorClass:"bg-neutral-100 text-neutral-600 border-neutral-200",label:"Expression"}}})(p.tone);return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsx("header",{className:"px-6 py-4 flex justify-end items-center shrink-0",children:e.jsx("button",{type:"button",onClick:x,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(xe,{size:20})})}),e.jsxs("main",{className:"p-6 pt-0 flex-1 flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-neutral-800 tracking-tight",children:a.standard}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-black uppercase tracking-wider border ${z.colorClass}`,children:[e.jsx(z.icon,{size:12})," ",z.label]}),e.jsx("div",{className:"w-full min-h-[150px] p-6 bg-neutral-50 rounded-2xl border border-neutral-200 flex flex-col items-center justify-center",children:w?e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"text-xl font-medium leading-relaxed text-neutral-900",children:e.jsx(Ie,{text:p.sentence})}),p.note&&e.jsx("div",{className:"p-3 bg-sky-50 rounded-xl border border-sky-200 text-xs font-medium text-sky-800 leading-relaxed",children:e.jsx(Ie,{text:p.note})})]}):e.jsx("h2",{className:"text-4xl font-black text-neutral-900 animate-in fade-in duration-300",children:p.anchor})}),e.jsxs("button",{onClick:()=>y(u=>!u),className:"flex items-center gap-2 px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[w?e.jsx(kt,{size:14}):e.jsx(St,{size:14}),e.jsx("span",{children:w?"Hide Answer":"Show Answer"})]}),b&&e.jsxs("p",{className:"text-sm font-medium italic text-neutral-500 mt-4",children:['"',b,'"']})]}),e.jsxs("footer",{className:"px-6 py-6 border-t border-neutral-100 flex items-center justify-between shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:[e.jsx("button",{onClick:()=>{y(!1),f(u=>u-1)},disabled:R,className:"p-4 rounded-full bg-white border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30",children:e.jsx(Kt,{size:20})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>Nt(p.sentence),className:"p-5 rounded-full bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-100 hover:text-indigo-600 transition-colors shadow-sm",children:e.jsx(Me,{size:24})}),e.jsx("button",{onClick:F,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-lg transition-all ${j?"bg-red-500 text-white animate-pulse":"bg-rose-500 text-white hover:bg-rose-600"}`,children:j?e.jsx(Ee,{size:28,fill:"currentColor"}):e.jsx(W,{size:28})})]}),e.jsx("button",{onClick:()=>{y(!1),f(u=>u+1)},disabled:M,className:"p-4 rounded-full bg-white border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30",children:e.jsx(Ct,{size:20})})]})]})})},fs=({user:o,onNavigate:x})=>{var ye;const[a,i]=n.useState([]),[f,w]=n.useState([]),[y,j]=n.useState(!0),[g,b]=n.useState(!1),[v,h]=n.useState(!1),[p,R]=n.useState(()=>ot(Ce,{showTags:!0,compact:!1})),[M,F]=n.useState(0),[k,z]=n.useState(12),[u,l]=n.useState("all"),[c,d]=n.useState("all"),[P,C]=n.useState("LIST"),[N,_]=n.useState(null);n.useEffect(()=>{lt(Ce,p)},[p]);const[O,ze]=n.useState(null),[V,Oe]=n.useState(!1),[Re,D]=n.useState(!1),[q,K]=n.useState(null),[Y,Q]=n.useState(null),[he,X]=n.useState(!1),[Z,Fe]=n.useState(null),[pe,ee]=n.useState(!1),{showToast:I}=it(),[me,te]=n.useState(null),[E,se]=n.useState(new Set),{currentShelfName:ne,booksOnCurrentShelf:ae,allShelves:re,addShelf:Pe,renameShelf:Be,removeShelf:Ue,nextShelf:Le,prevShelf:$e}=Mt(f,"speaking_books_shelves"),[Je,oe]=n.useState(!1),[Ge,le]=n.useState(!1),[T,ie]=n.useState(null),[B,ce]=n.useState(null),A=async()=>{j(!0);const[t,s]=await Promise.all([ht(o.id),pt(o.id)]);i(t.sort((r,m)=>m.createdAt-r.createdAt)),w(s.sort((r,m)=>m.createdAt-r.createdAt)),j(!1)};n.useEffect(()=>{A()},[o.id]),n.useEffect(()=>{F(0)},[O,k,u,c]);const J=n.useMemo(()=>a.filter(t=>{var s,r;if(u==="focused"&&!t.isFocused||c!=="all"&&t.focusColor!==c)return!1;if(O){if(O==="Uncategorized"){if(t.path&&t.path!=="/")return!1}else if(!((s=t.path)!=null&&s.startsWith(O))&&!((r=t.tags)!=null&&r.includes(O)))return!1}return!0}),[a,O,u,c]),We=n.useMemo(()=>{const t=M*k;return J.slice(t,t+k)},[J,M,k]),_e=()=>{i(t=>[...t].sort(()=>Math.random()-.5)),I("Shuffled!","success")},De=()=>{K(null),D(!0)},ge=t=>{K(t),D(!0)},He=async()=>{Y&&(await jt(Y.id),Q(null),A())},Ve=async t=>{const s=Date.now();if(q)await G({...q,...t,updatedAt:s});else{const r={id:`ns-${s}-${Math.random()}`,userId:o.id,createdAt:s,updatedAt:s,...t};await G(r)}D(!1),A(),I("Saved successfully!","success")},fe=async(t,s)=>{const r={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete r.focusColor,i(m=>m.map(S=>S.id===t.id?r:S)),await G(r)},be=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};i(r=>r.map(m=>m.id===t.id?s:m)),await G(s)},qe=t=>{se(s=>{const r=new Set(s);return r.has(t)?r.delete(t):r.add(t),r})},we=n.useMemo(()=>a.filter(t=>E.has(t.id)),[a,E]),Ke=async t=>{if(!t||!t.standard||!Array.isArray(t.answers)){I("Invalid JSON format from AI for merging.","error");return}ee(!1),b(!0);try{const s=Date.now(),r=new Set;we.forEach(S=>{(S.tags||[]).forEach(U=>r.add(U))}),r.add("merged");const m={id:`ns-${s}-${Math.random()}`,userId:o.id,standard:t.standard,answers:t.answers,tags:Array.from(r),createdAt:s,updatedAt:s};await G(m),await yt(Array.from(E)),I(`Successfully merged ${E.size} cards!`,"success"),se(new Set),await A()}catch{I("Failed to merge cards.","error")}finally{b(!1)}},Ye=t=>{Be(t,async(r,m)=>{j(!0);const S=f.filter(U=>{const L=U.title.split(":");return(L.length>1?L[0].trim():"General")===r});await Promise.all(S.map(U=>{const L=U.title.split(":"),ve=L.length>1?L.slice(1).join(":").trim():L[0],rt=`${m}: ${ve}`;return H({...U,title:rt,updatedAt:Date.now()})})),await A()})&&le(!1)},je=async()=>{const t={id:`sb-${Date.now()}`,userId:o.id,title:`${ne}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#d81b60",icon:"ðŸ—£ï¸"};await H(t),await A(),_(t),C("BOOK_DETAIL"),I("New book created.","success")},de=t=>{if(!N)return;const s={...N,...t,updatedAt:Date.now()};w(r=>r.map(m=>m.id===s.id?s:m)),_(s),H(s)},Qe=async()=>{B&&(await mt(B.id),I("Book deleted.","success"),ce(null),await A())},Xe=async t=>{if(!T)return;const s=T.title.split(":"),r=s.length>1?s.slice(1).join(":").trim():s[0],m=`${t}: ${r}`,S={...T,title:m,updatedAt:Date.now()};await H(S),ie(null),await A(),I(`Moved to "${t}".`,"success")},Ze=n.useMemo(()=>N?N.itemIds.map(t=>{const s=a.find(r=>r.id===t);return s?{id:s.id,title:s.standard,subtitle:`${s.answers.length} expressions`,data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[N,a]),et=n.useMemo(()=>a.map(t=>({id:t.id,title:t.standard,subtitle:`${t.answers.length} expressions`,data:t})),[a]),tt=t=>{if(!N)return;const s=Array.from(new Set([...N.itemIds,...t]));de({itemIds:s})},st=t=>{if(!N)return;const s=N.itemIds.filter(r=>r!==t);de({itemIds:s})},nt=(t,s)=>{const r=t.data;fe(r,s)},at=t=>{const s=t.data;be(s)};return P==="BOOK_DETAIL"&&N?e.jsx(zt,{book:N,items:Ze,availableItems:et,onBack:()=>{_(null),C("SHELF"),A()},onUpdateBook:de,onAddItem:tt,onRemoveItem:st,onOpenItem:t=>te(t.data),onEditItem:t=>ge(t.data),onFocusChange:nt,onToggleFocus:at,itemIcon:e.jsx(W,{size:16})}):P==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>C("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(ct,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Speaking Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your speaking topics."})]}),e.jsxs("button",{onClick:()=>oe(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Lt,{size:14})," Add Shelf"]})]})]}),e.jsxs(Ot,{label:ne,onNext:re.length>1?Le:void 0,onPrev:re.length>1?$e:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>le(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Dt,{size:14})}),e.jsx("button",{onClick:Ue,disabled:ae.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx($,{size:14})})]}),isEmpty:ae.length===0,emptyAction:e.jsx("button",{onClick:je,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[ae.map(t=>{const s=t.title,r=s.split(":"),m=r.length>1?r.slice(1).join(":").trim():s;return e.jsx(Rt,{id:t.id,title:m,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(W,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{_(t),C("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),ie(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(_t,{size:16})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),ce(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx($,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:je,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(ue,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(ke,{isOpen:!!B,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(ye=B==null?void 0:B.title.split(":").pop())==null?void 0:ye.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Qe,onClose:()=>ce(null),icon:e.jsx($,{size:40,className:"text-red-500"})}),e.jsx($t,{isOpen:!!T,onClose:()=>ie(null),onConfirm:Xe,shelves:re,currentShelf:T?T.title.split(":")[0].trim():"General",bookTitle:(T==null?void 0:T.title)||""}),e.jsx(Jt,{isOpen:Je,onClose:()=>oe(!1),onSave:t=>{Pe(t)&&oe(!1)}}),e.jsx(Gt,{isOpen:Ge,onClose:()=>le(!1),onSave:Ye,initialName:ne})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{title:"Speaking Library",subtitle:"Master natural phrases and expressions for any context.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Microphone.png",className:"w-8 h-8 object-contain",alt:"Speaking"}),config:{},isLoading:y||g,isEmpty:J.length===0,emptyMessage:"No expressions found.",activeFilters:{},onFilterChange:()=>{},pagination:{page:M,totalPages:Math.ceil(J.length/k),onPageChange:F,pageSize:k,onPageSizeChange:z,totalItems:J.length},aboveGrid:e.jsx(e.Fragment,{children:V&&e.jsx(Ut,{items:a,selectedTag:O,onSelectTag:ze,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Ae,{size:16})})}),minorSkills:x?e.jsxs("button",{onClick:()=>x("MIMIC"),className:"flex items-center gap-2 px-3 py-2 bg-neutral-100 text-neutral-600 rounded-lg text-xs font-bold hover:bg-neutral-200 transition-colors",children:[e.jsx(W,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Pronunciation"})]}):void 0,actions:e.jsx(Pt,{viewMenu:e.jsx(Bt,{isOpen:v,setIsOpen:h,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Vt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>l(u==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${u==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:u==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(c==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>d(c==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>d(c==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Tags",checked:p.showTags,onChange:()=>R(t=>({...t,showTags:!t.showTags}))},{label:"Compact",checked:p.compact,onChange:()=>R(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:V,onToggle:()=>Oe(!V)},addActions:[{label:"Add",icon:ue,onClick:De}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_e,disabled:a.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(dt,{size:16})}),e.jsxs("button",{onClick:()=>C("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(Ht,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:We.map(t=>e.jsx(ss,{item:t,viewSettings:p,isSelected:E.has(t.id),onSelect:qe,onEdit:ge,onDelete:Q,onFocusChange:fe,onToggleFocus:be,onPractice:te},t.id))})}),E.size>0&&e.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-[150] w-full max-w-md px-4 animate-in slide-in-from-bottom-8",children:e.jsxs("div",{className:"bg-neutral-900 text-white rounded-2xl p-3 shadow-2xl flex items-center justify-between border border-neutral-800 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-2",children:[e.jsx("button",{onClick:()=>se(new Set),className:"p-1 text-neutral-500 hover:text-white",children:e.jsx(xe,{size:16})}),e.jsxs("span",{className:"text-sm font-bold",children:[E.size," selected"]})]}),e.jsxs("button",{onClick:()=>ee(!0),disabled:E.size<2||g,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-black text-xs flex items-center gap-2 uppercase tracking-wider hover:bg-indigo-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ut,{size:14})," Merge"]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-white/50 backdrop-blur-sm z-[250] flex items-center justify-center",children:e.jsx(xt,{size:32,className:"animate-spin text-neutral-900"})}),e.jsx(ts,{isOpen:Re,onClose:()=>D(!1),onSave:Ve,initialData:q,onOpenAiRefine:t=>{Fe(t),X(!0)}}),e.jsx(ke,{isOpen:!!Y,title:"Delete Card?",message:"Delete this expression?",confirmText:"Delete",isProcessing:!1,onConfirm:He,onClose:()=>Q(null),icon:e.jsx($,{size:40,className:"text-red-500"})}),he&&e.jsx(Se,{isOpen:he,onClose:()=>X(!1),type:"REFINE_UNIT",title:"Refine Expression",description:"Enter instructions for the AI to generate expressions.",initialData:{},onGeneratePrompt:t=>Zt((Z==null?void 0:Z.standard)||"",t.request),onJsonReceived:t=>{t.answers&&(K(s=>({...s||{id:"",userId:o.id,createdAt:0,updatedAt:0,standard:"",answers:[],tags:[],note:""},standard:t.standard,answers:t.answers})),X(!1),I("Refined! Expressions generated.","success"))},actionLabel:"Apply"}),pe&&e.jsx(Se,{isOpen:pe,onClose:()=>ee(!1),type:"REFINE_UNIT",title:"Merge Expressions",description:"AI will combine the selected cards into a single, cohesive one.",initialData:{},onGeneratePrompt:()=>es(we),onJsonReceived:Ke,actionLabel:"Apply Merge"}),e.jsx(ns,{isOpen:!!me,onClose:()=>te(null),item:me})]})};export{fs as SpeakingCardPage};
