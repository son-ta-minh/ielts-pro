import{c as Qe,r as s,j as e,X as fe,ag as be,K as ge,bA as je,S as qe,h as Ge,bB as Be,aA as He,ak as Je,J as me,bC as ve,V as Ve,I as Ye,A as Ke,b4 as Xe,M as Ze,aj as et,O as tt,aO as st,au as rt,a1 as xe,ai as he,bh as nt,a0 as at,bD as we,bE as lt,t as ot,k as it,aM as ct,aC as ut,bF as dt}from"./index-BG7yJco6.js";import{E as xt}from"./ear-SjBH9wQC.js";import{C as ht}from"./chevron-left-CPgLZRV7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=Qe("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ye=({isOpen:c,onClose:W,onSave:a,initialData:p})=>{const[h,m]=s.useState(""),_=s.useRef(null);s.useEffect(()=>{c&&(m((p==null?void 0:p.text)||""),setTimeout(()=>{var f;return(f=_.current)==null?void 0:f.focus()},100))},[c,p]);const $=f=>{f.preventDefault(),h.trim()&&a(h.trim())};return c?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:$,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:p?"Edit Phrase":"Add New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Enter the text you want to practice mimicking."})]}),e.jsx("button",{type:"button",onClick:W,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(fe,{size:20})})]}),e.jsx("main",{className:"p-8",children:e.jsx("textarea",{ref:_,value:h,onChange:f=>m(f.target.value),placeholder:"e.g. It's not a matter of if, but when.",rows:5,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-base leading-relaxed",required:!0})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(rt,{size:14})," Save Phrase"]})})]})}):null},mt=({score:c})=>c===void 0?e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-200",title:"Not practiced yet"}):e.jsx("div",{className:`flex items-center justify-center px-1.5 py-0.5 rounded-md ${c>=80?"bg-green-100 text-green-700":c>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.jsx("span",{className:"text-[9px] font-black",children:c})}),pt=({targetText:c,sourceWord:W,isRecording:a,isRevealed:p,userTranscript:h,userAudioUrl:m,onToggleRecord:_,onPlayTarget:$,onPlayUser:f,onToggleReveal:L,onNext:b,onClearTranscript:pe,isEmpty:ie,onClose:v,pagedItems:H,page:w,pageSize:O,totalPages:T,onPageChange:N,onPageSizeChange:ce,onSelect:P,currentAbsoluteIndex:ue,autoSpeak:F,onToggleAutoSpeak:n,autoReveal:k,onToggleAutoReveal:J,isGlobalMode:te,localAnalysis:g,onAddItem:V,onEditItem:U,onDeleteItem:de,onRandomize:Y,isModalOpen:D,editingItem:K,onCloseModal:se,onSaveItem:re,ipa:ne,showIpa:Q,isIpaLoading:A,onToggleIpa:X})=>{const[q,G]=s.useState(!0),[ae,S]=s.useState(null),[I,C]=s.useState(!1),[z,Z]=s.useState(()=>{const r=localStorage.getItem("mimic_play_speed");return r?Number(r):1}),M=s.useRef(null),j=s.useRef(null);s.useEffect(()=>{const r=j.current;r&&c&&setTimeout(()=>{if(!j.current)return;r.style.fontSize="1.5rem";const l=r.parentElement;if(l){const u=r.scrollWidth,i=l.clientWidth;if(u>i){const y=i/u*24;r.style.fontSize=`${Math.max(y,14)}px`}}},50)},[c]),s.useEffect(()=>{localStorage.setItem("mimic_play_speed",String(z))},[z]);const d=r=>{const l=r.toLowerCase().replace(/[^a-z]/g,"");if(!l)return 1;const u=l.match(/[aeiouy]+/g);return u?u.length:1},E=()=>{if(!c)return;const r=c.split(/\s+/);if(I){clearTimeout(M.current),C(!1),S(null);return}let l=0;C(!0);const u=()=>{if(l>=r.length){C(!1),S(null);return}S(l);const i=r[l];let B=400*d(i)/z;/[,.]/.test(i)&&(B+=300/z),/[!?;]/.test(i)&&(B+=500/z),/[:]/.test(i)&&(B+=400/z),l++,M.current=setTimeout(u,B)};u()};if(ie)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4 relative bg-white",children:[v&&e.jsx("button",{onClick:v,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(fe,{size:24})}),e.jsx("div",{className:"p-4 bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(xt,{size:40})}),e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Queue is Empty"}),e.jsxs("button",{onClick:V,className:"mt-4 px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(be,{size:14})," Add New"]})]}),e.jsx(ye,{isOpen:D,onClose:se,onSave:re,initialData:K})]});const R=te?"h-full":"h-full rounded-[2.5rem] shadow-sm border border-neutral-200";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex w-full bg-white relative overflow-hidden ${R}`,children:[e.jsxs("div",{className:`h-full border-r border-neutral-100 bg-neutral-50/50 flex flex-col shrink-0 transition-all duration-300 ease-in-out ${q?"w-80 opacity-100":"w-0 opacity-0 border-none overflow-hidden"}`,children:[e.jsx("div",{className:"p-4 border-b border-neutral-100 bg-white space-y-3 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-neutral-500",children:[e.jsx(ft,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Queue"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:J,className:`p-2 rounded-lg border transition-all shadow-sm ${k?"bg-sky-100 border-sky-200 text-sky-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Reveal Text: ${k?"ON":"OFF"}`,children:k?e.jsx(ge,{size:14}):e.jsx(je,{size:14})}),e.jsx("button",{onClick:n,className:`p-2 rounded-lg border transition-all shadow-sm ${F?"bg-amber-100 border-amber-200 text-amber-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Speak: ${F?"ON":"OFF"}`,children:e.jsx(qe,{size:14,fill:F?"currentColor":"none"})}),e.jsx("button",{onClick:Y,className:"p-2 bg-white border border-neutral-200 text-neutral-500 rounded-lg hover:text-indigo-600 transition-all shadow-sm",title:"Shuffle Queue",children:e.jsx(Ge,{size:14})}),e.jsx("button",{onClick:V,className:"p-2 bg-neutral-900 text-white border border-neutral-900 rounded-lg hover:bg-neutral-800 transition-all shadow-sm",children:e.jsx(be,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:H.map((r,l)=>{const i=w*O+l===ue;return e.jsxs("div",{className:`w-full text-left rounded-lg border transition-all group relative ${i?"bg-white border-neutral-900 shadow-sm ring-1 ring-neutral-900/5":"border-transparent hover:bg-neutral-100"}`,children:[e.jsxs("button",{onClick:()=>P(l),className:"w-full px-3 py-3 flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:e.jsx(mt,{score:r.lastScore})}),e.jsx("span",{className:`text-xs font-bold leading-snug line-clamp-2 ${i?"text-neutral-900":"text-neutral-600"}`,children:r.text})]}),e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 right-2 flex items-center bg-white/90 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm border border-neutral-100",children:[e.jsx("button",{onClick:()=>U(r),className:"p-1.5 text-neutral-400 hover:text-indigo-600",children:e.jsx(Be,{size:12})}),e.jsx("button",{onClick:()=>de(r),className:"p-1.5 text-neutral-400 hover:text-red-600",children:e.jsx(He,{size:12})})]})]},r.id)})}),e.jsxs("div",{className:"p-3 border-t border-neutral-100 bg-white flex items-center justify-between shrink-0",children:[e.jsx("select",{value:O,onChange:r=>ce(Number(r.target.value)),className:"bg-neutral-50 border border-neutral-200 rounded-lg px-2 py-1 text-[10px] font-bold text-neutral-600 focus:outline-none focus:ring-1 focus:ring-neutral-900",children:[10,15,20,30].map(r=>e.jsx("option",{value:r,children:r},r))}),T>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>N(w-1),disabled:w===0,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(ht,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 tabular-nums",children:[w+1,"/",T]}),e.jsx("button",{onClick:()=>N(w+1),disabled:w>=T-1,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Je,{size:16})})]})]})]}),e.jsxs("div",{className:"flex-1 h-full flex flex-col relative overflow-y-auto",children:[v&&e.jsx("button",{onClick:v,className:"absolute top-4 right-4 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full z-50",children:e.jsx(fe,{size:20})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-6 animate-in fade-in",children:[e.jsx("div",{className:"relative w-full max-w-2xl",children:e.jsxs("div",{className:"p-6 md:p-8 rounded-[2rem] border-2 text-center transition-all duration-300 min-h-[180px] flex flex-col items-center justify-center relative bg-white border-neutral-200 shadow-xl shadow-neutral-100",children:[e.jsx("button",{onClick:L,className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-indigo-500",children:p?e.jsx(je,{size:20}):e.jsx(ge,{size:20})}),e.jsxs("div",{className:"relative px-4 w-full flex flex-col items-center gap-4",children:[e.jsx("div",{ref:j,className:"flex flex-wrap justify-center gap-x-1.5 gap-y-1",style:{fontSize:"1.5rem",lineHeight:"1.4"},children:c==null?void 0:c.split(/\s+/).map((r,l)=>{const u=g==null?void 0:g.words[l];let i="text-neutral-800";if(u)switch(u.status){case"correct":i="text-emerald-600";break;case"near":i="text-amber-500";break;case"wrong":i="text-rose-500";break;case"missing":i="text-neutral-300";break;default:i="text-neutral-800"}const y=u&&u.status!=="missing";return e.jsx("span",{onClick:()=>me(r),onMouseEnter:()=>S(l),onMouseLeave:()=>S(null),className:`font-bold cursor-pointer transition-all leading-normal px-1 rounded ${i} ${ae===l?"bg-indigo-100/70":"bg-transparent"} ${p||y?"opacity-100":"text-transparent blur-md select-none"}`,children:e.jsx("span",{className:i,children:r})},l)})}),Q&&ne&&e.jsx("div",{className:"w-full self-stretch px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-2xl text-base font-mono font-normal text-neutral-600 leading-relaxed text-left animate-in slide-in-from-top-2 duration-500 flex flex-wrap gap-x-2 gap-y-1",children:ne.replace(/\//g,"").split(/\s+/).map((r,l)=>e.jsx("span",{className:`px-1 rounded transition-all ${ae===l?"bg-indigo-200 text-indigo-900":""}`,children:r},l))}),!p&&!g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-200 text-xs font-bold uppercase tracking-widest animate-pulse",children:"Speak to reveal result"})})]}),g&&e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-1 animate-in slide-in-from-top-2",children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Accuracy"}),e.jsxs("div",{className:`text-4xl font-black ${g.score>80?"text-emerald-500":g.score>50?"text-amber-500":"text-rose-500"}`,children:[g.score,"%"]})]})]})}),e.jsxs("div",{className:"min-h-16 flex flex-col items-center justify-center w-full max-w-xl text-center",children:[a?e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 animate-pulse",children:[e.jsx(ve,{size:24}),e.jsx("span",{className:"font-black text-sm uppercase tracking-widest",children:"Listening..."})]}):!h&&e.jsx("p",{className:"text-neutral-300 text-xs font-medium",children:"Tap the microphone and read the phrase aloud"}),h&&!a&&e.jsxs("div",{className:"space-y-1 animate-in fade-in",children:[e.jsx("p",{className:"text-neutral-400 text-[10px] font-black uppercase tracking-widest",children:"What we heard"}),e.jsxs("p",{className:"text-lg font-medium italic text-neutral-600 line-clamp-2",children:['"',h,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:$,className:"p-4 rounded-2xl bg-white border border-neutral-200 text-neutral-600 hover:text-indigo-600 shadow-sm transition-all active:scale-95",children:e.jsx(Ve,{size:24})}),e.jsx("button",{onClick:X,disabled:A,className:`p-4 rounded-2xl border transition-all shadow-sm ${Q?"bg-indigo-600 text-white shadow-lg scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Show Phonetic (IPA)",children:A?e.jsx(Ye,{size:24,className:"animate-spin"}):e.jsx(Ke,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:E,disabled:!c,className:`p-4 rounded-2xl border transition-all shadow-sm ${I?"bg-neutral-900 text-white scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Auto Highlight",children:e.jsx(ve,{size:24,className:I?"animate-pulse":""})}),e.jsxs("select",{value:z,onChange:r=>Z(Number(r.target.value)),className:"text-xs border border-neutral-200 rounded-lg px-2 py-1 bg-white",children:[e.jsx("option",{value:.5,children:"75 WPM"}),e.jsx("option",{value:.75,children:"110 WPM"}),e.jsx("option",{value:1,children:"150 WPM"}),e.jsx("option",{value:1.25,children:"190 WPM"}),e.jsx("option",{value:1.5,children:"225 WPM"}),e.jsx("option",{value:1.75,children:"260 WPM"}),e.jsx("option",{value:2,children:"300 WPM"}),e.jsx("option",{value:2.25,children:"325 WPM"}),e.jsx("option",{value:2.5,children:"350 WPM"}),e.jsx("option",{value:2.75,children:"375 WPM"}),e.jsx("option",{value:3,children:"400 WPM"})]})]}),e.jsx("button",{onClick:_,className:`w-24 h-24 rounded-full flex items-center justify-center shadow-xl transition-all transform ${a?"bg-rose-500 text-white scale-110 ring-8 ring-rose-100":"bg-white border-4 border-neutral-100 text-neutral-900 hover:border-neutral-200 hover:scale-105"}`,children:a?e.jsx(Xe,{size:32,fill:"currentColor"}):e.jsx(Ze,{size:32})}),e.jsx("button",{onClick:f,disabled:!m||a,className:`p-4 rounded-2xl border transition-all shadow-sm ${m&&!a?"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600":"bg-neutral-50 border-neutral-100 text-neutral-300 cursor-not-allowed"}`,children:e.jsx(et,{size:24,fill:m&&!a?"currentColor":"none"})})]}),e.jsxs("button",{onClick:b,className:"px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center gap-2 transition-all shadow-lg bg-neutral-900 text-white hover:bg-neutral-800 active:scale-95",children:[e.jsx("span",{children:"Next Phrase"}),e.jsx(tt,{size:16})]})]}),e.jsx("div",{className:"px-8 pb-6",children:e.jsxs("div",{className:"p-4 bg-indigo-50 border border-indigo-100 rounded-2xl flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-indigo-500 text-white rounded-lg shadow-sm",children:e.jsx(st,{size:16})}),e.jsxs("div",{className:"text-[10px] text-indigo-700 leading-relaxed font-medium",children:[e.jsx("b",{className:"text-[10px] uppercase tracking-wider block mb-0.5",children:"Visual Feedback Guide:"}),e.jsx("span",{className:"text-emerald-600 font-black",children:"GREEN"}),": Correct. ",e.jsx("span",{className:"text-rose-500 font-black",children:"RED"}),": Mispronounced. ",e.jsx("span",{className:"text-neutral-400 font-black",children:"GRAY"}),": Missing."]})]})})]})]}),e.jsx(ye,{isOpen:D,onClose:se,onSave:re,initialData:K})]})},Ne="vocab_pro_mimic_practice_queue",ke=1e3,bt=({scopedWord:c,onClose:W})=>{const[a,p]=s.useState([]),[h,m]=s.useState(0),[_,$]=s.useState(!1),[f,L]=s.useState(0),[b,pe]=s.useState(10),[ie,v]=s.useState(!1),[H,w]=s.useState(null),[O,T]=s.useState(null),[N,ce]=s.useState(()=>xe("vocab_pro_mimic_autospeak",!1)),[P,ue]=s.useState(()=>xe("vocab_pro_mimic_autoreveal",!0)),F=s.useRef(N);s.useEffect(()=>{he("vocab_pro_mimic_autospeak",N),F.current=N},[N]),s.useEffect(()=>{he("vocab_pro_mimic_autoreveal",P)},[P]);const n=a[h]||null,[k,J]=s.useState(!1),[te,g]=s.useState(!1),[V,U]=s.useState(""),[de,Y]=s.useState(0),[D,K]=s.useState(null),[se,re]=s.useState("audio/webm"),[ne,Q]=s.useState(null),[A,X]=s.useState(null),[q,G]=s.useState(!1),[ae,S]=s.useState(!1),[I,C]=s.useState(null),z=!1,Z=s.useRef(new nt),M=s.useRef(null),j=s.useRef(null),d=s.useRef(null),E=s.useRef(()=>{}),R=s.useRef(!1),{showToast:r}=at(),l=s.useMemo(()=>((n==null?void 0:n.text)||"").toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().split(/\s+/).filter(Boolean).length===1,[n==null?void 0:n.text]),u=V.substring(de).trimStart(),i=s.useCallback(t=>{if(!n)return null;const o=we(n.text,t);C(o);const x=a.map((ee,oe)=>oe===h?{...ee,lastScore:o.score}:ee);return y(x),o},[n,a,h]);s.useEffect(()=>{if(!k||!n||!u)return;const t=we(n.text,u);C(t),t.score>=100&&!R.current&&(R.current=!0,(async()=>(await E.current(),i(u)))())},[u,k,n,i]);const y=t=>{p(t),he(Ne,t),$(t.length===0)};s.useEffect(()=>{const t=xe(Ne,[]);p(t),$(t.length===0),m(0)},[]),s.useEffect(()=>{const t=Math.ceil(a.length/b);f>=t&&t>0&&L(t-1)},[a.length,b]),s.useEffect(()=>{const t=Math.floor(h/b);t!==f&&L(t)},[h,b]);const B=t=>{const x=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...a];y(x),m(0),v(!1)},Se=(t,o)=>{y(a.map(x=>x.id===t?{...x,text:o}:x)),v(!1),w(null)},Ce=t=>{T(t)},ze=()=>{if(!O)return;const t=a.filter(x=>x.id!==O.id);let o=h;o>=t.length&&(o=Math.max(0,t.length-1)),m(o),y(t),T(null),r("Phrase removed.","success")},Me=()=>{if(a.length<2)return;const t=[...a].sort(()=>Math.random()-.5);y(t),m(0),r("Queue shuffled!","success")},Pe=t=>{pe(t),L(0)},Ie=()=>{w(null),v(!0)},Te=t=>{w(t),v(!0)},Ae=t=>{H?Se(H.id,t):B(t)},le=s.useCallback(async(t=!1)=>{j.current&&clearTimeout(j.current),d.current&&(clearTimeout(d.current),d.current=null),J(!1),Z.current.stop();try{const o=await lt();!t&&o&&(K(o.base64),re(o.mimeType))}catch(o){console.error("Audio capture failed",o)}},[]);s.useEffect(()=>{E.current=le},[le]);const Ee=s.useCallback(async()=>{if(n){if(A&&q){G(!1);return}if(A&&!q){G(!0);return}S(!0);try{const t=n.text.trim().toLowerCase(),o=ot().find(x=>x.word.toLowerCase()===t);if(o&&o.ipaUs){X(o.ipaUs),G(!0),S(!1);return}else{const x=it(),ee=ct(x),oe=await fetch(`${ee}/api/convert/ipa?text=${encodeURIComponent(n.text)}`);if(oe.ok){const De=await oe.json();X(De.ipa),G(!0)}else r("IPA server unavailable","error")}}catch{r("Failed to fetch IPA","error")}finally{S(!1)}}},[n,A,q,r]);s.useEffect(()=>{if(k&&le(!0),R.current=!1,g(P),U(""),Y(0),K(null),Q(null),C(null),X(null),G(!1),M.current&&(M.current.pause(),M.current=null),F.current&&n){const t=setTimeout(()=>me(n.text),500);return()=>clearTimeout(t)}},[n==null?void 0:n.id,P]),s.useEffect(()=>()=>{Z.current.stop(),j.current&&clearTimeout(j.current),d.current&&clearTimeout(d.current)},[]);const Re=async()=>{if(n)if(k)await le(),R.current=!1,i(u);else{R.current=!1,d.current&&(clearTimeout(d.current),d.current=null),U(""),Y(0),Q(null),C(null);try{await dt(),J(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>E.current(),1e4),Z.current.start((t,o)=>{const x=t+o;U(x),l&&!d.current&&x.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().length>0&&(d.current=setTimeout(()=>{d.current=null,E.current()},ke))},t=>{U(t),l&&!d.current&&t.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().length>0&&(d.current=setTimeout(()=>{d.current=null,E.current()},ke))})}catch(t){console.error("Failed to start recording",t),J(!1)}}},We=()=>{Y(V.length),Q(null),C(null)},_e=()=>n&&me(n.text),$e=()=>{if(D){M.current&&M.current.pause();const t=new Audio(`data:${se};base64,${D}`);M.current=t,t.play()}},Le=()=>{a.length>0&&m(t=>(t+1)%a.length)},Oe=t=>{t>=0&&t<a.length&&m(t)},Fe=Math.ceil(a.length/b),Ue=a.slice(f*b,(f+1)*b);return e.jsxs(e.Fragment,{children:[e.jsx(pt,{targetText:(n==null?void 0:n.text)||null,sourceWord:(n==null?void 0:n.sourceWord)||"",type:(n==null?void 0:n.type)||"",isRecording:k,isRevealed:te,userTranscript:u,matchStatus:ne,userAudioUrl:D,onToggleRecord:Re,onPlayTarget:_e,onPlayUser:$e,onToggleReveal:()=>g(!te),onNext:Le,onClearTranscript:We,isEmpty:_,onClose:W,pagedItems:Ue,page:f,pageSize:b,totalPages:Fe,onPageChange:L,onPageSizeChange:Pe,onSelect:t=>Oe(f*b+t),currentAbsoluteIndex:h,autoSpeak:N,onToggleAutoSpeak:()=>ce(!N),autoReveal:P,onToggleAutoReveal:()=>ue(!P),isGlobalMode:!c,isAnalyzing:z,onAnalyze:()=>{},aiAnalysis:I?{isCorrect:I.score>80,score:I.score,feedbackHtml:""}:null,localAnalysis:I,onAddItem:Ie,onEditItem:Te,onDeleteItem:Ce,onRandomize:Me,isModalOpen:ie,editingItem:H,onCloseModal:()=>v(!1),onSaveItem:Ae,ipa:A,showIpa:q,isIpaLoading:ae,onToggleIpa:Ee}),e.jsx(ut,{isOpen:!!O,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:ze,onClose:()=>T(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})},wt=({scopedWord:c,onClose:W})=>e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(bt,{scopedWord:c,onClose:W})})});export{wt as MimicPractice};
