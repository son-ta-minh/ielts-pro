import{c as ne,r as a,a4 as Ce,al as Te,a3 as Ae,j as e,aP as Ie,P as Me,aC as le,bF as ce,aj as de,k as ze,T as Ee,aD as ue,w as Pe,bG as Y,Y as te,aw as $e,ax as Fe,bh as oe,bH as Le,bI as Re,am as Oe,bJ as We,V as xe,bK as ae,N as X}from"./index-jRoTGL-6.js";import{R as Ue,a as He}from"./ResourceActions-DMep5xqI.js";import{V as Be}from"./ViewMenu-Cqb4gOmt.js";import{U as Ve}from"./UniversalCard-DkelVqfB.js";import{T as _e}from"./TagBrowser-CgLwmq1O.js";import{M as qe,F as he}from"./FileSelector-DHMeisSR.js";import{E as fe}from"./ear-CYfYGN-Y.js";import{T as Ge}from"./tag-QMINstTr.js";import{S as Je}from"./skip-forward-V9s1WFVU.js";import"./chevron-left-IyUtyJLQ.js";import"./filter-CbeeiF3t.js";import"./server-DMgN4vdb.js";import"./list-todo-DO-itWoX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ne("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=ne("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ne("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),ie="vocab_pro_listening_view",Ye=({isOpen:u,onClose:I,onConfirm:C,audioFiles:i,initialData:y})=>{const[R,p]=a.useState(""),[o,w]=a.useState(""),[$,g]=a.useState("");if(a.useEffect(()=>{if(u)if(y){const h=y.filename&&i.includes(y.filename)?y.filename:y.filename||(i.length>0?i[0]:"");p(h),w(y.start||""),g(y.duration||"")}else p(i.length>0?i[0]:""),w(""),g("")},[u,i,y]),!u)return null;const M=h=>{h.preventDefault(),C({filename:R,start:o.trim(),duration:$.trim()})},E=h=>decodeURIComponent(h.split("/").pop()||"");return e.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-2xl border border-neutral-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-black text-neutral-900 mb-4 flex items-center gap-2",children:[y?e.jsx(se,{size:20,className:"text-indigo-600"}):e.jsx(xe,{size:20,className:"text-indigo-600"}),y?"Edit Audio Settings":"Mark Audio Segment"]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Source Audio (Optional)"}),e.jsxs("select",{value:R,onChange:h=>p(h.target.value),className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none",children:[e.jsx("option",{value:"",children:"None (Use Text-to-Speech)"}),i.map((h,F)=>e.jsx("option",{value:h,children:E(h)},F))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Start (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:o,onChange:h=>w(h.target.value),placeholder:"e.g. 5.5",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Duration (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:$,onChange:h=>g(h.target.value),placeholder:"e.g. 10",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 text-neutral-500 font-bold text-xs hover:bg-neutral-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-neutral-900 text-white font-bold text-xs rounded-lg hover:bg-neutral-800 transition-colors",children:"Apply"})]})]})]})})},Z=({text:u,showDash:I=!0})=>{const C=u.split(/({.*?}|\[.*?\]\(.*?\)|\[.*?\])/g);return e.jsx("span",{className:"leading-relaxed",children:C.map((i,y)=>{if(i.startsWith("{")&&i.endsWith("}"))return e.jsx("span",{className:"text-red-600 font-bold mx-0.5",children:i.slice(1,-1)},y);if(i.startsWith("[")&&i.includes("](")&&i.endsWith(")")){const R=i.match(/^\[(.*?)\]/),p=R?R[1]:"???";return e.jsx("span",{className:`${I?"border-b-2 border-dashed border-indigo-400":""} text-indigo-900 font-medium mx-0.5 pb-0.5 transition-colors hover:bg-indigo-50/50`,children:e.jsx(Z,{text:p,showDash:I})},y)}return i.startsWith("[")&&i.endsWith("]")?e.jsx("span",{className:`${I?"border-b-2 border-dashed border-indigo-400":""} text-indigo-900 font-medium mx-0.5 pb-0.5 transition-colors hover:bg-indigo-50/50`,children:e.jsx(Z,{text:i.slice(1,-1),showDash:I})},y):e.jsx("span",{children:i},y)})})},Xe=({rawText:u,onUpdate:I,readOnly:C=!1,showDash:i=!0,audioLinks:y=[],onPlaySegment:R})=>{const p=a.useRef(null),[o,w]=a.useState(null),[$,g]=a.useState(!1),[M,E]=a.useState(null),[h,F]=a.useState(null),k=a.useRef(null),L=a.useMemo(()=>{const s=[],l=/({.*?}|\[.*?\]\(.*?\)|\[.*?\])/g;let r,f=0;for(;(r=l.exec(u))!==null;){r.index>f&&s.push({text:u.slice(f,r.index),type:"text",start:f,end:r.index});let d="text",n=r[0];if(r[0].startsWith("{"))d="highlight",n=r[0].slice(1,-1);else if(r[0].startsWith("["))if(d="audio",r[0].includes("](")){const c=r[0].match(/^\[(.*?)\]/);n=c?c[1]:"error"}else n=r[0].slice(1,-1);s.push({text:r[0],type:d,start:r.index,end:l.lastIndex,displayContent:n}),f=l.lastIndex}return f<u.length&&s.push({text:u.slice(f),type:"text",start:f,end:u.length}),s},[u]),A=()=>{if(C)return;const s=window.getSelection(),l=d=>{if(!d)return null;let n=d.nodeType===3?d.parentElement:d;for(;n&&n!==p.current&&!n.hasAttribute("data-index");)n=n.parentElement;return n&&n.hasAttribute("data-index")?parseInt(n.getAttribute("data-index"),10):null};if(!s||!s.anchorNode||!s.focusNode||s.isCollapsed){w(null);return}const r=l(s.anchorNode),f=l(s.focusNode);if(r===null||f===null){w(null);return}if(r===f&&L[r].type==="text"){let d=s.anchorOffset,n=s.focusOffset;d>n&&([d,n]=[n,d]),w({start:L[r].start+d,end:L[r].start+n,currentType:"text"})}else{const d=Math.min(r,f),n=Math.max(r,f);let c=!1;for(let x=d;x<=n;x++)L[x].type==="audio"&&(c=!0);w(c?null:{start:L[d].start,end:L[n].end,currentType:"text"})}},W=s=>{var f,d;if(!o)return;const{start:l,end:r}=o;if(s==="audio"){E(null),g(!0);return}if(s==="clear"){const n=u.slice(0,l),c=u.slice(l,r);let x=c;c.startsWith("{")?x=c.slice(1,-1):c.startsWith("[")&&(c.includes("](")?x=((f=c.match(/^\[(.*?)\]/))==null?void 0:f[1])||"":x=c.slice(1,-1));const z=u.slice(r);I(n+x+z)}else{const n=u.slice(0,l),c=u.slice(l,r),x=u.slice(r);I(`${n}{${c}}${x}`)}w(null),(d=window.getSelection())==null||d.removeAllRanges()},T=()=>{if(!o||o.currentType!=="audio")return;const l=u.slice(o.start,o.end).match(/\((.*?)\)$/);if(l){const r=l[1].split("|");E({filename:r[0]||"",start:r[1]||"",duration:r[2]||""})}else E(null);g(!0)},U=s=>{var _;if(!o)return;const{start:l,end:r,currentType:f}=o,d=u.slice(0,l);let n=u.slice(l,r);if(f==="audio"){const j=n.match(/^\[(.*?)\]/);j?n=j[1]:n=n.replace(/^\[/,"").replace(/\](\(.*?\))?$/,"")}const c=u.slice(r);let x=`[${n}]`;const z=s.filename,m=s.start,V=s.duration;if(z||m||V){const j=[];for(z?j.push(z):j.push(""),m?j.push(m):V&&j.push(""),V&&j.push(V);j.length>0&&!j[j.length-1];)j.pop();j.length>0&&(x+=`(${j.join("|")})`)}I(`${d}${x}${c}`),g(!1),E(null),w(null),(_=window.getSelection())==null||_.removeAllRanges()},N=(s,l)=>{var f;if(s.stopPropagation(),l.text.includes("](")){const d=l.text.match(/\((.*?)\)$/);if(d){const n=d[1].split("|"),c=n[0]?n[0]:void 0,x=n[1]?parseFloat(n[1]):void 0,z=n[2]?parseFloat(n[2]):void 0,m=((f=l.displayContent)==null?void 0:f.replace(/[{}]/g,""))||"";R(c,x,z,m);return}}const r=(l.displayContent||l.text.slice(1,-1)).replace(/[{}]/g,"");X(r)},q=(s,l,r)=>{if(C||r==="text")return;k.current&&(clearTimeout(k.current),k.current=null);const f=s.currentTarget.getBoundingClientRect();F(d=>(d==null?void 0:d.idx)===l?d:{idx:l,rect:f,type:r})},O=()=>{C||(k.current=setTimeout(()=>{F(null)},600))},H=()=>{k.current&&(clearTimeout(k.current),k.current=null)},J=()=>{k.current=setTimeout(()=>{F(null)},600)},b=s=>{var f;if(!h)return;const l=L[h.idx],r={start:l.start,end:l.end,currentType:l.type};if(w(r),F(null),s==="unmark"){const d=u.slice(0,l.start);let n=l.text;n.startsWith("{")?n=n.slice(1,-1):n.startsWith("[")&&(n.includes("](")?n=((f=n.match(/^\[(.*?)\]/))==null?void 0:f[1])||"":n=n.slice(1,-1));const c=u.slice(l.end);I(d+n+c),w(null)}else if(s==="edit"){const d=l.text.match(/\((.*?)\)$/);if(d){const n=d[1].split("|");E({filename:n[0]||"",start:n[1]||"",duration:n[2]||""})}else E(null);g(!0)}};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx(Ye,{isOpen:$,onClose:()=>{g(!1),E(null),w(null)},onConfirm:U,audioFiles:y,initialData:M}),e.jsxs("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible gap-2",children:[(o==null?void 0:o.currentType)==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.preventDefault(),W("highlight")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-neutral-900 text-white shadow-neutral-200 hover:scale-105 active:scale-95",children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:"Highlight"})]}),e.jsxs("button",{onClick:s=>{s.preventDefault(),W("audio")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-indigo-600 text-white shadow-indigo-200 hover:scale-105 active:scale-95",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Mark Audio"})]})]}),(o==null?void 0:o.currentType)!=="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.preventDefault(),W("clear")},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-rose-600 shadow-rose-100 hover:bg-rose-50 ${o?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(ae,{size:14}),e.jsx("span",{children:(o==null?void 0:o.currentType)==="highlight"?"Unhighlight":"Unmark Audio"})]}),(o==null?void 0:o.currentType)==="audio"&&e.jsxs("button",{onClick:s=>{s.preventDefault(),T()},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-indigo-600 shadow-indigo-100 hover:bg-indigo-50 ${o?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(se,{size:14}),e.jsx("span",{children:"Edit Audio"})]})]})]}),h&&e.jsxs("div",{className:"fixed z-[60] flex items-center gap-1 p-1 bg-neutral-900 rounded-lg shadow-xl animate-in fade-in zoom-in-95",style:{top:h.rect.top-40,left:h.rect.left+h.rect.width/2-(h.type==="audio"?60:35)},onMouseEnter:H,onMouseLeave:J,children:[h.type==="audio"&&e.jsx("button",{onClick:()=>b("edit"),className:"p-2 text-white hover:bg-white/20 rounded-md transition-colors",title:"Edit",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:()=>b("unmark"),className:"p-2 text-rose-400 hover:bg-white/20 rounded-md transition-colors",title:"Unmark",children:e.jsx(ae,{size:14})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-neutral-900"})]}),e.jsx("div",{ref:p,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap px-6 pb-20 pt-6 select-text cursor-text font-mono",onMouseUp:A,onKeyUp:A,children:L.map((s,l)=>s.type==="highlight"?e.jsx("span",{"data-index":l,onMouseEnter:r=>q(r,l,"highlight"),onMouseLeave:O,className:"text-red-600 font-bold cursor-pointer hover:bg-red-50 transition-colors rounded mx-0.5 border border-transparent hover:border-red-100",children:s.displayContent},`${l}-${s.start}`):s.type==="audio"?e.jsxs("span",{"data-index":l,onClick:r=>N(r,s),onMouseEnter:r=>q(r,l,"audio"),onMouseLeave:O,className:`${i?"border-b-2 border-dashed border-indigo-400":""} text-indigo-900 cursor-pointer hover:bg-indigo-50 transition-colors mx-0.5 relative group/audio py-0.5 rounded border border-transparent hover:border-indigo-100`,title:"Click to listen",children:[e.jsx(Z,{text:s.displayContent||"error",showDash:i}),s.text.includes("](")&&e.jsx("span",{className:"absolute -top-1 -right-1 w-1.5 h-1.5 bg-indigo-500 rounded-full"})]},`${l}-${s.start}`):e.jsx("span",{"data-index":l,children:s.text},`${l}-${s.start}`))})]})},Ze=({isOpen:u,onClose:I,item:C,onUpdate:i,showDash:y,onToggleDash:R})=>{const p=C.audioLinks||[],[o,w]=a.useState(0),[$,g]=a.useState(!1),[M,E]=a.useState(0),[h,F]=a.useState(0),[k,L]=a.useState(C.text),[A,W]=a.useState(!1),T=a.useRef(null),U=a.useRef(null),N=a.useRef(null);a.useEffect(()=>()=>{O(),U.current&&clearTimeout(U.current)},[]),a.useEffect(()=>{u?(L(C.text),H(0,!1)):(O(),w(0))},[u,C.id]);const q=c=>{L(c),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{i({...C,text:c})},1500)},O=()=>{T.current&&T.current.pause(),oe(),g(!1),N.current=null},H=(c,x)=>{if(O(),w(c),p.length>0&&p[c]){const z=p[c];let m=T.current;m||(m=new Audio,T.current=m),m=new Audio(z),T.current=m,m.addEventListener("loadedmetadata",()=>{E(m.duration)}),m.addEventListener("timeupdate",()=>{m&&(F(m.currentTime),N.current!==null&&m.currentTime>=N.current&&(m.pause(),g(!1),N.current=null))}),m.addEventListener("ended",()=>{g(!1),N.current=null,N.current}),m.addEventListener("error",()=>{g(!1)}),x&&(m.play().catch(console.error),g(!0))}},J=()=>{if(p.length>0)T.current?$?(T.current.pause(),g(!1)):(N.current=null,T.current.play().catch(console.error),g(!0)):H(o,!0);else if($)oe(),g(!1);else{const c=C.text.replace(/[{}]/g,"").replace(/\[|\]/g,"").replace(/\(.*?\|.*?\)/g,"");X(c),g(!0);const x=c.length/10*1e3;setTimeout(()=>g(!1),x)}},b=c=>{const x=Number(c.target.value);F(x),T.current&&(T.current.currentTime=x)},s=()=>{o>0&&H(o-1,!0)},l=()=>{o<p.length-1&&H(o+1,!0)},r=(c,x,z,m)=>{if(!c){X(m);return}let V=p.findIndex(_=>_===c||decodeURIComponent(_).endsWith(c)||_.includes(c));if(V===-1){console.warn("Audio file not found for segment:",c),X(m);return}if(V===o&&T.current)x!==void 0&&(T.current.currentTime=x),z!==void 0?N.current=(x||0)+z:N.current=null,T.current.play().catch(console.error),g(!0);else{O(),w(V);const _=p[V],j=new Audio(_);T.current=j,j.addEventListener("loadedmetadata",()=>{E(j.duration),x!==void 0&&(j.currentTime=x),z!==void 0&&(N.current=(x||0)+z),j.play().catch(console.error),g(!0)}),j.addEventListener("timeupdate",()=>{F(j.currentTime),N.current!==null&&j.currentTime>=N.current&&(j.pause(),g(!1),N.current=null)}),j.addEventListener("ended",()=>g(!1))}},f=()=>{O(),I()};if(!u)return null;const d=p.length>0?decodeURIComponent(p[o].split("/").pop()||`Track ${o+1}`):"System Voice (TTS)",n=c=>{const x=Math.floor(c/60),z=Math.floor(c%60);return`${x}:${z.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-7xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center bg-white z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(fe,{size:20})," Listening Practice"]}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1 max-w-[250px] truncate",children:C.title||C.note||"Practice Session"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-neutral-100 p-1 rounded-xl flex items-center",children:[e.jsx("button",{onClick:R,className:`p-2 rounded-lg transition-all ${y?"bg-white shadow-sm text-indigo-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Toggle Audio Marks",children:e.jsx(Le,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:()=>W(!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${A?"text-neutral-500":"bg-white shadow-sm text-neutral-900"}`,children:"Read"}),e.jsx("button",{onClick:()=>W(!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${A?"bg-white shadow-sm text-neutral-900":"text-neutral-500"}`,children:"Edit Raw"})]}),e.jsx("button",{onClick:f,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden relative bg-neutral-50/50",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar relative",children:A?e.jsx("textarea",{value:k,onChange:c=>q(c.target.value),className:"w-full h-full p-6 bg-white border border-neutral-200 rounded-2xl resize-none outline-none text-lg font-medium leading-relaxed font-mono text-neutral-700 shadow-sm",placeholder:"Paste transcript here..."}):e.jsx("div",{className:"h-full flex flex-col bg-white border border-neutral-200 rounded-2xl shadow-sm p-8 overflow-y-auto",children:e.jsx(Xe,{rawText:k,onUpdate:q,showDash:y,audioLinks:p,onPlaySegment:r})})})}),e.jsxs("div",{className:"px-6 py-3 bg-white border-t border-neutral-100 shrink-0 flex items-center gap-4",children:[e.jsxs("div",{className:"w-48 shrink-0",children:[e.jsx("h4",{className:"text-xs font-bold text-neutral-900 truncate",children:d}),p.length>1&&e.jsxs("p",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:["Track ",o+1,"/",p.length]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("button",{onClick:s,disabled:o===0,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Qe,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:J,className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center shadow-md hover:scale-105 active:scale-95 transition-all",children:$?e.jsx(Re,{size:16,fill:"currentColor"}):e.jsx(Oe,{size:16,fill:"currentColor",className:"ml-0.5"})}),e.jsx("button",{onClick:l,disabled:o===p.length-1,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Je,{size:18,fill:"currentColor"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 ml-2",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:n(h)}),e.jsxs("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full relative group cursor-pointer",children:[p.length>0&&e.jsx("input",{type:"range",min:"0",max:M||100,value:h,onChange:b,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-neutral-900 rounded-full transition-all",style:{width:`${M?h/M*100:0}%`}})]}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:n(M)})]})]})]})]})})},De=({isOpen:u,onClose:I,onSave:C,initialData:i})=>{const[y,R]=a.useState(""),[p,o]=a.useState(""),[w,$]=a.useState(""),[g,M]=a.useState("/"),[E,h]=a.useState(""),[F,k]=a.useState([]),[L,A]=a.useState(!1),[W,T]=a.useState(null),[U,N]=a.useState(!1);a.useEffect(()=>{var b;if(u)if(R((i==null?void 0:i.title)||""),o((i==null?void 0:i.text)||""),$((i==null?void 0:i.note)||""),k((i==null?void 0:i.audioLinks)||[]),(i==null?void 0:i.path)===void 0){const s=(i==null?void 0:i.tags)||[],l=s.find(f=>f.startsWith("/")),r=s.filter(f=>!f.startsWith("/"));M(l||"/"),h(r.join(", "))}else M((i==null?void 0:i.path)||"/"),h(((b=i==null?void 0:i.tags)==null?void 0:b.join(", "))||"")},[u,i]);const q=b=>{if(b.preventDefault(),p.trim()){const s=E.split(",").map(l=>l.trim()).filter(Boolean);C(y.trim(),p.trim(),w.trim(),g.trim(),s,F)}},O=b=>{const{url:s,transcript:l}=b;k(r=>[...r,s]),l&&(p.trim()?(T(l),N(!0)):o(l))},H=()=>{W&&o(W),T(null),N(!1)},J=b=>{k(s=>s.filter((l,r)=>r!==b))};return u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:q,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:i?"Edit Listening Card":"New Listening Card"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text script and attach audio."})]}),e.jsx("button",{type:"button",onClick:I,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title"}),e.jsx("input",{value:y,onChange:b=>R(b.target.value),placeholder:"e.g. Unit 1 Podcast",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Script / Transcript"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:p,onChange:b=>o(b.target.value),placeholder:"Paste full transcript here...",rows:6,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0})}),e.jsx("p",{className:"text-[10px] text-neutral-400 italic",children:"You can highlight key phrases in Practice mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Attached Audio"}),e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(de,{size:12})," From Server"]})]}),e.jsxs("div",{className:"space-y-2",children:[F.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2",children:"No audio files attached."}),F.map((b,s)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-50 rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(ce,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(b.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>J(s),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(te,{size:14})})]},s))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:w,onChange:b=>$(b.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags"}),e.jsx("input",{value:E,onChange:b=>h(b.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx($e,{size:14})," Save Item"]})})]})}),e.jsx(he,{isOpen:L,onClose:()=>A(!1),onSelect:O,type:"audio",title:"Select Audio"}),e.jsx(ue,{isOpen:U,title:"Replace Script?",message:"This audio file comes with a linked transcript. Do you want to replace your current text content with it?",confirmText:"Replace",isProcessing:!1,onConfirm:H,onClose:()=>N(!1),icon:e.jsx(Fe,{size:40,className:"text-indigo-500"}),confirmButtonClass:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200"})]}):null},ft=({user:u})=>{const[I,C]=a.useState([]),[i,y]=a.useState(!0),[R,p]=a.useState(!1),[o,w]=a.useState(()=>Ce(ie,{showNote:!0,compact:!1,showType:!0,showDash:!1})),[$,g]=a.useState(""),[M,E]=a.useState(null),[h,F]=a.useState(!1),[k,L]=a.useState("all"),[A,W]=a.useState("all"),[T,U]=a.useState(0),[N,q]=a.useState(12),[O,H]=a.useState(null);a.useEffect(()=>{Te(ie,o)},[o]);const[J,b]=a.useState(!1),[s,l]=a.useState(null),[r,f]=a.useState(null),[d,n]=a.useState(!1),{showToast:c}=Ae(),x=async()=>{y(!0);const t=await Pe(u.id);C(t.sort((S,v)=>v.createdAt-S.createdAt)),y(!1)};a.useEffect(()=>{x()},[u.id]),a.useEffect(()=>{U(0)},[M,N,k,A,$]);const z=a.useMemo(()=>k!=="all"||A!=="all",[k,A]),m=a.useMemo(()=>{let t=I;const S=$.toLowerCase().trim();return S&&(t=t.filter(v=>(v.title||"").toLowerCase().includes(S)||(v.text||"").toLowerCase().includes(S))),k==="focused"&&(t=t.filter(v=>v.isFocused)),A!=="all"&&(t=t.filter(v=>v.focusColor===A)),M&&(M==="Uncategorized"?t=t.filter(v=>{const P=v.path??(v.tags||[]).find(K=>K.startsWith("/"));return!(P&&P!=="/"&&P!=="")}):t=t.filter(v=>{var P,B;return((P=v.path)==null?void 0:P.startsWith(M))||((B=v.tags)==null?void 0:B.includes(M))})),t},[I,M,k,A,$]),V=a.useMemo(()=>{const t=T*N;return m.slice(t,t+N)},[m,T,N]),_=()=>{l(null),b(!0)},j=t=>{l(t),b(!0)},pe=async()=>{r&&(await We(r.id),f(null),c("Deleted item.","success"),x())},me=async(t,S,v,P,B,K)=>{try{const G=Date.now();if(s){const Q={...s,title:t,text:S,note:v,path:P,tags:B,audioLinks:K,updatedAt:G};await Y(Q),c("Item updated!","success")}else{const Q={id:`lst-${G}-${Math.random()}`,userId:u.id,title:t,text:S,note:v,path:P,tags:B,audioLinks:K,createdAt:G,updatedAt:G};await Y(Q),c("Item added!","success")}b(!1),x()}catch{c("Failed to save item.","error")}},ge=async t=>{const{url:S,filename:v,transcript:P,transcriptTitle:B,map:K,path:G}=t;if(!P){c("No transcript found for selected file.","error");return}const Q=K||"Unknown",D=G?`/${G}`:"",Se=B?`${Q}${D} - ${B}`:v,ee=Date.now(),ke={id:`lst-scripted-${ee}-${Math.random()}`,userId:u.id,title:Se,text:P,note:`Imported from ${Q}${D}`,path:D||"/",tags:["scripted-audio"],audioLinks:[S],createdAt:ee,updatedAt:ee};try{await Y(ke),c("Scripted Audio Card Created!","success"),x()}catch{c("Failed to create card.","error")}},be=async t=>{await Y(t),H(t),x()},je=t=>{H(t)},ve=()=>{C(t=>[...t].sort(()=>Math.random()-.5)),c("Shuffled!","success")},ye=async(t,S)=>{const v={...t,focusColor:S||void 0,updatedAt:Date.now()};S||delete v.focusColor,C(P=>P.map(B=>B.id===t.id?v:B)),await Y(v)},we=async t=>{const S={...t,isFocused:!t.isFocused,updatedAt:Date.now()};C(v=>v.map(P=>P.id===t.id?S:P)),await Y(S)},re=()=>{w(t=>({...t,showDash:!t.showDash}))},Ne=t=>{if(t.title)return e.jsx("div",{className:"font-black text-lg text-neutral-900 leading-tight",children:t.title});const S=t.text.split(/\s+/),v=S.length>15?S.slice(0,15).join(" ")+"...":t.text;return e.jsx("div",{className:"font-medium text-lg text-neutral-700 leading-tight",children:e.jsx(Z,{text:v,showDash:o.showDash})})};return e.jsxs(e.Fragment,{children:[e.jsx(Ue,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),query:$,onQueryChange:g,searchPlaceholder:"Search title or text...",config:{},isLoading:i,isEmpty:m.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:T,totalPages:Math.ceil(m.length/N),onPageChange:U,pageSize:N,onPageSizeChange:q,totalItems:m.length},aboveGrid:e.jsx(e.Fragment,{children:h&&e.jsx(_e,{items:I,selectedTag:M,onSelectTag:E,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Ge,{size:16})})}),actions:e.jsx(He,{viewMenu:e.jsx(Be,{isOpen:R,setIsOpen:p,hasActiveFilters:z,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Ee,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>L(k==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${k==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:k==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>W(A==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${A==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>W(A==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${A==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>W(A==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${A==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:o.showNote,onChange:()=>w(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:o.showType,onChange:()=>w(t=>({...t,showType:!t.showType}))},{label:"Show Dash Lines",checked:o.showDash,onChange:re},{label:"Compact Mode",checked:o.compact,onChange:()=>w(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:h,onToggle:()=>{F(!h)}},addActions:[{label:"Add Scripted Audio",icon:ce,onClick:()=>n(!0)},{label:"Add Phrase",icon:de,onClick:_}],extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:ve,disabled:I.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(ze,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:V.map(t=>e.jsx(Ve,{title:Ne(t),badge:o.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:fe}:void 0,tags:t.tags,compact:o.compact,onClick:()=>je(t),focusColor:t.focusColor,onFocusChange:S=>ye(t,S),isFocused:t.isFocused,onToggleFocus:()=>we(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),j(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),f(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-2 h-full justify-between",children:[o.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit",children:[e.jsx(Ie,{size:12})," ",t.note]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full w-fit uppercase tracking-wider border border-emerald-100 self-start",children:[e.jsx(qe,{size:10})," ",t.audioLinks?t.audioLinks.length:0," Tracks"]})]})},t.id))})}),e.jsx(De,{isOpen:J,onClose:()=>b(!1),onSave:me,initialData:s}),O&&e.jsx(Ze,{isOpen:!!O,onClose:()=>H(null),item:O,onUpdate:be,showDash:o.showDash,onToggleDash:re}),e.jsx(he,{isOpen:d,onClose:()=>n(!1),onSelect:ge,type:"audio",title:"Select Audio"}),e.jsx(ue,{isOpen:!!r,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:pe,onClose:()=>f(null),icon:e.jsx(le,{size:40,className:"text-red-500"})})]})};export{ft as ListeningCardPage,ft as default};
