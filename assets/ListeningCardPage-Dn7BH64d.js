import{c as xe,r as n,G as lt,a5 as ot,D as rt,j as e,A as at,ao as X,a3 as de,aq as ue,aI as it,P as ct,a6 as Ce,l as dt,ar as ut,a7 as ht,bI as xt,bJ as pt,bK as Z,bL as mt,bM as K,X as he,ah as ft,bN as ke,bO as gt,bP as bt,t as jt}from"./index-3pjVYRSv.js";import{R as wt,a as vt}from"./ResourceActions-HkjUegVm.js";import{u as Nt,G as kt,S as ye,V as yt}from"./ShelfSearchBar-A5c4PVuY.js";import{U as St}from"./UniversalCard-BZsLiOQk.js";import{T as Ct}from"./TagBrowser-Bl4tIa4I.js";import{F as It,U as Tt,a as At,M as Ft,A as Lt,R as Bt}from"./ShelfModals-C-j2kayw.js";import{M as Pt,F as Ie}from"./FileSelector-acvnQjt5.js";import{E as D}from"./ear-LNNncQkq.js";import{M as zt}from"./move-cN6Phdt9.js";import{P as Mt}from"./pen-CSHZPaDL.js";import{F as Te}from"./file-audio-DN-xZ1r4.js";import{L as Ot}from"./library-mvL-ETNm.js";import{F as Et}from"./file-text-CyuwkuAp.js";import{P as $t}from"./pause-BXhH5Q3-.js";import"./chevron-left-DqsrHeqw.js";import"./circle-DI9TSRUB.js";import"./palette-B6L18atz.js";import"./square-check-big-BWEgzkFA.js";import"./folder-CRRBsdvx.js";import"./corner-left-up-BYNin9tI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=xe("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=xe("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=xe("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Se="vocab_pro_listening_view",Gt=({text:c})=>{const v=c.split(/({.*?})/g);return e.jsx("span",{className:"leading-relaxed",children:v.map((g,r)=>g.startsWith("{")&&g.endsWith("}")?e.jsx("span",{className:"inline-block bg-red-100 text-red-700 px-1.5 py-0.5 rounded-md font-bold mx-0.5 border border-red-200 text-[0.9em] align-baseline",children:g.slice(1,-1)},r):e.jsx("span",{children:g},r))})},_t=({rawText:c,onUpdate:v,readOnly:g=!1})=>{const r=n.useRef(null),[o,j]=n.useState(null),S=n.useMemo(()=>{const l=[],m=/({.*?})/g;let x,i=0;for(;(x=m.exec(c))!==null;)x.index>i&&l.push({text:c.slice(i,x.index),isHighlight:!1,start:i,end:x.index}),l.push({text:x[0],isHighlight:!0,start:x.index,end:m.lastIndex}),i=m.lastIndex;return i<c.length&&l.push({text:c.slice(i),isHighlight:!1,start:i,end:c.length}),l},[c]),T=()=>{if(g)return;const l=window.getSelection(),m=i=>{if(!i)return null;let d=i.nodeType===3?i.parentElement:i;for(;d&&d!==r.current&&!d.hasAttribute("data-index");)d=d.parentElement;return d&&d.hasAttribute("data-index")?parseInt(d.getAttribute("data-index"),10):null};if(!l||!l.anchorNode||!l.focusNode){j(null);return}const x=m(l.anchorNode);if(x!==null){const i=S[x];if(i.isHighlight){j({type:"remove",start:i.start,end:i.end});return}}if(!l.isCollapsed){const i=m(l.focusNode);if(x!==null&&x===i){const d=S[x];if(!d.isHighlight){const F=l.anchorNode;if(F&&F.nodeType===3){const N=Math.min(l.anchorOffset,l.focusOffset),R=Math.max(l.anchorOffset,l.focusOffset),C=d.start+N,U=d.start+R;if(l.toString()){j({type:"add",start:C,end:U});return}}}}}j(null)},b=()=>{var l;if(o){if(o.type==="remove"){const m=c.slice(0,o.start),x=c.slice(o.start+1,o.end-1),i=c.slice(o.end);v(m+x+i)}else{const m=c.slice(0,o.start),x=c.slice(o.start,o.end),i=c.slice(o.end);v(`${m}{${x}}${i}`)}j(null),(l=window.getSelection())==null||l.removeAllRanges()}};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible",children:e.jsxs("button",{onClick:l=>{l.preventDefault(),b()},disabled:!o,className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 ${o?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"} ${(o==null?void 0:o.type)==="remove"?"bg-white text-rose-600 shadow-rose-100":"bg-neutral-900 text-white shadow-neutral-200"}`,children:[(o==null?void 0:o.type)==="remove"?e.jsx(bt,{size:14}):e.jsx(Rt,{size:14}),e.jsx("span",{children:(o==null?void 0:o.type)==="remove"?"Unhighlight":"Highlight"})]})}),e.jsx("div",{ref:r,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap px-6 pb-20 pt-6 select-text cursor-text font-mono",onMouseUp:T,onKeyUp:T,children:S.map((l,m)=>e.jsx("span",{"data-index":m,className:l.isHighlight?"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200 cursor-pointer hover:bg-red-200 hover:border-red-300 transition-colors":"",children:l.isHighlight?l.text.slice(1,-1):l.text},`${m}-${l.start}`))})]})},Vt=({isOpen:c,onClose:v,item:g,onUpdate:r})=>{const o=g.audioLinks||[],[j,S]=n.useState(0),[T,b]=n.useState(!1),[l,m]=n.useState(0),[x,i]=n.useState(0),[d,F]=n.useState(g.text),[N,R]=n.useState(!1),C=n.useRef(null);n.useEffect(()=>()=>{L()},[]),n.useEffect(()=>{c?(F(g.text),E(0,!1)):(L(),S(0))},[c,g]);const U=p=>{F(p),r({...g,text:p})},L=()=>{C.current&&(C.current.pause(),C.current=null),ke(),b(!1),i(0),m(0)},E=(p,y)=>{if(L(),S(p),o.length>0&&o[p]){const P=o[p],B=new Audio(P);C.current=B,B.addEventListener("loadedmetadata",()=>{m(B.duration)}),B.addEventListener("timeupdate",()=>{i(B.currentTime)}),B.addEventListener("ended",()=>{b(!1),p<o.length-1?E(p+1,!0):i(0)}),B.addEventListener("error",()=>{b(!1)}),y&&(B.play().catch(console.error),b(!0))}},A=()=>{if(o.length>0)C.current?T?(C.current.pause(),b(!1)):(C.current.play().catch(console.error),b(!0)):E(j,!0);else if(T)ke(),b(!1);else{const p=g.text.replace(/[{}]/g,"");jt(p),b(!0);const y=p.length/10*1e3;setTimeout(()=>b(!1),y)}},W=p=>{const y=Number(p.target.value);i(y),C.current&&(C.current.currentTime=y)},k=()=>{j>0&&E(j-1,!0)},G=()=>{j<o.length-1&&E(j+1,!0)},_=()=>{L(),v()};if(!c)return null;const h=o.length>0?decodeURIComponent(o[j].split("/").pop()||`Track ${j+1}`):"System Voice (TTS)",w=p=>{const y=Math.floor(p/60),P=Math.floor(p%60);return`${y}:${P.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-7xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center bg-white z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(D,{size:20})," Listening Practice"]}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1 max-w-[250px] truncate",children:g.title||g.note||"Practice Session"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-neutral-100 p-1 rounded-xl flex items-center",children:[e.jsx("button",{onClick:()=>R(!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${N?"text-neutral-500":"bg-white shadow-sm text-neutral-900"}`,children:"Read"}),e.jsx("button",{onClick:()=>R(!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${N?"bg-white shadow-sm text-neutral-900":"text-neutral-500"}`,children:"Edit Raw"})]}),e.jsx("button",{onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(he,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden relative bg-neutral-50/50",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar relative",children:N?e.jsx("textarea",{value:d,onChange:p=>U(p.target.value),className:"w-full h-full p-6 bg-white border border-neutral-200 rounded-2xl resize-none outline-none text-lg font-medium leading-relaxed font-mono text-neutral-700 shadow-sm",placeholder:"Paste transcript here..."}):e.jsx("div",{className:"h-full flex flex-col bg-white border border-neutral-200 rounded-2xl shadow-sm p-8 overflow-y-auto",children:e.jsx(_t,{rawText:d,onUpdate:U})})})}),e.jsxs("div",{className:"px-6 py-3 bg-white border-t border-neutral-100 shrink-0 flex items-center gap-4",children:[e.jsxs("div",{className:"w-48 shrink-0",children:[e.jsx("h4",{className:"text-xs font-bold text-neutral-900 truncate",children:h}),o.length>1&&e.jsxs("p",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:["Track ",j+1,"/",o.length]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("button",{onClick:k,disabled:j===0,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Ut,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:A,className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center shadow-md hover:scale-105 active:scale-95 transition-all",children:T?e.jsx($t,{size:16,fill:"currentColor"}):e.jsx(Ce,{size:16,fill:"currentColor",className:"ml-0.5"})}),e.jsx("button",{onClick:G,disabled:j===o.length-1,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Ht,{size:18,fill:"currentColor"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 ml-2",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:w(x)}),e.jsxs("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full relative group cursor-pointer",children:[o.length>0&&e.jsx("input",{type:"range",min:"0",max:l||100,value:x,onChange:W,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-neutral-900 rounded-full transition-all",style:{width:`${l?x/l*100:0}%`}})]}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:w(l)})]})]})]})]})})},Kt=({isOpen:c,onClose:v,onSave:g,initialData:r})=>{const[o,j]=n.useState(""),[S,T]=n.useState(""),[b,l]=n.useState(""),[m,x]=n.useState("/"),[i,d]=n.useState(""),[F,N]=n.useState([]),[R,C]=n.useState(!1),[U,L]=n.useState(null),[E,A]=n.useState(!1);n.useEffect(()=>{var h;if(c)if(j((r==null?void 0:r.title)||""),T((r==null?void 0:r.text)||""),l((r==null?void 0:r.note)||""),N((r==null?void 0:r.audioLinks)||[]),(r==null?void 0:r.path)===void 0){const w=(r==null?void 0:r.tags)||[],p=w.find(P=>P.startsWith("/")),y=w.filter(P=>!P.startsWith("/"));x(p||"/"),d(y.join(", "))}else x((r==null?void 0:r.path)||"/"),d(((h=r==null?void 0:r.tags)==null?void 0:h.join(", "))||"")},[c,r]);const W=h=>{if(h.preventDefault(),S.trim()){const w=i.split(",").map(p=>p.trim()).filter(Boolean);g(o.trim(),S.trim(),b.trim(),m.trim(),w,F)}},k=h=>{N(w=>[...w,h.url]),h.transcript&&(S.trim()?(L(h.transcript),A(!0)):T(h.transcript))},G=()=>{U&&T(U),L(null),A(!1)},_=h=>{N(w=>w.filter((p,y)=>y!==h))};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:W,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:r?"Edit Listening Card":"New Listening Card"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text script and attach audio."})]}),e.jsx("button",{type:"button",onClick:v,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(he,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title"}),e.jsx("input",{value:o,onChange:h=>j(h.target.value),placeholder:"e.g. Unit 1 Podcast",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Script / Transcript"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:S,onChange:h=>T(h.target.value),placeholder:"Paste full transcript here...",rows:6,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0})}),e.jsx("p",{className:"text-[10px] text-neutral-400 italic",children:"You can highlight key phrases in Practice mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Attached Audio"}),e.jsxs("button",{type:"button",onClick:()=>C(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(de,{size:12})," From Server"]})]}),e.jsxs("div",{className:"space-y-2",children:[F.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2",children:"No audio files attached."}),F.map((h,w)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-50 rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(Te,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(h.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>_(w),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(he,{size:14})})]},w))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:b,onChange:h=>l(h.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags"}),e.jsx("input",{value:i,onChange:h=>d(h.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(ft,{size:14})," Save Item"]})})]})}),e.jsx(Ie,{isOpen:R,onClose:()=>C(!1),onSelect:k,type:"audio",title:"Select Audio"}),e.jsx(ue,{isOpen:E,title:"Replace Script?",message:"This audio file comes with a linked transcript. Do you want to replace your current text content with it?",confirmText:"Replace",isProcessing:!1,onConfirm:G,onClose:()=>A(!1),icon:e.jsx(Et,{size:40,className:"text-indigo-500"}),confirmButtonClass:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200"})]}):null},xs=({user:c})=>{var Ne;const[v,g]=n.useState([]),[r,o]=n.useState([]),[j,S]=n.useState(!0),[T,b]=n.useState("LIST"),[l,m]=n.useState(null),[x,i]=n.useState(!1),[d,F]=n.useState(()=>lt(Se,{showNote:!0,compact:!1,showType:!0})),[N,R]=n.useState(null),[C,U]=n.useState(!1),[L,E]=n.useState(!1),[A,W]=n.useState("all"),[k,G]=n.useState("all"),[_,h]=n.useState(0),[w,p]=n.useState(12),[y,P]=n.useState(null),{currentShelfName:B,booksOnCurrentShelf:ee,allShelves:q,addShelf:Ae,renameShelf:Fe,removeShelf:Le,nextShelf:Be,prevShelf:Pe,selectShelf:ze}=Nt(r,"listening_books_shelves"),[Me,te]=n.useState(!1),[Oe,se]=n.useState(!1),[$,ne]=n.useState(null);n.useEffect(()=>{ot(Se,d)},[d]);const[Ee,Q]=n.useState(!1),[le,pe]=n.useState(null),[oe,re]=n.useState(null),[V,ae]=n.useState(null),[$e,me]=n.useState(!1),{showToast:z}=rt(),O=async()=>{S(!0);const[t,s]=await Promise.all([xt(c.id),pt(c.id)]);g(t.sort((a,u)=>u.createdAt-a.createdAt)),o(s.sort((a,u)=>u.createdAt-a.createdAt)),S(!1)};n.useEffect(()=>{O()},[c.id]),n.useEffect(()=>{h(0)},[N,w,A,k]);const Re=n.useMemo(()=>A!=="all"||k!=="all",[A,k]),J=n.useMemo(()=>{let t=v;return A==="focused"&&(t=t.filter(s=>s.isFocused)),k!=="all"&&(t=t.filter(s=>s.focusColor===k)),N&&(N==="Uncategorized"?t=t.filter(s=>{const a=s.path??(s.tags||[]).find(f=>f.startsWith("/"));return!(a&&a!=="/"&&a!=="")}):t=t.filter(s=>{var a,u;return((a=s.path)==null?void 0:a.startsWith(N))||((u=s.tags)==null?void 0:u.includes(N))})),t},[v,N,A,k]),Ue=n.useMemo(()=>{const t=_*w;return J.slice(t,t+w)},[J,_,w]),He=()=>{pe(null),Q(!0)},fe=t=>{pe(t),Q(!0)},Ge=async()=>{oe&&(await gt(oe.id),re(null),z("Deleted item.","success"),O())},_e=async(t,s,a,u,f,M)=>{try{const I=Date.now();if(le){const H={...le,title:t,text:s,note:a,path:u,tags:f,audioLinks:M,updatedAt:I};await K(H),z("Item updated!","success")}else{const H={id:`lst-${I}-${Math.random()}`,userId:c.id,title:t,text:s,note:a,path:u,tags:f,audioLinks:M,createdAt:I,updatedAt:I};await K(H),z("Item added!","success")}Q(!1),O()}catch{z("Failed to save item.","error")}},Ve=async(t,s,a,u,f)=>{if(!a){z("No transcript found for selected file.","error");return}const M=(f==null?void 0:f.map)||"Unknown",I=f!=null&&f.path?`/${f.path}`:"",H=u?`${M}${I} - ${u}`:s,Y=Date.now(),nt={id:`lst-scripted-${Y}-${Math.random()}`,userId:c.id,title:H,text:a,note:`Imported from ${M}${I}`,path:I||"/",tags:["scripted-audio"],audioLinks:[t],createdAt:Y,updatedAt:Y};try{await K(nt),z("Scripted Audio Card Created!","success"),O()}catch{z("Failed to create card.","error")}},Ke=async t=>{await K(t),P(t),O()},ie=t=>{P(t)},We=()=>{g(t=>[...t].sort(()=>Math.random()-.5)),z("Shuffled!","success")},ge=async(t,s)=>{const a={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete a.focusColor,g(u=>u.map(f=>f.id===t.id?a:f)),await K(a)},be=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};g(a=>a.map(u=>u.id===t.id?s:u)),await K(s)},qe=t=>{Fe(t,async(a,u)=>{S(!0);const f=r.filter(M=>{const I=M.title.split(":");return(I.length>1?I[0].trim():"General")===a});await Promise.all(f.map(M=>{const I=M.title.split(":"),H=I.length>1?I.slice(1).join(":").trim():M.title,Y=`${u}: ${H}`;return Z({...M,title:Y,updatedAt:Date.now()})})),await O()})&&se(!1)},je=async()=>{const t={id:`lb-${Date.now()}`,userId:c.id,title:`${B}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#ff9800",icon:"ðŸŽ§"};await Z(t),await O(),m(t),b("BOOK_DETAIL"),z("New book created.","success")},ce=async t=>{if(!l)return;const s={...l,...t,updatedAt:Date.now()};o(a=>a.map(u=>u.id===s.id?s:u)),m(s),await Z(s)},Je=async()=>{V&&(await mt(V.id),z("Book deleted.","success"),ae(null),await O())},Ye=async t=>{if(!$)return;const s=$.title.split(":"),a=s.length>1?s.slice(1).join(":").trim():s[0],u=`${t}: ${a}`,f={...$,title:u,updatedAt:Date.now()};await Z(f),ne(null),await O(),z(`Moved to "${t}".`,"success")},Xe=n.useMemo(()=>l?l.itemIds.map(t=>{const s=v.find(a=>a.id===t);return s?{id:s.id,title:s.title||s.text,subtitle:s.note||"Listening Practice",data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[l,v]),Qe=n.useMemo(()=>v.map(t=>({id:t.id,title:t.title||t.text,subtitle:`${t.text.length} characters`,data:t})),[v]),Ze=t=>{if(!l)return;const s=Array.from(new Set([...l.itemIds,...t]));ce({itemIds:s})},De=t=>{if(!l)return;const s=l.itemIds.filter(a=>a!==t);ce({itemIds:s})},et=(t,s)=>{const a=t.data;ge(a,s)},tt=t=>{const s=t.data;be(s)},we=t=>{ze(t),b("SHELF")},ve=t=>{m(t),b("BOOK_DETAIL")},st=t=>{if(t.title)return e.jsx("div",{className:"font-black text-lg text-neutral-900 leading-tight",children:t.title});const s=t.text.split(/\s+/),a=s.length>15?s.slice(0,15).join(" ")+"...":t.text;return e.jsx("div",{className:"font-medium text-lg text-neutral-700 leading-tight",children:e.jsx(Gt,{text:a})})};return T==="BOOK_DETAIL"&&l?e.jsx(kt,{book:l,items:Xe,availableItems:Qe,onBack:()=>{m(null),b("SHELF"),O()},onUpdateBook:ce,onAddItem:Ze,onRemoveItem:De,onOpenItem:t=>ie(t.data),onEditItem:t=>fe(t.data),onFocusChange:et,onToggleFocus:tt,itemIcon:e.jsx(D,{size:16})}):T==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>b("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(at,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Listening Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your listening practice."})]}),e.jsx(ye,{shelves:q,books:r,onNavigateShelf:we,onNavigateBook:ve}),e.jsxs("button",{onClick:()=>te(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(It,{size:14})," Add Shelf"]})]})]}),e.jsxs(Tt,{label:B,onNext:q.length>1?Be:void 0,onPrev:q.length>1?Pe:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>se(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Mt,{size:14})}),e.jsx("button",{onClick:Le,disabled:ee.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(X,{size:14})})]}),isEmpty:ee.length===0,emptyAction:e.jsx("button",{onClick:je,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[ee.map(t=>{const s=t.title,a=s.split(":"),u=a.length>1?a.slice(1).join(":").trim():s;return e.jsx(At,{id:t.id,title:u,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(D,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{m(t),b("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),ne(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(zt,{size:16})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),ae(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(X,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:je,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(de,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(ue,{isOpen:!!V,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Ne=V==null?void 0:V.title.split(":").pop())==null?void 0:Ne.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Je,onClose:()=>ae(null),icon:e.jsx(X,{size:40,className:"text-red-500"})}),e.jsx(Ft,{isOpen:!!$,onClose:()=>ne(null),onConfirm:Ye,shelves:q,currentShelf:$?$.title.split(":")[0].trim():"General",bookTitle:($==null?void 0:$.title)||""}),e.jsx(Lt,{isOpen:Me,onClose:()=>te(!1),onSave:t=>{Ae(t)&&te(!1)}}),e.jsx(Bt,{isOpen:Oe,onClose:()=>se(!1),onSave:qe,initialName:B})]}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),centerContent:e.jsx(ye,{shelves:q,books:r,onNavigateShelf:we,onNavigateBook:ve}),config:{},isLoading:j,isEmpty:J.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:_,totalPages:Math.ceil(J.length/w),onPageChange:h,pageSize:w,onPageSizeChange:p,totalItems:J.length},aboveGrid:e.jsx(e.Fragment,{children:L&&e.jsx(Ct,{items:v,selectedTag:N,onSelectTag:R,forcedView:"tags",title:"Browse Tags",icon:e.jsx(ht,{size:16})})}),actions:e.jsx(vt,{viewMenu:e.jsx(yt,{isOpen:x,setIsOpen:i,hasActiveFilters:Re,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(ut,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>W(A==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${A==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:A==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>G(k==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${k==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>G(k==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${k==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>G(k==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${k==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:d.showNote,onChange:()=>F(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:d.showType,onChange:()=>F(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:d.compact,onChange:()=>F(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:L,onToggle:()=>{E(!L)}},addActions:[{label:"Add Scripted Audio",icon:Te,onClick:()=>me(!0)},{label:"Add Phrase",icon:de,onClick:He}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:We,disabled:v.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(dt,{size:16})}),e.jsxs("button",{onClick:()=>b("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(Ot,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:Ue.map(t=>e.jsx(St,{title:st(t),badge:d.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:D}:void 0,tags:t.tags,compact:d.compact,onClick:()=>ie(t),focusColor:t.focusColor,onFocusChange:s=>ge(t,s),isFocused:t.isFocused,onToggleFocus:()=>be(t),isCompleted:t.focusColor==="green",footer:e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.audioLinks&&t.audioLinks.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full w-fit uppercase tracking-wider border border-emerald-100",children:[e.jsx(Pt,{size:10})," ",t.audioLinks.length," Tracks"]})}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),ie(t)},className:"flex items-center gap-1.5 px-4 py-2 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-md shadow-indigo-200 active:scale-95",title:"Practice",children:[e.jsx(Ce,{size:12,fill:"currentColor"})," ",e.jsx("span",{children:"Practice"})]})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),fe(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ct,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),re(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{size:14})})]}),children:d.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit mb-2",children:[e.jsx(it,{size:12})," ",t.note]})},t.id))})}),e.jsx(Kt,{isOpen:Ee,onClose:()=>Q(!1),onSave:_e,initialData:le}),y&&e.jsx(Vt,{isOpen:!!y,onClose:()=>P(null),item:y,onUpdate:Ke}),e.jsx(Ie,{isOpen:$e,onClose:()=>me(!1),onSelect:Ve,type:"audio",title:"Select Audio"}),e.jsx(ue,{isOpen:!!oe,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:Ge,onClose:()=>re(null),icon:e.jsx(X,{size:40,className:"text-red-500"})})]})};export{xs as ListeningCardPage,xs as default};
