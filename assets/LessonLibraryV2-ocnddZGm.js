import{c as Ne,r as o,bl as ge,J as fe,j as e,H as Oe,f as Pe,I as Ve,ay as Je,Z as je,T as le,g as xe,bI as be,S as oe,P as ye,O as qe,aE as ce,ak as pe,a4 as ke,aB as ve,k as Se,X as Ce,bu as Ie,bJ as He,bg as Ee,an as Xe,b5 as Qe,bK as Ze,ao as et,bL as tt,bk as ie,a5 as st,am as at,l as nt,t as rt,h as ot,aF as it,aG as lt,b0 as ct,bM as dt}from"./index-vTycAx8Y.js";import{R as ut,a as pt}from"./ResourceActions-zji0VEEY.js";import{T as xt}from"./TagBrowser-Br5VUkTQ.js";import{U as ht}from"./UniversalCard-rtsfXv_F.js";import{T as De}from"./tag-BWsazVZa.js";import{a as Ae,S as Re}from"./split-BmAK9v7b.js";import{H as we}from"./headphones-CyT00EYd.js";import{g as ze,a as Te}from"./getGenerateLessonTestPrompt-CGFp5VVS.js";import{C as mt}from"./chevron-left-CMtWELWY.js";import{V as gt}from"./ViewMenu-CcaznI08.js";import{L as ft}from"./layout-grid-Ci7PzEza.js";import"./filter-BY4lJ0dc.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Ne("FileDiff",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=Ne("GalleryHorizontalEnd",[["path",{d:"M2 7v10",key:"a2pl2d"}],["path",{d:"M6 5v14",key:"1kq3d7"}],["rect",{width:"12",height:"18",x:"10",y:"3",rx:"2",key:"13i7bc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=Ne("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);function Nt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Word Intensity Scale" table.
    
    INPUT DATA (Existing Rows):
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the existing word(s). 
    2. Complete any missing columns (Softened, Neutral, Intensified) to create a perfect scale.
    3. Ensure the progression is logical (e.g., chilly -> cold -> freezing).
    4. For EACH word, assign a register if it is distinctly "academic" or "casual". Leave empty if neutral.
    5. **EXPANSION**: You MUST introduce 1-2 ADDITIONAL rows of related vocabulary that fit the theme of the provided words. Choose only natural, high-frequency words useful for IELTS.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Frozen Heat", "Moral Compass".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return in code block format a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "softened": [{"word": "string", "register": "academic" | "casual" | null}],
          "neutral": [{"word": "string", "register": "academic" | "casual" | null}],
          "intensified": [{"word": "string", "register": "academic" | "casual" | null}]
        }
      ]
    }
    `}function jt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Confusing Word Comparison" table.
    
    INPUT DATA:
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the word(s). 
    2. If a nuance or example is missing, generate high-quality explanations.
    3. The "nuance" should explain exactly WHEN and WHY to use this word compared to its synonyms. Be sharp and IELTS-focused.
    4. Provide one natural, clear example sentence.
    5. **EXPANSION**: If the list is short, you MUST suggest 1-2 ADDITIONAL confusing words that belong to the same semantic group.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Visual Deception", "Mental Strain".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return in code block format a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "word": "string",
          "nuance": "string (The sharp explanation of usage)",
          "example": "string (The example sentence)"
        }
      ]
    }
    `}function yt(t,l,x="replace"){const M=JSON.stringify(t),y=(l||"").trim(),i=x==="append"?"APPEND MODE: Return only NEW rows to add. Do NOT preserve, rewrite, or include old rows.":"REPLACE MODE: Return the full refined final table.",p=x==="append"?"":`
    EXISTING TABLE JSON (for backup context):
    ${M}
`;return`You are an expert English linguist and IELTS writing coach.
    
    TASK: Refine and complete a "Common Mistakes" correction table.
    MODE: ${x.toUpperCase()}
    
    INPUT DATA:
    ${y||M}
    ${p}

    INSTRUCTIONS:
    1. For each row, improve clarity and teaching value.
    2. Keep "mistake" short and realistic (typical learner error).
    3. "explanation" must be concise and specific: explain exactly what is wrong and why.
    4. "correction" must provide the best corrected form. If useful, include 1-2 valid alternatives separated by " / ".
    5. Remove low-quality rows (empty or duplicated meaning).
    6. **DEDUPLICATION REQUIRED**: Automatically detect and merge duplicated or overlapping mistakes (e.g., the same uncountable noun error appearing twice). Keep only ONE focused item per unique error type.
    7. If two rows contain multiple issues, split or refine them so each row targets ONE primary error only.
    8. **EXPANSION**: If the table is short after deduplication, add 2-3 additional high-frequency IELTS-relevant mistakes.
    9. Mistakes may be either a minimal complete sentence OR a minimal self-contained phrase (e.g., “higher educations”) if the error can be clearly detected without additional context. Do not add unnecessary words.
    10. Only require time markers when the PRIMARY error is tense-related. Do NOT add unnecessary time context for logic, collocation, word form, or noun errors. If tense is the target error, include clear time markers (e.g., “in 2010”, “between 2000 and 2010”) so the error can be detected independently.
    11. ${i}

    METADATA RULES:
    1. **title**: Concept-driven, short title (MAX 5 WORDS).
    2. **description**: Define the focus boundary (MAX 15 WORDS). No fluff.

    STRICT JSON OUTPUT FORMAT:
    Return in code block format a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "mistake": "string",
          "explanation": "string",
          "correction": "string"
        }
      ]
    }
    `}const kt=t=>{const{type:l,title:x,setTitle:M,description:y,setDescription:i,tagsInput:p,setTagsInput:b,content:A,setContent:v,listeningContent:m,setListeningContent:S,testContent:T,setTestContent:C,intensityRows:D,setIntensityRows:Y,comparisonRows:E,setComparisonRows:H,mistakeRows:_,setMistakeRows:K,isSaving:B,onSave:U,onPractice:R,onCancel:z,onOpenAiRefine:N}=t,[c,h]=o.useState("READING"),[V,j]=o.useState(!1);o.useEffect(()=>{h(l==="intensity"?"INTENSITY":l==="comparison"?"COMPARISON":l==="mistake"?"MISTAKE":"READING")},[l]);const f=o.useMemo(()=>{let s="";return c==="READING"?s=A:c==="LISTENING"?s=m:s=T,ge(s)},[A,m,T,c]);o.useEffect(()=>(window.handleLessonSpeak=(s,n)=>{fe(s,!1,n)},()=>{delete window.handleLessonSpeak}),[]);const G=()=>Y([...D,{softened:[],neutral:[],intensified:[]}]),ee=s=>Y(D.filter((n,a)=>a!==s)),J=(s,n,a)=>{const d=[...D],g=a.split(/[;,]+/).map(I=>{const k=I.trim();if(!k)return null;const q=k.match(/\[(academic|casual)\]$/i);return q?{word:k.replace(q[0],"").trim(),register:q[1].toLowerCase()}:{word:k}}).filter(I=>I!==null);d[s][n]=g,Y(d)},O=s=>s.map(n=>n.register?`${n.word} [${n.register}]`:n.word).join("; "),W=()=>H([...E,{word:"",nuance:"",example:""}]),te=s=>H(E.filter((n,a)=>a!==s)),X=(s,n,a)=>{const d=[...E];d[s]={...d[s],[n]:a},H(d)},P=()=>K([..._,{mistake:"",explanation:"",correction:""}]),Q=s=>K(_.filter((n,a)=>a!==s)),F=(s,n,a)=>{const d=[..._];d[s]={...d[s],[n]:a},K(d)};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:z,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(Oe,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:R,disabled:B,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Pe,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:U,disabled:B,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[B?e.jsx(Ve,{size:14,className:"animate-spin"}):e.jsx(Je,{size:14}),e.jsx("span",{children:B?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:x,onChange:s=>M(s.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(De,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:p,onChange:s=>b(s.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 overflow-x-auto no-scrollbar",children:[l==="intensity"&&e.jsxs("button",{onClick:()=>{h("INTENSITY"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(je,{size:12,className:"inline mr-1"})," Intensity"]}),l==="comparison"&&e.jsxs("button",{onClick:()=>{h("COMPARISON"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Ae,{size:12,className:"inline mr-1"})," Contrast"]}),l==="mistake"&&e.jsxs("button",{onClick:()=>{h("MISTAKE"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="MISTAKE"?"bg-white text-rose-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(le,{size:12,className:"inline mr-1"})," Mistake"]}),e.jsxs("button",{onClick:()=>{h("READING"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{h("LISTENING"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(we,{size:12,className:"inline mr-1"})," Listening"]}),e.jsxs("button",{onClick:()=>{h("TEST"),j(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${c==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(be,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c==="INTENSITY"&&e.jsxs("button",{onClick:()=>N("intensity"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-orange-50 border border-orange-100 hover:bg-orange-100 transition-all text-[10px] font-black uppercase text-orange-600 shadow-sm",children:[e.jsx(oe,{size:12}),e.jsx("span",{children:"AI Refine"})]}),c==="COMPARISON"&&e.jsxs("button",{onClick:()=>N("comparison"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(oe,{size:12}),e.jsx("span",{children:"AI Refine"})]}),c==="MISTAKE"&&e.jsxs("button",{onClick:()=>N("mistake"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-all text-[10px] font-black uppercase text-rose-600 shadow-sm",children:[e.jsx(oe,{size:12}),e.jsx("span",{children:"AI Refine"})]}),(c==="READING"||c==="LISTENING"||c==="TEST")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N(c==="READING"?"reading":c==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(oe,{size:12}),e.jsx("span",{children:"AI Generate"})]}),e.jsxs("button",{onClick:()=>j(!V),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[V?e.jsx(ye,{size:12}):e.jsx(qe,{size:12}),e.jsx("span",{children:V?"Edit":"Preview"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[550px] relative overflow-hidden",children:c==="INTENSITY"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Intensity Rows"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Separate multiple words with semicolons. Use [academic] or [casual] tags for register."})]}),e.jsxs("div",{className:"space-y-4",children:[D.map((s,n)=>e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm grid grid-cols-1 md:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-blue-500 uppercase tracking-wider pl-1",children:"Softened"}),e.jsx("textarea",{value:O(s.softened),onChange:a=>J(n,"softened",a.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"chilly; cool..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Neutral"}),e.jsx("textarea",{value:O(s.neutral),onChange:a=>J(n,"neutral",a.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"hot; warm..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-orange-500 uppercase tracking-wider pl-1",children:"Intensified"}),e.jsx("textarea",{value:O(s.intensified),onChange:a=>J(n,"intensified",a.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"scorching; boiling..."})]}),e.jsx("button",{onClick:()=>ee(n),className:"p-2 text-neutral-300 hover:text-red-500 mt-5",children:e.jsx(ce,{size:16})})]},n)),e.jsxs("button",{onClick:G,className:"w-full py-4 border-2 border-dashed border-neutral-200 rounded-[2rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(pe,{size:16})," Add Scale Row"]})]})]}):c==="COMPARISON"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Contrast Pairs"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Break down confusing word pairs with clear nuances and examples."})]}),e.jsxs("div",{className:"space-y-4",children:[E.map((s,n)=>e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-4 animate-in fade-in slide-in-from-top-2 relative group",children:[e.jsx("button",{onClick:()=>te(n),className:"absolute top-4 right-4 p-2 text-neutral-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ce,{size:18})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 md:col-span-1",children:[e.jsx("label",{className:"text-[9px] font-black text-indigo-500 uppercase tracking-wider pl-1",children:"Target Word"}),e.jsx("input",{value:s.word,onChange:a=>X(n,"word",a.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-black focus:bg-white outline-none",placeholder:"e.g. Damage"})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Usage & Nuance"}),e.jsx("input",{value:s.nuance,onChange:a=>X(n,"nuance",a.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-medium focus:bg-white outline-none italic",placeholder:"When and why to use this..."})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Contextual Example"}),e.jsx("textarea",{value:s.example,onChange:a=>X(n,"example",a.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-bold focus:bg-white outline-none resize-none leading-relaxed",placeholder:"Write a clear example sentence..."})]})]},n)),e.jsxs("button",{onClick:W,className:"w-full py-6 border-2 border-dashed border-neutral-200 rounded-[2.5rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2 bg-white/50",children:[e.jsx(pe,{size:20})," Add Comparison Pair"]})]})]}):c==="MISTAKE"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Mistake Table"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Define wrong phrases, explain why they are wrong, then provide the correction."})]}),e.jsxs("div",{className:"space-y-4",children:[_.map((s,n)=>e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-4 animate-in fade-in slide-in-from-top-2 relative group",children:[e.jsx("button",{onClick:()=>Q(n),className:"absolute top-4 right-4 p-2 text-neutral-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ce,{size:18})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-rose-500 uppercase tracking-wider pl-1",children:"Mistake"}),e.jsx("textarea",{value:s.mistake,onChange:a=>F(n,"mistake",a.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-bold focus:bg-white outline-none resize-none leading-relaxed",placeholder:"e.g. educating staffs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Explanation"}),e.jsx("textarea",{value:s.explanation,onChange:a=>F(n,"explanation",a.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-medium focus:bg-white outline-none resize-none leading-relaxed",placeholder:"e.g. “Staff” is uncountable..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-emerald-600 uppercase tracking-wider pl-1",children:"Correction"}),e.jsx("textarea",{value:s.correction,onChange:a=>F(n,"correction",a.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-bold focus:bg-white outline-none resize-none leading-relaxed",placeholder:"e.g. teaching staff / teachers"})]})]},n)),e.jsxs("button",{onClick:P,className:"w-full py-6 border-2 border-dashed border-neutral-200 rounded-[2.5rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-rose-300 hover:text-rose-600 transition-all flex items-center justify-center gap-2 bg-white/50",children:[e.jsx(pe,{size:20})," Add Mistake Row"]})]})]}):V?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:f}}):e.jsx("textarea",{value:c==="READING"?A:c==="LISTENING"?m:T,onChange:s=>{c==="READING"?v(s.target.value):c==="LISTENING"?S(s.target.value):C(s.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${c.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},vt=({lesson:t,user:l,onSave:x,onPractice:M,onCancel:y})=>{const[i,p]=o.useState(t.title),[b,A]=o.useState(t.description||""),[v,m]=o.useState(t.path||"/"),[S,T]=o.useState((t.tags||[]).join(", ")),[C,D]=o.useState(t.content),[Y,E]=o.useState(t.listeningContent||""),[H,_]=o.useState(t.testContent||""),[K,B]=o.useState(t.intensityRows||[]),[U,R]=o.useState(t.comparisonRows||[]),[z,N]=o.useState(t.mistakeRows||[]),[c,h]=o.useState(t.searchKeywords||[]),[V,j]=o.useState(!1),[f,G]=o.useState(null),[ee,J]=o.useState("replace"),{showToast:O}=ke();o.useEffect(()=>{t.type==="comparison"&&(!t.comparisonRows||t.comparisonRows.length===0)&&t.id.startsWith("lesson-")&&G({format:"comparison"})},[]),o.useEffect(()=>{if(t.path===void 0&&t.tags){const s=t.tags||[],n=s.find(d=>d.startsWith("/")),a=s.filter(d=>!d.startsWith("/"));W(n||"/"),T(a.join(", "))}else m(t.path||"/"),T((t.tags||[]).join(", "))},[t]);const W=s=>m(s),te=()=>{const s=S.split(",").map(a=>a.trim()).filter(Boolean);let n=t.type||"essay";return K.length>0?n="intensity":U.length>0?n="comparison":z.length>0&&(n="mistake"),{...t,title:i,description:b,type:n,path:v.trim(),tags:s,content:C,listeningContent:Y,testContent:H,intensityRows:K.length>0?K:void 0,comparisonRows:U.length>0?U:void 0,mistakeRows:z.length>0?z:void 0,searchKeywords:c,updatedAt:Date.now()}},X=()=>{j(!0);const s=te();x(s)},P=()=>{j(!0);const s=te();M(s)},Q=s=>{var k,q,ne;const n=Se(),a=n.audioCoach.activeCoach,d=n.audioCoach.coaches[a].name,g=(f==null?void 0:f.format)||s.format;if(g==="intensity")return Nt(K);if(g==="comparison")return jt(U);if(g==="mistake")return yt(z,s.request,s.contentMode||ee);if(g==="test"){const se=S.split(",").map(he=>he.trim()).filter(Boolean);return ze(i,C,s.request,se)}const I=!C&&(t.type==="comparison"||t.type==="intensity"||!t.id.includes("ai"));return Te({task:I?"create_reading":g==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:i,description:b,content:C,type:t.type,intensityRows:K,comparisonRows:U},topic:s.request||s.topic||i,userRequest:s.request,language:s.language||((k=l.lessonPreferences)==null?void 0:k.language)||"English",targetAudience:((q=l.lessonPreferences)==null?void 0:q.targetAudience)||"Adult",tone:s.tone||((ne=l.lessonPreferences)==null?void 0:ne.tone)||"professional_professor",coachName:d})},F=s=>{const{result:n}=s,a=n||s,d=f==null?void 0:f.format;if(d==="intensity"){const g=Array.isArray(a)?a:a.data;a.title&&p(a.title),a.description&&A(a.description),Array.isArray(g)&&(B(g),O("Intensity scale refined!","success"))}else if(d==="comparison"){const g=Array.isArray(a)?a:a.data;a.title&&p(a.title),a.description&&A(a.description),Array.isArray(g)&&(R(g),O("Comparison lab updated!","success"))}else if(d==="mistake"){const g=Array.isArray(a)?a:a.data;if(Array.isArray(g)){const I=g.filter(k=>(k==null?void 0:k.mistake)||(k==null?void 0:k.explanation)||(k==null?void 0:k.correction));ee==="append"?(N(k=>[...k,...I]),!i&&a.title&&p(a.title),!b&&a.description&&A(a.description),O("Mistake rows appended!","success")):(a.title&&p(a.title),a.description&&A(a.description),N(I),O("Mistake table replaced!","success"))}}else d==="listening"?a.content&&(E(a.content),O("Listening script updated!","success")):d==="test"?a.content&&(_(a.content),O("Practice test generated!","success")):(a.title&&p(a.title),a.description&&A(a.description),a.content&&D(a.content),a.searchKeywords&&Array.isArray(a.searchKeywords)&&h(a.searchKeywords),!S.trim()&&a.tags&&a.tags.length>0&&T(a.tags.join(", ")),O("Lesson content refined!","success"));G(null)};return e.jsxs(e.Fragment,{children:[e.jsx(kt,{type:t.type||"essay",title:i,setTitle:p,description:b,setDescription:A,path:v,setPath:m,tagsInput:S,setTagsInput:T,content:C,setContent:D,listeningContent:Y,setListeningContent:E,testContent:H,setTestContent:_,intensityRows:K,setIntensityRows:B,comparisonRows:U,setComparisonRows:R,mistakeRows:z,setMistakeRows:N,isSaving:V,onSave:X,onPractice:P,onCancel:y,onOpenAiRefine:s=>{const n=s||"reading";n==="mistake"&&J("replace"),G({format:n})}}),f&&e.jsx(ve,{isOpen:!!f,onClose:()=>G(null),type:"REFINE_UNIT",title:f.format==="intensity"?"Refine Intensity Scale":f.format==="comparison"?"Refine Word Contrast":f.format==="mistake"?"Refine Mistake Table":C?"Refine Lesson":"Generate Lesson",description:f.format==="intensity"?"AI will complete the intensity scale.":f.format==="comparison"?"AI will complete the comparison pairs with nuances.":f.format==="mistake"?"AI will complete and improve your mistake-correction rows.":"Enter instructions for the AI.",initialData:{...l.lessonPreferences,format:f.format},contentModeOptions:f.format==="mistake"?{enabled:!0,value:ee,onChange:J}:void 0,onGeneratePrompt:Q,onJsonReceived:F,actionLabel:"Apply Changes"})]})},St=({register:t})=>{if(!t)return null;const l=t==="academic";return e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[8px] font-black uppercase border ml-1 ${l?"bg-purple-50 text-purple-700 border-purple-100":"bg-sky-50 text-sky-700 border-sky-100"}`,children:t})},me=({item:t})=>e.jsxs("div",{className:"flex items-center gap-1.5 group/item",children:[e.jsx("span",{className:"font-bold text-neutral-800",children:t.word}),e.jsx(St,{register:t.register}),t.lastResult==="correct"&&e.jsx(Ce,{size:12,className:"text-emerald-500 shrink-0"}),t.lastResult==="incorrect"&&e.jsx(Ie,{size:12,className:"text-rose-500 shrink-0"})]}),Ct=({rows:t,compact:l=!1})=>!t||t.length===0?null:e.jsx("div",{className:`bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm ${l?"scale-95 origin-top":""}`,children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-blue-500 tracking-[0.2em] w-1/3",children:"Softened"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-1/3",children:"Neutral"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-orange-500 tracking-[0.2em] w-1/3",children:"Intensified"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((x,M)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top bg-blue-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.softened.map((y,i)=>e.jsx(me,{item:y},i)),x.softened.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.neutral.map((y,i)=>e.jsx(me,{item:y},i)),x.neutral.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top bg-orange-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[x.intensified.map((y,i)=>e.jsx(me,{item:y},i)),x.intensified.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})})]},M))})]})}),It=({rows:t})=>!t||t.length===0?null:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-indigo-600 tracking-[0.2em] w-[25%]",children:"Word"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[35%]",children:"Nuance"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[40%]",children:"Example"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((l,x)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-neutral-900 text-sm",children:l.word}),l.lastResult==="correct"&&e.jsx(Ce,{size:14,className:"text-emerald-500 shrink-0"}),l.lastResult==="incorrect"&&e.jsx(Ie,{size:14,className:"text-rose-500 shrink-0"})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsx("p",{className:"text-xs text-neutral-600 font-medium italic leading-relaxed",children:l.nuance||"-"})}),e.jsx("td",{className:"px-6 py-4 align-top bg-neutral-50/20",children:e.jsx("p",{className:"text-xs text-neutral-800 leading-relaxed font-medium",children:l.example||"-"})})]},x))})]})}),At=({rows:t})=>!t||t.length===0?null:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-rose-600 tracking-[0.2em] w-[30%]",children:"Mistake"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[35%]",children:"Explanation"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-emerald-600 tracking-[0.2em] w-[35%]",children:"Correction"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((l,x)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-neutral-900 text-sm",children:l.mistake||"-"}),l.lastResult==="correct"&&e.jsx(Ce,{size:14,className:"text-emerald-500 shrink-0"}),l.lastResult==="incorrect"&&e.jsx(Ie,{size:14,className:"text-rose-500 shrink-0"})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsx("p",{className:"text-xs text-neutral-600 font-medium leading-relaxed",children:l.explanation||"-"})}),e.jsx("td",{className:"px-6 py-4 align-top bg-neutral-50/20",children:e.jsx("p",{className:"text-xs text-emerald-800 leading-relaxed font-bold",children:l.correction||"-"})})]},x))})]})}),Tt=t=>{if(!t)return[];const l=t.split(`
`),x=[];let M="Introduction",y=[];const i=()=>{(y.length>0||x.length===0&&M==="Introduction")&&(y.join(`
`).trim()||x.length>0)&&x.push({title:M,content:y.join(`
`)})};return l.forEach(p=>{const b=p.trim().match(/^(#{1,3})\s+(.+)/);b?(i(),M=b[2].trim(),y=[p]):y.push(p)}),i(),x.length>1&&x[0].title==="Introduction"&&!x[0].content.trim()&&x.shift(),x.length>0?x:[{title:"Lesson",content:t}]},Et=({lesson:t,onComplete:l,onEdit:x,onAddSound:M,onAddTest:y})=>{const[i,p]=o.useState("READING"),[b,A]=o.useState("SCROLL"),[v,m]=o.useState(0),[S,T]=o.useState("IDLE"),[C,D]=o.useState(-1),[Y,E]=o.useState(!1),[H,_]=o.useState(0),[K,B]=o.useState(!1),U=o.useRef(null),R=o.useRef(!1),z=o.useRef(new Map),N=o.useRef(new Map);o.useEffect(()=>{t.type==="intensity"&&t.intensityRows&&t.intensityRows.length>0?p("INTENSITY"):t.type==="comparison"&&t.comparisonRows&&t.comparisonRows.length>0?p("COMPARISON"):t.type==="mistake"&&t.mistakeRows&&t.mistakeRows.length>0&&p("MISTAKE")},[t]);const c=o.useMemo(()=>i==="READING"?t.content||"":i==="LISTENING"?t.listeningContent||"":t.testContent||"",[t,i]),h=o.useMemo(()=>Tt(c),[c]),V=o.useMemo(()=>{const s=new Map;return h.forEach((n,a)=>{n.content.split(`
`).forEach(d=>{const g=d.trim().match(/^#{1,4}\s+(.+)/);if(!g)return;const I=g[1].trim().toLowerCase();I&&!s.has(I)&&s.set(I,a)})}),s},[h]);o.useEffect(()=>{m(0)},[i]),o.useEffect(()=>{const s=n=>{U.current&&!U.current.contains(n.target)&&B(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const j=o.useMemo(()=>{if(b==="SCROLL")return ge(c);{const s=h[v]||h[0];return ge((s==null?void 0:s.content)||"")}},[c,b,h,v]),f=o.useMemo(()=>{if(!t.listeningContent)return[];const s=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,n=[];let a;for(;(a=s.exec(t.listeningContent))!==null;)n.push({lang:a[1].toUpperCase()==="VN"?"vi":"en",text:a[2].replace(/\[.*?\]/g,"").trim()});return n},[t.listeningContent]),G=s=>{if(z.current.has(s))return Promise.resolve(z.current.get(s));if(N.current.has(s))return N.current.get(s);const n=f[s],a=tt(n.text,n.lang).then(d=>(d&&(z.current.set(s,d),_(g=>g+1)),d));return N.current.set(s,a),a},ee=async s=>{for(let n=s;n<f.length&&!R.current;n++)await G(n)},J=async()=>{S==="PAUSED"?(T("PLAYING"),R.current=!1):(R.current=!1,T("PLAYING"),ee(0));const s=C===-1?0:C;for(let n=s;n<f.length&&!R.current;n++){D(n);const a=f[n];let d=z.current.get(n);if(d||(E(!0),d=await G(n),E(!1)),R.current)break;try{await fe(a.text,!0,a.lang,void 0,void 0,d||void 0)}catch(g){console.error("Speech playback error at index",n,g)}}R.current||(T("IDLE"),D(-1),_(0),z.current.clear(),N.current.clear())},O=()=>{R.current=!0,Ee(),T("IDLE"),D(-1),_(0),z.current.clear(),N.current.clear(),E(!1)};o.useEffect(()=>(window.handleLessonSpeak=(s,n)=>{fe(s,!1,n)},()=>{O(),delete window.handleLessonSpeak}),[]),o.useEffect(()=>(window.resolveMarkdownNav=s=>{if(b!=="PAGED"||i==="INTENSITY"||i==="COMPARISON"||i==="MISTAKE")return!1;const n=V.get(s);if(n===void 0)return!1;const a=()=>{const d=Array.from(document.querySelectorAll("h1, h2, h3, h4")),g=d.find(q=>(q.textContent||"").trim().toLowerCase()===s),I=d.find(q=>(q.textContent||"").trim().toLowerCase().includes(s)),k=g||I;k?k.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})};return n!==v?(m(n),requestAnimationFrame(()=>requestAnimationFrame(a))):a(),!0},()=>{delete window.resolveMarkdownNav}),[b,i,V,v]);const W=!!t.listeningContent,te=!!t.testContent,X=!!(t.intensityRows&&t.intensityRows.length>0),P=!!(t.comparisonRows&&t.comparisonRows.length>0),Q=!!(t.mistakeRows&&t.mistakeRows.length>0),F=(X?1:0)+(P?1:0)+(Q?1:0)+1+(W?1:0)+(te?1:0);return o.useEffect(()=>{b==="PAGED"&&window.scrollTo({top:0,behavior:"smooth"})},[v,b]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300 relative min-h-screen",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("button",{onClick:l,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(Oe,{size:14}),e.jsx("span",{children:"Back to Library"})]}),h.length>1&&i!=="INTENSITY"&&i!=="COMPARISON"&&i!=="MISTAKE"&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>A("SCROLL"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${b==="SCROLL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Scroll View",children:[e.jsx(wt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Scroll"})]}),e.jsxs("button",{onClick:()=>A("PAGED"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${b==="PAGED"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Chapter View",children:[e.jsx(bt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Paged"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:t.title}),F>1&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[X&&e.jsxs("button",{onClick:()=>p("INTENSITY"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(je,{size:12,className:"inline mr-1"})," Scale"]}),P&&e.jsxs("button",{onClick:()=>p("COMPARISON"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Ae,{size:12,className:"inline mr-1"})," Contrast"]}),Q&&e.jsxs("button",{onClick:()=>p("MISTAKE"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="MISTAKE"?"bg-white text-rose-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(le,{size:12,className:"inline mr-1"})," Mistake"]}),e.jsxs("button",{onClick:()=>p("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Read"]}),W&&e.jsxs("button",{onClick:()=>p("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(we,{size:12,className:"inline mr-1"})," Listen"]}),te&&e.jsxs("button",{onClick:()=>p("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(be,{size:12,className:"inline mr-1"})," Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i==="LISTENING"&&W&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[S==="PLAYING"?e.jsx("button",{onClick:()=>{T("PAUSED"),Ee(),R.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(He,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:J,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(Xe,{size:20,fill:"currentColor"})}),S!=="IDLE"&&e.jsx("button",{onClick:O,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Qe,{size:20,fill:"currentColor"})})]}),e.jsx("button",{onClick:x,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(ye,{size:20})})]})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px] relative",children:i==="INTENSITY"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Intensity Scale"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Analyze how word choices change based on emphasis and context."})]}),e.jsx(Ct,{rows:t.intensityRows||[]})]}):i==="COMPARISON"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Word Contrast"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Deep dive into the nuances of confusing or similar vocabulary."})]}),e.jsx(It,{rows:t.comparisonRows||[]})]}):i==="MISTAKE"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Mistake Review"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Spot common mistakes and learn the correct form."})]}),e.jsx(At,{rows:t.mistakeRows||[]})]}):i==="TEST"&&!t.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(be,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available."})]}):i==="LISTENING"&&!t.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(we,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:j}})}),b==="PAGED"&&i!=="INTENSITY"&&i!=="COMPARISON"&&i!=="MISTAKE"&&h.length>1&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-neutral-200 flex items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsx("button",{onClick:()=>m(Math.max(0,v-1)),disabled:v===0,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(mt,{size:18})}),e.jsxs("div",{className:"relative px-2",ref:U,children:[e.jsxs("button",{onClick:()=>B(!K),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-2 py-1 transition-colors",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Chapter"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-sm text-neutral-900 max-w-[120px] truncate",children:h[v].title}),e.jsx(Ze,{size:12,className:"text-neutral-400"})]})]}),K&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-56 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-bottom",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:h.map((s,n)=>e.jsx("button",{onClick:()=>{m(n),B(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${n===v?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:s.title},n))})})]}),e.jsx("button",{onClick:()=>m(Math.min(h.length-1,v+1)),disabled:v===h.length-1,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(et,{size:18})})]})]})},Rt=({user:t,lesson:l,onComplete:x,onEdit:M,onUpdate:y})=>{const[i,p]=o.useState(null),{showToast:b}=ke(),A=m=>{var C,D,Y;const S=Se(),T=S.audioCoach.coaches[S.audioCoach.activeCoach].name;return m.format==="test"||i==="test"?ze(l.title,l.content,m.request,l.tags):Te({task:"convert_to_listening",currentLesson:{title:l.title,description:l.description,content:l.content},userRequest:m.request,language:m.language||((C=t.lessonPreferences)==null?void 0:C.language)||"English",targetAudience:((D=t.lessonPreferences)==null?void 0:D.targetAudience)||"Adult",tone:m.tone||((Y=t.lessonPreferences)==null?void 0:Y.tone)||"professional_professor",coachName:T})},v=async m=>{const S=m.result||m,T=m.format||i,C={...l,updatedAt:Date.now()};T==="listening"?(C.listeningContent=S.content,b("Audio script added successfully!","success")):(C.testContent=S.content,b("Practice test added successfully!","success")),await ie(C),y&&y(C),p(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Et,{lesson:l,onComplete:x,onEdit:M,onAddSound:()=>p("listening"),onAddTest:()=>p("test")}),i&&e.jsx(ve,{isOpen:!!i,onClose:()=>p(null),type:"GENERATE_AUDIO_SCRIPT",title:i==="listening"?"Add Lesson Sound":"Add Practice Test",description:i==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...t.lessonPreferences,format:i},onGeneratePrompt:A,onJsonReceived:v,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},Lt={filterSchema:[],viewSchema:[]},Me="vocab_pro_lesson_view_settings",Yt=({user:t,onStartSession:l,onNavigate:x,onUpdateUser:M,initialLessonId:y,onConsumeLessonId:i,initialTag:p,onConsumeTag:b,initialType:A,onConsumeType:v})=>{const[m,S]=o.useState([]),[T,C]=o.useState([]),[D,Y]=o.useState(!0),[E,H]=o.useState(null),[_,K]=o.useState(!1),[B,U]=o.useState(!1),[R,z]=o.useState(""),[N,c]=o.useState("ALL"),[h,V]=o.useState("all"),[j,f]=o.useState("all"),[G,ee]=o.useState(()=>st(Me,{showDesc:!0,compact:!1})),[J,O]=o.useState(0),[W,te]=o.useState(12),[X,P]=o.useState("list"),[Q,F]=o.useState(null),[s,n]=o.useState(null),[a,d]=o.useState(!1),{showToast:g}=ke();o.useEffect(()=>{at(Me,G)},[G]);const I=o.useCallback(async()=>{Y(!0);try{const[r,u]=await Promise.all([nt(t.id),rt()]),$=[...r.map(w=>{let L="ESSAY";return w.type==="intensity"&&(L="INTENSITY"),w.type==="comparison"&&(L="COMPARISON"),w.type==="mistake"&&(L="MISTAKE"),{type:L,data:w,path:w.path,tags:w.tags,date:w.createdAt}})];S($.sort((w,L)=>L.date-w.date)),C(u)}finally{Y(!1)}},[t.id]);o.useEffect(()=>{I()},[I]),o.useEffect(()=>{if(y&&m.length>0){const r=m.find(u=>u.data.id===y);r&&(F(r.data),P("read_lesson"),i==null||i())}},[y,m,i]),o.useEffect(()=>{p&&(H(p),b==null||b())},[p,b]),o.useEffect(()=>{A&&(c(A),v==null||v())},[A,v]),o.useEffect(()=>{O(0)},[E,R,N,h,j,W]);const k=o.useCallback(()=>{H(null),c("ALL"),V("all"),f("all")},[]),q=r=>{z(r),r.trim()&&k()},ne=o.useMemo(()=>N!=="ALL"||h!=="all"||j!=="all",[N,h,j]),se=o.useMemo(()=>{const r=R.toLowerCase().trim();return m.filter(u=>{var $,w;if(r){const L=(u.data.title||"").toLowerCase().includes(r),ue=(u.data.description||"").toLowerCase().includes(r),re=(u.data.searchKeywords||[]).some(Z=>(Z||"").toLowerCase().includes(r)),ae=(u.data.tags||[]).some(Z=>(Z||"").toLowerCase().includes(r));return!(!L&&!ue&&!re&&!ae)}if(N!=="ALL"&&u.type!==N||h==="focused"&&!u.data.isFocused||j!=="all"&&u.data.focusColor!==j)return!1;if(E){if(E==="Uncategorized"){const L=u.path??(u.tags||[]).find(re=>re.startsWith("/"));if(L&&L!=="/")return!1}else if(!(($=u.path)!=null&&$.startsWith(E))&&!((w=u.tags)!=null&&w.includes(E)))return!1}return!0})},[m,E,R,N,h,j]),he=o.useMemo(()=>{const r=J*W;return se.slice(r,r+W)},[se,J,W]),Ge=async()=>{s&&(await dt(s.id),g("Lesson deleted.","success"),n(null),I())},Fe=async r=>{await ie(r),g("Lesson saved!","success"),P("list"),F(null),I()},de=(r="essay")=>{const u={id:`lesson-${Date.now()}`,userId:t.id,topic1:"General",topic2:"General",type:r,title:r==="intensity"?"New Intensity Scale":r==="comparison"?"New Comparison Lab":r==="mistake"?"New Mistake Card":"New Lesson",description:"",content:"",tags:[],intensityRows:r==="intensity"?[{softened:[],neutral:[],intensified:[]}]:void 0,comparisonRows:r==="comparison"?[{word:"",nuance:"",example:""}]:void 0,mistakeRows:r==="mistake"?[{mistake:"educating staffs",explanation:"“Staff” is uncountable; “educating” is incorrect collocation.",correction:"teaching staff / teachers"}]:void 0,createdAt:Date.now(),updatedAt:Date.now()};F(u),P("edit_lesson")},$e=async r=>{const{result:u,preferences:$}=r;JSON.stringify(t.lessonPreferences)!==JSON.stringify($)&&await M({...t,lessonPreferences:$});const w={id:`lesson-ai-${Date.now()}`,userId:t.id,title:u.title,description:u.description,content:u.content,tags:u.tags||[],searchKeywords:u.searchKeywords||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"General",topic2:"General"};await ie(w),g("Lesson created with AI!","success"),d(!1),F(w),P("read_lesson"),I()},_e=async(r,u)=>{const $={...r.data,focusColor:u||void 0,updatedAt:Date.now()};u||delete $.focusColor,await ie($),S(w=>w.map(L=>L.data.id===r.data.id?{...L,data:{...L.data,focusColor:u||void 0,updatedAt:Date.now()}}:L))},Ke=async r=>{const u={...r.data,isFocused:!r.data.isFocused,updatedAt:Date.now()};await ie(u),S($=>$.map(w=>w.data.id===r.data.id?{...w,data:{...w.data,isFocused:!w.data.isFocused,updatedAt:Date.now()}}:w))},Ue=()=>{S(r=>[...r].sort(()=>Math.random()-.5)),g("Deck shuffled!","success")},We=[{label:"Topic Lesson (AI)",icon:oe,onClick:()=>d(!0)},{label:"Intensity Scale",icon:je,onClick:()=>de("intensity")},{label:"Comparison Lab",icon:Ae,onClick:()=>de("comparison")},{label:"Mistake Card",icon:le,onClick:()=>de("mistake")},{label:"New Lesson (Manual)",icon:pe,onClick:()=>de("essay")}],Ye=r=>{const u=Se(),$=u.audioCoach.activeCoach,w=u.audioCoach.coaches[$].name;return Te({topic:r.topic,language:r.language,targetAudience:r.targetAudience,tone:r.tone,format:r.format,coachName:w,task:"create_reading"})};if(X==="read_lesson"&&Q)return e.jsx(Rt,{user:t,lesson:Q,onComplete:()=>P("list"),onEdit:()=>P("edit_lesson"),onUpdate:r=>F(r)});if(X==="edit_lesson"&&Q)return e.jsx(vt,{lesson:Q,user:t,onSave:Fe,onPractice:r=>{F(r),P("read_lesson")},onCancel:()=>P("list")});const Be=()=>e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[_&&e.jsx(xt,{items:m.map(r=>r.data),selectedTag:E,onSelectTag:H,forcedView:"tags",title:"Browse Tags",icon:e.jsx(De,{size:16})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:flex-1 max-w-sm",children:[e.jsx(ct,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:R,onChange:r=>q(r.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-xs font-bold focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto w-full sm:w-auto pb-2 sm:pb-0 no-scrollbar",children:[e.jsxs("button",{onClick:()=>c("ALL"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="ALL"?"bg-neutral-900 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-neutral-900"}`,children:[e.jsx(ft,{size:12})," All"]}),e.jsxs("button",{onClick:()=>c("ESSAY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="ESSAY"?"bg-emerald-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-emerald-600"}`,children:[e.jsx(xe,{size:12})," Lesson"]}),e.jsxs("button",{onClick:()=>c("INTENSITY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="INTENSITY"?"bg-orange-500 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-orange-500"}`,children:[e.jsx(Re,{size:12})," Scale"]}),e.jsxs("button",{onClick:()=>c("COMPARISON"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="COMPARISON"?"bg-indigo-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-indigo-600"}`,children:[e.jsx(Le,{size:12})," Diff"]}),e.jsxs("button",{onClick:()=>c("MISTAKE"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="MISTAKE"?"bg-rose-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-rose-600"}`,children:[e.jsx(le,{size:12})," Mistake"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(ut,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),pagination:{page:J,totalPages:Math.ceil(se.length/W),onPageChange:O,pageSize:W,onPageSizeChange:te,totalItems:se.length},aboveGrid:e.jsx(Be,{}),config:Lt,activeFilters:{},onFilterChange:()=>{},isLoading:D,isEmpty:se.length===0,emptyMessage:"No items found matching your criteria.",actions:e.jsx(pt,{viewMenu:e.jsx(gt,{isOpen:B,setIsOpen:U,hasActiveFilters:ne,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(it,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>V(h==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${h==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:h==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>f(j==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${j==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>f(j==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${j==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>f(j==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${j==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:G.showDesc,onChange:()=>ee(r=>({...r,showDesc:!r.showDesc}))},{label:"Compact",checked:G.compact,onChange:()=>ee(r=>({...r,compact:!r.compact}))}]}),browseTags:{isOpen:_,onToggle:()=>{K(!_)}},addActions:We,extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:Ue,disabled:se.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Shuffle Deck",children:e.jsx(ot,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:he.map(r=>{const u=()=>{F(r.data),P("read_lesson")},$=()=>{F(r.data),P("edit_lesson")},w=()=>n(r.data),L=r.type==="INTENSITY",ue=r.type==="COMPARISON",re=r.type==="MISTAKE";let ae;return L?ae={label:"Scale",colorClass:"bg-orange-50 text-orange-700 border-orange-100",icon:Re}:ue?ae={label:"Diff",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:Le}:re?ae={label:"Mistake",colorClass:"bg-rose-50 text-rose-700 border-rose-100",icon:le}:ae={label:"Lesson",colorClass:"bg-emerald-50 text-emerald-700 border-emerald-100",icon:xe},e.jsx(ht,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:r.data.title}),tags:r.data.tags,badge:ae,compact:G.compact,onClick:u,focusColor:r.data.focusColor,onFocusChange:Z=>_e(r,Z),isFocused:r.data.isFocused,onToggleFocus:()=>Ke(r),isCompleted:r.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z=>{Z.stopPropagation(),u()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(Pe,{size:14})}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),$()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ye,{size:14})}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),w()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(ce,{size:14})})]}),children:G.showDesc&&r.data.description&&e.jsx("p",{className:"line-clamp-3 mt-1",children:r.data.description})},`${r.type}-${r.data.id}`)})})}),e.jsx(lt,{isOpen:!!s,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:Ge,onClose:()=>n(null),icon:e.jsx(ce,{size:40,className:"text-red-500"})}),e.jsx(ve,{isOpen:a,onClose:()=>d(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:t.lessonPreferences,onGeneratePrompt:Ye,onJsonReceived:$e,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{Yt as LessonLibraryV2,Yt as default};
