import{c as xe,j as e,r as t,P as pt,I as Ee,b9 as De,Z as ie,Y as Re,ao as Le,ba as Oe,e as He,U as ve,a4 as pe,bb as bt,bc as gt,a0 as jt,aG as wt,D as ze,a6 as vt,av as yt,bd as ke,be as Ke,t as rt,H as oe,b3 as We,V as Ae,J as ge,w as Ue,X as ne,h as Nt,an as de,z as we,b0 as kt,b2 as St,f as nt,b as Be,aW as it,aF as Ct,bf as It,b5 as Et,a5 as Xe,am as Ze,bg as Te,bh as Rt,k as Je,aQ as et,aU as At,bi as Mt,N as zt,M as Tt,aS as Ve,o as _e,bj as _t,l as me,bk as Ge,T as Ft,af as Pt}from"./index-DfVW4Y4d.js";import{C as Dt,S as $e,A as $t,T as Lt,L as Ot}from"./AvatarSelectionModal-DME0R6y4.js";import{T as ot}from"./trophy-DNpGRLN1.js";import{C as ct}from"./chevron-left-Vm6DOqvS.js";import{B as Ye,K as Ht}from"./keyboard-C545HiW-.js";import{a as dt,S as Wt}from"./split-DDyzIxSm.js";import{L as Ut}from"./layout-grid-DDOLql7W.js";import{C as Bt}from"./columns-2-DLW5DzJy.js";import{S as Vt}from"./square-check-big-DVtDNsZN.js";import{S as Gt}from"./server-CtZZdAE-.js";import"./palette-BFqow9Vr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=xe("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=xe("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=xe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=xe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=xe("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=xe("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=xe("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=xe("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=xe("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=xe("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),ht=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],Xt=s=>{let f="Novice Soul";for(const A of ht)if(s>=A.level)f=A.title;else break;return f},Zt=s=>s>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:s>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:s>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:s>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},Jt=({user:s,xpToNextLevel:f,onUpdateUser:A,isRecalculatingXp:x})=>{const[G,E]=t.useState(!1),Z=f>0?Math.min(100,Math.max(0,s.experience/f*100)):0,m=s.peakLevel||s.level,X=m>0?Math.min(100,Math.max(0,s.level/m*100)):100,C=Zt(s.level),$=s.adventure,Q=Xt(s.level),U=ht.find(V=>V.level>s.level),Y=async V=>{await A({...s,avatar:V}),E(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>E(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${C.frame} shadow-md ${C.shadow}`,children:[e.jsx("img",{src:s.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(pt,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:s.name}),x&&e.jsx(Ee,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(Dt,{size:12,className:"text-yellow-500"})," ",Q]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",s.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[s.experience," / ",f," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${Z}%`}})})]}),m>s.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[s.level," / ",m," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${X}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(De,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:($==null?void 0:$.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(xt,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[($==null?void 0:$.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(ie,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:($==null?void 0:$.energy)??0})]})]}),U&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",U.level," for: ",e.jsx("strong",{children:U.title})]}),e.jsx($e,{size:12,className:"text-amber-400"})]})]})]}),e.jsx($t,{isOpen:G,onClose:()=>E(!1),onSelectAvatar:Y,currentUser:s})]})},es=({user:s,xpToNextLevel:f,onUpdateUser:A,isRecalculatingXp:x,children:G})=>e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(Jt,{user:s,xpToNextLevel:f,onUpdateUser:A,isRecalculatingXp:x})}),e.jsx("div",{className:"flex-1 min-h-0 relative",children:G})]}),ce={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},ts=s=>{var f,A;switch(s.type){case"boss":return s.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((f=s.boss_details)==null?void 0:f.image)||"üëπ",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(He,{size:10,className:"text-white"})})]}):((A=s.boss_details)==null?void 0:A.image)||"üëπ";case"treasure":return"üëë";case"key_fragment":return"üóùÔ∏è";default:return"‚òÖ"}},ss=s=>s>=50?4:s>=25?3:s>=10?2:1,as=({user:s})=>{const f=ss(s.peakLevel||1),A=f===1?"shadow-indigo-500/50":f===2?"shadow-cyan-500/60":f===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:ce.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:s.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${A}`,children:["Lvl ",s.peakLevel||1]})]})},ls=({isOpen:s,onClose:f,defeatedBosses:A})=>s?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(ot,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:f,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:A.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(mt,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:A.map(x=>{var G,E;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(He,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(G=x.boss_details)==null?void 0:G.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(E=x.boss_details)==null?void 0:E.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",x.id+1]})]},x.id)})})})]})}):null,rs=({user:s,progress:f,onExit:A,map:x,onMove:G,onNodeClick:E,onOpenInventory:Z,onAdminAction:m})=>{const C=x.length,$=5,[Q,U]=t.useState(0),[Y,V]=t.useState(!1),z=Math.min(C-6,f.currentNodeIndex),q=x.filter(u=>u.type==="boss"&&u.isDefeated);t.useEffect(()=>{l()},[f.currentNodeIndex]);const l=()=>{let u=f.currentNodeIndex-Math.floor(3);u<0&&(u=0),u>z&&(u=z),U(u)},c=u=>{U(R=>{let T=u==="left"?R-1:R+1;return T<0&&(T=0),T>z&&(T=z),T})},M=C/6*100,O=-(Q*(100/C)),L=O*.3,P=50/C,b=x[f.currentNodeIndex],w=(b==null?void 0:b.type)==="boss"&&!(b!=null&&b.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${M}%`,transform:`translateX(${L}%)`},children:[e.jsx("img",{src:ce.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:ce.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:ce.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"üåÄ"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"üåö"}),e.jsx("img",{src:ce.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:ce.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:ce.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:ce.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:ce.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"üåÄ"}),e.jsx("img",{src:ce.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"üåö"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(ie,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[f.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(De,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:f.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[f.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>V(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(ot,{size:18}),q.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:l,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(Qt,{size:18})}),e.jsx("button",{onClick:Z,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(ut,{size:18})}),e.jsx("button",{onClick:A,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(Re,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>c("left"),disabled:Q===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(ct,{size:32})}),e.jsx("button",{onClick:()=>c("right"),disabled:Q>=z,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(Le,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${M}%`,transform:`translateX(${O}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${P}%`,right:`${P}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${f.currentNodeIndex/(C-1)*100}%`}})})}),x.map((u,R)=>{if(R>f.currentNodeIndex+$)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},u.id);const h=R===f.currentNodeIndex,a=R<f.currentNodeIndex,y=u.type==="boss",o=u.isDefeated;let d="w-16 h-16",r="bg-slate-800 border-slate-600 text-slate-500 cursor-default",i="",g="scale(1)";return h?(r="bg-slate-700 border-slate-500 text-slate-300",i="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):a&&(r="bg-emerald-900/80 border-emerald-500 text-emerald-400",i="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),y&&(d="w-24 h-24",o?(r="bg-slate-800 border-slate-600 text-slate-500",h&&(r="bg-slate-700 border-slate-500 text-slate-400")):(r="bg-red-950 border-red-600 text-red-500 cursor-pointer",i="shadow-[0_0_20px_rgba(220,38,38,0.4)]",h&&(r="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",g="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[h&&e.jsx(as,{user:s}),h&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>E(u),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${d} ${r} ${i}`,style:{transform:g},children:[e.jsx("span",{className:"text-3xl font-black",children:ts(u)}),y&&h&&!o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(Oe,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!h&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${a?"text-emerald-500":"text-slate-600"}`,children:R+1})]})},u.id)})]})})]}),s.isAdmin&&m&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(Lt,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>m("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(ie,{size:12})," +10"]}),e.jsx("button",{onClick:()=>m("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>m("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(De,{size:12})," +1"]}),e.jsx("button",{onClick:()=>m("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>m("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"üß™+"}),e.jsx("button",{onClick:()=>m("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>m("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"üçé+"}),e.jsx("button",{onClick:()=>m("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>m("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(He,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",f.currentNodeIndex+1," / ",x.length]}),e.jsxs("button",{onClick:G,disabled:f.energy<=0||w,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(ve,{size:18})]})]}),e.jsx(ls,{isOpen:Y,onClose:()=>V(!1),defeatedBosses:q})]})},ye=5,ns=({user:s,boss:f,words:A,onVictory:x,onDefeat:G,onExit:E,onUpdateUser:Z})=>{const{showToast:m}=pe(),[X,C]=t.useState(f.hp),[$,Q]=t.useState(ye),[U,Y]=t.useState(0),[V,z]=t.useState("idle"),[q,l]=t.useState("none"),[c,M]=t.useState("intro"),[O,L]=t.useState(600),[P,b]=t.useState(!1),[w,u]=t.useState(!1),[R,T]=t.useState(!1),h=t.useMemo(()=>[...A].sort(()=>Math.random()-.5),[A]),a=h[U%h.length];t.useEffect(()=>{if(c==="fighting"){const k=setInterval(()=>{L(n=>n<=1?(clearInterval(k),M("lost"),0):n-1)},1e3);return()=>clearInterval(k)}},[c]),t.useEffect(()=>{u(!1)},[U]),t.useEffect(()=>{const k=n=>{n.key==="Escape"&&E()};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[E]);const y=async k=>{const n=k!==ze.FORGOT;M("animating"),n?(z("player-attacking"),setTimeout(()=>{z("idle"),l("boss-hit"),C(W=>Math.max(0,W-1)),setTimeout(()=>{l("none"),o()},800)},600)):(z("boss-attacking"),setTimeout(()=>{z("idle"),l("player-hit"),Q(W=>Math.max(0,W-1)),setTimeout(()=>{l("none"),o()},800)},600));const H=n?ze.EASY:ze.FORGOT,N=vt(a,H);N.lastReviewSessionType="boss_battle",await yt(N)},o=()=>{C(k=>(Q(n=>(k<=0?M("won"):n<=0?M("lost"):(Y(H=>H+1),M("fighting")),n)),k))},d=k=>{const n=Math.floor(k/60),H=k%60;return`${n}:${H.toString().padStart(2,"0")}`},r=k=>{var n,H;return!(k.type==="SPELLING"||k.type==="COLLOCATION_QUIZ"&&(((n=k.word.collocationsArray)==null?void 0:n.filter(W=>!W.isIgnored&&W.d))||[]).length>2||k.type==="PARAPHRASE_QUIZ"&&(((H=k.word.paraphrases)==null?void 0:H.filter(W=>!W.isIgnored))||[]).length>2)},i=async()=>{if((s.adventure.hpPotions||0)<=0)return;if($>=ye){m("Health is already full!","info");return}Q(n=>Math.min(ye,n+1));const k={...s.adventure};k.hpPotions=(k.hpPotions||0)-1,await Z({...s,adventure:k}),m("+1 HP Recovered!","success")},g=async()=>{if((s.adventure.wisdomFruits||0)<=0)return;if(w){m("Hint is already active!","info");return}u(!0);const k={...s.adventure};k.wisdomFruits=(k.wisdomFruits||0)-1,await Z({...s,adventure:k}),m("Wisdom Fruit Used! Hint revealed.","success")},D=(s.adventure.hpPotions||0)>0||(s.adventure.wisdomFruits||0)>0;if(c==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:f.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:f.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',f.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>M("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(Oe,{size:24})," FIGHT!"]})]});if(c==="won"||c==="lost"){const k=c==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${k?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!k&&"grayscale opacity-50"}`,children:k?"üèÜ":"üíÄ"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${k?"text-emerald-400":"text-red-500"}`,children:k?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:k?`&quot;${f.dialogueWin}&quot;`:`&quot;${f.dialogueLose}&quot;`}),e.jsx("button",{onClick:k?x:G,className:`px-8 py-3 font-bold rounded-xl transition-all ${k?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:k?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"fixed top-4 right-4 z-[1000] flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b(!P),className:`p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 group ${P?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(bt,{size:24}),D&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),e.jsxs("div",{className:`flex items-center justify-center gap-2 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 font-mono font-black ${O<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(gt,{size:24,className:O<60?"animate-spin":""}),e.jsx("span",{className:"text-base tracking-widest",children:d(O)})]}),e.jsx("button",{onClick:()=>T(!0),className:"p-3 rounded-xl border-2 bg-red-950/80 border-red-500/60 text-red-400 backdrop-blur-md shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:bg-red-900 hover:text-white hover:border-red-400 hover:shadow-[0_0_20px_rgba(239,68,68,0.5)] active:scale-95 transition-all duration-300",title:"Flee Battle",children:e.jsx(Yt,{size:24})}),P&&e.jsxs("div",{className:"absolute top-full right-0 mt-3 z-[9998] bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-top-2 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üß™"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:i,disabled:(s.adventure.hpPotions||0)<=0||$>=ye,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üçé"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:g,disabled:(s.adventure.wisdomFruits||0)<=0||w,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]})]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:f.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${X/f.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(tt,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[X," / ",f.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${q==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:f.image}),q==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"üí•"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-auto",children:[V==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(Kt,{className:"fill-cyan-400 rotate-45",size:48})}),V==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(mt,{className:"fill-red-900",size:48})}),c==="fighting"&&a?e.jsx("div",{className:"w-full max-w-md z-10 animate-in zoom-in-95 duration-300 flex items-stretch",children:e.jsx(jt,{word:a,isQuickFire:!0,onComplete:y,onClose:E,isModal:!1,disableHints:!w,forceShowHint:w,challengeFilter:r,skipRecap:!0})}):c==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[q==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"üí•"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${q==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:s.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:ye}).map((k,n)=>e.jsx(tt,{size:18,fill:n<$?"#ef4444":"none",className:`transition-all duration-300 ${n<$?"text-red-500 scale-100":"text-slate-600 scale-90"}`},n))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `}),R&&e.jsx(wt,{isOpen:R,title:"Retreat from Battle?",description:"Are you sure you want to flee the battle? Your progress will be lost.",confirmText:"Flee",cancelText:"Stay",onConfirm:()=>{T(!1),E()},onCancel:()=>T(!1)})]})},is=({isOpen:s,onClose:f,badges:A,hpPotions:x,wisdomFruits:G,energy:E,onUseBadge:Z,onExchangeEnergyForDice:m})=>{if(!s)return null;const X=new Set(A.filter($=>$!=="locked_chest")).size,C=Object.keys(ke).filter($=>$!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(ut,{size:20})," T√∫i ƒë·ªì"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"V·∫≠t ph·∫©m & Huy hi·ªáu thu th·∫≠p ƒë∆∞·ª£c."})]}),e.jsx("button",{type:"button",onClick:f,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(Oe,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üß™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",x]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üçé"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",G]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(ie,{size:12})," Exchange"]}),e.jsxs("div",{className:"rounded-2xl border border-cyan-100 bg-cyan-50 p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-black text-cyan-900",children:["Energy: ",E]}),e.jsx("div",{className:"text-xs text-cyan-700",children:"Exchange 3 Energies for 1 Lucky Dice üé≤"})]}),e.jsx("button",{type:"button",onClick:m,disabled:E<3,className:"px-3 py-2 rounded-xl text-xs font-black uppercase tracking-wider bg-cyan-600 text-white hover:bg-cyan-500 disabled:bg-neutral-300 disabled:text-neutral-500 disabled:cursor-not-allowed transition-colors",children:"Exchange"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(ie,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[X,"/",C]})]}),A.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Ch∆∞a c√≥ huy hi·ªáu."}),e.jsx("p",{className:"text-xs",children:"M·ªü R∆∞∆°ng ho·∫∑c ƒë√°nh Boss ƒë·ªÉ nh·∫≠n."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:A.map(($,Q)=>{const U=ke[$];if(!U)return null;const Y=$==="locked_chest"||$==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:U.icon}),Y&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:U.name}),Y&&e.jsxs("button",{onClick:()=>Z($),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(qt,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${$}-${Q}`)})})]})]})]})})},os=30,cs=({onComplete:s,badge:f})=>{const[A]=t.useState(()=>Array.from({length:os}).map(()=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return f?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:A.map((x,G)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${x.size}px`,height:`${x.size}px`,backgroundColor:x.color,transform:`rotate(${x.angle}deg) translate(${x.distance}px)`,opacity:0,animation:`explode ${x.duration}s ease-out ${x.delay}s forwards`}},G))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:f.icon}),e.jsx($e,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx($e,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:f.name})]}),e.jsx("button",{onClick:s,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(Re,{size:16})]})})]})]}):null},Fe=({user:s,onExit:f,onUpdateUser:A})=>{const{showToast:x}=pe(),[G,E]=t.useState(null),[Z,m]=t.useState(!1),[X,C]=t.useState(null);t.useEffect(()=>{if(!s.adventure.map){const l=Ke(100);A({...s,adventure:{...s.adventure,map:l}})}},[]);const $=s.adventure.map||Ke(100),Q=async()=>{const l={...s.adventure};if(l.energy<=0){x("Not enough energy to move!","error");return}l.energy-=1;const c=l.currentNodeIndex+1;l.currentNodeIndex=c;const M=$[c];M&&(M.type==="standard"?(l.energyShards=(l.energyShards||0)+1,x("+1 Energy Shard ‚ö°","success",2e3)):M.type==="key_fragment"?(l.keyFragments=(l.keyFragments||0)+1,x("Picked up a Key Fragment üóùÔ∏è","success",3e3)):M.type==="treasure"&&(l.badges=[...l.badges||[],"locked_chest"],x("Picked up a Locked Chest! üß∞ (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(l.hpPotions=(l.hpPotions||0)+1,x("You found an HP Potion! üß™","success",4e3)):(l.wisdomFruits=(l.wisdomFruits||0)+1,x("You found a Wisdom Fruit! üçé","success",4e3))),Math.random()<.2&&(l.badges=[...l.badges||[],"lucky_dice"],x("You found a Lucky Dice! üé≤","success",4e3)),await A({...s,adventure:l})},U=async l=>{if(l.id===s.adventure.currentNodeIndex&&l.type==="boss"){if(l.isDefeated){x("This boss has already been defeated.","info");return}const c=rt().filter(P=>P.userId===s.id);if(c.length===0){x("You have no words in your library to fight a boss. Add some words first!","error");return}const M=c.filter(P=>P.lastReview);M.length<20&&x("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let O=[...M].sort(()=>.5-Math.random());if(O.length<20){const P=new Set(O.map(u=>u.id)),b=c.filter(u=>!P.has(u.id)),w=20-O.length;O.push(...[...b].sort(()=>.5-Math.random()).slice(0,w))}O=O.slice(0,20);const L={...l.boss_details,hp:20};E({boss:L,words:O})}},Y=async()=>{x("Boss defeated! +1 Key Fragment","success");const l={...s.adventure};if(l.keyFragments=(l.keyFragments||0)+1,l.map){const c=[...l.map],M=l.currentNodeIndex;c[M]&&(c[M]={...c[M],isDefeated:!0}),l.map=c}await A({...s,adventure:l}),E(null)},V=async l=>{const c={...s.adventure};if(c.badges=c.badges||[],l==="locked_chest"){if((c.keys||0)<=0){x("You need a Magic Key üóùÔ∏è to open this chest!","error");return}c.keys-=1;const M=c.badges.indexOf("locked_chest");M>-1&&c.badges.splice(M,1);const O=Object.keys(ke).filter(w=>w!=="locked_chest"&&w!=="lucky_dice"),L=c.badges||[],P=O.filter(w=>!L.includes(w));let b;P.length>0?b=P[Math.floor(Math.random()*P.length)]:b=O[Math.floor(Math.random()*O.length)],c.badges.push(b),await A({...s,adventure:c}),C(ke[b]),m(!1)}else if(l==="lucky_dice"){const M=c.badges.indexOf("lucky_dice");if(M>-1)c.badges.splice(M,1);else return;const O=Math.random();O<.2?(c.energy+=3,x("Dice rolled! +3 Energy ‚ö°","success",3e3)):O<.4?(c.keys=(c.keys||0)+1,x("Dice rolled! +1 Magic Key üóùÔ∏è","success",3e3)):O<.6?(c.badges.push("locked_chest"),x("Dice rolled! +1 Locked Chest üß∞","success",3e3)):O<.8?(c.hpPotions=(c.hpPotions||0)+1,x("Dice rolled! +1 HP Potion üß™","success",3e3)):(c.wisdomFruits=(c.wisdomFruits||0)+1,x("Dice rolled! +1 Wisdom Fruit üçé","success",3e3)),await A({...s,adventure:c})}else C(ke[l])},z=async()=>{const l={...s.adventure},c=l.energy||0;if(c<3){x("Need at least 3 Energy to exchange for a Lucky Dice.","error");return}l.energy=c-3,l.badges=[...l.badges||[],"lucky_dice"],await A({...s,adventure:l}),x("Exchanged 3 Energy for 1 Lucky Dice! üé≤","success",3e3)},q=async l=>{const c={...s.adventure};if(l==="add_energy")c.energy=(c.energy||0)+10,x("Admin: +10 Energy","success");else if(l==="remove_energy")c.energy=Math.max(0,(c.energy||0)-1),x("Admin: -1 Energy","info");else if(l==="add_key")c.keys=(c.keys||0)+1,x("Admin: +1 Key","success");else if(l==="remove_key")c.keys=Math.max(0,(c.keys||0)-1),x("Admin: -1 Key","info");else if(l==="add_hp")c.hpPotions=(c.hpPotions||0)+1,x("Admin: +1 HP Potion","success");else if(l==="remove_hp")c.hpPotions=Math.max(0,(c.hpPotions||0)-1),x("Admin: -1 HP Potion","info");else if(l==="add_fruit")c.wisdomFruits=(c.wisdomFruits||0)+1,x("Admin: +1 Wisdom Fruit","success");else if(l==="remove_fruit")c.wisdomFruits=Math.max(0,(c.wisdomFruits||0)-1),x("Admin: -1 Wisdom Fruit","info");else if(l==="pass_boss"){const M=$[c.currentNodeIndex];if(M&&M.type==="boss"){if(G){await Y();return}if(x("Admin: Force Boss Victory","success"),c.keyFragments=(c.keyFragments||0)+1,c.map){const O=[...c.map],L=c.currentNodeIndex;O[L]&&(O[L]={...O[L],isDefeated:!0}),c.map=O}}else x("Not currently at a boss node.","info")}await A({...s,adventure:c})};return G?e.jsx(ns,{user:s,boss:G.boss,words:G.words,onVictory:Y,onDefeat:()=>{x("You were defeated. Study more and try again!","error"),E(null)},onExit:()=>E(null),onUpdateUser:A}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{user:s,progress:s.adventure,onExit:f,map:$,onMove:Q,onNodeClick:U,onOpenInventory:()=>m(!0),onAdminAction:q}),e.jsx(is,{isOpen:Z,onClose:()=>m(!1),badges:s.adventure.badges||[],onUseBadge:V,hpPotions:s.adventure.hpPotions||0,wisdomFruits:s.adventure.wisdomFruits||0,energy:s.adventure.energy||0,onExchangeEnergyForDice:z}),X&&e.jsx(cs,{badge:X,onComplete:()=>C(null)})]})},Se=[{id:"i_ii",sym1:"…™",sym2:"iÀê",label:"Short i vs Long ee",example:"sit / seat",category:"VOWELS"},{id:"u_uu",sym1:" ä",sym2:"uÀê",label:"Short u vs Long oo",example:"full / fool",category:"VOWELS"},{id:"ae_e",sym1:"√¶",sym2:"e",label:"Short a vs Short e",example:"man / men",category:"VOWELS"},{id:"ae_v",sym1:"√¶",sym2:" å",label:"Short a vs Short u",example:"cat / cut",category:"VOWELS"},{id:"o_or",sym1:"…í",sym2:"…îÀê",label:"Short o vs Long aw",example:"cot / caught",category:"VOWELS"},{id:"er_or",sym1:"…úÀê",sym2:"…îÀê",label:"Stressed er vs aw",example:"bird / board",category:"VOWELS"},{id:"aa_ae",sym1:"…ëÀê",sym2:"√¶",label:"Long a vs Short a",example:"cart / cat",category:"VOWELS"},{id:"th_t",sym1:"Œ∏",sym2:"t",label:"Voiceless TH vs T",example:"think / tin",category:"CONSONANTS"},{id:"dh_d",sym1:"√∞",sym2:"d",label:"Voiced TH vs D",example:"this / dis",category:"CONSONANTS"},{id:"s_sh",sym1:"s",sym2:" É",label:"S vs SH",example:"see / she",category:"CONSONANTS"},{id:"ch_j",sym1:"t É",sym2:"d í",label:"CH vs J",example:"cheap / jeep",category:"CONSONANTS"},{id:"f_v",sym1:"f",sym2:"v",label:"F vs V",example:"fan / van",category:"CONSONANTS"},{id:"b_p",sym1:"b",sym2:"p",label:"B vs P",example:"bat / pat",category:"CONSONANTS"},{id:"k_g",sym1:"k",sym2:"g",label:"K vs G",example:"coat / goat",category:"CONSONANTS"},{id:"s_z",sym1:"s",sym2:"z",label:"S vs Z",example:"rice / rise",category:"CONSONANTS"},{id:"t_d_ed",sym1:"t",sym2:"d",label:"Past tense -ed",example:"worked / played",category:"CONSONANTS"},{id:"ng_n",sym1:"≈ã",sym2:"n",label:"Final NG vs N",example:"sing / sin",category:"CONSONANTS"},{id:"r_l",sym1:"r",sym2:"l",label:"R vs L",example:"right / light",category:"CONSONANTS"},{id:"ay_ae",sym1:"e…™",sym2:"√¶",label:"Diphthong ay vs Short a",example:"face / fat",category:"DIPHTHONGS"},{id:"ai_ii",sym1:"a…™",sym2:"iÀê",label:"Diphthong ai vs Long ee",example:"time / team",category:"DIPHTHONGS"},{id:"oh_aw",sym1:"…ô ä",sym2:"…îÀê",label:"Diphthong oh vs aw",example:"go / saw",category:"DIPHTHONGS"},{id:"ear_ee",sym1:"…™…ô",sym2:"iÀê",label:"ear vs ee",example:"here / he",category:"DIPHTHONGS"},{id:"air_ae",sym1:"e…ô",sym2:"√¶",label:"air vs short a",example:"hair / hat",category:"DIPHTHONGS"}],ds=({words:s,onComplete:f,onExit:A,onBulkUpdate:x})=>{const[G,E]=t.useState("SETUP"),[Z,m]=t.useState("MASTER"),[X,C]=t.useState(null),[$,Q]=t.useState([]),[U,Y]=t.useState(0),[V,z]=t.useState(null),q=t.useRef(new Map),l=(b,w)=>{if(!b)return!1;(w==="t"||w==="d")&&(b.includes("t É")||b.includes("d í"));const u=w.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let R;return w==="d"?R=new RegExp(`${u}(?! í)`):w==="t"?R=new RegExp(`${u}(?! É)`):w===" É"?R=new RegExp(`(?<!t)${u}`):w===" í"?R=new RegExp(`(?<!d)${u}`):w==="…™"?R=new RegExp(`(?<![ae…î])${u}(?!…ô)`):w===" ä"?R=new RegExp(`(?<![a…ô])${u}`):w==="e"?R=new RegExp(`${u}(?!…™|…ô)`):w==="…ô"?R=new RegExp(`(?<![…™ äe])${u}(?! ä)`):R=new RegExp(u),R.test(b)},c=t.useMemo(()=>{const b=new Map,w=s.filter(u=>u.ipaUs&&u.ipaUs.length>2);return Se.forEach(u=>{const R=w.filter(y=>l(y.ipaUs,u.sym1)||l(y.ipaUs,u.sym2)),T=R.length,h=R.filter(y=>{const o=`IPA_SORTER:${u.id}`;return y.lastTestResults&&y.lastTestResults[o]===!0}).length,a=R.filter(y=>{const o=`IPA_SORTER:${u.id}`;return!y.lastTestResults||y.lastTestResults[o]!==!0}).length;b.set(u.id,{total:T,correct:h,availableForMaster:a})}),b},[s]),M=b=>{let u=s.filter(h=>h.ipaUs&&h.ipaUs.length>2).filter(h=>l(h.ipaUs,b.sym1)||l(h.ipaUs,b.sym2));if(Z==="MASTER"&&(u=u.filter(h=>{const a=`IPA_SORTER:${b.id}`;return!h.lastTestResults||h.lastTestResults[a]!==!0})),u.length<3){alert(`Not enough words found for this mode (${u.length}). Try 'Review All' or add more words.`);return}const R=[],T=u.sort(()=>Math.random()-.5).slice(0,15);for(const h of T){const a=l(h.ipaUs,b.sym1),y=l(h.ipaUs,b.sym2),o=a&&y?Math.random()>.5?b.sym1:b.sym2:a?b.sym1:b.sym2,d=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let r;o==="d"?r=new RegExp(`${d}(?! í)`,"g"):o==="t"?r=new RegExp(`${d}(?! É)`,"g"):o===" É"?r=new RegExp(`(?<!t)${d}`,"g"):o===" í"?r=new RegExp(`(?<!d)${d}`,"g"):o==="…™"?r=new RegExp(`(?<![ae…î])${d}(?!…ô)`,"g"):o==="e"?r=new RegExp(`${d}(?!…™|…ô)`,"g"):r=new RegExp(d,"g");const i=h.ipaUs.replace(r,"___");R.push({id:h.id,wordObj:h,word:h.word,ipa:h.ipaUs,maskedIpa:i,targetSymbol:o})}Q(R),C(b),Y(0),E("PLAYING")},O=b=>{const w=$[0];if(!w||V||!X)return;const u=w.targetSymbol===b;z({symbol:b,correct:u});const R=u?U+10:Math.max(0,U-5);Y(R);const T=`IPA_SORTER:${X.id}`,h={...w.wordObj};h.lastTestResults||(h.lastTestResults={}),h.lastTestResults[T]=u,h.updatedAt=Date.now(),q.current.set(h.id,h),setTimeout(()=>{const a=$.slice(1);Q(a),z(null),a.length===0&&(x(Array.from(q.current.values())),q.current.clear(),f(R))},800)},L=()=>{q.current.size>0&&(x(Array.from(q.current.values())),q.current.clear()),G==="PLAYING"?E("SETUP"):A()};if(G==="SETUP"){const b=y=>{const o=c.get(y.id)||{total:0,correct:0,availableForMaster:0},d=o.total>=3,r=Z==="ALL"?d:o.availableForMaster>=3,i=o.total>0?o.correct/o.total*100:0;let g;return d?i>=80?g="text-emerald-700 bg-emerald-100 border-emerald-200":i>0?g="text-amber-700 bg-amber-100 border-amber-200":g="text-rose-700 bg-rose-100 border-rose-200":g="text-neutral-300 bg-neutral-50 border-neutral-100",e.jsxs("button",{onClick:()=>r&&M(y),disabled:!r,className:`
                        w-full flex flex-col gap-1 p-3 rounded-xl border transition-all text-left relative overflow-hidden group shrink-0
                        ${r?"bg-white border-neutral-100 hover:border-indigo-400 hover:bg-indigo-50/30 cursor-pointer shadow-sm":"bg-neutral-50 border-neutral-100 opacity-60 cursor-not-allowed"}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-black text-neutral-800 font-serif",children:["/",y.sym1,"/ vs /",y.sym2,"/"]}),!d&&e.jsx(Ot,{size:10,className:"text-neutral-400"})]}),d&&e.jsxs("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-full border ${g}`,children:[o.correct,"/",o.total]})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 font-medium truncate",children:y.example})]},y.id)},w=Se.filter(y=>y.category==="VOWELS"),u=Se.filter(y=>y.category==="DIPHTHONGS"),R=Se.filter(y=>y.category==="CONSONANTS"),T=Math.ceil(R.length/2),h=R.slice(0,T),a=R.slice(T);return e.jsxs("div",{className:"flex flex-col h-full relative p-6 bg-white animate-in fade-in",children:[e.jsxs("header",{className:"flex flex-col gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Back"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:"Phonetic Accuracy"}),e.jsx("p",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-widest",children:"Select a pair to practice"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 self-center",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>m("MASTER"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${Z==="MASTER"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(ie,{size:10,fill:Z==="MASTER"?"currentColor":"none"})," Master It"]}),e.jsxs("button",{onClick:()=>m("ALL"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${Z==="ALL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(We,{size:10})," Review All"]})]}),e.jsx("p",{className:"text-[9px] text-neutral-400 font-bold",children:Z==="MASTER"?"Focus on unmastered words":"Practice with full library"})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-indigo-400 tracking-widest px-1 border-b border-neutral-100",children:"Vowels"}),e.jsx("div",{className:"flex flex-col gap-2",children:w.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:h.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100 md:text-transparent select-none",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:a.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-amber-400 tracking-widest px-1 border-b border-neutral-100",children:"Diphthongs"}),e.jsx("div",{className:"flex flex-col gap-2",children:u.map(b)})]})]})})]})}const P=$[0];return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 shrink-0",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Pairs"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:U}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),X&&e.jsx("div",{className:"text-center mb-6 animate-in slide-in-from-top-2",children:e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold border border-indigo-100",children:[X.label," ",e.jsx("span",{className:"opacity-50 mx-1",children:"‚Ä¢"})," ",e.jsx("span",{className:"italic font-normal",children:X.example})]})}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:P?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:P.word}),e.jsxs("button",{onClick:()=>ge(P.word,!1,"en"),className:"mx-auto flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-50 text-indigo-600 border border-indigo-100 hover:bg-indigo-100 transition-colors text-xs font-black uppercase tracking-wider",title:"Speak this word",children:[e.jsx(Ae,{size:14}),"Speak"]}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:P.maskedIpa.split("___").map((b,w,u)=>e.jsxs(Ue.Fragment,{children:[b,w<u.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},w))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Which sound fits?"})]}):e.jsxs("div",{className:"text-neutral-300 font-black text-xl flex flex-col items-center gap-2",children:[e.jsx(ne,{size:40,className:"text-green-500"}),e.jsx("span",{children:"Session Complete"})]})}),e.jsx("div",{className:"h-40 grid grid-cols-2 gap-6 mt-4 shrink-0 max-w-lg mx-auto w-full",children:[X.sym1,X.sym2].map((b,w)=>{const u=V&&V.symbol===b,R=u&&V.correct,T=u&&!V.correct;let h="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4 shadow-sm",a="text-neutral-400 group-hover:text-indigo-400";return R?(h+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600 ring-4 ring-emerald-100",a="text-emerald-500"):T?(h+=" bg-rose-50 border-solid border-rose-400 text-rose-600 ring-4 ring-rose-100",a="text-rose-500"):h+=" bg-white border-neutral-200 hover:border-indigo-400 hover:shadow-lg hover:-translate-y-1 active:scale-95",e.jsxs("button",{onClick:()=>O(b),disabled:!!V||!P,className:h,children:[e.jsxs("span",{className:"text-6xl font-serif font-medium mb-1",children:["/",b,"/"]}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${a}`,children:"Tap to Select"})]},w)})})]})]})},xs=({words:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState("MEDIUM"),[m,X]=t.useState(10),[C,$]=t.useState([]),[Q,U]=t.useState([]),[Y,V]=t.useState([]),[z,q]=t.useState(new Set),[l,c]=t.useState(null),[M,O]=t.useState(0),[L,P]=t.useState(0),b=r=>{const i=r.match(/.*?[.!?](?:\s|$)/);return i?i[0].trim():r.trim()},w=(r,i)=>{const g=r.split(/\s+/).filter(Boolean);if(i==="HARD")return g;const D=[];let k=0;const n=i==="EASY"?3:2;for(;k<g.length;){const H=Math.floor(Math.random()*n)+1,N=g.slice(k,k+H).join(" ");D.push(N),k+=H}return D},u=()=>{const r=s.filter(D=>D.example&&D.example.trim().split(/\s+/).filter(Boolean).length>=5);if(r.length<5){alert("Not enough words with suitable example sentences (need at least 5).");return}const g=[...r].sort(()=>Math.random()-.5).slice(0,m).map(D=>{const k=b(D.example),H=[...w(k,E)].sort(()=>Math.random()-.5);return{id:D.id,word:D.word,originalSentence:k,shuffledChunks:H}});$(g),G("PLAYING"),O(0),R()},R=()=>{U([]),V([]),q(new Set),P(0),c(null)},T=C[0],h=(r,i)=>{if(l!==null)return;const g=[...Q];g.splice(L,0,r),U(g),V(D=>{const k=[...D];return k.splice(L,0,i),k}),q(D=>new Set(D).add(i)),P(D=>D+1)},a=r=>{l===null&&(U(i=>i.filter((g,D)=>D!==r)),V(i=>{const g=[...i],D=g[r];return g.splice(r,1),q(k=>{const n=new Set(k);return n.delete(D),n}),g}),L>r&&P(i=>i-1))},y=()=>{const r=Q.join(" ").toLowerCase().trim(),i=T.originalSentence.toLowerCase().trim();r===i?(c(!0),O(g=>g+(E==="HARD"?25:E==="MEDIUM"?15:10)),setTimeout(()=>{const g=C.slice(1);$(g),g.length===0?f(M+(E==="HARD"?25:15)):R()},1e3)):(c(!1),O(g=>Math.max(0,g-5)),setTimeout(()=>c(null),1500))},o=()=>{const r=C.slice(1);$(r),r.length===0?f(M):R()},d=({index:r})=>{const i=r===L;return e.jsx("div",{onClick:()=>P(r),className:`h-8 w-2 rounded-full cursor-pointer transition-all duration-200 mx-0.5 flex items-center justify-center ${i?"bg-indigo-500 scale-110 shadow-sm":"bg-transparent hover:bg-neutral-200"}`,children:e.jsx("div",{className:`w-1 h-4 rounded-full ${i?"bg-white/50":"bg-transparent"}`})})};if(x==="SETUP"){const r=({id:i,label:g,icon:D,desc:k})=>e.jsxs("button",{onClick:()=>Z(i),className:`p-3 rounded-2xl border-2 transition-all text-left flex flex-col gap-1 ${E===i?"border-emerald-500 bg-emerald-50 shadow-sm":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${E===i?"bg-emerald-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(D,{size:14})}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${E===i?"text-emerald-700":"text-neutral-500"}`,children:g})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:k})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in max-w-5xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(Nt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Sentence Scramble"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm",children:"Reconstruct examples to master syntax and flow."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsx("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm flex flex-col justify-center space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-emerald-600",children:m})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:m,onChange:i=>X(parseInt(i.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-300 uppercase tracking-tighter px-1",children:[e.jsx("span",{children:"5 Items"}),e.jsx("span",{children:"15 Items"}),e.jsx("span",{children:"25 Items"})]})]})}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(r,{id:"EASY",label:"Easy",icon:We,desc:"Chunks of 1-3 words. Great for collocations."}),e.jsx(r,{id:"MEDIUM",label:"Medium",icon:ie,desc:"Chunks of 1-2 words. More challenging."}),e.jsx(r,{id:"HARD",label:"Hard",icon:Ye,desc:"Individual words only. True mastery."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:u,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Scramble ‚Ä¢ ",E]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${(1-C.length/m)*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:M})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:T?e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300 decoration-2 underline-offset-4",children:T.word})]}),e.jsx("button",{onClick:()=>ge(T.originalSentence),className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl hover:bg-emerald-100 transition-all active:scale-90",title:"Hear full sentence",children:e.jsx(Ae,{size:24})})]}),e.jsx("p",{className:"text-neutral-400 text-xs font-bold uppercase tracking-widest",children:"Tap chunks to insert at cursor"})]}),e.jsx("div",{className:`w-full max-w-3xl bg-neutral-50 rounded-[2.5rem] border-2 border-dashed p-8 transition-all ${l===!0?"border-emerald-400 bg-emerald-50":l===!1?"border-rose-400 bg-rose-50 animate-shake":"border-neutral-200"}`,children:e.jsxs("div",{className:"flex flex-wrap gap-y-3 items-center justify-center min-h-[60px]",children:[Q.length===0&&e.jsx("span",{className:"absolute text-lg font-bold text-neutral-300 italic pointer-events-none",children:"Draft your sentence here..."}),e.jsx(d,{index:0}),Q.map((r,i)=>e.jsxs(Ue.Fragment,{children:[e.jsx("button",{onClick:()=>a(i),className:`px-4 py-2 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 animate-in zoom-in-95 flex items-center gap-1 group ${l===!0?"bg-emerald-600 text-white":l===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-red-200 hover:text-red-500"}`,children:r}),e.jsx(d,{index:i+1})]},`${r}-${i}`))]})}),e.jsx("div",{className:"w-full max-w-3xl bg-neutral-100 rounded-[2.5rem] p-8 flex flex-wrap gap-3 justify-center",children:T.shuffledChunks.map((r,i)=>e.jsx("button",{onClick:()=>h(r,i),disabled:z.has(i),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${z.has(i)?"bg-neutral-200 text-neutral-400 cursor-not-allowed opacity-30":"bg-white text-neutral-700 border-2 border-white hover:border-emerald-300 hover:text-neutral-900"}`,children:r},i))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:o,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsxs("button",{onClick:y,disabled:Q.length===0||l!==null,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(we,{size:18})," Check"]})]}),l===!1&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 p-4 bg-emerald-50 rounded-2xl border border-emerald-100 text-center max-w-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Original Sentence"}),e.jsxs("p",{className:"text-sm font-bold text-emerald-900 italic",children:['`"`',T.originalSentence,'`"`']})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Preparing..."})})]})},us=["in","on","at","to","for","with","of","from","by","about","into","through","over","under","between","among","against","during","without","before","after","toward","upon","within","along"].sort(),ms=({words:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState(10),[m,X]=t.useState([]),[C,$]=t.useState(0),[Q,U]=t.useState(""),[Y,V]=t.useState(null),[z,q]=t.useState(0),[l,c]=t.useState([]),[M,O]=t.useState(0),[L,P]=t.useState(!1),b=t.useRef(null),w=t.useRef(null),u=()=>{const o=s.filter(i=>i.prepositions&&i.prepositions.some(g=>!g.isIgnored)&&i.example);if(o.length<3){alert("Not enough vocabulary with prepositions and examples found in your library.");return}const d=[...o].sort(()=>Math.random()-.5),r=[];for(const i of d){if(r.length>=E)break;const D=[...i.prepositions.filter(k=>!k.isIgnored)].sort(()=>Math.random()-.5);for(const k of D){const n=i.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),H=new RegExp(`\\b${n}\\s+${k.prep}\\b`,"i");if(H.test(i.example)){const N=i.example.split(".")[0]+".";if(H.test(N)){const W=N.replace(H,`${i.word} ___`);r.push({id:`${i.id}-${k.prep}`,word:i.word,example:W,answer:k.prep.toLowerCase(),meaning:i.meaningVi});break}}}}if(r.length<1){alert("Could not generate questions from existing data.");return}X(r),G("PLAYING"),$(0),q(0),U(""),V(null)},R=m[C];t.useEffect(()=>{x==="PLAYING"&&b.current&&b.current.focus()},[C,x]);const T=o=>{if(!R||Y===!0)return;const r=(o!==void 0?o:Q).trim().toLowerCase()===R.answer;V(r),P(!1),r?(q(i=>i+15),setTimeout(()=>{C<m.length-1?($(i=>i+1),U(""),V(null)):f(z+15)},800)):(q(i=>Math.max(0,i-5)),setTimeout(()=>V(null),800))},h=o=>{if(U(o),o.trim()){const d=us.filter(r=>r.startsWith(o.toLowerCase())&&r!==o.toLowerCase());c(d),O(0),P(d.length>0)}else P(!1)},a=o=>{if(!L){o.key==="Enter"&&T();return}switch(o.key){case"ArrowDown":o.preventDefault(),O(d=>(d+1)%l.length);break;case"ArrowUp":o.preventDefault(),O(d=>(d-1+l.length)%l.length);break;case"Enter":case"Tab":{o.preventDefault();const d=l[M];U(d),P(!1),T(d);break}case"Escape":P(!1);break}};if(x==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 text-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(ie,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Preposition Power"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Master dependent prepositions in IELTS contexts with smart suggestions."})]}),e.jsx("div",{className:"w-full max-w-sm bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-violet-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:E,onChange:o=>Z(parseInt(o.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-violet-500"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:u,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start Practice"]})]})]});const y=C/m.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-8 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-10 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Exit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Question ",C+1," / ",m.length]}),e.jsx("div",{className:"h-1.5 w-40 bg-neutral-100 rounded-full mt-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-500",style:{width:`${y}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest min-w-[80px] text-center",children:z})]}),e.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center space-y-12 max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:`w-full bg-neutral-50 border-2 rounded-[3rem] p-10 md:p-16 text-center space-y-8 transition-all duration-300 ${Y===!0?"border-emerald-400 bg-emerald-50/30":Y===!1?"border-rose-400 bg-rose-50/30 animate-shake":"border-neutral-100 shadow-sm"}`,children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("span",{className:"px-3 py-1 bg-violet-100 text-violet-700 rounded-lg text-[10px] font-black uppercase tracking-widest border border-violet-200",children:"Fill Blank"})})}),e.jsx("div",{className:"text-xl md:text-2xl font-medium text-neutral-700 leading-relaxed min-h-[4rem]",children:R.example.split("___").map((o,d,r)=>e.jsxs(Ue.Fragment,{children:[e.jsx("span",{children:o}),d<r.length-1&&e.jsxs("div",{className:"inline-block mx-2 relative",children:[e.jsx("input",{ref:b,type:"text",value:Q,onChange:i=>h(i.target.value),onKeyDown:a,disabled:Y===!0,placeholder:"...",className:`
                                                w-[5ch] min-w-[100px] text-center bg-transparent border-b-4 outline-none font-black transition-all
                                                ${Y===!0?"border-emerald-500 text-emerald-600":Y===!1?"border-rose-500 text-rose-600":"border-neutral-300 focus:border-violet-600 text-neutral-900"}
                                            `,autoComplete:"off"}),Y===!0&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 animate-bounce text-emerald-500",children:e.jsx(we,{size:20,strokeWidth:4})}),L&&e.jsx("div",{ref:w,className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 w-32 bg-white rounded-2xl shadow-2xl border border-neutral-100 z-50 overflow-hidden animate-in fade-in zoom-in-95",children:l.map((i,g)=>e.jsx("button",{onClick:()=>{U(i),P(!1),T(i)},className:`w-full px-4 py-2.5 text-sm font-bold text-left transition-colors ${M===g?"bg-violet-500 text-white":"text-neutral-600 hover:bg-neutral-50"}`,children:i},i))})]})]},d))})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsxs("button",{onClick:()=>{C<m.length-1?($(o=>o+1),U(""),V(null)):f(z)},className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all flex items-center gap-2",children:["Skip ",e.jsx(Le,{size:18})]}),e.jsx("button",{onClick:()=>T(),disabled:Q.trim().length===0||Y===!0,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-30 flex items-center gap-2",children:"Check Answer"})]})]}),e.jsxs("footer",{className:"mt-auto pt-8 flex items-center justify-between text-[10px] font-black uppercase text-neutral-300 tracking-widest border-t border-neutral-50",children:[e.jsx("span",{children:"IELTS VOCAB PRO ‚Ä¢ PREPOSITION POWER"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{size:12}),e.jsx("span",{children:"Type to see autocomplete suggestions"})]}),e.jsxs("span",{children:["LEVEL ",C+1]})]})]})},hs=({words:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState("MIX"),[m,X]=t.useState("MEDIUM"),[C,$]=t.useState(8),[Q,U]=t.useState([]),[Y,V]=t.useState([]),[z,q]=t.useState(null),[l,c]=t.useState(null),[M,O]=t.useState(0),L=()=>{const a=[];if(s.forEach(g=>{(E==="PARAPHRASE"||E==="MIX")&&(g.paraphrases||[]).filter(D=>!D.isIgnored&&D.context&&D.context.trim()).forEach(D=>{a.push({context:D.context,fullText:D.word,headword:g.word,pairId:`${g.id}-p-${D.word}`})}),(E==="COLLOCATION"||E==="MIX")&&(g.collocationsArray||[]).filter(D=>!D.isIgnored&&D.d&&D.d.trim()).forEach(D=>{a.push({context:D.d,fullText:D.text,headword:g.word,pairId:`${g.id}-c-${D.text}`})}),(E==="IDIOM"||E==="MIX")&&(g.idiomsList||[]).filter(D=>!D.isIgnored&&D.d&&D.d.trim()).forEach(D=>{a.push({context:D.d,fullText:D.text,headword:g.word,pairId:`${g.id}-i-${D.text}`})})}),a.length<5){alert("Not enough items found. Add more variations or idioms to your library.");return}const y=Math.min(a.length,C),o=[...a].sort(()=>.5-Math.random()).slice(0,y),d=o.map(g=>{const D=g.fullText.split(/\s+/);if(D.length>1){const k=D.findIndex(H=>H.toLowerCase().includes(g.headword.toLowerCase())),n=k===-1?0:k===0?D.length-1:0;return D[n].replace(/[^a-zA-Z]/g,"")}return g.fullText}),r=[],i=[];o.forEach((g,D)=>{let k,n=g.fullText,H=!1;const N=g.fullText.split(/\s+/);if(N.length>1){const F=N.findIndex(p=>p.toLowerCase().includes(g.headword.toLowerCase())),B=F===-1?0:F===0?N.length-1:0;n=N[B].replace(/[^a-zA-Z]/g,""),k=N.map((p,I)=>I===B?"___":p).join(" ")}else n=g.fullText,k=g.fullText,H=!0;const W=d.filter((F,B)=>B!==D&&F.toLowerCase()!==n.toLowerCase()),S=[n,...Array.from(new Set(W))].sort(()=>.5-Math.random()).slice(0,5);S.includes(n)||(S[Math.floor(Math.random()*S.length)]=n);const v={text:k,fullText:g.fullText,headword:g.headword,context:g.context,partnerWord:n,choices:S,pairId:g.pairId};r.push({...v,id:`ctx-${g.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1}),i.push({...v,id:`itm-${g.pairId}`,isLinked:!1,isFilled:H,isSelected:!1,isDone:!1,error:!1})}),U(r),V(i.sort(()=>.5-Math.random())),O(0),q(null),c(null),G("PLAYING")},P=(a,y,o)=>{const d=y.find(i=>i.pairId===a),r=o.find(i=>i.pairId===a);d!=null&&d.isLinked&&(r!=null&&r.isFilled)&&(d.isDone=!0,r.isDone=!0,O(g=>g+(m==="HARD"?25:m==="MEDIUM"?15:10)),y.every(g=>g.isDone)&&setTimeout(()=>f(M+25),1e3))},b=(a,y)=>{const o=Q.find(r=>r.id===a),d=Y.find(r=>r.id===y);if(!(!o||!d))if(o.pairId===d.pairId){const r=Q.map(g=>g.id===a?{...g,isLinked:!0,isSelected:!1}:g),i=Y.map(g=>g.id===y?{...g,isLinked:!0,isSelected:!1}:g);U(r),V(i),q(null),c(null),P(o.pairId,r,i)}else U(r=>r.map(i=>i.id===a?{...i,error:!0}:i)),V(r=>r.map(i=>i.id===y?{...i,error:!0}:i)),O(r=>Math.max(0,r-5)),setTimeout(()=>{U(r=>r.map(i=>({...i,error:!1,isSelected:!1}))),V(r=>r.map(i=>({...i,error:!1,isSelected:!1}))),q(null),c(null)},600)},w=a=>{const y=Q.find(o=>o.id===a);!y||y.isDone||(l?b(a,l):(q(a===z?null:a),U(o=>o.map(d=>({...d,isSelected:d.id===a?!d.isSelected:!1})))))},u=a=>{const y=Y.find(o=>o.id===a);!y||y.isDone||(z?b(z,a):(c(a===l?null:a),V(o=>o.map(d=>({...d,isSelected:d.id===a?!d.isSelected:!1})))))},R=(a,y)=>{const o=Y.find(r=>r.pairId===a);if(!o||o.isDone)return;if(y.trim().toLowerCase()===o.partnerWord.toLowerCase()){const r=Y.map(i=>i.pairId===a?{...i,isFilled:!0,text:i.fullText}:i);V(r),P(a,Q,r)}else y.trim().length>0&&!o.choices.includes(y)&&(V(r=>r.map(i=>i.pairId===a?{...i,error:!0}:i)),setTimeout(()=>V(r=>r.map(i=>({...i,error:!1}))),600))},T=a=>a.isDone?"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default shadow-none":a.error?"bg-red-50 border-red-500 text-red-700 animate-shake":a.isSelected?"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-[1.02]":a.isLinked?"bg-indigo-50 border-indigo-300 text-indigo-900 shadow-sm":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-400 hover:bg-neutral-50 cursor-pointer shadow-sm";if(x==="SETUP"){const a=({type:o,label:d,icon:r})=>e.jsxs("button",{onClick:()=>Z(o),className:`flex flex-col items-center justify-center p-2 rounded-2xl border-2 transition-all min-w-[60px] ${E===o?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-300"}`,children:[e.jsx(r,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:d})]}),y=({level:o,label:d,desc:r})=>e.jsxs("button",{onClick:()=>X(o),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${m===o?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${m===o?"text-indigo-700":"text-neutral-400"}`,children:d}),m===o&&e.jsx(we,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:r})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(ie,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Context Match"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-sm mx-auto",children:"Link meanings and fill the blanks."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[e.jsx(a,{type:"PARAPHRASE",label:"Paraphrase",icon:ie}),e.jsx(a,{type:"COLLOCATION",label:"Collocation",icon:dt}),e.jsx(a,{type:"IDIOM",label:"Idiom",icon:St}),e.jsx(a,{type:"MIX",label:"Mix All",icon:We})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Items"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:C})]}),e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:C,onChange:o=>$(parseInt(o.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(y,{level:"EASY",label:"Easy",desc:"Match definitions to phrases. No typing required."}),e.jsx(y,{level:"MEDIUM",label:"Medium",desc:"Match meanings and select word from dropdown."}),e.jsx(y,{level:"HARD",label:"Hard",desc:"Match meanings and type word from memory."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:L,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}const h=Q.filter(a=>a.isDone).length/Q.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Context Match ‚Ä¢ ",m]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:`${h}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:M})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 no-scrollbar pb-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(nt,{size:12})," Definition & Headword"]}),Q.map(a=>e.jsxs("button",{onClick:()=>w(a.id),className:`relative w-full p-5 rounded-[2rem] border-2 text-left transition-all duration-200 flex flex-col gap-2 ${T(a)}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-black tracking-tight ${a.isSelected?"text-white":"text-indigo-600"}`,children:a.headword}),e.jsxs("div",{className:"flex gap-2",children:[a.isLinked&&e.jsx(st,{size:16,className:a.isSelected?"text-white":"text-indigo-400"}),a.isDone&&e.jsx(ne,{size:18,className:"text-emerald-500"})]})]}),e.jsx("p",{className:`font-medium text-sm leading-relaxed ${a.isSelected?"text-indigo-100":"text-neutral-600"}`,children:a.context})]},a.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:12})," Target Phrase"]}),Y.map(a=>e.jsxs("div",{onClick:()=>u(a.id),className:`relative w-full p-6 rounded-[2rem] border-2 text-left transition-all duration-200 ${T(a)}`,children:[e.jsx("div",{className:`text-lg font-bold flex flex-wrap items-center gap-x-2 leading-relaxed ${a.isSelected?"text-white":"text-neutral-900"}`,children:a.text.split(" ").map((y,o)=>y!=="___"?e.jsx("span",{children:y},o):m==="MEDIUM"?e.jsxs("div",{className:"inline-flex items-center gap-1 bg-white border-2 border-indigo-200 rounded-xl px-2 py-1 shadow-sm",onClick:d=>d.stopPropagation(),children:[e.jsxs("select",{disabled:a.isDone,className:`appearance-none bg-transparent text-sm font-black outline-none pr-6 relative ${a.isFilled?"text-emerald-600":"text-indigo-700"}`,onChange:d=>R(a.pairId,d.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),a.choices.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx(Be,{size:14,className:"text-indigo-400 pointer-events-none -ml-5"})]},o):m==="HARD"?e.jsx("input",{type:"text",disabled:a.isDone,onClick:d=>d.stopPropagation(),className:`w-32 px-3 py-1 bg-white border-2 rounded-xl text-sm font-black outline-none transition-all ${a.isFilled?"border-emerald-500 text-emerald-600":"border-indigo-200 text-indigo-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"}`,placeholder:"...",onKeyDown:d=>{d.key==="Enter"&&R(a.pairId,d.currentTarget.value)}},o):e.jsx("span",{className:"text-neutral-300 font-black",children:"_____"},o))}),e.jsxs("div",{className:"absolute top-4 right-6 flex gap-2",children:[a.isLinked&&e.jsx(st,{size:16,className:a.isSelected?"text-white":"text-indigo-400"}),a.isDone&&e.jsx(ne,{size:18,className:"text-emerald-500"})]})]},a.id))]})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsxs("button",{onClick:()=>G("SETUP"),className:"flex items-center gap-2 text-xs font-black uppercase tracking-widest text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(it,{size:14})," Restart"]})})]})]})},Ce=10,at=50;function Ne(s){const f=[...s];for(let A=f.length-1;A>0;A--){const x=Math.floor(Math.random()*(A+1));[f[A],f[x]]=[f[x],f[A]]}return f}const fs=({words:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState("MATRIX"),[m,X]=t.useState(12),[C,$]=t.useState({library:!0,collocations:!0,idioms:!0}),[Q,U]=t.useState([]),[Y,V]=t.useState([]),[z,q]=t.useState([]),[l,c]=t.useState([]),[M,O]=t.useState(0),[L,P]=t.useState(0),[b,w]=t.useState(new Set),[u,R]=t.useState(null),[T,h]=t.useState(null),a=t.useMemo(()=>l.map((n,H)=>({...n,originalIndex:H})).filter(n=>!b.has(n.id)),[l,b]);t.useEffect(()=>{if(x!=="PLAYING")return;const n=[];if(s.forEach(B=>{C.library&&B.meaningVi&&B.meaningVi.trim()&&n.push({text:B.word,d:B.meaningVi,cueId:`cue-${B.id}-word`}),C.collocations&&(B.collocationsArray||[]).filter(I=>!I.isIgnored&&I.d&&I.d.trim()).forEach((I,j)=>{n.push({text:I.text,d:I.d,cueId:`cue-${B.id}-col-${j}`})}),C.idioms&&(B.idiomsList||[]).filter(I=>!I.isIgnored&&I.d&&I.d.trim()).forEach((I,j)=>{n.push({text:I.text,d:I.d,cueId:`cue-${B.id}-idm-${j}`})})}),n.length<Ce){alert(`Not enough items found (found ${n.length}, need min ${Ce}).`),G("SETUP");return}const N=Ne(n).slice(0,m),W=[],S=[],v=[],F=[];N.forEach(B=>{const p=B.cueId;W.push({id:p,text:B.d}),S.push({id:`card-${p}`,text:B.text,cueId:p,pairId:p,state:"default",type:"word"}),v.push({id:`l-${p}`,text:B.text,cueId:p,pairId:p,state:"default",type:"word"}),F.push({id:`r-${p}`,text:B.d,cueId:p,pairId:p,state:"default",type:"meaning"})}),U(Ne(S)),V(Ne(v)),q(Ne(F)),c(Ne(W)),O(0),P(0),w(new Set),R(null),h(null)},[x,m,s,C]),t.useEffect(()=>{x==="PLAYING"&&m>0&&b.size===m&&setTimeout(()=>f(L),800)},[x,b,m,L,f]);const y=n=>{const H=l[M];!H||b.has(H.id)||n.state!=="default"||(n.cueId===H.id?(P(N=>N+10),U(N=>N.map(W=>W.id===n.id?{...W,state:"correct"}:W)),V(N=>N.map(W=>W.pairId===n.pairId?{...W,state:"correct"}:W)),q(N=>N.map(W=>W.pairId===n.pairId?{...W,state:"correct"}:W)),setTimeout(()=>{const N=new Set(b).add(H.id);w(N);let W=-1;for(let S=M+1;S<l.length;S++)if(!N.has(l[S].id)){W=S;break}if(W===-1){for(let S=0;S<M;S++)if(!N.has(l[S].id)){W=S;break}}W!==-1&&O(W)},400)):(P(N=>Math.max(0,N-5)),U(N=>N.map(W=>W.id===n.id?{...W,state:"incorrect"}:W)),setTimeout(()=>{U(N=>N.map(W=>W.id===n.id?{...W,state:"default"}:W))},600)))},o=n=>{n.state==="correct"||n.state==="incorrect"||(n.type==="word"?T?d(n.id,T):R(n.id===u?null:n.id):u?d(u,n.id):h(n.id===T?null:n.id))},d=(n,H)=>{const N=Y.find(S=>S.id===n),W=z.find(S=>S.id===H);if(N&&W&&N.pairId===W.pairId){P(v=>v+10);const S=new Set(b).add(N.pairId);w(S),V(v=>v.map(F=>F.id===n?{...F,state:"correct"}:F)),q(v=>v.map(F=>F.id===H?{...F,state:"correct"}:F)),U(v=>v.map(F=>F.pairId===N.pairId?{...F,state:"correct"}:F)),R(null),h(null)}else P(S=>Math.max(0,S-5)),V(S=>S.map(v=>v.id===n?{...v,state:"incorrect"}:v)),q(S=>S.map(v=>v.id===H?{...v,state:"incorrect"}:v)),setTimeout(()=>{V(S=>S.map(v=>({...v,state:v.state==="incorrect"?"default":v.state}))),q(S=>S.map(v=>({...v,state:v.state==="incorrect"?"default":v.state}))),R(null),h(null)},600)},r=()=>{const n=a.findIndex(H=>H.originalIndex===M);if(n>0){const H=a[n-1];O(H.originalIndex)}},i=()=>{const n=a.findIndex(H=>H.originalIndex===M);if(n<a.length-1){const H=a[n+1];O(H.originalIndex)}},g=l[M],D=a.findIndex(n=>n.originalIndex===M);if(x==="SETUP"){const n=({label:N,checked:W,onChange:S})=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-2xl bg-neutral-50 border-2 border-transparent hover:border-fuchsia-100 cursor-pointer transition-all",onClick:S,children:[W?e.jsx(Vt,{size:18,className:"text-fuchsia-600"}):e.jsx(Et,{size:18,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-xs text-neutral-800",children:N})]}),H=C.library||C.collocations||C.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-fuchsia-100 text-fuchsia-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(it,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Scatter"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-sm mx-auto",children:"Match hidden words to their definitions."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-4 flex flex-col justify-center",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:["Items: ",e.jsx("span",{className:"text-xl font-black text-fuchsia-600",children:m})]}),e.jsx("input",{id:"sessionSize",type:"range",min:Ce,max:at,value:m,onChange:N=>X(parseInt(N.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-full appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-300 uppercase px-1",children:[e.jsx("span",{children:Ce}),e.jsx("span",{children:at})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:"Content Sources"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(n,{label:"Library Definitions",checked:C.library,onChange:()=>$(N=>({...N,library:!N.library}))}),e.jsx(n,{label:"Collocations",checked:C.collocations,onChange:()=>$(N=>({...N,collocations:!N.collocations}))}),e.jsx(n,{label:"Idioms",checked:C.idioms,onChange:()=>$(N=>({...N,idioms:!N.idioms}))})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:()=>G("PLAYING"),disabled:!H,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}const k=b.size/m*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>f(L),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Finish"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>Z("MATRIX"),className:`p-2 rounded-lg transition-all ${E==="MATRIX"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Matrix View",children:e.jsx(Ut,{size:18})}),e.jsx("button",{onClick:()=>Z("MATCH"),className:`p-2 rounded-lg transition-all ${E==="MATCH"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Match View",children:e.jsx(Bt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:"Progress"}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-500 transition-all duration-300",style:{width:`${k}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:L})]}),E==="MATRIX"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shrink-0 mb-6 py-6 px-8 bg-neutral-50 border border-neutral-200 rounded-[2rem] shadow-sm relative overflow-hidden flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:r,disabled:D<=0,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(ct,{size:24})}),e.jsx("div",{className:"text-center flex-1 px-10",children:g?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-fuchsia-500 tracking-widest flex items-center justify-center gap-1.5 mb-2",children:[e.jsx(Ct,{size:12})," Find the term for:"]}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-neutral-800 leading-tight",children:g.text})]}):e.jsx("p",{className:"text-center font-black text-emerald-600 text-xl animate-bounce",children:"CLEARED!"})}),e.jsx("button",{onClick:i,disabled:D>=a.length-1,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(Le,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-6",children:e.jsx("div",{className:`grid gap-3 ${m<=12?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":m<=24?"grid-cols-3 md:grid-cols-4 lg:grid-cols-6":"grid-cols-4 md:grid-cols-6 lg:grid-cols-8"}`,children:Q.map(n=>{const H=n.state==="correct",N=n.state==="incorrect";return e.jsxs("button",{onClick:()=>y(n),disabled:H,className:`
                                            relative h-16 px-2 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center text-center shadow-sm font-bold text-xs leading-tight
                                            ${H?"bg-emerald-500 border-emerald-500 text-white scale-90 opacity-0 pointer-events-none":N?"bg-rose-50 border-rose-500 text-rose-600 animate-shake":"bg-white border-neutral-100 text-neutral-700 hover:border-fuchsia-300 hover:text-neutral-900 hover:-translate-y-0.5 active:scale-95"}
                                        `,children:[e.jsx("span",{className:"line-clamp-2",children:n.text}),H&&e.jsx(we,{size:20,className:"absolute inset-auto animate-ping"})]},n.id)})})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(nt,{size:12})," English"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Y.map(n=>{const H=u===n.id,N=n.state==="correct",W=n.state==="incorrect";if(N)return e.jsx("div",{className:"h-16 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(ne,{size:32})},n.id);let S="bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-300 hover:-translate-y-0.5";return H&&(S="bg-fuchsia-600 border-fuchsia-600 text-white shadow-lg ring-4 ring-fuchsia-100 scale-105"),W&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>o(n),className:`h-16 px-4 rounded-xl border-b-4 font-bold text-sm transition-all duration-200 flex items-center justify-center text-center leading-tight shadow-sm ${S}`,children:n.text},n.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(It,{size:12})," Meaning"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:z.map(n=>{const H=T===n.id,N=n.state==="correct",W=n.state==="incorrect";if(N)return e.jsx("div",{className:"h-20 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(ne,{size:32})},n.id);let S="bg-white border-neutral-200 text-neutral-700 hover:border-indigo-300 hover:-translate-y-0.5";return H&&(S="bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-105"),W&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>o(n),className:`min-h-20 px-4 py-3 rounded-xl border-b-4 font-medium text-xs transition-all duration-200 flex items-center justify-center text-center leading-relaxed shadow-sm ${S}`,children:n.text},n.id)})})]})]})}),e.jsxs("footer",{className:"shrink-0 mt-2 flex items-center justify-between text-[10px] font-black uppercase text-neutral-400 tracking-widest px-4 border-t border-neutral-100 pt-4",children:[e.jsxs("span",{children:["Total Items: ",m]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Matched"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-neutral-200"})," Hidden"]})]}),e.jsxs("span",{children:["Completed: ",b.size]})]})]})},je=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),ps=s=>{const f=s.match(/.*?[.!?](?:\s|$)/);return f?f[0].trim():s.trim()},Pe=s=>s.replace(/(\d{1,2}:\d{2}(?::\d{2})?)|(\b\d{4}\b)|(\d+)/g,(f,A,x,G)=>A?A.replace(/:/g," "):x?`${x.slice(0,2)} ${x.slice(2)}`:G?G.split("").join(" "):f),bs=({words:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState(10),[m,X]=t.useState("EASY"),[C,$]=t.useState("LIBRARY"),[Q,U]=t.useState(!1),[Y,V]=t.useState([]),[z,q]=t.useState(()=>{const j=Xe("dictation_selected_voices",["System"]);return new Set(j)}),[l,c]=t.useState(()=>Xe("dictation_hover_preview",!0)),[M,O]=t.useState([]),[L,P]=t.useState(0),[b,w]=t.useState(0),[u,R]=t.useState({}),[T,h]=t.useState(""),[a,y]=t.useState(!1),[o,d]=t.useState(!1),r=t.useRef(null),{showToast:i}=pe();t.useEffect(()=>{Ze("dictation_selected_voices",Array.from(z))},[z]),t.useEffect(()=>{Ze("dictation_hover_preview",l)},[l]),t.useEffect(()=>((async()=>{const _=Je(),K=et(_);try{const J=await At(K);if(J&&J.voices){const te=J.voices.filter(ee=>ee.language==="en"&&(ee.name.includes("Premium")||ee.name.includes("Enhanced")));V(te)}}catch(J){console.warn("Could not load server voices",J)}})(),()=>{Te()}),[]),t.useEffect(()=>{C==="SERVER"&&X("HARD")},[C]);const g=async j=>{const _=Je(),K=et(_),J="Dictation";try{const te=await fetch(`${K}/api/reading/files/${J}`);if(!te.ok)throw new Error("Could not access 'Dictation' folder on server.");const se=((await te.json()).items||[]).filter(ae=>ae.type==="file"&&!ae.name.startsWith("."));if(se.length===0)throw new Error("No files found in 'Dictation' folder.");const ue=se.sort(()=>Math.random()-.5).slice(0,5),re=[];if(await Promise.all(ue.map(async ae=>{try{const le=ae.name,he=await fetch(`${K}/api/reading/content/${J}/${encodeURIComponent(le)}`);if(he.ok){const qe=(await he.json()).essay||"";if(qe){const ft=qe.split(/\r?\n/).map(Me=>Me.trim()).filter(Me=>Me.length>0);re.push(...ft)}}}catch(le){console.warn(`Failed to read file ${ae.name}`,le)}})),re.length===0)throw new Error("No valid text lines found.");return re.sort(()=>Math.random()-.5).slice(0,j)}catch(te){return i(te.message||"Server Error","error"),[]}},D=()=>{const j=Array.from(z);if(j.length===0)return;const _=j[Math.floor(Math.random()*j.length)];return _==="System"?void 0:_},k=async()=>{let j;if(C==="SERVER"){if(U(!0),j=await g(E),U(!1),j.length===0)return}else{const K=s.filter(J=>J.example&&J.example.trim().split(/\s+/).length>=4);if(K.length===0){i("No suitable example sentences found in Library.","error");return}j=[...K].sort(()=>Math.random()-.5).slice(0,E).map(J=>ps(J.example))}const _=j.map((K,J)=>{const te=K.replace(/\s+/g," ").trim(),ee=te.split(" "),se=new Set;if(m==="EASY"){ee.forEach((le,he)=>{/\d/.test(le)&&se.add(he)});const re=Math.max(1,Math.floor(ee.length*.4));let ae=0;for(;se.size<re&&ae<100;){ae++;const le=Math.floor(Math.random()*ee.length);!se.has(le)&&/[a-zA-Z0-9]/.test(ee[le])&&se.add(le)}}const be=ee.map((re,ae)=>{const le=m==="EASY"&&se.has(ae);return{text:re,isMasked:le}}),ue=D();return{id:`dict-${J}-${Date.now()}`,originalSentence:te,tokenized:be,mode:m,voice:ue}});O(_),G("PLAYING"),P(0),w(0),R({}),h(""),y(!1),d(!1),setTimeout(()=>{const K=_[0];ge(Pe(K.originalSentence),!1,"en",K.voice)},600)},n=M[L];t.useEffect(()=>{x==="PLAYING"&&!a&&setTimeout(()=>{var j;return(j=r.current)==null?void 0:j.focus()},150)},[L,x,a]);const H=()=>{n&&ge(Pe(n.originalSentence),!1,"en",n.voice)},N=()=>{v()},W=()=>{Te(),A()},S=()=>{if(a)return;let j=!0;if(n.mode==="HARD"?j=je(T)===je(n.originalSentence):n.tokenized.forEach((_,K)=>{if(_.isMasked){const J=_.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");je(u[K]||"")!==je(J)&&(j=!1)}}),d(j),y(!0),j){const _=n.mode==="HARD"?25:15;w(K=>K+_)}},v=()=>{if(L<M.length-1){P(_=>_+1),R({}),h(""),y(!1),d(!1);const j=M[L+1];setTimeout(()=>{ge(Pe(j.originalSentence),!1,"en",j.voice)},500)}else f(b)},F=j=>{q(_=>{const K=new Set(_);return K.has(j)?K.size>1&&K.delete(j):K.add(j),K})},B=j=>{if(!l)return;Te(),ge("Voice preview.",!1,"en",j==="System"?void 0:j)},p=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-5 justify-center items-center leading-relaxed",children:n.tokenized.map((j,_)=>{if(!j.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:j.text},_);const K=u[_]||"",J=j.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),te=a&&je(K)===je(J);return e.jsxs("div",{className:"relative inline-flex flex-col items-center",children:[e.jsx("input",{ref:_===n.tokenized.findIndex(ee=>ee.isMasked)?r:null,type:"text",value:K,disabled:a,onChange:ee=>R(se=>({...se,[_]:ee.target.value})),onKeyDown:ee=>ee.key==="Enter"&&S(),className:`w-28 text-center px-2 py-1.5 rounded-lg border-b-2 font-bold text-sm outline-none transition-all ${a?te?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-indigo-600"}`,autoComplete:"off"}),a&&!te&&e.jsx("div",{className:"absolute -bottom-5 text-[10px] font-black text-green-600 uppercase whitespace-nowrap",children:J})]},_)})}),I=()=>e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsx("textarea",{ref:r,value:T,onChange:j=>h(j.target.value),disabled:a,onKeyDown:j=>j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),S()),placeholder:"Type the full sentence...",className:`w-full p-5 rounded-3xl border-2 text-lg font-medium resize-none outline-none transition-all h-32 ${a?o?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800":"bg-white border-neutral-200 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-100"}`}),a&&!o&&e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-2xl animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-base font-bold text-green-900 leading-relaxed",children:n.originalSentence})]})]});if(x==="SETUP"){const j=({id:_,label:K,icon:J,desc:te,disabled:ee})=>e.jsxs("button",{onClick:()=>!ee&&X(_),disabled:ee,className:`p-3 rounded-xl border-2 transition-all text-left flex flex-col gap-1 relative ${m===_?"border-cyan-500 bg-cyan-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"} ${ee?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded-lg ${m===_?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(J,{size:14})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${m===_?"text-cyan-700":"text-neutral-500"}`,children:K})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:te}),ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-[1px] font-black text-xs text-neutral-400 uppercase tracking-widest",children:"Locked"})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-6 animate-in fade-in max-w-4xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(Ht,{size:32})}),e.jsx("h2",{className:"text-2xl font-black text-neutral-900 tracking-tight",children:"Dictation Lab"}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium",children:"Bridge the gap between hearing and writing."})]}),e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>$("LIBRARY"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="LIBRARY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Rt,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Sentence"})]}),e.jsxs("button",{onClick:()=>$("SERVER"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="SERVER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Gt,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Phrase"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-sm font-black text-cyan-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:E,onChange:_=>Z(parseInt(_.target.value)),className:"w-full h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2 flex flex-col justify-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(j,{id:"EASY",label:"Easy",icon:ie,desc:"Type in missing words. Numbers are always masked.",disabled:C==="SERVER"}),e.jsx(j,{id:"HARD",label:"Hard",icon:Ye,desc:"Transcribe the full sentence from scratch."})]})]})]}),e.jsxs("div",{className:"w-full bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ae,{size:12})," Voice Pool"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 group-hover:text-cyan-600 transition-colors",children:"Hover to hear"}),e.jsx("div",{className:`w-8 h-4 rounded-full p-0.5 transition-colors ${l?"bg-cyan-500":"bg-neutral-200"}`,onClick:()=>c(!l),children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full shadow-sm transition-transform ${l?"translate-x-4":"translate-x-0"}`})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-1",children:[e.jsxs("button",{onClick:()=>F("System"),onMouseEnter:()=>B("System"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${z.has("System")?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[z.has("System")&&e.jsx(we,{size:10})," System Default"]}),Y.map(_=>e.jsxs("button",{onClick:()=>F(_.name),onMouseEnter:()=>B(_.name),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${z.has(_.name)?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[z.has(_.name)&&e.jsx(we,{size:10})," ",_.name.replace("Microsoft ","")]},_.name)),Y.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-400 italic",children:"Connect to server for HQ voices."})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:W,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50 transition-all text-xs",children:"Back"}),e.jsxs("button",{onClick:k,disabled:Q,className:"px-10 py-3 bg-cyan-600 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-cyan-700 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[Q?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(de,{size:16,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Level ",L+1," of ",M.length," ‚Ä¢ ",n.mode]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-300",style:{width:`${L/M.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:b})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12",children:[e.jsxs("button",{onClick:H,className:"w-28 h-28 bg-cyan-50 text-cyan-600 rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition-all group active:scale-95 relative",children:[e.jsx(de,{size:48,className:"ml-1.5 fill-cyan-600 group-hover:scale-110 transition-transform"}),n.voice&&e.jsx("div",{className:"absolute -bottom-6 text-[9px] font-bold text-neutral-300 bg-white px-2 py-0.5 rounded-full shadow-sm border border-neutral-100 whitespace-nowrap",children:n.voice})]}),e.jsx("div",{className:"w-full min-h-[160px] flex items-center justify-center px-4",children:n.mode==="EASY"?p():I()}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:a?e.jsxs("button",{onClick:v,className:`w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 ${o?"bg-emerald-600 text-white shadow-emerald-200":"bg-neutral-900 text-white"}`,children:[e.jsx("span",{children:L===M.length-1?"Finish":"Next Item"}),e.jsx(ve,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:N,className:"flex-1 py-4 bg-white border-2 border-neutral-200 text-neutral-400 font-black text-xs uppercase tracking-widest rounded-2xl hover:text-neutral-600 hover:border-neutral-300 transition-all",children:"Skip"}),e.jsx("button",{onClick:S,className:"flex-[2] py-4 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl shadow-neutral-900/10 active:scale-95",children:"Check Answer"})]})})]})]})},lt=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),gs=({userId:s,onComplete:f,onExit:A})=>{var B;const[x,G]=t.useState("SETUP"),[E,Z]=t.useState("MASTER"),[m,X]=t.useState("MEDIUM"),[C,$]=t.useState(10),[Q,U]=t.useState(0),[Y,V]=t.useState(0),[z,q]=t.useState([]),[l,c]=t.useState(0),[M,O]=t.useState(0),[L,P]=t.useState(""),[b,w]=t.useState(!1),[u,R]=t.useState(!1),[T,h]=t.useState(!1),[a,y]=t.useState(!1),o=t.useRef(new Mt),d=t.useRef(null),r=t.useRef(null),{showToast:i}=pe(),g=async()=>{const p=await _e();let I=0,j=0;p.forEach(_=>{_.answers.forEach(K=>{I++,K.lastResult==="correct"&&j++})}),U(I),V(j)};t.useEffect(()=>{g()},[s,x]),t.useEffect(()=>{T&&setTimeout(()=>{var p;(p=r.current)==null||p.scrollIntoView({behavior:"smooth",block:"end"})},100)},[T]);const D=async()=>{const p=await _e();let I=p;if(E==="MASTER"){const J=p.filter(te=>te.answers.some(ee=>ee.lastResult!=="correct"));J.length>0?I=J:i("All items mastered! Switching to review mode.","info")}if(I.length===0){i("No expressions found.","error");return}const j=[],_=[];p.forEach(J=>{J.answers.forEach(te=>{const ee=te.sentence.match(/\{(.*?)\}/);ee&&_.push(ee[1])})}),I.forEach(J=>{J.answers.forEach((te,ee)=>{if(E==="MASTER"&&te.lastResult==="correct")return;const se=te.sentence.match(/\{(.*?)\}/);if(se){const be=se[1],ue=te.sentence.replace(se[0],"_______");let re;if(m==="EASY"){const ae=_.filter(le=>le!==be).sort(()=>.5-Math.random()).slice(0,3);re=[be,...ae].sort(()=>.5-Math.random())}j.push({id:`${J.id}-${ee}`,nativeSpeakItemId:J.id,answerIndex:ee,answer:te,maskedSentence:ue,choices:re})}})});const K=j.sort(()=>.5-Math.random()).slice(0,C);q(K),c(0),O(0),P(""),h(!1),y(!1),R(!1),G("PLAYING")},k=()=>{w(!0),P(""),o.current.start((p,I)=>P(p+I),p=>P(p))},n=()=>{w(!1),o.current.stop()},H=async p=>{const I=z[l],_=(await _e()).find(K=>K.id===I.nativeSpeakItemId);if(_){const K=_.answers.map((ee,se)=>se===I.answerIndex?{...ee,lastResult:p?"correct":"incorrect"}:ee),J=K.filter(ee=>ee.lastResult==="correct").length,te=Math.round(J/K.length*100);await _t({..._,answers:K,bestScore:te,updatedAt:Date.now()})}},N=()=>{if(a)return;const I=z[l].answer.sentence.match(/\{(.*?)\}/),j=I?I[1]:"",_=lt(L).includes(lt(j));y(_),h(!0),_&&(O(K=>K+10),H(!0))},W=()=>{H(!1),S()},S=()=>{l<z.length-1?(c(p=>p+1),P(""),h(!1),y(!1),R(!1)):(G("SUMMARY"),setTimeout(()=>f(M),2e3))},v=z[l];if(x==="SETUP"){const p=({id:I,label:j,desc:_})=>e.jsxs("button",{onClick:()=>X(I),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${m===I?"bg-amber-50 border-amber-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${m===I?"text-amber-700":"text-neutral-400"}`,children:j}),m===I&&e.jsx(ne,{size:14,className:"text-amber-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:_})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(zt,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Natural Expression"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Master native phrases by using them in context."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>Z("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${E==="MASTER"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>Z("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${E==="REVIEW"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-amber-600",children:C})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:C,onChange:I=>$(parseInt(I.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-amber-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(p,{id:"EASY",label:"EASY",desc:"Select from list"}),e.jsx(p,{id:"MEDIUM",label:"MEDIUM",desc:"Fill missing part"}),e.jsx(p,{id:"HARD",label:"HARD",desc:"Type entire phrase"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:D,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Your progress has been saved to the library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:M}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"})]});const F=v.answer.tone==="academic"?"bg-purple-100 text-purple-700":v.answer.tone==="semi-academic"?"bg-blue-100 text-blue-700":"bg-neutral-100 text-neutral-600";return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",l+1," of ",z.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-300",style:{width:`${l/z.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:M})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar w-full",children:e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-4",children:[e.jsxs("div",{className:"w-full bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-xl text-center space-y-4 relative overflow-hidden shrink-0",children:[e.jsx("div",{className:`absolute top-0 left-1/2 -translate-x-1/2 px-4 py-1 rounded-b-xl text-[10px] font-black uppercase tracking-widest ${F}`,children:v.answer.tone}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest mb-2",children:"Situation / Context"}),e.jsxs("h3",{className:"text-2xl md:text-3xl font-black text-neutral-900 leading-tight",children:['"',v.answer.anchor,'"']})]}),e.jsx("div",{className:"min-h-[100px] flex items-center justify-center py-4",children:m==="HARD"?e.jsx("div",{className:"text-neutral-400 text-sm font-medium italic",children:"(Expression Hidden - Speak or Type it)"}):e.jsx("p",{className:"text-lg md:text-xl text-neutral-700 font-medium",children:v.maskedSentence})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 bg-yellow-50 px-4 py-2 rounded-xl",children:[e.jsx("button",{onClick:()=>ge(v.answer.sentence),className:"p-2 bg-white text-yellow-600 rounded-full shadow-sm hover:scale-110 transition-transform",children:e.jsx(Ae,{size:16})}),e.jsx("span",{className:"text-xs font-bold text-yellow-800 italic",children:v.answer.note||"Listen to the example"})]})})]}),e.jsx("div",{className:"w-full max-w-md space-y-4 shrink-0",children:m==="EASY"?e.jsx("div",{className:"grid grid-cols-1 gap-2",children:(B=v.choices)==null?void 0:B.map(p=>e.jsx("button",{onClick:()=>P(p),disabled:a,className:`p-4 rounded-xl border-2 font-bold text-sm transition-all ${L===p?"bg-amber-50 border-amber-500 text-amber-900":"bg-white border-neutral-100 text-neutral-600 hover:border-neutral-300"}`,children:p},p))}):e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:d,value:L,onChange:p=>P(p.target.value),disabled:a||b,placeholder:m==="HARD"?"Type the full expression...":"Type the missing part...",className:`w-full p-5 pr-14 bg-white border-2 rounded-2xl text-lg font-bold outline-none transition-all resize-none ${T?a?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-amber-500 focus:ring-4 focus:ring-amber-50"}`,rows:2}),e.jsx("div",{className:"absolute right-3 bottom-3",children:e.jsx("button",{onClick:b?n:k,className:`p-2 rounded-full transition-all ${b?"bg-red-500 text-white animate-pulse":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:b?e.jsx("div",{className:"w-4 h-4 bg-white rounded-sm"}):e.jsx(Tt,{size:20})})})]})}),e.jsx("div",{className:"w-full max-w-md flex gap-3 shrink-0",children:a?e.jsxs("div",{className:"w-full space-y-4 animate-in slide-in-from-bottom-2 pb-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl flex items-center gap-3 border-2 bg-emerald-50 border-emerald-100 text-emerald-800",children:[e.jsx(ne,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-lg uppercase tracking-tight",children:"Correct!"}),e.jsx("p",{className:"text-xs font-bold opacity-80",children:"Great job!"})]})]}),e.jsxs("button",{onClick:S,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-sm uppercase tracking-widest transition-all shadow-xl flex items-center justify-center gap-2 hover:bg-emerald-700",children:[e.jsx(ve,{size:18})," ",l===z.length-1?"Finish":"Continue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:W,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-sm uppercase tracking-widest hover:text-neutral-600 hover:border-neutral-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(Qe,{size:16})," Skip"]}),e.jsxs("button",{onClick:()=>R(!0),disabled:u,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsx("button",{onClick:N,disabled:!L.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 disabled:active:scale-100",children:T?"Retry":"Check"})]})}),(a||u)&&e.jsxs("div",{className:"w-full max-w-md p-5 bg-white border-2 border-neutral-100 rounded-2xl shadow-sm relative overflow-hidden animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-2",children:"The Correct Expression"}),e.jsx("p",{className:"text-xl font-black text-emerald-600 leading-snug",children:v.answer.sentence.replace(/{|}/g,"")})]}),e.jsx("div",{ref:r})]})})]})},Ie=s=>s.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),js=({user:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState(10),[m,X]=t.useState("EASY"),[C,$]=t.useState("MASTER"),[Q,U]=t.useState(0),[Y,V]=t.useState(0),[z,q]=t.useState([]),[l,c]=t.useState(0),[M,O]=t.useState(0),[L,P]=t.useState([]),[b,w]=t.useState(!1),[u,R]=t.useState(!1),[T,h]=t.useState(!1),[a,y]=t.useState(!1),o=t.useRef({}),{showToast:d}=pe();t.useEffect(()=>{(async()=>{const B=(await me(s.id)).filter(j=>j.type==="intensity"&&j.intensityRows);let p=0,I=0;B.forEach(j=>{j.intensityRows.forEach(_=>{["softened","neutral","intensified"].forEach(K=>{_[K].forEach(J=>{p++,J.lastResult==="correct"&&I++})})})}),U(p),V(I)})()},[s.id,x]);const r=async()=>{const F=(await me(s.id)).filter(j=>j.type==="intensity"&&j.intensityRows&&j.intensityRows.length>0);if(F.length===0){d("No Intensity Scale lessons found in your library.","error");return}const B=[],p=[];if(F.forEach(j=>{j.intensityRows.forEach(_=>{[..._.softened,..._.neutral,..._.intensified].forEach(K=>p.push(K.word))})}),F.forEach(j=>{j.intensityRows.forEach((_,K)=>{const J=["softened","neutral","intensified"];J.forEach(te=>{const ee=_[te];ee.length!==0&&J.forEach(se=>{if(te===se||_[se].length===0)return;const be=_[se].every(ue=>ue.lastResult==="correct");C==="MASTER"&&be||ee.forEach(ue=>{const re={lessonId:j.id,rowIdx:K,pivotWord:ue.word,pivotCategory:te,targetCategory:se,expectedWords:_[se].map(ae=>Ie(ae.word)),originalExpectedItems:_[se]};if(m==="EASY"){const ae=_[se].map(he=>he.word),le=p.filter(he=>!ae.includes(he)).sort(()=>.5-Math.random()).slice(0,5);re.choices=[...ae,...le].sort(()=>.5-Math.random())}B.push(re)})})})})}),B.length===0){C==="MASTER"?(d("All items mastered! Switching to Review mode.","success"),$("REVIEW")):d("Not enough data to start game. Add more words to your scales.","error");return}const I=B.sort(()=>.5-Math.random()).slice(0,E);q(I),c(0),O(0),G("PLAYING"),i(I[0])},i=v=>{P(new Array(v.expectedWords.length).fill("")),w(!1),R(!1),y(!1),setTimeout(()=>{var F;(F=o.current[0])==null||F.focus()},100)},g=async()=>{if(T)return;const v=z[l],F=L.map(I=>Ie(I)).filter(Boolean),B=new Set(F);let p=!0;if(B.size!==v.expectedWords.length)p=!1;else for(const I of v.expectedWords)if(!B.has(I)){p=!1;break}w(!0),R(p),p&&(O(I=>I+20),await k(!0))},D=()=>{y(!0)},k=async v=>{h(!0);const F=z[l];try{const p=(await me(s.id)).find(I=>I.id===F.lessonId);if(p&&p.intensityRows){const I=[...p.intensityRows],j=[...I[F.rowIdx][F.targetCategory]];I[F.rowIdx][F.targetCategory]=j.map(_=>({..._,lastResult:v?"correct":"incorrect"})),await Ge({...p,intensityRows:I,updatedAt:Date.now()})}}catch(B){console.error("Failed to save result",B)}finally{h(!1)}},n=()=>{if(l<z.length-1){const v=l+1;c(v),i(z[v])}else G("SUMMARY")},H=async()=>{await k(!1),n()};if(x==="SETUP"){const v=({id:F,label:B,desc:p})=>e.jsxs("button",{onClick:()=>X(F),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${m===F?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${m===F?"text-orange-700":"text-neutral-400"}`,children:B}),m===F&&e.jsx(ne,{size:14,className:"text-orange-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:p})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(Wt,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Intensity Scale"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Drill synonyms based on their degree of intensity."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>$("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="MASTER"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>$("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="REVIEW"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-orange-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:E,onChange:F=>Z(parseInt(F.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-orange-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(v,{id:"EASY",label:"Easy",desc:"Select from list"}),e.jsx(v,{id:"HARD",label:"Hard",desc:"Type from memory"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:r,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Scale Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Progress marks updated in your library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:M}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>f(M),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const N=z[l],W={softened:"Softened",neutral:"Neutral",intensified:"Intensified"},S={softened:"text-blue-500 bg-blue-50 border-blue-100",neutral:"text-neutral-500 bg-neutral-100 border-neutral-200",intensified:"text-orange-500 bg-orange-50 border-orange-100"};return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",l+1," of ",z.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${l/z.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:M})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${S[N.pivotCategory]}`,children:W[N.pivotCategory]}),e.jsx("span",{className:"text-neutral-300",children:"‚Üí"}),e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${S[N.targetCategory]}`,children:W[N.targetCategory]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest",children:["What is the ",N.targetCategory," of"]}),e.jsxs("h3",{className:"text-4xl font-black text-neutral-900 tracking-tighter",children:['"',N.pivotWord,'"?']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-3",children:[L.map((v,F)=>{var B;return e.jsx("div",{className:"relative",children:m==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:p=>{o.current[F]=p},value:v,disabled:u,onChange:p=>{const I=[...L];I[F]=p.target.value,P(I)},className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${b?N.expectedWords.includes(Ie(v))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50"}`,children:[e.jsxs("option",{value:"",children:["Select word ",F+1,"..."]}),(B=N.choices)==null?void 0:B.map(p=>e.jsx("option",{value:p,children:p},p))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:p=>{o.current[F]=p},type:"text",value:v,disabled:u,onChange:p=>{const I=[...L];I[F]=p.target.value,P(I)},onKeyDown:p=>p.key==="Enter"&&!u&&g(),placeholder:`Type word ${F+1}...`,className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${b?N.expectedWords.includes(Ie(v))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50 shadow-sm"}`,autoComplete:"off"})},F)}),(u||a)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answers"}),e.jsx("p",{className:"text-lg font-black text-emerald-900",children:N.originalExpectedItems.map(v=>v.word).join(", ")})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:n,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:l===z.length-1?"Finish":"Next Question"}),e.jsx(ve,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Qe,{size:16})," Skip"]}),b&&!u&&e.jsxs("button",{onClick:D,disabled:a,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:g,disabled:T||L.some(v=>!v.trim()),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[T?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:b?"Retry":"Check"})]})]})})]})]})},fe=s=>s.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),ws=({user:s,onComplete:f,onExit:A})=>{var W;const[x,G]=t.useState("SETUP"),[E,Z]=t.useState(10),[m,X]=t.useState("EASY"),[C,$]=t.useState("MASTER"),[Q,U]=t.useState(0),[Y,V]=t.useState(0),[z,q]=t.useState([]),[l,c]=t.useState(0),[M,O]=t.useState(0),[L,P]=t.useState(""),[b,w]=t.useState(!1),[u,R]=t.useState(!1),[T,h]=t.useState(!1),[a,y]=t.useState(!1),o=t.useRef(null),{showToast:d}=pe();t.useEffect(()=>{(async()=>{const F=(await me(s.id)).filter(I=>I.type==="comparison"&&I.comparisonRows);let B=0,p=0;F.forEach(I=>{I.comparisonRows.forEach(j=>{B++,j.lastResult==="correct"&&p++})}),U(B),V(p)})()},[s.id,x]);const r=async()=>{const v=(await me(s.id)).filter(I=>I.type==="comparison"&&I.comparisonRows&&I.comparisonRows.length>0);if(v.length===0){d("No Comparison Lab lessons found in your library.","error");return}const F=[],B=[];if(v.forEach(I=>{I.comparisonRows.forEach(j=>{j.word&&B.push(j.word)})}),v.forEach(I=>{I.comparisonRows.forEach((j,_)=>{if(!j.word||!j.nuance||C==="MASTER"&&j.lastResult==="correct")return;const K={lessonId:I.id,rowIdx:_,answerWord:j.word,nuance:j.nuance,example:j.example};if(m==="EASY"){const J=B.filter(te=>fe(te)!==fe(j.word)).sort(()=>.5-Math.random()).slice(0,5);K.choices=[j.word,...J].sort(()=>.5-Math.random())}F.push(K)})}),F.length===0){C==="MASTER"?(d("All items mastered! Switching to Review mode.","success"),$("REVIEW")):d("Not enough data to start game. Add more word pairs to your labs.","error");return}const p=F.sort(()=>.5-Math.random()).slice(0,E);q(p),c(0),O(0),G("PLAYING"),i(p[0])},i=()=>{P(""),w(!1),R(!1),y(!1),setTimeout(()=>{var S;(S=o.current)==null||S.focus()},100)},g=async()=>{if(T)return;const S=z[l],v=fe(L)===fe(S.answerWord);R(v),w(!0),v&&(O(F=>F+20),await k(!0))},D=()=>{y(!0)},k=async S=>{h(!0);const v=z[l];try{const B=(await me(s.id)).find(p=>p.id===v.lessonId);if(B&&B.comparisonRows){const p=[...B.comparisonRows];p[v.rowIdx]={...p[v.rowIdx],lastResult:S?"correct":"incorrect"},await Ge({...B,comparisonRows:p,updatedAt:Date.now()})}}catch(F){console.error("Failed to save result",F)}finally{h(!1)}},n=()=>{if(l<z.length-1){const S=l+1;c(S),i(z[S])}else G("SUMMARY")},H=async()=>{await k(!1),n()};if(x==="SETUP"){const S=({id:v,label:F,desc:B})=>e.jsxs("button",{onClick:()=>X(v),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${m===v?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${m===v?"text-indigo-700":"text-neutral-400"}`,children:F}),m===v&&e.jsx(ne,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:B})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(dt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Contrast"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Distinguish confusing word pairs based on usage nuance."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>$("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="MASTER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>$("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="REVIEW"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:E,onChange:v=>Z(parseInt(v.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(S,{id:"EASY",label:"Easy",desc:"Select from list"}),e.jsx(S,{id:"HARD",label:"Hard",desc:"Type from memory"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:r,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]})}if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"History marks updated in your comparison labs."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:M}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>f(M),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const N=z[l];return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",l+1," of ",z.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${l/z.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:M})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"w-full bg-white p-10 rounded-[3rem] border-2 border-neutral-100 shadow-xl text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest mb-2",children:"Identify the word based on nuance:"}),e.jsxs("h3",{className:"text-xl md:text-2xl font-medium text-neutral-800 leading-relaxed italic",children:['"',N.nuance,'"']})]}),N.example&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-50",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-300 uppercase tracking-widest mb-1",children:"Usage Example"}),e.jsxs("p",{className:"text-sm font-bold text-neutral-500",children:['"',N.example.replace(new RegExp(N.answerWord,"gi"),"_______"),'"']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-4",children:[m==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:o,value:L,disabled:u,onChange:S=>P(S.target.value),className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${b?fe(L)===fe(N.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50"}`,children:[e.jsx("option",{value:"",children:"Select word..."}),(W=N.choices)==null?void 0:W.map(S=>e.jsx("option",{value:S,children:S},S))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:o,type:"text",value:L,disabled:u,onChange:S=>P(S.target.value),onKeyDown:S=>S.key==="Enter"&&!u&&g(),placeholder:"Type the word...",className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${b?fe(L)===fe(N.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 shadow-sm"}`,autoComplete:"off"}),(u||a)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-xl font-black text-emerald-900",children:N.answerWord})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:n,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:l===z.length-1?"Finish":"Next Question"}),e.jsx(ve,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Qe,{size:16})," Skip"]}),b&&!u&&e.jsxs("button",{onClick:D,disabled:a,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:g,disabled:T||!L.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[T?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:b?"Retry":"Check"})]})]})})]})]})},vs=({user:s,onComplete:f,onExit:A})=>{const[x,G]=t.useState("SETUP"),[E,Z]=t.useState(10),[m,X]=t.useState("MASTER"),[C,$]=t.useState(0),[Q,U]=t.useState(0),[Y,V]=t.useState([]),[z,q]=t.useState(0),[l,c]=t.useState(0),[M,O]=t.useState(!1),{showToast:L}=pe();t.useEffect(()=>{(async()=>{const y=(await me(s.id)).filter(r=>r.type==="mistake"&&r.mistakeRows);let o=0,d=0;y.forEach(r=>{r.mistakeRows.forEach(i=>{o++,i.lastResult==="correct"&&d++})}),$(o),U(d)})()},[s.id,x]);const P=()=>{O(!1)},b=async()=>{const a=(await me(s.id)).filter(d=>d.type==="mistake"&&d.mistakeRows&&d.mistakeRows.length>0);if(a.length===0){L("No Mistake cards found in your library.","error");return}const y=[];if(a.forEach(d=>{d.mistakeRows.forEach((r,i)=>{!r.mistake||!r.explanation||!r.correction||m==="MASTER"&&r.lastResult==="correct"||y.push({lessonId:d.id,rowIdx:i,mistake:r.mistake,explanation:r.explanation,correction:r.correction})})}),y.length===0){m==="MASTER"?(L("All items mastered! Switching to Review mode.","success"),X("REVIEW")):L("Not enough data to start game. Add more Mistake rows.","error");return}const o=y.sort(()=>.5-Math.random()).slice(0,E);V(o),q(0),c(0),G("PLAYING"),P()},w=async h=>{const a=Y[z];try{const o=(await me(s.id)).find(d=>d.id===a.lessonId);if(o&&o.mistakeRows){const d=[...o.mistakeRows];d[a.rowIdx]={...d[a.rowIdx],lastResult:h?"correct":"incorrect"},await Ge({...o,mistakeRows:d,updatedAt:Date.now()})}}catch(y){console.error("Failed to save Mistake result",y)}},u=()=>{z<Y.length-1?(q(h=>h+1),P()):G("SUMMARY")},R=async h=>{await w(h),h&&c(a=>a+20),u()};if(x==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(Ft,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Mistake Recognition"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Spot incorrect usage, reveal explanation, then self-evaluate."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:C}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>X("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${m==="MASTER"?"bg-rose-50 border-rose-500 text-rose-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>X("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${m==="REVIEW"?"bg-rose-50 border-rose-500 text-rose-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-rose-600",children:E})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:E,onChange:h=>Z(parseInt(h.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-rose-500"})]})]}),e.jsx("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm",children:e.jsxs("p",{className:"text-sm font-medium text-neutral-600 leading-relaxed",children:["Flow: read the incorrect phrase, think of your correction, press ",e.jsx("strong",{children:"Reveal"}),", then choose whether your answer was correct or not."]})})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:b,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(de,{size:18,fill:"white"})," Start"]})]})]});if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Progress updated in your Mistake cards."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:l}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>f(l),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const T=Y[z];return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(oe,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",z+1," of ",Y.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-rose-500 transition-all duration-300",style:{width:`${z/Y.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:l})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-10 pb-12",children:[e.jsxs("div",{className:"w-full bg-white p-10 rounded-[3rem] border-2 border-neutral-100 shadow-xl text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Find and fix this mistake (in your head):"}),e.jsxs("h3",{className:"text-2xl md:text-3xl font-black text-rose-700 leading-relaxed",children:['"',T.mistake,'"']})]}),M?e.jsxs("div",{className:"w-full space-y-5 animate-in fade-in",children:[e.jsxs("div",{className:"p-6 bg-amber-50 border border-amber-100 rounded-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-amber-600 uppercase tracking-widest mb-2",children:"Explanation"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:T.explanation})]}),e.jsxs("div",{className:"p-6 bg-emerald-50 border border-emerald-100 rounded-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-2",children:"Correction"}),e.jsx("p",{className:"text-xl font-black text-emerald-900",children:T.correction})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>R(!1),className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-50 transition-all",children:"Correct"}),e.jsxs("button",{onClick:()=>R(!0),className:"flex-[2] py-4 bg-emerald-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-xl active:scale-95 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Incorrect"}),e.jsx(ve,{size:18})]})]})]}):e.jsx("button",{onClick:()=>O(!0),className:"px-10 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95",children:"Reveal"})]})]})},_s=({user:s,onExit:f,onRecalculateXp:A,xpToNextLevel:x,onStartSession:G,onUpdateUser:E,lastMasteryScoreUpdateTimestamp:Z,onBulkUpdate:m,initialGameMode:X,onConsumeGameMode:C})=>{const[$,Q]=t.useState("ADVENTURE"),[U,Y]=t.useState([]),[V,z]=t.useState(!0),q=t.useRef(0),{showToast:l}=pe();t.useEffect(()=>{X&&X!=="MENU"&&(Q(X),C==null||C())},[X,C]);const c=t.useRef(A);t.useEffect(()=>{c.current=A},[A]),t.useEffect(()=>{(async()=>{z(!0);const R=rt().filter(T=>T.userId===s.id).filter(T=>T&&!T.isPassive);if(Y(R),Z>q.current){const T=R.reduce((h,a)=>h+(a.masteryScore||0),0);await c.current(T),q.current=Date.now()}z(!1)})()},[s.id,Z]);const M=w=>{l(`Game Complete! Score: ${w}`,"success"),f()},O=()=>{f()},L=w=>U.filter(u=>u.gameEligibility?u.gameEligibility.includes(w):Pt(u).includes(w)),P=()=>U.filter(w=>{const u=w.paraphrases&&w.paraphrases.filter(h=>!h.isIgnored&&h.context&&h.context.trim()).length>=2,R=w.collocationsArray&&w.collocationsArray.filter(h=>!h.isIgnored&&h.d&&h.d.trim()).length>=2,T=w.idiomsList&&w.idiomsList.filter(h=>!h.isIgnored&&h.d&&h.d.trim()).length>=2;return u||R||T}),b=()=>{const w={onComplete:M,onExit:O};switch($){case"ADVENTURE":return e.jsx(Fe,{user:s,onUpdateUser:E,onStartSession:G,onExit:f});case"IPA_SORTER":return e.jsx(ds,{...w,words:L("IPA_SORTER"),onBulkUpdate:m});case"SENTENCE_SCRAMBLE":return e.jsx(xs,{...w,words:L("SENTENCE_SCRAMBLE")});case"DICTATION":return e.jsx(bs,{...w,words:L("DICTATION")});case"PREPOSITION_POWER":return e.jsx(ms,{...w,words:L("PREPOSITION_POWER")});case"PARAPHRASE_CONTEXT":return e.jsx(hs,{...w,words:P()});case"WORD_SCATTER":return e.jsx(fs,{...w,words:L("MEANING_MATCH")});case"NATURAL_EXPRESSION":return e.jsx(gs,{userId:s.id,...w});case"INTENSITY_SCALE":return e.jsx(js,{user:s,...w});case"COMPARISON_LAB":return e.jsx(ws,{user:s,...w});case"MISTAKE_RECOGNITION":return e.jsx(vs,{user:s,...w});default:return e.jsx(Fe,{user:s,onUpdateUser:E,onStartSession:G,onExit:f})}};return $==="ADVENTURE"?e.jsx(es,{user:s,xpToNextLevel:x,onUpdateUser:E,isRecalculatingXp:V,children:e.jsx(Fe,{user:s,onUpdateUser:E,onStartSession:G,onExit:f})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-neutral-100 p-4 md:p-6 animate-in zoom-in-95 duration-300 flex flex-col",children:e.jsx("div",{className:"w-full h-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-200 relative p-6",children:b()})})};export{_s as default};
