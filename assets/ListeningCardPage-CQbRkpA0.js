import{r as n,h as D,x as ee,G as te,j as e,am as se,ak as oe,P as ne,a5 as G,q as re,e as ae,F as le,a6 as ce,bf as de,y as ie,bg as P,X as ue,Z as xe,bh as ge}from"./index-Gt8en8nb.js";import{R as he,a as pe,V as me}from"./ResourceActions-C2FUQ3Kz.js";import{U as be}from"./UniversalCard-B4PHYGpU.js";import{T as $,F as fe}from"./TagBrowser-BKDot2N6.js";import{E as je}from"./ear-CwAIiGZ_.js";import{T as we}from"./target-CDeXYkpk.js";import"./search-zoyTxZGY.js";import"./chevron-left-CHoHolDa.js";import"./circle-BWUoDYmY.js";const R="vocab_pro_listening_view",Ne=({text:h})=>{const p=h.split(/({.*?})/g);return e.jsx("span",{children:p.map((i,o)=>i.startsWith("{")&&i.endsWith("}")?e.jsx("span",{className:"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200",children:i.slice(1,-1)},o):e.jsx("span",{children:i},o))})},ve=({isOpen:h,onClose:p,onSave:i,initialData:o})=>{const[m,v]=n.useState(""),[k,u]=n.useState(""),[w,d]=n.useState("/"),[y,j]=n.useState("");n.useEffect(()=>{var r;if(h)if(v((o==null?void 0:o.text)||""),u((o==null?void 0:o.note)||""),(o==null?void 0:o.path)===void 0){const c=(o==null?void 0:o.tags)||[],f=c.find(b=>b.startsWith("/")),l=c.filter(b=>!b.startsWith("/"));d(f||"/"),j(l.join(", "))}else d((o==null?void 0:o.path)||"/"),j(((r=o==null?void 0:o.tags)==null?void 0:r.join(", "))||"")},[h,o]);const F=r=>{if(r.preventDefault(),m.trim()){const c=y.split(",").map(f=>f.trim()).filter(Boolean);i(m.trim(),k.trim(),w.trim(),c)}},S=()=>{const r=document.getElementById("listening-text-input");if(!r)return;const c=r.selectionStart,f=r.selectionEnd,l=m.substring(c,f);if(l){const b=m.substring(0,c)+`{${l}}`+m.substring(f);v(b)}};return h?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:F,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:o?"Edit Phrase":"New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text you find hard to hear."})]}),e.jsx("button",{type:"button",onClick:p,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ue,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500",children:["Text content",e.jsx("span",{className:"font-normal text-[10px] ml-2 text-neutral-400",children:"(Select text & click Highlight)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"listening-text-input",value:m,onChange:r=>v(r.target.value),placeholder:"e.g. I {wanna} go to the store.",rows:4,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0,autoFocus:!0}),e.jsx("button",{type:"button",onClick:S,className:"absolute bottom-3 right-3 px-3 py-1.5 bg-red-100 text-red-600 rounded-lg text-[10px] font-black uppercase tracking-wider hover:bg-red-200 transition-colors",children:"Highlight Selection"})]}),e.jsxs("p",{className:"text-[10px] text-neutral-400 italic",children:["Tip: Use ",e.jsx("strong",{children:"{curly braces}"})," to mark the difficult parts."]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:k,onChange:r=>u(r.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Path"}),e.jsx("input",{value:w,onChange:r=>d(r.target.value),placeholder:"/Connected Speech",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags (Keywords)"}),e.jsx("input",{value:y,onChange:r=>j(r.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(xe,{size:14})," Save Item"]})})]})}):null},ze=({user:h})=>{const[p,i]=n.useState([]),[o,m]=n.useState(!0),[v,k]=n.useState(!1),[u,w]=n.useState(()=>D(R,{showNote:!0,compact:!1,showType:!0})),[d,y]=n.useState(null),[j,F]=n.useState(!1),[S,r]=n.useState(!1),[c,f]=n.useState("all"),[l,b]=n.useState("all"),[E,B]=n.useState(0),[N,U]=n.useState(12);n.useEffect(()=>{ee(R,u)},[u]);const[_,I]=n.useState(!1),[z,V]=n.useState(null),[O,A]=n.useState(null),{showToast:T}=te(),M=async()=>{m(!0);const t=await de(h.id);i(t.sort((s,a)=>a.createdAt-s.createdAt)),m(!1)};n.useEffect(()=>{M()},[h.id]),n.useEffect(()=>{B(0)},[d,N,c,l]);const C=n.useMemo(()=>{let t=p;return c==="focused"&&(t=t.filter(s=>s.isFocused)),l!=="all"&&(t=t.filter(s=>s.focusColor===l)),d&&(d==="Uncategorized"?t=t.filter(s=>{const a=s.path??(s.tags||[]).find(g=>g.startsWith("/"));return!(a&&a!=="/")}):t=t.filter(s=>{var a,x;return((a=s.path)==null?void 0:a.startsWith(d))||((x=s.tags)==null?void 0:x.includes(d))})),t},[p,d,c,l]),H=n.useMemo(()=>{const t=E*N;return C.slice(t,t+N)},[C,E,N]),q=()=>{V(null),I(!0)},J=t=>{V(t),I(!0)},K=async()=>{O&&(await ge(O.id),A(null),T("Deleted item.","success"),M())},X=async(t,s,a,x)=>{try{const g=Date.now();if(z){const L={...z,text:t,note:s,path:a,tags:x,updatedAt:g};await P(L),T("Item updated!","success")}else{const L={id:`lst-${g}-${Math.random()}`,userId:h.id,text:t,note:s,path:a,tags:x,createdAt:g,updatedAt:g};await P(L),T("Item added!","success")}I(!1),M()}catch{T("Failed to save item.","error")}},W=t=>{const s=t.replace(/[{}]/g,"");ie(s)},Y=()=>{i(t=>[...t].sort(()=>Math.random()-.5)),T("Shuffled!","success")},Z=async(t,s)=>{const a={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete a.focusColor,i(x=>x.map(g=>g.id===t.id?a:g)),await P(a)},Q=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};i(a=>a.map(x=>x.id===t.id?s:x)),await P(s)};return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),config:{},isLoading:o,isEmpty:C.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:E,totalPages:Math.ceil(C.length/N),onPageChange:B,pageSize:N,onPageSizeChange:U,totalItems:C.length},aboveGrid:e.jsxs(e.Fragment,{children:[j&&e.jsx($,{items:p,selectedTag:d,onSelectTag:y,forcedView:"groups",title:"Browse Groups",icon:e.jsx(fe,{size:16})}),S&&e.jsx($,{items:p,selectedTag:d,onSelectTag:y,forcedView:"tags",title:"Browse Tags",icon:e.jsx(le,{size:16})})]}),actions:e.jsx(pe,{viewMenu:e.jsx(me,{isOpen:v,setIsOpen:k,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(we,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>f(c==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${c==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:c==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(l==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>b(l==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>b(l==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:u.showNote,onChange:()=>w(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:u.showType,onChange:()=>w(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:u.compact,onChange:()=>w(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:j,onToggle:()=>{F(!j),r(!1)}},browseTags:{isOpen:S,onToggle:()=>{r(!S),F(!1)}},addActions:[{label:"Add Phrase",icon:re,onClick:q}],extraActions:e.jsx("button",{onClick:Y,disabled:p.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(ae,{size:16})})}),children:()=>e.jsx(e.Fragment,{children:H.map(t=>e.jsx(be,{title:e.jsx(Ne,{text:t.text}),badge:u.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:je}:void 0,path:t.path,tags:t.tags,compact:u.compact,onClick:()=>W(t.text),focusColor:t.focusColor,onFocusChange:s=>Z(t,s),isFocused:t.isFocused,onToggleFocus:()=>Q(t),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),W(t.text)},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Play",children:e.jsx(oe,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),J(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ne,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),A(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(G,{size:14})})]}),children:u.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit",children:[e.jsx(se,{size:12})," ",t.note]})},t.id))})}),e.jsx(ve,{isOpen:_,onClose:()=>I(!1),onSave:X,initialData:z}),e.jsx(ce,{isOpen:!!O,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:K,onClose:()=>A(null),icon:e.jsx(G,{size:40,className:"text-red-500"})})]})};export{ze as ListeningCardPage};
