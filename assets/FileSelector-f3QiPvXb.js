import{c as F,l as ee,aJ as te,a0 as se,r as l,j as t,X as U,aZ as ae,H as re,i as H}from"./index-C2HBAOCD.js";import{T as ne}from"./tag-D8Hdmp_1.js";import{F as M}from"./folder-BGwNn9ou.js";import{S as le}from"./server-CoAtMImr.js";import{L as I}from"./list-todo-D3QAyxB2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("CornerLeftUp",[["polyline",{points:"14 9 9 4 4 9",key:"m9oyvo"}],["path",{d:"M20 20h-7a4 4 0 0 1-4-4V4",key:"1blwi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=F("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),fe=({isOpen:N,onClose:j,onSelect:v,type:n,title:Q})=>{const V=ee(),p=te(V),{showToast:c}=se(),[d,w]=l.useState("folders"),[L,Z]=l.useState({}),[o,b]=l.useState(null),[i,k]=l.useState(""),[m,h]=l.useState([]),[D,u]=l.useState(!1),[x,g]=l.useState(""),[J,y]=l.useState(!1),O=l.useRef(null),C=l.useRef(null);l.useEffect(()=>{N&&(b(null),k(""),h([]),g(""),y(!1),n==="reading"||n==="planning"?(w("master"),X()):(w("folders"),T()))},[N,n]),l.useEffect(()=>{const e=s=>{C.current&&!C.current.contains(s.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const T=async()=>{u(!0);try{const e=await fetch(`${p}/api/audio/mappings`);e.ok?Z(await e.json()):c("Failed to connect to server","error")}catch{c("Server unreachable","error")}finally{u(!1)}},$=async(e,s="")=>{u(!0);try{const r=encodeURIComponent(s),a=await fetch(`${p}/api/${n==="audio"?"audio":"reading"}/files/${e}?path=${r}`);if(a.ok){const z=await a.json();let R=[];Array.isArray(z.items)&&(R=z.items),h(R),k(z.currentPath||"")}else c("Failed to load files","error")}catch{c("Connection error","error")}finally{u(!1)}},X=async()=>{u(!0);try{const s=await fetch(`${p}/api/${n==="planning"?"planning":"reading"}/master`);if(s.ok){const r=await s.json();let f=[];Array.isArray(r.items)&&(n==="planning"?f=r.items.map(a=>({name:a.id,type:"plan",displayName:a.displayName,data:{title:a.name,description:a.description,todos:a.todos}})):f=r.items.map(a=>({name:a.id,type:"unit",displayName:a.name,tags:Array.isArray(a.tags)?a.tags:[],data:{title:a.name,description:a.description,essay:a.essay,words:a.words,tags:a.tags}}))),h(f)}else c("Failed to load Master Library","error")}catch{c("Connection error","error")}finally{u(!1)}},B=e=>{b(e),$(e,"")},G=e=>{w(e),b(null),k(""),h([]),g(""),T()},K=e=>{if(!o)return;const s=i?`${i}/${e}`:e;$(o,s)},W=()=>{if(o)if(!i)b(null),h([]);else{const e=i.split("/");e.pop();const s=e.join("/");$(o,s)}},Y=async e=>{if(d==="master"){e.data&&(v(e.data),j());return}if(o)if(n==="audio"){const s=i?`${i}/${e.name}`:e.name,r=`${p}/api/audio/stream/${o}/${s}`;v({url:r,filename:e.name,transcript:e.transcript,transcriptTitle:e.transcriptTitle,map:o,path:i}),j()}else{u(!0);try{const s=i?`${i}/${e.name}`:e.name,r=await fetch(`${p}/api/reading/content/${o}/${s}`);if(r.ok){const f=await r.json();v(f),j()}else c("Failed to load file content","error")}catch{c("Error reading file","error")}finally{u(!1)}}},A=l.useMemo(()=>{if(d!=="master"||!x)return m;const e=x.toLowerCase();return m.filter(s=>!!(s.displayName&&s.displayName.toLowerCase().includes(e)||s.tags&&s.tags.some(r=>r.toLowerCase().includes(e))))},[m,x,d]),E=l.useMemo(()=>{if(d!=="master")return[];const e=new Set;return m.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.tags.forEach(r=>e.add(r))}),Array.from(e).sort()},[m,d]),P=l.useMemo(()=>x?E.filter(e=>e.toLowerCase().includes(x.toLowerCase())).slice(0,8):[],[E,x]);if(!N)return null;const _=()=>n==="audio"?t.jsx(q,{size:20}):n==="planning"?t.jsx(I,{size:20}):t.jsx(S,{size:20});return t.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:t.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[t.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex flex-col gap-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[_(),Q]}),t.jsx("button",{onClick:j,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:t.jsx(U,{size:20})})]}),n==="reading"||n==="planning"?t.jsxs("div",{className:"relative",ref:C,children:[t.jsxs("div",{className:"relative",children:[t.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:14}),t.jsx("input",{ref:O,type:"text",value:x,onChange:e=>{g(e.target.value),y(!0)},onFocus:()=>y(!0),placeholder:n==="planning"?"Filter by title...":"Filter by tag or title...",className:"w-full pl-9 pr-4 py-2.5 bg-neutral-50 border border-neutral-200 rounded-xl text-xs font-bold focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all"}),x&&t.jsx("button",{onClick:()=>g(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600",children:t.jsx(U,{size:12})})]}),J&&P.length>0&&n==="reading"&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-neutral-100 rounded-xl shadow-xl z-20 overflow-hidden max-h-48 overflow-y-auto",children:P.map(e=>t.jsxs("button",{onClick:()=>{g(e),y(!1)},className:"w-full text-left px-4 py-2 text-xs font-medium hover:bg-neutral-50 flex items-center gap-2 text-neutral-700",children:[t.jsx(ne,{size:12,className:"text-neutral-400"}),e]},e))})]}):t.jsx("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:t.jsxs("button",{onClick:()=>G("folders"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-xs font-bold transition-all ${d==="folders"?"bg-white shadow-sm text-neutral-900":"text-neutral-500 hover:text-neutral-700"}`,children:[t.jsx(M,{size:14})," Server Folders"]})})]}),d==="folders"&&t.jsxs("div",{className:"p-4 bg-neutral-50 border-b border-neutral-100 flex items-center gap-2 overflow-hidden",children:[o&&t.jsx("button",{onClick:W,className:"p-1.5 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-100 transition-colors",children:t.jsx(oe,{size:14})}),t.jsx("div",{className:"flex-1 truncate text-xs font-mono font-medium text-neutral-600",children:o?`/${o}/${i}`:"Root"})]}),t.jsx("main",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:D?t.jsx("div",{className:"flex justify-center py-10",children:t.jsx(re,{size:24,className:"animate-spin text-neutral-300"})}):d==="folders"&&!o?t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest px-2 mb-2",children:"Mapped Folders"}),Object.keys(L).map(e=>t.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-neutral-50 transition-colors text-left group",children:[t.jsx(M,{size:18,className:"text-indigo-400 group-hover:text-indigo-600"}),t.jsx("span",{className:"text-sm font-bold text-neutral-700",children:e}),t.jsx(H,{size:14,className:"ml-auto text-neutral-300"})]},e)),Object.keys(L).length===0&&t.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"No mappings found. Configure in Settings."})]}):t.jsxs("div",{className:"space-y-1",children:[A.map((e,s)=>(e.type==="file"||e.type==="unit"||e.type,t.jsxs("button",{onClick:()=>e.type==="directory"?K(e.name):Y(e),className:"w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left group hover:bg-neutral-50",children:[e.type==="directory"?t.jsx(M,{size:18,className:"text-indigo-400"}):e.type==="unit"?t.jsx(le,{size:18,className:"text-emerald-500"}):e.type==="plan"?t.jsx(I,{size:18,className:"text-purple-500"}):n==="audio"?t.jsx(q,{size:18,className:"text-emerald-500"}):t.jsx(S,{size:18,className:"text-blue-500"}),t.jsx("div",{className:"flex-1 overflow-hidden",children:e.displayName?t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-bold text-neutral-800 truncate",children:e.displayName}),e.tags&&e.tags.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tags.slice(0,3).map((r,f)=>t.jsx("span",{className:"px-1.5 py-0.5 bg-neutral-100 rounded text-[9px] font-medium text-neutral-500 border border-neutral-200",children:r.trim()},f)),e.tags.length>3&&t.jsxs("span",{className:"text-[9px] text-neutral-400 font-medium",children:["+",e.tags.length-3]})]})]}):t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"text-xs font-medium text-neutral-700 truncate",children:e.name}),n==="audio"&&e.transcript&&t.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-emerald-50 text-emerald-600 rounded-md border border-emerald-100 shrink-0 animate-in fade-in",children:[t.jsx(S,{size:10}),t.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter",children:"Transcript"})]})]})}),e.type==="directory"&&t.jsx(H,{size:14,className:"text-neutral-300"})]},`${e.name}-${s}`))),A.length===0&&t.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"No matching items."})]})})]})})};export{S as F,q as M,fe as a};
