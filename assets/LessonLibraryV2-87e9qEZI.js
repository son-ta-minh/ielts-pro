import{r as a,t as me,j as e,A as fe,q as ee,i as be,s as Fe,ac as gt,a2 as Be,P as we,E as pt,D as Ne,ae as se,m as ne,bJ as xe,a1 as Ee,b4 as Re,aI as ht,bK as xt,bL as te,G as mt,a0 as ft,bM as bt,bN as wt,J as Nt,bO as H,aj as Z,_ as Pe,al as De,bP as vt,l as St,bQ as jt}from"./index-B6aD1nvT.js";import{R as kt,a as Ct}from"./ResourceActions-DctR5ZFn.js";import{T as At}from"./TagBrowser-BfuUBWDc.js";import{U as yt}from"./UniversalCard-8omicTTL.js";import{p as Ge,W as Tt}from"./markdownParser-CN__FxEv.js";import{B as Lt}from"./book-text-DcL2CfCQ.js";import{H as It,P as Oe}from"./pause-CkAKcrEP.js";import{u as Et,G as Rt,S as Me,V as Pt}from"./ShelfSearchBar-BOAogQP2.js";import{F as Dt,U as Ot,a as Mt,M as zt,A as Ft,R as Bt}from"./ShelfModals-aS1kP4TQ.js";import{M as Gt}from"./move-CQAKc2BA.js";import{P as $t}from"./pen-BWn9BrWI.js";import{L as _t}from"./library-B1Zye5hS.js";import{T as Ut}from"./target-BTqSLudi.js";import{F as Vt}from"./file-clock-8bS4ovND.js";import"./chevron-left-DZoFe_di.js";import"./square-check-big-B7jtiTyg.js";import"./circle-B7VZYKnE.js";import"./palette-Cf720m3p.js";function ve(n){const{topic:C,currentLesson:h,userRequest:E,language:d,targetAudience:f,tone:x,coachName:S,task:L}=n,k=d==="Vietnamese",u=k?"Vietnamese":"English",o=k?"Audio-VN":"Audio-EN";let l="",w="",N="";return L==="convert_to_listening"?(l="TRANSFORM the provided Reading Lesson into a high-quality, focused LISTENING SCRIPT (Podcast style).",N=`
    READING CONTENT TO CONVERT:
    Title: ${h==null?void 0:h.title}
    Content: ${h==null?void 0:h.content}
    `,w=`
    FORMATTING STYLE: LISTENING ONLY (PODCAST SCRIPT)
    - **No Meta-Talk**: Skip explaining what an idiom or collocation is. Focus 100% on usage.
    - **Language of Instruction**: Explain everything in ${u}. 
    - **Tagging**: Inside [${o}], you MUST translate all linguistic terms to ${u}.
    - **Strict Tag Splitting**: [${o}]Meaning of[/] [Audio-EN]word[/] [${o}]is...[/]
    `):L==="refine_reading"?(l="Refine the provided Reading Lesson. Fix ambiguous quizzes.",N=`
    CURRENT CONTENT:
    Title: ${h==null?void 0:h.title}
    Body: ${h==null?void 0:h.content}
    USER REQUEST: "${E||"Make it sharper and remove redundant meta-explanation."}"
    `,w=`
    FORMATTING STYLE: READING & INTERACTIVE
    - **Fix Quizzes**: If there are [Quiz: ...] tags where the answer isn't 100% unique (like a fixed preposition), you MUST CONVERT them to [Select: Correct | Distractor 1 | Distractor 2] to ensure the user knows exactly what is expected.
    - **Explanation Language**: Strictly use ${u} for all instructional text.
    - **Tagging**: Apply strict tag splitting.
    `):(l=`Create a sharp, focused Reading Lesson in ${u} for a ${f} on: "${C}".`,N=`USER REQUEST: "${E||"Create a targeted lesson."}"`,w=`
    FORMATTING STYLE: READING & INTERACTIVE
    - **Rule**: Prefer [Select: ...] over [Quiz: ...] unless the answer is a fixed single word.
    - **Language**: Instructions and explanations MUST be in ${u}.
    `),`You are an expert IELTS coach.
  ROLE: You are '${S}', acting as a ${x==="friendly_elementary"?"friendly teacher":"professional professor"}.
    
  TASK: ${l}

  ${N}

  ${w}

  STRICT CONTENT RULES:
  1. DO NOT explain definitions of linguistic terms (e.g., "what an idiom is").
  2. QUIZ CLARITY: Use [Select: ...] for any blank that could have multiple synonyms. Provide clear distractors.
  3. MANDATORY: All explanations, feedback, and meta-text MUST be in ${u}.
  4. Use Markdown with [Audio-VN] (for Vietnamese explanation parts) and [Audio-EN] (for English examples/words) tags correctly.

  Return a strict JSON object:
  {
    "title": "string",
    "description": "string",
    "content": "string",
    "tags": ["string"]
  }`}function Wt(n,C,h){var S,L,k,u;const d=(C.format||"reading")==="listening",f={word:n.word,meaning:n.meaningVi,ipa:n.ipa,family:n.wordFamily,collocations:(S=n.collocationsArray)==null?void 0:S.filter(o=>!o.isIgnored).map(o=>({text:o.text,hint:o.d})),idioms:(L=n.idiomsList)==null?void 0:L.filter(o=>!o.isIgnored).map(o=>({text:o.text,hint:o.d})),paraphrases:(k=n.paraphrases)==null?void 0:k.filter(o=>!o.isIgnored).map(o=>({word:o.word,tone:o.tone,context:o.context})),prepositions:(u=n.prepositions)==null?void 0:u.filter(o=>!o.isIgnored)},x=d?`FORMATTING STYLE: LISTENING ONLY (PODCAST SCRIPT)
    - **Word-Centric**: Focus only on the nuances of "${n.word}".
    - **TAG SPLITTING (CRITICAL)**: Never include the English word "${n.word}" or any example inside an [Audio-VN] tag. You MUST split the tags.
    - **Term Translation**: Use Vietnamese for "thÃ nh ngá»¯", "vÃ­ dá»¥", "cá»¥m tá»«".
    - **Voice**: Speak as '${h}'.`:`FORMATTING STYLE: READING & INTERACTIVE
    - **Direct Knowledge**: Use strict tag splitting.
    - **Interactive**: 
        - Use [Select: Correct | Wrong1 | Wrong2] for most interactive elements.
        - Use [Multi: Correct | Wrong1 | Wrong2] for standalone checks.
        - DO NOT use [Quiz: ...] if multiple answers could fit (e.g., synonyms). Use [Select: ...] instead to guide the user.`;return`You are an expert IELTS coach named '${h}'.
  
  TASK: Generate a high-quality ${d?"LISTENING (PODCAST)":"READING"} lesson about: "${n.word}".
  
  DATA: ${JSON.stringify(f)}

  ${x}

  STRICT RULES:
  1. **NO ENGLISH WORDS IN [Audio-VN]**. Split tags every time.
  2. **QUIZ CLARITY**: Avoid [Quiz: ...] for open-ended blanks. If the user has to guess between "misinterpreted" and "misunderstood", use [Select: misinterpreted | misunderstood | mistaken].
  3. **COMPACT LAYOUT**: No horizontal rules (---). Minimal empty lines.
  4. **AUDIO TAG INTEGRITY**: Content inside [Audio-XX]...[/] MUST be on a single continuous string with no literal newlines.

  Return a JSON object:
  {
    "title": "Mastering: ${n.word}",
    "description": "string",
    "content": "string (Markdown with [Audio-VN] and [Audio-EN])",
    "tags": ["Vocabulary"]
  }`}const Yt=n=>{const{title:C,setTitle:h,description:E,setDescription:d,tagsInput:f,setTagsInput:x,content:S,setContent:L,listeningContent:k,setListeningContent:u,isSaving:o,onSave:l,onPractice:w,onCancel:N,onOpenAiRefine:F}=n,[p,_]=a.useState("READING"),[A,O]=a.useState(!1),y=a.useMemo(()=>Ge(p==="READING"?S:k),[S,k,p]);return a.useEffect(()=>(window.handleLessonSpeak=I=>{me(I)},()=>{delete window.handleLessonSpeak}),[]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:N,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(fe,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:w,disabled:o,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(ee,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:F,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(be,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:l,disabled:o,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[o?e.jsx(Fe,{size:14,className:"animate-spin"}):e.jsx(gt,{size:14}),e.jsx("span",{children:o?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:C,onChange:I=>h(I.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Be,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:f,onChange:I=>x(I.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 mb-1",children:"Short Description"}),e.jsx("textarea",{value:E,onChange:I=>d(I.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:()=>{_("READING"),O(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Lt,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{_("LISTENING"),O(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(It,{size:12,className:"inline mr-1"})," Listening Script"]})]}),e.jsxs("button",{onClick:()=>O(!A),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[A?e.jsx(we,{size:12}):e.jsx(pt,{size:12}),e.jsx("span",{children:A?"Edit":"Preview"})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[500px] relative overflow-hidden",children:A?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:y}}):e.jsx("textarea",{value:p==="READING"?S:k,onChange:I=>p==="READING"?L(I.target.value):u(I.target.value),className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:p==="READING"?`# Lesson Heading

Write reading content...`:"[Audio-EN]Hello, welcome to this podcast...[/]",spellCheck:!1})})]})]})]})},Jt=({lesson:n,user:C,onSave:h,onPractice:E,onCancel:d})=>{const[f,x]=a.useState(n.title),[S,L]=a.useState(n.description||""),[k,u]=a.useState(n.path||"/"),[o,l]=a.useState((n.tags||[]).join(", ")),[w,N]=a.useState(n.content),[F,p]=a.useState(n.listeningContent||""),[_,A]=a.useState(!1),[O,y]=a.useState(!1),{showToast:I}=Ne(),R=n.topic1,V=n.topic2;a.useEffect(()=>{if(n.path===void 0&&n.tags){const g=n.tags||[],m=g.find(B=>B.startsWith("/")),b=g.filter(B=>!B.startsWith("/"));u(m||"/"),l(b.join(", "))}else u(n.path||"/"),l((n.tags||[]).join(", "))},[n]);const M=()=>{const g=o.split(",").map(m=>m.trim()).filter(Boolean);return{...n,title:f,description:S,topic1:R,topic2:V,path:k.trim(),tags:g,content:w,listeningContent:F,updatedAt:Date.now()}},Y=()=>{A(!0);const g=M();h(g)},j=()=>{A(!0);const g=M();E(g)},v=g=>{var D,P,G;const m=ne(),b=m.audioCoach.activeCoach,B=m.audioCoach.coaches[b].name;return ve({task:g.format==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:f,description:S,content:w},userRequest:g.request,language:g.language||((D=C.lessonPreferences)==null?void 0:D.language)||"English",targetAudience:((P=C.lessonPreferences)==null?void 0:P.targetAudience)||"Adult",tone:g.tone||((G=C.lessonPreferences)==null?void 0:G.tone)||"professional_professor",coachName:B,format:g.format||"reading"})},T=g=>{const m=g.result||g;m.content.includes("[Audio-")?(p(m.content),I("Listening script updated!","success")):(x(m.title),L(m.description),N(m.content),!o.trim()&&m.tags&&m.tags.length>0&&l(m.tags.join(", ")),I("Lesson content refined!","success")),y(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Yt,{title:f,setTitle:x,description:S,setDescription:L,path:k,setPath:u,tagsInput:o,setTagsInput:l,content:w,setContent:N,listeningContent:F,setListeningContent:p,isSaving:_,onSave:Y,onPractice:j,onCancel:d,onOpenAiRefine:()=>y(!0)}),O&&e.jsx(se,{isOpen:O,onClose:()=>y(!1),type:"REFINE_UNIT",title:"Refine Lesson",description:"AI will format your notes or generate a Listening Podcast script.",onGeneratePrompt:v,onJsonReceived:T,actionLabel:"Apply Changes"})]})},qt=({lesson:n,onComplete:C,onEdit:h,onAddSound:E})=>{var V,M,Y;const[d,f]=a.useState("IDLE"),[x,S]=a.useState(-1),[L,k]=a.useState(!1),[u,o]=a.useState(0),l=a.useRef(!1),w=a.useRef(new Map),N=a.useRef(new Map),F=a.useMemo(()=>Ge(n.content),[n.content]),p=a.useMemo(()=>{if(!n.listeningContent)return[];const j=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,v=[];let T;for(;(T=j.exec(n.listeningContent))!==null;)v.push({lang:T[1].toUpperCase()==="VN"?"vi":"en",text:T[2].replace(/\[.*?\]/g,"").trim()});return v},[n.listeningContent]),_=j=>{if(w.current.has(j))return Promise.resolve(w.current.get(j));if(N.current.has(j))return N.current.get(j);const v=p[j],T=xt(v.text,v.lang).then(g=>(g&&(w.current.set(j,g),o(m=>m+1)),g));return N.current.set(j,T),T},A=async j=>{for(let v=j;v<p.length&&!l.current;v++)await _(v)},O=async()=>{d==="PAUSED"?(f("PLAYING"),l.current=!1):(l.current=!1,f("PLAYING"),A(0));const j=x===-1?0:x;for(let v=j;v<p.length&&!l.current;v++){S(v);const T=p[v];let g=w.current.get(v);if(g||(k(!0),g=await _(v),k(!1)),l.current)break;try{await me(T.text,!0,T.lang,void 0,void 0,g||void 0)}catch(m){console.error("Speech playback error at index",v,m)}}l.current||(f("IDLE"),S(-1),o(0),w.current.clear(),N.current.clear())},y=()=>{l.current=!0,xe(),f("IDLE"),S(-1),o(0),w.current.clear(),N.current.clear(),k(!1)};a.useEffect(()=>(window.handleLessonSpeak=j=>{me(j)},()=>{y(),delete window.handleLessonSpeak}),[]);const I=p.length>0,R=u>=p.length;return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300",children:[e.jsxs("header",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:C,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(fe,{size:14}),e.jsx("span",{children:"Back to Library"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:n.title}),n.description&&e.jsx("p",{className:"text-neutral-500 font-medium",children:n.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[I?e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm",children:[d==="PLAYING"?e.jsx("button",{onClick:()=>{f("PAUSED"),xe(),l.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(Oe,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:O,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(Ee,{size:20,fill:"currentColor"})}),d!=="IDLE"&&e.jsx("button",{onClick:y,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Re,{size:20,fill:"currentColor"})}),d==="IDLE"&&E&&e.jsx("button",{onClick:E,className:"p-3 bg-white text-amber-500 rounded-xl hover:bg-amber-50 transition-all border border-amber-100 shadow-sm",title:"Regenerate Sound Script",children:e.jsx(ht,{size:20})}),e.jsxs("div",{className:"px-4 pr-6",children:[e.jsx("div",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-widest leading-none mb-1",children:d==="IDLE"?"Play":d==="PAUSED"?"Paused":"Playing"}),e.jsx("div",{className:"text-xs font-bold text-indigo-900 leading-none",children:d==="IDLE"?`${p.length} Segments`:`${x+1} / ${p.length}`})]})]}):E&&e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100 active:scale-95",children:[e.jsx(be,{size:16}),e.jsx("span",{children:"Add Lesson Sound"})]}),e.jsx("button",{onClick:h,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(we,{size:20})})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px]",children:e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:F}})}),d!=="IDLE"&&e.jsxs("div",{className:"fixed bottom-10 left-1/2 -translate-x-1/2 bg-neutral-900/95 backdrop-blur-md text-white px-8 py-6 rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row items-center gap-8 animate-in slide-in-from-bottom-8 z-50 border border-neutral-800 ring-4 ring-black/10 w-[95%] max-w-4xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em]",children:["Narrating ",x+1," / ",p.length]}),L?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-amber-500/20 rounded-full",children:[e.jsx(Fe,{size:10,className:"animate-spin text-amber-400"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-amber-400 tracking-wider",children:"Buffering..."})]}):!R&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-white/10 rounded-full",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-400"}),e.jsxs("span",{className:"text-[8px] font-black uppercase text-emerald-400 tracking-wider",children:["Downloaded ",u,"/",p.length]})]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[9px] font-black uppercase ${((V=p[x])==null?void 0:V.lang)==="vi"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:((M=p[x])==null?void 0:M.lang)==="vi"?"VN":"EN"})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto custom-scrollbar pr-4 transition-all",children:e.jsxs("p",{className:"text-lg font-bold text-neutral-100 leading-relaxed italic",children:['"',((Y=p[x])==null?void 0:Y.text)||"...",'"']})})]}),e.jsxs("div",{className:"flex items-center gap-5 shrink-0 border-l border-white/10 pl-6 h-full self-stretch md:self-center",children:[e.jsx("button",{onClick:y,className:"p-4 text-neutral-400 hover:text-white transition-colors bg-white/5 rounded-full hover:bg-white/10",title:"Stop",children:e.jsx(Re,{size:24,fill:"currentColor"})}),d==="PLAYING"?e.jsx("button",{onClick:()=>{f("PAUSED"),xe(),l.current=!0},className:"w-16 h-16 bg-white text-neutral-900 rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",title:"Pause",children:e.jsx(Oe,{size:32,fill:"currentColor"})}):e.jsx("button",{onClick:O,className:"w-16 h-16 bg-indigo-500 text-white rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",title:"Play",children:e.jsx(Ee,{size:32,fill:"currentColor"})})]})]})]})},Qt=({user:n,lesson:C,onComplete:h,onEdit:E,onUpdate:d})=>{const[f,x]=a.useState(!1),{showToast:S}=Ne(),L=u=>{var w,N,F;const o=ne(),l=o.audioCoach.coaches[o.audioCoach.activeCoach].name;return ve({task:"convert_to_listening",currentLesson:{title:C.title,description:C.description,content:C.content},userRequest:u.request,language:u.language||((w=n.lessonPreferences)==null?void 0:w.language)||"English",targetAudience:((N=n.lessonPreferences)==null?void 0:N.targetAudience)||"Adult",tone:u.tone||((F=n.lessonPreferences)==null?void 0:F.tone)||"professional_professor",coachName:l})},k=async u=>{const o=u.result||u,l={...C,listeningContent:o.content,updatedAt:Date.now()};await te(l),d&&d(l),S("Audio script added successfully!","success"),x(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{lesson:C,onComplete:h,onEdit:E,onAddSound:()=>x(!0)}),f&&e.jsx(se,{isOpen:f,onClose:()=>x(!1),type:"GENERATE_AUDIO_SCRIPT",title:"Add Lesson Sound",description:"AI will transform this lesson into a podcast script for you to listen.",onGeneratePrompt:L,onJsonReceived:k,actionLabel:"Apply Sound Script",closeOnSuccess:!0})]})},Ht={filterSchema:[],viewSchema:[]},ze="vocab_pro_lesson_view_settings",xs=({user:n,onStartSession:C,onNavigate:h,onUpdateUser:E})=>{var Le;const[d,f]=a.useState([]),[x,S]=a.useState([]),[L,k]=a.useState([]),[u,o]=a.useState(!0),[l,w]=a.useState(null),[N,F]=a.useState(!1),[p,_]=a.useState(!1),[A,O]=a.useState("ALL"),[y,I]=a.useState("all"),[R,V]=a.useState("all"),[M,Y]=a.useState(()=>mt(ze,{showDesc:!0,compact:!1})),[j,v]=a.useState(0),[T,g]=a.useState(12),[m,b]=a.useState("list"),[B,D]=a.useState(null),[P,G]=a.useState(null),[ae,oe]=a.useState(null),[J,ie]=a.useState(null),[$e,re]=a.useState(!1),[_e,le]=a.useState(!1),[Se,ce]=a.useState(!1),[K,Ue]=a.useState(null),{currentShelfName:de,booksOnCurrentShelf:ue,allShelves:X,addShelf:Ve,renameShelf:We,removeShelf:Ye,nextShelf:Je,prevShelf:qe,selectShelf:Qe}=Et(x,"lesson_books_shelves"),[He,ge]=a.useState(!1),[Ke,pe]=a.useState(!1),[U,he]=a.useState(null),{showToast:q}=Ne();a.useEffect(()=>{ft(ze,M)},[M]);const $=a.useCallback(async()=>{o(!0);try{const[t,r,c]=await Promise.all([bt(n.id),wt(n.id),Nt()]),s=[...t.map(i=>({type:"ESSAY",data:i,path:i.path,tags:i.tags,date:i.createdAt}))];f(s.sort((i,z)=>z.date-i.date)),S(r.sort((i,z)=>z.createdAt-i.createdAt)),k(c)}finally{o(!1)}},[n.id]);a.useEffect(()=>{$()},[$]),a.useEffect(()=>{v(0)},[l,A,y,R,T]);const Xe=a.useMemo(()=>A!=="ALL"||y!=="all"||R!=="all",[A,y,R]),W=a.useMemo(()=>d.filter(t=>{var r,c;if(A!=="ALL"&&t.type!==A||y==="focused"&&!t.data.isFocused||R!=="all"&&t.data.focusColor!==R)return!1;if(l){if(l==="Uncategorized"){const s=t.path??(t.tags||[]).find(z=>z.startsWith("/"));if(s&&s!=="/")return!1}else if(!((r=t.path)!=null&&r.startsWith(l))&&!((c=t.tags)!=null&&c.includes(l)))return!1}return!0}),[d,l,A,y,R]),Ze=a.useMemo(()=>{const t=j*T;return W.slice(t,t+T)},[W,j,T]),et=t=>{We(t,async(c,s)=>{o(!0);const i=x.filter(z=>{const Q=z.title.split(":");return(Q.length>1?Q[0].trim():"General")===c});await Promise.all(i.map(z=>{const Q=z.title.split(":"),Ie=Q.length>1?Q.slice(1).join(":").trim():Q[0],ut=`${s}: ${Ie}`;return H({...z,title:ut,updatedAt:Date.now()})})),await $()})&&pe(!1)},je=async()=>{const t={id:`lb-${Date.now()}`,userId:n.id,title:`${de}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#1a237e",icon:"ðŸ“˜"};await H(t),await $(),G(t),b("book_detail"),q("New book created.","success")},tt=async t=>{if(!P)return;const r={...P,...t,updatedAt:Date.now()};S(c=>c.map(s=>s.id===r.id?r:s)),G(r),await H(r)},st=async t=>{if(!U)return;const r=U.title.split(":"),c=r.length>1?r.slice(1).join(":").trim():r[0],s=`${t}: ${c}`,i={...U,title:s,updatedAt:Date.now()};await H(i),he(null),await $(),q(`Moved to "${t}".`,"success")},nt=async()=>{ae&&(await jt(ae.id),q("Lesson deleted.","success"),oe(null),$())},at=async t=>{await te(t),q("Lesson saved!","success"),b(P?"book_detail":"list"),D(null),$()},ot=()=>{const t={id:`lesson-${Date.now()}`,userId:n.id,topic1:"",topic2:"",title:"New Lesson",description:"",content:"",tags:[],createdAt:Date.now(),updatedAt:Date.now()};D(t),b("edit_lesson")},ke=async t=>{const{result:r,preferences:c}=t;JSON.stringify(n.lessonPreferences)!==JSON.stringify(c)&&await E({...n,lessonPreferences:c});const s={id:`lesson-ai-${Date.now()}`,userId:n.id,title:r.title,description:r.description,content:r.content,tags:r.tags||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"",topic2:""};await te(s),q("Lesson created with AI!","success"),re(!1),le(!1),D(s),b("read_lesson"),$()},Ce=async(t,r)=>{const c={...t.data,focusColor:r||void 0,updatedAt:Date.now()};r||delete c.focusColor,await te(c),f(s=>s.map(i=>i.data.id===t.data.id?{...i,data:{...i.data,focusColor:r||void 0,updatedAt:Date.now()}}:i))},Ae=async t=>{const r={...t.data,isFocused:!t.data.isFocused,updatedAt:Date.now()};await te(r),f(c=>c.map(s=>s.data.id===t.data.id?{...s,data:{...s.data,isFocused:!s.data.isFocused,updatedAt:Date.now()}}:s))},it=()=>{if(W.length===0){q("No items to randomize.","info");return}const t=W[Math.floor(Math.random()*W.length)];D(t.data),b("read_lesson")},ye=t=>{Qe(t),b("shelf")},Te=t=>{G(t),b("book_detail")},rt=[{label:"Topic Lesson (AI)",icon:be,onClick:()=>re(!0)},{label:"Word Lesson (AI)",icon:ee,onClick:()=>ce(!0)},{label:"New Lesson (Manual)",icon:Pe,onClick:ot}],lt=t=>{const r=ne(),c=r.audioCoach.activeCoach,s=r.audioCoach.coaches[c].name;return ve({topic:t.topic,language:t.language,targetAudience:t.targetAudience,tone:t.tone,format:t.format,coachName:s,task:"create_reading"})},ct=t=>{if(!K)return"";const r=ne(),c=r.audioCoach.activeCoach,s=r.audioCoach.coaches[c].name;return Wt(K,{language:t.language,targetAudience:t.targetAudience,tone:t.tone,format:t.format},s)},dt=t=>{if(t.length===0)return;const r=t[0],c=L.find(s=>s.word.toLowerCase()===r.toLowerCase());c&&(Ue(c),ce(!1),le(!0))};if(m==="read_lesson"&&B)return e.jsx(Qt,{user:n,lesson:B,onComplete:()=>b(P?"book_detail":"list"),onEdit:()=>b("edit_lesson"),onUpdate:t=>D(t)});if(m==="edit_lesson"&&B)return e.jsx(Jt,{lesson:B,user:n,onSave:at,onPractice:t=>{D(t),b("read_lesson")},onCancel:()=>b(P?"book_detail":"list")});if(m==="book_detail"&&P){const t=new Map(d.map(s=>[s.data.id,s])),r=P.itemIds.map(s=>{const i=t.get(s);return i?{id:s,title:i.data.title,subtitle:i.data.description,data:i.data,focusColor:i.data.focusColor,isFocused:i.data.isFocused}:null}).filter(s=>s!==null),c=d.map(s=>({id:s.data.id,title:s.data.title,subtitle:s.data.description,data:s.data}));return e.jsx(Rt,{book:P,items:r,availableItems:c,onBack:()=>{G(null),b("shelf"),$()},onUpdateBook:tt,onAddItem:async s=>{const i={...P,itemIds:Array.from(new Set([...P.itemIds,...s]))};await H(i),G(i)},onRemoveItem:async s=>{const i={...P,itemIds:P.itemIds.filter(z=>z!==s)};await H(i),G(i)},onOpenItem:s=>{D(s.data),b("read_lesson")},onEditItem:s=>{D(s.data),b("edit_lesson")},onFocusChange:(s,i)=>Ce({data:s.data},i),onToggleFocus:s=>Ae({data:s.data}),itemIcon:e.jsx(ee,{size:16})})}return m==="shelf"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>b("list"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(fe,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Lesson Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Browse your lesson collections."})]}),e.jsx(Me,{shelves:X,books:x,onNavigateShelf:ye,onNavigateBook:Te}),e.jsxs("button",{onClick:()=>ge(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Dt,{size:14})," Add Shelf"]})]})]}),e.jsxs(Ot,{label:de,onNext:X.length>1?Je:void 0,onPrev:X.length>1?qe:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>pe(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx($t,{size:14})}),e.jsx("button",{onClick:Ye,disabled:ue.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(Z,{size:14})})]}),isEmpty:ue.length===0,emptyAction:e.jsx("button",{onClick:je,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[ue.map(t=>{var c;const r=((c=t.title.split(":").pop())==null?void 0:c.trim())||t.title;return e.jsx(Mt,{id:t.id,title:r,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(ee,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{G(t),b("book_detail")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),he(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Gt,{size:16})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),ie(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(Z,{size:16})})]})},t.id)}),e.jsx("div",{className:"group translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:je,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(Pe,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(De,{isOpen:!!J,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Le=J==null?void 0:J.title.split(":").pop())==null?void 0:Le.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:async()=>{J&&await vt(J.id),ie(null),$()},onClose:()=>ie(null),icon:e.jsx(Z,{size:40,className:"text-red-500"})}),e.jsx(zt,{isOpen:!!U,onClose:()=>he(null),onConfirm:st,shelves:X,currentShelf:U?U.title.split(":")[0].trim():"General",bookTitle:(U==null?void 0:U.title)||""}),e.jsx(Ft,{isOpen:He,onClose:()=>ge(!1),onSave:t=>{Ve(t)&&ge(!1)}}),e.jsx(Bt,{isOpen:Ke,onClose:()=>pe(!1),onSave:et,initialName:de})]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),centerContent:e.jsx(Me,{shelves:X,books:x,onNavigateShelf:ye,onNavigateBook:Te}),minorSkills:e.jsxs("button",{onClick:()=>h("IRREGULAR_VERBS"),className:"flex items-center gap-2 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-xs font-bold hover:bg-orange-100 transition-colors",children:[e.jsx(Vt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Irregular Verbs"})]}),pagination:{page:j,totalPages:Math.ceil(W.length/T),onPageChange:v,pageSize:T,onPageSizeChange:g,totalItems:W.length},actions:e.jsx(Ct,{viewMenu:e.jsx(Pt,{isOpen:p,setIsOpen:_,hasActiveFilters:Xe,filterOptions:[{label:"All",value:"ALL",isActive:A==="ALL",onClick:()=>O("ALL")},{label:"Lesson",value:"ESSAY",isActive:A==="ESSAY",onClick:()=>O("ESSAY")}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Ut,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>I(y==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${y==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:y==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>V(R==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${R==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>V(R==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${R==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>V(R==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${R==="red"?"bg-rose-50 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:M.showDesc,onChange:()=>Y(t=>({...t,showDesc:!t.showDesc}))},{label:"Compact",checked:M.compact,onChange:()=>Y(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:N,onToggle:()=>{F(!N)}},addActions:rt,extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:it,disabled:d.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(St,{size:16})}),e.jsxs("button",{onClick:()=>b("shelf"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(_t,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),aboveGrid:e.jsx(e.Fragment,{children:N&&e.jsx(At,{items:d,selectedTag:l,onSelectTag:w,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Be,{size:16})})}),config:Ht,activeFilters:{},onFilterChange:()=>{},isLoading:u,isEmpty:W.length===0,emptyMessage:"No items found matching your criteria.",children:()=>e.jsx(e.Fragment,{children:Ze.map(t=>{const r=()=>{D(t.data),b("read_lesson")},c=()=>{D(t.data),b("edit_lesson")},s=()=>oe(t.data);return e.jsx(yt,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:t.data.title}),tags:t.data.tags,compact:M.compact,onClick:r,focusColor:t.data.focusColor,onFocusChange:i=>Ce(t,i),isFocused:t.data.isFocused,onToggleFocus:()=>Ae(t),isCompleted:t.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),r()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(ee,{size:14})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),c()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(we,{size:14})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),s()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(Z,{size:14})})]}),children:M.showDesc&&t.data.description&&e.jsx("p",{className:"line-clamp-2",children:t.data.description})},`${t.type}-${t.data.id}`)})})}),e.jsx(De,{isOpen:!!ae,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:nt,onClose:()=>oe(null),icon:e.jsx(Z,{size:40,className:"text-red-500"})}),e.jsx(se,{isOpen:$e,onClose:()=>re(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:n.lessonPreferences,onGeneratePrompt:lt,onJsonReceived:ke,actionLabel:"Create Lesson",closeOnSuccess:!0}),e.jsx(se,{isOpen:_e,onClose:()=>le(!1),type:"GENERATE_WORD_LESSON",title:`AI Word Lesson: ${K==null?void 0:K.word}`,description:"Creating a deep-dive lesson based on your library data.",initialData:n.lessonPreferences,onGeneratePrompt:ct,onJsonReceived:ke,actionLabel:"Create Word Lesson",closeOnSuccess:!0}),Se&&e.jsx(Tt,{isOpen:Se,onClose:()=>ce(!1),onSelect:dt,allWords:L,wordsToExclude:new Set,loading:u})]})};export{xs as LessonLibraryV2,xs as default};
