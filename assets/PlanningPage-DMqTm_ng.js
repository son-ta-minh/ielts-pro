import{c as O,r as l,D as J,bT as V,j as e,P as B,ao as M,i as K,a3 as P,aq as _,aj as H,bU as Q,X,ah as Y,bV as G,bW as Z,k as ee}from"./index-DGJ8pI6b.js";import{R as te,a as se}from"./ResourceActions-CUMjs2k8.js";import{U as ae}from"./UniversalCard-dj22GCRq.js";import{F as ne}from"./FileSelector-Bd0nHpcf.js";import{L as D}from"./server-BFeTvLIR.js";import{D as re}from"./download-CHUUuwxQ.js";import{C as oe}from"./folder-n66ThGOn.js";import"./chevron-left-J6RKxoGo.js";import"./file-text-fChqOZiM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=O("CircleDashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);function ce(n){return`You are an expert study planner and productivity coach.

TASK:
Create a structured learning goal based on the user's request. The goal should be broken down into specific, actionable tasks (todos).

USER REQUEST: "${n}"

INSTRUCTIONS:
1.  **Analyze the Request**: Identify the main subject (e.g., "Collins Reading for IELTS", "Learn 50 phrasal verbs", "Writing Task 1 practice").
2.  **Create a Title**: A concise, motivating title for the goal.
3.  **Create a Description**: A brief overview of what this goal achieves.
4.  **Generate Todos**: Break the goal down into logical steps or units.
    -   If the request refers to a specific book or course (e.g., "18 lessons of Collins Reading"), generate exactly that number of tasks, matching the unit titles if possible or using logical generic titles.
    -   If the request is general (e.g., "Learn vocabulary"), create a logical progression (e.g., "Day 1: Family", "Day 2: Work").
    -   Each task should be clear and actionable.

STRICT JSON OUTPUT FORMAT:
Return a single JSON object. Do not include any text outside the JSON block.

{
  "title": "string (Goal Title)",
  "description": "string (Goal Description)",
  "todos": [
    {
      "text": "string (Task description, e.g., 'Unit 1: Family & Relationships - Complete exercises')"
    },
    {
      "text": "string (Task description, e.g., 'Unit 2: Health & Fitness - Review vocabulary')"
    }
  ]
}`}const E={NEW:{icon:oe,color:"text-neutral-300",bg:"bg-neutral-100",label:"New"},IN_PROGRESS:{icon:le,color:"text-blue-500",bg:"bg-blue-50",label:"In Progress"},CLOSED:{icon:ee,color:"text-green-500",bg:"bg-green-50",label:"Closed"}},de=({todo:n,readOnly:m,onStatusChange:y,onTextChange:o,onDelete:v})=>{const[w,p]=l.useState(!1),g=E[n.status],x=g.icon;return m?e.jsxs("div",{className:`flex items-start gap-2.5 py-1.5 ${n.status==="CLOSED"?"opacity-50":""}`,children:[e.jsx(x,{size:14,className:`mt-0.5 shrink-0 ${g.color}`}),e.jsx("span",{className:`text-xs font-medium leading-snug ${n.status==="CLOSED"?"line-through text-neutral-400":"text-neutral-700"}`,children:n.text})]}):e.jsxs("div",{className:"group flex items-start gap-2 p-2 bg-white border border-neutral-200 rounded-xl hover:border-neutral-300 transition-all focus-within:ring-2 focus-within:ring-neutral-900/5 focus-within:border-neutral-400",children:[e.jsxs("div",{className:"relative shrink-0 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>p(!w),className:`p-1 rounded-md hover:bg-neutral-100 transition-colors ${g.color}`,title:"Change Status",children:e.jsx(x,{size:18})}),w&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white rounded-xl shadow-xl border border-neutral-100 z-50 p-1 flex flex-col gap-1 animate-in fade-in zoom-in-95",children:Object.keys(E).map(i=>{const d=E[i],h=d.icon;return e.jsxs("button",{type:"button",onClick:()=>{y==null||y(i),p(!1)},className:`flex items-center gap-2 px-2 py-2 rounded-lg text-xs font-bold transition-colors w-full text-left ${n.status===i?"bg-neutral-100":"hover:bg-neutral-50"}`,children:[e.jsx(h,{size:14,className:d.color}),e.jsx("span",{className:"text-neutral-600",children:d.label})]},i)})})]}),e.jsx("input",{type:"text",value:n.text,onChange:i=>o==null?void 0:o(i.target.value),className:`flex-1 bg-transparent border-none outline-none text-sm font-medium py-1 ${n.status==="CLOSED"?"text-neutral-400 line-through":"text-neutral-900"}`,placeholder:"Task description..."}),e.jsx("button",{type:"button",onClick:v,className:"p-1.5 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all self-start mt-0.5",title:"Remove Task",children:e.jsx(M,{size:14})})]})},ue=({isOpen:n,onClose:m,onSave:y,initialData:o})=>{const[v,w]=l.useState(""),[p,g]=l.useState(""),[x,i]=l.useState([]),[d,h]=l.useState("");l.useEffect(()=>{n&&(w((o==null?void 0:o.title)||""),g((o==null?void 0:o.description)||""),i((o==null?void 0:o.todos)||[]),h(""))},[n,o]);const k=()=>{if(!d.trim())return;const a={id:`todo-${Date.now()}-${Math.random()}`,text:d.trim(),status:"NEW"};i([...x,a]),h("")},N=(a,c)=>{i(f=>f.map(C=>C.id===a?{...C,...c}:C))},S=a=>{i(c=>c.filter(f=>f.id!==a))},I=()=>{v.trim()&&y({title:v,description:p,todos:x})};return n?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:o?"Edit Goal":"New Goal"}),e.jsx("button",{onClick:m,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(X,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-6 flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Goal Title"}),e.jsx("input",{value:v,onChange:a=>w(a.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none",placeholder:"e.g. Master Phrasal Verbs",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Description (Optional)"}),e.jsx("textarea",{value:p,onChange:a=>g(a.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-900 outline-none resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-end px-1",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(D,{size:14})," Task List"]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 bg-neutral-100 px-2 py-0.5 rounded-full",children:x.length})]}),e.jsx("div",{className:"space-y-2",children:x.map(a=>e.jsx(de,{todo:a,readOnly:!1,onStatusChange:c=>N(a.id,{status:c}),onTextChange:c=>N(a.id,{text:c}),onDelete:()=>S(a.id)},a.id))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{value:d,onChange:a=>h(a.target.value),onKeyDown:a=>a.key==="Enter"&&k(),className:"flex-1 px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none transition-all focus:bg-white",placeholder:"Add a new task..."}),e.jsx("button",{onClick:k,disabled:!d.trim(),className:"px-4 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 disabled:opacity-50 transition-colors shadow-sm",children:e.jsx(P,{size:20})})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:e.jsxs("button",{onClick:I,disabled:!v.trim(),className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50 hover:scale-105 transition-transform",children:[e.jsx(Y,{size:14})," ",e.jsx("span",{children:"Save Changes"})]})})]})}):null},ye=({user:n})=>{const[m,y]=l.useState([]),[o,v]=l.useState(!0),[w,p]=l.useState(!1),[g,x]=l.useState(null),[i,d]=l.useState(null),[h,k]=l.useState(null),[N,S]=l.useState(!1),[I,a]=l.useState(!1),{showToast:c}=J(),f=l.useCallback(async()=>{v(!0);const t=await V(n.id);y(t.sort((s,r)=>s.order!==void 0&&r.order!==void 0?s.order-r.order:s.order!==void 0?-1:r.order!==void 0?1:r.createdAt-s.createdAt)),v(!1)},[n.id]);l.useEffect(()=>{f()},[f]);const C=async t=>{const s=Date.now();if(g){const r={...g,...t,updatedAt:s};await G(r),c("Goal updated.","success")}else{const r={id:`goal-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos||[],createdAt:s,updatedAt:s,order:m.length};await G(r),c("Goal created.","success")}p(!1),f()},$=async()=>{i&&(await Z(i.id),c("Goal deleted.","success"),d(null),f())},R=async t=>{if(t.title&&Array.isArray(t.todos)){const s=Date.now(),r={id:`goal-ai-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos.map(b=>({id:`todo-${s}-${Math.random()}`,text:b.text,status:"NEW"})),createdAt:s,updatedAt:s,order:0};await G(r),c("Goal generated by AI!","success"),S(!1),f()}else c("Invalid AI response.","error")},z=async t=>{const s=Date.now(),r=(t.todos||[]).map(j=>({id:`todo-imp-${s}-${Math.random()}`,text:j.text||j,status:"NEW"})),b={id:`goal-imp-${s}-${Math.random()}`,userId:n.id,title:t.title||"Imported Goal",description:t.description||"Imported from server.",todos:r,createdAt:s,updatedAt:s,order:0};try{await G(b),c(`Imported "${b.title}" successfully!`,"success"),await f()}catch{c("Failed to save imported goal.","error")}},F=t=>ce(t.request),L=(t,s)=>{k(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s)},U=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},q=async(t,s)=>{if(t.preventDefault(),!h||h===s)return;const r=m.findIndex(T=>T.id===h),b=m.findIndex(T=>T.id===s);if(r===-1||b===-1)return;const j=[...m],[A]=j.splice(r,1);j.splice(b,0,A);const u=j.map((T,W)=>({...T,order:W}));y(u),k(null),await Q(u)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Planning Board",subtitle:"Track your learning goals and tasks.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Spiral%20Calendar.png",className:"w-8 h-8 object-contain",alt:"Planning"}),config:{},isLoading:o,isEmpty:m.length===0,emptyMessage:"No goals set. Start planning!",activeFilters:{},onFilterChange:()=>{},actions:e.jsx(se,{addActions:[{label:"New (AI)",icon:K,onClick:()=>S(!0)},{label:"New (Manual)",icon:P,onClick:()=>{x(null),p(!0)}},{label:"Add from Server",icon:re,onClick:()=>a(!0)}]}),children:()=>e.jsx(e.Fragment,{children:m.map(t=>{const s=t.todos.length,r=t.todos.filter(u=>u.status==="CLOSED").length,b=s>0?Math.round(r/s*100):0,j=s>0&&r===s,A=h===t.id;return e.jsx("div",{draggable:!0,onDragStart:u=>L(u,t.id),onDragOver:U,onDrop:u=>q(u,t.id),className:`transition-all duration-200 h-full ${A?"opacity-40 scale-95":"opacity-100 hover:scale-[1.01]"}`,children:e.jsx(ae,{title:e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-snug mb-0.5 select-none",children:t.title}),compact:!0,onClick:()=>{x(t),p(!0)},isCompleted:j,className:"h-full",actions:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 text-neutral-300 cursor-grab active:cursor-grabbing hover:text-neutral-500 rounded-lg transition-colors mr-1",children:e.jsx(ie,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),x(t),p(!0)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(B,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),d(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(M,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-3 select-none",children:[t.description&&e.jsx("p",{className:"text-[10px] text-neutral-400 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-neutral-500 bg-neutral-50 px-2 py-1.5 rounded-lg w-fit self-start",children:[e.jsx(D,{size:12}),e.jsxs("span",{children:[s," Tasks"]}),r>0&&e.jsxs("span",{className:"text-green-600",children:["(",r," done)"]})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[b,"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${j?"bg-green-500":"bg-indigo-500"}`,style:{width:`${b}%`}})})]})]})})},t.id)})})}),e.jsx(ue,{isOpen:w,onClose:()=>p(!1),onSave:C,initialData:g,user:n}),e.jsx(_,{isOpen:!!i,title:"Delete Goal?",message:"This will remove the goal and all its tasks.",confirmText:"Delete",isProcessing:!1,onConfirm:$,onClose:()=>d(null),icon:e.jsx(M,{size:40,className:"text-red-500"})}),N&&e.jsx(H,{isOpen:N,onClose:()=>S(!1),type:"GENERATE_PLAN",title:"AI Goal Planner",description:"Describe your goal (e.g. 'Complete Collins Reading book') and let AI generate the task list.",initialData:{request:""},onGeneratePrompt:F,onJsonReceived:R,actionLabel:"Create Plan",closeOnSuccess:!0}),e.jsx(ne,{isOpen:I,onClose:()=>a(!1),onSelect:z,type:"planning",title:"Import Goal from Server"})]})};export{ye as PlanningPage};
