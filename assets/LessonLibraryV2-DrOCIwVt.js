import{c as ge,r as a,bk as ue,H as pe,j as e,D as Ae,f as Ie,E as We,au as Ve,Z as fe,g as ae,bJ as xe,S as ne,P as be,I as Be,aA as re,af as he,$ as we,ax as Ne,k as ye,N as Ee,bs as Re,bG as Ke,bf as ve,aj as He,b4 as qe,bK as Je,ak as Xe,bL as Qe,bj as ee,a0 as Ze,ai as et,l as tt,u as st,h as nt,T as at,aB as rt,aZ as ot,bM as it}from"./index-Bqy58GPU.js";import{R as lt,a as ct}from"./ResourceActions-MeP9Tfk4.js";import{T as dt}from"./TagBrowser--XpOShEY.js";import{U as ut}from"./UniversalCard-tvpjz2JQ.js";import{T as Le}from"./tag-BDLg-zv4.js";import{a as je,S as Ce}from"./split-DThQZAEJ.js";import{H as me}from"./headphones-D7J-JsKC.js";import{C as pt}from"./chevron-left-DYfdAwkU.js";import{V as xt}from"./ViewMenu-CWaRYH25.js";import{L as ht}from"./layout-grid-vWfe4HEG.js";import"./filter-DND7XjpB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ge("FileDiff",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ge("GalleryHorizontalEnd",[["path",{d:"M2 7v10",key:"a2pl2d"}],["path",{d:"M6 5v14",key:"1kq3d7"}],["rect",{width:"12",height:"18",x:"10",y:"3",rx:"2",key:"13i7bc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=ge("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);function Se(t){const{currentLesson:r,userRequest:g,language:E,tone:b,coachName:i,task:x,topic:h}=t,T=E==="Vietnamese"?"Vietnamese":"English",f=(r==null?void 0:r.type)==="intensity"||(r==null?void 0:r.type)==="comparison"||(h==null?void 0:h.toLowerCase().includes("intensity"))||(h==null?void 0:h.toLowerCase().includes("comparison"));let k="",S="",w="",v="";x==="create_reading"?k=f?`Create a structured study guide for a ${t.targetAudience} comparing nuanced vocabulary related to: "${h}".`:`Create an immersive, high-impact lesson for a ${t.targetAudience} on: "${h}".`:x==="convert_to_listening"?(k="TRANSFORM the provided Reading Lesson into a high-quality NATURAL AUDIO SCRIPT.",w=`SOURCE: ${r==null?void 0:r.title}
${r==null?void 0:r.content}`):(k=f?"REFINE the reading material into a structured analysis table for the current vocabulary set.":"REFINE the lesson to focus on Contextual Nuance and Visual Clarity.",w=`CURRENT: ${r==null?void 0:r.title}
${r==null?void 0:r.content}
REQUEST: "${g||"Improve layout and examples."}"`);const O=`
  METADATA RULES (STRICT):
  1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Frozen Heat", "Moral Compass".
  2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.
  3. **searchKeywords**: Array of strings. Include all primary words/synonyms. For comparison/intensity, include every compared word.`;return f&&x!=="convert_to_listening"?(S=`
      STYLE: SYSTEMATIC ANALYSIS TABLE
      - You MUST use a Markdown Table as the primary structure.
      - COLUMNS: | Word | Explanation | Examples |
      - "Explanation": Keep it short (max 15 words). **Bold important phrases**.
      - "Examples": Provide EXACTLY TWO distinct examples per word.
      ${O}`,v=`
      CONTENT REQUIREMENTS:
      1. Analyze the core words provided.
      2. **EXPANSION**: Introduce 2-3 NEW related high-frequency words.`):x==="convert_to_listening"?S=`
      - STRUCTURE: Natural spoken narrative.
      - AUDIO STRATEGY: Wrap EVERY sentence in [Audio-VN] or [Audio-EN] tags.`:S=`
      STYLE: COMPACT RICH ARTICLE
      - Use Headers (###), Tips [Tip: ...], and Spoilers [HIDDEN: ...].
      - Use Blockquotes (>) for examples.
      ${O}`,`You are expert IELTS coach '${i}', acting as a ${b==="friendly_elementary"?"friendly mentor":"professor"}.
    
  TASK: ${k}

  ${w}
  ${v}
  ${S}

  STRICT CONTENT RULES:
  1. NO generic introductions.
  2. MANDATORY: All coaching/explanations in ${T}.
  3. **TAGS**: Return EXACTLY ONE tag from: ["Grammar", "Pattern", "Speaking", "Listening", "Reading", "Writing", "General", "Comparison", "Vocabulary"].

  CRITICAL OUTPUT RULES:
  1. **MARKDOWN CODE BLOCK**: Wrap entire JSON response in \`\`\`json ... \`\`\`.
  2. **NO RAW NEWLINES**: Use literal '\\n' for line breaks.
  3. **TABLES**: Use \`<br>\` for line breaks inside table cells.

  OUTPUT TEMPLATE:
  \`\`\`json
  {
    "title": "string",
    "description": "string",
    "content": "string",
    "searchKeywords": ["string"],
    "tags": ["string"]
  }
  \`\`\``}function Oe(t,r,g,E=[]){const b=E.join(", ");return`You are an expert IELTS examiner. 
  
  TASK: Generate a creative and comprehensive PRACTICE TEST based on the following lesson content.
  
  LESSON TITLE: "${t}"
  LESSON CONTENT: "${r}"
  USER REQUEST: "${g||""}"
  TAGS: "${b}"

  AVAILABLE INTERACTIVE TAGS:
  1. **Dropdown**: [Select: Correct | Distractor 1 | Distractor 2]
     - Use for sentence completion, synonyms, or choosing the best fit.
  2. **Multiple Choice**: [Multi: Correct | Distractor 1 | Distractor 2]
     - Use for checking definitions, tones, or concepts.
  3. **Fill-in-the-blank**: [Quiz: Answer]
     - **CONSTRAINT**: Use this ONLY if the answer is absolutely unambiguous (e.g. spelling check, specific term recall) OR if the User Request specifically asks for fill-in/typing questions.

  STRUCTURE STRATEGY:
  Analyze the content and tags.

  **CASE A: VOCABULARY LESSON** (e.g. tags include "Vocabulary", "Vocab", or content is a list of words/phrases)
  If this is primarily a vocabulary lesson, follow this structure:
  1. **Section 1: Vocabulary Selection (3-5 items)**: Use [Select: Correct | Wrong 1 | Wrong 2] to test the nuance of collocations or specific words from the lesson.
  2. **Section 2: Meaning Matching (2-4 items)**: Use [Multi: Correct | Option 2 | Option 3] to match a term to its definition.
  3. **Section 3: Contextual Use (2-4 items)**: Provide short sentences with blanks using [Select: ...] where the user chooses the best synonym for a specific tone.

  **CASE B: OTHER LESSONS** (Grammar, General, Skills, etc.)
  - **Creative Flow**: Design a test flow that best suits the specific concepts taught (e.g., rewriting sentences, identifying errors, filling gaps).
  - Do NOT follow the fixed 3-section structure of Case A unless it fits perfectly.
  - **Contextual**: Focus on testing application in context.

  GENERAL GUIDELINES:
  - **No Repetition**: Do not simply repeat the essay text. Create new sentences or scenarios to test the knowledge.
  - **Language**: Instructions in the same language as the lesson's explanations (Vietnamese/English). Target material in English.

  Return a JSON object:
  {
    "content": "string (Markdown with interactive test components)"
  }`}function ft(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Word Intensity Scale" table.
    
    INPUT DATA (Existing Rows):
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the existing word(s). 
    2. Complete any missing columns (Softened, Neutral, Intensified) to create a perfect scale.
    3. Ensure the progression is logical (e.g., chilly -> cold -> freezing).
    4. For EACH word, assign a register if it is distinctly "academic" or "casual". Leave empty if neutral.
    5. **EXPANSION**: You MUST introduce 1-2 ADDITIONAL rows of related vocabulary that fit the theme of the provided words. Choose only natural, high-frequency words useful for IELTS.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Frozen Heat", "Moral Compass".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "softened": [{"word": "string", "register": "academic" | "casual" | null}],
          "neutral": [{"word": "string", "register": "academic" | "casual" | null}],
          "intensified": [{"word": "string", "register": "academic" | "casual" | null}]
        }
      ]
    }
    `}function bt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Confusing Word Comparison" table.
    
    INPUT DATA:
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the word(s). 
    2. If a nuance or example is missing, generate high-quality explanations.
    3. The "nuance" should explain exactly WHEN and WHY to use this word compared to its synonyms. Be sharp and IELTS-focused.
    4. Provide one natural, clear example sentence.
    5. **EXPANSION**: If the list is short, you MUST suggest 1-2 ADDITIONAL confusing words that belong to the same semantic group.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Visual Deception", "Mental Strain".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "word": "string",
          "nuance": "string (The sharp explanation of usage)",
          "example": "string (The example sentence)"
        }
      ]
    }
    `}const wt=t=>{const{type:r,title:g,setTitle:E,description:b,setDescription:i,tagsInput:x,setTagsInput:h,content:I,setContent:T,listeningContent:f,setListeningContent:k,testContent:S,setTestContent:w,intensityRows:v,setIntensityRows:O,comparisonRows:M,setComparisonRows:H,isSaving:$,onSave:F,onPractice:Y,onCancel:G,onOpenAiRefine:N}=t,[u,C]=a.useState("READING"),[U,m]=a.useState(!1);a.useEffect(()=>{C(r==="intensity"?"INTENSITY":r==="comparison"?"COMPARISON":"READING")},[r]);const A=a.useMemo(()=>{let l="";return u==="READING"?l=I:u==="LISTENING"?l=f:l=S,ue(l)},[I,f,S,u]);a.useEffect(()=>(window.handleLessonSpeak=l=>pe(l),()=>{delete window.handleLessonSpeak}),[]);const R=()=>O([...v,{softened:[],neutral:[],intensified:[]}]),_=l=>O(v.filter((o,c)=>c!==l)),V=(l,o,c)=>{const s=[...v],d=c.split(/[;,]+/).map(y=>{const L=y.trim();if(!L)return null;const z=L.match(/\[(academic|casual)\]$/i);return z?{word:L.replace(z[0],"").trim(),register:z[1].toLowerCase()}:{word:L}}).filter(y=>y!==null);s[l][o]=d,O(s)},B=l=>l.map(o=>o.register?`${o.word} [${o.register}]`:o.word).join("; "),W=()=>H([...M,{word:"",nuance:"",example:""}]),q=l=>H(M.filter((o,c)=>c!==l)),K=(l,o,c)=>{const s=[...M];s[l]={...s[l],[o]:c},H(s)};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:G,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(Ae,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:Y,disabled:$,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:F,disabled:$,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[$?e.jsx(We,{size:14,className:"animate-spin"}):e.jsx(Ve,{size:14}),e.jsx("span",{children:$?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:g,onChange:l=>E(l.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Le,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:x,onChange:l=>h(l.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 overflow-x-auto no-scrollbar",children:[r==="intensity"&&e.jsxs("button",{onClick:()=>{C("INTENSITY"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${u==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(fe,{size:12,className:"inline mr-1"})," Intensity"]}),r==="comparison"&&e.jsxs("button",{onClick:()=>{C("COMPARISON"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${u==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(je,{size:12,className:"inline mr-1"})," Contrast"]}),e.jsxs("button",{onClick:()=>{C("READING"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${u==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ae,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{C("LISTENING"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${u==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Listening"]}),e.jsxs("button",{onClick:()=>{C("TEST"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${u==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u==="INTENSITY"&&e.jsxs("button",{onClick:()=>N("intensity"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-orange-50 border border-orange-100 hover:bg-orange-100 transition-all text-[10px] font-black uppercase text-orange-600 shadow-sm",children:[e.jsx(ne,{size:12}),e.jsx("span",{children:"AI Refine"})]}),u==="COMPARISON"&&e.jsxs("button",{onClick:()=>N("comparison"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(ne,{size:12}),e.jsx("span",{children:"AI Refine"})]}),(u==="READING"||u==="LISTENING"||u==="TEST")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N(u==="READING"?"reading":u==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(ne,{size:12}),e.jsx("span",{children:"AI Generate"})]}),e.jsxs("button",{onClick:()=>m(!U),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[U?e.jsx(be,{size:12}):e.jsx(Be,{size:12}),e.jsx("span",{children:U?"Edit":"Preview"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[550px] relative overflow-hidden",children:u==="INTENSITY"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Intensity Rows"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Separate multiple words with semicolons. Use [academic] or [casual] tags for register."})]}),e.jsxs("div",{className:"space-y-4",children:[v.map((l,o)=>e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm grid grid-cols-1 md:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-blue-500 uppercase tracking-wider pl-1",children:"Softened"}),e.jsx("textarea",{value:B(l.softened),onChange:c=>V(o,"softened",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"chilly; cool..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Neutral"}),e.jsx("textarea",{value:B(l.neutral),onChange:c=>V(o,"neutral",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"hot; warm..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-orange-500 uppercase tracking-wider pl-1",children:"Intensified"}),e.jsx("textarea",{value:B(l.intensified),onChange:c=>V(o,"intensified",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"scorching; boiling..."})]}),e.jsx("button",{onClick:()=>_(o),className:"p-2 text-neutral-300 hover:text-red-500 mt-5",children:e.jsx(re,{size:16})})]},o)),e.jsxs("button",{onClick:R,className:"w-full py-4 border-2 border-dashed border-neutral-200 rounded-[2rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(he,{size:16})," Add Scale Row"]})]})]}):u==="COMPARISON"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Contrast Pairs"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Break down confusing word pairs with clear nuances and examples."})]}),e.jsxs("div",{className:"space-y-4",children:[M.map((l,o)=>e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-4 animate-in fade-in slide-in-from-top-2 relative group",children:[e.jsx("button",{onClick:()=>q(o),className:"absolute top-4 right-4 p-2 text-neutral-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(re,{size:18})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 md:col-span-1",children:[e.jsx("label",{className:"text-[9px] font-black text-indigo-500 uppercase tracking-wider pl-1",children:"Target Word"}),e.jsx("input",{value:l.word,onChange:c=>K(o,"word",c.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-black focus:bg-white outline-none",placeholder:"e.g. Damage"})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Usage & Nuance"}),e.jsx("input",{value:l.nuance,onChange:c=>K(o,"nuance",c.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-medium focus:bg-white outline-none italic",placeholder:"When and why to use this..."})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Contextual Example"}),e.jsx("textarea",{value:l.example,onChange:c=>K(o,"example",c.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-bold focus:bg-white outline-none resize-none leading-relaxed",placeholder:"Write a clear example sentence..."})]})]},o)),e.jsxs("button",{onClick:W,className:"w-full py-6 border-2 border-dashed border-neutral-200 rounded-[2.5rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2 bg-white/50",children:[e.jsx(he,{size:20})," Add Comparison Pair"]})]})]}):U?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:A}}):e.jsx("textarea",{value:u==="READING"?I:u==="LISTENING"?f:S,onChange:l=>{u==="READING"?T(l.target.value):u==="LISTENING"?k(l.target.value):w(l.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${u.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},Nt=({lesson:t,user:r,onSave:g,onPractice:E,onCancel:b})=>{const[i,x]=a.useState(t.title),[h,I]=a.useState(t.description||""),[T,f]=a.useState(t.path||"/"),[k,S]=a.useState((t.tags||[]).join(", ")),[w,v]=a.useState(t.content),[O,M]=a.useState(t.listeningContent||""),[H,$]=a.useState(t.testContent||""),[F,Y]=a.useState(t.intensityRows||[]),[G,N]=a.useState(t.comparisonRows||[]),[u,C]=a.useState(t.searchKeywords||[]),[U,m]=a.useState(!1),[A,R]=a.useState(null),{showToast:_}=we();a.useEffect(()=>{t.type==="comparison"&&(!t.comparisonRows||t.comparisonRows.length===0)&&t.id.startsWith("lesson-")&&R({format:"comparison"})},[]),a.useEffect(()=>{if(t.path===void 0&&t.tags){const o=t.tags||[],c=o.find(d=>d.startsWith("/")),s=o.filter(d=>!d.startsWith("/"));V(c||"/"),S(s.join(", "))}else f(t.path||"/"),S((t.tags||[]).join(", "))},[t]);const V=o=>f(o),B=()=>{const o=k.split(",").map(s=>s.trim()).filter(Boolean);let c=t.type||"essay";return F.length>0?c="intensity":G.length>0&&(c="comparison"),{...t,title:i,description:h,type:c,path:T.trim(),tags:o,content:w,listeningContent:O,testContent:H,intensityRows:F.length>0?F:void 0,comparisonRows:G.length>0?G:void 0,searchKeywords:u,updatedAt:Date.now()}},W=()=>{m(!0);const o=B();g(o)},q=()=>{m(!0);const o=B();E(o)},K=o=>{var z,J,te;const c=ye(),s=c.audioCoach.activeCoach,d=c.audioCoach.coaches[s].name,y=(A==null?void 0:A.format)||o.format;if(y==="intensity")return ft(F);if(y==="comparison")return bt(G);if(y==="test"){const oe=k.split(",").map(ie=>ie.trim()).filter(Boolean);return Oe(i,w,o.request,oe)}const L=!w&&(t.type==="comparison"||t.type==="intensity"||!t.id.includes("ai"));return Se({task:L?"create_reading":y==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:i,description:h,content:w,type:t.type,intensityRows:F,comparisonRows:G},topic:o.request||o.topic||i,userRequest:o.request,language:o.language||((z=r.lessonPreferences)==null?void 0:z.language)||"English",targetAudience:((J=r.lessonPreferences)==null?void 0:J.targetAudience)||"Adult",tone:o.tone||((te=r.lessonPreferences)==null?void 0:te.tone)||"professional_professor",coachName:d})},l=o=>{const{result:c}=o,s=c||o,d=A==null?void 0:A.format;if(d==="intensity"){const y=Array.isArray(s)?s:s.data;s.title&&x(s.title),s.description&&I(s.description),Array.isArray(y)&&(Y(y),_("Intensity scale refined!","success"))}else if(d==="comparison"){const y=Array.isArray(s)?s:s.data;s.title&&x(s.title),s.description&&I(s.description),Array.isArray(y)&&(N(y),_("Comparison lab updated!","success"))}else d==="listening"?s.content&&(M(s.content),_("Listening script updated!","success")):d==="test"?s.content&&($(s.content),_("Practice test generated!","success")):(s.title&&x(s.title),s.description&&I(s.description),s.content&&v(s.content),s.searchKeywords&&Array.isArray(s.searchKeywords)&&C(s.searchKeywords),!k.trim()&&s.tags&&s.tags.length>0&&S(s.tags.join(", ")),_("Lesson content refined!","success"));R(null)};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{type:t.type||"essay",title:i,setTitle:x,description:h,setDescription:I,path:T,setPath:f,tagsInput:k,setTagsInput:S,content:w,setContent:v,listeningContent:O,setListeningContent:M,testContent:H,setTestContent:$,intensityRows:F,setIntensityRows:Y,comparisonRows:G,setComparisonRows:N,isSaving:U,onSave:W,onPractice:q,onCancel:b,onOpenAiRefine:o=>R({format:o||"reading"})}),A&&e.jsx(Ne,{isOpen:!!A,onClose:()=>R(null),type:"REFINE_UNIT",title:A.format==="intensity"?"Refine Intensity Scale":A.format==="comparison"?"Refine Word Contrast":w?"Refine Lesson":"Generate Lesson",description:A.format==="intensity"?"AI will complete the intensity scale.":A.format==="comparison"?"AI will complete the comparison pairs with nuances.":"Enter instructions for the AI.",initialData:{...r.lessonPreferences,format:A.format},onGeneratePrompt:K,onJsonReceived:l,actionLabel:"Apply Changes"})]})},yt=({register:t})=>{if(!t)return null;const r=t==="academic";return e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[8px] font-black uppercase border ml-1 ${r?"bg-purple-50 text-purple-700 border-purple-100":"bg-sky-50 text-sky-700 border-sky-100"}`,children:t})},de=({item:t})=>e.jsxs("div",{className:"flex items-center gap-1.5 group/item",children:[e.jsx("span",{className:"font-bold text-neutral-800",children:t.word}),e.jsx(yt,{register:t.register}),t.lastResult==="correct"&&e.jsx(Ee,{size:12,className:"text-emerald-500 shrink-0"}),t.lastResult==="incorrect"&&e.jsx(Re,{size:12,className:"text-rose-500 shrink-0"})]}),jt=({rows:t,compact:r=!1})=>!t||t.length===0?null:e.jsx("div",{className:`bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm ${r?"scale-95 origin-top":""}`,children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-blue-500 tracking-[0.2em] w-1/3",children:"Softened"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-1/3",children:"Neutral"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-orange-500 tracking-[0.2em] w-1/3",children:"Intensified"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((g,E)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top bg-blue-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[g.softened.map((b,i)=>e.jsx(de,{item:b},i)),g.softened.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[g.neutral.map((b,i)=>e.jsx(de,{item:b},i)),g.neutral.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top bg-orange-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[g.intensified.map((b,i)=>e.jsx(de,{item:b},i)),g.intensified.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})})]},E))})]})}),St=({rows:t})=>!t||t.length===0?null:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-indigo-600 tracking-[0.2em] w-[25%]",children:"Word"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[35%]",children:"Nuance"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[40%]",children:"Example"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((r,g)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-neutral-900 text-sm",children:r.word}),r.lastResult==="correct"&&e.jsx(Ee,{size:14,className:"text-emerald-500 shrink-0"}),r.lastResult==="incorrect"&&e.jsx(Re,{size:14,className:"text-rose-500 shrink-0"})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsx("p",{className:"text-xs text-neutral-600 font-medium italic leading-relaxed",children:r.nuance||"-"})}),e.jsx("td",{className:"px-6 py-4 align-top bg-neutral-50/20",children:e.jsx("p",{className:"text-xs text-neutral-800 leading-relaxed font-medium",children:r.example||"-"})})]},g))})]})}),vt=t=>{if(!t)return[];const r=t.split(`
`),g=[];let E="Introduction",b=[];const i=()=>{(b.length>0||g.length===0&&E==="Introduction")&&(b.join(`
`).trim()||g.length>0)&&g.push({title:E,content:b.join(`
`)})};return r.forEach(x=>{const h=x.trim().match(/^(#{1,3})\s+(.+)/);h?(i(),E=h[2].trim(),b=[x]):b.push(x)}),i(),g.length>1&&g[0].title==="Introduction"&&!g[0].content.trim()&&g.shift(),g.length>0?g:[{title:"Lesson",content:t}]},Ct=({lesson:t,onComplete:r,onEdit:g,onAddSound:E,onAddTest:b})=>{const[i,x]=a.useState("READING"),[h,I]=a.useState("SCROLL"),[T,f]=a.useState(0),[k,S]=a.useState("IDLE"),[w,v]=a.useState(-1),[O,M]=a.useState(!1),[H,$]=a.useState(0),[F,Y]=a.useState(!1),G=a.useRef(null),N=a.useRef(!1),u=a.useRef(new Map),C=a.useRef(new Map);a.useEffect(()=>{t.type==="intensity"&&t.intensityRows&&t.intensityRows.length>0?x("INTENSITY"):t.type==="comparison"&&t.comparisonRows&&t.comparisonRows.length>0&&x("COMPARISON")},[t]);const U=a.useMemo(()=>i==="READING"?t.content||"":i==="LISTENING"?t.listeningContent||"":t.testContent||"",[t,i]),m=a.useMemo(()=>vt(U),[U]);a.useEffect(()=>{f(0)},[i]),a.useEffect(()=>{const s=d=>{G.current&&!G.current.contains(d.target)&&Y(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const A=a.useMemo(()=>{if(h==="SCROLL")return ue(U);{const s=m[T]||m[0];return ue((s==null?void 0:s.content)||"")}},[U,h,m,T]),R=a.useMemo(()=>{if(!t.listeningContent)return[];const s=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,d=[];let y;for(;(y=s.exec(t.listeningContent))!==null;)d.push({lang:y[1].toUpperCase()==="VN"?"vi":"en",text:y[2].replace(/\[.*?\]/g,"").trim()});return d},[t.listeningContent]),_=s=>{if(u.current.has(s))return Promise.resolve(u.current.get(s));if(C.current.has(s))return C.current.get(s);const d=R[s],y=Qe(d.text,d.lang).then(L=>(L&&(u.current.set(s,L),$(z=>z+1)),L));return C.current.set(s,y),y},V=async s=>{for(let d=s;d<R.length&&!N.current;d++)await _(d)},B=async()=>{k==="PAUSED"?(S("PLAYING"),N.current=!1):(N.current=!1,S("PLAYING"),V(0));const s=w===-1?0:w;for(let d=s;d<R.length&&!N.current;d++){v(d);const y=R[d];let L=u.current.get(d);if(L||(M(!0),L=await _(d),M(!1)),N.current)break;try{await pe(y.text,!0,y.lang,void 0,void 0,L||void 0)}catch(z){console.error("Speech playback error at index",d,z)}}N.current||(S("IDLE"),v(-1),$(0),u.current.clear(),C.current.clear())},W=()=>{N.current=!0,ve(),S("IDLE"),v(-1),$(0),u.current.clear(),C.current.clear(),M(!1)};a.useEffect(()=>(window.handleLessonSpeak=s=>{pe(s)},()=>{W(),delete window.handleLessonSpeak}),[]);const q=!!t.listeningContent,K=!!t.testContent,l=!!(t.intensityRows&&t.intensityRows.length>0),o=!!(t.comparisonRows&&t.comparisonRows.length>0),c=(l?1:0)+(o?1:0)+1+(q?1:0)+(K?1:0);return a.useEffect(()=>{h==="PAGED"&&window.scrollTo({top:0,behavior:"smooth"})},[T,h]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300 relative min-h-screen",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("button",{onClick:r,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(Ae,{size:14}),e.jsx("span",{children:"Back to Library"})]}),m.length>1&&i!=="INTENSITY"&&i!=="COMPARISON"&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>I("SCROLL"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${h==="SCROLL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Scroll View",children:[e.jsx(gt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Scroll"})]}),e.jsxs("button",{onClick:()=>I("PAGED"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${h==="PAGED"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Chapter View",children:[e.jsx(mt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Paged"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:t.title}),c>1&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[l&&e.jsxs("button",{onClick:()=>x("INTENSITY"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(fe,{size:12,className:"inline mr-1"})," Scale"]}),o&&e.jsxs("button",{onClick:()=>x("COMPARISON"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(je,{size:12,className:"inline mr-1"})," Contrast"]}),e.jsxs("button",{onClick:()=>x("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ae,{size:12,className:"inline mr-1"})," Read"]}),q&&e.jsxs("button",{onClick:()=>x("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Listen"]}),K&&e.jsxs("button",{onClick:()=>x("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${i==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i==="LISTENING"&&q&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[k==="PLAYING"?e.jsx("button",{onClick:()=>{S("PAUSED"),ve(),N.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(Ke,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:B,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(He,{size:20,fill:"currentColor"})}),k!=="IDLE"&&e.jsx("button",{onClick:W,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(qe,{size:20,fill:"currentColor"})})]}),e.jsx("button",{onClick:g,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(be,{size:20})})]})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px] relative",children:i==="INTENSITY"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Intensity Scale"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Analyze how word choices change based on emphasis and context."})]}),e.jsx(jt,{rows:t.intensityRows||[]})]}):i==="COMPARISON"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Word Contrast"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Deep dive into the nuances of confusing or similar vocabulary."})]}),e.jsx(St,{rows:t.comparisonRows||[]})]}):i==="TEST"&&!t.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(xe,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available."})]}):i==="LISTENING"&&!t.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(me,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:A}})}),h==="PAGED"&&i!=="INTENSITY"&&i!=="COMPARISON"&&m.length>1&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-neutral-200 flex items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsx("button",{onClick:()=>f(Math.max(0,T-1)),disabled:T===0,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(pt,{size:18})}),e.jsxs("div",{className:"relative px-2",ref:G,children:[e.jsxs("button",{onClick:()=>Y(!F),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-2 py-1 transition-colors",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Chapter"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-sm text-neutral-900 max-w-[120px] truncate",children:m[T].title}),e.jsx(Je,{size:12,className:"text-neutral-400"})]})]}),F&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-56 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-bottom",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:m.map((s,d)=>e.jsx("button",{onClick:()=>{f(d),Y(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${d===T?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:s.title},d))})})]}),e.jsx("button",{onClick:()=>f(Math.min(m.length-1,T+1)),disabled:T===m.length-1,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(Xe,{size:18})})]})]})},Tt=({user:t,lesson:r,onComplete:g,onEdit:E,onUpdate:b})=>{const[i,x]=a.useState(null),{showToast:h}=we(),I=f=>{var w,v,O;const k=ye(),S=k.audioCoach.coaches[k.audioCoach.activeCoach].name;return f.format==="test"||i==="test"?Oe(r.title,r.content,f.request,r.tags):Se({task:"convert_to_listening",currentLesson:{title:r.title,description:r.description,content:r.content},userRequest:f.request,language:f.language||((w=t.lessonPreferences)==null?void 0:w.language)||"English",targetAudience:((v=t.lessonPreferences)==null?void 0:v.targetAudience)||"Adult",tone:f.tone||((O=t.lessonPreferences)==null?void 0:O.tone)||"professional_professor",coachName:S})},T=async f=>{const k=f.result||f,S=f.format||i,w={...r,updatedAt:Date.now()};S==="listening"?(w.listeningContent=k.content,h("Audio script added successfully!","success")):(w.testContent=k.content,h("Practice test added successfully!","success")),await ee(w),b&&b(w),x(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{lesson:r,onComplete:g,onEdit:E,onAddSound:()=>x("listening"),onAddTest:()=>x("test")}),i&&e.jsx(Ne,{isOpen:!!i,onClose:()=>x(null),type:"GENERATE_AUDIO_SCRIPT",title:i==="listening"?"Add Lesson Sound":"Add Practice Test",description:i==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...t.lessonPreferences,format:i},onGeneratePrompt:I,onJsonReceived:T,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},kt={filterSchema:[],viewSchema:[]},ke="vocab_pro_lesson_view_settings",Ut=({user:t,onStartSession:r,onNavigate:g,onUpdateUser:E,initialLessonId:b,onConsumeLessonId:i,initialTag:x,onConsumeTag:h})=>{const[I,T]=a.useState([]),[f,k]=a.useState([]),[S,w]=a.useState(!0),[v,O]=a.useState(null),[M,H]=a.useState(!1),[$,F]=a.useState(!1),[Y,G]=a.useState(""),[N,u]=a.useState("ALL"),[C,U]=a.useState("all"),[m,A]=a.useState("all"),[R,_]=a.useState(()=>Ze(ke,{showDesc:!0,compact:!1})),[V,B]=a.useState(0),[W,q]=a.useState(12),[K,l]=a.useState("list"),[o,c]=a.useState(null),[s,d]=a.useState(null),[y,L]=a.useState(!1),{showToast:z}=we();a.useEffect(()=>{et(ke,R)},[R]);const J=a.useCallback(async()=>{w(!0);try{const[n,p]=await Promise.all([tt(t.id),st()]),P=[...n.map(j=>{let D="ESSAY";return j.type==="intensity"&&(D="INTENSITY"),j.type==="comparison"&&(D="COMPARISON"),{type:D,data:j,path:j.path,tags:j.tags,date:j.createdAt}})];T(P.sort((j,D)=>D.date-j.date)),k(p)}finally{w(!1)}},[t.id]);a.useEffect(()=>{J()},[J]),a.useEffect(()=>{if(b&&I.length>0){const n=I.find(p=>p.data.id===b);n&&(c(n.data),l("read_lesson"),i==null||i())}},[b,I,i]),a.useEffect(()=>{x&&(O(x),h==null||h())},[x,h]),a.useEffect(()=>{B(0)},[v,Y,N,C,m,W]);const te=a.useCallback(()=>{O(null),u("ALL"),U("all"),A("all")},[]),oe=n=>{G(n),n.trim()&&te()},ie=a.useMemo(()=>N!=="ALL"||C!=="all"||m!=="all",[N,C,m]),Z=a.useMemo(()=>{const n=Y.toLowerCase().trim();return I.filter(p=>{var P,j;if(n){const D=(p.data.title||"").toLowerCase().includes(n),se=(p.data.description||"").toLowerCase().includes(n),Q=(p.data.searchKeywords||[]).some(ce=>(ce||"").toLowerCase().includes(n)),X=(p.data.tags||[]).some(ce=>(ce||"").toLowerCase().includes(n));return!(!D&&!se&&!Q&&!X)}if(N!=="ALL"&&p.type!==N||C==="focused"&&!p.data.isFocused||m!=="all"&&p.data.focusColor!==m)return!1;if(v){if(v==="Uncategorized"){const D=p.path??(p.tags||[]).find(Q=>Q.startsWith("/"));if(D&&D!=="/")return!1}else if(!((P=p.path)!=null&&P.startsWith(v))&&!((j=p.tags)!=null&&j.includes(v)))return!1}return!0})},[I,v,Y,N,C,m]),De=a.useMemo(()=>{const n=V*W;return Z.slice(n,n+W)},[Z,V,W]),Pe=async()=>{s&&(await it(s.id),z("Lesson deleted.","success"),d(null),J())},Me=async n=>{await ee(n),z("Lesson saved!","success"),l("list"),c(null),J()},le=(n="essay")=>{const p={id:`lesson-${Date.now()}`,userId:t.id,topic1:"General",topic2:"General",type:n,title:n==="intensity"?"New Intensity Scale":n==="comparison"?"New Comparison Lab":"New Lesson",description:"",content:"",tags:[],intensityRows:n==="intensity"?[{softened:[],neutral:[],intensified:[]}]:void 0,comparisonRows:n==="comparison"?[{word:"",nuance:"",example:""}]:void 0,createdAt:Date.now(),updatedAt:Date.now()};c(p),l("edit_lesson")},ze=async n=>{const{result:p,preferences:P}=n;JSON.stringify(t.lessonPreferences)!==JSON.stringify(P)&&await E({...t,lessonPreferences:P});const j={id:`lesson-ai-${Date.now()}`,userId:t.id,title:p.title,description:p.description,content:p.content,tags:p.tags||[],searchKeywords:p.searchKeywords||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"General",topic2:"General"};await ee(j),z("Lesson created with AI!","success"),L(!1),c(j),l("read_lesson"),J()},Ge=async(n,p)=>{const P={...n.data,focusColor:p||void 0,updatedAt:Date.now()};p||delete P.focusColor,await ee(P),T(j=>j.map(D=>D.data.id===n.data.id?{...D,data:{...D.data,focusColor:p||void 0,updatedAt:Date.now()}}:D))},Ue=async n=>{const p={...n.data,isFocused:!n.data.isFocused,updatedAt:Date.now()};await ee(p),T(P=>P.map(j=>j.data.id===n.data.id?{...j,data:{...j.data,isFocused:!j.data.isFocused,updatedAt:Date.now()}}:j))},$e=()=>{T(n=>[...n].sort(()=>Math.random()-.5)),z("Deck shuffled!","success")},Fe=[{label:"Topic Lesson (AI)",icon:ne,onClick:()=>L(!0)},{label:"Intensity Scale",icon:fe,onClick:()=>le("intensity")},{label:"Comparison Lab",icon:je,onClick:()=>le("comparison")},{label:"New Lesson (Manual)",icon:he,onClick:()=>le("essay")}],Ye=n=>{const p=ye(),P=p.audioCoach.activeCoach,j=p.audioCoach.coaches[P].name;return Se({topic:n.topic,language:n.language,targetAudience:n.targetAudience,tone:n.tone,format:n.format,coachName:j,task:"create_reading"})};if(K==="read_lesson"&&o)return e.jsx(Tt,{user:t,lesson:o,onComplete:()=>l("list"),onEdit:()=>l("edit_lesson"),onUpdate:n=>c(n)});if(K==="edit_lesson"&&o)return e.jsx(Nt,{lesson:o,user:t,onSave:Me,onPractice:n=>{c(n),l("read_lesson")},onCancel:()=>l("list")});const _e=()=>e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[M&&e.jsx(dt,{items:I.map(n=>n.data),selectedTag:v,onSelectTag:O,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Le,{size:16})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:flex-1 max-w-sm",children:[e.jsx(ot,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:Y,onChange:n=>oe(n.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-xs font-bold focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto w-full sm:w-auto pb-2 sm:pb-0 no-scrollbar",children:[e.jsxs("button",{onClick:()=>u("ALL"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="ALL"?"bg-neutral-900 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-neutral-900"}`,children:[e.jsx(ht,{size:12})," All"]}),e.jsxs("button",{onClick:()=>u("ESSAY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="ESSAY"?"bg-emerald-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-emerald-600"}`,children:[e.jsx(ae,{size:12})," Lesson"]}),e.jsxs("button",{onClick:()=>u("INTENSITY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="INTENSITY"?"bg-orange-500 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-orange-500"}`,children:[e.jsx(Ce,{size:12})," Scale"]}),e.jsxs("button",{onClick:()=>u("COMPARISON"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${N==="COMPARISON"?"bg-indigo-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-indigo-600"}`,children:[e.jsx(Te,{size:12})," Diff"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(lt,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),pagination:{page:V,totalPages:Math.ceil(Z.length/W),onPageChange:B,pageSize:W,onPageSizeChange:q,totalItems:Z.length},aboveGrid:e.jsx(_e,{}),config:kt,activeFilters:{},onFilterChange:()=>{},isLoading:S,isEmpty:Z.length===0,emptyMessage:"No items found matching your criteria.",actions:e.jsx(ct,{viewMenu:e.jsx(xt,{isOpen:$,setIsOpen:F,hasActiveFilters:ie,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(at,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>U(C==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${C==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:C==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>A(m==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>A(m==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>A(m==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:R.showDesc,onChange:()=>_(n=>({...n,showDesc:!n.showDesc}))},{label:"Compact",checked:R.compact,onChange:()=>_(n=>({...n,compact:!n.compact}))}]}),browseTags:{isOpen:M,onToggle:()=>{H(!M)}},addActions:Fe,extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:$e,disabled:Z.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Shuffle Deck",children:e.jsx(nt,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:De.map(n=>{const p=()=>{c(n.data),l("read_lesson")},P=()=>{c(n.data),l("edit_lesson")},j=()=>d(n.data),D=n.type==="INTENSITY",se=n.type==="COMPARISON";let Q;return D?Q={label:"Scale",colorClass:"bg-orange-50 text-orange-700 border-orange-100",icon:Ce}:se?Q={label:"Diff",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:Te}:Q={label:"Lesson",colorClass:"bg-emerald-50 text-emerald-700 border-emerald-100",icon:ae},e.jsx(ut,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:n.data.title}),tags:n.data.tags,badge:Q,compact:R.compact,onClick:p,focusColor:n.data.focusColor,onFocusChange:X=>Ge(n,X),isFocused:n.data.isFocused,onToggleFocus:()=>Ue(n),isCompleted:n.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:X=>{X.stopPropagation(),p()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(Ie,{size:14})}),e.jsx("button",{onClick:X=>{X.stopPropagation(),P()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(be,{size:14})}),e.jsx("button",{onClick:X=>{X.stopPropagation(),j()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(re,{size:14})})]}),children:R.showDesc&&n.data.description&&e.jsx("p",{className:"line-clamp-3 mt-1",children:n.data.description})},`${n.type}-${n.data.id}`)})})}),e.jsx(rt,{isOpen:!!s,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:Pe,onClose:()=>d(null),icon:e.jsx(re,{size:40,className:"text-red-500"})}),e.jsx(Ne,{isOpen:y,onClose:()=>L(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:t.lessonPreferences,onGeneratePrompt:Ye,onJsonReceived:ze,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{Ut as LessonLibraryV2,Ut as default};
