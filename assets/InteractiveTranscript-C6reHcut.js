import{c as K,r as x,j as e,V as Y,bY as B,E as te}from"./index-CVuXFKiQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=K("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),se=({isOpen:o,onClose:b,onConfirm:f,audioFiles:m,initialData:p})=>{const[z,C]=x.useState(""),[$,v]=x.useState(""),[M,w]=x.useState("");if(x.useEffect(()=>{if(o)if(p){const d=p.filename&&m.includes(p.filename)?p.filename:p.filename||(m.length>0?m[0]:"");C(d),v(p.start||""),w(p.duration||"")}else C(m.length>0?m[0]:""),v(""),w("")},[o,m,p]),!o)return null;const A=d=>{d.preventDefault(),f({filename:z,start:$.trim(),duration:M.trim()})},L=d=>decodeURIComponent(d.split("/").pop()||"");return e.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-2xl border border-neutral-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-black text-neutral-900 mb-4 flex items-center gap-2",children:[p?e.jsx(F,{size:20,className:"text-indigo-600"}):e.jsx(Y,{size:20,className:"text-indigo-600"}),p?"Edit Audio Settings":"Mark Audio Segment"]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Source Audio (Optional)"}),e.jsxs("select",{value:z,onChange:d=>C(d.target.value),className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none",children:[e.jsx("option",{value:"",children:"None (Use Text-to-Speech)"}),m.map((d,R)=>e.jsx("option",{value:d,children:L(d)},R))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Start (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:$,onChange:d=>v(d.target.value),placeholder:"e.g. 5.5",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Duration (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:M,onChange:d=>w(d.target.value),placeholder:"e.g. 10",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-neutral-500 font-bold text-xs hover:bg-neutral-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-neutral-900 text-white font-bold text-xs rounded-lg hover:bg-neutral-800 transition-colors",children:"Apply"})]})]})]})})},le=({text:o})=>{const b=o.split(/({.*?}|\[.*?\]\(.*?\)|\[.*?\])/g);return e.jsx("span",{className:"leading-relaxed",children:b.map((f,m)=>f.startsWith("{")&&f.endsWith("}")?e.jsx("span",{className:"text-red-600 font-bold mx-0.5",children:f.slice(1,-1)},m):e.jsx("span",{children:f},m))})},oe=({rawText:o,onUpdate:b,readOnly:f=!1,showDash:m=!0,audioLinks:p=[],onPlaySegment:z,fontSize:C="text-lg",compact:$=!1})=>{const[v,M]=x.useState(!1),[w,A]=x.useState(o);x.useEffect(()=>{A(o)},[o]);const L=()=>{b(w),M(!1)},d=()=>{A(o),M(!1)},R=x.useRef(null),[i,g]=x.useState(null),[q,E]=x.useState(!1),[G,k]=x.useState(null),[y,H]=x.useState(null),j=x.useRef(null),N=x.useMemo(()=>{const n=[],l=/({[\s\S]*?}|\[[\s\S]*?\]\([\s\S]*?\)|\[[\s\S]*?\])/g;let s,a=0;for(;(s=l.exec(o))!==null;){s.index>a&&n.push({text:o.slice(a,s.index),type:"text",start:a,end:s.index});let r="text",t=s[0];if(s[0].startsWith("{"))r="highlight",t=s[0].slice(1,-1);else if(s[0].startsWith("["))if(r="audio",s[0].includes("](")){const c=s[0].match(/^\[(.*?)\]/);t=c?c[1]:"error"}else t=s[0].slice(1,-1);n.push({text:s[0],type:r,start:s.index,end:l.lastIndex,displayContent:t}),a=l.lastIndex}return a<o.length&&n.push({text:o.slice(a),type:"text",start:a,end:o.length}),n},[o]),J=()=>{var n;g(null),(n=window.getSelection())==null||n.removeAllRanges(),M(!0)},O=()=>{if(f||v)return;const n=window.getSelection(),l=r=>{if(!r)return null;let t=r.nodeType===3?r.parentElement:r;for(;t&&t!==R.current&&!t.hasAttribute("data-index");)t=t.parentElement;return t&&t.hasAttribute("data-index")?parseInt(t.getAttribute("data-index"),10):null};if(!n||!n.anchorNode||!n.focusNode||n.isCollapsed){g(null);return}const s=l(n.anchorNode),a=l(n.focusNode);if(s===null||a===null){g(null);return}if(s===a&&N[s].type==="text"){let r=n.anchorOffset,t=n.focusOffset;r>t&&([r,t]=[t,r]),g({start:N[s].start+r,end:N[s].start+t,currentType:"text"})}else{const r=Math.min(s,a),t=Math.max(s,a);let c=!1;for(let u=r;u<=t;u++)N[u].type==="audio"&&(c=!0);g(c?null:{start:N[r].start,end:N[t].end,currentType:"text"})}},D=n=>{var a,r;if(!i)return;const{start:l,end:s}=i;if(n==="audio"){k(null),E(!0);return}if(n==="clear"){const t=o.slice(0,l),c=o.slice(l,s);let u=c;c.startsWith("{")?u=c.slice(1,-1):c.startsWith("[")&&(c.includes("](")?u=((a=c.match(/^\[(.*?)\]/))==null?void 0:a[1])||"":u=c.slice(1,-1));const S=o.slice(s);b(t+u+S)}else{const t=o.slice(0,l),c=o.slice(l,s),u=o.slice(s);b(`${t}{${c}}${u}`)}g(null),(r=window.getSelection())==null||r.removeAllRanges()},Q=()=>{if(!i||i.currentType!=="audio")return;const l=o.slice(i.start,i.end).match(/\((.*?)\)$/);if(l){const s=l[1].split("|");k({filename:s[0]||"",start:s[1]||"",duration:s[2]||""})}else k(null);E(!0)},X=n=>{var V;if(!i)return;const{start:l,end:s,currentType:a}=i,r=o.slice(0,l);let t=o.slice(l,s);if(a==="audio"){const h=t.match(/^\[(.*?)\]/);h?t=h[1]:t=t.replace(/^\[/,"").replace(/\](\(.*?\))?$/,"")}const c=o.slice(s);let u=`[${t}]`;const S=n.filename,I=n.start,W=n.duration;if(S||I||W){const h=[];for(S?h.push(S):h.push(""),I?h.push(I):W&&h.push(""),W&&h.push(W);h.length>0&&!h[h.length-1];)h.pop();h.length>0&&(u+=`(${h.join("|")})`)}b(`${r}${u}${c}`),E(!1),k(null),g(null),(V=window.getSelection())==null||V.removeAllRanges()},Z=(n,l)=>{var a;if(n.stopPropagation(),l.text.includes("](")){const r=l.text.match(/\((.*?)\)$/);if(r){const t=r[1].split("|"),c=t[0]?t[0]:void 0,u=t[1]?parseFloat(t[1]):void 0,S=t[2]?parseFloat(t[2]):void 0,I=((a=l.displayContent)==null?void 0:a.replace(/[{}]/g,""))||"";z(c,u,S,I);return}}const s=(l.displayContent||l.text.slice(1,-1)).replace(/[{}]/g,"");te(s)},P=(n,l,s)=>{if(f||s==="text")return;j.current&&(clearTimeout(j.current),j.current=null);const a=n.currentTarget.getBoundingClientRect();H(r=>(r==null?void 0:r.idx)===l?r:{idx:l,rect:a,type:s})},T=()=>{f||(j.current=setTimeout(()=>{H(null)},600))},_=()=>{j.current&&(clearTimeout(j.current),j.current=null)},ee=()=>{j.current=setTimeout(()=>{H(null)},600)},U=n=>{var a;if(!y)return;const l=N[y.idx],s={start:l.start,end:l.end,currentType:l.type};if(g(s),H(null),n==="unmark"){const r=o.slice(0,l.start);let t=l.text;t.startsWith("{")?t=t.slice(1,-1):t.startsWith("[")&&(t.includes("](")?t=((a=t.match(/^\[(.*?)\]/))==null?void 0:a[1])||"":t=t.slice(1,-1));const c=o.slice(l.end);b(r+t+c),g(null)}else if(n==="edit"){const r=l.text.match(/\((.*?)\)$/);if(r){const t=r[1].split("|");k({filename:t[0]||"",start:t[1]||"",duration:t[2]||""})}else k(null);E(!0)}};return e.jsxs("div",{className:"relative h-full flex flex-col group",children:[!f&&e.jsx("div",{className:`absolute top-4 right-6 z-10 flex items-center gap-2 transition-opacity duration-200 ${v?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"px-4 py-2 text-xs font-bold text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:d,className:"px-4 py-2 text-xs font-bold text-neutral-700 bg-neutral-200 rounded-lg hover:bg-neutral-300 transition-colors",children:"Cancel"})]}):e.jsx("button",{onClick:J,className:"px-4 py-2 text-xs font-bold text-neutral-700 bg-neutral-100 rounded-lg hover:bg-neutral-200 transition-colors border border-neutral-200 shadow-sm",children:"Edit"})}),e.jsx(se,{isOpen:q,onClose:()=>{E(!1),k(null),g(null)},onConfirm:X,audioFiles:p,initialData:G}),e.jsxs("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible gap-2",children:[(i==null?void 0:i.currentType)==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.preventDefault(),D("highlight")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-neutral-900 text-white shadow-neutral-200 hover:scale-105 active:scale-95",children:[e.jsx(ne,{size:14}),e.jsx("span",{children:"Highlight"})]}),e.jsxs("button",{onClick:n=>{n.preventDefault(),D("audio")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-indigo-600 text-white shadow-indigo-200 hover:scale-105 active:scale-95",children:[e.jsx(Y,{size:14}),e.jsx("span",{children:"Mark Audio"})]})]}),(i==null?void 0:i.currentType)!=="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.preventDefault(),D("clear")},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-rose-600 shadow-rose-100 hover:bg-rose-50 ${i?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(B,{size:14}),e.jsx("span",{children:(i==null?void 0:i.currentType)==="highlight"?"Unhighlight":"Unmark Audio"})]}),(i==null?void 0:i.currentType)==="audio"&&e.jsxs("button",{onClick:n=>{n.preventDefault(),Q()},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-indigo-600 shadow-indigo-100 hover:bg-indigo-50 ${i?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(F,{size:14}),e.jsx("span",{children:"Edit Audio"})]})]})]}),y&&e.jsxs("div",{className:"fixed z-[60] flex items-center gap-1 p-1 bg-neutral-900 rounded-lg shadow-xl animate-in fade-in zoom-in-95",style:{top:y.rect.top-40,left:y.rect.left+y.rect.width/2-(y.type==="audio"?60:35)},onMouseEnter:_,onMouseLeave:ee,children:[y.type==="audio"&&e.jsx("button",{onClick:()=>U("edit"),className:"p-2 text-white hover:bg-white/20 rounded-md transition-colors",title:"Edit",children:e.jsx(F,{size:14})}),e.jsx("button",{onClick:()=>U("unmark"),className:"p-2 text-rose-400 hover:bg-white/20 rounded-md transition-colors",title:"Unmark",children:e.jsx(B,{size:14})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-neutral-900"})]}),v?e.jsx("textarea",{value:w,onChange:n=>A(n.target.value),className:`flex-1 w-full font-mono bg-neutral-50 border-0 focus:ring-0 resize-none ${$?"p-4":"p-6"} ${C}`}):e.jsx("div",{ref:R,className:`font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap select-text cursor-text font-mono ${$?"px-4 py-4":"px-6 pb-8 pt-8"} ${C}`,onMouseUp:O,onKeyUp:O,children:N.map((n,l)=>n.type==="highlight"?e.jsx("span",{"data-index":l,onMouseEnter:s=>P(s,l,"highlight"),onMouseLeave:T,className:"text-red-600 font-bold cursor-pointer hover:bg-red-50 transition-colors rounded mx-0.5 border border-transparent hover:border-red-100",children:n.displayContent},`${l}-${n.start}`):n.type==="audio"?e.jsx("span",{"data-index":l,onClick:s=>Z(s,n),onMouseEnter:s=>P(s,l,"audio"),onMouseLeave:T,className:"text-indigo-900 cursor-pointer hover:bg-indigo-100 transition-colors mx-0.5 relative group/audio py-0.5 rounded",title:"Click to listen",children:e.jsx(le,{text:n.displayContent||"error"})},`${l}-${n.start}`):e.jsx("span",{"data-index":l,children:n.text},`${l}-${n.start}`))})]})};export{oe as I};
