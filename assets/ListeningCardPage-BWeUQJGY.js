import{r as n,o as Ge,A as Ue,K as Ve,j as e,G as _e,a9 as P,y as ue,ab as he,av as We,as as He,P as Ke,l as Je,ac as qe,J as Xe,bA as Ye,bB as Qe,bC as E,D as Ze,bD as De,bE as R,X as et,a1 as tt,bF as st}from"./index-eAsI8bDC.js";import{R as ot,a as nt}from"./ResourceActions-D6JegpTD.js";import{u as lt,G as at,U as rt,a as it,V as ct}from"./useShelfLogic-BbwX6805.js";import{U as dt}from"./UniversalCard-BnKTz8Ht.js";import{T as xe,F as ut}from"./TagBrowser-DOlPWT2B.js";import{F as ht,M as xt,A as mt,R as gt}from"./ShelfModals-CGLqutGd.js";import{E as te}from"./ear-DSsZjjdY.js";import{M as pt}from"./move-pqdxeZwq.js";import{P as ft}from"./pen-DzuDTQjl.js";import{L as bt}from"./library-A7__Ov6X.js";import"./search-CAhr0Iop.js";import"./chevron-left-Cu_5X9vm.js";import"./circle-6LYOfgkf.js";import"./palette-Cko3wbde.js";import"./square-check-big-CqXQxDVB.js";const me="vocab_pro_listening_view",wt=({text:h})=>{const u=h.split(/({.*?})/g);return e.jsx("span",{children:u.map((x,l)=>x.startsWith("{")&&x.endsWith("}")?e.jsx("span",{className:"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200",children:x.slice(1,-1)},l):e.jsx("span",{children:x},l))})},jt=({isOpen:h,onClose:u,onSave:x,initialData:l})=>{const[p,A]=n.useState(""),[C,L]=n.useState(""),[N,d]=n.useState("/"),[y,M]=n.useState("");n.useEffect(()=>{var r;if(h)if(A((l==null?void 0:l.text)||""),L((l==null?void 0:l.note)||""),(l==null?void 0:l.path)===void 0){const c=(l==null?void 0:l.tags)||[],f=c.find(j=>j.startsWith("/")),w=c.filter(j=>!j.startsWith("/"));d(f||"/"),M(w.join(", "))}else d((l==null?void 0:l.path)||"/"),M(((r=l==null?void 0:l.tags)==null?void 0:r.join(", "))||"")},[h,l]);const $=r=>{if(r.preventDefault(),p.trim()){const c=y.split(",").map(f=>f.trim()).filter(Boolean);x(p.trim(),C.trim(),N.trim(),c)}},m=()=>{const r=document.getElementById("listening-text-input");if(!r)return;const c=r.selectionStart,f=r.selectionEnd,w=p.substring(c,f);if(w){const j=p.substring(0,c)+`{${w}}`+p.substring(f);A(j)}};return h?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:$,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:l?"Edit Phrase":"New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text you find hard to hear."})]}),e.jsx("button",{type:"button",onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(et,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500",children:["Text content",e.jsx("span",{className:"font-normal text-[10px] ml-2 text-neutral-400",children:"(Select text & click Highlight)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"listening-text-input",value:p,onChange:r=>A(r.target.value),placeholder:"e.g. I {wanna} go to the store.",rows:4,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0,autoFocus:!0}),e.jsx("button",{type:"button",onClick:m,className:"absolute bottom-3 right-3 px-3 py-1.5 bg-red-100 text-red-600 rounded-lg text-[10px] font-black uppercase tracking-wider hover:bg-red-200 transition-colors",children:"Highlight Selection"})]}),e.jsxs("p",{className:"text-[10px] text-neutral-400 italic",children:["Tip: Use ",e.jsx("strong",{children:"{curly braces}"})," to mark the difficult parts."]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:C,onChange:r=>L(r.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags (Keywords)"}),e.jsx("input",{value:y,onChange:r=>M(r.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(tt,{size:14})," Save Item"]})})]})}):null},zt=({user:h})=>{var ce;const[u,x]=n.useState([]),[l,p]=n.useState([]),[A,C]=n.useState(!0),[L,N]=n.useState("LIST"),[d,y]=n.useState(null),[M,$]=n.useState(!1),[m,r]=n.useState(()=>Ge(me,{showNote:!0,compact:!1,showType:!0})),[c,f]=n.useState(null),[w,j]=n.useState(!1),[G,se]=n.useState(!1),[T,ge]=n.useState("all"),[g,U]=n.useState("all"),[V,oe]=n.useState(0),[I,pe]=n.useState(12),{currentShelfName:_,booksOnCurrentShelf:W,allShelves:H,addShelf:fe,renameShelf:be,removeShelf:we,nextShelf:je,prevShelf:ve}=lt(l,"listening_books_shelves"),[Se,K]=n.useState(!1),[ke,J]=n.useState(!1),[b,q]=n.useState(null);n.useEffect(()=>{Ue(me,m)},[m]);const[Ne,z]=n.useState(!1),[X,ne]=n.useState(null),[Y,Q]=n.useState(null),[B,Z]=n.useState(null),{showToast:v}=Ve(),S=async()=>{C(!0);const[t,s]=await Promise.all([Ye(h.id),Qe(h.id)]);x(t.sort((o,a)=>a.createdAt-o.createdAt)),p(s.sort((o,a)=>a.createdAt-o.createdAt)),C(!1)};n.useEffect(()=>{S()},[h.id]),n.useEffect(()=>{oe(0)},[c,I,T,g]);const O=n.useMemo(()=>{let t=u;return T==="focused"&&(t=t.filter(s=>s.isFocused)),g!=="all"&&(t=t.filter(s=>s.focusColor===g)),c&&(c==="Uncategorized"?t=t.filter(s=>{const o=s.path??(s.tags||[]).find(i=>i.startsWith("/"));return!(o&&o!=="/")}):t=t.filter(s=>{var o,a;return((o=s.path)==null?void 0:o.startsWith(c))||((a=s.tags)==null?void 0:a.includes(c))})),t},[u,c,T,g]),ye=n.useMemo(()=>{const t=V*I;return O.slice(t,t+I)},[O,V,I]),Ce=()=>{ne(null),z(!0)},le=t=>{ne(t),z(!0)},Te=async()=>{Y&&(await st(Y.id),Q(null),v("Deleted item.","success"),S())},Ie=async(t,s,o,a)=>{try{const i=Date.now();if(X){const k={...X,text:t,note:s,path:o,tags:a,updatedAt:i};await R(k),v("Item updated!","success")}else{const k={id:`lst-${i}-${Math.random()}`,userId:h.id,text:t,note:s,path:o,tags:a,createdAt:i,updatedAt:i};await R(k),v("Item added!","success")}z(!1),S()}catch{v("Failed to save item.","error")}},D=t=>{const s=t.replace(/[{}]/g,"");Ze(s)},Be=()=>{x(t=>[...t].sort(()=>Math.random()-.5)),v("Shuffled!","success")},ae=async(t,s)=>{const o={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete o.focusColor,x(a=>a.map(i=>i.id===t.id?o:i)),await R(o)},re=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};x(o=>o.map(a=>a.id===t.id?s:a)),await R(s)},Fe=t=>{be(t,async(o,a)=>{C(!0);const i=l.filter(k=>{const F=k.title.split(":");return(F.length>1?F[0].trim():"General")===o});await Promise.all(i.map(k=>{const F=k.title.split(":"),de=F.length>1?F.slice(1).join(":").trim():F[0],$e=`${a}: ${de}`;return E({...k,title:$e,updatedAt:Date.now()})})),await S()})&&J(!1)},ie=async()=>{const t={id:`lb-${Date.now()}`,userId:h.id,title:`${_}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#ff9800",icon:"ðŸŽ§"};await E(t),await S(),y(t),N("BOOK_DETAIL"),v("New book created.","success")},ee=t=>{if(!d)return;const s={...d,...t,updatedAt:Date.now()};p(o=>o.map(a=>a.id===s.id?s:a)),y(s),E(s)},Ae=async()=>{B&&(await De(B.id),v("Book deleted.","success"),Z(null),await S())},Le=async t=>{if(!b)return;const s=b.title.split(":"),o=s.length>1?s.slice(1).join(":").trim():s[0],a=`${t}: ${o}`,i={...b,title:a,updatedAt:Date.now()};await E(i),q(null),await S(),v(`Moved to "${t}".`,"success")},Me=n.useMemo(()=>d?d.itemIds.map(t=>{const s=u.find(o=>o.id===t);return s?{id:s.id,title:s.text,subtitle:s.note||"Listening Practice",data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[d,u]),Oe=n.useMemo(()=>u.map(t=>({id:t.id,title:t.text,subtitle:t.note||"Listening Practice",data:t})),[u]),Pe=t=>{if(!d)return;const s=Array.from(new Set([...d.itemIds,...t]));ee({itemIds:s})},ze=t=>{if(!d)return;const s=d.itemIds.filter(o=>o!==t);ee({itemIds:s})},Ee=(t,s)=>{const o=t.data;ae(o,s)},Re=t=>{const s=t.data;re(s)};return L==="BOOK_DETAIL"&&d?e.jsx(at,{book:d,items:Me,availableItems:Oe,onBack:()=>{y(null),N("SHELF"),S()},onUpdateBook:ee,onAddItem:Pe,onRemoveItem:ze,onOpenItem:t=>D(t.data.text),onEditItem:t=>le(t.data),onFocusChange:Ee,onToggleFocus:Re,itemIcon:e.jsx(te,{size:16})}):L==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>N("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(_e,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Listening Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your listening practice."})]}),e.jsxs("button",{onClick:()=>K(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(ht,{size:14})," Add Shelf"]})]})]}),e.jsxs(rt,{label:_,onNext:H.length>1?je:void 0,onPrev:H.length>1?ve:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(ft,{size:14})}),e.jsx("button",{onClick:we,disabled:W.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(P,{size:14})})]}),isEmpty:W.length===0,emptyAction:e.jsx("button",{onClick:ie,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[W.map(t=>{const s=t.title,o=s.split(":"),a=o.length>1?o.slice(1).join(":").trim():s;return e.jsx(it,{id:t.id,title:a,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(te,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{y(t),N("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),q(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(pt,{size:16})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),Z(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(P,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:ie,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(ue,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(he,{isOpen:!!B,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(ce=B==null?void 0:B.title.split(":").pop())==null?void 0:ce.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Ae,onClose:()=>Z(null),icon:e.jsx(P,{size:40,className:"text-red-500"})}),e.jsx(xt,{isOpen:!!b,onClose:()=>q(null),onConfirm:Le,shelves:H,currentShelf:b?b.title.split(":")[0].trim():"General",bookTitle:(b==null?void 0:b.title)||""}),e.jsx(mt,{isOpen:Se,onClose:()=>K(!1),onSave:t=>{fe(t)&&K(!1)}}),e.jsx(gt,{isOpen:ke,onClose:()=>J(!1),onSave:Fe,initialName:_})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),config:{},isLoading:A,isEmpty:O.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:V,totalPages:Math.ceil(O.length/I),onPageChange:oe,pageSize:I,onPageSizeChange:pe,totalItems:O.length},aboveGrid:e.jsxs(e.Fragment,{children:[w&&e.jsx(xe,{items:u,selectedTag:c,onSelectTag:f,forcedView:"groups",title:"Browse Groups",icon:e.jsx(ut,{size:16})}),G&&e.jsx(xe,{items:u,selectedTag:c,onSelectTag:f,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Xe,{size:16})})]}),actions:e.jsx(nt,{viewMenu:e.jsx(ct,{isOpen:M,setIsOpen:$,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(qe,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>ge(T==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${T==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:T==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>U(g==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>U(g==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>U(g==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:m.showNote,onChange:()=>r(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:m.showType,onChange:()=>r(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:m.compact,onChange:()=>r(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:w,onToggle:()=>{j(!w),se(!1)}},browseTags:{isOpen:G,onToggle:()=>{se(!G),j(!1)}},addActions:[{label:"Add Phrase",icon:ue,onClick:Ce}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Be,disabled:u.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Je,{size:16})}),e.jsxs("button",{onClick:()=>N("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(bt,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:ye.map(t=>e.jsx(dt,{title:e.jsx(wt,{text:t.text}),badge:m.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:te}:void 0,tags:t.tags,compact:m.compact,onClick:()=>D(t.text),focusColor:t.focusColor,onFocusChange:s=>ae(t,s),isFocused:t.isFocused,onToggleFocus:()=>re(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),D(t.text)},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Play",children:e.jsx(He,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),le(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Ke,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),Q(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(P,{size:14})})]}),children:m.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit",children:[e.jsx(We,{size:12})," ",t.note]})},t.id))})}),e.jsx(jt,{isOpen:Ne,onClose:()=>z(!1),onSave:Ie,initialData:X}),e.jsx(he,{isOpen:!!Y,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:Te,onClose:()=>Q(null),icon:e.jsx(P,{size:40,className:"text-red-500"})})]})};export{zt as ListeningCardPage};
