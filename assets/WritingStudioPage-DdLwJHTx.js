import{r as a,j as e,X as De,a0 as ae,aY as lt,y as ve,G as ne,P as Y,ar as je,a1 as Be,J as Se,E as ot,L as Ee,i as ze,C as it,a3 as re,K as le,p as ct,bb as ke,aC as dt,bc as ut,o as xt,A as mt,bd as pt,be as ht,bf as gt,a9 as X,ab as Oe,I as ft,ac as bt,b3 as wt,bg as te,bh as vt,bi as se,bj as jt,bk as kt}from"./index-cCmlA8Iz.js";import{R as St,a as Tt}from"./ResourceActions-CSuRH5DT.js";import{S as Nt}from"./search-BPVvSnPb.js";import{S as Pe}from"./square-check-big-qj8SvRU4.js";import{p as yt}from"./markdownParser-NDCOwRTZ.js";import{C as It}from"./chart-no-axes-column-increasing-DCidECDf.js";import{T as Fe,F as Ct}from"./TagBrowser-sunSTyUg.js";import{u as At,G as Et,U as Ot,a as Pt,V as Ft}from"./useShelfLogic-WtgegxKZ.js";import{U as Le}from"./UniversalCard-CBIgK5yE.js";import{F as Lt,M as Mt,A as Rt,R as Dt}from"./ShelfModals-D9_twy6P.js";import{M as Bt}from"./move-D7vK3yCK.js";import{P as zt}from"./pen-DinLwcly.js";import{L as $t}from"./library-m889drc8.js";import"./chevron-left-D2vi4xyX.js";import"./circle-C6TIGVmb.js";import"./palette-DX8dnbMP.js";function Wt(r,n){const y=r.split(/\s+/).filter(Boolean).length;let m="an expert English teacher",u="Coherence, Vocabulary, and Grammar";const i=n.toLowerCase();return i.includes("task 1")?(m="a certified IELTS examiner",u="Task Achievement, Coherence & Cohesion, Lexical Resource, and Grammatical Range & Accuracy"):i.includes("task 2")?(m="a certified IELTS examiner",u="Task Response, Coherence & Cohesion, Lexical Resource, and Grammatical Range & Accuracy"):i.includes("academic")?(m="a university professor",u="Formality, Clarity, Academic Vocabulary, and Structure"):i.includes("professional")||i.includes("business")?(m="a business communication expert",u="Professionalism, Conciseness, Clarity, and Tone"):i.includes("informal")||i.includes("email")?(m="a native English speaker",u="Naturalness, Idiomatic Usage, and Conversational Tone"):(m="a creative writing coach",u="Creativity, Flow, Vocabulary, and Grammar"),`You are ${m}.

    TASK:
    Analyze the following text written by a student. The context/tags are: **${n}**.
    
    TEXT (${y} words):
    "${r}"

    YOUR ANALYSIS MUST INCLUDE:
    1.  **Overall Impression**: A very brief summary.
    2.  **Key Feedback**: 2-3 bullet points based on: **${u}**. Format as HTML (<ul>, <li>, <b>).
    3.  **Improvements**: Rewrite 1 sentence to show improvement.
    
    CONSTRAINT:
    Keep the entire feedback response **under 100 words**. Be concise and direct.
    
    Return a strict JSON object with this exact schema. Do not include any text outside the JSON block.

    {
      "feedback": "string (The feedback formatted as an HTML string)"
    }
    `}function Gt(r,n,y){const m=r.name!=="New Topic"||r.description.trim()||r.task1.trim()||r.task2.trim();let u="";m&&(u=`CURRENT TOPIC DATA:
- Name: ${r.name}
- Description: ${r.description||"(empty)"}
- Task 1: ${r.task1||"(empty)"}
- Task 2: ${r.task2||"(empty)"}
`);const i=n?`USER REQUEST: "${n}"`:"USER REQUEST: General improvement and expansion.";return`You are an expert IELTS coach. Your task is to refine or create an IELTS Writing topic based on user context and a request.

USER PROFILE:
- Role: ${y.role}
- Level: ${y.currentLevel}

${u}
${i}

TASK:
1.  Read the user request and apply it to the CURRENT TOPIC DATA. If no data exists, create a new topic from the request.
2.  The goal is to generate a high-quality, realistic set of IELTS Writing tasks (Task 1 and Task 2).
3.  Ensure the topic name and description are concise and accurate.
4.  For Task 1, create a prompt describing a chart, graph, table, or diagram (for Academic) or a letter-writing scenario (for General Training). Be descriptive.
5.  For Task 2, create an essay question that is thematically linked to Task 1 if appropriate, or a standard standalone essay prompt.

Return a strict JSON object with this schema:
{ 
  "name": "string (The updated topic name)", 
  "description": "string (The updated description, max 1-2 sentences)", 
  "task1": "string (The full Task 1 prompt)",
  "task2": "string (The full Task 2 prompt)"
}`}function Ut(r){return`You are an expert IELTS examiner creating a full academic writing test. The main topic is "${r}".

    TASK: Generate a complete, cohesive 2-part IELTS academic writing test.
    
    STRUCTURE:
    1.  **Task 1 (Report Writing)**:
        - Create a prompt that describes a visual data representation (e.g., bar chart, line graph, table, diagram, or a combination).
        - The prompt must instruct the user to "Summarise the information by selecting and reporting the main features, and make comparisons where relevant."
        - The description of the visual data should be clear and concise. Do NOT generate the visual data itself.
    
    2.  **Task 2 (Essay Writing)**:
        - Create an essay question that is thematically related to the Task 1 prompt.
        - The question should present an opinion, problem, or argument for the user to discuss. It should be a standard IELTS Task 2 format (e.g., agree/disagree, discuss both views, advantages/disadvantages, problem/solution).
    
    Return a strict JSON object with this exact schema. Do not include any text outside the JSON block.
    
    {
      "topic": "string (The main theme, e.g., '${r}')",
      "task1": "string (The full Task 1 prompt, e.g., 'The chart below shows the percentage of the population in four European countries who used the internet between 2010 and 2020. Summarise...')",
      "task2": "string (The full Task 2 essay prompt, e.g., 'Some people believe that the internet has brought people closer together, while others think it has created more social isolation. Discuss both these views and give your own opinion.')"
    }
    `}function _t(r,n,y){return`You are a certified IELTS examiner providing feedback on a full writing practice test.

    TASK:
    Analyze the user's responses for Task 1 and Task 2. Provide a single, holistic evaluation and an overall band score.

    TASK 1 PROMPT:
    "${y.task1}"

    USER'S TASK 1 RESPONSE (Word Count: ${r.split(/\s+/).filter(Boolean).length}):
    "${r}"

    ---

    TASK 2 PROMPT:
    "${y.task2}"

    USER'S TASK 2 RESPONSE (Word Count: ${n.split(/\s+/).filter(Boolean).length}):
    "${n}"

    ---

    YOUR ANALYSIS MUST INCLUDE:
    1.  **Overall Band Score**: Provide a single, overall estimated band score for the ENTIRE test, from 5.0 to 9.0, in 0.5 increments. Remember that Task 2 is weighted more heavily than Task 1.
    2.  **Holistic Feedback**: Write detailed feedback in HTML format. Use <ul>, <li>, and <b> tags. The feedback must provide a combined analysis, covering all four official IELTS writing criteria. For each criterion, comment on both tasks where relevant.
        - **Task Achievement (for Task 1) / Task Response (for Task 2)**: Did the writer address all parts of the tasks? Is the overview/position clear? Are ideas well-supported?
        - **Coherence and Cohesion**: Is the writing well-organized? Is paragraphing logical? Is there effective use of cohesive devices?
        - **Lexical Resource**: What is the range and accuracy of the vocabulary? Are there good collocations? Is the tone appropriate?
        - **Grammatical Range and Accuracy**: Is there a good range of sentence structures? How frequent are grammatical errors?

    Return a strict JSON object with this exact schema. Do not include any text outside the JSON block.

    {
      "band": number (e.g., 6.5, 7.0, 8.5),
      "feedback": "string (The holistic feedback for the whole test, formatted as an HTML string)"
    }
    `}const Kt=({isOpen:r,onClose:n,onSelect:y,allWords:m,wordsToExclude:u,loading:i})=>{const[k,I]=a.useState(""),[v,O]=a.useState(new Set),p=a.useMemo(()=>{if(!k)return m;const c=k.toLowerCase();return m.filter(g=>g.word.toLowerCase().includes(c))},[m,k]),S=c=>{O(g=>{const b=new Set(g);return b.has(c)?b.delete(c):b.add(c),b})},f=()=>{y(Array.from(v)),n()};return r?e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-neutral-50 w-full max-w-lg rounded-[2rem] shadow-2xl border border-neutral-200 flex flex-col h-[70vh]",children:[e.jsxs("header",{className:"p-4 border-b border-neutral-200 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:k,onChange:c=>I(c.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-4 py-2 bg-white border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900",autoFocus:!0})]}),e.jsx("button",{onClick:n,className:"p-2 ml-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(De,{size:16})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-2",children:i?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ae,{size:24,className:"animate-spin text-neutral-300"})}):e.jsx("div",{className:"flex flex-col gap-1",children:p.map(c=>{const g=v.has(c.word),b=u.has(c.word);return e.jsxs("button",{onClick:()=>!b&&S(c.word),disabled:b,className:`flex items-center justify-between p-3 rounded-lg text-left transition-colors ${b?"bg-neutral-100 opacity-50 cursor-not-allowed":g?"bg-indigo-50 text-indigo-800":"hover:bg-neutral-100"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:c.word}),e.jsx("span",{className:"text-xs text-neutral-500",children:c.meaningVi})]}),b?e.jsx(Pe,{size:18,className:"text-neutral-400"}):g?e.jsx(Pe,{size:18,className:"text-indigo-600"}):e.jsx(lt,{size:18,className:"text-neutral-300"})]},c.id)})})}),e.jsxs("footer",{className:"p-4 border-t border-neutral-200 flex justify-end gap-3 shrink-0 bg-white/50 backdrop-blur-sm",children:[e.jsx("button",{onClick:n,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs hover:bg-neutral-200 transition-all",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:v.size===0,className:"px-5 py-2.5 bg-neutral-900 text-white rounded-lg font-black text-xs flex items-center space-x-2 hover:bg-neutral-800 transition-all disabled:opacity-50",children:[e.jsx(ve,{size:14}),e.jsxs("span",{children:["Add (",v.size,")"]})]})]})]})}):null},Vt=({title:r,setTitle:n,path:y,setPath:m,tagsInput:u,setTagsInput:i,content:k,setContent:I,linkedWords:v,wordCount:O,aiFeedback:p,isFeedbackOpen:S,setIsFeedbackOpen:f,isSaving:c,onCancel:g,onSave:b,onAutoLink:N,onRemoveLink:W,isWordSelectorOpen:B,setIsWordSelectorOpen:M,allWords:G,handleManualLink:z,isAiModalOpen:F,setIsAiModalOpen:C,handleGenerateEvalPrompt:o,handleAiResult:R})=>{const[h,U]=a.useState(!1),H=a.useMemo(()=>yt(k),[k]);return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(ne,{size:16}),e.jsx("span",{children:"Back to Studio"})]}),e.jsxs("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight flex items-center gap-3",children:[e.jsx(Y,{size:24})," Compose"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>C(!0),disabled:!k.trim(),className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all disabled:opacity-50",children:[e.jsx(je,{size:14,className:"text-indigo-500"}),e.jsx("span",{children:"AI Evaluate"})]}),e.jsxs("button",{onClick:b,disabled:c,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[c?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(Be,{size:14}),e.jsx("span",{children:c?"Saving...":"Save Draft"})]})]})]}),e.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm flex flex-col",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Title (Optional)"}),e.jsx("input",{type:"text",value:r,onChange:L=>n(L.target.value),placeholder:"My Awesome Essay",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Se,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:u,onChange:L=>i(L.target.value),placeholder:"e.g. Environment, Technology",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Content (Markdown Supported)"}),e.jsxs("button",{onClick:()=>U(!h),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[h?e.jsx(Y,{size:12}):e.jsx(ot,{size:12}),e.jsx("span",{children:h?"Edit":"Preview"})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[500px] relative overflow-hidden",children:h?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-p:text-neutral-600 prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:H}}):e.jsx("textarea",{value:k,onChange:L=>I(L.target.value),className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-base leading-relaxed font-medium text-neutral-900 bg-white",placeholder:"Start writing...",spellCheck:!1})})]}),e.jsxs("div",{className:"px-4 py-4 mt-6 bg-neutral-50/50 rounded-2xl border border-neutral-100 min-h-[80px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest flex items-center gap-2",children:[e.jsx(Ee,{size:12})," Linked Vocabulary (",v.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-neutral-400",children:[O," words"]}),e.jsx("div",{className:"w-px h-3 bg-neutral-200"}),e.jsx("button",{onClick:N,className:"p-1.5 hover:bg-neutral-100 rounded-lg text-neutral-400 hover:text-indigo-600 transition-colors",title:"Auto Link Vocabulary",children:e.jsx(ze,{size:14})}),e.jsx("button",{onClick:()=>M(!0),className:"p-1.5 hover:bg-neutral-100 rounded-lg text-neutral-400 hover:text-indigo-600 transition-colors",title:"Manually Link Word",children:e.jsx(Ee,{size:14})})]})]}),v.length===0?e.jsx("p",{className:"text-xs text-neutral-400 italic text-center py-2",children:"No words linked."}):e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(L=>e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-white border border-neutral-200 rounded-lg shadow-sm group/tag",children:[e.jsx("span",{className:"text-xs font-bold text-neutral-700",children:L.word}),e.jsx("button",{onClick:()=>W(L.id),className:"text-neutral-300 hover:text-red-500 transition-colors opacity-0 group-hover/tag:opacity-100",children:e.jsx(De,{size:12})})]},L.id))})]})]}),p&&e.jsxs("div",{className:"bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm animate-in slide-in-from-bottom-4 overflow-hidden transition-all",children:[e.jsxs("button",{onClick:()=>f(!S),className:"w-full flex items-center justify-between p-6 md:px-8 hover:bg-neutral-50 transition-colors",children:[e.jsxs("h3",{className:"text-lg font-black text-indigo-900 flex items-center gap-2",children:[e.jsx(je,{size:20})," AI Feedback"]}),e.jsx(it,{size:20,className:`text-indigo-400 transition-transform ${S?"rotate-180":""}`})]}),S&&e.jsx("div",{className:"px-8 pb-8 pt-0 animate-in fade-in slide-in-from-top-2",children:e.jsx("div",{className:"prose prose-sm max-w-none text-neutral-700 prose-headings:font-bold prose-headings:text-indigo-900 [&_ul]:list-disc [&_ul]:pl-4 [&_li]:mb-1 [&_b]:text-neutral-900",dangerouslySetInnerHTML:{__html:p}})})]}),B&&e.jsx(Kt,{isOpen:B,onClose:()=>M(!1),onSelect:z,allWords:G,wordsToExclude:new Set(v.map(L=>L.word)),loading:!1}),F&&e.jsx(re,{isOpen:F,onClose:()=>C(!1),type:"EVALUATE_PARAPHRASE",title:"Evaluate Composition",description:`AI will analyze your writing based on tags: ${u||"General"}`,initialData:{},hidePrimaryInput:!0,onGeneratePrompt:o,onJsonReceived:R})]})},Ht=({user:r,initialComposition:n,onSave:y,onCancel:m})=>{const[u,i]=a.useState(""),[k,I]=a.useState(""),[v,O]=a.useState(""),[p,S]=a.useState(""),[f,c]=a.useState(new Set),[g,b]=a.useState(void 0),[N,W]=a.useState([]),[B,M]=a.useState(!1),[G,z]=a.useState(!1),[F,C]=a.useState(!1),[o,R]=a.useState(!1),{showToast:h}=le();a.useEffect(()=>{if((async()=>{const w=ct().filter(A=>A.userId===r.id);W(w)})(),n){if(i(n.title||""),n.path===void 0){const w=n.tags&&n.tags.length>0?n.tags:n.label?[n.label]:[],A=w.find(P=>P.startsWith("/")),d=w.filter(P=>!P.startsWith("/"));I(A||"/"),O(d.join(", "))}else I(n.path||"/"),O((n.tags||[]).join(", "));S(n.content),c(new Set(n.linkedWordIds)),b(n.aiFeedback),n.aiFeedback&&z(!0)}else i(""),I("/"),O(""),S(""),c(new Set),b(void 0),z(!1)},[n,r.id]);const U=a.useMemo(()=>{const T=new Map;return N.forEach(w=>{f.has(w.id)&&T.set(w.id,w)}),Array.from(T.values())},[N,f]),H=()=>{if(!p.trim())return;const T=p.toLowerCase();let w=0;const A=new Set(f);N.forEach(d=>{if(!A.has(d.id)){const P=[d.word];d.wordFamily&&(d.wordFamily.nouns&&P.push(...d.wordFamily.nouns.map(D=>D.word)),d.wordFamily.verbs&&P.push(...d.wordFamily.verbs.map(D=>D.word)),d.wordFamily.adjs&&P.push(...d.wordFamily.adjs.map(D=>D.word)),d.wordFamily.advs&&P.push(...d.wordFamily.advs.map(D=>D.word))),P.some(D=>T.includes(D.toLowerCase()))&&(A.add(d.id),w++)}}),w>0?(c(A),h(`Auto-linked ${w} new words!`,"success")):h("No new words found from library.","info")},L=T=>{const w=new Set(f);let A=0;const d=new Map;N.forEach(P=>d.set(P.word,P)),T.forEach(P=>{const _=d.get(P);_&&!w.has(_.id)&&(w.add(_.id),A++)}),c(w),C(!1),A>0&&h(`Linked ${A} words manually.`,"success")},V=T=>{const w=new Set(f);w.delete(T),c(w)},oe=async()=>{if(!p.trim()){h("Content cannot be empty.","error");return}M(!0);try{const T=Date.now(),w=v.split(",").map(d=>d.trim()).filter(Boolean),A={id:(n==null?void 0:n.id)||`comp-${T}-${Math.random()}`,userId:r.id,title:u.trim(),label:"Free Write",path:k.trim(),tags:w,content:p,linkedWordIds:Array.from(f),aiFeedback:g,createdAt:(n==null?void 0:n.createdAt)||T,updatedAt:T};await ke(A),h("Composition saved.","success"),y()}catch(T){console.error(T),h("Failed to save.","error")}finally{M(!1)}},J=()=>Wt(p,v||"Free Write"),j=T=>{b(T.feedback),R(!1),z(!0),h("Feedback received!","success")},ie=p.split(/\s+/).filter(Boolean).length;return e.jsx(Vt,{title:u,setTitle:i,path:k,setPath:I,tagsInput:v,setTagsInput:O,content:p,setContent:S,linkedWords:U,wordCount:ie,aiFeedback:g,isFeedbackOpen:G,setIsFeedbackOpen:z,isSaving:B,onCancel:m,onSave:oe,onAutoLink:H,onRemoveLink:V,isWordSelectorOpen:F,setIsWordSelectorOpen:C,allWords:N,handleManualLink:L,isAiModalOpen:o,setIsAiModalOpen:R,handleGenerateEvalPrompt:J,handleAiResult:j})},Me=r=>r>=8?"text-green-500":r>=7?"text-emerald-500":r>=6?"text-amber-500":"text-rose-500",Jt=({score:r,size:n="large"})=>n==="inline"?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400",children:"Band:"}),e.jsx("span",{className:`font-black ${Me(r)}`,children:r.toFixed(1)})]}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:"Est. Band"}),e.jsx("div",{className:`text-5xl font-black ${Me(r)}`,children:r.toFixed(1)})]}),Yt=({topic:r,step:n,task1Response:y,setTask1Response:m,task2Response:u,setTask2Response:i,formattedTime:k,timeLeft:I,wordCount1:v,wordCount2:O,finalResult:p,onComplete:S,onGetEvaluation:f})=>n==="ANALYZING"?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[80vh]",children:[e.jsx(ae,{size:40,className:"animate-spin text-neutral-400"}),e.jsx("p",{className:"text-sm font-bold text-neutral-500 mt-4",children:"AI is evaluating your writing..."})]}):n==="RESULT"&&p?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Session Report"}),e.jsxs("p",{className:"text-neutral-500 mt-1",children:["Topic: ",e.jsx("span",{className:"font-bold text-neutral-700",children:p.topicName})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex items-center justify-between",children:[e.jsx(Jt,{score:p.estimatedBand}),e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Session Date"}),e.jsx("p",{className:"font-mono text-xs",children:new Date(p.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("h4",{className:"text-sm font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(It,{size:16})," Examiner's Feedback"]}),e.jsx("div",{className:"text-sm text-neutral-800 leading-relaxed font-medium bg-neutral-50/50 p-4 rounded-2xl border border-neutral-100 [&_ul]:list-disc [&_ul]:pl-4 [&_li]:mb-1 [&_b]:text-neutral-900",dangerouslySetInnerHTML:{__html:p.feedbackHtml}})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsx("h4",{className:"text-sm font-black text-neutral-900",children:"Your Responses"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("details",{className:"p-4 rounded-xl border border-neutral-100 bg-neutral-50/50",children:[e.jsx("summary",{className:"font-bold text-xs text-neutral-600 cursor-pointer",children:"View Task 1 Response"}),e.jsxs("p",{className:"text-sm font-medium italic text-neutral-700 mt-2 pt-2 border-t border-neutral-200 whitespace-pre-wrap",children:['"',p.task1Response,'"']})]}),e.jsxs("details",{className:"p-4 rounded-xl border border-neutral-100 bg-neutral-50/50",children:[e.jsx("summary",{className:"font-bold text-xs text-neutral-600 cursor-pointer",children:"View Task 2 Response"}),e.jsxs("p",{className:"text-sm font-medium italic text-neutral-700 mt-2 pt-2 border-t border-neutral-200 whitespace-pre-wrap",children:['"',p.task2Response,'"']})]})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:S,className:"px-8 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest",children:"Back to Library"})})]}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("button",{onClick:S,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(ne,{size:16}),e.jsx("span",{children:"Quit Session"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 text-lg font-black px-4 py-2 rounded-xl border-2 ${I<300?"bg-red-50 text-red-600 border-red-100":"bg-white text-neutral-800 border-neutral-200"}`,children:[e.jsx(dt,{size:20}),e.jsx("span",{children:k})]}),e.jsxs("button",{onClick:f,className:"px-8 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-800 active:scale-95 uppercase tracking-widest shadow-lg",children:[e.jsx(je,{size:16}),e.jsx("span",{children:"Get AI Evaluation"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-neutral-400 mb-2",children:"Task 1"}),e.jsx("p",{className:"text-sm font-medium text-neutral-700 mb-4 whitespace-pre-wrap",children:r.task1}),e.jsx("textarea",{value:y,onChange:c=>m(c.target.value),className:"w-full flex-1 p-4 bg-neutral-50/50 border border-neutral-200/80 rounded-2xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 focus:outline-none min-h-[300px]",placeholder:"Write at least 150 words..."}),e.jsxs("p",{className:`text-right text-xs font-bold mt-2 ${v<150?"text-red-500":"text-green-600"}`,children:[v," words"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-neutral-400 mb-2",children:"Task 2"}),e.jsx("p",{className:"text-sm font-medium text-neutral-700 mb-4 whitespace-pre-wrap",children:r.task2}),e.jsx("textarea",{value:u,onChange:c=>i(c.target.value),className:"w-full flex-1 p-4 bg-neutral-50/50 border border-neutral-200/80 rounded-2xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 focus:outline-none min-h-[300px]",placeholder:"Write at least 250 words..."}),e.jsxs("p",{className:`text-right text-xs font-bold mt-2 ${O<250?"text-red-500":"text-green-600"}`,children:[O," words"]})]})]})]}),qt=({user:r,topic:n,onComplete:y})=>{const[m,u]=a.useState("PRACTICING"),[i,k]=a.useState(""),[I,v]=a.useState(""),[O,p]=a.useState(3600),[S,f]=a.useState(null),[c,g]=a.useState(!1),{showToast:b}=le(),N=a.useRef(null),W=i.split(/\s+/).filter(Boolean).length,B=I.split(/\s+/).filter(Boolean).length;a.useEffect(()=>(N.current=window.setInterval(()=>{p(C=>C<=1?(N.current&&clearInterval(N.current),G(),0):C-1)},1e3),()=>{N.current&&clearInterval(N.current)}),[]);const M=C=>{const o=Math.floor(C/60),R=C%60;return`${o.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`},G=()=>{if(!i.trim()&&!I.trim()){b("Both tasks are empty. Nothing to evaluate.","error");return}N.current&&clearInterval(N.current),g(!0)},z=()=>_t(i,I,n),F=async C=>{try{if(!C||typeof C.band!="number"||!C.feedback)throw new Error("Invalid JSON structure from AI.");u("ANALYZING");const o={id:`wrt-log-${Date.now()}`,userId:r.id,timestamp:Date.now(),topicName:n.name,task1Response:i,task2Response:I,estimatedBand:C.band,feedbackHtml:C.feedback};await ut(o),f(o),u("RESULT"),g(!1)}catch(o){throw b(o.message,"error"),u("PRACTICING"),o}};return e.jsxs(e.Fragment,{children:[e.jsx(Yt,{topic:n,step:m,task1Response:i,setTask1Response:k,task2Response:I,setTask2Response:v,formattedTime:M(O),timeLeft:O,wordCount1:W,wordCount2:B,finalResult:S,onComplete:y,onGetEvaluation:G}),e.jsx(re,{isOpen:c,onClose:()=>g(!1),type:"EVALUATE_PARAPHRASE",title:"Manual AI Evaluation",description:"Your essays have been added to the prompt. Copy it, get JSON from your AI, then paste the result.",onGeneratePrompt:z,onJsonReceived:F})]})},Re="vocab_pro_writing_view",Qt=({user:r,topic:n,onSave:y,onCancel:m})=>{const[u,i]=a.useState(n.name),[k,I]=a.useState(n.description),[v,O]=a.useState(n.task1),[p,S]=a.useState(n.task2),[f,c]=a.useState("/"),[g,b]=a.useState(""),[N,W]=a.useState(!1),[B,M]=a.useState(!1),{showToast:G}=le();a.useEffect(()=>{if(n.path===void 0){const o=n.tags||[],R=o.find(U=>U.startsWith("/")),h=o.filter(U=>!U.startsWith("/"));c(R||"/"),b(h.join(", "))}else c(n.path||"/"),b((n.tags||[]).join(", "))},[n]);const z=async()=>{W(!0);const o=g.split(",").map(h=>h.trim()).filter(Boolean),R={...n,name:u.trim()||"Untitled Topic",description:k.trim(),task1:v.trim(),task2:p.trim(),path:f.trim(),tags:o,updatedAt:Date.now()};await se(R),G("Topic saved!","success"),W(!1),y()},F=o=>{const R={...n,name:u,description:k,task1:v,task2:p,tags:g.split(",").map(h=>h.trim())};return Gt(R,o.request,r)},C=o=>{i(o.name),I(o.description),O(o.task1),S(o.task2),G("AI refinement applied!","success"),M(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(ne,{size:16}),e.jsx("span",{children:"Back to Library"})]}),e.jsxs("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight flex items-center gap-3",children:[e.jsx(Y,{size:28})," Edit Topic"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>M(!0),className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all",children:[e.jsx(ze,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:z,disabled:N,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[N?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(Be,{size:14}),e.jsx("span",{children:N?"Saving...":"Save Changes"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Topic Name"}),e.jsx("input",{type:"text",value:u,onChange:o=>i(o.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Description"}),e.jsx("input",{type:"text",value:k,onChange:o=>I(o.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-2",children:[e.jsx(Se,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:g,onChange:o=>b(o.target.value),placeholder:"e.g. Environment, Technology",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Task 1 Prompt"}),e.jsx("textarea",{value:v,onChange:o=>O(o.target.value),rows:6,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none font-medium"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Task 2 Prompt"}),e.jsx("textarea",{value:p,onChange:o=>S(o.target.value),rows:6,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none font-medium"})]})]}),B&&e.jsx(re,{isOpen:B,onClose:()=>M(!1),type:"REFINE_UNIT",title:"Refine Writing Topic",description:"Let AI improve or generate tasks for your topic.",onGeneratePrompt:F,onJsonReceived:C})]})},ps=({user:r,initialContextWord:n,onConsumeContext:y})=>{var Ce;const[m,u]=a.useState([]),[i,k]=a.useState([]),[I,v]=a.useState([]),[O,p]=a.useState(!0),{showToast:S}=le(),[f,c]=a.useState("COMPOSITIONS"),[g,b]=a.useState(null),[N,W]=a.useState(!1),[B,M]=a.useState(!1),[G,z]=a.useState(!1),[F,C]=a.useState(()=>xt(Re,{showDetails:!0,compact:!1})),[o,R]=a.useState("all"),[h,U]=a.useState("all"),[H,L]=a.useState(0),[V,oe]=a.useState(12),[J,j]=a.useState("LIST"),[ie,T]=a.useState(null),[w,A]=a.useState(null),[d,P]=a.useState(null),[_,D]=a.useState(null),[Te,ce]=a.useState(!1),{currentShelfName:de,booksOnCurrentShelf:ue,allShelves:xe,addShelf:$e,renameShelf:We,removeShelf:Ge,nextShelf:Ue,prevShelf:_e}=At(I,"writing_books_shelves"),[Ke,me]=a.useState(!1),[Ve,pe]=a.useState(!1),[K,he]=a.useState(null),[q,ge]=a.useState(null);a.useEffect(()=>{mt(Re,F)},[F]);const $=a.useCallback(async()=>{p(!0);const[t,s,l]=await Promise.all([pt(r.id),ht(r.id),gt(r.id)]);u(t.sort((x,E)=>E.createdAt-x.createdAt)),k(s.sort((x,E)=>E.createdAt-x.createdAt)),v(l.sort((x,E)=>E.createdAt-x.createdAt)),p(!1)},[r.id]);a.useEffect(()=>{$()},[$]),a.useEffect(()=>{L(0)},[f,g,V,o,h]),a.useEffect(()=>{n&&(T({id:"",userId:r.id,title:"",label:"Free Write",content:n.word+" ",linkedWordIds:[n.id],createdAt:Date.now(),updatedAt:Date.now()}),j("EDIT_COMP"),y&&y())},[n,y,r.id]);const Ne=a.useMemo(()=>f==="COMPOSITIONS"?m:i,[m,i,f]),Z=a.useMemo(()=>{let t=f==="COMPOSITIONS"?m:i;return t=t.filter(s=>!(o==="focused"&&!s.isFocused||h!=="all"&&s.focusColor!==h)),g?g==="Uncategorized"?t.filter(s=>{const l=s.path??(s.tags||[]).find(E=>E.startsWith("/"));return!(l&&l!=="/")}):t.filter(s=>{var l,x;return((l=s.path)==null?void 0:l.startsWith(g))||((x=s.tags)==null?void 0:x.includes(g))}):t},[m,i,f,g,o,h]),ye=a.useMemo(()=>{const t=H*V;return Z.slice(t,t+V)},[Z,H,V]),He=()=>{if(f==="COMPOSITIONS")T(null),j("EDIT_COMP");else{const t={id:`wrt-${Date.now()}`,userId:r.id,name:"New Topic",description:"",task1:"",task2:"",tags:[],createdAt:Date.now(),updatedAt:Date.now()};A(t),j("EDIT_TOPIC")}},Je=async()=>{_&&(_.type==="COMP"?await jt(_.id,r.id):await kt(_.id),S("Item deleted.","success"),D(null),$())},Ye=async t=>{ce(!1);try{if(t&&t.topic&&t.task1&&t.task2){const s={id:`wrt-gen-${Date.now()}`,userId:r.id,name:`Mock: ${t.topic}`,description:`Full test generated on ${t.topic}.`,task1:t.task1,task2:t.task2,tags:["Mock Test","Generated"],createdAt:Date.now(),updatedAt:Date.now()};await se(s),await $(),S("Test generated successfully!","success"),A(s),j("SESSION")}else throw new Error("Invalid response")}catch{S("Failed to generate test.","error")}},fe=async(t,s)=>{const l={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete l.focusColor,"content"in t?(u(x=>x.map(E=>E.id===t.id?l:E)),await ke(l)):(k(x=>x.map(E=>E.id===t.id?l:E)),await se(l))},be=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};"content"in t?(u(l=>l.map(x=>x.id===t.id?s:x)),await ke(s)):(k(l=>l.map(x=>x.id===t.id?s:x)),await se(s))},qe=t=>{We(t,async(l,x)=>{p(!0);const E=I.filter(ee=>{const Q=ee.title.split(":");return(Q.length>1?Q[0].trim():"General")===l});await Promise.all(E.map(ee=>{const Q=ee.title.split(":"),Ae=Q.length>1?Q.slice(1).join(":").trim():Q[0],rt=`${x}: ${Ae}`;return te({...ee,title:rt,updatedAt:Date.now()})})),await $()})&&pe(!1)},Ie=async()=>{const t={id:`wb-${Date.now()}`,userId:r.id,title:`${de}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#1e88e5",icon:"✍️"};await te(t),await $(),P(t),j("BOOK_DETAIL"),S("New book created.","success")},we=t=>{if(!d)return;const s={...d,...t,updatedAt:Date.now()};v(l=>l.map(x=>x.id===s.id?s:x)),P(s),te(s)},Qe=async()=>{q&&(await vt(q.id),S("Book deleted.","success"),ge(null),await $())},Xe=async t=>{if(!K)return;const s=K.title.split(":"),l=s.length>1?s.slice(1).join(":").trim():s[0],x=`${t}: ${l}`,E={...K,title:x,updatedAt:Date.now()};await te(E),he(null),await $(),S(`Moved to "${t}".`,"success")},Ze=a.useMemo(()=>d?d.itemIds.map(t=>{const s=m.find(x=>x.id===t);if(s)return{id:s.id,title:s.title||"Untitled",subtitle:"Composition",data:s,focusColor:s.focusColor,isFocused:s.isFocused};const l=i.find(x=>x.id===t);return l?{id:l.id,title:l.name,subtitle:"Topic",data:l,focusColor:l.focusColor,isFocused:l.isFocused}:null}).filter(t=>t!==null):[],[d,m,i]),et=a.useMemo(()=>{const t=m.map(l=>({id:l.id,title:l.title||"Untitled",subtitle:"Composition",data:l})),s=i.map(l=>({id:l.id,title:l.name,subtitle:"Topic",data:l}));return[...t,...s]},[m,i]),tt=t=>{if(!d)return;const s=Array.from(new Set([...d.itemIds,...t]));we({itemIds:s})},st=t=>{if(!d)return;const s=d.itemIds.filter(l=>l!==t);we({itemIds:s})},at=(t,s)=>{const l=t.data;fe(l,s)},nt=t=>{const s=t.data;be(s)};return J==="EDIT_COMP"?e.jsx(Ht,{user:r,initialComposition:ie,onSave:()=>{j(d?"BOOK_DETAIL":"LIST"),$()},onCancel:()=>j(d?"BOOK_DETAIL":"LIST")}):J==="EDIT_TOPIC"&&w?e.jsx(Qt,{user:r,topic:w,onSave:()=>{j(d?"BOOK_DETAIL":"LIST"),$()},onCancel:()=>j(d?"BOOK_DETAIL":"LIST")}):J==="SESSION"&&w?e.jsx(qt,{user:r,topic:w,onComplete:()=>{j(d?"BOOK_DETAIL":"LIST"),$()}}):J==="BOOK_DETAIL"&&d?e.jsx(Et,{book:d,items:Ze,availableItems:et,onBack:()=>{P(null),j("SHELF"),$()},onUpdateBook:we,onAddItem:tt,onRemoveItem:st,onOpenItem:t=>{const s=t.data;"content"in s?(T(s),j("EDIT_COMP")):(A(s),j("SESSION"))},onEditItem:t=>{const s=t.data;"content"in s?(T(s),j("EDIT_COMP")):(A(s),j("EDIT_TOPIC"))},onFocusChange:at,onToggleFocus:nt,itemIcon:e.jsx(Y,{size:16})}):J==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>j("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(ne,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Writing Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your writing practice."})]}),e.jsxs("button",{onClick:()=>me(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Lt,{size:14})," Add Shelf"]})]})]}),e.jsxs(Ot,{label:de,onNext:xe.length>1?Ue:void 0,onPrev:xe.length>1?_e:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>pe(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(zt,{size:14})}),e.jsx("button",{onClick:Ge,disabled:ue.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(X,{size:14})})]}),isEmpty:ue.length===0,emptyAction:e.jsx("button",{onClick:Ie,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[ue.map(t=>{const s=t.title,l=s.split(":"),x=l.length>1?l.slice(1).join(":").trim():s;return e.jsx(Pt,{id:t.id,title:x,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(Y,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{P(t),j("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E=>{E.stopPropagation(),he(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Bt,{size:16})}),e.jsx("button",{onClick:E=>{E.stopPropagation(),ge(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(X,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:Ie,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(ve,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(Oe,{isOpen:!!q,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Ce=q==null?void 0:q.title.split(":").pop())==null?void 0:Ce.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Qe,onClose:()=>ge(null),icon:e.jsx(X,{size:40,className:"text-red-500"})}),e.jsx(Mt,{isOpen:!!K,onClose:()=>he(null),onConfirm:Xe,shelves:xe,currentShelf:K?K.title.split(":")[0].trim():"General",bookTitle:(K==null?void 0:K.title)||""}),e.jsx(Rt,{isOpen:Ke,onClose:()=>me(!1),onSave:t=>{$e(t)&&me(!1)}}),e.jsx(Dt,{isOpen:Ve,onClose:()=>pe(!1),onSave:qe,initialName:de})]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{title:"Writing Library",subtitle:"Practice writing and track vocabulary usage.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Memo.png",className:"w-8 h-8 object-contain",alt:"Writing"}),config:{},activeFilters:{},onFilterChange:()=>{},isLoading:O,isEmpty:Z.length===0,emptyMessage:"No items found.",pagination:{page:H,totalPages:Math.ceil(Z.length/V),onPageChange:L,pageSize:V,onPageSizeChange:oe,totalItems:Z.length},aboveGrid:e.jsxs(e.Fragment,{children:[N&&e.jsx(Fe,{items:Ne,selectedTag:g,onSelectTag:b,forcedView:"groups",title:"Browse Groups",icon:e.jsx(Ct,{size:16})}),B&&e.jsx(Fe,{items:Ne,selectedTag:g,onSelectTag:b,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Se,{size:16})})]}),minorSkills:f==="TOPICS"&&e.jsxs("button",{onClick:()=>ce(!0),className:"px-5 py-3 bg-white border border-neutral-200 text-indigo-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(wt,{size:16}),e.jsx("span",{children:"Generate Test"})]}),actions:e.jsx(Tt,{viewMenu:e.jsx(Ft,{isOpen:G,setIsOpen:z,filterOptions:[{label:"Writings",value:"COMPOSITIONS",isActive:f==="COMPOSITIONS",onClick:()=>{c("COMPOSITIONS"),b(null)}},{label:"Topics",value:"TOPICS",isActive:f==="TOPICS",onClick:()=>{c("TOPICS"),b(null)}}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(bt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>R(o==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${o==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:o==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>U(h==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${h==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>U(h==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${h==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>U(h==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${h==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Details",checked:F.showDetails,onChange:()=>C(t=>({...t,showDetails:!t.showDetails}))},{label:"Compact",checked:F.compact,onChange:()=>C(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:N,onToggle:()=>{W(!N),M(!1)}},browseTags:{isOpen:B,onToggle:()=>{M(!B),W(!1)}},addActions:[{label:"Add",icon:ve,onClick:He}],extraActions:e.jsxs("button",{onClick:()=>j("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx($t,{size:16}),e.jsx("span",{children:"Bookshelf"})]})}),children:()=>e.jsx(e.Fragment,{children:f==="COMPOSITIONS"?ye.map(t=>{const s=t.tags||(t.label?[t.label]:[]);return e.jsx(Le,{title:t.title||"Untitled Composition",tags:s,compact:F.compact,onClick:()=>{T(t),j("EDIT_COMP")},focusColor:t.focusColor,onFocusChange:l=>fe(t,l),isFocused:t.isFocused,onToggleFocus:()=>be(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),T(t),j("EDIT_COMP")},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Y,{size:14})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),D({id:t.id,type:"COMP"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{size:14})})]}),footer:t.linkedWordIds.length>0&&e.jsxs("div",{className:"text-[10px] font-bold text-neutral-400",children:[t.linkedWordIds.length," words linked"]}),children:F.showDetails&&e.jsx("p",{className:"line-clamp-4",children:t.content})},t.id)}):ye.map(t=>e.jsx(Le,{title:t.name,tags:t.tags,compact:F.compact,onClick:()=>{A(t),j("SESSION")},focusColor:t.focusColor,onFocusChange:s=>fe(t,s),isFocused:t.isFocused,onToggleFocus:()=>be(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),A(t),j("SESSION")},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Practice",children:e.jsx(ft,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),A(t),j("EDIT_TOPIC")},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Y,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),D({id:t.id,type:"TOPIC"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{size:14})})]}),children:F.showDetails&&e.jsx("p",{className:"line-clamp-2",children:t.description||"No description."})},t.id))})}),e.jsx(Oe,{isOpen:!!_,title:"Delete Item?",message:"This action cannot be undone.",confirmText:"Delete",isProcessing:!1,onConfirm:Je,onClose:()=>D(null),icon:e.jsx(X,{size:40,className:"text-red-500"})}),Te&&e.jsx(re,{isOpen:Te,onClose:()=>ce(!1),type:"REFINE_UNIT",title:"Generate Full Test",description:"Enter a theme (e.g. 'Environment', 'Technology') to generate a full Task 1 & 2 test.",initialData:{request:""},onGeneratePrompt:t=>Ut(t.request||"Random"),onJsonReceived:Ye,actionLabel:"Generate"})]})};export{ps as WritingStudioPage};
