import{c as A,m as D,aE as I,D as q,r as i,j as t,X as V,s as X,a as $}from"./index-3pjVYRSv.js";import{F as k}from"./file-text-CyuwkuAp.js";import{C as B}from"./corner-left-up-BYNin9tI.js";import{F as C}from"./folder-CRRBsdvx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=A("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),O=({isOpen:x,onClose:u,onSelect:j,type:o,title:z})=>{const M=D(),d=I(M),{showToast:l}=q(),[g,S]=i.useState({}),[s,p]=i.useState(null),[r,y]=i.useState(""),[b,f]=i.useState([]),[P,c]=i.useState(!1);i.useEffect(()=>{x&&(E(),p(null),y(""),f([]))},[x]);const E=async()=>{c(!0);try{const e=await fetch(`${d}/api/audio/mappings`);e.ok?S(await e.json()):l("Failed to connect to server","error")}catch{l("Server unreachable","error")}finally{c(!1)}},m=async(e,a="")=>{c(!0);try{const n=encodeURIComponent(a),v=await fetch(`${d}/api/${o==="audio"?"audio":"reading"}/files/${e}?path=${n}`);if(v.ok){const h=await v.json();let w=[];Array.isArray(h.items)&&(w=h.items),f(w),y(h.currentPath||"")}else l("Failed to load files","error")}catch{l("Connection error","error")}finally{c(!1)}},L=e=>{p(e),m(e,"")},T=e=>{if(!s)return;const a=r?`${r}/${e}`:e;m(s,a)},U=()=>{if(s)if(!r)p(null),f([]);else{const e=r.split("/");e.pop();const a=e.join("/");m(s,a)}},R=async e=>{if(s)if(o==="audio"){const a=r?`${r}/${e.name}`:e.name,n=`${d}/api/audio/stream/${s}/${a}`;j({url:n,filename:e.name,transcript:e.transcript,transcriptTitle:e.transcriptTitle,map:s,path:r}),u()}else{c(!0);try{const a=r?`${r}/${e.name}`:e.name,n=await fetch(`${d}/api/reading/content/${s}/${a}`);if(n.ok){const N=await n.json();j(N),u()}else l("Failed to load file content","error")}catch{l("Error reading file","error")}finally{c(!1)}}};return x?t.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:t.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[t.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center",children:[t.jsx("div",{children:t.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[o==="audio"?t.jsx(F,{size:20}):t.jsx(k,{size:20}),z]})}),t.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:t.jsx(V,{size:20})})]}),t.jsxs("div",{className:"p-4 bg-neutral-50 border-b border-neutral-100 flex items-center gap-2 overflow-hidden",children:[s&&t.jsx("button",{onClick:U,className:"p-1.5 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-100 transition-colors",children:t.jsx(B,{size:14})}),t.jsx("div",{className:"flex-1 truncate text-xs font-mono font-medium text-neutral-600",children:s?`/${s}/${r}`:"Root"})]}),t.jsx("main",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:P?t.jsx("div",{className:"flex justify-center py-10",children:t.jsx(X,{size:24,className:"animate-spin text-neutral-300"})}):s?t.jsxs("div",{className:"space-y-1",children:[b.map((e,a)=>(e.type,t.jsxs("button",{onClick:()=>e.type==="directory"?T(e.name):R(e),className:"w-full flex items-center gap-3 p-3 rounded-xl transition-colors text-left group hover:bg-neutral-50",children:[e.type==="directory"?t.jsx(C,{size:18,className:"text-indigo-400"}):o==="audio"?t.jsx(F,{size:18,className:"text-emerald-500"}):t.jsx(k,{size:18,className:"text-blue-500"}),t.jsx("div",{className:"flex-1 overflow-hidden",children:e.displayName?t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-bold text-neutral-800 truncate",children:e.displayName}),t.jsx("span",{className:"text-[10px] font-medium text-neutral-400 truncate",children:e.name})]}):t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-xs font-medium text-neutral-700 truncate",children:e.name})})}),e.type==="directory"&&t.jsx($,{size:14,className:"text-neutral-300"})]},`${e.name}-${a}`))),b.length===0&&t.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"Empty folder."})]}):t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest px-2 mb-2",children:"Mapped Folders"}),Object.keys(g).map(e=>t.jsxs("button",{onClick:()=>L(e),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-neutral-50 transition-colors text-left group",children:[t.jsx(C,{size:18,className:"text-indigo-400 group-hover:text-indigo-600"}),t.jsx("span",{className:"text-sm font-bold text-neutral-700",children:e}),t.jsx($,{size:14,className:"ml-auto text-neutral-300"})]},e)),Object.keys(g).length===0&&t.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"No mappings found. Configure in Settings."})]})})]})}):null};export{O as F,F as M};
