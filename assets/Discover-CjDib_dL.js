import{c as he,j as e,r as t,P as pt,E as Ee,b8 as Pe,Z as oe,X as Re,ak as $e,b9 as Le,e as Oe,K as ke,$ as pe,ba as bt,bb as gt,U as jt,y as Me,a1 as wt,ar as vt,bc as Ne,bd as Ke,u as lt,D as ce,b0 as He,ah as We,N as le,h as yt,aj as xe,V as Ue,H as ge,x as we,aZ as Nt,a$ as kt,f as rt,b as Be,aS as nt,T as St,be as Ct,b4 as It,a0 as qe,ai as Xe,bf as ze,bg as Et,k as Ze,aL as Je,aP as Rt,bh as At,b2 as Mt,M as zt,aN as Ve,o as Te,bi as Tt,l as je,bj as it,aa as _t}from"./index-Bqy58GPU.js";import{C as Ft,S as De,A as Pt,T as Dt,L as $t}from"./AvatarSelectionModal-Dv6N1gmA.js";import{T as ot}from"./trophy-Dh8zHm_X.js";import{C as ct}from"./chevron-left-DYfdAwkU.js";import{B as Ye,K as Lt}from"./keyboard-BF3JlPJe.js";import{a as dt,S as Ot}from"./split-DThQZAEJ.js";import{L as Ht}from"./layout-grid-vWfe4HEG.js";import{C as Wt}from"./columns-2-DNRiPCR6.js";import{S as Ut}from"./square-check-big-Cj3jOEK2.js";import{S as Bt}from"./server-BSIilS1T.js";import{S as Ge}from"./skip-forward-bJ9nx3Oy.js";import"./palette-BiIEroqg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=he("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=he("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=he("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=he("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=he("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=he("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=he("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=he("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),ht=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],Qt=s=>{let g="Novice Soul";for(const M of ht)if(s>=M.level)g=M.title;else break;return g},Kt=s=>s>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:s>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:s>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:s>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},qt=({user:s,xpToNextLevel:g,onUpdateUser:M,isRecalculatingXp:x})=>{const[V,_]=t.useState(!1),J=g>0?Math.min(100,Math.max(0,s.experience/g*100)):0,f=s.peakLevel||s.level,Y=f>0?Math.min(100,Math.max(0,s.level/f*100)):100,C=Kt(s.level),O=s.adventure,G=Qt(s.level),Q=ht.find(W=>W.level>s.level),K=async W=>{await M({...s,avatar:W}),_(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>_(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${C.frame} shadow-md ${C.shadow}`,children:[e.jsx("img",{src:s.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(pt,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:s.name}),x&&e.jsx(Ee,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(Ft,{size:12,className:"text-yellow-500"})," ",G]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",s.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[s.experience," / ",g," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${J}%`}})})]}),f>s.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[s.level," / ",f," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${Y}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(Pe,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:(O==null?void 0:O.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(xt,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[(O==null?void 0:O.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(oe,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:(O==null?void 0:O.energy)??0})]})]}),Q&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",Q.level," for: ",e.jsx("strong",{children:Q.title})]}),e.jsx(De,{size:12,className:"text-amber-400"})]})]})]}),e.jsx(Pt,{isOpen:V,onClose:()=>_(!1),onSelectAvatar:K,currentUser:s})]})},Xt=({user:s,xpToNextLevel:g,onUpdateUser:M,isRecalculatingXp:x,children:V})=>e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(qt,{user:s,xpToNextLevel:g,onUpdateUser:M,isRecalculatingXp:x})}),e.jsx("div",{className:"flex-1 min-h-0 relative",children:V})]}),ie={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},Zt=s=>{var g,M;switch(s.type){case"boss":return s.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((g=s.boss_details)==null?void 0:g.image)||"üëπ",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(Oe,{size:10,className:"text-white"})})]}):((M=s.boss_details)==null?void 0:M.image)||"üëπ";case"treasure":return"üëë";case"key_fragment":return"üóùÔ∏è";default:return"‚òÖ"}},Jt=s=>s>=50?4:s>=25?3:s>=10?2:1,es=({user:s})=>{const g=Jt(s.peakLevel||1),M=g===1?"shadow-indigo-500/50":g===2?"shadow-cyan-500/60":g===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:ie.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:s.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${M}`,children:["Lvl ",s.peakLevel||1]})]})},ts=({isOpen:s,onClose:g,defeatedBosses:M})=>s?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(ot,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:g,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:M.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(mt,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:M.map(x=>{var V,_;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(Oe,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(V=x.boss_details)==null?void 0:V.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(_=x.boss_details)==null?void 0:_.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",x.id+1]})]},x.id)})})})]})}):null,ss=({user:s,progress:g,onExit:M,map:x,onMove:V,onNodeClick:_,onOpenInventory:J,onAdminAction:f})=>{const C=x.length,O=5,[G,Q]=t.useState(0),[K,W]=t.useState(!1),E=Math.min(C-6,g.currentNodeIndex),d=x.filter(m=>m.type==="boss"&&m.isDefeated);t.useEffect(()=>{l()},[g.currentNodeIndex]);const l=()=>{let m=g.currentNodeIndex-Math.floor(3);m<0&&(m=0),m>E&&(m=E),Q(m)},D=m=>{Q(z=>{let P=m==="left"?z-1:z+1;return P<0&&(P=0),P>E&&(P=E),P})},N=C/6*100,U=-(G*(100/C)),$=U*.3,B=50/C,j=x[g.currentNodeIndex],b=(j==null?void 0:j.type)==="boss"&&!(j!=null&&j.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${N}%`,transform:`translateX(${$}%)`},children:[e.jsx("img",{src:ie.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:ie.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:ie.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"üåÄ"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"üåö"}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:ie.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"üåÄ"}),e.jsx("img",{src:ie.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"üåö"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(oe,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[g.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(Pe,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:g.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[g.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>W(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(ot,{size:18}),d.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:l,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(Vt,{size:18})}),e.jsx("button",{onClick:J,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(ut,{size:18})}),e.jsx("button",{onClick:M,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(Re,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>D("left"),disabled:G===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(ct,{size:32})}),e.jsx("button",{onClick:()=>D("right"),disabled:G>=E,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx($e,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${N}%`,transform:`translateX(${U}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${B}%`,right:`${B}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${g.currentNodeIndex/(C-1)*100}%`}})})}),x.map((m,z)=>{if(z>g.currentNodeIndex+O)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},m.id);const v=z===g.currentNodeIndex,r=z<g.currentNodeIndex,u=m.type==="boss",a=m.isDefeated;let i="w-16 h-16",c="bg-slate-800 border-slate-600 text-slate-500 cursor-default",h="",o="scale(1)";return v?(c="bg-slate-700 border-slate-500 text-slate-300",h="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):r&&(c="bg-emerald-900/80 border-emerald-500 text-emerald-400",h="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),u&&(i="w-24 h-24",a?(c="bg-slate-800 border-slate-600 text-slate-500",v&&(c="bg-slate-700 border-slate-500 text-slate-400")):(c="bg-red-950 border-red-600 text-red-500 cursor-pointer",h="shadow-[0_0_20px_rgba(220,38,38,0.4)]",v&&(c="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",o="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[v&&e.jsx(es,{user:s}),v&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>_(m),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${i} ${c} ${h}`,style:{transform:o},children:[e.jsx("span",{className:"text-3xl font-black",children:Zt(m)}),u&&v&&!a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(Le,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!v&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${r?"text-emerald-500":"text-slate-600"}`,children:z+1})]})},m.id)})]})})]}),s.isAdmin&&f&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(Dt,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(oe,{size:12})," +10"]}),e.jsx("button",{onClick:()=>f("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(Pe,{size:12})," +1"]}),e.jsx("button",{onClick:()=>f("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>f("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"üß™+"}),e.jsx("button",{onClick:()=>f("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>f("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"üçé+"}),e.jsx("button",{onClick:()=>f("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>f("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(Oe,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",g.currentNodeIndex+1," / ",x.length]}),e.jsxs("button",{onClick:V,disabled:g.energy<=0||b,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(ke,{size:18})]})]}),e.jsx(ts,{isOpen:K,onClose:()=>W(!1),defeatedBosses:d})]})},ve=5,as=({user:s,boss:g,words:M,onVictory:x,onDefeat:V,onExit:_,onUpdateUser:J})=>{const{showToast:f}=pe(),[Y,C]=t.useState(g.hp),[O,G]=t.useState(ve),[Q,K]=t.useState(0),[W,E]=t.useState("idle"),[d,l]=t.useState("none"),[D,N]=t.useState("intro"),[U,$]=t.useState(600),[B,j]=t.useState(!1),[b,m]=t.useState(!1),z=t.useMemo(()=>[...M].sort(()=>Math.random()-.5),[M]),P=z[Q%z.length];t.useEffect(()=>{if(D==="fighting"){const o=setInterval(()=>{$(k=>k<=1?(clearInterval(o),N("lost"),0):k-1)},1e3);return()=>clearInterval(o)}},[D]),t.useEffect(()=>{m(!1)},[Q]);const v=async o=>{const k=o!==Me.FORGOT;N("animating"),k?(E("player-attacking"),setTimeout(()=>{E("idle"),l("boss-hit"),C(H=>Math.max(0,H-1)),setTimeout(()=>{l("none"),r()},800)},600)):(E("boss-attacking"),setTimeout(()=>{E("idle"),l("player-hit"),G(H=>Math.max(0,H-1)),setTimeout(()=>{l("none"),r()},800)},600));const X=k?Me.EASY:Me.FORGOT,n=wt(P,X);n.lastReviewSessionType="boss_battle",await vt(n)},r=o=>{C(k=>(G(X=>(k<=0?N("won"):X<=0?N("lost"):(K(n=>n+1),N("fighting")),X)),k))},u=o=>{const k=Math.floor(o/60),X=o%60;return`${k}:${X.toString().padStart(2,"0")}`},a=o=>{var k,X;return!(o.type==="SPELLING"||o.type==="COLLOCATION_QUIZ"&&(((k=o.word.collocationsArray)==null?void 0:k.filter(H=>!H.isIgnored&&H.d))||[]).length>2||o.type==="PARAPHRASE_QUIZ"&&(((X=o.word.paraphrases)==null?void 0:X.filter(H=>!H.isIgnored))||[]).length>2)},i=async()=>{if((s.adventure.hpPotions||0)<=0)return;if(O>=ve){f("Health is already full!","info");return}G(k=>Math.min(ve,k+1));const o={...s.adventure};o.hpPotions=(o.hpPotions||0)-1,await J({...s,adventure:o}),f("+1 HP Recovered!","success")},c=async()=>{if((s.adventure.wisdomFruits||0)<=0)return;if(b){f("Hint is already active!","info");return}m(!0);const o={...s.adventure};o.wisdomFruits=(o.wisdomFruits||0)-1,await J({...s,adventure:o}),f("Wisdom Fruit Used! Hint revealed.","success")},h=(s.adventure.hpPotions||0)>0||(s.adventure.wisdomFruits||0)>0;if(D==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:g.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:g.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',g.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>N("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(Le,{size:24})," FIGHT!"]})]});if(D==="won"||D==="lost"){const o=D==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${o?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!o&&"grayscale opacity-50"}`,children:o?"üèÜ":"üíÄ"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${o?"text-emerald-400":"text-red-500"}`,children:o?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:o?`"${g.dialogueWin}"`:`"${g.dialogueLose}"`}),e.jsx("button",{onClick:o?x:V,className:`px-8 py-3 font-bold rounded-xl transition-all ${o?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:o?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:g.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${Y/g.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(et,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[Y," / ",g.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${d==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:g.image}),d==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"üí•"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-hidden",children:[W==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(Gt,{className:"fill-cyan-400 rotate-45",size:48})}),W==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(mt,{className:"fill-red-900",size:48})}),e.jsxs("div",{className:`absolute top-4 right-4 flex items-center gap-2 px-4 py-2 rounded-xl font-mono font-black border-2 backdrop-blur-md z-20 transition-all duration-300 ${U<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(bt,{size:18,className:U<60?"animate-spin":""}),e.jsx("span",{className:"text-lg tracking-widest",children:u(U)})]}),e.jsx("button",{onClick:()=>j(!B),className:`absolute top-4 left-4 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 z-20 group ${B?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(gt,{size:24}),h&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),B&&e.jsxs("div",{className:"absolute top-16 left-4 z-40 bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-left-4 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üß™"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:i,disabled:(s.adventure.hpPotions||0)<=0||O>=ve,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üçé"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",s.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:c,disabled:(s.adventure.wisdomFruits||0)<=0||b,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]}),D==="fighting"&&P?e.jsx("div",{className:"w-full max-w-md h-full max-h-[420px] z-10 animate-in zoom-in-95 duration-300 flex items-center",children:e.jsx(jt,{word:P,isQuickFire:!0,onComplete:v,onClose:_,isModal:!1,disableHints:!b,forceShowHint:b,challengeFilter:a,skipRecap:!0})}):D==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[d==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"üí•"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${d==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:s.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:ve}).map((o,k)=>e.jsx(et,{size:18,fill:k<O?"#ef4444":"none",className:`transition-all duration-300 ${k<O?"text-red-500 scale-100":"text-slate-600 scale-90"}`},k))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `})]})},ls=({isOpen:s,onClose:g,badges:M,hpPotions:x,wisdomFruits:V,onUseBadge:_})=>{if(!s)return null;const J=new Set(M.filter(Y=>Y!=="locked_chest")).size,f=Object.keys(Ne).filter(Y=>Y!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(ut,{size:20})," T√∫i ƒë·ªì"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"V·∫≠t ph·∫©m & Huy hi·ªáu thu th·∫≠p ƒë∆∞·ª£c."})]}),e.jsx("button",{type:"button",onClick:g,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(Le,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üß™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",x]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üçé"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",V]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(oe,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[J,"/",f]})]}),M.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Ch∆∞a c√≥ huy hi·ªáu."}),e.jsx("p",{className:"text-xs",children:"M·ªü R∆∞∆°ng ho·∫∑c ƒë√°nh Boss ƒë·ªÉ nh·∫≠n."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:M.map((Y,C)=>{const O=Ne[Y];if(!O)return null;const G=Y==="locked_chest"||Y==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:O.icon}),G&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:O.name}),G&&e.jsxs("button",{onClick:()=>_(Y),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(Yt,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${Y}-${C}`)})})]})]})]})})},rs=30,ns=({onComplete:s,badge:g})=>{const[M]=t.useState(()=>Array.from({length:rs}).map((x,V)=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return g?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:M.map((x,V)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${x.size}px`,height:`${x.size}px`,backgroundColor:x.color,transform:`rotate(${x.angle}deg) translate(${x.distance}px)`,opacity:0,animation:`explode ${x.duration}s ease-out ${x.delay}s forwards`}},V))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:g.icon}),e.jsx(De,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx(De,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:g.name})]}),e.jsx("button",{onClick:s,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(Re,{size:16})]})})]})]}):null},_e=({user:s,onExit:g,onUpdateUser:M})=>{const{showToast:x}=pe(),[V,_]=t.useState(null),[J,f]=t.useState(!1),[Y,C]=t.useState(null);t.useEffect(()=>{if(!s.adventure.map){const d=Ke(100);M({...s,adventure:{...s.adventure,map:d}})}},[]);const O=s.adventure.map||Ke(100),G=async()=>{const d={...s.adventure};if(d.energy<=0){x("Not enough energy to move!","error");return}d.energy-=1;const l=d.currentNodeIndex+1;d.currentNodeIndex=l;const D=O[l];D&&(D.type==="standard"?(d.energyShards=(d.energyShards||0)+1,x("+1 Energy Shard ‚ö°","success",2e3)):D.type==="key_fragment"?(d.keyFragments=(d.keyFragments||0)+1,x("Picked up a Key Fragment üóùÔ∏è","success",3e3),d.keyFragments>=3&&(d.keyFragments-=3,d.keys=(d.keys||0)+1,x("‚ú® Key Fragments assembled into a Magic Key!","success",4e3))):D.type==="treasure"&&(d.badges=[...d.badges||[],"locked_chest"],x("Picked up a Locked Chest! üß∞ (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(d.hpPotions=(d.hpPotions||0)+1,x("You found an HP Potion! üß™","success",4e3)):(d.wisdomFruits=(d.wisdomFruits||0)+1,x("You found a Wisdom Fruit! üçé","success",4e3))),Math.random()<.2&&(d.badges=[...d.badges||[],"lucky_dice"],x("You found a Lucky Dice! üé≤","success",4e3)),await M({...s,adventure:d})},Q=async d=>{if(d.id===s.adventure.currentNodeIndex&&d.type==="boss"){if(d.isDefeated){x("This boss has already been defeated.","info");return}const l=lt().filter($=>$.userId===s.id);if(l.length===0){x("You have no words in your library to fight a boss. Add some words first!","error");return}const D=l.filter($=>$.lastReview);D.length<20&&x("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let N=[...D].sort(()=>.5-Math.random());if(N.length<20){const $=new Set(N.map(b=>b.id)),B=l.filter(b=>!$.has(b.id)),j=20-N.length;N.push(...[...B].sort(()=>.5-Math.random()).slice(0,j))}N=N.slice(0,20);const U={...d.boss_details,hp:20};_({boss:U,words:N})}},K=async()=>{x("Boss defeated! +1 Key Fragment","success");const d={...s.adventure};if(d.keyFragments=(d.keyFragments||0)+1,d.keyFragments>=3&&(d.keyFragments-=3,d.keys=(d.keys||0)+1,x("Key Fragments assembled into a Magic Key!","success",4e3)),d.map){const l=[...d.map],D=d.currentNodeIndex;l[D]&&(l[D]={...l[D],isDefeated:!0}),d.map=l}await M({...s,adventure:d}),_(null)},W=async d=>{const l={...s.adventure};if(l.badges=l.badges||[],d==="locked_chest"){if((l.keys||0)<=0){x("You need a Magic Key üóùÔ∏è to open this chest!","error");return}l.keys-=1;const D=l.badges.indexOf("locked_chest");D>-1&&l.badges.splice(D,1);const N=Object.keys(Ne).filter(j=>j!=="locked_chest"&&j!=="lucky_dice"),U=l.badges||[],$=N.filter(j=>!U.includes(j));let B;$.length>0?B=$[Math.floor(Math.random()*$.length)]:B=N[Math.floor(Math.random()*N.length)],l.badges.push(B),await M({...s,adventure:l}),C(Ne[B]),f(!1)}else if(d==="lucky_dice"){const D=l.badges.indexOf("lucky_dice");if(D>-1)l.badges.splice(D,1);else return;const N=Math.random();N<.2?(l.energy+=3,x("Dice rolled! +3 Energy ‚ö°","success",3e3)):N<.4?(l.keys=(l.keys||0)+1,x("Dice rolled! +1 Magic Key üóùÔ∏è","success",3e3)):N<.6?(l.badges.push("locked_chest"),x("Dice rolled! +1 Locked Chest üß∞","success",3e3)):N<.8?(l.hpPotions=(l.hpPotions||0)+1,x("Dice rolled! +1 HP Potion üß™","success",3e3)):(l.wisdomFruits=(l.wisdomFruits||0)+1,x("Dice rolled! +1 Wisdom Fruit üçé","success",3e3)),await M({...s,adventure:l})}else C(Ne[d])},E=async d=>{const l={...s.adventure};if(d==="add_energy")l.energy=(l.energy||0)+10,x("Admin: +10 Energy","success");else if(d==="remove_energy")l.energy=Math.max(0,(l.energy||0)-1),x("Admin: -1 Energy","info");else if(d==="add_key")l.keys=(l.keys||0)+1,x("Admin: +1 Key","success");else if(d==="remove_key")l.keys=Math.max(0,(l.keys||0)-1),x("Admin: -1 Key","info");else if(d==="add_hp")l.hpPotions=(l.hpPotions||0)+1,x("Admin: +1 HP Potion","success");else if(d==="remove_hp")l.hpPotions=Math.max(0,(l.hpPotions||0)-1),x("Admin: -1 HP Potion","info");else if(d==="add_fruit")l.wisdomFruits=(l.wisdomFruits||0)+1,x("Admin: +1 Wisdom Fruit","success");else if(d==="remove_fruit")l.wisdomFruits=Math.max(0,(l.wisdomFruits||0)-1),x("Admin: -1 Wisdom Fruit","info");else if(d==="pass_boss"){const D=O[l.currentNodeIndex];if(D&&D.type==="boss"){if(V){await K();return}if(x("Admin: Force Boss Victory","success"),l.keyFragments=(l.keyFragments||0)+1,l.keyFragments>=3&&(l.keyFragments-=3,l.keys=(l.keys||0)+1),l.map){const N=[...l.map],U=l.currentNodeIndex;N[U]&&(N[U]={...N[U],isDefeated:!0}),l.map=N}}else x("Not currently at a boss node.","info")}await M({...s,adventure:l})};return V?e.jsx(as,{user:s,boss:V.boss,words:V.words,onVictory:K,onDefeat:()=>{x("You were defeated. Study more and try again!","error"),_(null)},onExit:()=>_(null),onUpdateUser:M}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{user:s,progress:s.adventure,onExit:g,map:O,onMove:G,onNodeClick:Q,onOpenInventory:()=>f(!0),onAdminAction:E}),e.jsx(ls,{isOpen:J,onClose:()=>f(!1),badges:s.adventure.badges||[],onUseBadge:W,hpPotions:s.adventure.hpPotions||0,wisdomFruits:s.adventure.wisdomFruits||0}),Y&&e.jsx(ns,{badge:Y,onComplete:()=>C(null)})]})},Se=[{id:"i_ii",sym1:"…™",sym2:"iÀê",label:"Short i vs Long ee",example:"sit / seat",category:"VOWELS"},{id:"u_uu",sym1:" ä",sym2:"uÀê",label:"Short u vs Long oo",example:"full / fool",category:"VOWELS"},{id:"ae_e",sym1:"√¶",sym2:"e",label:"Short a vs Short e",example:"man / men",category:"VOWELS"},{id:"ae_v",sym1:"√¶",sym2:" å",label:"Short a vs Short u",example:"cat / cut",category:"VOWELS"},{id:"o_or",sym1:"…í",sym2:"…îÀê",label:"Short o vs Long aw",example:"cot / caught",category:"VOWELS"},{id:"er_or",sym1:"…úÀê",sym2:"…îÀê",label:"Stressed er vs aw",example:"bird / board",category:"VOWELS"},{id:"aa_ae",sym1:"…ëÀê",sym2:"√¶",label:"Long a vs Short a",example:"cart / cat",category:"VOWELS"},{id:"th_t",sym1:"Œ∏",sym2:"t",label:"Voiceless TH vs T",example:"think / tin",category:"CONSONANTS"},{id:"dh_d",sym1:"√∞",sym2:"d",label:"Voiced TH vs D",example:"this / dis",category:"CONSONANTS"},{id:"s_sh",sym1:"s",sym2:" É",label:"S vs SH",example:"see / she",category:"CONSONANTS"},{id:"ch_j",sym1:"t É",sym2:"d í",label:"CH vs J",example:"cheap / jeep",category:"CONSONANTS"},{id:"f_v",sym1:"f",sym2:"v",label:"F vs V",example:"fan / van",category:"CONSONANTS"},{id:"b_p",sym1:"b",sym2:"p",label:"B vs P",example:"bat / pat",category:"CONSONANTS"},{id:"k_g",sym1:"k",sym2:"g",label:"K vs G",example:"coat / goat",category:"CONSONANTS"},{id:"s_z",sym1:"s",sym2:"z",label:"S vs Z",example:"rice / rise",category:"CONSONANTS"},{id:"t_d_ed",sym1:"t",sym2:"d",label:"Past tense -ed",example:"worked / played",category:"CONSONANTS"},{id:"ng_n",sym1:"≈ã",sym2:"n",label:"Final NG vs N",example:"sing / sin",category:"CONSONANTS"},{id:"r_l",sym1:"r",sym2:"l",label:"R vs L",example:"right / light",category:"CONSONANTS"},{id:"ay_ae",sym1:"e…™",sym2:"√¶",label:"Diphthong ay vs Short a",example:"face / fat",category:"DIPHTHONGS"},{id:"ai_ii",sym1:"a…™",sym2:"iÀê",label:"Diphthong ai vs Long ee",example:"time / team",category:"DIPHTHONGS"},{id:"oh_aw",sym1:"…ô ä",sym2:"…îÀê",label:"Diphthong oh vs aw",example:"go / saw",category:"DIPHTHONGS"},{id:"ear_ee",sym1:"…™…ô",sym2:"iÀê",label:"ear vs ee",example:"here / he",category:"DIPHTHONGS"},{id:"air_ae",sym1:"e…ô",sym2:"√¶",label:"air vs short a",example:"hair / hat",category:"DIPHTHONGS"}],is=({words:s,onComplete:g,onExit:M,onBulkUpdate:x})=>{const[V,_]=t.useState("SETUP"),[J,f]=t.useState("MASTER"),[Y,C]=t.useState(null),[O,G]=t.useState([]),[Q,K]=t.useState(0),[W,E]=t.useState(null),d=t.useRef(new Map),l=(j,b)=>{if(!j)return!1;(b==="t"||b==="d")&&(j.includes("t É")||j.includes("d í"));const m=b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let z;return b==="d"?z=new RegExp(`${m}(?! í)`):b==="t"?z=new RegExp(`${m}(?! É)`):b===" É"?z=new RegExp(`(?<!t)${m}`):b===" í"?z=new RegExp(`(?<!d)${m}`):b==="…™"?z=new RegExp(`(?<![ae…î])${m}(?!…ô)`):b===" ä"?z=new RegExp(`(?<![a…ô])${m}`):b==="e"?z=new RegExp(`${m}(?!…™|…ô)`):b==="…ô"?z=new RegExp(`(?<![…™ äe])${m}(?! ä)`):z=new RegExp(m),z.test(j)},D=t.useMemo(()=>{const j=new Map,b=s.filter(m=>m.ipaUs&&m.ipaUs.length>2);return Se.forEach(m=>{const z=b.filter(u=>l(u.ipaUs,m.sym1)||l(u.ipaUs,m.sym2)),P=z.length,v=z.filter(u=>{const a=`IPA_SORTER:${m.id}`;return u.lastTestResults&&u.lastTestResults[a]===!0}).length,r=z.filter(u=>{const a=`IPA_SORTER:${m.id}`;return!u.lastTestResults||u.lastTestResults[a]!==!0}).length;j.set(m.id,{total:P,correct:v,availableForMaster:r})}),j},[s]),N=j=>{let m=s.filter(v=>v.ipaUs&&v.ipaUs.length>2).filter(v=>l(v.ipaUs,j.sym1)||l(v.ipaUs,j.sym2));if(J==="MASTER"&&(m=m.filter(v=>{const r=`IPA_SORTER:${j.id}`;return!v.lastTestResults||v.lastTestResults[r]!==!0})),m.length<3){alert(`Not enough words found for this mode (${m.length}). Try 'Review All' or add more words.`);return}const z=[],P=m.sort(()=>Math.random()-.5).slice(0,15);for(const v of P){const r=l(v.ipaUs,j.sym1),u=l(v.ipaUs,j.sym2),a=r&&u?Math.random()>.5?j.sym1:j.sym2:r?j.sym1:j.sym2,i=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let c;a==="d"?c=new RegExp(`${i}(?! í)`,"g"):a==="t"?c=new RegExp(`${i}(?! É)`,"g"):a===" É"?c=new RegExp(`(?<!t)${i}`,"g"):a===" í"?c=new RegExp(`(?<!d)${i}`,"g"):a==="…™"?c=new RegExp(`(?<![ae…î])${i}(?!…ô)`,"g"):a==="e"?c=new RegExp(`${i}(?!…™|…ô)`,"g"):c=new RegExp(i,"g");const h=v.ipaUs.replace(c,"___");z.push({id:v.id,wordObj:v,word:v.word,ipa:v.ipaUs,maskedIpa:h,targetSymbol:a})}G(z),C(j),K(0),_("PLAYING")},U=j=>{const b=O[0];if(!b||W||!Y)return;const m=b.targetSymbol===j;E({symbol:j,correct:m});const z=m?Q+10:Math.max(0,Q-5);K(z);const P=`IPA_SORTER:${Y.id}`,v={...b.wordObj};v.lastTestResults||(v.lastTestResults={}),v.lastTestResults[P]=m,v.updatedAt=Date.now(),d.current.set(v.id,v),setTimeout(()=>{const r=O.slice(1);G(r),E(null),r.length===0&&(x(Array.from(d.current.values())),d.current.clear(),g(z))},800)},$=()=>{d.current.size>0&&(x(Array.from(d.current.values())),d.current.clear()),V==="PLAYING"?_("SETUP"):M()};if(V==="SETUP"){const j=u=>{const a=D.get(u.id)||{total:0,correct:0,availableForMaster:0},i=a.total>=3,c=J==="ALL"?i:a.availableForMaster>=3,h=a.total>0?a.correct/a.total*100:0;let o;return i?h>=80?o="text-emerald-700 bg-emerald-100 border-emerald-200":h>0?o="text-amber-700 bg-amber-100 border-amber-200":o="text-rose-700 bg-rose-100 border-rose-200":o="text-neutral-300 bg-neutral-50 border-neutral-100",e.jsxs("button",{onClick:()=>c&&N(u),disabled:!c,className:`
                        w-full flex flex-col gap-1 p-3 rounded-xl border transition-all text-left relative overflow-hidden group shrink-0
                        ${c?"bg-white border-neutral-100 hover:border-indigo-400 hover:bg-indigo-50/30 cursor-pointer shadow-sm":"bg-neutral-50 border-neutral-100 opacity-60 cursor-not-allowed"}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-black text-neutral-800 font-serif",children:["/",u.sym1,"/ vs /",u.sym2,"/"]}),!i&&e.jsx($t,{size:10,className:"text-neutral-400"})]}),i&&e.jsxs("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-full border ${o}`,children:[a.correct,"/",a.total]})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 font-medium truncate",children:u.example})]},u.id)},b=Se.filter(u=>u.category==="VOWELS"),m=Se.filter(u=>u.category==="DIPHTHONGS"),z=Se.filter(u=>u.category==="CONSONANTS"),P=Math.ceil(z.length/2),v=z.slice(0,P),r=z.slice(P);return e.jsxs("div",{className:"flex flex-col h-full relative p-6 bg-white animate-in fade-in",children:[e.jsxs("header",{className:"flex flex-col gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:$,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Back"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:"Phonetic Accuracy"}),e.jsx("p",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-widest",children:"Select a pair to practice"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 self-center",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>f("MASTER"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="MASTER"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(oe,{size:10,fill:J==="MASTER"?"currentColor":"none"})," Master It"]}),e.jsxs("button",{onClick:()=>f("ALL"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="ALL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(He,{size:10})," Review All"]})]}),e.jsx("p",{className:"text-[9px] text-neutral-400 font-bold",children:J==="MASTER"?"Focus on unmastered words":"Practice with full library"})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-indigo-400 tracking-widest px-1 border-b border-neutral-100",children:"Vowels"}),e.jsx("div",{className:"flex flex-col gap-2",children:b.map(j)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:v.map(j)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100 md:text-transparent select-none",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:r.map(j)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-amber-400 tracking-widest px-1 border-b border-neutral-100",children:"Diphthongs"}),e.jsx("div",{className:"flex flex-col gap-2",children:m.map(j)})]})]})})]})}const B=O[0];return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 shrink-0",children:[e.jsxs("button",{onClick:$,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Pairs"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:Q}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),Y&&e.jsx("div",{className:"text-center mb-6 animate-in slide-in-from-top-2",children:e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold border border-indigo-100",children:[Y.label," ",e.jsx("span",{className:"opacity-50 mx-1",children:"‚Ä¢"})," ",e.jsx("span",{className:"italic font-normal",children:Y.example})]})}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:B?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:B.word}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:B.maskedIpa.split("___").map((j,b,m)=>e.jsxs(We.Fragment,{children:[j,b<m.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},b))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Which sound fits?"})]}):e.jsxs("div",{className:"text-neutral-300 font-black text-xl flex flex-col items-center gap-2",children:[e.jsx(le,{size:40,className:"text-green-500"}),e.jsx("span",{children:"Session Complete"})]})}),e.jsx("div",{className:"h-40 grid grid-cols-2 gap-6 mt-4 shrink-0 max-w-lg mx-auto w-full",children:[Y.sym1,Y.sym2].map((j,b)=>{const m=W&&W.symbol===j,z=m&&W.correct,P=m&&!W.correct;let v="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4 shadow-sm",r="text-neutral-400 group-hover:text-indigo-400";return z?(v+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600 ring-4 ring-emerald-100",r="text-emerald-500"):P?(v+=" bg-rose-50 border-solid border-rose-400 text-rose-600 ring-4 ring-rose-100",r="text-rose-500"):v+=" bg-white border-neutral-200 hover:border-indigo-400 hover:shadow-lg hover:-translate-y-1 active:scale-95",e.jsxs("button",{onClick:()=>U(j),disabled:!!W||!B,className:v,children:[e.jsxs("span",{className:"text-6xl font-serif font-medium mb-1",children:["/",j,"/"]}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${r}`,children:"Tap to Select"})]},b)})})]})]})},os=({words:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState("MEDIUM"),[f,Y]=t.useState(10),[C,O]=t.useState([]),[G,Q]=t.useState([]),[K,W]=t.useState(new Set),[E,d]=t.useState(null),[l,D]=t.useState(0),[N,U]=t.useState(0),$=(u,a)=>{const i=u.split(/\s+/).filter(Boolean);if(a==="HARD")return i;const c=[];let h=0;const o=a==="EASY"?3:2;for(;h<i.length;){const k=Math.floor(Math.random()*o)+1,X=i.slice(h,h+k).join(" ");c.push(X),h+=k}return c},B=()=>{const u=s.filter(c=>c.example&&c.example.trim().split(/\s+/).filter(Boolean).length>=5);if(u.length<5){alert("Not enough words with suitable example sentences (need at least 5).");return}const i=[...u].sort(()=>Math.random()-.5).slice(0,f).map(c=>{const h=c.example.trim(),k=[...$(h,_)].sort(()=>Math.random()-.5);return{id:c.id,word:c.word,originalSentence:h,shuffledChunks:k}});O(i),V("PLAYING"),D(0),j()},j=()=>{Q([]),W(new Set),U(0),d(null)},b=C[0],m=(u,a)=>{if(E!==null)return;const i=[...G];i.splice(N,0,u),Q(i),W(c=>new Set(c).add(a)),U(c=>c+1)},z=u=>{if(E!==null)return;const a=G[u],i=G.filter((o,k)=>k!==u);Q(i),N>u&&U(o=>o-1);const c=b.shuffledChunks;let h=!1;W(o=>{const k=new Set(o);for(let X=0;X<c.length;X++)c[X]===a&&k.has(X)&&!h&&(k.delete(X),h=!0);return k})},P=()=>{const u=G.join(" ").toLowerCase().trim(),a=b.originalSentence.toLowerCase().trim();u===a?(d(!0),D(i=>i+(_==="HARD"?25:_==="MEDIUM"?15:10)),setTimeout(()=>{const i=C.slice(1);O(i),i.length===0?g(l+(_==="HARD"?25:15)):j()},1e3)):(d(!1),D(i=>Math.max(0,i-5)),setTimeout(()=>d(null),1500))},v=()=>{const u=C.slice(1);O(u),u.length===0?g(l):j()},r=({index:u})=>{const a=u===N;return e.jsx("div",{onClick:()=>U(u),className:`h-8 w-2 rounded-full cursor-pointer transition-all duration-200 mx-0.5 flex items-center justify-center ${a?"bg-indigo-500 scale-110 shadow-sm":"bg-transparent hover:bg-neutral-200"}`,children:e.jsx("div",{className:`w-1 h-4 rounded-full ${a?"bg-white/50":"bg-transparent"}`})})};if(x==="SETUP"){const u=({id:a,label:i,icon:c,desc:h})=>e.jsxs("button",{onClick:()=>J(a),className:`p-4 rounded-2xl border-2 transition-all text-left flex flex-col gap-2 ${_===a?"border-emerald-500 bg-emerald-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${_===a?"bg-emerald-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(c,{size:16})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${_===a?"text-emerald-700":"text-neutral-500"}`,children:i})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:h})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in max-w-5xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(yt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Sentence Scramble"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Reconstruct examples to master syntax and flow."})]}),e.jsx("div",{className:"w-full max-w-sm space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(u,{id:"EASY",label:"Easy",icon:He,desc:"Chunks of 1-3 words. Great for collocations."}),e.jsx(u,{id:"MEDIUM",label:"Medium",icon:oe,desc:"Chunks of 1-2 words. More challenging."}),e.jsx(u,{id:"HARD",label:"Hard",icon:Ye,desc:"Individual words only. True mastery."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-emerald-600",children:f})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:f,onChange:a=>Y(parseInt(a.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Back"}),e.jsxs("button",{onClick:B,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Scramble ‚Ä¢ ",_]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${(1-C.length/f)*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:l})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:b?e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300 decoration-2 underline-offset-4",children:b.word})]}),e.jsx("button",{onClick:()=>ge(b.originalSentence),className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl hover:bg-emerald-100 transition-all active:scale-90",title:"Hear full sentence",children:e.jsx(Ue,{size:24})})]}),e.jsx("p",{className:"text-neutral-400 text-xs font-bold uppercase tracking-widest",children:"Tap chunks to insert at cursor"})]}),e.jsx("div",{className:`w-full max-w-3xl bg-neutral-50 rounded-[2.5rem] border-2 border-dashed p-8 transition-all ${E===!0?"border-emerald-400 bg-emerald-50":E===!1?"border-rose-400 bg-rose-50 animate-shake":"border-neutral-200"}`,children:e.jsxs("div",{className:"flex flex-wrap gap-y-3 items-center justify-center min-h-[60px]",children:[G.length===0&&e.jsx("span",{className:"absolute text-lg font-bold text-neutral-300 italic pointer-events-none",children:"Draft your sentence here..."}),e.jsx(r,{index:0}),G.map((u,a)=>e.jsxs(We.Fragment,{children:[e.jsx("button",{onClick:()=>z(a),className:`px-4 py-2 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 animate-in zoom-in-95 flex items-center gap-1 group ${E===!0?"bg-emerald-600 text-white":E===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-red-200 hover:text-red-500"}`,children:u}),e.jsx(r,{index:a+1})]},`${u}-${a}`))]})}),e.jsx("div",{className:"w-full max-w-3xl bg-neutral-100 rounded-[2.5rem] p-8 flex flex-wrap gap-3 justify-center",children:b.shuffledChunks.map((u,a)=>e.jsx("button",{onClick:()=>m(u,a),disabled:K.has(a),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${K.has(a)?"bg-neutral-200 text-neutral-400 cursor-not-allowed opacity-30":"bg-white text-neutral-700 border-2 border-white hover:border-emerald-300 hover:text-neutral-900"}`,children:u},a))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:v,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsxs("button",{onClick:P,disabled:G.length===0||E!==null,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(we,{size:18})," Check"]})]}),E===!1&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 p-4 bg-emerald-50 rounded-2xl border border-emerald-100 text-center max-w-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Original Sentence"}),e.jsxs("p",{className:"text-sm font-bold text-emerald-900 italic",children:['`"`',b.originalSentence,'`"`']})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Preparing..."})})]})},cs=["in","on","at","to","for","with","of","from","by","about","into","through","over","under","between","among","against","during","without","before","after","toward","upon","within","along"].sort(),ds=({words:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState(10),[f,Y]=t.useState([]),[C,O]=t.useState(0),[G,Q]=t.useState(""),[K,W]=t.useState(null),[E,d]=t.useState(0),[l,D]=t.useState([]),[N,U]=t.useState(0),[$,B]=t.useState(!1),j=t.useRef(null),b=t.useRef(null),m=()=>{const a=s.filter(h=>h.prepositions&&h.prepositions.some(o=>!o.isIgnored)&&h.example);if(a.length<3){alert("Not enough vocabulary with prepositions and examples found in your library.");return}const i=[...a].sort(()=>Math.random()-.5),c=[];for(const h of i){if(c.length>=_)break;const k=[...h.prepositions.filter(X=>!X.isIgnored)].sort(()=>Math.random()-.5);for(const X of k){const n=h.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),H=new RegExp(`\\b${n}\\s+${X.prep}\\b`,"i");if(H.test(h.example)){const y=h.example.split(".")[0]+".";if(H.test(y)){const L=y.replace(H,`${h.word} ___`);c.push({id:`${h.id}-${X.prep}`,word:h.word,example:L,answer:X.prep.toLowerCase(),meaning:h.meaningVi});break}}}}if(c.length<1){alert("Could not generate questions from existing data.");return}Y(c),V("PLAYING"),O(0),d(0),Q(""),W(null)},z=f[C];t.useEffect(()=>{x==="PLAYING"&&j.current&&j.current.focus()},[C,x]);const P=a=>{if(!z||K===!0)return;const c=(a!==void 0?a:G).trim().toLowerCase()===z.answer;W(c),B(!1),c?(d(h=>h+15),setTimeout(()=>{C<f.length-1?(O(h=>h+1),Q(""),W(null)):g(E+15)},800)):(d(h=>Math.max(0,h-5)),setTimeout(()=>W(null),800))},v=a=>{if(Q(a),a.trim()){const i=cs.filter(c=>c.startsWith(a.toLowerCase())&&c!==a.toLowerCase());D(i),U(0),B(i.length>0)}else B(!1)},r=a=>{if(!$){a.key==="Enter"&&P();return}switch(a.key){case"ArrowDown":a.preventDefault(),U(i=>(i+1)%l.length);break;case"ArrowUp":a.preventDefault(),U(i=>(i-1+l.length)%l.length);break;case"Enter":case"Tab":{a.preventDefault();const i=l[N];Q(i),B(!1),P(i);break}case"Escape":B(!1);break}};if(x==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 text-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(oe,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Preposition Power"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Master dependent prepositions in IELTS contexts with smart suggestions."})]}),e.jsx("div",{className:"w-full max-w-sm bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-violet-600",children:_})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:_,onChange:a=>J(parseInt(a.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-violet-500"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:m,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start Practice"]})]})]});const u=C/f.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-8 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-10 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Exit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Question ",C+1," / ",f.length]}),e.jsx("div",{className:"h-1.5 w-40 bg-neutral-100 rounded-full mt-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-500",style:{width:`${u}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest min-w-[80px] text-center",children:E})]}),e.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center space-y-12 max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:`w-full bg-neutral-50 border-2 rounded-[3rem] p-10 md:p-16 text-center space-y-8 transition-all duration-300 ${K===!0?"border-emerald-400 bg-emerald-50/30":K===!1?"border-rose-400 bg-rose-50/30 animate-shake":"border-neutral-100 shadow-sm"}`,children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("span",{className:"px-3 py-1 bg-violet-100 text-violet-700 rounded-lg text-[10px] font-black uppercase tracking-widest border border-violet-200",children:"Fill Blank"})})}),e.jsx("div",{className:"text-xl md:text-2xl font-medium text-neutral-700 leading-relaxed min-h-[4rem]",children:z.example.split("___").map((a,i,c)=>e.jsxs(We.Fragment,{children:[e.jsx("span",{children:a}),i<c.length-1&&e.jsxs("div",{className:"inline-block mx-2 relative",children:[e.jsx("input",{ref:j,type:"text",value:G,onChange:h=>v(h.target.value),onKeyDown:r,disabled:K===!0,placeholder:"...",className:`
                                                w-[5ch] min-w-[100px] text-center bg-transparent border-b-4 outline-none font-black transition-all
                                                ${K===!0?"border-emerald-500 text-emerald-600":K===!1?"border-rose-500 text-rose-600":"border-neutral-300 focus:border-violet-600 text-neutral-900"}
                                            `,autoComplete:"off"}),K===!0&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 animate-bounce text-emerald-500",children:e.jsx(we,{size:20,strokeWidth:4})}),$&&e.jsx("div",{ref:b,className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 w-32 bg-white rounded-2xl shadow-2xl border border-neutral-100 z-50 overflow-hidden animate-in fade-in zoom-in-95",children:l.map((h,o)=>e.jsx("button",{onClick:()=>{Q(h),B(!1),P(h)},className:`w-full px-4 py-2.5 text-sm font-bold text-left transition-colors ${N===o?"bg-violet-500 text-white":"text-neutral-600 hover:bg-neutral-50"}`,children:h},h))})]})]},i))})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsxs("button",{onClick:()=>{C<f.length-1?(O(a=>a+1),Q(""),W(null)):g(E)},className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all flex items-center gap-2",children:["Skip ",e.jsx($e,{size:18})]}),e.jsx("button",{onClick:()=>P(),disabled:G.trim().length===0||K===!0,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-30 flex items-center gap-2",children:"Check Answer"})]})]}),e.jsxs("footer",{className:"mt-auto pt-8 flex items-center justify-between text-[10px] font-black uppercase text-neutral-300 tracking-widest border-t border-neutral-50",children:[e.jsx("span",{children:"IELTS VOCAB PRO ‚Ä¢ PREPOSITION POWER"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{size:12}),e.jsx("span",{children:"Type to see autocomplete suggestions"})]}),e.jsxs("span",{children:["LEVEL ",C+1]})]})]})},xs=({words:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState("MIX"),[f,Y]=t.useState("MEDIUM"),[C,O]=t.useState(8),[G,Q]=t.useState([]),[K,W]=t.useState([]),[E,d]=t.useState(null),[l,D]=t.useState(null),[N,U]=t.useState(0),$=()=>{const r=[];if(s.forEach(o=>{(_==="PARAPHRASE"||_==="MIX")&&(o.paraphrases||[]).filter(k=>!k.isIgnored&&k.context&&k.context.trim()).forEach(k=>{r.push({context:k.context,fullText:k.word,headword:o.word,pairId:`${o.id}-p-${k.word}`})}),(_==="COLLOCATION"||_==="MIX")&&(o.collocationsArray||[]).filter(k=>!k.isIgnored&&k.d&&k.d.trim()).forEach(k=>{r.push({context:k.d,fullText:k.text,headword:o.word,pairId:`${o.id}-c-${k.text}`})}),(_==="IDIOM"||_==="MIX")&&(o.idiomsList||[]).filter(k=>!k.isIgnored&&k.d&&k.d.trim()).forEach(k=>{r.push({context:k.d,fullText:k.text,headword:o.word,pairId:`${o.id}-i-${k.text}`})})}),r.length<5){alert("Not enough items found. Add more variations or idioms to your library.");return}const u=Math.min(r.length,C),a=[...r].sort(()=>.5-Math.random()).slice(0,u),i=a.map(o=>{const k=o.fullText.split(/\s+/);if(k.length>1){const X=k.findIndex(H=>H.toLowerCase().includes(o.headword.toLowerCase())),n=X===-1?0:X===0?k.length-1:0;return k[n].replace(/[^a-zA-Z]/g,"")}return o.fullText}),c=[],h=[];a.forEach((o,k)=>{let X,n=o.fullText,H=!1;const y=o.fullText.split(/\s+/);if(y.length>1){const w=y.findIndex(A=>A.toLowerCase().includes(o.headword.toLowerCase())),R=w===-1?0:w===0?y.length-1:0;n=y[R].replace(/[^a-zA-Z]/g,""),X=y.map((A,T)=>T===R?"___":A).join(" ")}else n=o.fullText,X=o.fullText,H=!0;const L=i.filter((w,R)=>R!==k&&w.toLowerCase()!==n.toLowerCase()),S=[n,...Array.from(new Set(L))].sort(()=>.5-Math.random()).slice(0,5);S.includes(n)||(S[Math.floor(Math.random()*S.length)]=n);const I={text:X,fullText:o.fullText,headword:o.headword,context:o.context,partnerWord:n,choices:S,pairId:o.pairId};c.push({...I,id:`ctx-${o.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1}),h.push({...I,id:`itm-${o.pairId}`,isLinked:!1,isFilled:H,isSelected:!1,isDone:!1,error:!1})}),Q(c),W(h.sort(()=>.5-Math.random())),U(0),d(null),D(null),V("PLAYING")},B=(r,u,a)=>{const i=u.find(h=>h.pairId===r),c=a.find(h=>h.pairId===r);i!=null&&i.isLinked&&(c!=null&&c.isFilled)&&(i.isDone=!0,c.isDone=!0,U(o=>o+(f==="HARD"?25:f==="MEDIUM"?15:10)),u.every(o=>o.isDone)&&setTimeout(()=>g(N+25),1e3))},j=(r,u)=>{const a=G.find(c=>c.id===r),i=K.find(c=>c.id===u);if(!(!a||!i))if(a.pairId===i.pairId){const c=G.map(o=>o.id===r?{...o,isLinked:!0,isSelected:!1}:o),h=K.map(o=>o.id===u?{...o,isLinked:!0,isSelected:!1}:o);Q(c),W(h),d(null),D(null),B(a.pairId,c,h)}else Q(c=>c.map(h=>h.id===r?{...h,error:!0}:h)),W(c=>c.map(h=>h.id===u?{...h,error:!0}:h)),U(c=>Math.max(0,c-5)),setTimeout(()=>{Q(c=>c.map(h=>({...h,error:!1,isSelected:!1}))),W(c=>c.map(h=>({...h,error:!1,isSelected:!1}))),d(null),D(null)},600)},b=r=>{const u=G.find(a=>a.id===r);!u||u.isDone||(l?j(r,l):(d(r===E?null:r),Q(a=>a.map(i=>({...i,isSelected:i.id===r?!i.isSelected:!1})))))},m=r=>{const u=K.find(a=>a.id===r);!u||u.isDone||(E?j(E,r):(D(r===l?null:r),W(a=>a.map(i=>({...i,isSelected:i.id===r?!i.isSelected:!1})))))},z=(r,u)=>{const a=K.find(c=>c.pairId===r);if(!a||a.isDone)return;if(u.trim().toLowerCase()===a.partnerWord.toLowerCase()){const c=K.map(h=>h.pairId===r?{...h,isFilled:!0,text:h.fullText}:h);W(c),B(r,G,c)}else u.trim().length>0&&!a.choices.includes(u)&&(W(c=>c.map(h=>h.pairId===r?{...h,error:!0}:h)),setTimeout(()=>W(c=>c.map(h=>({...h,error:!1}))),600))},P=r=>r.isDone?"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default shadow-none":r.error?"bg-red-50 border-red-500 text-red-700 animate-shake":r.isSelected?"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-[1.02]":r.isLinked?"bg-indigo-50 border-indigo-300 text-indigo-900 shadow-sm":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-400 hover:bg-neutral-50 cursor-pointer shadow-sm";if(x==="SETUP"){const r=({type:a,label:i,icon:c})=>e.jsxs("button",{onClick:()=>J(a),className:`flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all min-w-[70px] ${_===a?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-300"}`,children:[e.jsx(c,{size:20,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:i})]}),u=({level:a,label:i,desc:c})=>e.jsxs("button",{onClick:()=>Y(a),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f===a?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===a?"text-indigo-700":"text-neutral-400"}`,children:i}),f===a&&e.jsx(we,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:c})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center text-center space-y-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(oe,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Context Match Setup"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm mx-auto",children:"Link meanings and fill the blanks."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[e.jsx(r,{type:"PARAPHRASE",label:"Paraphrase",icon:oe}),e.jsx(r,{type:"COLLOCATION",label:"Collocation",icon:dt}),e.jsx(r,{type:"IDIOM",label:"Idiom",icon:kt}),e.jsx(r,{type:"MIX",label:"Mix All",icon:He})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Items"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:C})]}),e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:C,onChange:a=>O(parseInt(a.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(u,{level:"EASY",label:"Easy",desc:"Match definitions to phrases. No typing required."}),e.jsx(u,{level:"MEDIUM",label:"Medium",desc:"Match meanings and select the missing word from a dropdown."}),e.jsx(u,{level:"HARD",label:"Hard",desc:"Match meanings and type the missing word from memory."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md mb-auto",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:$,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}const v=G.filter(r=>r.isDone).length/G.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Context Match ‚Ä¢ ",f]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:`${v}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:N})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 no-scrollbar pb-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," Definition & Headword"]}),G.map(r=>e.jsxs("button",{onClick:()=>b(r.id),className:`relative w-full p-5 rounded-[2rem] border-2 text-left transition-all duration-200 flex flex-col gap-2 ${P(r)}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-black tracking-tight ${r.isSelected?"text-white":"text-indigo-600"}`,children:r.headword}),e.jsxs("div",{className:"flex gap-2",children:[r.isLinked&&e.jsx(tt,{size:16,className:r.isSelected?"text-white":"text-indigo-400"}),r.isDone&&e.jsx(le,{size:18,className:"text-emerald-500"})]})]}),e.jsx("p",{className:`font-medium text-sm leading-relaxed ${r.isSelected?"text-indigo-100":"text-neutral-600"}`,children:r.context})]},r.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:12})," Target Phrase"]}),K.map(r=>e.jsxs("div",{onClick:()=>m(r.id),className:`relative w-full p-6 rounded-[2rem] border-2 text-left transition-all duration-200 ${P(r)}`,children:[e.jsx("div",{className:`text-lg font-bold flex flex-wrap items-center gap-x-2 leading-relaxed ${r.isSelected?"text-white":"text-neutral-900"}`,children:r.text.split(" ").map((u,a)=>u!=="___"?e.jsx("span",{children:u},a):f==="MEDIUM"?e.jsxs("div",{className:"inline-flex items-center gap-1 bg-white border-2 border-indigo-200 rounded-xl px-2 py-1 shadow-sm",onClick:i=>i.stopPropagation(),children:[e.jsxs("select",{disabled:r.isDone,className:`appearance-none bg-transparent text-sm font-black outline-none pr-6 relative ${r.isFilled?"text-emerald-600":"text-indigo-700"}`,onChange:i=>z(r.pairId,i.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),r.choices.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsx(Be,{size:14,className:"text-indigo-400 pointer-events-none -ml-5"})]},a):f==="HARD"?e.jsx("input",{type:"text",disabled:r.isDone,onClick:i=>i.stopPropagation(),className:`w-32 px-3 py-1 bg-white border-2 rounded-xl text-sm font-black outline-none transition-all ${r.isFilled?"border-emerald-500 text-emerald-600":"border-indigo-200 text-indigo-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"}`,placeholder:"...",onKeyDown:i=>{i.key==="Enter"&&z(r.pairId,i.currentTarget.value)}},a):e.jsx("span",{className:"text-neutral-300 font-black",children:"_____"},a))}),e.jsxs("div",{className:"absolute top-4 right-6 flex gap-2",children:[r.isLinked&&e.jsx(tt,{size:16,className:r.isSelected?"text-white":"text-indigo-400"}),r.isDone&&e.jsx(le,{size:18,className:"text-emerald-500"})]})]},r.id))]})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsxs("button",{onClick:()=>V("SETUP"),className:"flex items-center gap-2 text-xs font-black uppercase tracking-widest text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(nt,{size:14})," Restart"]})})]})]})},Ce=10,st=50;function ye(s){const g=[...s];for(let M=g.length-1;M>0;M--){const x=Math.floor(Math.random()*(M+1));[g[M],g[x]]=[g[x],g[M]]}return g}const us=({words:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState("MATRIX"),[f,Y]=t.useState(12),[C,O]=t.useState({library:!0,collocations:!0,idioms:!0}),[G,Q]=t.useState([]),[K,W]=t.useState([]),[E,d]=t.useState([]),[l,D]=t.useState([]),[N,U]=t.useState(0),[$,B]=t.useState(0),[j,b]=t.useState(new Set),[m,z]=t.useState(null),[P,v]=t.useState(null),r=t.useMemo(()=>l.map((n,H)=>({...n,originalIndex:H})).filter(n=>!j.has(n.id)),[l,j]);t.useEffect(()=>{if(x!=="PLAYING")return;const n=[];if(s.forEach(R=>{C.library&&R.meaningVi&&R.meaningVi.trim()&&n.push({text:R.word,d:R.meaningVi,cueId:`cue-${R.id}-word`}),C.collocations&&(R.collocationsArray||[]).filter(T=>!T.isIgnored&&T.d&&T.d.trim()).forEach((T,p)=>{n.push({text:T.text,d:T.d,cueId:`cue-${R.id}-col-${p}`})}),C.idioms&&(R.idiomsList||[]).filter(T=>!T.isIgnored&&T.d&&T.d.trim()).forEach((T,p)=>{n.push({text:T.text,d:T.d,cueId:`cue-${R.id}-idm-${p}`})})}),n.length<Ce){alert(`Not enough items found (found ${n.length}, need min ${Ce}).`),V("SETUP");return}const y=ye(n).slice(0,f),L=[],S=[],I=[],w=[];y.forEach(R=>{const A=R.cueId;L.push({id:A,text:R.d}),S.push({id:`card-${A}`,text:R.text,cueId:A,pairId:A,state:"default",type:"word"}),I.push({id:`l-${A}`,text:R.text,cueId:A,pairId:A,state:"default",type:"word"}),w.push({id:`r-${A}`,text:R.d,cueId:A,pairId:A,state:"default",type:"meaning"})}),Q(ye(S)),W(ye(I)),d(ye(w)),D(ye(L)),U(0),B(0),b(new Set),z(null),v(null)},[x,f,s,C]),t.useEffect(()=>{x==="PLAYING"&&f>0&&j.size===f&&setTimeout(()=>g($),800)},[x,j,f,$,g]);const u=n=>{const H=l[N];!H||j.has(H.id)||n.state!=="default"||(n.cueId===H.id?(B(y=>y+10),Q(y=>y.map(L=>L.id===n.id?{...L,state:"correct"}:L)),W(y=>y.map(L=>L.pairId===n.pairId?{...L,state:"correct"}:L)),d(y=>y.map(L=>L.pairId===n.pairId?{...L,state:"correct"}:L)),setTimeout(()=>{const y=new Set(j).add(H.id);b(y);let L=-1;for(let S=N+1;S<l.length;S++)if(!y.has(l[S].id)){L=S;break}if(L===-1){for(let S=0;S<N;S++)if(!y.has(l[S].id)){L=S;break}}L!==-1&&U(L)},400)):(B(y=>Math.max(0,y-5)),Q(y=>y.map(L=>L.id===n.id?{...L,state:"incorrect"}:L)),setTimeout(()=>{Q(y=>y.map(L=>L.id===n.id?{...L,state:"default"}:L))},600)))},a=n=>{n.state==="correct"||n.state==="incorrect"||(n.type==="word"?P?i(n.id,P):z(n.id===m?null:n.id):m?i(m,n.id):v(n.id===P?null:n.id))},i=(n,H)=>{const y=K.find(S=>S.id===n),L=E.find(S=>S.id===H);if(y&&L&&y.pairId===L.pairId){B(I=>I+10);const S=new Set(j).add(y.pairId);b(S),W(I=>I.map(w=>w.id===n?{...w,state:"correct"}:w)),d(I=>I.map(w=>w.id===H?{...w,state:"correct"}:w)),Q(I=>I.map(w=>w.pairId===y.pairId?{...w,state:"correct"}:w)),z(null),v(null)}else B(S=>Math.max(0,S-5)),W(S=>S.map(I=>I.id===n?{...I,state:"incorrect"}:I)),d(S=>S.map(I=>I.id===H?{...I,state:"incorrect"}:I)),setTimeout(()=>{W(S=>S.map(I=>({...I,state:I.state==="incorrect"?"default":I.state}))),d(S=>S.map(I=>({...I,state:I.state==="incorrect"?"default":I.state}))),z(null),v(null)},600)},c=()=>{const n=r.findIndex(H=>H.originalIndex===N);if(n>0){const H=r[n-1];U(H.originalIndex)}},h=()=>{const n=r.findIndex(H=>H.originalIndex===N);if(n<r.length-1){const H=r[n+1];U(H.originalIndex)}},o=l[N],k=r.findIndex(n=>n.originalIndex===N);if(x==="SETUP"){const n=({label:y,checked:L,onChange:S})=>e.jsxs("label",{className:"flex items-center gap-3 p-4 rounded-2xl bg-neutral-50 border-2 border-transparent hover:border-fuchsia-100 cursor-pointer transition-all",onClick:S,children:[L?e.jsx(Ut,{size:20,className:"text-fuchsia-600"}):e.jsx(It,{size:20,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-sm text-neutral-800",children:y})]}),H=C.library||C.collocations||C.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-fuchsia-100 text-fuchsia-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(nt,{size:32})}),e.jsx("h2",{className:"text-4xl font-black text-neutral-900 tracking-tight",children:"Word Scatter"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Match hidden words to their definitions in a structured matrix or column match."})]}),e.jsx("div",{className:"w-full max-w-md space-y-6",children:e.jsxs("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:["Items: ",e.jsx("span",{className:"text-xl font-black text-fuchsia-600",children:f})]}),e.jsx("input",{id:"sessionSize",type:"range",min:Ce,max:st,value:f,onChange:y=>Y(parseInt(y.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-full appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-[10px] font-black text-neutral-300 uppercase px-1",children:[e.jsx("span",{children:Ce}),e.jsx("span",{children:st})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:"Content Sources"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(n,{label:"Library Definitions",checked:C.library,onChange:()=>O(y=>({...y,library:!y.library}))}),e.jsx(n,{label:"Collocations",checked:C.collocations,onChange:()=>O(y=>({...y,collocations:!y.collocations}))}),e.jsx(n,{label:"Idioms",checked:C.idioms,onChange:()=>O(y=>({...y,idioms:!y.idioms}))})]})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:()=>V("PLAYING"),disabled:!H,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}const X=j.size/f*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>g($),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Finish"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>J("MATRIX"),className:`p-2 rounded-lg transition-all ${_==="MATRIX"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Matrix View",children:e.jsx(Ht,{size:18})}),e.jsx("button",{onClick:()=>J("MATCH"),className:`p-2 rounded-lg transition-all ${_==="MATCH"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Match View",children:e.jsx(Wt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:"Progress"}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-500 transition-all duration-300",style:{width:`${X}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:$})]}),_==="MATRIX"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shrink-0 mb-6 py-6 px-8 bg-neutral-50 border border-neutral-200 rounded-[2rem] shadow-sm relative overflow-hidden flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:c,disabled:k<=0,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(ct,{size:24})}),e.jsx("div",{className:"text-center flex-1 px-10",children:o?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-fuchsia-500 tracking-widest flex items-center justify-center gap-1.5 mb-2",children:[e.jsx(St,{size:12})," Find the term for:"]}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-neutral-800 leading-tight",children:o.text})]}):e.jsx("p",{className:"text-center font-black text-emerald-600 text-xl animate-bounce",children:"CLEARED!"})}),e.jsx("button",{onClick:h,disabled:k>=r.length-1,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx($e,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-6",children:e.jsx("div",{className:`grid gap-3 ${f<=12?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":f<=24?"grid-cols-3 md:grid-cols-4 lg:grid-cols-6":"grid-cols-4 md:grid-cols-6 lg:grid-cols-8"}`,children:G.map(n=>{const H=n.state==="correct",y=n.state==="incorrect";return e.jsxs("button",{onClick:()=>u(n),disabled:H,className:`
                                            relative h-16 px-2 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center text-center shadow-sm font-bold text-xs leading-tight
                                            ${H?"bg-emerald-500 border-emerald-500 text-white scale-90 opacity-0 pointer-events-none":y?"bg-rose-50 border-rose-500 text-rose-600 animate-shake":"bg-white border-neutral-100 text-neutral-700 hover:border-fuchsia-300 hover:text-neutral-900 hover:-translate-y-0.5 active:scale-95"}
                                        `,children:[e.jsx("span",{className:"line-clamp-2",children:n.text}),H&&e.jsx(we,{size:20,className:"absolute inset-auto animate-ping"})]},n.id)})})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," English"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:K.map(n=>{const H=m===n.id,y=n.state==="correct",L=n.state==="incorrect";if(y)return e.jsx("div",{className:"h-16 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(le,{size:32})},n.id);let S="bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-300 hover:-translate-y-0.5";return H&&(S="bg-fuchsia-600 border-fuchsia-600 text-white shadow-lg ring-4 ring-fuchsia-100 scale-105"),L&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>a(n),className:`h-16 px-4 rounded-xl border-b-4 font-bold text-sm transition-all duration-200 flex items-center justify-center text-center leading-tight shadow-sm ${S}`,children:n.text},n.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(Ct,{size:12})," Meaning"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:E.map(n=>{const H=P===n.id,y=n.state==="correct",L=n.state==="incorrect";if(y)return e.jsx("div",{className:"h-20 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(le,{size:32})},n.id);let S="bg-white border-neutral-200 text-neutral-700 hover:border-indigo-300 hover:-translate-y-0.5";return H&&(S="bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-105"),L&&(S="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>a(n),className:`min-h-20 px-4 py-3 rounded-xl border-b-4 font-medium text-xs transition-all duration-200 flex items-center justify-center text-center leading-relaxed shadow-sm ${S}`,children:n.text},n.id)})})]})]})}),e.jsxs("footer",{className:"shrink-0 mt-2 flex items-center justify-between text-[10px] font-black uppercase text-neutral-400 tracking-widest px-4 border-t border-neutral-100 pt-4",children:[e.jsxs("span",{children:["Total Items: ",f]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Matched"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-neutral-200"})," Hidden"]})]}),e.jsxs("span",{children:["Completed: ",j.size]})]})]})},be=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),Fe=s=>s.replace(/(\d{1,2}:\d{2}(?::\d{2})?)|(\b\d{4}\b)|(\d+)/g,(g,M,x,V)=>M?M.replace(/:/g," "):x?`${x.slice(0,2)} ${x.slice(2)}`:V?V.split("").join(" "):g),ms=({words:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState(10),[f,Y]=t.useState("EASY"),[C,O]=t.useState("LIBRARY"),[G,Q]=t.useState(!1),[K,W]=t.useState([]),[E,d]=t.useState(()=>{const p=qe("dictation_selected_voices",["System"]);return new Set(p)}),[l,D]=t.useState(()=>qe("dictation_hover_preview",!0)),[N,U]=t.useState([]),[$,B]=t.useState(0),[j,b]=t.useState(0),[m,z]=t.useState({}),[P,v]=t.useState(""),[r,u]=t.useState(!1),[a,i]=t.useState(!1),c=t.useRef(null),{showToast:h}=pe();t.useEffect(()=>{Xe("dictation_selected_voices",Array.from(E))},[E]),t.useEffect(()=>{Xe("dictation_hover_preview",l)},[l]),t.useEffect(()=>((async()=>{const F=Ze(),q=Je(F);try{const Z=await Rt(q);if(Z&&Z.voices){const te=Z.voices.filter(ee=>ee.language==="en"&&(ee.name.includes("Premium")||ee.name.includes("Enhanced")));W(te)}}catch(Z){console.warn("Could not load server voices",Z)}})(),()=>{ze()}),[]),t.useEffect(()=>{C==="SERVER"&&Y("HARD")},[C]);const o=async p=>{const F=Ze(),q=Je(F),Z="Dictation";try{const te=await fetch(`${q}/api/reading/files/${Z}`);if(!te.ok)throw new Error("Could not access 'Dictation' folder on server.");const se=((await te.json()).items||[]).filter(ae=>ae.type==="file"&&!ae.name.startsWith("."));if(se.length===0)throw new Error("No files found in 'Dictation' folder.");const de=se.sort(()=>Math.random()-.5).slice(0,5),ne=[];if(await Promise.all(de.map(async ae=>{try{const re=ae.name,ue=await fetch(`${q}/api/reading/content/${Z}/${encodeURIComponent(re)}`);if(ue.ok){const Qe=(await ue.json()).essay||"";if(Qe){const ft=Qe.split(/\r?\n/).map(Ae=>Ae.trim()).filter(Ae=>Ae.length>0);ne.push(...ft)}}}catch(re){console.warn(`Failed to read file ${ae.name}`,re)}})),ne.length===0)throw new Error("No valid text lines found.");return ne.sort(()=>Math.random()-.5).slice(0,p)}catch(te){return h(te.message||"Server Error","error"),[]}},k=()=>{const p=Array.from(E);if(p.length===0)return;const F=p[Math.floor(Math.random()*p.length)];return F==="System"?void 0:F},X=async()=>{let p;if(C==="SERVER"){if(Q(!0),p=await o(_),Q(!1),p.length===0)return}else{const q=s.filter(Z=>Z.example&&Z.example.trim().split(/\s+/).length>=4);if(q.length===0){h("No suitable example sentences found in Library.","error");return}p=[...q].sort(()=>Math.random()-.5).slice(0,_).map(Z=>Z.example.trim())}const F=p.map((q,Z)=>{const te=q.replace(/\s+/g," ").trim(),ee=te.split(" "),se=new Set;if(f==="EASY"){ee.forEach((re,ue)=>{/\d/.test(re)&&se.add(ue)});const ne=Math.max(1,Math.floor(ee.length*.4));let ae=0;for(;se.size<ne&&ae<100;){ae++;const re=Math.floor(Math.random()*ee.length);!se.has(re)&&/[a-zA-Z0-9]/.test(ee[re])&&se.add(re)}}const fe=ee.map((ne,ae)=>{const re=f==="EASY"&&se.has(ae);return{text:ne,isMasked:re}}),de=k();return{id:`dict-${Z}-${Date.now()}`,originalSentence:te,tokenized:fe,mode:f,voice:de}});U(F),V("PLAYING"),B(0),b(0),z({}),v(""),u(!1),i(!1),setTimeout(()=>{const q=F[0];ge(Fe(q.originalSentence),!1,"en",q.voice)},600)},n=N[$];t.useEffect(()=>{x==="PLAYING"&&!r&&setTimeout(()=>{var p;return(p=c.current)==null?void 0:p.focus()},150)},[$,x,r]);const H=()=>{n&&ge(Fe(n.originalSentence),!1,"en",n.voice)},y=()=>{I()},L=()=>{ze(),M()},S=()=>{if(r)return;let p=!0;if(n.mode==="HARD"?p=be(P)===be(n.originalSentence):n.tokenized.forEach((F,q)=>{if(F.isMasked){const Z=F.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");be(m[q]||"")!==be(Z)&&(p=!1)}}),i(p),u(!0),p){const F=n.mode==="HARD"?25:15;b(q=>q+F)}},I=()=>{if($<N.length-1){B(F=>F+1),z({}),v(""),u(!1),i(!1);const p=N[$+1];setTimeout(()=>{ge(Fe(p.originalSentence),!1,"en",p.voice)},500)}else g(j)},w=p=>{d(F=>{const q=new Set(F);return q.has(p)?q.size>1&&q.delete(p):q.add(p),q})},R=p=>{if(!l)return;ze(),ge("Voice preview.",!1,"en",p==="System"?void 0:p)},A=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-5 justify-center items-center leading-relaxed",children:n.tokenized.map((p,F)=>{if(!p.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:p.text},F);const q=m[F]||"",Z=p.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),te=r&&be(q)===be(Z);return e.jsxs("div",{className:"relative inline-flex flex-col items-center",children:[e.jsx("input",{ref:F===n.tokenized.findIndex(ee=>ee.isMasked)?c:null,type:"text",value:q,disabled:r,onChange:ee=>z(se=>({...se,[F]:ee.target.value})),onKeyDown:ee=>ee.key==="Enter"&&S(),className:`w-28 text-center px-2 py-1.5 rounded-lg border-b-2 font-bold text-sm outline-none transition-all ${r?te?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-indigo-600"}`,autoComplete:"off"}),r&&!te&&e.jsx("div",{className:"absolute -bottom-5 text-[10px] font-black text-green-600 uppercase whitespace-nowrap",children:Z})]},F)})}),T=()=>e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsx("textarea",{ref:c,value:P,onChange:p=>v(p.target.value),disabled:r,onKeyDown:p=>p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),S()),placeholder:"Type the full sentence...",className:`w-full p-5 rounded-3xl border-2 text-lg font-medium resize-none outline-none transition-all h-32 ${r?a?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800":"bg-white border-neutral-200 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-100"}`}),r&&!a&&e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-2xl animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-base font-bold text-green-900 leading-relaxed",children:n.originalSentence})]})]});if(x==="SETUP"){const p=({id:F,label:q,icon:Z,desc:te,disabled:ee})=>e.jsxs("button",{onClick:()=>!ee&&Y(F),disabled:ee,className:`p-3 rounded-xl border-2 transition-all text-left flex flex-col gap-1 relative ${f===F?"border-cyan-500 bg-cyan-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"} ${ee?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded-lg ${f===F?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(Z,{size:14})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${f===F?"text-cyan-700":"text-neutral-500"}`,children:q})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:te}),ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-[1px] font-black text-xs text-neutral-400 uppercase tracking-widest",children:"Locked"})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-6 animate-in fade-in max-w-4xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(Lt,{size:32})}),e.jsx("h2",{className:"text-2xl font-black text-neutral-900 tracking-tight",children:"Dictation Lab"}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium",children:"Bridge the gap between hearing and writing."})]}),e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>O("LIBRARY"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="LIBRARY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Et,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Sentence"})]}),e.jsxs("button",{onClick:()=>O("SERVER"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="SERVER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Bt,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Phrase"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-sm font-black text-cyan-600",children:_})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:_,onChange:F=>J(parseInt(F.target.value)),className:"w-full h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2 flex flex-col justify-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(p,{id:"EASY",label:"Easy",icon:oe,desc:"Type in missing words. Numbers are always masked.",disabled:C==="SERVER"}),e.jsx(p,{id:"HARD",label:"Hard",icon:Ye,desc:"Transcribe the full sentence from scratch."})]})]})]}),e.jsxs("div",{className:"w-full bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ue,{size:12})," Voice Pool"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 group-hover:text-cyan-600 transition-colors",children:"Hover to hear"}),e.jsx("div",{className:`w-8 h-4 rounded-full p-0.5 transition-colors ${l?"bg-cyan-500":"bg-neutral-200"}`,onClick:()=>D(!l),children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full shadow-sm transition-transform ${l?"translate-x-4":"translate-x-0"}`})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-1",children:[e.jsxs("button",{onClick:()=>w("System"),onMouseEnter:()=>R("System"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${E.has("System")?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[E.has("System")&&e.jsx(we,{size:10})," System Default"]}),K.map(F=>e.jsxs("button",{onClick:()=>w(F.name),onMouseEnter:()=>R(F.name),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${E.has(F.name)?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[E.has(F.name)&&e.jsx(we,{size:10})," ",F.name.replace("Microsoft ","")]},F.name)),K.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-400 italic",children:"Connect to server for HQ voices."})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:L,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50 transition-all text-xs",children:"Back"}),e.jsxs("button",{onClick:X,disabled:G,className:"px-10 py-3 bg-cyan-600 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-cyan-700 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[G?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(xe,{size:16,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Level ",$+1," of ",N.length," ‚Ä¢ ",n.mode]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-300",style:{width:`${$/N.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:j})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12",children:[e.jsxs("button",{onClick:H,className:"w-28 h-28 bg-cyan-50 text-cyan-600 rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition-all group active:scale-95 relative",children:[e.jsx(xe,{size:48,className:"ml-1.5 fill-cyan-600 group-hover:scale-110 transition-transform"}),n.voice&&e.jsx("div",{className:"absolute -bottom-6 text-[9px] font-bold text-neutral-300 bg-white px-2 py-0.5 rounded-full shadow-sm border border-neutral-100 whitespace-nowrap",children:n.voice})]}),e.jsx("div",{className:"w-full min-h-[160px] flex items-center justify-center px-4",children:n.mode==="EASY"?A():T()}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:r?e.jsxs("button",{onClick:I,className:`w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 ${a?"bg-emerald-600 text-white shadow-emerald-200":"bg-neutral-900 text-white"}`,children:[e.jsx("span",{children:$===N.length-1?"Finish":"Next Item"}),e.jsx(ke,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"flex-1 py-4 bg-white border-2 border-neutral-200 text-neutral-400 font-black text-xs uppercase tracking-widest rounded-2xl hover:text-neutral-600 hover:border-neutral-300 transition-all",children:"Skip"}),e.jsx("button",{onClick:S,className:"flex-[2] py-4 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl shadow-neutral-900/10 active:scale-95",children:"Check Answer"})]})})]})]})},at=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),hs=({userId:s,onComplete:g,onExit:M})=>{var I;const[x,V]=t.useState("SETUP"),[_,J]=t.useState("MASTER"),[f,Y]=t.useState("MEDIUM"),[C,O]=t.useState(0),[G,Q]=t.useState(0),[K,W]=t.useState([]),[E,d]=t.useState(0),[l,D]=t.useState(0),[N,U]=t.useState(""),[$,B]=t.useState(!1),[j,b]=t.useState(!1),[m,z]=t.useState(!1),[P,v]=t.useState(!1),r=t.useRef(new At),u=t.useRef(null),a=t.useRef(null),{showToast:i}=pe(),c=async()=>{const w=await Te();let R=0,A=0;w.forEach(T=>{T.answers.forEach(p=>{R++,p.lastResult==="correct"&&A++})}),O(R),Q(A)};t.useEffect(()=>{c()},[s,x]),t.useEffect(()=>{m&&setTimeout(()=>{var w;(w=a.current)==null||w.scrollIntoView({behavior:"smooth",block:"end"})},100)},[m]);const h=async()=>{const w=await Te();let R=w;if(_==="MASTER"){const F=w.filter(q=>q.answers.some(Z=>Z.lastResult!=="correct"));F.length>0?R=F:i("All items mastered! Switching to review mode.","info")}if(R.length===0){i("No expressions found.","error");return}const A=[],T=[];w.forEach(F=>{F.answers.forEach(q=>{const Z=q.sentence.match(/\{(.*?)\}/);Z&&T.push(Z[1])})}),R.forEach(F=>{F.answers.forEach((q,Z)=>{if(_==="MASTER"&&q.lastResult==="correct")return;const te=q.sentence.match(/\{(.*?)\}/);if(te){const ee=te[1],se=q.sentence.replace(te[0],"_______");let fe;if(f==="EASY"){const de=T.filter(ne=>ne!==ee).sort(()=>.5-Math.random()).slice(0,3);fe=[ee,...de].sort(()=>.5-Math.random())}A.push({id:`${F.id}-${Z}`,nativeSpeakItemId:F.id,answerIndex:Z,answer:q,maskedSentence:se,choices:fe})}})});const p=A.sort(()=>.5-Math.random()).slice(0,10);W(p),d(0),D(0),U(""),z(!1),v(!1),b(!1),V("PLAYING")},o=()=>{B(!0),U(""),r.current.start((w,R)=>U(w+R),w=>U(w))},k=()=>{B(!1),r.current.stop()},X=async w=>{const R=K[E];`${R.nativeSpeakItemId}${R.answerIndex}`;const T=(await Te()).find(p=>p.id===R.nativeSpeakItemId);if(T){const p=T.answers.map((Z,te)=>te===R.answerIndex?{...Z,lastResult:w?"correct":"incorrect"}:Z),F=p.filter(Z=>Z.lastResult==="correct").length,q=Math.round(F/p.length*100);await Tt({...T,answers:p,bestScore:q,updatedAt:Date.now()})}},n=()=>{if(P)return;const R=K[E].answer.sentence.match(/\{(.*?)\}/),A=R?R[1]:"",T=at(N).includes(at(A));v(T),z(!0),T&&(D(p=>p+10),X(!0))},H=()=>{X(!1),y()},y=()=>{E<K.length-1?(d(w=>w+1),U(""),z(!1),v(!1),b(!1)):(V("SUMMARY"),setTimeout(()=>g(l),2e3))},L=K[E];if(x==="SETUP"){const w=({id:R,label:A,desc:T})=>e.jsxs("button",{onClick:()=>Y(R),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f===R?"bg-amber-50 border-amber-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===R?"text-amber-700":"text-neutral-400"}`,children:A}),f===R&&e.jsx(le,{size:14,className:"text-amber-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:T})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-8 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(Mt,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Natural Expression"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Master native phrases by using them in context."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:G}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:C}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>J("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${_==="MASTER"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>J("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${_==="REVIEW"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 h-full",children:[e.jsx(w,{id:"EASY",label:"EASY",desc:"Select from list"}),e.jsx(w,{id:"MEDIUM",label:"MEDIUM",desc:"Fill missing part"}),e.jsx(w,{id:"HARD",label:"HARD",desc:"Type entire phrase"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:h,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(le,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Your progress has been saved to the library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:l}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"})]});const S=L.answer.tone==="academic"?"bg-purple-100 text-purple-700":L.answer.tone==="semi-academic"?"bg-blue-100 text-blue-700":"bg-neutral-100 text-neutral-600";return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",E+1," of ",K.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-300",style:{width:`${E/K.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:l})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar w-full",children:e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-4",children:[e.jsxs("div",{className:"w-full bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-xl text-center space-y-4 relative overflow-hidden shrink-0",children:[e.jsx("div",{className:`absolute top-0 left-1/2 -translate-x-1/2 px-4 py-1 rounded-b-xl text-[10px] font-black uppercase tracking-widest ${S}`,children:L.answer.tone}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest mb-2",children:"Situation / Context"}),e.jsxs("h3",{className:"text-2xl md:text-3xl font-black text-neutral-900 leading-tight",children:['"',L.answer.anchor,'"']})]}),e.jsx("div",{className:"min-h-[100px] flex items-center justify-center py-4",children:f==="HARD"?e.jsx("div",{className:"text-neutral-400 text-sm font-medium italic",children:"(Expression Hidden - Speak or Type it)"}):e.jsx("p",{className:"text-lg md:text-xl text-neutral-700 font-medium",children:L.maskedSentence})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 bg-yellow-50 px-4 py-2 rounded-xl",children:[e.jsx("button",{onClick:()=>ge(L.answer.sentence),className:"p-2 bg-white text-yellow-600 rounded-full shadow-sm hover:scale-110 transition-transform",children:e.jsx(Ue,{size:16})}),e.jsx("span",{className:"text-xs font-bold text-yellow-800 italic",children:L.answer.note||"Listen to the example"})]})})]}),e.jsx("div",{className:"w-full max-w-md space-y-4 shrink-0",children:f==="EASY"?e.jsx("div",{className:"grid grid-cols-1 gap-2",children:(I=L.choices)==null?void 0:I.map(w=>e.jsx("button",{onClick:()=>U(w),disabled:P,className:`p-4 rounded-xl border-2 font-bold text-sm transition-all ${N===w?"bg-amber-50 border-amber-500 text-amber-900":"bg-white border-neutral-100 text-neutral-600 hover:border-neutral-300"}`,children:w},w))}):e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:u,value:N,onChange:w=>U(w.target.value),disabled:P||$,placeholder:f==="HARD"?"Type the full expression...":"Type the missing part...",className:`w-full p-5 pr-14 bg-white border-2 rounded-2xl text-lg font-bold outline-none transition-all resize-none ${m?P?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-amber-500 focus:ring-4 focus:ring-amber-50"}`,rows:2}),e.jsx("div",{className:"absolute right-3 bottom-3",children:e.jsx("button",{onClick:$?k:o,className:`p-2 rounded-full transition-all ${$?"bg-red-500 text-white animate-pulse":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:$?e.jsx("div",{className:"w-4 h-4 bg-white rounded-sm"}):e.jsx(zt,{size:20})})})]})}),e.jsx("div",{className:"w-full max-w-md flex gap-3 shrink-0",children:P?e.jsxs("div",{className:"w-full space-y-4 animate-in slide-in-from-bottom-2 pb-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl flex items-center gap-3 border-2 bg-emerald-50 border-emerald-100 text-emerald-800",children:[e.jsx(le,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-lg uppercase tracking-tight",children:"Correct!"}),e.jsx("p",{className:"text-xs font-bold opacity-80",children:"Great job!"})]})]}),e.jsxs("button",{onClick:y,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-sm uppercase tracking-widest transition-all shadow-xl flex items-center justify-center gap-2 hover:bg-emerald-700",children:[e.jsx(ke,{size:18})," ",E===K.length-1?"Finish":"Continue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-sm uppercase tracking-widest hover:text-neutral-600 hover:border-neutral-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:16})," Skip"]}),e.jsxs("button",{onClick:()=>b(!0),disabled:j,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsx("button",{onClick:n,disabled:!N.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 disabled:active:scale-100",children:m?"Retry":"Check"})]})}),(P||j)&&e.jsxs("div",{className:"w-full max-w-md p-5 bg-white border-2 border-neutral-100 rounded-2xl shadow-sm relative overflow-hidden animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-2",children:"The Correct Expression"}),e.jsx("p",{className:"text-xl font-black text-emerald-600 leading-snug",children:L.answer.sentence.replace(/{|}/g,"")})]}),e.jsx("div",{ref:a})]})})]})},Ie=s=>s.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),fs=({user:s,onComplete:g,onExit:M})=>{const[x,V]=t.useState("SETUP"),[_,J]=t.useState(10),[f,Y]=t.useState("EASY"),[C,O]=t.useState("MASTER"),[G,Q]=t.useState(0),[K,W]=t.useState(0),[E,d]=t.useState([]),[l,D]=t.useState(0),[N,U]=t.useState(0),[$,B]=t.useState([]),[j,b]=t.useState(!1),[m,z]=t.useState(!1),[P,v]=t.useState(!1),[r,u]=t.useState(!1),a=t.useRef({}),{showToast:i}=pe();t.useEffect(()=>{(async()=>{const R=(await je(s.id)).filter(p=>p.type==="intensity"&&p.intensityRows);let A=0,T=0;R.forEach(p=>{p.intensityRows.forEach(F=>{["softened","neutral","intensified"].forEach(q=>{F[q].forEach(Z=>{A++,Z.lastResult==="correct"&&T++})})})}),Q(A),W(T)})()},[s.id,x]);const c=async()=>{const w=(await je(s.id)).filter(p=>p.type==="intensity"&&p.intensityRows&&p.intensityRows.length>0);if(w.length===0){i("No Intensity Scale lessons found in your library.","error");return}const R=[],A=[];if(w.forEach(p=>{p.intensityRows.forEach(F=>{[...F.softened,...F.neutral,...F.intensified].forEach(q=>A.push(q.word))})}),w.forEach(p=>{p.intensityRows.forEach((F,q)=>{const Z=["softened","neutral","intensified"];Z.forEach(te=>{const ee=F[te];ee.length!==0&&Z.forEach(se=>{if(te===se||F[se].length===0)return;const fe=F[se].every(de=>de.lastResult==="correct");C==="MASTER"&&fe||ee.forEach(de=>{const ne={lessonId:p.id,rowIdx:q,pivotWord:de.word,pivotCategory:te,targetCategory:se,expectedWords:F[se].map(ae=>Ie(ae.word)),originalExpectedItems:F[se]};if(f==="EASY"){const ae=F[se].map(ue=>ue.word),re=A.filter(ue=>!ae.includes(ue)).sort(()=>.5-Math.random()).slice(0,5);ne.choices=[...ae,...re].sort(()=>.5-Math.random())}R.push(ne)})})})})}),R.length===0){C==="MASTER"?(i("All items mastered! Switching to Review mode.","success"),O("REVIEW")):i("Not enough data to start game. Add more words to your scales.","error");return}const T=R.sort(()=>.5-Math.random()).slice(0,_);d(T),D(0),U(0),V("PLAYING"),h(T[0])},h=I=>{B(new Array(I.expectedWords.length).fill("")),b(!1),z(!1),u(!1),setTimeout(()=>{var w;(w=a.current[0])==null||w.focus()},100)},o=async()=>{if(P)return;const I=E[l],w=$.map(T=>Ie(T)).filter(Boolean),R=new Set(w);let A=!0;if(R.size!==I.expectedWords.length)A=!1;else for(const T of I.expectedWords)if(!R.has(T)){A=!1;break}b(!0),z(A),A&&(U(T=>T+20),await X(!0))},k=()=>{u(!0)},X=async I=>{v(!0);const w=E[l];try{const A=(await je(s.id)).find(T=>T.id===w.lessonId);if(A&&A.intensityRows){const T=[...A.intensityRows],p=[...T[w.rowIdx][w.targetCategory]];T[w.rowIdx][w.targetCategory]=p.map(F=>({...F,lastResult:I?"correct":"incorrect"})),await it({...A,intensityRows:T,updatedAt:Date.now()})}}catch(R){console.error("Failed to save result",R)}finally{v(!1)}},n=()=>{if(l<E.length-1){const I=l+1;D(I),h(E[I])}else V("SUMMARY")},H=async()=>{await X(!1),n()};if(x==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-8 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(Ot,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Intensity Scale"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Drill synonyms based on their degree of intensity."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:K}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:G}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>O("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${C==="MASTER"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>O("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${C==="REVIEW"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-orange-600",children:_})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:_,onChange:I=>J(parseInt(I.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-orange-500"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 h-full",children:[e.jsxs("button",{onClick:()=>Y("EASY"),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f==="EASY"?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f==="EASY"?"text-orange-700":"text-neutral-400"}`,children:"Easy"}),f==="EASY"&&e.jsx(le,{size:14,className:"text-orange-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:"Select the correct word from a list of options."})]}),e.jsxs("button",{onClick:()=>Y("HARD"),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f==="HARD"?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f==="HARD"?"text-orange-700":"text-neutral-400"}`,children:"Hard"}),f==="HARD"&&e.jsx(le,{size:14,className:"text-orange-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:"Type the correct word from memory without hints."})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:c,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]});if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(le,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Scale Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Progress marks updated in your library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:N}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>g(N),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const y=E[l],L={softened:"Softened",neutral:"Neutral",intensified:"Intensified"},S={softened:"text-blue-500 bg-blue-50 border-blue-100",neutral:"text-neutral-500 bg-neutral-100 border-neutral-200",intensified:"text-orange-500 bg-orange-50 border-orange-100"};return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",l+1," of ",E.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${l/E.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:N})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${S[y.pivotCategory]}`,children:L[y.pivotCategory]}),e.jsx("span",{className:"text-neutral-300",children:"‚Üí"}),e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${S[y.targetCategory]}`,children:L[y.targetCategory]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest",children:["What is the ",y.targetCategory," of"]}),e.jsxs("h3",{className:"text-4xl font-black text-neutral-900 tracking-tighter",children:['"',y.pivotWord,'"?']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-3",children:[$.map((I,w)=>{var R;return e.jsx("div",{className:"relative",children:f==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:A=>{a.current[w]=A},value:I,disabled:m,onChange:A=>{const T=[...$];T[w]=A.target.value,B(T)},className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${j?y.expectedWords.includes(Ie(I))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50"}`,children:[e.jsxs("option",{value:"",children:["Select word ",w+1,"..."]}),(R=y.choices)==null?void 0:R.map(A=>e.jsx("option",{value:A,children:A},A))]}),!m&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:A=>{a.current[w]=A},type:"text",value:I,disabled:m,onChange:A=>{const T=[...$];T[w]=A.target.value,B(T)},onKeyDown:A=>A.key==="Enter"&&!m&&o(),placeholder:`Type word ${w+1}...`,className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${j?y.expectedWords.includes(Ie(I))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50 shadow-sm"}`,autoComplete:"off"})},w)}),(m||r)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answers"}),e.jsx("p",{className:"text-lg font-black text-emerald-900",children:y.originalExpectedItems.map(I=>I.word).join(", ")})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:m?e.jsxs("button",{onClick:n,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:l===E.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:16})," Skip"]}),j&&!m&&e.jsxs("button",{onClick:k,disabled:r,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:o,disabled:P||$.some(I=>!I.trim()),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[P?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:j?"Retry":"Check"})]})]})})]})]})},me=s=>s.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),ps=({user:s,onComplete:g,onExit:M})=>{var L;const[x,V]=t.useState("SETUP"),[_,J]=t.useState(10),[f,Y]=t.useState("EASY"),[C,O]=t.useState("MASTER"),[G,Q]=t.useState(0),[K,W]=t.useState(0),[E,d]=t.useState([]),[l,D]=t.useState(0),[N,U]=t.useState(0),[$,B]=t.useState(""),[j,b]=t.useState(!1),[m,z]=t.useState(!1),[P,v]=t.useState(!1),[r,u]=t.useState(!1),a=t.useRef(null),{showToast:i}=pe();t.useEffect(()=>{(async()=>{const w=(await je(s.id)).filter(T=>T.type==="comparison"&&T.comparisonRows);let R=0,A=0;w.forEach(T=>{T.comparisonRows.forEach(p=>{R++,p.lastResult==="correct"&&A++})}),Q(R),W(A)})()},[s.id,x]);const c=async()=>{const I=(await je(s.id)).filter(T=>T.type==="comparison"&&T.comparisonRows&&T.comparisonRows.length>0);if(I.length===0){i("No Comparison Lab lessons found in your library.","error");return}const w=[],R=[];if(I.forEach(T=>{T.comparisonRows.forEach(p=>{p.word&&R.push(p.word)})}),I.forEach(T=>{T.comparisonRows.forEach((p,F)=>{if(!p.word||!p.nuance||C==="MASTER"&&p.lastResult==="correct")return;const q={lessonId:T.id,rowIdx:F,answerWord:p.word,nuance:p.nuance,example:p.example};if(f==="EASY"){const Z=R.filter(te=>me(te)!==me(p.word)).sort(()=>.5-Math.random()).slice(0,5);q.choices=[p.word,...Z].sort(()=>.5-Math.random())}w.push(q)})}),w.length===0){C==="MASTER"?(i("All items mastered! Switching to Review mode.","success"),O("REVIEW")):i("Not enough data to start game. Add more word pairs to your labs.","error");return}const A=w.sort(()=>.5-Math.random()).slice(0,_);d(A),D(0),U(0),V("PLAYING"),h(A[0])},h=S=>{B(""),b(!1),z(!1),u(!1),setTimeout(()=>{var I;(I=a.current)==null||I.focus()},100)},o=async()=>{if(P)return;const S=E[l],I=me($)===me(S.answerWord);z(I),b(!0),I&&(U(w=>w+20),await X(!0))},k=()=>{u(!0)},X=async S=>{v(!0);const I=E[l];try{const R=(await je(s.id)).find(A=>A.id===I.lessonId);if(R&&R.comparisonRows){const A=[...R.comparisonRows];A[I.rowIdx]={...A[I.rowIdx],lastResult:S?"correct":"incorrect"},await it({...R,comparisonRows:A,updatedAt:Date.now()})}}catch(w){console.error("Failed to save result",w)}finally{v(!1)}},n=()=>{if(l<E.length-1){const S=l+1;D(S),h(E[S])}else V("SUMMARY")},H=async()=>{await X(!1),n()};if(x==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-8 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(dt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Contrast"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Distinguish and identify confusing word pairs based on their usage nuance."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:K}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:G}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>O("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${C==="MASTER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>O("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${C==="REVIEW"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:_})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:_,onChange:S=>J(parseInt(S.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 h-full",children:[e.jsxs("button",{onClick:()=>Y("EASY"),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f==="EASY"?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f==="EASY"?"text-indigo-700":"text-neutral-400"}`,children:"Easy"}),f==="EASY"&&e.jsx(le,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:"Select the correct word from a list of options."})]}),e.jsxs("button",{onClick:()=>Y("HARD"),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${f==="HARD"?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f==="HARD"?"text-indigo-700":"text-neutral-400"}`,children:"Hard"}),f==="HARD"&&e.jsx(le,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:"Type the correct word from memory without hints."})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:M,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:c,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]});if(x==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(le,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"History marks updated in your comparison labs."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:N}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>g(N),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const y=E[l];return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",l+1," of ",E.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${l/E.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:N})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"w-full bg-white p-10 rounded-[3rem] border-2 border-neutral-100 shadow-xl text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest mb-2",children:"Identify the word based on nuance:"}),e.jsxs("h3",{className:"text-xl md:text-2xl font-medium text-neutral-800 leading-relaxed italic",children:['"',y.nuance,'"']})]}),y.example&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-50",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-300 uppercase tracking-widest mb-1",children:"Usage Example"}),e.jsxs("p",{className:"text-sm font-bold text-neutral-500",children:['"',y.example.replace(new RegExp(y.answerWord,"gi"),"_______"),'"']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-4",children:[f==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:a,value:$,disabled:m,onChange:S=>B(S.target.value),className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${j?me($)===me(y.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50"}`,children:[e.jsx("option",{value:"",children:"Select word..."}),(L=y.choices)==null?void 0:L.map(S=>e.jsx("option",{value:S,children:S},S))]}),!m&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:a,type:"text",value:$,disabled:m,onChange:S=>B(S.target.value),onKeyDown:S=>S.key==="Enter"&&!m&&o(),placeholder:"Type the word...",className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${j?me($)===me(y.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 shadow-sm"}`,autoComplete:"off"}),(m||r)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-xl font-black text-emerald-900",children:y.answerWord})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:m?e.jsxs("button",{onClick:n,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:l===E.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:16})," Skip"]}),j&&!m&&e.jsxs("button",{onClick:k,disabled:r,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:o,disabled:P||!$.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[P?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:j?"Retry":"Check"})]})]})})]})]})},As=({user:s,onExit:g,onRecalculateXp:M,xpToNextLevel:x,onStartSession:V,onUpdateUser:_,lastMasteryScoreUpdateTimestamp:J,onBulkUpdate:f,initialGameMode:Y,onConsumeGameMode:C})=>{const[O,G]=t.useState("ADVENTURE"),[Q,K]=t.useState([]),[W,E]=t.useState(!0),d=t.useRef(0),{showToast:l}=pe();t.useEffect(()=>{Y&&Y!=="MENU"&&(G(Y),C==null||C())},[Y,C]);const D=t.useRef(M);t.useEffect(()=>{D.current=M},[M]),t.useEffect(()=>{(async()=>{E(!0);const z=lt().filter(P=>P.userId===s.id).filter(P=>P&&!P.isPassive);if(K(z),J>d.current){const P=z.reduce((v,r)=>v+(r.masteryScore||0),0);await D.current(P),d.current=Date.now()}E(!1)})()},[s.id,J]);const N=b=>{l(`Game Complete! Score: ${b}`,"success"),g()},U=()=>{g()},$=b=>Q.filter(m=>m.gameEligibility?m.gameEligibility.includes(b):_t(m).includes(b)),B=()=>Q.filter(b=>{const m=b.paraphrases&&b.paraphrases.filter(v=>!v.isIgnored&&v.context&&v.context.trim()).length>=2,z=b.collocationsArray&&b.collocationsArray.filter(v=>!v.isIgnored&&v.d&&v.d.trim()).length>=2,P=b.idiomsList&&b.idiomsList.filter(v=>!v.isIgnored&&v.d&&v.d.trim()).length>=2;return m||z||P}),j=()=>{const b={onComplete:N,onExit:U};switch(O){case"ADVENTURE":return e.jsx(_e,{user:s,onUpdateUser:_,onStartSession:V,onExit:g});case"IPA_SORTER":return e.jsx(is,{...b,words:$("IPA_SORTER"),onBulkUpdate:f});case"SENTENCE_SCRAMBLE":return e.jsx(os,{...b,words:$("SENTENCE_SCRAMBLE")});case"DICTATION":return e.jsx(ms,{...b,words:$("DICTATION")});case"PREPOSITION_POWER":return e.jsx(ds,{...b,words:$("PREPOSITION_POWER")});case"PARAPHRASE_CONTEXT":return e.jsx(xs,{...b,words:B()});case"WORD_SCATTER":return e.jsx(us,{...b,words:$("MEANING_MATCH")});case"NATURAL_EXPRESSION":return e.jsx(hs,{userId:s.id,...b});case"INTENSITY_SCALE":return e.jsx(fs,{user:s,...b});case"COMPARISON_LAB":return e.jsx(ps,{user:s,...b});default:return e.jsx(_e,{user:s,onUpdateUser:_,onStartSession:V,onExit:g})}};return O==="ADVENTURE"?e.jsx(Xt,{user:s,xpToNextLevel:x,onUpdateUser:_,isRecalculatingXp:W,children:e.jsx(_e,{user:s,onUpdateUser:_,onStartSession:V,onExit:g})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-neutral-100 p-4 md:p-6 animate-in zoom-in-95 duration-300 flex flex-col",children:e.jsx("div",{className:"w-full h-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-200 relative p-6",children:j()})})};export{As as default};
