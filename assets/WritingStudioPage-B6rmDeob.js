import{r as t,j as e,b0 as je,Y as ke,I as ae,b5 as Se,ak as we,bl as me,P as ee,aR as oe,ay as ie,O as he,b as Ne,aB as ne,a4 as re,t as Te,bm as ce,H as ye,bc as Ce,bn as Ie,a5 as Ee,bo as Ae,s as Oe,aE as le,an as Pe,aF as Le,ba as Re,aG as Fe,S as Me,bp as se,bq as De,br as ze}from"./index-vTycAx8Y.js";import{R as We,a as $e}from"./ResourceActions-zji0VEEY.js";import{S as ge}from"./square-check-big-D5uYFy-O.js";import{T as de}from"./tag-BWsazVZa.js";import{C as Ue}from"./chart-no-axes-column-increasing-BUoxkGQ5.js";import{T as _e}from"./TagBrowser-Br5VUkTQ.js";import{V as Ge}from"./ViewMenu-CcaznI08.js";import{U as fe}from"./UniversalCard-rtsfXv_F.js";import"./chevron-left-CMtWELWY.js";import"./filter-BY4lJ0dc.js";function Be(n,a){const r=n.split(/\s+/).filter(Boolean).length;let k="an expert English teacher",p="Coherence, Vocabulary, and Grammar";const u=a.toLowerCase();return u.includes("task 1")?(k="a certified IELTS examiner",p="Task Achievement, Coherence & Cohesion, Lexical Resource, and Grammatical Range & Accuracy"):u.includes("task 2")?(k="a certified IELTS examiner",p="Task Response, Coherence & Cohesion, Lexical Resource, and Grammatical Range & Accuracy"):u.includes("academic")?(k="a university professor",p="Formality, Clarity, Academic Vocabulary, and Structure"):u.includes("professional")||u.includes("business")?(k="a business communication expert",p="Professionalism, Conciseness, Clarity, and Tone"):u.includes("informal")||u.includes("email")?(k="a native English speaker",p="Naturalness, Idiomatic Usage, and Conversational Tone"):(k="a creative writing coach",p="Creativity, Flow, Vocabulary, and Grammar"),`You are ${k}.

    TASK:
    Analyze the following text written by a student. The context/tags are: **${a}**.
    
    TEXT (${r} words):
    "${n}"

    YOUR ANALYSIS MUST INCLUDE:
    1.  **Overall Impression**: A very brief summary.
    2.  **Key Feedback**: 2-3 bullet points based on: **${p}**. Format as HTML (<ul>, <li>, <b>).
    3.  **Improvements**: Rewrite 1 sentence to show improvement.
    
    CONSTRAINT:
    Keep the entire feedback response **under 100 words**. Be concise and direct.
    
    Return in code block format a strict JSON object with this exact schema. Do not include any text outside the JSON block.

    {
      "feedback": "string (The feedback formatted as an HTML string)"
    }
    `}function Ye(n,a,r){const k=n.name!=="New Topic"||n.description.trim()||n.task1.trim()||n.task2.trim();let p="";k&&(p=`CURRENT TOPIC DATA:
- Name: ${n.name}
- Description: ${n.description||"(empty)"}
- Task 1: ${n.task1||"(empty)"}
- Task 2: ${n.task2||"(empty)"}
`);const u=a?`USER REQUEST: "${a}"`:"USER REQUEST: General improvement and expansion.";return`You are an expert IELTS coach. Your task is to refine or create an IELTS Writing topic based on user context and a request.

USER PROFILE:
- Role: ${r.role}
- Level: ${r.currentLevel}

${p}
${u}

TASK:
1.  Read the user request and apply it to the CURRENT TOPIC DATA. If no data exists, create a new topic from the request.
2.  The goal is to generate a high-quality, realistic set of IELTS Writing tasks (Task 1 and Task 2).
3.  Ensure the topic name and description are concise and accurate.
4.  For Task 1, create a prompt describing a chart, graph, table, or diagram (for Academic) or a letter-writing scenario (for General Training). Be descriptive.
5.  For Task 2, create an essay question that is thematically linked to Task 1 if appropriate, or a standard standalone essay prompt.

Return in code block format a strict JSON object with this schema:
{ 
  "name": "string (The updated topic name)", 
  "description": "string (The updated description, max 1-2 sentences)", 
  "task1": "string (The full Task 1 prompt)",
  "task2": "string (The full Task 2 prompt)"
}`}function He(n){return`You are an expert IELTS examiner creating a full academic writing test. The main topic is "${n}".

    TASK: Generate a complete, cohesive 2-part IELTS academic writing test.
    
    STRUCTURE:
    1.  **Task 1 (Report Writing)**:
        - Create a prompt that describes a visual data representation (e.g., bar chart, line graph, table, diagram, or a combination).
        - The prompt must instruct the user to "Summarise the information by selecting and reporting the main features, and make comparisons where relevant."
        - The description of the visual data should be clear and concise. Do NOT generate the visual data itself.
    
    2.  **Task 2 (Essay Writing)**:
        - Create an essay question that is thematically related to the Task 1 prompt.
        - The question should present an opinion, problem, or argument for the user to discuss. It should be a standard IELTS Task 2 format (e.g., agree/disagree, discuss both views, advantages/disadvantages, problem/solution).
    
    Return in code block format a strict JSON object with this exact schema. Do not include any text outside the JSON block.
    
    {
      "topic": "string (The main theme, e.g., '${n}')",
      "task1": "string (The full Task 1 prompt, e.g., 'The chart below shows the percentage of the population in four European countries who used the internet between 2010 and 2020. Summarise...')",
      "task2": "string (The full Task 2 essay prompt, e.g., 'Some people believe that the internet has brought people closer together, while others think it has created more social isolation. Discuss both these views and give your own opinion.')"
    }
    `}function Ve(n,a,r){return`You are a certified IELTS examiner providing feedback on a full writing practice test.

    TASK:
    Analyze the user's responses for Task 1 and Task 2. Provide a single, holistic evaluation and an overall band score.

    TASK 1 PROMPT:
    "${r.task1}"

    USER'S TASK 1 RESPONSE (Word Count: ${n.split(/\s+/).filter(Boolean).length}):
    "${n}"

    ---

    TASK 2 PROMPT:
    "${r.task2}"

    USER'S TASK 2 RESPONSE (Word Count: ${a.split(/\s+/).filter(Boolean).length}):
    "${a}"

    ---

    YOUR ANALYSIS MUST INCLUDE:
    1.  **Overall Band Score**: Provide a single, overall estimated band score for the ENTIRE test, from 5.0 to 9.0, in 0.5 increments. Remember that Task 2 is weighted more heavily than Task 1.
    2.  **Holistic Feedback**: Write detailed feedback in HTML format. Use <ul>, <li>, and <b> tags. The feedback must provide a combined analysis, covering all four official IELTS writing criteria. For each criterion, comment on both tasks where relevant.
        - **Task Achievement (for Task 1) / Task Response (for Task 2)**: Did the writer address all parts of the tasks? Is the overview/position clear? Are ideas well-supported?
        - **Coherence and Cohesion**: Is the writing well-organized? Is paragraphing logical? Is there effective use of cohesive devices?
        - **Lexical Resource**: What is the range and accuracy of the vocabulary? Are there good collocations? Is the tone appropriate?
        - **Grammatical Range and Accuracy**: Is there a good range of sentence structures? How frequent are grammatical errors?

    Return in code block format a strict JSON object with this exact schema. Do not include any text outside the JSON block.

    {
      "band": number (e.g., 6.5, 7.0, 8.5),
      "feedback": "string (The holistic feedback for the whole test, formatted as an HTML string)"
    }
    `}const qe=({isOpen:n,onClose:a,onSelect:r,allWords:k,wordsToExclude:p,loading:u})=>{const[f,N]=t.useState(""),[S,y]=t.useState(new Set),b=t.useMemo(()=>{if(!f)return k;const o=f.toLowerCase();return k.filter(C=>C.word.toLowerCase().includes(o))},[k,f]),d=o=>{y(C=>{const c=new Set(C);return c.has(o)?c.delete(o):c.add(o),c})},F=()=>{r(Array.from(S)),a()};return n?e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-neutral-50 w-full max-w-lg rounded-[2rem] shadow-2xl border border-neutral-200 flex flex-col h-[70vh]",children:[e.jsxs("header",{className:"p-4 border-b border-neutral-200 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:f,onChange:o=>N(o.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-4 py-2 bg-white border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900",autoFocus:!0})]}),e.jsx("button",{onClick:a,className:"p-2 ml-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ke,{size:16})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-2",children:u?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ae,{size:24,className:"animate-spin text-neutral-300"})}):e.jsx("div",{className:"flex flex-col gap-1",children:b.map(o=>{const C=S.has(o.word),c=p.has(o.word);return e.jsxs("button",{onClick:()=>!c&&d(o.word),disabled:c,className:`flex items-center justify-between p-3 rounded-lg text-left transition-colors ${c?"bg-neutral-100 opacity-50 cursor-not-allowed":C?"bg-indigo-50 text-indigo-800":"hover:bg-neutral-100"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:o.word}),e.jsx("span",{className:"text-xs text-neutral-500",children:o.meaningVi})]}),c?e.jsx(ge,{size:18,className:"text-neutral-400"}):C?e.jsx(ge,{size:18,className:"text-indigo-600"}):e.jsx(Se,{size:18,className:"text-neutral-300"})]},o.id)})})}),e.jsxs("footer",{className:"p-4 border-t border-neutral-200 flex justify-end gap-3 shrink-0 bg-white/50 backdrop-blur-sm",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs hover:bg-neutral-200 transition-all",children:"Cancel"}),e.jsxs("button",{onClick:F,disabled:S.size===0,className:"px-5 py-2.5 bg-neutral-900 text-white rounded-lg font-black text-xs flex items-center space-x-2 hover:bg-neutral-800 transition-all disabled:opacity-50",children:[e.jsx(we,{size:14}),e.jsxs("span",{children:["Add (",S.size,")"]})]})]})]})}):null},Je=({title:n,setTitle:a,path:r,setPath:k,tagsInput:p,setTagsInput:u,content:f,setContent:N,note:S,setNote:y,linkedWords:b,wordCount:d,aiFeedback:F,isFeedbackOpen:o,setIsFeedbackOpen:C,isSaving:c,onCancel:T,onSave:$,onAutoLink:Y,onRemoveLink:D,isWordSelectorOpen:M,setIsWordSelectorOpen:E,allWords:U,handleManualLink:v,isAiModalOpen:P,setIsAiModalOpen:I,handleGenerateEvalPrompt:_,handleAiResult:V})=>{const[z,i]=t.useState(!1),[L,A]=t.useState(!1),[w,Z]=t.useState("ESSAY"),[q,Q]=t.useState(!1),[H,W]=t.useState(0),J=t.useRef(null),X=l=>l.trim().split(/\s+/).filter(Boolean).length,j=t.useMemo(()=>me(f),[f]),x=t.useMemo(()=>me(S),[S]),R=l=>{const h=l.currentTarget,G=h.value.slice(h.selectionStart,h.selectionEnd);W(X(G))};return t.useEffect(()=>{if(!(w==="ESSAY"&&z))return;const l=()=>{const h=window.getSelection();if(!h||h.rangeCount===0||h.isCollapsed){W(0);return}const G=J.current;if(!G){W(0);return}const te=h.getRangeAt(0).commonAncestorContainer;if(!G.contains(te.nodeType===Node.TEXT_NODE?te.parentNode:te)){W(0);return}W(X(h.toString()))};return document.addEventListener("selectionchange",l),()=>document.removeEventListener("selectionchange",l)},[w,z]),e.jsxs("div",{className:"w-full flex flex-col bg-neutral-50",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-1 px-6 pt-0 pb-1.5 border-b border-neutral-200 bg-neutral-50",children:[e.jsx("div",{className:"-mt-1",children:e.jsxs("h2",{className:"text-2xl font-black leading-none text-neutral-900 tracking-tight flex items-center gap-2 -mt-1",children:[e.jsx(ee,{size:18})," Compose"]})}),e.jsxs("div",{className:"flex items-center gap-2 -mt-1",children:[e.jsxs("button",{onClick:()=>I(!0),disabled:!f.trim(),className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all disabled:opacity-50",children:[e.jsx(oe,{size:14,className:"text-indigo-500"}),e.jsx("span",{children:"AI Evaluate"})]}),e.jsxs("button",{onClick:$,disabled:c,className:"px-6 py-2.5 bg-white border border-neutral-300 text-neutral-700 rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-50 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[c?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(ie,{size:14}),e.jsx("span",{children:c?"Saving...":"Save"})]}),e.jsxs("button",{onClick:T,disabled:c,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Close"})]})]})]}),e.jsxs("div",{className:"bg-white px-6 pt-4 pb-2 flex flex-col",children:[e.jsxs("div",{className:"mb-3 bg-white border border-neutral-200 rounded-2xl overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>Q(l=>!l),className:"w-full flex items-center justify-between px-6 py-3 text-left hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Topic"}),e.jsx("div",{className:"text-sm font-bold text-neutral-900",children:"Edit Title"})]}),e.jsx("span",{className:"text-xs font-bold text-neutral-500",children:q?"Collapse":"Expand"})]}),q&&e.jsxs("div",{className:"px-6 pb-4 pt-1 space-y-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Title (Optional)"}),e.jsx("input",{type:"text",value:n,onChange:l=>a(l.target.value),placeholder:"My Awesome Essay",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(de,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:p,onChange:l=>u(l.target.value),placeholder:"e.g. Environment, Technology",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between border-b border-neutral-200 pb-2 mb-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Z("ESSAY"),className:`px-4 py-2 text-[10px] font-black rounded-xl uppercase tracking-widest transition-all ${w==="ESSAY"?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:"Essay"}),e.jsx("button",{onClick:()=>{Z("NOTE"),W(0)},className:`px-4 py-2 text-[10px] font-black rounded-xl uppercase tracking-widest transition-all ${w==="NOTE"?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:"Note"})]}),w==="ESSAY"&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-neutral-100 border border-neutral-200 text-[10px] font-black uppercase tracking-wider text-neutral-600",children:["Total Words: ",d]}),e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-cyan-50 border border-cyan-100 text-[10px] font-black uppercase tracking-wider text-cyan-700",children:["Selected Words: ",H]}),e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Content (Markdown Supported)"}),e.jsxs("button",{onClick:()=>i(!z),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[z?e.jsx(ee,{size:12}):e.jsx(he,{size:12}),e.jsx("span",{children:z?"Edit":"Preview"})]})]}),w==="NOTE"&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Private Note (Markdown Supported)"}),e.jsxs("button",{onClick:()=>A(!L),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[L?e.jsx(ee,{size:12}):e.jsx(he,{size:12}),e.jsx("span",{children:L?"Edit":"Preview"})]})]})]}),w==="ESSAY"&&e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[510px] relative overflow-hidden",children:z?e.jsx("div",{ref:J,className:"p-6 prose prose-sm max-w-none prose-p:text-neutral-600 prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:j}}):e.jsx("textarea",{value:f,onChange:l=>N(l.target.value),onSelect:R,onKeyUp:R,className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white",placeholder:"Start writing...",spellCheck:!0,autoCorrect:"on",autoCapitalize:"sentences",lang:"en"})})}),w==="NOTE"&&e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[510px] relative overflow-hidden",children:L?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-p:text-neutral-600 prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:x}}):e.jsx("textarea",{value:S,onChange:l=>y(l.target.value),className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white",placeholder:"Write your private notes here...",spellCheck:!1})})})]}),F&&e.jsxs("div",{className:"bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm animate-in slide-in-from-bottom-4 overflow-hidden transition-all",children:[e.jsxs("button",{onClick:()=>C(!o),className:"w-full flex items-center justify-between p-6 md:px-8 hover:bg-neutral-50 transition-colors",children:[e.jsxs("h3",{className:"text-lg font-black text-indigo-900 flex items-center gap-2",children:[e.jsx(oe,{size:20})," AI Feedback"]}),e.jsx(Ne,{size:20,className:`text-indigo-400 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsx("div",{className:"px-8 pb-8 pt-0 animate-in fade-in slide-in-from-top-2",children:e.jsx("div",{className:"prose prose-sm max-w-none text-neutral-700 prose-headings:font-bold prose-headings:text-indigo-900 [&_ul]:list-disc [&_ul]:pl-4 [&_li]:mb-1 [&_b]:text-neutral-900",dangerouslySetInnerHTML:{__html:F}})})]}),M&&e.jsx(qe,{isOpen:M,onClose:()=>E(!1),onSelect:v,allWords:U,wordsToExclude:new Set(b.map(l=>l.word)),loading:!1}),P&&e.jsx(ne,{isOpen:P,onClose:()=>I(!1),type:"EVALUATE_PARAPHRASE",title:"Evaluate Composition",description:`AI will analyze your writing based on tags: ${p||"General"}`,initialData:{},hidePrimaryInput:!0,onGeneratePrompt:_,onJsonReceived:V})]})},Ke=({controller:n,user:a,initialComposition:r,onSave:k,onCancel:p})=>{const[u,f]=t.useState(""),[N,S]=t.useState(""),[y,b]=t.useState(""),[d,F]=t.useState(""),[o,C]=t.useState(""),[c,T]=t.useState(new Set),[$,Y]=t.useState(void 0),[D,M]=t.useState(!1),[E,U]=t.useState([]),[v,P]=t.useState(!1),[I,_]=t.useState(!1),[V,z]=t.useState(!1),[i,L]=t.useState(!1),{showToast:A}=re();t.useEffect(()=>{if((async()=>{const x=Te().filter(R=>R.userId===a.id);U(x)})(),r){if(f(r.title||""),r.path===void 0){const x=r.tags&&r.tags.length>0?r.tags:r.label?[r.label]:[],R=x.find(h=>h.startsWith("/")),l=x.filter(h=>!h.startsWith("/"));S(R||"/"),b(l.join(", "))}else S(r.path||"/"),b((r.tags||[]).join(", "));F(r.content),C(r.note||""),T(new Set(r.linkedWordIds)),Y(r.aiFeedback),r.aiFeedback&&_(!0)}else f(""),S("/"),b(""),F(""),C(""),T(new Set),Y(void 0),_(!1)},[r,a.id]),t.useEffect(()=>{M(r?u!==(r.title||"")||d!==r.content||o!==(r.note||"")||y!==(r.tags||[]).join(", ")||N!==(r.path||"/"):!!u||!!d||!!o||!!y)},[u,d,o,y,N,r]),t.useEffect(()=>{n!=null&&n.setHasWritingUnsavedChanges&&n.setHasWritingUnsavedChanges(D)},[D,n]),t.useEffect(()=>{const j=x=>{D&&(x.preventDefault(),x.returnValue="")};return window.addEventListener("beforeunload",j),()=>window.removeEventListener("beforeunload",j)},[D]);const w=t.useMemo(()=>{const j=new Map;return E.forEach(x=>{c.has(x.id)&&j.set(x.id,x)}),Array.from(j.values())},[E,c]),Z=()=>{if(!d.trim())return;const j=d.toLowerCase();let x=0;const R=new Set(c);E.forEach(l=>{if(!R.has(l.id)){const h=[l.word];l.wordFamily&&(l.wordFamily.nouns&&h.push(...l.wordFamily.nouns.map(B=>B.word)),l.wordFamily.verbs&&h.push(...l.wordFamily.verbs.map(B=>B.word)),l.wordFamily.adjs&&h.push(...l.wordFamily.adjs.map(B=>B.word)),l.wordFamily.advs&&h.push(...l.wordFamily.advs.map(B=>B.word))),h.some(B=>j.includes(B.toLowerCase()))&&(R.add(l.id),x++)}}),x>0?(T(R),A(`Auto-linked ${x} new words!`,"success")):A("No new words found from library.","info")},q=j=>{const x=new Set(c);let R=0;const l=new Map;E.forEach(h=>l.set(h.word,h)),j.forEach(h=>{const G=l.get(h);G&&!x.has(G.id)&&(x.add(G.id),R++)}),T(x),z(!1),R>0&&A(`Linked ${R} words manually.`,"success")},Q=j=>{const x=new Set(c);x.delete(j),T(x)},H=async()=>{if(!d.trim()){A("Content cannot be empty.","error");return}P(!0);try{const j=Date.now(),x=y.split(",").map(l=>l.trim()).filter(Boolean),R={id:(r==null?void 0:r.id)||`comp-${j}-${Math.random()}`,userId:a.id,title:u.trim(),label:"Free Write",path:N.trim(),tags:x,content:d,note:o,linkedWordIds:Array.from(c),aiFeedback:$,createdAt:(r==null?void 0:r.createdAt)||j,updatedAt:j};await ce(R),A("Composition saved.","success"),M(!1),n!=null&&n.setHasWritingUnsavedChanges&&n.setHasWritingUnsavedChanges(!1),k()}catch(j){console.error(j),A("Failed to save.","error")}finally{P(!1)}},W=()=>Be(d,y||"Free Write"),J=j=>{Y(j.feedback),L(!1),_(!0),A("Feedback received!","success")},X=d.split(/\s+/).filter(Boolean).length;return e.jsx(Je,{title:u,setTitle:f,path:N,setPath:S,tagsInput:y,setTagsInput:b,content:d,setContent:F,note:o,setNote:C,linkedWords:w,wordCount:X,aiFeedback:$,isFeedbackOpen:I,setIsFeedbackOpen:_,isSaving:v,onCancel:async()=>{D&&await H(),p()},onSave:H,onAutoLink:Z,onRemoveLink:Q,isWordSelectorOpen:V,setIsWordSelectorOpen:z,allWords:E,handleManualLink:q,isAiModalOpen:i,setIsAiModalOpen:L,handleGenerateEvalPrompt:W,handleAiResult:J})},be=n=>n>=8?"text-green-500":n>=7?"text-emerald-500":n>=6?"text-amber-500":"text-rose-500",Qe=({score:n,size:a="large"})=>a==="inline"?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400",children:"Band:"}),e.jsx("span",{className:`font-black ${be(n)}`,children:n.toFixed(1)})]}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:"Est. Band"}),e.jsx("div",{className:`text-5xl font-black ${be(n)}`,children:n.toFixed(1)})]}),Xe=({topic:n,step:a,task1Response:r,setTask1Response:k,task2Response:p,setTask2Response:u,formattedTime:f,timeLeft:N,wordCount1:S,wordCount2:y,finalResult:b,onComplete:d,onGetEvaluation:F})=>a==="ANALYZING"?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[80vh]",children:[e.jsx(ae,{size:40,className:"animate-spin text-neutral-400"}),e.jsx("p",{className:"text-sm font-bold text-neutral-500 mt-4",children:"AI is evaluating your writing..."})]}):a==="RESULT"&&b?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Session Report"}),e.jsxs("p",{className:"text-neutral-500 mt-1",children:["Topic: ",e.jsx("span",{className:"font-bold text-neutral-700",children:b.topicName})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex items-center justify-between",children:[e.jsx(Qe,{score:b.estimatedBand}),e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Session Date"}),e.jsx("p",{className:"font-mono text-xs",children:new Date(b.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("h4",{className:"text-sm font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(Ue,{size:16})," Examiner's Feedback"]}),e.jsx("div",{className:"text-sm text-neutral-800 leading-relaxed font-medium bg-neutral-50/50 p-4 rounded-2xl border border-neutral-100 [&_ul]:list-disc [&_ul]:pl-4 [&_li]:mb-1 [&_b]:text-neutral-900",dangerouslySetInnerHTML:{__html:b.feedbackHtml}})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsx("h4",{className:"text-sm font-black text-neutral-900",children:"Your Responses"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("details",{className:"p-4 rounded-xl border border-neutral-100 bg-neutral-50/50",children:[e.jsx("summary",{className:"font-bold text-xs text-neutral-600 cursor-pointer",children:"View Task 1 Response"}),e.jsxs("p",{className:"text-sm font-medium italic text-neutral-700 mt-2 pt-2 border-t border-neutral-200 whitespace-pre-wrap",children:['"',b.task1Response,'"']})]}),e.jsxs("details",{className:"p-4 rounded-xl border border-neutral-100 bg-neutral-50/50",children:[e.jsx("summary",{className:"font-bold text-xs text-neutral-600 cursor-pointer",children:"View Task 2 Response"}),e.jsxs("p",{className:"text-sm font-medium italic text-neutral-700 mt-2 pt-2 border-t border-neutral-200 whitespace-pre-wrap",children:['"',b.task2Response,'"']})]})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:d,className:"px-8 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest",children:"Back to Library"})})]}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(ye,{size:16}),e.jsx("span",{children:"Quit Session"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 text-lg font-black px-4 py-2 rounded-xl border-2 ${N<300?"bg-red-50 text-red-600 border-red-100":"bg-white text-neutral-800 border-neutral-200"}`,children:[e.jsx(Ce,{size:20}),e.jsx("span",{children:f})]}),e.jsxs("button",{onClick:F,className:"px-8 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-800 active:scale-95 uppercase tracking-widest shadow-lg",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Get AI Evaluation"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-neutral-400 mb-2",children:"Task 1"}),e.jsx("p",{className:"text-sm font-medium text-neutral-700 mb-4 whitespace-pre-wrap",children:n.task1}),e.jsx("textarea",{value:r,onChange:o=>k(o.target.value),className:"w-full flex-1 p-4 bg-neutral-50/50 border border-neutral-200/80 rounded-2xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 focus:outline-none min-h-[300px]",placeholder:"Write at least 150 words..."}),e.jsxs("p",{className:`text-right text-xs font-bold mt-2 ${S<150?"text-red-500":"text-green-600"}`,children:[S," words"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-neutral-400 mb-2",children:"Task 2"}),e.jsx("p",{className:"text-sm font-medium text-neutral-700 mb-4 whitespace-pre-wrap",children:n.task2}),e.jsx("textarea",{value:p,onChange:o=>u(o.target.value),className:"w-full flex-1 p-4 bg-neutral-50/50 border border-neutral-200/80 rounded-2xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 focus:outline-none min-h-[300px]",placeholder:"Write at least 250 words..."}),e.jsxs("p",{className:`text-right text-xs font-bold mt-2 ${y<250?"text-red-500":"text-green-600"}`,children:[y," words"]})]})]})]}),Ze=({user:n,topic:a,onComplete:r})=>{const[k,p]=t.useState("PRACTICING"),[u,f]=t.useState(""),[N,S]=t.useState(""),[y,b]=t.useState(3600),[d,F]=t.useState(null),[o,C]=t.useState(!1),{showToast:c}=re(),T=t.useRef(null),$=u.split(/\s+/).filter(Boolean).length,Y=N.split(/\s+/).filter(Boolean).length;t.useEffect(()=>(T.current=window.setInterval(()=>{b(v=>v<=1?(T.current&&clearInterval(T.current),M(),0):v-1)},1e3),()=>{T.current&&clearInterval(T.current)}),[]);const D=v=>{const P=Math.floor(v/60),I=v%60;return`${P.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`},M=()=>{if(!u.trim()&&!N.trim()){c("Both tasks are empty. Nothing to evaluate.","error");return}T.current&&clearInterval(T.current),C(!0)},E=()=>Ve(u,N,a),U=async v=>{try{if(!v||typeof v.band!="number"||!v.feedback)throw new Error("Invalid JSON structure from AI.");p("ANALYZING");const P={id:`wrt-log-${Date.now()}`,userId:n.id,timestamp:Date.now(),topicName:a.name,task1Response:u,task2Response:N,estimatedBand:v.band,feedbackHtml:v.feedback};await Ie(P),F(P),p("RESULT"),C(!1)}catch(P){throw c(P.message,"error"),p("PRACTICING"),P}};return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{topic:a,step:k,task1Response:u,setTask1Response:f,task2Response:N,setTask2Response:S,formattedTime:D(y),timeLeft:y,wordCount1:$,wordCount2:Y,finalResult:d,onComplete:r,onGetEvaluation:M}),e.jsx(ne,{isOpen:o,onClose:()=>C(!1),type:"EVALUATE_PARAPHRASE",title:"Manual AI Evaluation",description:"Your essays have been added to the prompt. Copy it, get JSON from your AI, then paste the result.",onGeneratePrompt:E,onJsonReceived:U})]})},et="vocab_pro_writing_view_settings",tt=({user:n,topic:a,onSave:r,onCancel:k})=>{const[p,u]=t.useState(a.name),[f,N]=t.useState(a.description),[S,y]=t.useState(a.task1),[b,d]=t.useState(a.task2),[F,o]=t.useState("/"),[C,c]=t.useState(""),[T,$]=t.useState(!1),[Y,D]=t.useState(!1),[M,E]=t.useState("ESSAY"),[U,v]=t.useState(a.note||""),{showToast:P}=re(),I=p!==a.name||f!==a.description||S!==a.task1||b!==a.task2||U!==(a.note||"");t.useEffect(()=>{const i=L=>{I&&(L.preventDefault(),L.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[I]),t.useEffect(()=>{if(a.path===void 0){const i=a.tags||[],L=i.find(w=>w.startsWith("/")),A=i.filter(w=>!w.startsWith("/"));o(L||"/"),c(A.join(", "))}else o(a.path||"/"),c((a.tags||[]).join(", "))},[a]);const _=async()=>{$(!0);const i=C.split(",").map(A=>A.trim()).filter(Boolean),L={...a,name:p.trim()||"Untitled Topic",description:f.trim(),task1:S.trim(),task2:b.trim(),note:U.trim(),path:F.trim(),tags:i,updatedAt:Date.now()};await se(L),P("Topic saved!","success"),$(!1),r()},V=i=>{const L={...a,name:p,description:f,task1:S,task2:b,tags:C.split(",").map(A=>A.trim())};return Ye(L,i.request,n)},z=i=>{u(i.name),N(i.description),y(i.task1),d(i.task2),P("AI refinement applied!","success"),D(!1)};return e.jsxs("div",{className:"w-full p-6 md:p-10 space-y-6 animate-in fade-in duration-300 bg-neutral-50",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight flex items-center gap-3",children:[e.jsx(ee,{size:28})," Edit Topic"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>D(!0),className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all",children:[e.jsx(Me,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:_,disabled:T,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[T?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(ie,{size:14}),e.jsx("span",{children:T?"Saving...":"Save Changes"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Topic Name"}),e.jsx("input",{type:"text",value:p,onChange:i=>u(i.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Description"}),e.jsx("input",{type:"text",value:f,onChange:i=>N(i.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-2",children:[e.jsx(de,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:C,onChange:i=>c(i.target.value),placeholder:"e.g. Environment, Technology",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"flex gap-2 border-b border-neutral-200 pb-2",children:[e.jsx("button",{onClick:()=>E("ESSAY"),className:`px-4 py-2 text-xs font-black rounded-xl transition-all ${M==="ESSAY"?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:"Essay"}),e.jsx("button",{onClick:()=>E("NOTE"),className:`px-4 py-2 text-xs font-black rounded-xl transition-all ${M==="NOTE"?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:"Note"})]}),M==="ESSAY"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Task 1 Prompt"}),e.jsx("textarea",{value:S,onChange:i=>y(i.target.value),rows:6,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none font-medium"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Task 2 Prompt"}),e.jsx("textarea",{value:b,onChange:i=>d(i.target.value),rows:6,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none font-medium"})]})]}),M==="NOTE"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Private Note"}),e.jsx("textarea",{value:U,onChange:i=>v(i.target.value),rows:10,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none font-medium"})]})]}),Y&&e.jsx(ne,{isOpen:Y,onClose:()=>D(!1),type:"REFINE_UNIT",title:"Refine Writing Topic",description:"Let AI improve or generate tasks for your topic.",onGeneratePrompt:V,onJsonReceived:z})]})},xt=({controller:n,user:a,initialContextWord:r,onConsumeContext:k})=>{const[p,u]=t.useState([]),[f,N]=t.useState([]),[S,y]=t.useState(!0),{showToast:b}=re(),[d,F]=t.useState("COMPOSITIONS"),[o,C]=t.useState(""),[c,T]=t.useState(null),[$,Y]=t.useState(!1),[D,M]=t.useState(!1),[E,U]=t.useState(()=>Ee(et,{showDetails:!0,compact:!1})),[v,P]=t.useState("all"),[I,_]=t.useState("all"),[V,z]=t.useState(0),[i,L]=t.useState(12),[A,w]=t.useState("LIST"),[Z,q]=t.useState(null),[Q,H]=t.useState(null),[W,J]=t.useState(null),[X,j]=t.useState(!1),x=t.useCallback(async()=>{y(!0);try{const[s,g]=await Promise.all([Ae(a.id),Oe(a.id)]);u(s.sort((m,O)=>O.createdAt-m.createdAt)),N(g.sort((m,O)=>O.createdAt-m.createdAt))}finally{y(!1)}},[a.id]);t.useEffect(()=>{x()},[x]),t.useEffect(()=>{z(0)},[d,c,i,v,I,o]),t.useEffect(()=>{r&&(q({id:"",userId:a.id,title:"",label:"Free Write",content:r.word+" ",linkedWordIds:[r.id],createdAt:Date.now(),updatedAt:Date.now()}),w("EDIT_COMP"),k&&k())},[r,k,a.id]);const R=t.useMemo(()=>d!=="COMPOSITIONS"||v!=="all"||I!=="all",[d,v,I]),l=t.useMemo(()=>d==="COMPOSITIONS"?p:f,[p,f,d]),h=t.useMemo(()=>{let s=d==="COMPOSITIONS"?p:f;const g=o.toLowerCase().trim();return s=s.filter(m=>{if(g){if("content"in m){if(!(m.title||"").toLowerCase().includes(g)&&!m.content.toLowerCase().includes(g))return!1}else if(!m.name.toLowerCase().includes(g)&&!m.description.toLowerCase().includes(g))return!1}return!(v==="focused"&&!m.isFocused||I!=="all"&&m.focusColor!==I)}),c?c==="Uncategorized"?s.filter(m=>{const O=m.path??(m.tags||[]).find(ve=>ve.startsWith("/"));return!(O&&O!=="/")}):s.filter(m=>{var O,K;return((O=m.path)==null?void 0:O.startsWith(c))||((K=m.tags)==null?void 0:K.includes(c))}):s},[p,f,d,c,v,I,o]),G=t.useMemo(()=>{const s=V*i;return h.slice(s,s+i)},[h,V,i]),B=()=>{if(d==="COMPOSITIONS")q(null),w("EDIT_COMP");else{const s={id:`wrt-${Date.now()}`,userId:a.id,name:"New Topic",description:"",task1:"",task2:"",note:"",tags:[],createdAt:Date.now(),updatedAt:Date.now()};H(s),w("EDIT_TOPIC")}},te=async()=>{W&&(W.type==="COMP"?await De(W.id,a.id):await ze(W.id),b("Item deleted.","success"),J(null),x())},ue=async s=>{j(!1);try{if(s&&s.topic&&s.task1&&s.task2){const g={id:`wrt-gen-${Date.now()}`,userId:a.id,name:`Mock: ${s.topic}`,description:`Full test generated on ${s.topic}.`,task1:s.task1,task2:s.task2,note:"",tags:["Mock Test","Generated"],createdAt:Date.now(),updatedAt:Date.now()};await se(g),await x(),b("Test generated successfully!","success"),H(g),w("SESSION")}else throw new Error("Invalid response")}catch{b("Failed to generate test.","error")}},xe=async(s,g)=>{const m={...s,focusColor:g||void 0,updatedAt:Date.now()};g||delete m.focusColor,"content"in s?(u(O=>O.map(K=>K.id===s.id?m:K)),await ce(m)):(N(O=>O.map(K=>K.id===s.id?m:K)),await se(m))},pe=async s=>{const g={...s,isFocused:!s.isFocused,updatedAt:Date.now()};"content"in s?(u(m=>m.map(O=>O.id===s.id?g:O)),await ce(g)):(N(m=>m.map(O=>O.id===s.id?g:O)),await se(g))};return A==="EDIT_COMP"?e.jsx(Ke,{controller:n,user:a,initialComposition:Z,onSave:()=>{x()},onCancel:()=>{if(n.hasWritingUnsavedChanges){n.setHasWritingUnsavedChanges(!0);return}w("LIST")}}):A==="EDIT_TOPIC"&&Q?e.jsx(tt,{user:a,topic:Q,onSave:()=>{x()},onCancel:()=>w("LIST")}):A==="SESSION"&&Q?e.jsx(Ze,{user:a,topic:Q,onComplete:()=>{w("LIST"),x()}}):e.jsxs(e.Fragment,{children:[e.jsx(We,{title:"Writing Library",subtitle:"Practice writing and track vocabulary usage.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Memo.png",className:"w-8 h-8 object-contain",alt:"Writing"}),query:o,onQueryChange:C,searchPlaceholder:"Search writings or topics...",config:{},activeFilters:{},onFilterChange:()=>{},isLoading:S,isEmpty:h.length===0,emptyMessage:"No items found.",pagination:{page:V,totalPages:Math.ceil(h.length/i),onPageChange:z,pageSize:i,onPageSizeChange:L,totalItems:h.length},aboveGrid:e.jsx(e.Fragment,{children:$&&e.jsx(_e,{items:l,selectedTag:c,onSelectTag:T,forcedView:"tags",title:"Browse Tags",icon:e.jsx(de,{size:16})})}),minorSkills:d==="TOPICS"&&e.jsxs("button",{onClick:()=>j(!0),className:"px-5 py-3 bg-white border border-neutral-200 text-indigo-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Re,{size:16}),e.jsx("span",{children:"Generate Test"})]}),actions:e.jsx($e,{viewMenu:e.jsx(Ge,{isOpen:D,setIsOpen:M,hasActiveFilters:R,filterOptions:[{label:"Writings",value:"COMPOSITIONS",isActive:d==="COMPOSITIONS",onClick:()=>{F("COMPOSITIONS"),T(null)}},{label:"Topics",value:"TOPICS",isActive:d==="TOPICS",onClick:()=>{F("TOPICS"),T(null)}}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Le,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>P(v==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${v==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:v==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>_(I==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>_(I==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>_(I==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Details",checked:E.showDetails,onChange:()=>U(s=>({...s,showDetails:!s.showDetails}))},{label:"Compact",checked:E.compact,onChange:()=>U(s=>({...s,compact:!s.compact}))}]}),browseTags:{isOpen:$,onToggle:()=>{Y(!$)}},addActions:[{label:"Add",icon:we,onClick:B}]}),children:()=>e.jsx(e.Fragment,{children:d==="COMPOSITIONS"?G.map(s=>{const g=s.tags||(s.label?[s.label]:[]);return e.jsx(fe,{title:s.title||"Untitled Composition",tags:g,compact:E.compact,onClick:()=>{q(s),w("EDIT_COMP")},focusColor:s.focusColor,onFocusChange:m=>xe(s,m),isFocused:s.isFocused,onToggleFocus:()=>pe(s),isCompleted:s.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),q(s),w("EDIT_COMP")},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ee,{size:14})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),J({id:s.id,type:"COMP"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{size:14})})]}),footer:s.linkedWordIds.length>0&&e.jsxs("div",{className:"text-[10px] font-bold text-neutral-400",children:[s.linkedWordIds.length," words linked"]}),children:E.showDetails&&e.jsx("p",{className:"line-clamp-4",children:s.content})},s.id)}):G.map(s=>e.jsx(fe,{title:s.name,tags:s.tags,compact:E.compact,onClick:()=>{H(s),w("SESSION")},focusColor:s.focusColor,onFocusChange:g=>xe(s,g),isFocused:s.isFocused,onToggleFocus:()=>pe(s),isCompleted:s.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),H(s),w("SESSION")},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Practice",children:e.jsx(Pe,{size:14})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),H(s),w("EDIT_TOPIC")},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ee,{size:14})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),J({id:s.id,type:"TOPIC"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{size:14})})]}),children:E.showDetails&&e.jsx("p",{className:"line-clamp-2",children:s.description||"No description."})},s.id))})}),e.jsx(Fe,{isOpen:!!W,title:"Delete Item?",message:"This action cannot be undone.",confirmText:"Delete",isProcessing:!1,onConfirm:te,onClose:()=>J(null),icon:e.jsx(le,{size:40,className:"text-red-500"})}),X&&e.jsx(ne,{isOpen:X,onClose:()=>j(!1),type:"REFINE_UNIT",title:"Generate Full Test",description:"Enter a theme (e.g. 'Environment', 'Technology') to generate a full Task 1 & 2 test.",initialData:{request:""},onGeneratePrompt:s=>He(s.request||"Random"),onJsonReceived:ue,actionLabel:"Generate"})]})};export{xt as WritingStudioPage,xt as default};
