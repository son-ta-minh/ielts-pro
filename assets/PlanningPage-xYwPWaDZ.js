import{c as O,r as o,a3 as V,z as K,j as e,P as Q,aC as A,S as X,aj as D,aD as Y,az as _,bP as H,Y as Z,aw as ee,bQ as E,bR as te,X as se}from"./index-jRoTGL-6.js";import{R as ae,a as re}from"./ResourceActions-DMep5xqI.js";import{U as ne,C as le}from"./UniversalCard-DkelVqfB.js";import{F as oe}from"./FileSelector-DHMeisSR.js";import{L as R}from"./list-todo-DO-itWoX.js";import{D as ie}from"./download-BJvjCgxK.js";import"./chevron-left-IyUtyJLQ.js";import"./tag-QMINstTr.js";import"./server-DMgN4vdb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=O("CircleDashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);function ue(n){return`You are an expert study planner and productivity coach.

TASK:
Create a structured learning goal based on the user's request. The goal should be broken down into specific, actionable tasks (todos).

USER REQUEST: "${n}"

INSTRUCTIONS:
1.  **Analyze the Request**: Identify the main subject (e.g., "Collins Reading for IELTS", "Learn 50 phrasal verbs", "Writing Task 1 practice").
2.  **Create a Title**: A concise, motivating title for the goal.
3.  **Create a Description**: A brief overview of what this goal achieves.
4.  **Generate Todos**: Break the goal down into logical steps or units.
    -   If the request refers to a specific book or course (e.g., "18 lessons of Collins Reading"), generate exactly that number of tasks, matching the unit titles if possible or using logical generic titles.
    -   If the request is general (e.g., "Learn vocabulary"), create a logical progression (e.g., "Day 1: Family", "Day 2: Work").
    -   Each task should be clear and actionable.

STRICT JSON OUTPUT FORMAT:
Return a single JSON object. Do not include any text outside the JSON block.

{
  "title": "string (Goal Title)",
  "description": "string (Goal Description)",
  "todos": [
    {
      "text": "string (Task description, e.g., 'Unit 1: Family & Relationships - Complete exercises')"
    },
    {
      "text": "string (Task description, e.g., 'Unit 2: Health & Fitness - Review vocabulary')"
    }
  ]
}`}const M={NEW:{icon:le,color:"text-neutral-300",bg:"bg-neutral-100",label:"New"},IN_PROGRESS:{icon:ce,color:"text-blue-500",bg:"bg-blue-50",label:"In Progress"},CLOSED:{icon:se,color:"text-green-500",bg:"bg-green-50",label:"Closed"}},pe=({todo:n,readOnly:v,onStatusChange:x,onTextChange:r,onDelete:h})=>{const[f,y]=o.useState(!1),w=M[n.status],c=w.icon;return v?e.jsxs("div",{className:`flex items-start gap-2.5 py-1.5 ${n.status==="CLOSED"?"opacity-50":""}`,children:[e.jsx(c,{size:14,className:`mt-0.5 shrink-0 ${w.color}`}),e.jsx("span",{className:`text-xs font-medium leading-snug ${n.status==="CLOSED"?"line-through text-neutral-400":"text-neutral-700"}`,children:n.text})]}):e.jsxs("div",{className:"group flex items-start gap-2 p-2 bg-white border border-neutral-200 rounded-xl hover:border-neutral-300 transition-all focus-within:ring-2 focus-within:ring-neutral-900/5 focus-within:border-neutral-400",children:[e.jsxs("div",{className:"relative shrink-0 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>y(!f),className:`p-1 rounded-md hover:bg-neutral-100 transition-colors ${w.color}`,title:"Change Status",children:e.jsx(c,{size:18})}),f&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white rounded-xl shadow-xl border border-neutral-100 z-50 p-1 flex flex-col gap-1 animate-in fade-in zoom-in-95",children:Object.keys(M).map(i=>{const d=M[i],b=d.icon;return e.jsxs("button",{type:"button",onClick:()=>{x==null||x(i),y(!1)},className:`flex items-center gap-2 px-2 py-2 rounded-lg text-xs font-bold transition-colors w-full text-left ${n.status===i?"bg-neutral-100":"hover:bg-neutral-50"}`,children:[e.jsx(b,{size:14,className:d.color}),e.jsx("span",{className:"text-neutral-600",children:d.label})]},i)})})]}),e.jsx("input",{type:"text",value:n.text,onChange:i=>r==null?void 0:r(i.target.value),className:`flex-1 bg-transparent border-none outline-none text-sm font-medium py-1 ${n.status==="CLOSED"?"text-neutral-400 line-through":"text-neutral-900"}`,placeholder:"Task description..."}),e.jsx("button",{type:"button",onClick:h,className:"p-1.5 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all self-start mt-0.5",title:"Remove Task",children:e.jsx(A,{size:14})})]})},xe=({isOpen:n,onClose:v,onSave:x,initialData:r})=>{const[h,f]=o.useState(""),[y,w]=o.useState(""),[c,i]=o.useState([]),[d,b]=o.useState("");o.useEffect(()=>{n&&(f((r==null?void 0:r.title)||""),w((r==null?void 0:r.description)||""),i((r==null?void 0:r.todos)||[]),b(""))},[n,r]);const S=()=>{if(!d.trim())return;const a={id:`todo-${Date.now()}-${Math.random()}`,text:d.trim(),status:"NEW"};i([...c,a]),b("")},k=(a,j)=>{i(N=>N.map(p=>p.id===a?{...p,...j}:p))},G=a=>{i(j=>j.filter(N=>N.id!==a))},I=()=>{h.trim()&&x({title:h,description:y,todos:c})};return n?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:r?"Edit Goal":"New Goal"}),e.jsx("button",{onClick:v,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Z,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-6 flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Goal Title"}),e.jsx("input",{value:h,onChange:a=>f(a.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none",placeholder:"e.g. Master Phrasal Verbs",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Description (Optional)"}),e.jsx("textarea",{value:y,onChange:a=>w(a.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-900 outline-none resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-end px-1",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(R,{size:14})," Task List"]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 bg-neutral-100 px-2 py-0.5 rounded-full",children:c.length})]}),e.jsx("div",{className:"space-y-2",children:c.map(a=>e.jsx(pe,{todo:a,readOnly:!1,onStatusChange:j=>k(a.id,{status:j}),onTextChange:j=>k(a.id,{text:j}),onDelete:()=>G(a.id)},a.id))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{value:d,onChange:a=>b(a.target.value),onKeyDown:a=>a.key==="Enter"&&S(),className:"flex-1 px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none transition-all focus:bg-white",placeholder:"Add a new task..."}),e.jsx("button",{onClick:S,disabled:!d.trim(),className:"px-4 bg-neutral-900 text-white rounded-xl hover:bg-red-800 disabled:opacity-50 transition-colors shadow-sm",children:e.jsx(D,{size:20})})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:e.jsxs("button",{onClick:I,disabled:!h.trim(),className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50 hover:scale-105 transition-transform",children:[e.jsx(ee,{size:14})," ",e.jsx("span",{children:"Save Changes"})]})})]})}):null},ke=({user:n,initialAction:v,onActionConsumed:x})=>{const[r,h]=o.useState([]),[f,y]=o.useState(!0),[w,c]=o.useState(!1),[i,d]=o.useState(null),[b,S]=o.useState(null),[k,G]=o.useState(null),[I,a]=o.useState(!1),[j,N]=o.useState(!1),{showToast:p}=V(),T=o.useCallback(async()=>{y(!0);const t=await K(n.id);h(t.sort((s,l)=>s.order!==void 0&&l.order!==void 0?s.order-l.order:s.order!==void 0?-1:l.order!==void 0?1:l.createdAt-s.createdAt)),y(!1)},[n.id]);o.useEffect(()=>{T()},[T]),o.useEffect(()=>{!f&&v&&(v==="AI"?a(!0):v==="IMPORT"&&N(!0),x==null||x())},[f,v,x]);const $=async t=>{const s=Date.now();if(i){const l={...i,...t,updatedAt:s};await E(l),p("Goal updated.","success")}else{const l={id:`goal-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos||[],createdAt:s,updatedAt:s,order:r.length};await E(l),p("Goal created.","success")}c(!1),T()},z=async()=>{b&&(await te(b.id),p("Goal deleted.","success"),S(null),T())},F=async t=>{if(t.title&&Array.isArray(t.todos)){const s=Date.now(),l={id:`goal-ai-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos.map(m=>({id:`todo-${s}-${Math.random()}`,text:m.text,status:"NEW"})),createdAt:s,updatedAt:s,order:0};await E(l),p("Goal generated by AI!","success"),a(!1),T()}else p("Invalid AI response.","error")},L=async t=>{const s=Date.now(),l=(t.todos||[]).map(g=>({id:`todo-imp-${s}-${Math.random()}`,text:g.text||g,status:"NEW"})),m={id:`goal-imp-${s}-${Math.random()}`,userId:n.id,title:t.title||"Imported Goal",description:t.description||"Imported from server.",todos:l,createdAt:s,updatedAt:s,order:0};try{await E(m),p(`Imported "${m.title}" successfully!`,"success"),await T()}catch{p("Failed to save imported goal.","error")}},U=t=>ue(t.request),q=(t,s)=>{G(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s)},W=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},J=async(t,s)=>{if(t.preventDefault(),!k||k===s)return;const l=r.findIndex(C=>C.id===k),m=r.findIndex(C=>C.id===s);if(l===-1||m===-1)return;const g=[...r],[P]=g.splice(l,1);g.splice(m,0,P);const u=g.map((C,B)=>({...C,order:B}));h(u),G(null),await H(u)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Planning Board",subtitle:"Track your learning goals and tasks.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Spiral%20Calendar.png",className:"w-8 h-8 object-contain",alt:"Planning"}),config:{},isLoading:f,isEmpty:r.length===0,emptyMessage:"No goals set. Start planning!",activeFilters:{},onFilterChange:()=>{},actions:e.jsx(re,{addActions:[{label:"New (AI)",icon:X,onClick:()=>a(!0)},{label:"New (Manual)",icon:D,onClick:()=>{d(null),c(!0)}},{label:"Add from Server",icon:ie,onClick:()=>N(!0)}]}),children:()=>e.jsx(e.Fragment,{children:r.map(t=>{const s=t.todos.length,l=t.todos.filter(u=>u.status==="CLOSED").length,m=s>0?Math.round(l/s*100):0,g=s>0&&l===s,P=k===t.id;return e.jsx("div",{draggable:!0,onDragStart:u=>q(u,t.id),onDragOver:W,onDrop:u=>J(u,t.id),className:`transition-all duration-200 h-full ${P?"opacity-40 scale-95":"opacity-100 hover:scale-[1.01]"}`,children:e.jsx(ne,{title:e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-snug mb-0.5 select-none",children:t.title}),compact:!0,onClick:()=>{d(t),c(!0)},isCompleted:g,className:"h-full",actions:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 text-neutral-300 cursor-grab active:cursor-grabbing hover:text-neutral-50 rounded-lg transition-colors mr-1",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),d(t),c(!0)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Q,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),S(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(A,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-3 select-none",children:[t.description&&e.jsx("p",{className:"text-[10px] text-neutral-400 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-neutral-500 bg-neutral-50 px-2 py-1.5 rounded-lg w-fit self-start",children:[e.jsx(R,{size:12}),e.jsxs("span",{children:[s," Tasks"]}),l>0&&e.jsxs("span",{className:"text-green-600",children:["(",l," done)"]})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[m,"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${g?"bg-green-500":"bg-indigo-500"}`,style:{width:`${m}%`}})})]})]})})},t.id)})})}),e.jsx(xe,{isOpen:w,onClose:()=>c(!1),onSave:$,initialData:i,user:n}),e.jsx(Y,{isOpen:!!b,title:"Delete Goal?",message:"This will remove the goal and all its tasks.",confirmText:"Delete",isProcessing:!1,onConfirm:z,onClose:()=>S(null),icon:e.jsx(A,{size:40,className:"text-red-500"})}),I&&e.jsx(_,{isOpen:I,onClose:()=>a(!1),type:"GENERATE_PLAN",title:"AI Goal Planner",description:"Describe your goal (e.g. 'Complete Collins Reading book') and let AI generate the task list.",initialData:{request:""},onGeneratePrompt:U,onJsonReceived:F,actionLabel:"Create Plan",closeOnSuccess:!0}),e.jsx(oe,{isOpen:j,onClose:()=>N(!1),onSelect:L,type:"planning",title:"Import Goal from Server"})]})};export{ke as PlanningPage};
