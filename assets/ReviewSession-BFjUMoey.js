import{j as e,o as Z,p as o,Z as ee,B as ce,f as de,e as xe,q as ue,A as pe,s as me,V as fe,t as he,E as ge,u as be,v as je,k as te,X as ne,d as we,w as ve,x as ye,T as Ne,y as ke,z as Se,D as Ce,r,G as se,H as K,I as X,J as Ee}from"./index-DdabRH98.js";import{T as Re}from"./trophy-D_ijEInF.js";const ze=(t,u,R)=>{if(R)return t?t==="GAVE_UP"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-amber-100 text-amber-700",children:[e.jsx(Se,{size:10})," Gave Up"]}):t==="PASS"||t===o.EASY?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-700",children:[e.jsx(te,{size:10})," Pass"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:[e.jsx(ne,{size:10})," Fail"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:[e.jsx(ke,{size:10})," No Answer"]});if(!t)return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:"Skipped"});if(u&&(t===o.EASY||t===o.LEARNED))return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-cyan-100 text-cyan-700",children:"Learned"});switch(t){case o.FORGOT:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:"Forgot"});case o.HARD:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-orange-100 text-orange-600",children:"Hard"});case o.EASY:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-600",children:"Easy"});default:return null}},Ie=({score:t})=>{const f=2*Math.PI*16,z=f-t/100*f;let w="text-neutral-400";return t>=80?w="text-green-500":t>=50?w="text-yellow-500":t>0&&(w="text-orange-500"),e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:36,height:36},children:[e.jsxs("svg",{className:"absolute",width:36,height:36,children:[e.jsx("circle",{className:"text-neutral-100",stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2}),e.jsx("circle",{className:w,stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2,strokeDasharray:f,strokeDashoffset:z,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.5s ease-out"}})]}),e.jsx("span",{className:`text-[10px] font-black ${w}`,children:t})]})},Me=({word:t})=>{const u=t.masteryScore??0;return e.jsxs("div",{className:"relative group/score",children:[e.jsx(Ie,{score:u}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/score:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Mastery Score",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]})},Ae=({complexity:t})=>e.jsxs("div",{className:"relative group/complexity",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 transition-all hover:bg-amber-100 shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black opacity-50",children:"CX"}),e.jsx("span",{className:"text-xs font-black",children:t})]}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/complexity:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Complexity Level",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]}),Te=t=>{const{user:u,initialWords:R,sessionWords:c,sessionType:f,newWordIds:z,progress:w,setProgress:T,sessionOutcomes:L,sessionFinished:_,wordInModal:C,setWordInModal:E,editingWordInModal:F,setEditingWordInModal:v,isTesting:O,setIsTesting:P,currentWord:d,isNewWord:g,onUpdate:S,onComplete:y,nextItem:re,handleReview:h,handleTestComplete:I,handleRetry:Y,handleEndSession:U,handleQuickReview:H,handleManualPractice:G,isQuickReviewMode:Q}=t,{current:N,max:B}=w,l=f==="random_test",p=a=>{E(null),v(a)},$=a=>{S(a),v(null)};if(R.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 py-20 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner",children:e.jsx(Z,{size:32})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"All clear!"}),e.jsx("button",{onClick:y,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-semibold text-sm hover:bg-neutral-800 transition-colors",children:"Back to Dashboard"})]});if(_){if(f==="new"||f==="due"||f==="new_study"||f==="custom"||l){const a=Object.values(L).filter(b=>b==="PASS"||b===o.EASY||b===o.LEARNED).length;return e.jsxs("div",{className:"max-w-2xl mx-auto py-10 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center mb-4 ${l?"bg-amber-100 text-amber-600":"bg-neutral-100 text-neutral-900"}`,children:l?e.jsx(ee,{size:40,fill:"currentColor"}):e.jsx(ce,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:l?"Test Result":"Session Recap"}),l&&e.jsxs("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-[0.2em] mt-2",children:["Score: ",a," / ",c.length]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You've completed this focused session."})]}),e.jsx("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm mb-8 overflow-hidden",children:e.jsx("div",{className:"max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 p-2",children:c.map(b=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50/70 p-2.5 rounded-xl border border-neutral-100",children:[e.jsx("span",{className:"font-bold text-neutral-800 text-xs truncate pr-2",children:b.word}),ze(L[b.id],z.has(b.id),l)]},b.id))})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:y,className:"px-6 py-4 bg-white border border-neutral-200 text-neutral-500 rounded-2xl font-bold text-xs hover:bg-neutral-50 hover:border-neutral-900 transition-all active:scale-95 uppercase tracking-widest",children:"Finish Session"}),e.jsxs("button",{onClick:Y,className:"px-6 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center justify-center space-x-2 shadow-lg hover:bg-neutral-800 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(de,{size:14}),e.jsx("span",{children:"Retry This Session"})]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in zoom-in-95 duration-500",children:[e.jsx(Re,{size:64,className:"text-yellow-500 mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You have finished this review session."}),e.jsx("button",{onClick:y,className:"mt-8 px-10 py-3.5 bg-neutral-900 text-white rounded-2xl font-bold shadow-xl hover:scale-105 transition-all text-sm",children:"Return to Dashboard"})]})}if(!d)return null;const W=g?xe:ue,V=g?"text-blue-500":"text-neutral-500",M=d.ipa||d.word,A=!!d.ipa;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-100px)] flex flex-col animate-in fade-in duration-300",children:[e.jsxs("div",{className:"px-6 shrink-0 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"w-24"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{size:14,className:V}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:[N+1," / ",c.length]})]}),e.jsx("div",{className:"w-24 text-right",children:e.jsx("button",{onClick:U,className:"px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider text-neutral-500 hover:bg-neutral-100 transition-colors",children:"End Session"})})]}),e.jsx("div",{className:"h-1 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-neutral-900 transition-all duration-300 ease-in-out",style:{width:`${(N+1)/c.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative gap-4",children:[e.jsx("button",{onClick:()=>T(a=>({...a,current:(a.current-1+c.length)%c.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Previous word",children:e.jsx(pe,{size:28})}),e.jsx("div",{className:"w-full max-w-xl h-full bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col relative overflow-hidden group select-none",children:l?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-4",children:[e.jsx(me,{className:"animate-spin text-neutral-200",size:32}),e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Loading Next Test..."})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:`font-black text-neutral-900 tracking-tight text-4xl ${A?"font-serif":""}`,children:M}),g?e.jsx(Ae,{complexity:d.complexity??0}):e.jsx(Me,{word:d}),e.jsx("button",{onClick:a=>{a.stopPropagation(),he(d.word)},className:"p-3 text-neutral-400 bg-neutral-50 hover:bg-neutral-100 hover:text-neutral-900 rounded-full transition-colors",title:"Pronounce",children:e.jsx(fe,{size:22})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>E(d),className:"flex items-center gap-2 px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(ge,{size:14}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-black text-[10px] hover:bg-amber-600 transition-all active:scale-95 uppercase tracking-widest shadow-lg shadow-amber-500/20",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Practice"})]})]})]})}),e.jsx("button",{onClick:()=>T(a=>({...a,current:(a.current+1)%c.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Next word",children:e.jsx(je,{size:28})})]}),e.jsx("div",{className:"shrink-0 pt-6 pb-2 mt-auto",children:g?e.jsxs("div",{className:"max-w-lg mx-auto grid grid-cols-3 items-stretch gap-4",children:[e.jsx("div",{})," ",e.jsxs("button",{onClick:()=>h(o.LEARNED),className:"py-5 bg-green-500 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 shadow-lg shadow-green-500/20 hover:bg-green-600 transition-all active:scale-95",children:[e.jsx(te,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"LEARNED"})]}),e.jsx("div",{})," "]}):!l&&e.jsxs("div",{className:"max-w-xl mx-auto grid grid-cols-4 items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>h(o.FORGOT),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-red-600 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(ne,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"FORGOT"})]}),e.jsxs("button",{onClick:()=>h(o.HARD),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-orange-600 hover:bg-orange-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(we,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Hard"})]}),e.jsxs("button",{onClick:()=>h(o.EASY),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-green-600 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(Z,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Easy"})]}),e.jsxs("button",{onClick:H,className:"py-5 bg-indigo-600 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all hover:bg-indigo-700 shadow-md shadow-indigo-200",children:[e.jsx(ee,{size:20,fill:"currentColor"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Quick Review"})]})]})})]}),C&&e.jsx(ve,{word:C,onUpdate:S,onClose:()=>E(null),onNavigateToWord:E,onEditRequest:p,onGainXp:async()=>0,isViewOnly:!0}),F&&e.jsx(ye,{user:u,word:F,onSave:$,onClose:()=>v(null),onSwitchToView:()=>{v(null),E(F)}}),O&&d&&e.jsx(Ne,{word:d,isQuickFire:l,sessionPosition:l?{current:N+1,total:c.length}:void 0,onPrevWord:()=>T(a=>({...a,current:Math.max(0,a.current-1)})),onClose:()=>{l?y():P(!1)},onComplete:I,skipSetup:Q})]})},Oe=(t,u,R)=>{},Pe=({user:t,sessionWords:u,sessionFocus:R,sessionType:c,onUpdate:f,onBulkUpdate:z,onComplete:w,onRetry:T})=>{const{showToast:L}=Ce(),_=u,C=r.useRef(null),[E,F]=r.useState(new Set),[v,O]=r.useState(()=>{const s=se("vocab_pro_session_progress",null);return s&&typeof s.current=="number"&&typeof s.max=="number"&&s.current<=s.max&&s.max<u.length?s:{current:0,max:0}}),[P,d]=r.useState(()=>se("vocab_pro_session_outcomes",{})),[g,S]=r.useState(new Map),{current:y,max:re}=v,[h,I]=r.useState(!1),[Y,U]=r.useState(null),[H,G]=r.useState(null),[Q,N]=r.useState(c==="random_test"),[B,l]=r.useState(!1),p=_[y],$=r.useMemo(()=>!(p!=null&&p.lastReview),[p]),W=r.useRef(g);r.useEffect(()=>{W.current=g},[g]);const V=r.useRef(h);r.useEffect(()=>{V.current=h},[h]),r.useEffect(()=>{const s=u.map(n=>n.id).sort().join(",");(C.current===null||C.current!==s)&&(C.current=s,F(new Set(u.filter(n=>!n.lastReview).map(n=>n.id))),O({current:0,max:0}),d({}),I(!1),S(new Map),sessionStorage.removeItem("vocab_pro_session_progress"),sessionStorage.removeItem("vocab_pro_session_outcomes"))},[u]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_progress",JSON.stringify(v))},[v]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_outcomes",JSON.stringify(P))},[P]),r.useEffect(()=>{U(null),G(null),N(c==="random_test"),l(!1)},[y,c]);const M=r.useCallback(async()=>{const s=Array.from(W.current.values());s.length!==0&&(await z(s),S(new Map))},[z]);r.useEffect(()=>()=>{!V.current&&W.current.size>0&&M()},[M]),r.useEffect(()=>{h&&g.size>0&&M()},[h,M,g.size]);const A=()=>{if(y<_.length-1){const s=y+1;O(n=>({current:s,max:Math.max(n.max,s)}))}else I(!0)},a=async s=>{if(!p)return;d(j=>({...j,[p.id]:s}));const n=K(p,s);S(j=>new Map(j).set(n.id,n)),A()},b=()=>{l(!0),N(!0)},ae=()=>{l(!1),N(!0)},J=(s,n)=>{const j={...s.lastTestResults||{}},D=Ee(s);return Object.entries(n).forEach(([k,x])=>{if(j[k]=x,x===!1){const i=D.find(m=>m.testKeys.includes(k));i&&i.testKeys.forEach(m=>{j[m]=!1})}}),j},le=async(s,n,j=!1,D)=>{if(N(!1),!p)return;let k={...p};if(n){const x=n.PRONUNCIATION===!1,i=n.IPA_QUIZ===!1;(x||i)&&!k.needsPronunciationFocus&&(k.needsPronunciationFocus=!0,L(`"${k.word}" marked for pronunciation focus.`,"info"))}if(B&&D){const x=D.tested-D.correct;let i=o.FORGOT;x===0?i=o.EASY:x===1&&(i=o.HARD),d(q=>({...q,[p.id]:i}));const m=K(k,i);n&&(m.lastTestResults=J(m,n)),m.masteryScore=X(m),S(q=>new Map(q).set(m.id,m)),l(!1),A();return}if(c==="random_test"){let x=j?"GAVE_UP":s===o.EASY?"PASS":"FAIL";d(m=>({...m,[p.id]:x}));const i=K(k,s);n&&(i.lastTestResults=J(i,n)),i.masteryScore=X(i),S(m=>new Map(m).set(i.id,i)),j?I(!0):A()}else{const x={...k};n&&(x.lastTestResults=J(x,n)),x.masteryScore=X(x),await f(x)}},ie=()=>{C.current=null,T()},oe=()=>{I(!0)};return e.jsx(Te,{user:t,initialWords:u,sessionWords:_,sessionType:c,newWordIds:E,progress:v,setProgress:O,sessionOutcomes:P,sessionFinished:h,wordInModal:Y,setWordInModal:U,editingWordInModal:H,setEditingWordInModal:G,isTesting:Q,setIsTesting:N,currentWord:p,isNewWord:$,onUpdate:f,onComplete:w,nextItem:A,handleReview:a,handleTestComplete:le,handleRetry:ie,handleEndSession:oe,handleQuickReview:b,handleManualPractice:ae,isQuickReviewMode:B})};export{Pe as default,Oe as logSrsUpdate};
