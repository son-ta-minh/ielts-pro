import{c as We,r as t,$ as De,j as e,S as Ke,X as Me,af as qe,aA as Ie,au as ot,ax as it,aL as Le,k as Ve,aP as Tt,aK as At,H as ze,b as Rt,b2 as et,bD as bt,av as xt,ae as It,bP as Et,aB as Xe,N as zt,bs as Mt,bQ as Pt,I as Ft,V as tt,M as Ge,bR as vt,bi as _e,aN as jt,bh as wt,aj as Je,bG as st,T as yt,ak as pt,be as $t,b4 as Nt,E as nt,bf as at,bS as Be,bA as rt,bC as lt,bB as kt,a0 as Ct,ai as St,bT as Ut,x as Lt,g as Ot,bU as Ee,A as _t,P as He,h as Bt,o as Vt,p as Gt,q as qt,bV as Wt,bW as Dt,bX as Jt}from"./index-D-83NIjs.js";import{R as Kt,a as Xt}from"./ResourceActions-CRuq4t9L.js";import{T as Yt}from"./TagBrowser-Qw1Ki3o_.js";import{V as Ht}from"./ViewMenu-BCt8od04.js";import{U as Qe}from"./UniversalCard-BjRmVhWz.js";import{T as ct}from"./tag-D_0wH-Ev.js";import{F as Qt}from"./FileSelector-Cv1LjaUt.js";import{G as Zt}from"./grip-vertical-DllGy4OV.js";import{H as mt}from"./headphones-ByL4YQuO.js";import{L as es}from"./layout-grid-CIOpE-7B.js";import{C as ht}from"./chevron-left-CiTFDgZy.js";import{E as ts}from"./ear-BPXcHe6W.js";import{D as ss}from"./download-DjhaTu3v.js";import{I as ns}from"./InteractiveTranscript-GKvD-cBf.js";import{M as as}from"./MimicPractice_UI-C7T_DB1e.js";import{L as rs}from"./layout-list-B7jd6vms.js";import{C as ls}from"./calendar-CQf32Aqh.js";import"./filter-CZQge8lR.js";import"./server-D4Z3IMar.js";import"./list-todo-DZYQoDSP.js";import"./pen-CKJHFZRI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=We("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=We("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=We("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=We("MicVocal",[["path",{d:"m11 7.601-5.994 8.19a1 1 0 0 0 .1 1.298l.817.818a1 1 0 0 0 1.314.087L15.09 12",key:"80a601"}],["path",{d:"M16.5 21.174C15.5 20.5 14.372 20 13 20c-2.058 0-3.928 2.356-6 2-2.072-.356-2.775-3.369-1.5-4.5",key:"j0ngtp"}],["circle",{cx:"16",cy:"7",r:"5",key:"d08jfb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=We("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function us(m,_,i=[]){const n=i.map(T=>{const l=T.sentence.match(/\{(.*?)\}/);return l?`"${l[1]}"`:`"${T.anchor}"`}).join(", ");return`You are an expert English linguist and communication coach.
    
    TASK: Analyze a user's input/context to generate high-quality native expressions.
    
    ${n?`EXISTING EXPRESSIONS (DO NOT DUPLICATE THESE): [${n}]`:""}

    CONTEXT / CORE CONCEPT:
    "${m}"

    USER REQUEST: "${_||"Generate a variety of expressions."}"

    INSTRUCTIONS:
    1.  **Analyze**: Understand the core concept (e.g., "Disagreeing", "Showing excitement").
    2.  **Generate NEW Expressions**: Create 3-5 NEW, distinct, and natural expressions for this concept.
        -   **IMPORTANT**: If "EXISTING EXPRESSIONS" are provided, you MUST NOT repeat them. You must find *alternatives* or *variations*.
    3.  **Tones**: Try to provide a mix of 'casual', 'semi-academic', and 'academic' tones if possible.
    4.  **Format**:
        -   **Anchor (Situation/Context)**: A short, natural phrase describing the *specific situation* or *intent* where this expression is used (e.g., 'Disagreeing with a boss', 'Refusing an invitation').
            -   **DO NOT** put the expression itself here. This is the cue for the user to guess the expression.
            -   Use **English** for simple situations.
            -   Use **Vietnamese** if the situation is nuanced, abstract, or hard to describe simply in English.
        -   **Sentence**: Write a full example sentence containing the expression. Use curly braces \`{}\` to highlight the target expression.
        -   **Note**: Brief usage tip.
    5.  **Standard (Context) Field**: 
        -   Keep it **EXTREMELY CONCISE (MAX 8 WORDS)**.
        -   Make it descriptive and visual. Avoid long, explanatory sentences. 
        -   Example: Use "Sick and symptoms" instead of "Different ways to describe being sick or having a headache".
        -   If the core concept is simple, use **English**. If abstract/complex, use **Vietnamese**.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (Concise Context/Title - Max 8 words)",
      "answers": [
        {
          "tone": "casual" | "semi-academic" | "academic",
          "anchor": "string (The situation cue - EN or VI)",
          "sentence": "string (e.g., 'Honestly, I'm {not buying it}.')",
          "note": "string"
        }
      ]
    }
    `}function xs(m){return`You are an expert IELTS coach and scenario designer.
    
    TASK: Generate a natural, realistic English conversation based on the topic: "${m}".
    
    CONSTRAINTS:
    1.  The conversation must involve 2 to 3 distinct speakers.
    2.  Assign each speaker a name and a sex (male or female).
    3.  The conversation should have 10 to 15 sentences in total.
    4.  The language should be appropriate for an IELTS candidate (ranging from casual to semi-formal depending on the topic).
    5.  Use high-value vocabulary and natural lexical chunks.
    6.  Assign an "icon" (emoji string) to EVERY single sentence representing the speaker's specific emotion or tone at that moment. Use emojis exclusively from the "Smiley and Emotion" fluent group.
    
    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object. Do not include any text outside the JSON block.
    
    {
      "title": "string (A catchy title for the conversation)",
      "description": "string (Short context for the conversation)",
      "speakers": [
        { "name": "string (e.g., 'Alice')", "sex": "male" | "female" }
      ],
      "sentences": [
        { "speakerName": "string", "text": "string (verbatim what they say)", "icon": "string (emotional emoji)" }
      ],
      "tags": ["string (3-5 relevant IELTS tags)"]
    }
    `}function ps(m,_){return`You are an expert IELTS Speaking coach.
    
    TASK: Refine and upgrade the following speech draft to achieve a higher Band Score (8.0+).

    CURRENT DRAFT:
    "${m}"

    USER REQUEST: "${_||"Improve vocabulary, grammar, and flow."}"

    INSTRUCTIONS:
    1.  **Upgrade Vocabulary**: Replace simple words with more precise, less common lexical resources (idioms, collocations).
    2.  **Fix Grammar**: Ensure complex structures are used correctly.
    3.  **Improve Flow**: Use natural discourse markers and linking words.
    4.  **Maintain Voice**: Keep it sounding like a natural spoken response, not a written essay.

    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object.
    {
      "content": "string (The fully rewritten, improved paragraph)"
    }
    `}const ms=({isOpen:m,onClose:_,onSave:i,initialData:n})=>{const[R,T]=t.useState(""),[l,p]=t.useState(""),[g,b]=t.useState(""),[C,c]=t.useState([]),[d,I]=t.useState(!1),{showToast:M}=De();t.useEffect(()=>{var y;m&&(T((n==null?void 0:n.standard)||""),b((n==null?void 0:n.note)||""),p(((y=n==null?void 0:n.tags)==null?void 0:y.join(", "))||""),c((n==null?void 0:n.answers)||[]))},[m,n]);const B=y=>{y.preventDefault(),R.trim()&&i({standard:R.trim(),tags:l.split(",").map(P=>P.trim()).filter(Boolean),note:g.trim(),answers:C})},ne=y=>{const P=y.result||y;P.answers&&Array.isArray(P.answers)?(c(F=>[...F,...P.answers]),P.standard&&!R&&T(P.standard),M(`Added ${P.answers.length} new expressions!`,"success"),I(!1)):M("AI response format invalid.","error")};return m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("form",{onSubmit:B,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:n?"Edit Expression":"New Expression"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Define context and generate expressions."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>I(!0),className:"p-2 bg-amber-50 text-amber-600 rounded-xl hover:bg-amber-100 transition-colors",title:"Refine/Expand with AI",children:e.jsx(Ke,{size:18})}),e.jsx("button",{type:"button",onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Me,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Context / Meaning"}),e.jsx("textarea",{value:R,onChange:y=>T(y.target.value),placeholder:"e.g., Disagreeing politely",rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium focus:ring-2 focus:ring-neutral-900 outline-none resize-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(ct,{size:12})," Tags"]}),e.jsx("input",{value:l,onChange:y=>p(y.target.value),placeholder:"linking, academic...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Answers"}),e.jsx("button",{type:"button",onClick:()=>c([...C,{tone:"semi-academic",anchor:"",sentence:""}]),className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 transition-colors",children:e.jsx(qe,{size:14})})]}),C.map((y,P)=>e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-xl border border-neutral-200 space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:()=>c(C.filter((F,u)=>u!==P)),className:"absolute top-2 right-2 text-neutral-300 hover:text-red-500 opacity-0 group-hover:opacity-100",children:e.jsx(Ie,{size:12})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:y.tone,onChange:F=>{const u=[...C];u[P].tone=F.target.value,c(u)},className:"px-2 py-1 bg-white border border-neutral-200 rounded-lg text-[10px] font-bold outline-none",children:[e.jsx("option",{value:"casual",children:"Casual"}),e.jsx("option",{value:"semi-academic",children:"Semi-Academic"}),e.jsx("option",{value:"academic",children:"Academic"})]}),e.jsx("input",{value:y.anchor,onChange:F=>{const u=[...C];u[P].anchor=F.target.value,c(u)},placeholder:"Situation / Context (e.g. Refusing politey)",className:"flex-1 px-2 py-1 bg-white border border-neutral-200 rounded-lg text-xs font-bold outline-none"})]}),e.jsx("textarea",{value:y.sentence,onChange:F=>{const u=[...C];u[P].sentence=F.target.value,c(u)},placeholder:"Example sentence with {curly braces}",className:"w-full p-2 bg-white border border-neutral-200 rounded-lg text-xs font-medium resize-none outline-none",rows:2}),e.jsx("input",{value:y.note||"",onChange:F=>{const u=[...C];u[P].note=F.target.value,c(u)},placeholder:"Note (optional)",className:"w-full px-2 py-1 bg-white border border-neutral-200 rounded-lg text-[10px] font-medium text-neutral-500 outline-none"})]},P))]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(ot,{size:14})," Save"]})})]})}),d&&e.jsx(it,{isOpen:d,onClose:()=>I(!1),type:"REFINE_UNIT",title:"Expand Expressions",description:"Generate additional variations (duplicates are excluded).",initialData:{},onGeneratePrompt:y=>us(R,y.request,C),onJsonReceived:ne,actionLabel:"Generate"})]}):null},hs=({isOpen:m,onClose:_,onSave:i,initialData:n,onOpenAiGen:R})=>{const[T,l]=t.useState(""),[p,g]=t.useState(""),[b,C]=t.useState([]),[c,d]=t.useState([]),[I,M]=t.useState(""),[B,ne]=t.useState(null);t.useEffect(()=>{var u;if(m){l((n==null?void 0:n.title)||""),g((n==null?void 0:n.description)||""),C((n==null?void 0:n.speakers)||[]),d((n==null?void 0:n.sentences)||[]),M(((u=n==null?void 0:n.tags)==null?void 0:u.join(", "))||"");const N=Le(Ve());Tt(N).then(ne).catch(()=>ne(null))}},[m,n]);const y=u=>{u.preventDefault(),T.trim()&&i({title:T.trim(),description:p,speakers:b,sentences:c,tags:I.split(",").map(N=>N.trim()).filter(Boolean)})},P=(u,N)=>{C(k=>k.map((f,H)=>H===u?{...f,...N}:f))},F=t.useMemo(()=>B?B.voices.filter(u=>u.language.startsWith("en")&&(u.name.toLowerCase().includes("enhanced")||u.name.toLowerCase().includes("premium"))):[],[B]);return m?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:y,className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:n?"Edit Conversation":"New Conversation"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Create interactive multi-speaker dialogues."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:R,className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 transition-colors",title:"Generate with AI",children:e.jsx(Ke,{size:18})}),e.jsx("button",{type:"button",onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Me,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400",children:"Title"}),e.jsx("input",{value:T,onChange:u=>l(u.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold focus:ring-2 focus:ring-neutral-900 outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400",children:"Tags"}),e.jsx("input",{value:I,onChange:u=>M(u.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase flex items-center gap-2",children:[e.jsx(At,{size:14})," Speakers (",b.length,"/3)"]}),e.jsx("button",{type:"button",onClick:()=>C([...b,{name:"",sex:"female"}]),disabled:b.length>=3,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 transition-colors disabled:opacity-50",children:e.jsx(qe,{size:14})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:b.map((u,N)=>e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-2xl border border-neutral-200 relative group animate-in zoom-in-95 grid grid-cols-1 sm:grid-cols-[1fr,auto,2fr] gap-4 items-center",children:[e.jsx("button",{type:"button",onClick:()=>C(b.filter((k,f)=>f!==N)),className:"absolute -top-1.5 -right-1.5 p-1 bg-white text-neutral-300 hover:text-red-500 border border-neutral-200 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(Me,{size:10})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"Speaker Name"}),e.jsx("input",{value:u.name,onChange:k=>P(N,{name:k.target.value}),placeholder:"Name",className:"w-full bg-white border border-neutral-200 rounded-lg px-3 py-1.5 font-bold text-xs outline-none focus:border-neutral-900"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"Sex"}),e.jsxs("div",{className:"flex bg-white rounded-lg p-0.5 border border-neutral-200 h-[32px]",children:[e.jsx("button",{type:"button",onClick:()=>P(N,{sex:"male"}),className:`flex-1 px-3 py-1 text-[8px] font-black uppercase rounded ${u.sex==="male"?"bg-blue-50 text-white shadow-sm":"text-neutral-400"}`,children:"Male"}),e.jsx("button",{type:"button",onClick:()=>P(N,{sex:"female"}),className:`flex-1 px-3 py-1 text-[8px] font-black uppercase rounded ${u.sex==="female"?"bg-pink-50 text-white shadow-sm":"text-neutral-400"}`,children:"Female"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[8px] font-black uppercase text-neutral-400",children:"High Quality Voice"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u.voiceName||"",onChange:k=>{const f=F.find(H=>H.name===k.target.value);P(N,{voiceName:k.target.value,accentCode:f==null?void 0:f.accent}),k.target.value&&ze(`Hello, this is ${k.target.value}`,!1,"en",k.target.value,f==null?void 0:f.accent)},className:"w-full bg-white border border-neutral-200 rounded-xl px-4 py-3 pr-10 text-[10px] font-bold outline-none focus:border-neutral-900 appearance-none",children:[e.jsx("option",{value:"",children:"Auto Select"}),F.map(k=>e.jsxs("option",{value:k.name,children:[k.name," (",k.accent,")"]},k.name))]}),e.jsx(Rt,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]})]})]},N))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase flex items-center gap-2",children:[e.jsx(et,{size:14})," Script (",c.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var u;return d([...c,{speakerName:((u=b[0])==null?void 0:u.name)||"",text:""}])},disabled:b.length===0,className:"px-3 py-1.5 bg-neutral-900 text-white rounded-lg font-bold text-xs flex items-center gap-1.5 hover:bg-neutral-800 disabled:opacity-50 transition-colors",children:[e.jsx(qe,{size:14})," Add Line"]})]}),e.jsx("div",{className:"space-y-2",children:c.map((u,N)=>e.jsxs("div",{className:"flex gap-2 items-start animate-in slide-in-from-top-2",children:[e.jsx("select",{value:u.speakerName,onChange:k=>{const f=[...c];f[N].speakerName=k.target.value,d(f)},className:"w-24 shrink-0 px-2 py-2 bg-neutral-50 border border-neutral-200 rounded-lg text-[10px] font-black uppercase tracking-wider outline-none focus:ring-1 focus:ring-neutral-900",children:b.map(k=>e.jsx("option",{value:k.name,children:k.name||"?"},k.name))}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsx("textarea",{value:u.text,onChange:k=>{const f=[...c];f[N].text=k.target.value,d(f)},rows:2,placeholder:"Speech...",className:"w-full px-3 py-2 bg-neutral-50 border border-neutral-200 rounded-xl text-xs font-medium focus:ring-1 focus:ring-neutral-900 outline-none resize-none"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"text-[8px] font-black text-neutral-400 uppercase",children:"Emoji"}),e.jsx("input",{value:u.icon||"",onChange:k=>{const f=[...c];f[N].icon=k.target.value,d(f)},className:"bg-neutral-50 border border-neutral-100 rounded px-2 py-1 text-xs w-12",placeholder:"ðŸ˜Š"})]})]}),e.jsx("button",{type:"button",onClick:d.bind(null,c.filter((k,f)=>f!==N)),className:"p-2 text-neutral-300 hover:text-red-500",children:e.jsx(Ie,{size:14})})]},N))})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(ot,{size:14})," Save Conversation"]})})]})}):null},gs=({isOpen:m,onClose:_,onSave:i,initialData:n})=>{const[R,T]=t.useState(""),[l,p]=t.useState([]),[g,b]=t.useState(""),[C,c]=t.useState([]),[d,I]=t.useState(!1),[M,B]=t.useState(!1),[ne,y]=t.useState(null),[P,F]=t.useState(!1),{showToast:u}=De();t.useEffect(()=>{var v;m&&(T((n==null?void 0:n.title)||""),b(((v=n==null?void 0:n.tags)==null?void 0:v.join(", "))||""),c((n==null?void 0:n.audioLinks)||[]),n!=null&&n.scriptItems&&n.scriptItems.length>0?p(n.scriptItems):n!=null&&n.content?p([{id:Date.now().toString(),type:"script",content:n.content}]):p([{id:Date.now().toString(),type:"script",content:""}]))},[m,n]);const N=v=>{if(v.preventDefault(),!R.trim()){u("Title is required","error");return}const S=l.filter(V=>V.content.trim());if(S.length===0){u("At least one script item is required","error");return}const D=S.filter(V=>V.type==="script").map(V=>V.content).join(`

`);i({title:R.trim(),content:D,scriptItems:S,tags:g.split(",").map(V=>V.trim()).filter(Boolean),audioLinks:C})},k=v=>{p(S=>[...S,{id:Date.now().toString()+Math.random(),type:v,content:""}])},f=v=>{p(S=>S.filter((D,V)=>V!==v))},H=(v,S)=>{p(D=>D.map((V,de)=>de===v?{...V,...S}:V))},je=v=>{const S=v.result||v,D=S.content||S.rewritten||S.text;D&&typeof D=="string"?(p([{id:Date.now().toString(),type:"script",content:D}]),I(!1),u("Content refined!","success")):u("Could not parse AI response.","error")},ae=v=>{const{url:S,transcript:D}=v;c(V=>[...V,S]),D&&(y(D),F(!0))},fe=()=>{ne&&p([{id:Date.now().toString(),type:"script",content:ne}]),y(null),F(!1)},Q=v=>{c(S=>S.filter((D,V)=>V!==v))};return m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("form",{onSubmit:N,className:"bg-white w-full max-w-4xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:n?"Edit Free Talk":"New Free Talk"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Practice speaking natural paragraphs."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>I(!0),className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 transition-colors",title:"Refine with AI",children:e.jsx(Ke,{size:18})}),e.jsx("button",{type:"button",onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Me,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar flex-1 bg-neutral-50/30",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title / Topic"}),e.jsx("input",{value:R,onChange:v=>T(v.target.value),placeholder:"e.g., My Hometown",className:"w-full px-4 py-3 bg-white border border-neutral-200 rounded-xl font-medium focus:ring-2 focus:ring-neutral-900 outline-none shadow-sm",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Reference Audio"}),e.jsxs("button",{type:"button",onClick:()=>B(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(qe,{size:12})," From Server"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[C.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2 col-span-full",children:"No reference audio attached."}),C.map((v,S)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(bt,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(v.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>Q(S),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(Me,{size:14})})]},S))]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(xt,{size:12})," Content Blocks"]}),e.jsx("div",{className:"space-y-3",children:l.map((v,S)=>e.jsxs("div",{className:`group relative p-4 rounded-2xl border transition-all ${v.type==="note"?"bg-yellow-50/50 border-yellow-200":"bg-white border-neutral-200 shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"p-1.5 bg-neutral-100 rounded-md cursor-move text-neutral-400",children:e.jsx(Zt,{size:12})}),e.jsxs("div",{className:"flex bg-neutral-100 p-0.5 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>H(S,{type:"script"}),className:`px-2 py-1 rounded-md text-[10px] font-bold uppercase transition-all ${v.type==="script"?"bg-white shadow-sm text-neutral-900":"text-neutral-400 hover:text-neutral-600"}`,children:"Script"}),e.jsx("button",{type:"button",onClick:()=>H(S,{type:"note"}),className:`px-2 py-1 rounded-md text-[10px] font-bold uppercase transition-all ${v.type==="note"?"bg-white shadow-sm text-yellow-600":"text-neutral-400 hover:text-neutral-600"}`,children:"Note"})]})]}),e.jsx("button",{type:"button",onClick:()=>f(S),className:"p-1.5 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Ie,{size:14})})]}),e.jsx("textarea",{value:v.content,onChange:D=>H(S,{content:D.target.value}),placeholder:v.type==="script"?"Enter speech text...":"Enter notes, cues, or reminders...",className:`w-full p-3 rounded-xl outline-none resize-none text-sm leading-relaxed min-h-[100px] ${v.type==="note"?"bg-yellow-50/50 placeholder:text-yellow-300/50 text-yellow-900 italic":"bg-neutral-50 focus:bg-white focus:ring-2 focus:ring-neutral-900 placeholder:text-neutral-300"}`})]},v.id))}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:()=>k("script"),className:"flex-1 py-3 border-2 border-dashed border-neutral-200 rounded-xl text-neutral-400 font-bold text-xs hover:border-neutral-400 hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(It,{size:14})," Add Script"]}),e.jsxs("button",{type:"button",onClick:()=>k("note"),className:"flex-1 py-3 border-2 border-dashed border-yellow-200 rounded-xl text-yellow-600/50 font-bold text-xs hover:border-yellow-400 hover:text-yellow-700 transition-all flex items-center justify-center gap-2 bg-yellow-50/30",children:[e.jsx(Et,{size:14})," Add Note"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(ct,{size:12})," Tags"]}),e.jsx("input",{value:g,onChange:v=>b(v.target.value),placeholder:"part1, personal...",className:"w-full px-4 py-3 bg-white border border-neutral-200 rounded-xl font-medium text-sm shadow-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-lg",children:[e.jsx(ot,{size:14})," Save"]})})]})}),d&&e.jsx(it,{isOpen:d,onClose:()=>I(!1),type:"REFINE_UNIT",title:"Refine Free Talk",description:"Improve vocabulary and grammar for a higher band score.",initialData:{request:""},onGeneratePrompt:v=>ps(l.map(S=>S.content).join(`
`),v.request),onJsonReceived:je,actionLabel:"Refine",closeOnSuccess:!0}),e.jsx(Qt,{isOpen:M,onClose:()=>B(!1),onSelect:ae,type:"audio",title:"Select Audio"}),e.jsx(Xe,{isOpen:P,title:"Replace Content?",message:"This audio file comes with a linked transcript. Do you want to replace your current content with it?",confirmText:"Replace",isProcessing:!1,onConfirm:fe,onClose:()=>F(!1),icon:e.jsx(xt,{size:40,className:"text-indigo-500"}),confirmButtonClass:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200"})]}):null},fs=({text:m})=>{const _=m.split(/({.*?}|\[.*?\]|<.*?>)/g);return e.jsx(e.Fragment,{children:_.map((i,n)=>i.startsWith("{")&&i.endsWith("}")?e.jsx("span",{className:"mx-0.5 px-1 py-0.5 rounded bg-amber-100 text-amber-800 font-bold font-mono text-[0.9em] border border-amber-200 inline-block shadow-sm",children:i.slice(1,-1)},n):i.startsWith("[")&&i.endsWith("]")?e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-sky-700 bg-sky-100 border border-sky-200 px-2 py-1 rounded-full font-medium",children:[e.jsx(jt,{size:12}),i.slice(1,-1)]},n):e.jsx("span",{children:i},n))})},bs=({isOpen:m,onClose:_,item:i})=>{const[n,R]=t.useState(new Set),[T,l]=t.useState(null),p=t.useRef([]);if(!m||!i)return null;const g=d=>{R(I=>{const M=new Set(I);return M.has(d)?M.delete(d):M.add(d),M})},b=d=>{const I=d.replace(/{|}/g,"");l(I)},C=d=>{p.current.push(d)},c=async()=>{if(p.current.length>0){const d=Math.round(p.current.reduce((I,M)=>I+M,0)/p.current.length);await _e({...i,bestScore:d,updatedAt:Date.now()})}_(),p.current=[]};return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[85vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:i.standard}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1",children:"Native Expressions Practice"})]}),e.jsx("button",{type:"button",onClick:c,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Me,{size:24})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-8 space-y-4 custom-scrollbar bg-neutral-50/30",children:i.answers.map((d,I)=>{const M=n.has(I);return e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-3 relative overflow-hidden group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.lastResult==="correct"&&e.jsx("div",{className:"bg-green-100 text-green-600 p-1 rounded-full",title:"Mastered in Game",children:e.jsx(zt,{size:12})}),d.lastResult==="incorrect"&&e.jsx("div",{className:"bg-red-100 text-red-600 p-1 rounded-full",title:"Needs Practice",children:e.jsx(Mt,{size:12})}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[8px] font-black uppercase border ${d.tone==="academic"?"bg-purple-50 text-purple-700 border-purple-100":d.tone==="semi-academic"?"bg-blue-50 text-blue-700 border-blue-100":"bg-neutral-50 text-neutral-600 border-neutral-100"}`,children:d.tone})]}),e.jsx("span",{className:"text-sm font-bold text-neutral-700 leading-snug",children:d.anchor})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g(I),className:`p-2 rounded-lg transition-all ${M?"text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100":"bg-indigo-50 text-indigo-600 hover:bg-indigo-100"}`,children:M?e.jsx(Pt,{size:16}):e.jsx(Ft,{size:16})}),M&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(d.sentence.replace(/{|}/g,"")),className:"p-2 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all",title:"Listen",children:e.jsx(tt,{size:16})}),e.jsx("button",{onClick:()=>b(d.sentence),className:"p-2 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-all",title:"Practice Speaking",children:e.jsx(Ge,{size:16})})]})]})]}),e.jsx("div",{className:"min-h-[1.5rem] flex items-center pt-2 border-t border-neutral-50",children:M?e.jsx("div",{className:"text-base font-medium text-neutral-800 animate-in fade-in slide-in-from-top-1",children:e.jsx(fs,{text:d.sentence})}):e.jsxs("div",{className:"flex gap-1 items-center opacity-30 w-full",children:[e.jsx("div",{className:"h-2 w-12 bg-neutral-200 rounded-full"}),e.jsx("div",{className:"h-2 w-24 bg-neutral-200 rounded-full"}),e.jsx("div",{className:"h-2 w-8 bg-neutral-200 rounded-full"})]})}),d.note&&M&&e.jsxs("div",{className:"text-[10px] text-neutral-400 font-medium italic",children:['"',d.note,'"']})]},I)})}),e.jsx("footer",{className:"px-8 py-4 border-t border-neutral-100 bg-white rounded-b-[2.5rem] flex justify-end",children:e.jsx("button",{onClick:c,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-md",children:"Done"})})]}),T&&e.jsx(vt,{target:T,onClose:()=>l(null),onSaveScore:C})]})};function vs(m){const _=m.numberOfChannels,i=m.length*_*2+44,n=new ArrayBuffer(i),R=new DataView(n),T=[];let l,p,g=0,b=0;for(c(1179011410),c(i-8),c(1163280727),c(544501094),c(16),C(1),C(_),c(m.sampleRate),c(m.sampleRate*2*_),C(_*2),C(16),c(1635017060),c(i-b-4),l=0;l<m.numberOfChannels;l++)T.push(m.getChannelData(l));for(;b<i;){for(l=0;l<_;l++)p=Math.max(-1,Math.min(1,T[l][g])),p=(p<0?p*32768:p*32767)|0,R.setInt16(b,p,!0),b+=2;g++}return new Blob([n],{type:"audio/wav"});function C(d){R.setUint16(b,d,!0),b+=2}function c(d){R.setUint32(b,d,!0),b+=4}}const js=({isOpen:m,onClose:_,item:i})=>{const[n,R]=t.useState(0),[T,l]=t.useState(!1),[p,g]=t.useState(!1),[b,C]=t.useState(null),[c,d]=t.useState(!1),[I,M]=t.useState(!1),[B,ne]=t.useState(!0),[y,P]=t.useState(null),[F,u]=t.useState({}),[N,k]=t.useState({}),[f,H]=t.useState(!1),[je,ae]=t.useState(""),[fe,Q]=t.useState(null),[v,S]=t.useState("audio/webm"),[D,V]=t.useState(!1),[de,Se]=t.useState(null),re=t.useRef([]),[le,Z]=t.useState(!1),[ie]=t.useState(()=>Ve()),we=t.useRef(null),ye=t.useRef({}),pe=t.useRef(new wt),ee=t.useRef(null),{showToast:X}=De(),J=()=>{ee.current&&(ee.current.pause(),ee.current.src="",ee.current=null),at()},Te=async()=>{if(J(),pe.current.stop(),i&&re.current.length>0){const a=Math.round(re.current.reduce((j,w)=>j+w,0)/re.current.length);await Be({...i,bestScore:a,updatedAt:Date.now()})}k({}),u({}),Q(null),re.current=[],_()};t.useEffect(()=>{if(!(T||p)||!i)return;let a=!1;return(async()=>{if(n>=i.sentences.length||a)return;const w=i.sentences[n];if(!p&&b&&w.speakerName===b){l(!1),d(!0);return}const A=F[n];if(A&&p)J(),await new Promise(G=>{const E=new Audio(`data:${A.mime};base64,${A.base64}`);ee.current=E,E.onended=()=>G(!0),E.onerror=()=>G(!1),E.play().catch(()=>G(!1)),a&&(E.pause(),G(!1))});else{const G=N[n];if(G)J(),await new Promise(E=>{const L=new Audio(`data:${G.mime};base64,${G.base64}`);ee.current=L,L.onended=()=>E(!0),L.onerror=()=>E(!1),L.play().catch(()=>E(!1)),a&&(L.pause(),E(!1))});else{const E=i.speakers.find(q=>q.name===w.speakerName);let L=E==null?void 0:E.voiceName,Y=E==null?void 0:E.accentCode;if(!L){const q=(E==null?void 0:E.sex)==="male"?"male":"female",W=ie.audioCoach.coaches[q];L=W.enVoice,Y=W.enAccent}try{const q=Le(ie),W={text:w.text,language:"en",accent:Y,voice:L},xe=await fetch(`${q}/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(xe.ok){const Ce=await xe.blob(),se=new FileReader,be=new Promise(x=>{se.onloadend=()=>x(se.result.split(",")[1])});se.readAsDataURL(Ce);const r=await be,h=xe.headers.get("Content-Type")||"audio/aiff";if(k(x=>({...x,[n]:{base64:r,mime:h}})),!a){J();const x=new Audio(`data:${h};base64,${r}`);ee.current=x,await new Promise(z=>{x.onended=()=>z(!0),x.onerror=()=>z(!1),x.play().catch(()=>z(!1)),a&&(x.pause(),z(!1))})}}else await ze(w.text,!0,"en",L,Y)}catch(q){console.error("Playback error",q)}}}!a&&(T||p)&&(n<i.sentences.length-1?R(G=>G+1):(l(!1),g(!1)))})(),()=>{a=!0}},[T,p,n,i,b]),t.useEffect(()=>{const a=ye.current[n];a&&we.current&&a.scrollIntoView({behavior:"smooth",block:"center"})},[n,T,p,c,B]);const Pe=n>0||Object.keys(F).length>0,me=a=>{Pe?P(a):te(a)},te=a=>{J(),l(!1),g(!1),d(!1),R(0),u({}),re.current=[],C(a),P(null),X(a?`Role changed to ${a}. Practice reset.`:"Role changed to Spectator. Practice reset.","info")};if(!m||!i||!i.sentences||i.sentences.length===0)return null;const ue=i.sentences,oe=ue[n],Fe=()=>{J(),d(!1),R(0)},Ne=()=>{n>0&&(J(),d(!1),R(a=>a-1))},$e=()=>{n<ue.length-1&&(J(),d(!1),R(a=>a+1))},Ae=async()=>{if(f){pe.current.stop(),V(!1);const a=await rt();a&&(Q(a.base64),S(a.mimeType)),H(!1)}else{J(),ae(""),Q(null);try{await lt(),H(!0),V(!0),pe.current.start((a,j)=>ae(a+j),a=>ae(a))}catch(a){console.error("Failed to start recording",a),H(!1)}}},he=a=>{const j=a!==void 0?F[a]:fe?{base64:fe,mime:v}:null;if(j){J();const w=new Audio(`data:${j.mime};base64,${j.base64}`);ee.current=w,w.play()}},Ue=()=>{if(fe&&(u(a=>({...a,[n]:{base64:fe,mime:v}})),oe)){const a=kt(oe.text,je);re.current.push(a.score)}d(!1),ae(""),Q(null),n<ue.length-1?(R(a=>a+1),l(!0)):l(!1)},ge=async(a,j)=>{J();const w=N[j];if(w){const q=new Audio(`data:${w.mime};base64,${w.base64}`);ee.current=q,q.play();return}const A=i.speakers.find(q=>q.name===a.speakerName);let G=A==null?void 0:A.voiceName,E=A==null?void 0:A.accentCode;if(!G){const q=(A==null?void 0:A.sex)==="male"?"male":"female",W=ie.audioCoach.coaches[q];G=W.enVoice,E=W.enAccent}const L=Le(ie),Y={text:a.text,language:"en",accent:E,voice:G};try{const q=await fetch(`${L}/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(q.ok){const W=await q.blob(),xe=new FileReader;xe.onloadend=()=>{const se=xe.result.split(",")[1],be=q.headers.get("Content-Type")||"audio/aiff";k(r=>({...r,[j]:{base64:se,mime:be}}))},xe.readAsDataURL(W);const Ce=new Audio(URL.createObjectURL(W));ee.current=Ce,Ce.play()}else ze(a.text,!1,"en",G,E)}catch{ze(a.text,!1,"en",G,E)}},ke=()=>{p?(g(!1),J()):(J(),l(!1),d(!1),g(!0),R(0))},Re=async()=>{const a=new(window.AudioContext||window.webkitAudioContext),j=[];let w=!1;for(let L=0;L<i.sentences.length;L++){const Y=F[L],q=N[L],W=Y||q;if(!W)continue;w=!0;const xe=atob(W.base64),Ce=new Uint8Array(xe.length);for(let se=0;se<xe.length;se++)Ce[se]=xe.charCodeAt(se);try{const se=await a.decodeAudioData(Ce.buffer);j.push(se)}catch(se){console.warn(`Failed to decode segment ${L}`,se)}}if(!w||j.length===0)return null;const A=j.reduce((L,Y)=>L+Y.length,0),G=a.createBuffer(j[0].numberOfChannels,A,j[0].sampleRate);let E=0;return j.forEach(L=>{for(let Y=0;Y<L.numberOfChannels;Y++)G.getChannelData(Y).set(L.getChannelData(Y),E);E+=L.length}),G},ce=async()=>{if(!le){Z(!0),J();try{const a=await Re();if(!a){X("No audio segments available to play.","info"),Z(!1);return}const j=new(window.AudioContext||window.webkitAudioContext),w=j.createBufferSource();w.buffer=a,w.connect(j.destination),w.onended=()=>Z(!1),w.start(0)}catch(a){console.error("Preview failed",a),X("Failed to preview audio.","error"),Z(!1)}}},s=async()=>{if(!I){M(!0),X("Generating full audio file...","info");try{const a=await Re();if(!a){X("No audio segments available to save.","info"),M(!1);return}const j=vs(a),w=URL.createObjectURL(j),A=document.createElement("a");A.href=w,A.download=`Full_Dialogue_${i.title.replace(/\s+/g,"_")}.wav`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(w),X("Audio file saved!","success")}catch(a){console.error("Save All failed",a),X("Error generating audio file.","error")}finally{M(!1)}}},o=Object.keys(F).length>0||Object.keys(N).length>0,$=B?[ue[n]]:ue,K=a=>{re.current.push(a)};return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white w-full max-w-4xl rounded-[3rem] shadow-2xl border border-neutral-200 flex flex-col h-[85vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0 bg-white z-10",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900 tracking-tight leading-none",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[9px] font-black uppercase text-neutral-400",children:[e.jsx(is,{size:10})," Role Play:"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-0.5 rounded-lg",children:[e.jsx("button",{onClick:()=>me(null),className:`px-2 py-1 rounded-md text-[9px] font-black uppercase transition-all ${!b&&!p?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:"Spectator"}),i.speakers.map(a=>e.jsxs("button",{onClick:()=>me(a.name),className:`px-2 py-1 rounded-md text-[9px] font-black uppercase transition-all ${b===a.name?"bg-indigo-600 text-white shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:["Act as ",a.name]},a.name))]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:ke,className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${p?"bg-indigo-600 text-white shadow-lg":"text-neutral-500 hover:text-neutral-900"}`,title:"Play whole conversation non-stop",children:[e.jsx(mt,{size:14}),p?"Stop":"Play All"]}),!p&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{J(),l(!0),g(!1)},className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${T?"bg-neutral-900 text-white shadow-lg":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Je,{size:14,fill:"currentColor"})," Play"]}),e.jsxs("button",{onClick:()=>{l(!1),J()},className:`px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 transition-all ${T?"text-neutral-500 hover:text-neutral-900":"bg-neutral-900 text-white shadow-lg"}`,children:[e.jsx(st,{size:14,fill:"currentColor"})," Pause"]})]})]}),e.jsx("button",{type:"button",onClick:Te,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(Me,{size:24})})]})]}),e.jsx("div",{className:"bg-neutral-50/50 py-6 px-8 border-b border-neutral-100 shrink-0",children:e.jsx("div",{className:"flex justify-center items-end gap-10 md:gap-20",children:i.speakers.map((a,j)=>{const w=oe.speakerName===a.name,A=b===a.name;return e.jsxs("div",{className:"flex flex-col items-center relative group",children:[w&&e.jsxs("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-neutral-900 text-white px-3 py-1.5 rounded-xl text-lg animate-bounce shadow-xl whitespace-nowrap z-20",children:[oe.icon||"ðŸ’¬",e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-900 rotate-45"})]}),e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center text-3xl md:text-4xl transition-all duration-300 ${w?"bg-white scale-110 shadow-2xl ring-4 ring-indigo-500/20":"bg-neutral-200/50 grayscale opacity-40"} ${A?"border-2 border-indigo-500":""}`,children:a.sex==="male"?"ðŸ‘¨":"ðŸ‘©"}),e.jsx("div",{className:`mt-2 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest transition-colors ${w?"bg-neutral-900 text-white":"text-neutral-400 bg-neutral-100"} ${A?"ring-1 ring-indigo-500":""}`,children:A?"YOU":a.name})]},j)})})}),e.jsxs("div",{className:"px-6 py-2 bg-white border-b border-neutral-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-lg gap-1",children:[e.jsxs("button",{onClick:()=>ne(!0),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase flex items-center gap-1.5 transition-all ${B?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Show current turn only",children:[e.jsx(yt,{size:12})," Focus"]}),e.jsxs("button",{onClick:()=>ne(!1),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase flex items-center gap-1.5 transition-all ${B?"text-neutral-400 hover:text-neutral-600":"bg-white text-neutral-900 shadow-sm"}`,title:"Show full script",children:[e.jsx(es,{size:12})," Script"]})]}),B&&e.jsxs("div",{className:"flex items-center gap-1 bg-neutral-50 p-1 rounded-lg border border-neutral-100 animate-in fade-in slide-in-from-right-2",children:[e.jsx("button",{onClick:Fe,disabled:n===0||c,className:"p-1.5 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all rounded hover:bg-white",children:e.jsx(os,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx("button",{onClick:Ne,disabled:n===0||c,className:"p-1.5 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all rounded hover:bg-white",children:e.jsx(ht,{size:16})}),e.jsx("button",{onClick:$e,disabled:n===ue.length-1||c,className:"p-1.5 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all rounded hover:bg-white",children:e.jsx(pt,{size:16})})]})]}),e.jsx("main",{ref:we,className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-4 custom-scrollbar bg-white scroll-smooth pb-32",children:$.map((a,j)=>{const w=B?n:j,A=B?!0:j===n,G=b===a.speakerName,E=i.speakers.find(W=>W.name===a.speakerName),L=(E==null?void 0:E.sex)==="male",Y=F[w]!==void 0,q=c&&w===n;return e.jsxs("div",{ref:W=>{A&&(ye.current[w]=W)},onClick:()=>{!T&&!p&&!c&&!B&&(R(j),J())},className:`flex items-start gap-4 p-4 rounded-[2rem] transition-all border-2 ${A?"bg-indigo-50/30 border-indigo-200 shadow-sm":"border-transparent hover:bg-neutral-50"} ${T||p||c||B?"cursor-default":"cursor-pointer"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-2xl shrink-0 flex items-center justify-center text-xl shadow-sm ${L?"bg-blue-100":"bg-pink-100"} ${A?"scale-110 ring-2 ring-white":""}`,children:G?"ðŸŒŸ":a.icon||(L?"ðŸ‘¨":"ðŸ‘©")}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${A?"text-indigo-600":"text-neutral-400"}`,children:G?`YOU (as ${a.speakerName})`:a.speakerName}),e.jsxs("div",{className:"flex items-center gap-1",children:[Y&&e.jsx("button",{onClick:W=>{W.stopPropagation(),he(w)},className:"p-2 bg-rose-50 text-rose-600 rounded-xl hover:bg-rose-100 transition-all",title:"Listen back to your attempt",children:e.jsx(Ge,{size:14})}),A&&!T&&!p&&!c&&e.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in zoom-in-95",children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),ge(a,w)},className:"p-2 bg-neutral-900 text-white rounded-xl hover:scale-105 transition-transform",children:e.jsx(tt,{size:14})}),e.jsx("button",{onClick:W=>{W.stopPropagation(),Se(a.text)},className:"p-2 bg-rose-500 text-white rounded-xl hover:scale-105 transition-transform",children:e.jsx(Ge,{size:14})})]})]})]}),e.jsx("p",{className:`text-sm md:text-lg leading-relaxed font-bold transition-colors ${A?"text-neutral-900":"text-neutral-500"}`,children:a.text}),q&&e.jsxs("div",{className:"mt-4 p-6 bg-white border-2 border-indigo-500 rounded-[2rem] shadow-xl animate-in zoom-in-95 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-600",children:[e.jsx($t,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Your Turn to Speak"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ge(a,w),className:"p-2 bg-neutral-100 text-neutral-600 rounded-lg hover:text-neutral-900 transition-all",title:"Listen to Model",children:e.jsx(tt,{size:16})}),D&&e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-red-500 animate-ping"})]})]}),e.jsx("div",{className:"min-h-[60px] p-4 bg-neutral-50 rounded-2xl border border-neutral-100 flex flex-col items-center justify-center text-center",children:je?e.jsxs("p",{className:"text-sm font-medium italic text-neutral-800 leading-relaxed",children:['"',je,'"']}):e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:"Tap mic and read the sentence aloud"})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:Ae,className:`w-14 h-14 rounded-full flex items-center justify-center transition-all transform active:scale-90 ${f?"bg-red-500 text-white animate-pulse ring-8 ring-red-100":"bg-neutral-900 text-white hover:bg-neutral-800"}`,children:f?e.jsx(Nt,{size:24,fill:"white"}):e.jsx(Ge,{size:24})}),fe&&e.jsx("button",{onClick:()=>he(),className:"p-4 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:text-indigo-600 hover:border-indigo-300 transition-all",children:e.jsx(Je,{size:20,fill:"currentColor"})}),e.jsx("button",{onClick:Ue,disabled:f,className:"px-6 py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-50",children:"Confirm & Continue"})]})]})]})]},`${w}-${j}`)})}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 bg-white/80 backdrop-blur-md flex justify-between items-center shrink-0 absolute bottom-0 left-0 right-0 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:Ne,disabled:n===0||c,className:"p-3 rounded-xl border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all",children:e.jsx(ht,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-[0.2em] mb-1",children:"Sentence"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[n+1," / ",ue.length]})]}),e.jsx("button",{onClick:$e,disabled:n===ue.length-1||c,className:"p-3 rounded-xl border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-all",children:e.jsx(pt,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[p?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-2xl shadow-lg animate-in fade-in",children:[e.jsx(mt,{size:14}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Full Playback Mode"})]}):c?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-50 rounded-2xl border border-indigo-100 animate-in slide-in-from-right-2",children:[e.jsx(Ke,{size:14,className:"text-indigo-600"}),e.jsx("span",{className:"text-[10px] font-black text-indigo-700 uppercase tracking-widest",children:"Waiting for User"})]}):!T&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-neutral-50 rounded-2xl border border-indigo-100 animate-in fade-in",children:[e.jsx(jt,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-500 uppercase tracking-widest",children:"Manual Mode Active"})]}),e.jsxs("button",{onClick:ce,disabled:le||!o,className:`px-5 py-3 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all shadow-md active:scale-95 flex items-center gap-2 disabled:opacity-50 ${le?"bg-amber-100 text-amber-700":"bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-50"}`,title:"Listen to full audio without downloading",children:[le?e.jsx(nt,{size:14,className:"animate-spin"}):e.jsx(ts,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:le?"Playing...":"Listen Full"})]}),e.jsxs("button",{onClick:s,disabled:I||!o,className:"px-5 py-3 bg-emerald-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-lg active:scale-95 flex items-center gap-2 disabled:opacity-50",title:"Save all audio (User & AI) to one file",children:[I?e.jsx(nt,{size:14,className:"animate-spin"}):e.jsx(ss,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Save All"})]}),e.jsx("button",{onClick:Te,className:"px-8 py-3 bg-neutral-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-lg active:scale-95",children:"Finish Session"})]})]})]}),de&&e.jsx(vt,{target:de,onClose:()=>Se(null),onSaveScore:K}),e.jsx(Xe,{isOpen:!!y,title:"Switch Role?",message:"Changing roles will reset your current practice progress. Recordings will be lost.",confirmText:"Switch & Reset",isProcessing:!1,onConfirm:()=>te(y),onClose:()=>P(null)})]})},ws=({isOpen:m,onClose:_,item:i})=>{const{showToast:n}=De(),[R,T]=t.useState("RECORDING"),[l,p]=t.useState(null);t.useEffect(()=>{m&&i?p(i):m||p(null)},[m,i==null?void 0:i.id]);const[g,b]=t.useState([]),[C,c]=t.useState(0),[d,I]=t.useState(0),[M,B]=t.useState(10),[ne,y]=t.useState(!1),[P,F]=t.useState(!1),[u,N]=t.useState(""),[k,f]=t.useState(null),[H,je]=t.useState(null),[ae,fe]=t.useState(!1),[Q,v]=t.useState(()=>Ct("vocab_pro_mimic_autoreveal",!0)),[S,D]=t.useState(null),[V,de]=t.useState(!1),[Se,re]=t.useState(!1),[le,Z]=t.useState(!1),[ie,we]=t.useState(0),[ye,pe]=t.useState(null),[ee,X]=t.useState(null),[J,Te]=t.useState(!1),[Pe,me]=t.useState(null),[te,ue]=t.useState(null),[oe,Fe]=t.useState(0),[Ne,$e]=t.useState(0),Ae=t.useRef(null),[he,Ue]=t.useState([]),[ge,ke]=t.useState(null),Re=t.useRef(new wt),ce=t.useRef(null),s=t.useRef(null);t.useEffect(()=>{St("vocab_pro_mimic_autoreveal",Q)},[Q]),t.useEffect(()=>{if(m&&l){let r=l.content;l.scriptItems&&l.scriptItems.length>0&&(r=l.scriptItems.filter(U=>U.type==="script").map(U=>U.content).join(`

`));const z=r.replace(/\[([\s\S]*?)\]\([\s\S]*?\)/g,"$1").replace(/\{([\s\S]*?)\}/g,"$1").replace(/\[([\s\S]*?)\]/g,"$1").split(/[.!?\n]+/g).filter(Boolean).map(U=>U.trim()).filter(Boolean).map((U,O)=>{var ve;return{id:`ft-${l.id}-${O}`,text:U,sourceWord:l.title,type:"Free Talk",lastScore:(ve=l.sentenceScores)==null?void 0:ve[O]}});b(z),c(0),I(0),Ue(l.userRecordings||[]),$()}else at(),K(),Re.current.stop(),s.current&&clearInterval(s.current),pe(null),X(null)},[m,l==null?void 0:l.id]);const o=g[C]||null;t.useEffect(()=>{if(R==="MIMIC"&&($(),ae&&o)){const r=setTimeout(()=>ze(o.text),500);return()=>clearTimeout(r)}},[o==null?void 0:o.id,R]),t.useEffect(()=>()=>{ce.current&&(ce.current.pause(),ce.current.src="",ce.current=null)},[]);const $=()=>{y(!1),F(Q),N(""),f(null),je(null),D(null),de(!1)},K=()=>{ce.current&&(ce.current.pause(),ce.current=null),me(null),ue(null),Fe(0),$e(0),Ae.current=null,at()},a=async r=>{if(!l)return;const h={};let x=0;r.forEach((O,ve)=>{const Oe=O.lastScore||0;O.lastScore!==void 0&&(h[ve]=O.lastScore),x+=Oe});const z=r.length>0?Math.round(x/r.length):0,U={...l,bestScore:z,sentenceScores:h,updatedAt:Date.now()};p(U),await Ee(U)},j=async()=>{if(o)if(ne){y(!1),Re.current.stop();try{const r=await rt();r&&f(r.base64);const h=kt(o.text,u);je(h);const x=g.map((z,U)=>U===C?{...z,lastScore:h.score}:z);b(x),await a(x)}catch(r){console.error(r)}}else{$();try{await lt(),y(!0),Re.current.start((r,h)=>N(r+h),r=>N(r))}catch(r){console.error("Mic error",r),y(!1)}}},w=async()=>{if(o){if(S){de(!V);return}re(!0);try{const r=Ve(),h=Le(r),x=await fetch(`${h}/api/convert/ipa?text=${encodeURIComponent(o.text)}`);if(x.ok){const z=await x.json();D(z.ipa),de(!0)}else n("IPA server unavailable","error")}catch{n("Failed to fetch IPA","error")}finally{re(!1)}}},A=(r,h,x,z,U)=>{if((h&&Pe===h||x&&te===x)&&(K(),!z&&!U))return;K();const O=new Audio(r);ce.current=O,O.addEventListener("loadedmetadata",()=>{$e(O.duration),z&&(O.currentTime=z)}),O.addEventListener("timeupdate",()=>{Fe(O.currentTime),Ae.current!==null&&O.currentTime>=Ae.current&&(O.pause(),K())}),O.addEventListener("ended",()=>{K()}),O.addEventListener("error",()=>{n("Failed to play audio.","error"),K()}),h&&me(h),x&&ue(x),z&&U&&(Ae.current=z+U),O.play().catch(ve=>{console.error("Play error",ve),K()})},G=r=>{const h=Number(r.target.value);Fe(h),ce.current&&(ce.current.currentTime=h)},E=async()=>{if(le){s.current&&clearInterval(s.current),Z(!1);try{const r=await rt();if(r){const h=atob(r.base64),x=new Array(h.length);for(let O=0;O<h.length;O++)x[O]=h.charCodeAt(O);const z=new Uint8Array(x),U=new Blob([z],{type:r.mimeType});pe(U),X(U)}}catch(r){console.error("Recording error",r),n("Failed to process recording.","error")}}else{K(),pe(null),X(null);try{await lt(),Z(!0),we(0),s.current=setInterval(()=>{we(r=>r+1)},1e3)}catch{n("Could not access microphone.","error")}}},L=()=>{pe(null),X(null),we(0)},Y=async()=>{if(!(!ee||!l)){Te(!0);try{const r=Ve(),h=Le(r);let x="Recordings";try{const ve=await fetch(`${h}/api/audio/mappings`);if(ve.ok){const Oe=await ve.json(),Ye=Object.keys(Oe);Ye.length>0&&(x=Ye[0])}}catch{}const z=`rec_${Date.now()}.webm`,U=new FormData;U.append("mapName",x),U.append("filename",z),U.append("audio",ee,z);const O=await fetch(`${h}/api/audio/upload`,{method:"POST",body:U});if(O.ok){const ve=await O.json(),Oe=ie,dt=[{id:`rec-${Date.now()}`,url:`${h}/api/audio/stream/${x}/${z}`,mapName:x,filename:z,timestamp:Date.now(),duration:Oe},...he];Ue(dt);const ut={...l,userRecordings:dt,updatedAt:Date.now()};p(ut),await Ee(ut),n("Recording saved!","success"),pe(null),X(null),we(0)}else n("Upload failed.","error")}catch(r){console.error("Save error",r),n("Failed to save recording.","error")}finally{Te(!1)}}},q=async()=>{if(!ge||!l)return;const r=Ve(),h=Le(r);try{await fetch(`${h}/api/audio/file?mapName=${encodeURIComponent(ge.mapName)}&filename=${encodeURIComponent(ge.filename)}`,{method:"DELETE"})}catch{console.warn("Server delete failed, removing local reference anyway.")}const x=he.filter(U=>U.id!==ge.id);Ue(x);const z={...l,userRecordings:x,updatedAt:Date.now()};p(z),await Ee(z),n("Recording deleted.","success"),ke(null)},W=async(r,h)=>{if(!l)return;const x=l.scriptItems?[...l.scriptItems]:[];if(x[r]){x[r]={...x[r],content:h};const z={...l,scriptItems:x,updatedAt:Date.now()};p(z),await Ee(z)}},xe=(r,h,x,z)=>{if(r&&(l!=null&&l.audioLinks)){const U=l.audioLinks.find(O=>O.endsWith(r))||r;A(U,U,null,h,x)}else ze(z)};if(!m||!l)return null;const Ce=Math.ceil(g.length/M),se=g.slice(d*M,(d+1)*M),be=r=>{const h=Math.floor(r/60),x=Math.floor(r%60);return`${h}:${x.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{className:"bg-white w-full max-w-5xl rounded-[3rem] shadow-2xl border border-neutral-200 flex flex-col h-[85vh] overflow-hidden relative",children:[e.jsxs("div",{className:"px-8 py-4 border-b border-neutral-100 flex items-center justify-between bg-white z-10",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>{T("MIMIC"),K()},className:`px-4 py-2 rounded-lg text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 ${R==="MIMIC"?"bg-white shadow-sm text-indigo-600":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(rs,{size:14})," Mimic"]}),e.jsxs("button",{onClick:()=>{T("RECORDING"),K()},className:`px-4 py-2 rounded-lg text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 ${R==="RECORDING"?"bg-white shadow-sm text-rose-600":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(cs,{size:14})," Recording"]})]}),e.jsx("h3",{className:"text-sm font-black text-neutral-900 truncate max-w-md hidden md:block",children:l.title})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:R==="MIMIC"?e.jsx("div",{className:"h-full flex",children:e.jsx(as,{targetText:(o==null?void 0:o.text)||null,sourceWord:l.title,type:"Free Talk",isEmpty:g.length===0,isRecording:ne,isRevealed:P,userTranscript:u,matchStatus:null,userAudioUrl:k,localAnalysis:H,aiAnalysis:null,isAnalyzing:!1,onAnalyze:()=>{},ipa:S,showIpa:V,isIpaLoading:Se,onToggleIpa:w,onToggleRecord:j,onPlayTarget:()=>o&&ze(o.text),onPlayUser:()=>{k&&new Audio(`data:audio/webm;base64,${k}`).play()},onToggleReveal:()=>F(!P),onNext:()=>C<g.length-1&&c(r=>r+1),onClearTranscript:()=>N(""),onClose:_,pagedItems:se,page:d,pageSize:M,totalPages:Ce,onPageChange:I,onPageSizeChange:r=>{B(r),I(0)},onSelect:r=>c(d*M+r),currentAbsoluteIndex:C,autoSpeak:ae,onToggleAutoSpeak:()=>fe(!ae),autoReveal:Q,onToggleAutoReveal:()=>v(!Q),isGlobalMode:!0,onAddItem:()=>n("Editing not available in practice mode","info"),onEditItem:()=>{},onDeleteItem:()=>{},onRandomize:()=>{},isModalOpen:!1,editingItem:null,onCloseModal:()=>{},onSaveItem:()=>{}})}):e.jsxs("div",{className:"h-full flex flex-col p-8 overflow-y-auto custom-scrollbar bg-neutral-50/50",children:[e.jsx("button",{onClick:_,className:"absolute top-4 right-4 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full z-50",children:e.jsx(Me,{size:20})}),e.jsxs("div",{className:"max-w-2xl mx-auto w-full space-y-6 pb-20",children:[e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden transition-all",children:ye?e.jsxs("div",{className:"p-4 flex flex-col gap-4 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest",children:"Review"}),e.jsx("span",{className:"text-xs font-bold text-neutral-500",children:be(ie)})]}),e.jsx("div",{className:"flex-1 min-h-[10rem]",children:e.jsx(Ut,{audioBlob:ye,onTrim:r=>{X(r),n("Trimmed!","success")},onCancel:()=>{}})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:L,className:"p-3 text-neutral-400 hover:text-rose-500 hover:bg-rose-50 rounded-xl transition-all",title:"Discard",children:e.jsx(ds,{size:18})}),e.jsxs("button",{onClick:Y,disabled:J,className:"px-4 py-3 bg-neutral-900 text-white rounded-xl font-bold text-xs uppercase tracking-wider hover:bg-neutral-800 transition-all shadow-lg flex items-center gap-2",children:[J?e.jsx(nt,{size:16,className:"animate-spin"}):e.jsx(Lt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:J?"Saving...":"Save"})]})]})]}):e.jsxs("div",{className:"p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:E,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all transform active:scale-95 shadow-lg ${le?"bg-rose-600 text-white animate-pulse ring-4 ring-rose-100":"bg-rose-600 text-white hover:bg-rose-700"}`,children:le?e.jsx(Nt,{size:16,fill:"currentColor"}):e.jsx(Ge,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-lg font-black font-mono tracking-widest leading-none ${le?"text-rose-600":"text-neutral-800"}`,children:be(ie)}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:le?"Recording...":"Tap to Record"})]})]}),le&&e.jsx("div",{className:"flex gap-1 h-4 items-end",children:[...Array(5)].map((r,h)=>e.jsx("div",{className:"w-1 bg-rose-400 rounded-full animate-bounce",style:{height:"100%",animationDelay:`${h*.1}s`}},h))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest flex items-center gap-2",children:[e.jsx(Ot,{size:14})," Script & Notes"]}),l.scriptItems&&l.scriptItems.length>0?e.jsx("div",{className:"space-y-4",children:l.scriptItems.map((r,h)=>e.jsxs("div",{className:`rounded-3xl border shadow-sm transition-all overflow-hidden ${r.type==="note"?"bg-yellow-50/50 border-yellow-100 text-yellow-900 italic relative":"bg-white border-neutral-200 text-neutral-800"}`,children:[r.type==="note"&&e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-yellow-300/50"}),r.type==="script"?e.jsx(ns,{rawText:r.content,onUpdate:x=>W(h,x),audioLinks:l.audioLinks||[],onPlaySegment:xe,showDash:!0}):e.jsx("div",{className:"p-6 text-lg font-medium leading-relaxed whitespace-pre-wrap",children:r.content})]},r.id||h))}):e.jsx("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap",children:l.content})})]}),l.audioLinks&&l.audioLinks.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest flex items-center gap-2",children:[e.jsx(bt,{size:14})," Reference Audio"]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto custom-scrollbar pr-2",children:l.audioLinks.map((r,h)=>{const x=Pe===r;return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border transition-colors ${x?"bg-indigo-50 border-indigo-100":"bg-neutral-50 border-neutral-100"}`,children:[e.jsx("span",{className:`text-xs font-bold truncate max-w-[200px] ${x?"text-indigo-700":"text-neutral-600"}`,children:decodeURIComponent(r.split("/").pop()||`Track ${h+1}`)}),e.jsx("button",{onClick:()=>A(r,r,null),className:`p-2 rounded-full transition-all ${x?"bg-indigo-600 text-white":"bg-white text-indigo-600 border border-indigo-100 hover:bg-indigo-50"}`,children:x?e.jsx(st,{size:14,fill:"currentColor"}):e.jsx(Je,{size:14,fill:"currentColor"})})]}),x&&e.jsxs("div",{className:"flex items-center gap-3 px-2 pt-2 animate-in fade-in slide-in-from-top-1",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:be(oe)}),e.jsx("input",{type:"range",min:"0",max:Ne||100,value:oe,onChange:G,className:"flex-1 h-1 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:be(Ne)})]})]},h)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest flex items-center gap-2",children:[e.jsx(ls,{size:14})," Recordings History (",he.length,")"]}),he.length===0?e.jsx("div",{className:"text-center py-8 text-neutral-300 italic text-xs",children:"No recordings yet."}):e.jsx("div",{className:"grid gap-3",children:he.map(r=>{const h=te===r.id;return e.jsxs("div",{className:"flex flex-col bg-white rounded-2xl border border-neutral-200 shadow-sm hover:border-neutral-300 transition-colors overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>A(r.url,null,r.id),className:`p-3 rounded-full transition-all ${h?"bg-indigo-600 text-white shadow-md":"bg-indigo-50 text-indigo-600 hover:bg-indigo-100"}`,children:h?e.jsx(st,{size:16,fill:"currentColor"}):e.jsx(Je,{size:16,fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-neutral-800",children:new Date(r.timestamp).toLocaleString()}),e.jsx("p",{className:"text-[10px] font-medium text-neutral-400",children:be(r.duration||0)})]})]}),e.jsx("button",{onClick:()=>ke(r),className:"p-2 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",children:e.jsx(Ie,{size:16})})]}),h&&e.jsxs("div",{className:"px-4 pb-4 pt-0 flex items-center gap-3 animate-in fade-in slide-in-from-top-1 bg-white",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:be(oe)}),e.jsx("input",{type:"range",min:"0",max:Ne||100,value:oe,onChange:G,className:"flex-1 h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:be(Ne)})]})]},r.id)})})]})]})]})})]}),e.jsx(Xe,{isOpen:!!ge,title:"Delete Recording?",message:"This will permanently delete the audio file from the server.",confirmText:"Delete",isProcessing:!1,onConfirm:q,onClose:()=>ke(null),confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})},ft="vocab_pro_speaking_card_view",Ze=({score:m})=>m===void 0?null:e.jsxs("span",{className:`text-[10px] font-black px-1.5 py-0.5 rounded border ${m>=80?"bg-green-50 text-green-700 border-green-200":m>=50?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:[m,"%"]}),Gs=({user:m,onNavigate:_})=>{const[i,n]=t.useState([]),[R,T]=t.useState(!0),[l,p]=t.useState(!1),[g,b]=t.useState(()=>Ct(ft,{showTags:!0,compact:!1,resourceType:"ALL"})),C=(s,o)=>b($=>({...$,[s]:o})),[c,d]=t.useState(0),[I,M]=t.useState(12),[B,ne]=t.useState(""),[y,P]=t.useState(null),[F,u]=t.useState(!1),[N,k]=t.useState("all"),[f,H]=t.useState("all"),[je,ae]=t.useState(!1),[fe,Q]=t.useState(!1),[v,S]=t.useState(!1),[D,V]=t.useState(null),[de,Se]=t.useState(null),[re,le]=t.useState(null),[Z,ie]=t.useState(null),[we,ye]=t.useState(!1),[pe,ee]=t.useState(null),[X,J]=t.useState(null),[Te,Pe]=t.useState(null),{showToast:me}=De(),te=async(s=!1)=>{s||T(!0);const[o,$,K]=await Promise.all([Vt(m.id),Gt(m.id),qt(m.id)]),a=[...o.map(j=>({type:"card",data:j})),...$.map(j=>({type:"conversation",data:j})),...K.map(j=>({type:"free_talk",data:j}))];n(a.sort((j,w)=>w.data.createdAt-j.data.createdAt)),s||T(!1)};t.useEffect(()=>{te()},[m.id]),t.useEffect(()=>{d(0)},[y,I,N,f,g.resourceType,B]),t.useEffect(()=>{St(ft,g)},[g]);const ue=t.useMemo(()=>g.resourceType!=="ALL"||N!=="all"||f!=="all",[g.resourceType,N,f]),oe=t.useMemo(()=>{const s=B.toLowerCase().trim();return i.filter(o=>{var $,K;if(s){if(o.type==="card"){if(!o.data.standard.toLowerCase().includes(s))return!1}else if(o.type==="conversation"){if(!o.data.title.toLowerCase().includes(s)&&!(o.data.description||"").toLowerCase().includes(s))return!1}else if(!o.data.title.toLowerCase().includes(s)&&!o.data.content.toLowerCase().includes(s))return!1}if(g.resourceType!=="ALL"&&o.type.toUpperCase()!==g.resourceType||N==="focused"&&!o.data.isFocused||f!=="all"&&o.data.focusColor!==f)return!1;if(y){if(y==="Uncategorized"){if(o.data.path&&o.data.path!=="/")return!1}else if(!(($=o.data.path)!=null&&$.startsWith(y))&&!((K=o.data.tags)!=null&&K.includes(y)))return!1}return!0})},[i,y,N,f,g.resourceType,B]),Fe=t.useMemo(()=>{const s=c*I;return oe.slice(s,s+I)},[oe,c,I]),Ne=async s=>{const o=Date.now();D&&D.id?await _e({...D,...s,updatedAt:o}):await _e({id:`ns-${o}-${Math.random()}`,userId:m.id,createdAt:o,updatedAt:o,...s}),ae(!1),te(),me("Saved!","success")},$e=async s=>{const o=Date.now();de&&de.id?await Be({...de,...s,updatedAt:o}):await Be({id:`conv-${o}-${Math.random()}`,userId:m.id,createdAt:o,updatedAt:o,title:s.title||"",description:s.description||"",speakers:s.speakers||[],sentences:s.sentences||[],tags:s.tags||[]}),Q(!1),te(),me("Saved!","success")},Ae=async s=>{const o=Date.now();re&&re.id?await Ee({...re,...s,updatedAt:o}):await Ee({id:`ft-${o}-${Math.random()}`,userId:m.id,createdAt:o,updatedAt:o,...s}),S(!1),te(),me("Free Talk Saved!","success")},he=s=>{s.type==="card"?(V(s.data),ae(!0)):s.type==="conversation"?(Se(s.data),Q(!0)):s.type==="free_talk"&&(le(s.data),S(!0))},Ue=async()=>{Z&&(Z.type==="card"?await Wt(Z.id):Z.type==="conversation"?await Dt(Z.id):Z.type==="free_talk"&&await Jt(Z.id),ie(null),te(),me("Deleted!","success"))},ge=async(s,o)=>{const $={...s.data,focusColor:o||void 0,updatedAt:Date.now()};o||delete $.focusColor,s.type==="card"?await _e($):s.type==="conversation"?await Be($):s.type==="free_talk"&&await Ee($),te()},ke=async s=>{const o={...s.data,isFocused:!s.data.isFocused,updatedAt:Date.now()};s.type==="card"?await _e(o):s.type==="conversation"?await Be(o):s.type==="free_talk"&&await Ee(o),te()},Re=s=>{Se(o=>({...o||{},title:s.title,description:s.description,speakers:s.speakers,sentences:s.sentences,tags:s.tags})),ye(!1),me("Conversation generated!","success")},ce=()=>{n(s=>[...s].sort(()=>Math.random()-.5)),me("Deck shuffled!","success")};return e.jsxs(e.Fragment,{children:[e.jsx(Kt,{title:"Speaking Library",subtitle:"Master natural phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Microphone.png",className:"w-8 h-8 object-contain",alt:"Speaking"}),query:B,onQueryChange:ne,searchPlaceholder:"Search phrases, conversations...",config:{},isLoading:R,isEmpty:oe.length===0,emptyMessage:"No items found.",activeFilters:{},onFilterChange:()=>{},pagination:{page:c,totalPages:Math.ceil(oe.length/I),onPageChange:d,pageSize:I,onPageSizeChange:M,totalItems:oe.length},aboveGrid:e.jsx(e.Fragment,{children:F&&e.jsx(Yt,{items:i.map(s=>s.data),selectedTag:y,onSelectTag:P,forcedView:"tags",title:"Browse Tags",icon:e.jsx(ct,{size:16})})}),actions:e.jsx(Xt,{viewMenu:e.jsx(Ht,{isOpen:l,setIsOpen:p,hasActiveFilters:ue,filterOptions:[{label:"All",value:"ALL",isActive:g.resourceType==="ALL",onClick:()=>C("resourceType","ALL")},{label:"Card",value:"CARD",isActive:g.resourceType==="CARD",onClick:()=>C("resourceType","CARD")},{label:"Conv.",value:"CONVERSATION",isActive:g.resourceType==="CONVERSATION",onClick:()=>C("resourceType","CONVERSATION")},{label:"Free Talk",value:"FREE_TALK",isActive:g.resourceType==="FREE_TALK",onClick:()=>C("resourceType","FREE_TALK")}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(yt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>k(N==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${N==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:N==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>H(f==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${f==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>H(f==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${f==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>H(f==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${f==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Tags",checked:g.showTags,onChange:()=>b(s=>({...s,showTags:!s.showTags}))},{label:"Compact",checked:g.compact,onChange:()=>b(s=>({...s,compact:!s.compact}))}]}),browseTags:{isOpen:F,onToggle:()=>{u(!F)}},addActions:[{label:"New Native Expression",icon:qe,onClick:()=>{V(null),ae(!0)}},{label:"New Conversation",icon:et,onClick:()=>{Se(null),Q(!0)}},{label:"New Free Talk",icon:gt,onClick:()=>{le(null),S(!0)}}],extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:ce,disabled:i.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Bt,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:Fe.map(s=>{var o;if(s.type==="card")return e.jsx(Qe,{title:e.jsx("div",{className:"flex items-center gap-2 font-black text-neutral-900",children:s.data.standard}),badge:{label:"Native Expression",colorClass:"bg-teal-50 text-teal-700 border-teal-100",icon:_t},tags:g.showTags?s.data.tags:void 0,compact:g.compact,onClick:()=>ee(s.data),focusColor:s.data.focusColor,onFocusChange:$=>ge(s,$),isFocused:s.data.isFocused,onToggleFocus:ke.bind(null,s),isCompleted:s.data.focusColor==="green",actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),he(s)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(He,{size:14})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),ie({id:s.data.id,type:"card"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",children:e.jsx(Ie,{size:14})})]}),children:e.jsx("div",{className:"flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:[s.data.answers.length," variations"]}),e.jsx(Ze,{score:s.data.bestScore})]})})},s.data.id);if(s.type==="conversation")return e.jsx(Qe,{title:s.data.title,badge:{label:"Conversation",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:et},tags:g.showTags?s.data.tags:void 0,compact:g.compact,onClick:()=>J(s.data),focusColor:s.data.focusColor,onFocusChange:$=>ge(s,$),isFocused:s.data.isFocused,onToggleFocus:ke.bind(null,s),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),he(s)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(He,{size:14})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),ie({id:s.data.id,type:"conversation"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(Ie,{size:14})})]}),children:e.jsx("div",{className:"flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:[s.data.sentences.length," lines"]}),e.jsx(Ze,{score:s.data.bestScore})]})})},s.data.id);{const $=((o=s.data.content.match(/[^.!?]+[.!?]+["']?|[^.!?]+$/g))==null?void 0:o.length)||0,K=s.data.bestScore;return e.jsx(Qe,{title:s.data.title,badge:{label:"Free Talk",colorClass:"bg-cyan-50 text-cyan-700 border-cyan-100",icon:gt},tags:g.showTags?s.data.tags:void 0,compact:g.compact,onClick:()=>Pe(s.data),focusColor:s.data.focusColor,onFocusChange:a=>ge(s,a),isFocused:s.data.isFocused,onToggleFocus:ke.bind(null,s),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),he(s)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(He,{size:14})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),ie({id:s.data.id,type:"free_talk"})},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(Ie,{size:14})})]}),children:e.jsx("div",{className:"flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:[$," Sentences"]}),e.jsx(Ze,{score:K})]})})},s.data.id)}})})}),e.jsx(ms,{isOpen:je,onClose:()=>ae(!1),onSave:Ne,initialData:D}),e.jsx(hs,{isOpen:fe,onClose:()=>Q(!1),onSave:$e,initialData:de,onOpenAiGen:()=>ye(!0)}),e.jsx(gs,{isOpen:v,onClose:()=>S(!1),onSave:Ae,initialData:re}),e.jsx(Xe,{isOpen:!!Z,title:"Delete Item?",message:"This action cannot be undone.",confirmText:"Delete",isProcessing:!1,onConfirm:Ue,onClose:()=>ie(null),icon:e.jsx(Ie,{size:40,className:"text-red-500"})}),we&&e.jsx(it,{isOpen:we,onClose:()=>ye(!1),type:"GENERATE_UNIT",title:"AI Conversation Creator",description:"Enter a topic to generate a dialogue.",initialData:{},onGeneratePrompt:s=>xs(s.request),onJsonReceived:Re,actionLabel:"Generate",closeOnSuccess:!0}),e.jsx(bs,{isOpen:!!pe,onClose:()=>{ee(null),te(!0)},item:pe}),e.jsx(js,{isOpen:!!X,onClose:()=>{J(null),te(!0)},item:X}),e.jsx(ws,{isOpen:!!Te,onClose:()=>{Pe(null),te(!0)},item:Te})]})};export{Gs as SpeakingCardPage,Gs as default};
