import{j as e,w as ne,x as p,Z as ae,B as he,R as fe,y as ge,z as be,f as je,D as we,E as ve,V as ye,H as Ne,I as ke,J as Se,K as Re,N as oe,X as ie,C as Ee,O as Ce,Q as _e,T as Ie,U as ze,Y as Te,_ as Me,r,$ as le,a0 as te,a1 as q,a2 as Ae}from"./index-DLPzWOXZ.js";import{T as Oe}from"./trophy-DlXAnYmQ.js";const De=(n,u,P)=>{if(P)return n?n==="GAVE_UP"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-amber-100 text-amber-700",children:[e.jsx(Te,{size:10})," Gave Up"]}):n==="PASS"||n===p.EASY?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-700",children:[e.jsx(oe,{size:10})," Pass"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:[e.jsx(ie,{size:10})," Fail"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:[e.jsx(ze,{size:10})," No Answer"]});if(!n)return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:"Skipped"});if(u&&(n===p.EASY||n===p.LEARNED))return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-cyan-100 text-cyan-700",children:"Learned"});switch(n){case p.FORGOT:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:"Forgot"});case p.HARD:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-orange-100 text-orange-600",children:"Hard"});case p.EASY:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-600",children:"Easy"});default:return null}},Le=({score:n})=>{const w=2*Math.PI*16,O=w-n/100*w,D=n>=80?"text-green-500":n>=50?"text-yellow-500":n>0?"text-orange-500":"text-neutral-400";return e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:36,height:36},children:[e.jsxs("svg",{className:"absolute",width:36,height:36,children:[e.jsx("circle",{className:"text-neutral-100",stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2}),e.jsx("circle",{className:D,stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2,strokeDasharray:w,strokeDashoffset:O,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.5s ease-out"}})]}),e.jsx("span",{className:`text-[10px] font-black ${D}`,children:n})]})},Ue=({word:n})=>{const u=n.masteryScore??0;return e.jsxs("div",{className:"relative group/score",children:[e.jsx(Le,{score:u}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/score:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Mastery Score",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]})},Fe=({complexity:n})=>e.jsxs("div",{className:"relative group/complexity",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 transition-all hover:bg-amber-100 shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black opacity-50",children:"CX"}),e.jsx("span",{className:"text-xs font-black",children:n})]}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/complexity:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Complexity Level",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]}),Pe=n=>{const{user:u,initialWords:P,sessionWords:o,sessionType:w,newWordIds:O,progress:D,setProgress:_,sessionOutcomes:J,sessionFinished:V,wordInModal:W,setWordInModal:y,editingWordInModal:G,setEditingWordInModal:I,isTesting:Q,setIsTesting:L,currentWord:f,isNewWord:N,onUpdate:z,onComplete:k,nextItem:H,handleReview:v,handleTestComplete:S,handleRetry:R,handleEndSession:g,handleQuickReview:U,handleManualPractice:se,isQuickReviewMode:E}=n,{current:C,max:re}=D,m=w==="random_test",K=a=>{y(null),I(a)},X=a=>{z(a),I(null)};if(P.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 py-20 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner",children:e.jsx(ne,{size:32})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"All clear!"}),e.jsx("button",{onClick:k,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-semibold text-sm hover:bg-neutral-800 transition-colors",children:"Back to Dashboard"})]});if(V){if(w==="new"||w==="due"||w==="new_study"||w==="custom"||m){const a=Object.values(J).filter(x=>x==="PASS"||x===p.EASY||x===p.LEARNED).length;return e.jsxs("div",{className:"max-w-2xl mx-auto py-10 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center mb-4 ${m?"bg-amber-100 text-amber-600":"bg-neutral-100 text-neutral-900"}`,children:m?e.jsx(ae,{size:40,fill:"currentColor"}):e.jsx(he,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:m?"Test Result":"Session Recap"}),m&&e.jsxs("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-[0.2em] mt-2",children:["Score: ",a," / ",o.length]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You've completed this focused session."})]}),e.jsx("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm mb-8 overflow-hidden",children:e.jsx("div",{className:"max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 p-2",children:o.map(x=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50/70 p-2.5 rounded-xl border border-neutral-100",children:[e.jsx("span",{className:"font-bold text-neutral-800 text-xs truncate pr-2",children:x.word}),De(J[x.id],O.has(x.id),m)]},x.id))})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:k,className:"px-6 py-4 bg-white border border-neutral-200 text-neutral-500 rounded-2xl font-bold text-xs hover:bg-neutral-50 hover:border-neutral-900 transition-all active:scale-95 uppercase tracking-widest",children:"Finish Session"}),e.jsxs("button",{onClick:R,className:"px-6 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center justify-center space-x-2 shadow-lg hover:bg-neutral-800 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(fe,{size:14}),e.jsx("span",{children:"Retry This Session"})]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in zoom-in-95 duration-500",children:[e.jsx(Oe,{size:64,className:"text-yellow-500 mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You have finished this review session."}),e.jsx("button",{onClick:k,className:"mt-8 px-10 py-3.5 bg-neutral-900 text-white rounded-2xl font-bold shadow-xl hover:scale-105 transition-all text-sm",children:"Return to Dashboard"})]})}if(!f)return null;const B=N?be:je,T=N?"text-blue-500":"text-neutral-500",$=N?f.word:f.ipaUs||f.word,F=!N&&!!f.ipaUs,i=ge.useRef(null),Z=a=>{i.current=a.touches[0].clientX},Y=a=>{if(i.current===null)return;const x=a.changedTouches[0].clientX-i.current,M=50;x>M?_(A=>({...A,current:(A.current-1+o.length)%o.length})):x<-M&&_(A=>({...A,current:(A.current+1)%o.length})),i.current=null};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-80px)] sm:h-[calc(100vh-100px)] flex flex-col animate-in fade-in duration-300 px-3 sm:px-0",children:[e.jsxs("div",{className:"px-6 shrink-0 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"w-24"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{size:14,className:T}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:[C+1," / ",o.length]})]}),e.jsx("div",{className:"w-24 text-right",children:e.jsx("button",{onClick:g,className:"px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider text-neutral-500 hover:bg-neutral-100 transition-colors",children:"End Session"})})]}),e.jsx("div",{className:"h-1 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-neutral-900 transition-all duration-300 ease-in-out",style:{width:`${(C+1)/o.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative gap-2 sm:gap-4",children:[e.jsx("button",{onClick:()=>_(a=>({...a,current:(a.current-1+o.length)%o.length})),className:"hidden sm:block p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Previous word",children:e.jsx(we,{size:28})}),e.jsx("div",{onTouchStart:Z,onTouchEnd:Y,className:"w-full max-w-xl h-full bg-white rounded-3xl sm:rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col relative overflow-hidden group select-none touch-pan-y",children:m?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-4",children:[e.jsx(ve,{className:"animate-spin text-neutral-200",size:32}),e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Loading Next Test..."})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 sm:p-12 w-full text-center space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:`font-black text-neutral-900 tracking-tight text-3xl sm:text-4xl break-words ${F?"font-serif":""}`,children:$}),N?e.jsx(Fe,{complexity:f.complexity??0}):e.jsx(Ue,{word:f}),e.jsx("button",{onClick:a=>{a.stopPropagation(),Ne(f.word)},className:"p-3 text-neutral-400 bg-neutral-50 hover:bg-neutral-100 hover:text-neutral-900 rounded-full transition-colors",title:"Pronounce",children:e.jsx(ye,{size:22})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>y(f),className:"flex items-center gap-2 px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(ke,{size:14}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-black text-[10px] hover:bg-amber-600 transition-all active:scale-95 uppercase tracking-widest shadow-lg shadow-amber-500/20",children:[e.jsx(Se,{size:14}),e.jsx("span",{children:"Practice"})]})]})]})}),e.jsx("button",{onClick:()=>_(a=>({...a,current:(a.current+1)%o.length})),className:"hidden sm:block p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Next word",children:e.jsx(Re,{size:28})})]}),e.jsx("div",{className:"shrink-0 pt-6 pb-2 mt-auto",children:N?e.jsxs("div",{className:"max-w-lg mx-auto grid grid-cols-3 items-stretch gap-4",children:[e.jsx("div",{})," ",e.jsxs("button",{onClick:()=>v(p.LEARNED),className:"py-5 bg-green-500 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 shadow-lg shadow-green-500/20 hover:bg-green-600 transition-all active:scale-95",children:[e.jsx(oe,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"LEARNED"})]}),e.jsx("div",{})," "]}):!m&&e.jsxs("div",{className:"max-w-xl mx-auto grid grid-cols-4 items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>v(p.FORGOT),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-red-600 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(ie,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"FORGOT"})]}),e.jsxs("button",{onClick:()=>v(p.HARD),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-orange-600 hover:bg-orange-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(Ee,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Hard"})]}),e.jsxs("button",{onClick:()=>v(p.EASY),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-green-600 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(ne,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Easy"})]}),e.jsxs("button",{onClick:U,className:"py-5 bg-indigo-600 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all hover:bg-indigo-700 shadow-md shadow-indigo-200",children:[e.jsx(ae,{size:20,fill:"currentColor"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Quick Review"})]})]})})]}),W&&e.jsx(Ce,{word:W,onUpdate:z,onClose:()=>y(null),onNavigateToWord:y,onEditRequest:K,onGainXp:async()=>0,isViewOnly:!0}),G&&e.jsx(_e,{user:u,word:G,onSave:X,onClose:()=>I(null),onSwitchToView:a=>{I(null),y(G)}}),Q&&f&&e.jsx(Ie,{word:f,isQuickFire:m,sessionPosition:m?{current:C+1,total:o.length}:void 0,onPrevWord:()=>_(a=>({...a,current:Math.max(0,a.current-1)})),onClose:()=>{m?k():L(!1)},onComplete:S,skipSetup:E})]})},Qe=({user:n,sessionWords:u,sessionFocus:P,sessionType:o,onUpdate:w,onBulkUpdate:O,onComplete:D,onRetry:_})=>{const{showToast:J}=Me(),V=`vocab_pro_learn_queue_${n.id}`,W=`vocab_pro_learn_queue_date_${n.id}`,y=new Date().toISOString().slice(0,10),[G,I]=r.useState([]);r.useEffect(()=>{if(o==="new"||o==="new_study"){let s=[],l="";try{s=JSON.parse(sessionStorage.getItem(V)||"[]"),l=sessionStorage.getItem(W)||""}catch{}let d=[];l===y&&s.length>0?d=s.map(t=>u.find(c=>c.id===t)).filter(t=>t&&(!t.lastReview||t.lastGrade!=="LEARNED")):d=u.filter(c=>!c.lastReview||c.lastGrade!=="LEARNED").slice(0,20);const j=new Set(d.map(t=>t.id)),h=u.filter(t=>!t.lastReview||t.lastGrade!=="LEARNED");for(const t of h){if(d.length>=20)break;j.has(t.id)||d.push(t)}sessionStorage.setItem(V,JSON.stringify(d.map(t=>t.id))),sessionStorage.setItem(W,y),I(d)}else I(u)},[u,o]);const Q=o==="new"||o==="new_study"?G:u,L=r.useRef(null),[f,N]=r.useState(new Set),[z,k]=r.useState(()=>{const s=le("vocab_pro_session_progress",null);return s&&typeof s.current=="number"&&typeof s.max=="number"&&s.current<=s.max&&s.max<u.length?s:{current:0,max:0}}),[H,v]=r.useState(()=>le("vocab_pro_session_outcomes",{})),[S,R]=r.useState(new Map),g=r.useRef(null),{current:U,max:se}=z,[E,C]=r.useState(!1),[re,m]=r.useState(null),[K,X]=r.useState(null),[B,T]=r.useState(o==="random_test"),[$,F]=r.useState(!1),i=Q[U],Z=r.useMemo(()=>!(i!=null&&i.lastReview),[i]),Y=r.useRef(S);r.useEffect(()=>{Y.current=S},[S]);const a=r.useRef(E);r.useEffect(()=>{a.current=E},[E]),r.useEffect(()=>{const s=u.map(l=>l.id).sort().join(",");(L.current===null||L.current!==s)&&(L.current=s,N(new Set(u.filter(l=>!l.lastReview).map(l=>l.id))),k({current:0,max:0}),v({}),C(!1),R(new Map),sessionStorage.removeItem("vocab_pro_session_progress"),sessionStorage.removeItem("vocab_pro_session_outcomes"))},[u]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_progress",JSON.stringify(z))},[z]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_outcomes",JSON.stringify(H))},[H]),r.useEffect(()=>{m(null),X(null),T(o==="random_test"),F(!1)},[U,o]);const x=r.useCallback(async()=>{const s=Array.from(Y.current.values());s.length!==0&&(await O(s),R(new Map))},[O]);r.useEffect(()=>()=>{!a.current&&Y.current.size>0&&x()},[x]),r.useEffect(()=>{E&&S.size>0&&x()},[E,x,S.size]);const M=()=>{if(U<Q.length-1){const s=U+1;k(l=>({current:s,max:Math.max(l.max,s)}))}else C(!0)},A=async s=>{if(!i)return;v(t=>({...t,[i.id]:s}));let l,d;const j=S.get(i.id);j&&j.lastTestResults?(l={...j.lastTestResults},d=j.masteryScore):g.current?(l={...g.current},d=q({...i,lastTestResults:g.current})):i.lastTestResults&&(l={...i.lastTestResults},d=i.masteryScore);let h=te(i,s);l&&(h={...h,lastTestResults:l,masteryScore:d}),R(t=>new Map(t).set(h.id,h)),g.current=null,M()},ce=()=>{F(!0),T(!0)},de=()=>{F(!1),T(!0)},ue=(s,l)=>{const d={...s.lastTestResults||{}},j=Ae(s);return Object.entries(l).forEach(([h,t])=>{if(d[h]=t,t===!1){const c=j.find(b=>b.testKeys.includes(h));c&&c.testKeys.forEach(b=>{d[b]=!1})}}),d},xe=async(s,l,d=!1,j)=>{if(T(!1),!i)return;let h={...i};if(l&&(g.current=ue(h,l)),$&&j){const t=j.tested-j.correct;let c=p.FORGOT;t===0?c=p.EASY:t===1&&(c=p.HARD),v(ee=>({...ee,[i.id]:c}));const b=te(h,c);l&&(b.lastTestResults=g.current),b.masteryScore=q(b),R(ee=>new Map(ee).set(b.id,b)),F(!1),M(),g.current=null;return}if(o==="random_test"){let t=d?"GAVE_UP":s===p.EASY?"PASS":"FAIL";v(b=>({...b,[i.id]:t}));const c=te(h,s);l&&(c.lastTestResults=g.current),c.masteryScore=q(c),R(b=>new Map(b).set(c.id,c)),d?C(!0):M(),g.current=null}else{const t={...h};l&&(t.lastTestResults=g.current),t.masteryScore=q(t),R(c=>new Map(c).set(t.id,t)),g.current=null}},pe=()=>{L.current=null,_()},me=()=>{C(!0)};return e.jsx(Pe,{user:n,initialWords:u,sessionWords:Q,sessionType:o,newWordIds:f,progress:z,setProgress:k,sessionOutcomes:H,sessionFinished:E,wordInModal:re,setWordInModal:m,editingWordInModal:K,setEditingWordInModal:X,isTesting:B,setIsTesting:T,currentWord:i,isNewWord:Z,onUpdate:w,onComplete:D,nextItem:M,handleReview:A,handleTestComplete:xe,handleRetry:pe,handleEndSession:me,handleQuickReview:ce,handleManualPractice:de,isQuickReviewMode:$})};export{Qe as default};
