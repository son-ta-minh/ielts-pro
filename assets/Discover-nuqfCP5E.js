import{c as fe,j as e,r as t,P as pt,K as Ee,ba as Pe,Z as de,Y as Re,m as $e,bb as Le,n as Oe,U as ke,a3 as pe,bc as bt,bd as gt,a0 as jt,H as Me,a5 as wt,at as vt,be as Ne,bf as Ke,y as lt,J as ie,b2 as He,R as We,X as xe,k as yt,am as ue,V as Ue,N as ge,E as we,a$ as Nt,b1 as kt,h as rt,d as Be,aU as nt,T as St,bg as Ct,b6 as It,a4 as qe,al as Xe,bh as ze,bi as Et,o as Ze,aN as Je,aR as Rt,bj as At,b4 as Mt,M as zt,aP as Ve,t as Te,bk as Tt,p as je,bl as it,ae as _t}from"./index-CAAe2Tdy.js";import{C as Ft,S as De,A as Pt,T as Dt,L as $t}from"./AvatarSelectionModal-BGov6eBg.js";import{T as ot}from"./trophy-Ck3h6Gf0.js";import{C as ct}from"./chevron-left-xJ0sy8V0.js";import{B as Ge,K as Lt}from"./keyboard-B1oNAdWU.js";import{a as dt,S as Ot}from"./split-DGyfrENa.js";import{L as Ht}from"./layout-grid-YedAXDta.js";import{C as Wt}from"./columns-2-DmSnsGz0.js";import{S as Ut}from"./square-check-big-JCDCfgp1.js";import{S as Bt}from"./server-K7l3r5O5.js";import{S as Ye}from"./skip-forward-C-HNB-JR.js";import"./palette-EN5zkBpI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=fe("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=fe("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=fe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=fe("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=fe("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=fe("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=fe("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=fe("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),ht=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],Qt=a=>{let p="Novice Soul";for(const z of ht)if(a>=z.level)p=z.title;else break;return p},Kt=a=>a>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:a>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:a>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:a>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},qt=({user:a,xpToNextLevel:p,onUpdateUser:z,isRecalculatingXp:R})=>{const[k,P]=t.useState(!1),J=p>0?Math.min(100,Math.max(0,a.experience/p*100)):0,g=a.peakLevel||a.level,Y=g>0?Math.min(100,Math.max(0,a.level/g*100)):100,M=Kt(a.level),$=a.adventure,O=Qt(a.level),B=ht.find(U=>U.level>a.level),Q=async U=>{await z({...a,avatar:U}),P(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>P(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${M.frame} shadow-md ${M.shadow}`,children:[e.jsx("img",{src:a.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(pt,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:a.name}),R&&e.jsx(Ee,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(Ft,{size:12,className:"text-yellow-500"})," ",O]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",a.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[a.experience," / ",p," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${J}%`}})})]}),g>a.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[a.level," / ",g," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${Y}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(Pe,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:($==null?void 0:$.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(xt,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[($==null?void 0:$.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(de,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:($==null?void 0:$.energy)??0})]})]}),B&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",B.level," for: ",e.jsx("strong",{children:B.title})]}),e.jsx(De,{size:12,className:"text-amber-400"})]})]})]}),e.jsx(Pt,{isOpen:k,onClose:()=>P(!1),onSelectAvatar:Q,currentUser:a})]})},Xt=({user:a,xpToNextLevel:p,onUpdateUser:z,isRecalculatingXp:R,children:k})=>e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(qt,{user:a,xpToNextLevel:p,onUpdateUser:z,isRecalculatingXp:R})}),e.jsx("div",{className:"flex-1 min-h-0 relative",children:k})]}),ne={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},Zt=a=>{var p,z;switch(a.type){case"boss":return a.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((p=a.boss_details)==null?void 0:p.image)||"üëπ",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(Oe,{size:10,className:"text-white"})})]}):((z=a.boss_details)==null?void 0:z.image)||"üëπ";case"treasure":return"üëë";case"key_fragment":return"üóùÔ∏è";default:return"‚òÖ"}},Jt=a=>a>=50?4:a>=25?3:a>=10?2:1,es=({user:a})=>{const p=Jt(a.peakLevel||1),z=p===1?"shadow-indigo-500/50":p===2?"shadow-cyan-500/60":p===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:ne.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${z}`,children:["Lvl ",a.peakLevel||1]})]})},ts=({isOpen:a,onClose:p,defeatedBosses:z})=>a?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(ot,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:p,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:z.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(mt,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map(R=>{var k,P;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(Oe,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(k=R.boss_details)==null?void 0:k.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(P=R.boss_details)==null?void 0:P.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",R.id+1]})]},R.id)})})})]})}):null,ss=({user:a,progress:p,onExit:z,map:R,onMove:k,onNodeClick:P,onOpenInventory:J,onAdminAction:g})=>{const M=R.length,$=5,[O,B]=t.useState(0),[Q,U]=t.useState(!1),A=Math.min(M-6,p.currentNodeIndex),K=R.filter(u=>u.type==="boss"&&u.isDefeated);t.useEffect(()=>{r()},[p.currentNodeIndex]);const r=()=>{let u=p.currentNodeIndex-Math.floor(3);u<0&&(u=0),u>A&&(u=A),B(u)},x=u=>{B(_=>{let w=u==="left"?_-1:_+1;return w<0&&(w=0),w>A&&(w=A),w})},E=M/6*100,T=-(O*(100/M)),H=T*.3,W=50/M,b=R[p.currentNodeIndex],S=(b==null?void 0:b.type)==="boss"&&!(b!=null&&b.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${E}%`,transform:`translateX(${H}%)`},children:[e.jsx("img",{src:ne.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:ne.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:ne.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"üåÄ"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"üåö"}),e.jsx("img",{src:ne.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:ne.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:ne.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:ne.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:ne.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"üåÄ"}),e.jsx("img",{src:ne.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"üåö"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(de,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[p.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(Pe,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:p.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[p.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>U(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(ot,{size:18}),K.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:r,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(Vt,{size:18})}),e.jsx("button",{onClick:J,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(ut,{size:18})}),e.jsx("button",{onClick:z,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(Re,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>x("left"),disabled:O===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(ct,{size:32})}),e.jsx("button",{onClick:()=>x("right"),disabled:O>=A,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx($e,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${E}%`,transform:`translateX(${T}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${W}%`,right:`${W}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${p.currentNodeIndex/(M-1)*100}%`}})})}),R.map((u,_)=>{if(_>p.currentNodeIndex+$)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/M}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},u.id);const C=_===p.currentNodeIndex,l=_<p.currentNodeIndex,i=u.type==="boss",s=u.isDefeated;let o="w-16 h-16",d="bg-slate-800 border-slate-600 text-slate-500 cursor-default",m="",n="scale(1)";return C?(d="bg-slate-700 border-slate-500 text-slate-300",m="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):l&&(d="bg-emerald-900/80 border-emerald-500 text-emerald-400",m="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),i&&(o="w-24 h-24",s?(d="bg-slate-800 border-slate-600 text-slate-500",C&&(d="bg-slate-700 border-slate-500 text-slate-400")):(d="bg-red-950 border-red-600 text-red-500 cursor-pointer",m="shadow-[0_0_20px_rgba(220,38,38,0.4)]",C&&(d="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",n="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/M}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[C&&e.jsx(es,{user:a}),C&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>P(u),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${o} ${d} ${m}`,style:{transform:n},children:[e.jsx("span",{className:"text-3xl font-black",children:Zt(u)}),i&&C&&!s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(Le,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!C&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${l?"text-emerald-500":"text-slate-600"}`,children:_+1})]})},u.id)})]})})]}),a.isAdmin&&g&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(Dt,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>g("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(de,{size:12})," +10"]}),e.jsx("button",{onClick:()=>g("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>g("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(Pe,{size:12})," +1"]}),e.jsx("button",{onClick:()=>g("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>g("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"üß™+"}),e.jsx("button",{onClick:()=>g("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>g("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"üçé+"}),e.jsx("button",{onClick:()=>g("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>g("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(Oe,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",p.currentNodeIndex+1," / ",R.length]}),e.jsxs("button",{onClick:k,disabled:p.energy<=0||S,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(ke,{size:18})]})]}),e.jsx(ts,{isOpen:Q,onClose:()=>U(!1),defeatedBosses:K})]})},ve=5,as=({user:a,boss:p,words:z,onVictory:R,onDefeat:k,onExit:P,onUpdateUser:J})=>{const{showToast:g}=pe(),[Y,M]=t.useState(p.hp),[$,O]=t.useState(ve),[B,Q]=t.useState(0),[U,A]=t.useState("idle"),[K,r]=t.useState("none"),[x,E]=t.useState("intro"),[T,H]=t.useState(600),[W,b]=t.useState(!1),[S,u]=t.useState(!1),_=t.useMemo(()=>[...z].sort(()=>Math.random()-.5),[z]),w=_[B%_.length];t.useEffect(()=>{if(x==="fighting"){const n=setInterval(()=>{H(I=>I<=1?(clearInterval(n),E("lost"),0):I-1)},1e3);return()=>clearInterval(n)}},[x]),t.useEffect(()=>{u(!1)},[B]);const C=async n=>{const I=n!==Me.FORGOT;E("animating"),I?(A("player-attacking"),setTimeout(()=>{A("idle"),r("boss-hit"),M(L=>Math.max(0,L-1)),setTimeout(()=>{r("none"),l()},800)},600)):(A("boss-attacking"),setTimeout(()=>{A("idle"),r("player-hit"),O(L=>Math.max(0,L-1)),setTimeout(()=>{r("none"),l()},800)},600));const Z=I?Me.EASY:Me.FORGOT,c=wt(w,Z);c.lastReviewSessionType="boss_battle",await vt(c)},l=n=>{M(I=>(O(Z=>(I<=0?E("won"):Z<=0?E("lost"):(Q(c=>c+1),E("fighting")),Z)),I))},i=n=>{const I=Math.floor(n/60),Z=n%60;return`${I}:${Z.toString().padStart(2,"0")}`},s=n=>{var I,Z;return!(n.type==="SPELLING"||n.type==="COLLOCATION_QUIZ"&&(((I=n.word.collocationsArray)==null?void 0:I.filter(L=>!L.isIgnored&&L.d))||[]).length>2||n.type==="PARAPHRASE_QUIZ"&&(((Z=n.word.paraphrases)==null?void 0:Z.filter(L=>!L.isIgnored))||[]).length>2)},o=async()=>{if((a.adventure.hpPotions||0)<=0)return;if($>=ve){g("Health is already full!","info");return}O(I=>Math.min(ve,I+1));const n={...a.adventure};n.hpPotions=(n.hpPotions||0)-1,await J({...a,adventure:n}),g("+1 HP Recovered!","success")},d=async()=>{if((a.adventure.wisdomFruits||0)<=0)return;if(S){g("Hint is already active!","info");return}u(!0);const n={...a.adventure};n.wisdomFruits=(n.wisdomFruits||0)-1,await J({...a,adventure:n}),g("Wisdom Fruit Used! Hint revealed.","success")},m=(a.adventure.hpPotions||0)>0||(a.adventure.wisdomFruits||0)>0;if(x==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:p.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:p.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',p.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>E("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(Le,{size:24})," FIGHT!"]})]});if(x==="won"||x==="lost"){const n=x==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${n?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!n&&"grayscale opacity-50"}`,children:n?"üèÜ":"üíÄ"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${n?"text-emerald-400":"text-red-500"}`,children:n?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:n?`"${p.dialogueWin}"`:`"${p.dialogueLose}"`}),e.jsx("button",{onClick:n?R:k,className:`px-8 py-3 font-bold rounded-xl transition-all ${n?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:n?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:p.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${Y/p.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(et,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[Y," / ",p.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${K==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:p.image}),K==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"üí•"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-hidden",children:[U==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(Yt,{className:"fill-cyan-400 rotate-45",size:48})}),U==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(mt,{className:"fill-red-900",size:48})}),e.jsxs("div",{className:`absolute top-4 right-4 flex items-center gap-2 px-4 py-2 rounded-xl font-mono font-black border-2 backdrop-blur-md z-20 transition-all duration-300 ${T<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(bt,{size:18,className:T<60?"animate-spin":""}),e.jsx("span",{className:"text-lg tracking-widest",children:i(T)})]}),e.jsx("button",{onClick:()=>b(!W),className:`absolute top-4 left-4 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 z-20 group ${W?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(gt,{size:24}),m&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),W&&e.jsxs("div",{className:"absolute top-16 left-4 z-40 bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-left-4 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üß™"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",a.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:o,disabled:(a.adventure.hpPotions||0)<=0||$>=ve,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üçé"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",a.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:d,disabled:(a.adventure.wisdomFruits||0)<=0||S,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]}),x==="fighting"&&w?e.jsx("div",{className:"w-full max-w-md h-full max-h-[420px] z-10 animate-in zoom-in-95 duration-300 flex items-center",children:e.jsx(jt,{word:w,isQuickFire:!0,onComplete:C,onClose:P,isModal:!1,disableHints:!S,forceShowHint:S,challengeFilter:s,skipRecap:!0})}):x==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[K==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"üí•"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${K==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:a.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:ve}).map((n,I)=>e.jsx(et,{size:18,fill:I<$?"#ef4444":"none",className:`transition-all duration-300 ${I<$?"text-red-500 scale-100":"text-slate-600 scale-90"}`},I))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `})]})},ls=({isOpen:a,onClose:p,badges:z,hpPotions:R,wisdomFruits:k,onUseBadge:P})=>{if(!a)return null;const J=new Set(z.filter(Y=>Y!=="locked_chest")).size,g=Object.keys(Ne).filter(Y=>Y!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(ut,{size:20})," T√∫i ƒë·ªì"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"V·∫≠t ph·∫©m & Huy hi·ªáu thu th·∫≠p ƒë∆∞·ª£c."})]}),e.jsx("button",{type:"button",onClick:p,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(Le,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üß™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",R]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üçé"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",k]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(de,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[J,"/",g]})]}),z.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Ch∆∞a c√≥ huy hi·ªáu."}),e.jsx("p",{className:"text-xs",children:"M·ªü R∆∞∆°ng ho·∫∑c ƒë√°nh Boss ƒë·ªÉ nh·∫≠n."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:z.map((Y,M)=>{const $=Ne[Y];if(!$)return null;const O=Y==="locked_chest"||Y==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:$.icon}),O&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:$.name}),O&&e.jsxs("button",{onClick:()=>P(Y),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(Gt,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${Y}-${M}`)})})]})]})]})})},rs=30,ns=({onComplete:a,badge:p})=>{const[z]=t.useState(()=>Array.from({length:rs}).map((R,k)=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return p?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:z.map((R,k)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${R.size}px`,height:`${R.size}px`,backgroundColor:R.color,transform:`rotate(${R.angle}deg) translate(${R.distance}px)`,opacity:0,animation:`explode ${R.duration}s ease-out ${R.delay}s forwards`}},k))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:p.icon}),e.jsx(De,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx(De,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:p.name})]}),e.jsx("button",{onClick:a,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(Re,{size:16})]})})]})]}):null},_e=({user:a,onExit:p,onUpdateUser:z,onStartSession:R})=>{const{showToast:k}=pe(),[P,J]=t.useState(null),[g,Y]=t.useState(!1),[M,$]=t.useState(null);t.useEffect(()=>{if(!a.adventure.map){const r=Ke(100);z({...a,adventure:{...a.adventure,map:r}})}},[]);const O=a.adventure.map||Ke(100),B=async()=>{const r={...a.adventure};if(r.energy<=0){k("Not enough energy to move!","error");return}r.energy-=1;const x=r.currentNodeIndex+1;r.currentNodeIndex=x;const E=O[x];E&&(E.type==="standard"?(r.energyShards=(r.energyShards||0)+1,k("+1 Energy Shard ‚ö°","success",2e3)):E.type==="key_fragment"?(r.keyFragments=(r.keyFragments||0)+1,k("Picked up a Key Fragment üóùÔ∏è","success",3e3),r.keyFragments>=3&&(r.keyFragments-=3,r.keys=(r.keys||0)+1,k("‚ú® Key Fragments assembled into a Magic Key!","success",4e3))):E.type==="treasure"&&(r.badges=[...r.badges||[],"locked_chest"],k("Picked up a Locked Chest! üß∞ (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(r.hpPotions=(r.hpPotions||0)+1,k("You found an HP Potion! üß™","success",4e3)):(r.wisdomFruits=(r.wisdomFruits||0)+1,k("You found a Wisdom Fruit! üçé","success",4e3))),Math.random()<.2&&(r.badges=[...r.badges||[],"lucky_dice"],k("You found a Lucky Dice! üé≤","success",4e3)),await z({...a,adventure:r})},Q=async r=>{if(r.id===a.adventure.currentNodeIndex&&r.type==="boss"){if(r.isDefeated){k("This boss has already been defeated.","info");return}const x=lt().filter(W=>W.userId===a.id);if(x.length===0){k("You have no words in your library to fight a boss. Add some words first!","error");return}const E=x.filter(W=>W.lastReview);E.length<20&&k("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let T=[...E].sort(()=>.5-Math.random());if(T.length<20){const W=new Set(T.map(u=>u.id)),b=x.filter(u=>!W.has(u.id)),S=20-T.length;T.push(...[...b].sort(()=>.5-Math.random()).slice(0,S))}T=T.slice(0,20);const H={...r.boss_details,hp:20};J({boss:H,words:T})}},U=async()=>{k("Boss defeated! +1 Key Fragment","success");const r={...a.adventure};if(r.keyFragments=(r.keyFragments||0)+1,r.keyFragments>=3&&(r.keyFragments-=3,r.keys=(r.keys||0)+1,k("Key Fragments assembled into a Magic Key!","success",4e3)),r.map){const x=[...r.map],E=r.currentNodeIndex;x[E]&&(x[E]={...x[E],isDefeated:!0}),r.map=x}await z({...a,adventure:r}),J(null)},A=async r=>{const x={...a.adventure};if(x.badges=x.badges||[],r==="locked_chest"){if((x.keys||0)<=0){k("You need a Magic Key üóùÔ∏è to open this chest!","error");return}x.keys-=1;const E=x.badges.indexOf("locked_chest");E>-1&&x.badges.splice(E,1);const T=Object.keys(Ne).filter(S=>S!=="locked_chest"&&S!=="lucky_dice"),H=x.badges||[],W=T.filter(S=>!H.includes(S));let b;W.length>0?b=W[Math.floor(Math.random()*W.length)]:b=T[Math.floor(Math.random()*T.length)],x.badges.push(b),await z({...a,adventure:x}),$(Ne[b]),Y(!1)}else if(r==="lucky_dice"){const E=x.badges.indexOf("lucky_dice");if(E>-1)x.badges.splice(E,1);else return;const T=Math.random();T<.2?(x.energy+=3,k("Dice rolled! +3 Energy ‚ö°","success",3e3)):T<.4?(x.keys=(x.keys||0)+1,k("Dice rolled! +1 Magic Key üóùÔ∏è","success",3e3)):T<.6?(x.badges.push("locked_chest"),k("Dice rolled! +1 Locked Chest üß∞","success",3e3)):T<.8?(x.hpPotions=(x.hpPotions||0)+1,k("Dice rolled! +1 HP Potion üß™","success",3e3)):(x.wisdomFruits=(x.wisdomFruits||0)+1,k("Dice rolled! +1 Wisdom Fruit üçé","success",3e3)),await z({...a,adventure:x})}else $(Ne[r])},K=async r=>{const x={...a.adventure};if(r==="add_energy")x.energy=(x.energy||0)+10,k("Admin: +10 Energy","success");else if(r==="remove_energy")x.energy=Math.max(0,(x.energy||0)-1),k("Admin: -1 Energy","info");else if(r==="add_key")x.keys=(x.keys||0)+1,k("Admin: +1 Key","success");else if(r==="remove_key")x.keys=Math.max(0,(x.keys||0)-1),k("Admin: -1 Key","info");else if(r==="add_hp")x.hpPotions=(x.hpPotions||0)+1,k("Admin: +1 HP Potion","success");else if(r==="remove_hp")x.hpPotions=Math.max(0,(x.hpPotions||0)-1),k("Admin: -1 HP Potion","info");else if(r==="add_fruit")x.wisdomFruits=(x.wisdomFruits||0)+1,k("Admin: +1 Wisdom Fruit","success");else if(r==="remove_fruit")x.wisdomFruits=Math.max(0,(x.wisdomFruits||0)-1),k("Admin: -1 Wisdom Fruit","info");else if(r==="pass_boss"){const E=O[x.currentNodeIndex];if(E&&E.type==="boss"){if(P){await U();return}if(k("Admin: Force Boss Victory","success"),x.keyFragments=(x.keyFragments||0)+1,x.keyFragments>=3&&(x.keyFragments-=3,x.keys=(x.keys||0)+1),x.map){const T=[...x.map],H=x.currentNodeIndex;T[H]&&(T[H]={...T[H],isDefeated:!0}),x.map=T}}else k("Not currently at a boss node.","info")}await z({...a,adventure:x})};return P?e.jsx(as,{user:a,boss:P.boss,words:P.words,onVictory:U,onDefeat:()=>{k("You were defeated. Study more and try again!","error"),J(null)},onExit:()=>J(null),onUpdateUser:z}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{user:a,progress:a.adventure,onExit:p,map:O,onMove:B,onNodeClick:Q,onOpenInventory:()=>Y(!0),onAdminAction:K}),e.jsx(ls,{isOpen:g,onClose:()=>Y(!1),badges:a.adventure.badges||[],onUseBadge:A,hpPotions:a.adventure.hpPotions||0,wisdomFruits:a.adventure.wisdomFruits||0}),M&&e.jsx(ns,{badge:M,onComplete:()=>$(null)})]})},Se=[{id:"i_ii",sym1:"…™",sym2:"iÀê",label:"Short i vs Long ee",example:"sit / seat",category:"VOWELS"},{id:"u_uu",sym1:" ä",sym2:"uÀê",label:"Short u vs Long oo",example:"full / fool",category:"VOWELS"},{id:"ae_e",sym1:"√¶",sym2:"e",label:"Short a vs Short e",example:"man / men",category:"VOWELS"},{id:"ae_v",sym1:"√¶",sym2:" å",label:"Short a vs Short u",example:"cat / cut",category:"VOWELS"},{id:"o_or",sym1:"…í",sym2:"…îÀê",label:"Short o vs Long aw",example:"cot / caught",category:"VOWELS"},{id:"er_or",sym1:"…úÀê",sym2:"…îÀê",label:"Stressed er vs aw",example:"bird / board",category:"VOWELS"},{id:"aa_ae",sym1:"…ëÀê",sym2:"√¶",label:"Long a vs Short a",example:"cart / cat",category:"VOWELS"},{id:"th_t",sym1:"Œ∏",sym2:"t",label:"Voiceless TH vs T",example:"think / tin",category:"CONSONANTS"},{id:"dh_d",sym1:"√∞",sym2:"d",label:"Voiced TH vs D",example:"this / dis",category:"CONSONANTS"},{id:"s_sh",sym1:"s",sym2:" É",label:"S vs SH",example:"see / she",category:"CONSONANTS"},{id:"ch_j",sym1:"t É",sym2:"d í",label:"CH vs J",example:"cheap / jeep",category:"CONSONANTS"},{id:"f_v",sym1:"f",sym2:"v",label:"F vs V",example:"fan / van",category:"CONSONANTS"},{id:"b_p",sym1:"b",sym2:"p",label:"B vs P",example:"bat / pat",category:"CONSONANTS"},{id:"k_g",sym1:"k",sym2:"g",label:"K vs G",example:"coat / goat",category:"CONSONANTS"},{id:"s_z",sym1:"s",sym2:"z",label:"S vs Z",example:"rice / rise",category:"CONSONANTS"},{id:"t_d_ed",sym1:"t",sym2:"d",label:"Past tense -ed",example:"worked / played",category:"CONSONANTS"},{id:"ng_n",sym1:"≈ã",sym2:"n",label:"Final NG vs N",example:"sing / sin",category:"CONSONANTS"},{id:"r_l",sym1:"r",sym2:"l",label:"R vs L",example:"right / light",category:"CONSONANTS"},{id:"ay_ae",sym1:"e…™",sym2:"√¶",label:"Diphthong ay vs Short a",example:"face / fat",category:"DIPHTHONGS"},{id:"ai_ii",sym1:"a…™",sym2:"iÀê",label:"Diphthong ai vs Long ee",example:"time / team",category:"DIPHTHONGS"},{id:"oh_aw",sym1:"…ô ä",sym2:"…îÀê",label:"Diphthong oh vs aw",example:"go / saw",category:"DIPHTHONGS"},{id:"ear_ee",sym1:"…™…ô",sym2:"iÀê",label:"ear vs ee",example:"here / he",category:"DIPHTHONGS"},{id:"air_ae",sym1:"e…ô",sym2:"√¶",label:"air vs short a",example:"hair / hat",category:"DIPHTHONGS"}],is=({words:a,onComplete:p,onExit:z,onBulkUpdate:R})=>{const[k,P]=t.useState("SETUP"),[J,g]=t.useState("MASTER"),[Y,M]=t.useState(null),[$,O]=t.useState([]),[B,Q]=t.useState(0),[U,A]=t.useState(null),K=t.useRef(new Map),r=(b,S)=>{if(!b)return!1;(S==="t"||S==="d")&&(b.includes("t É")||b.includes("d í"));const u=S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let _;return S==="d"?_=new RegExp(`${u}(?! í)`):S==="t"?_=new RegExp(`${u}(?! É)`):S===" É"?_=new RegExp(`(?<!t)${u}`):S===" í"?_=new RegExp(`(?<!d)${u}`):S==="…™"?_=new RegExp(`(?<![ae…î])${u}(?!…ô)`):S===" ä"?_=new RegExp(`(?<![a…ô])${u}`):S==="e"?_=new RegExp(`${u}(?!…™|…ô)`):S==="…ô"?_=new RegExp(`(?<![…™ äe])${u}(?! ä)`):_=new RegExp(u),_.test(b)},x=t.useMemo(()=>{const b=new Map,S=a.filter(u=>u.ipaUs&&u.ipaUs.length>2);return Se.forEach(u=>{const _=S.filter(i=>r(i.ipaUs,u.sym1)||r(i.ipaUs,u.sym2)),w=_.length,C=_.filter(i=>{const s=`IPA_SORTER:${u.id}`;return i.lastTestResults&&i.lastTestResults[s]===!0}).length,l=_.filter(i=>{const s=`IPA_SORTER:${u.id}`;return!i.lastTestResults||i.lastTestResults[s]!==!0}).length;b.set(u.id,{total:w,correct:C,availableForMaster:l})}),b},[a]),E=b=>{let u=a.filter(C=>C.ipaUs&&C.ipaUs.length>2).filter(C=>r(C.ipaUs,b.sym1)||r(C.ipaUs,b.sym2));if(J==="MASTER"&&(u=u.filter(C=>{const l=`IPA_SORTER:${b.id}`;return!C.lastTestResults||C.lastTestResults[l]!==!0})),u.length<3){alert(`Not enough words found for this mode (${u.length}). Try 'Review All' or add more words.`);return}const _=[],w=u.sort(()=>Math.random()-.5).slice(0,15);for(const C of w){const l=r(C.ipaUs,b.sym1),i=r(C.ipaUs,b.sym2),s=l&&i?Math.random()>.5?b.sym1:b.sym2:l?b.sym1:b.sym2,o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let d;s==="d"?d=new RegExp(`${o}(?! í)`,"g"):s==="t"?d=new RegExp(`${o}(?! É)`,"g"):s===" É"?d=new RegExp(`(?<!t)${o}`,"g"):s===" í"?d=new RegExp(`(?<!d)${o}`,"g"):s==="…™"?d=new RegExp(`(?<![ae…î])${o}(?!…ô)`,"g"):s==="e"?d=new RegExp(`${o}(?!…™|…ô)`,"g"):d=new RegExp(o,"g");const m=C.ipaUs.replace(d,"___");_.push({id:C.id,wordObj:C,word:C.word,ipa:C.ipaUs,maskedIpa:m,targetSymbol:s})}O(_),M(b),Q(0),P("PLAYING")},T=b=>{const S=$[0];if(!S||U||!Y)return;const u=S.targetSymbol===b;A({symbol:b,correct:u});const _=u?B+10:Math.max(0,B-5);Q(_);const w=`IPA_SORTER:${Y.id}`,C={...S.wordObj};C.lastTestResults||(C.lastTestResults={}),C.lastTestResults[w]=u,C.updatedAt=Date.now(),K.current.set(C.id,C),setTimeout(()=>{const l=$.slice(1);O(l),A(null),l.length===0&&(R(Array.from(K.current.values())),K.current.clear(),p(_))},800)},H=()=>{K.current.size>0&&(R(Array.from(K.current.values())),K.current.clear()),k==="PLAYING"?P("SETUP"):z()};if(k==="SETUP"){const b=i=>{const s=x.get(i.id)||{total:0,correct:0,availableForMaster:0},o=s.total>=3,d=J==="ALL"?o:s.availableForMaster>=3,m=s.total>0?s.correct/s.total*100:0;let n="text-neutral-500 bg-neutral-100 border-neutral-200";return o?m>=80?n="text-emerald-700 bg-emerald-100 border-emerald-200":m>0?n="text-amber-700 bg-amber-100 border-amber-200":n="text-rose-700 bg-rose-100 border-rose-200":n="text-neutral-300 bg-neutral-50 border-neutral-100",e.jsxs("button",{onClick:()=>d&&E(i),disabled:!d,className:`
                        w-full flex flex-col gap-1 p-3 rounded-xl border transition-all text-left relative overflow-hidden group shrink-0
                        ${d?"bg-white border-neutral-100 hover:border-indigo-400 hover:bg-indigo-50/30 cursor-pointer shadow-sm":"bg-neutral-50 border-neutral-100 opacity-60 cursor-not-allowed"}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-black text-neutral-800 font-serif",children:["/",i.sym1,"/ vs /",i.sym2,"/"]}),!o&&e.jsx($t,{size:10,className:"text-neutral-400"})]}),o&&e.jsxs("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-full border ${n}`,children:[s.correct,"/",s.total]})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 font-medium truncate",children:i.example})]},i.id)},S=Se.filter(i=>i.category==="VOWELS"),u=Se.filter(i=>i.category==="DIPHTHONGS"),_=Se.filter(i=>i.category==="CONSONANTS"),w=Math.ceil(_.length/2),C=_.slice(0,w),l=_.slice(w);return e.jsxs("div",{className:"flex flex-col h-full relative p-6 bg-white animate-in fade-in",children:[e.jsxs("header",{className:"flex flex-col gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:H,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Back"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:"Phonetic Accuracy"}),e.jsx("p",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-widest",children:"Select a pair to practice"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 self-center",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>g("MASTER"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="MASTER"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(de,{size:10,fill:J==="MASTER"?"currentColor":"none"})," Master It"]}),e.jsxs("button",{onClick:()=>g("ALL"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="ALL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(He,{size:10})," Review All"]})]}),e.jsx("p",{className:"text-[9px] text-neutral-400 font-bold",children:J==="MASTER"?"Focus on unmastered words":"Practice with full library"})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-indigo-400 tracking-widest px-1 border-b border-neutral-100",children:"Vowels"}),e.jsx("div",{className:"flex flex-col gap-2",children:S.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:C.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100 md:text-transparent select-none",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:l.map(b)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-amber-400 tracking-widest px-1 border-b border-neutral-100",children:"Diphthongs"}),e.jsx("div",{className:"flex flex-col gap-2",children:u.map(b)})]})]})})]})}const W=$[0];return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 shrink-0",children:[e.jsxs("button",{onClick:H,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Pairs"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:B}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),Y&&e.jsx("div",{className:"text-center mb-6 animate-in slide-in-from-top-2",children:e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold border border-indigo-100",children:[Y.label," ",e.jsx("span",{className:"opacity-50 mx-1",children:"‚Ä¢"})," ",e.jsx("span",{className:"italic font-normal",children:Y.example})]})}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:W?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:W.word}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:W.maskedIpa.split("___").map((b,S,u)=>e.jsxs(We.Fragment,{children:[b,S<u.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},S))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Which sound fits?"})]}):e.jsxs("div",{className:"text-neutral-300 font-black text-xl flex flex-col items-center gap-2",children:[e.jsx(xe,{size:40,className:"text-green-500"}),e.jsx("span",{children:"Session Complete"})]})}),e.jsx("div",{className:"h-40 grid grid-cols-2 gap-6 mt-4 shrink-0 max-w-lg mx-auto w-full",children:[Y.sym1,Y.sym2].map((b,S)=>{const u=U&&U.symbol===b,_=u&&U.correct,w=u&&!U.correct;let C="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4 shadow-sm",l="text-neutral-400 group-hover:text-indigo-400";return _?(C+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600 ring-4 ring-emerald-100",l="text-emerald-500"):w?(C+=" bg-rose-50 border-solid border-rose-400 text-rose-600 ring-4 ring-rose-100",l="text-rose-500"):C+=" bg-white border-neutral-200 hover:border-indigo-400 hover:shadow-lg hover:-translate-y-1 active:scale-95",e.jsxs("button",{onClick:()=>T(b),disabled:!!U||!W,className:C,children:[e.jsxs("span",{className:"text-6xl font-serif font-medium mb-1",children:["/",b,"/"]}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${l}`,children:"Tap to Select"})]},S)})})]})]})},os=({words:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState("MEDIUM"),[g,Y]=t.useState(10),[M,$]=t.useState([]),[O,B]=t.useState([]),[Q,U]=t.useState(new Set),[A,K]=t.useState(null),[r,x]=t.useState(0),[E,T]=t.useState(0),H=(i,s)=>{const o=i.split(/\s+/).filter(Boolean);if(s==="HARD")return o;const d=[];let m=0;const n=s==="EASY"?3:2;for(;m<o.length;){const I=Math.floor(Math.random()*n)+1,Z=o.slice(m,m+I).join(" ");d.push(Z),m+=I}return d},W=()=>{const i=a.filter(d=>d.example&&d.example.trim().split(/\s+/).filter(Boolean).length>=5);if(i.length<5){alert("Not enough words with suitable example sentences (need at least 5).");return}const o=[...i].sort(()=>Math.random()-.5).slice(0,g).map(d=>{const m=d.example.trim(),I=[...H(m,P)].sort(()=>Math.random()-.5);return{id:d.id,word:d.word,originalSentence:m,shuffledChunks:I}});$(o),k("PLAYING"),x(0),b()},b=()=>{B([]),U(new Set),T(0),K(null)},S=M[0],u=(i,s)=>{if(A!==null)return;const o=[...O];o.splice(E,0,i),B(o),U(d=>new Set(d).add(s)),T(d=>d+1)},_=i=>{if(A!==null)return;const s=O[i],o=O.filter((n,I)=>I!==i);B(o),E>i&&T(n=>n-1);const d=S.shuffledChunks;let m=!1;U(n=>{const I=new Set(n);for(let Z=0;Z<d.length;Z++)d[Z]===s&&I.has(Z)&&!m&&(I.delete(Z),m=!0);return I})},w=()=>{const i=O.join(" ").toLowerCase().trim(),s=S.originalSentence.toLowerCase().trim();i===s?(K(!0),x(o=>o+(P==="HARD"?25:P==="MEDIUM"?15:10)),setTimeout(()=>{const o=M.slice(1);$(o),o.length===0?p(r+(P==="HARD"?25:15)):b()},1e3)):(K(!1),x(o=>Math.max(0,o-5)),setTimeout(()=>K(null),1500))},C=()=>{const i=M.slice(1);$(i),i.length===0?p(r):b()},l=({index:i})=>{const s=i===E;return e.jsx("div",{onClick:()=>T(i),className:`h-8 w-2 rounded-full cursor-pointer transition-all duration-200 mx-0.5 flex items-center justify-center ${s?"bg-indigo-500 scale-110 shadow-sm":"bg-transparent hover:bg-neutral-200"}`,children:e.jsx("div",{className:`w-1 h-4 rounded-full ${s?"bg-white/50":"bg-transparent"}`})})};if(R==="SETUP"){const i=({id:s,label:o,icon:d,desc:m})=>e.jsxs("button",{onClick:()=>J(s),className:`p-4 rounded-2xl border-2 transition-all text-left flex flex-col gap-2 ${P===s?"border-emerald-500 bg-emerald-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${P===s?"bg-emerald-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(d,{size:16})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${P===s?"text-emerald-700":"text-neutral-500"}`,children:o})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:m})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in max-w-5xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(yt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Sentence Scramble"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Reconstruct examples to master syntax and flow."})]}),e.jsx("div",{className:"w-full max-w-sm space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(i,{id:"EASY",label:"Easy",icon:He,desc:"Chunks of 1-3 words. Great for collocations."}),e.jsx(i,{id:"MEDIUM",label:"Medium",icon:de,desc:"Chunks of 1-2 words. More challenging."}),e.jsx(i,{id:"HARD",label:"Hard",icon:Ge,desc:"Individual words only. True mastery."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-emerald-600",children:g})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:g,onChange:s=>Y(parseInt(s.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Back"}),e.jsxs("button",{onClick:W,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(ue,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Scramble ‚Ä¢ ",P]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${(1-M.length/g)*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:r})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:S?e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300 decoration-2 underline-offset-4",children:S.word})]}),e.jsx("button",{onClick:()=>ge(S.originalSentence),className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl hover:bg-emerald-100 transition-all active:scale-90",title:"Hear full sentence",children:e.jsx(Ue,{size:24})})]}),e.jsx("p",{className:"text-neutral-400 text-xs font-bold uppercase tracking-widest",children:"Tap chunks to insert at cursor"})]}),e.jsx("div",{className:`w-full max-w-3xl bg-neutral-50 rounded-[2.5rem] border-2 border-dashed p-8 transition-all ${A===!0?"border-emerald-400 bg-emerald-50":A===!1?"border-rose-400 bg-rose-50 animate-shake":"border-neutral-200"}`,children:e.jsxs("div",{className:"flex flex-wrap gap-y-3 items-center justify-center min-h-[60px]",children:[O.length===0&&e.jsx("span",{className:"absolute text-lg font-bold text-neutral-300 italic pointer-events-none",children:"Draft your sentence here..."}),e.jsx(l,{index:0}),O.map((i,s)=>e.jsxs(We.Fragment,{children:[e.jsx("button",{onClick:()=>_(s),className:`px-4 py-2 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 animate-in zoom-in-95 flex items-center gap-1 group ${A===!0?"bg-emerald-600 text-white":A===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-red-200 hover:text-red-500"}`,children:i}),e.jsx(l,{index:s+1})]},`${i}-${s}`))]})}),e.jsx("div",{className:"w-full max-w-3xl bg-neutral-100 rounded-[2.5rem] p-8 flex flex-wrap gap-3 justify-center",children:S.shuffledChunks.map((i,s)=>e.jsx("button",{onClick:()=>u(i,s),disabled:Q.has(s),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${Q.has(s)?"bg-neutral-200 text-neutral-400 cursor-not-allowed opacity-30":"bg-white text-neutral-700 border-2 border-white hover:border-emerald-300 hover:text-neutral-900"}`,children:i},s))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:C,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsxs("button",{onClick:w,disabled:O.length===0||A!==null,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(we,{size:18})," Check"]})]}),A===!1&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 p-4 bg-emerald-50 rounded-2xl border border-emerald-100 text-center max-w-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Original Sentence"}),e.jsxs("p",{className:"text-sm font-bold text-emerald-900 italic",children:['`"`',S.originalSentence,'`"`']})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Preparing..."})})]})},cs=["in","on","at","to","for","with","of","from","by","about","into","through","over","under","between","among","against","during","without","before","after","toward","upon","within","along"].sort(),ds=({words:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState(10),[g,Y]=t.useState([]),[M,$]=t.useState(0),[O,B]=t.useState(""),[Q,U]=t.useState(null),[A,K]=t.useState(0),[r,x]=t.useState([]),[E,T]=t.useState(0),[H,W]=t.useState(!1),b=t.useRef(null),S=t.useRef(null),u=()=>{const s=a.filter(m=>m.prepositions&&m.prepositions.some(n=>!n.isIgnored)&&m.example);if(s.length<3){alert("Not enough vocabulary with prepositions and examples found in your library.");return}const o=[...s].sort(()=>Math.random()-.5),d=[];for(const m of o){if(d.length>=P)break;const I=[...m.prepositions.filter(Z=>!Z.isIgnored)].sort(()=>Math.random()-.5);for(const Z of I){const c=m.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`\\b${c}\\s+${Z.prep}\\b`,"i");if(L.test(m.example)){const v=m.example.split(".")[0]+".";if(L.test(v)){const V=v.replace(L,`${m.word} ___`);d.push({id:`${m.id}-${Z.prep}`,word:m.word,example:V,answer:Z.prep.toLowerCase(),meaning:m.meaningVi});break}}}}if(d.length<1){alert("Could not generate questions from existing data.");return}Y(d),k("PLAYING"),$(0),K(0),B(""),U(null)},_=g[M];useEffect(()=>{R==="PLAYING"&&b.current&&b.current.focus()},[M,R]);const w=s=>{if(!_||Q===!0)return;const d=(s!==void 0?s:O).trim().toLowerCase()===_.answer;U(d),W(!1),d?(K(m=>m+15),setTimeout(()=>{M<g.length-1?($(m=>m+1),B(""),U(null)):p(A+15)},800)):(K(m=>Math.max(0,m-5)),setTimeout(()=>U(null),800))},C=s=>{if(B(s),s.trim()){const o=cs.filter(d=>d.startsWith(s.toLowerCase())&&d!==s.toLowerCase());x(o),T(0),W(o.length>0)}else W(!1)},l=s=>{if(!H){s.key==="Enter"&&w();return}switch(s.key){case"ArrowDown":s.preventDefault(),T(o=>(o+1)%r.length);break;case"ArrowUp":s.preventDefault(),T(o=>(o-1+r.length)%r.length);break;case"Enter":case"Tab":{s.preventDefault();const o=r[E];B(o),W(!1),w(o);break}case"Escape":W(!1);break}};if(R==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 text-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(de,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Preposition Power"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Master dependent prepositions in IELTS contexts with smart suggestions."})]}),e.jsx("div",{className:"w-full max-w-sm bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-violet-600",children:P})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:P,onChange:s=>J(parseInt(s.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-violet-500"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:u,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(ue,{size:18,fill:"white"})," Start Practice"]})]})]});const i=M/g.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-8 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-10 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Exit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Question ",M+1," / ",g.length]}),e.jsx("div",{className:"h-1.5 w-40 bg-neutral-100 rounded-full mt-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-500",style:{width:`${i}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest min-w-[80px] text-center",children:A})]}),e.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center space-y-12 max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:`w-full bg-neutral-50 border-2 rounded-[3rem] p-10 md:p-16 text-center space-y-8 transition-all duration-300 ${Q===!0?"border-emerald-400 bg-emerald-50/30":Q===!1?"border-rose-400 bg-rose-50/30 animate-shake":"border-neutral-100 shadow-sm"}`,children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("span",{className:"px-3 py-1 bg-violet-100 text-violet-700 rounded-lg text-[10px] font-black uppercase tracking-widest border border-violet-200",children:"Fill Blank"})})}),e.jsx("div",{className:"text-xl md:text-2xl font-medium text-neutral-700 leading-relaxed min-h-[4rem]",children:_.example.split("___").map((s,o,d)=>e.jsxs(We.Fragment,{children:[e.jsx("span",{children:s}),o<d.length-1&&e.jsxs("div",{className:"inline-block mx-2 relative",children:[e.jsx("input",{ref:b,type:"text",value:O,onChange:m=>C(m.target.value),onKeyDown:l,disabled:Q===!0,placeholder:"...",className:`
                                                w-[5ch] min-w-[100px] text-center bg-transparent border-b-4 outline-none font-black transition-all
                                                ${Q===!0?"border-emerald-500 text-emerald-600":Q===!1?"border-rose-500 text-rose-600":"border-neutral-300 focus:border-violet-600 text-neutral-900"}
                                            `,autoComplete:"off"}),Q===!0&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 animate-bounce text-emerald-500",children:e.jsx(we,{size:20,strokeWidth:4})}),H&&e.jsx("div",{ref:S,className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 w-32 bg-white rounded-2xl shadow-2xl border border-neutral-100 z-50 overflow-hidden animate-in fade-in zoom-in-95",children:r.map((m,n)=>e.jsx("button",{onClick:()=>{B(m),W(!1),w(m)},className:`w-full px-4 py-2.5 text-sm font-bold text-left transition-colors ${E===n?"bg-violet-500 text-white":"text-neutral-600 hover:bg-neutral-50"}`,children:m},m))})]})]},o))})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsxs("button",{onClick:()=>{M<g.length-1?($(s=>s+1),B(""),U(null)):p(A)},className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all flex items-center gap-2",children:["Skip ",e.jsx($e,{size:18})]}),e.jsx("button",{onClick:()=>w(),disabled:O.trim().length===0||Q===!0,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-30 flex items-center gap-2",children:"Check Answer"})]})]}),e.jsxs("footer",{className:"mt-auto pt-8 flex items-center justify-between text-[10px] font-black uppercase text-neutral-300 tracking-widest border-t border-neutral-50",children:[e.jsx("span",{children:"IELTS VOCAB PRO ‚Ä¢ PREPOSITION POWER"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{size:12}),e.jsx("span",{children:"Type to see autocomplete suggestions"})]}),e.jsxs("span",{children:["LEVEL ",M+1]})]})]})},xs=({words:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState("MIX"),[g,Y]=t.useState("MEDIUM"),[M,$]=t.useState(8),[O,B]=t.useState([]),[Q,U]=t.useState([]),[A,K]=t.useState(null),[r,x]=t.useState(null),[E,T]=t.useState(0);t.useRef({});const H=()=>{const l=[];if(a.forEach(n=>{(P==="PARAPHRASE"||P==="MIX")&&(n.paraphrases||[]).filter(I=>!I.isIgnored&&I.context&&I.context.trim()).forEach(I=>{l.push({context:I.context,fullText:I.word,headword:n.word,pairId:`${n.id}-p-${I.word}`})}),(P==="COLLOCATION"||P==="MIX")&&(n.collocationsArray||[]).filter(I=>!I.isIgnored&&I.d&&I.d.trim()).forEach(I=>{l.push({context:I.d,fullText:I.text,headword:n.word,pairId:`${n.id}-c-${I.text}`})}),(P==="IDIOM"||P==="MIX")&&(n.idiomsList||[]).filter(I=>!I.isIgnored&&I.d&&I.d.trim()).forEach(I=>{l.push({context:I.d,fullText:I.text,headword:n.word,pairId:`${n.id}-i-${I.text}`})})}),l.length<5){alert("Not enough items found. Add more variations or idioms to your library.");return}const i=Math.min(l.length,M),s=[...l].sort(()=>.5-Math.random()).slice(0,i),o=s.map(n=>{const I=n.fullText.split(/\s+/);if(I.length>1){const Z=I.findIndex(L=>L.toLowerCase().includes(n.headword.toLowerCase())),c=Z===-1?0:Z===0?I.length-1:0;return I[c].replace(/[^a-zA-Z]/g,"")}return n.fullText}),d=[],m=[];s.forEach((n,I)=>{let Z=n.fullText,c=n.fullText,L=!1;const v=n.fullText.split(/\s+/);if(v.length>1){const D=v.findIndex(h=>h.toLowerCase().includes(n.headword.toLowerCase())),G=D===-1?0:D===0?v.length-1:0;c=v[G].replace(/[^a-zA-Z]/g,""),Z=v.map((h,N)=>N===G?"___":h).join(" ")}else c=n.fullText,Z=n.fullText,L=!0;const V=o.filter((D,G)=>G!==I&&D.toLowerCase()!==c.toLowerCase()),y=[c,...Array.from(new Set(V))].sort(()=>.5-Math.random()).slice(0,5);y.includes(c)||(y[Math.floor(Math.random()*y.length)]=c);const j={text:Z,fullText:n.fullText,headword:n.headword,context:n.context,partnerWord:c,choices:y,pairId:n.pairId};d.push({...j,id:`ctx-${n.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1}),m.push({...j,id:`itm-${n.pairId}`,isLinked:!1,isFilled:L,isSelected:!1,isDone:!1,error:!1})}),B(d),U(m.sort(()=>.5-Math.random())),T(0),K(null),x(null),k("PLAYING")},W=(l,i,s)=>{const o=i.find(m=>m.pairId===l),d=s.find(m=>m.pairId===l);o!=null&&o.isLinked&&(d!=null&&d.isFilled)&&(o.isDone=!0,d.isDone=!0,T(n=>n+(g==="HARD"?25:g==="MEDIUM"?15:10)),i.every(n=>n.isDone)&&setTimeout(()=>p(E+25),1e3))},b=(l,i)=>{const s=O.find(d=>d.id===l),o=Q.find(d=>d.id===i);if(!(!s||!o))if(s.pairId===o.pairId){const d=O.map(n=>n.id===l?{...n,isLinked:!0,isSelected:!1}:n),m=Q.map(n=>n.id===i?{...n,isLinked:!0,isSelected:!1}:n);B(d),U(m),K(null),x(null),W(s.pairId,d,m)}else B(d=>d.map(m=>m.id===l?{...m,error:!0}:m)),U(d=>d.map(m=>m.id===i?{...m,error:!0}:m)),T(d=>Math.max(0,d-5)),setTimeout(()=>{B(d=>d.map(m=>({...m,error:!1,isSelected:!1}))),U(d=>d.map(m=>({...m,error:!1,isSelected:!1}))),K(null),x(null)},600)},S=l=>{const i=O.find(s=>s.id===l);!i||i.isDone||(r?b(l,r):(K(l===A?null:l),B(s=>s.map(o=>({...o,isSelected:o.id===l?!o.isSelected:!1})))))},u=l=>{const i=Q.find(s=>s.id===l);!i||i.isDone||(A?b(A,l):(x(l===r?null:l),U(s=>s.map(o=>({...o,isSelected:o.id===l?!o.isSelected:!1})))))},_=(l,i)=>{const s=Q.find(d=>d.pairId===l);if(!s||s.isDone)return;if(i.trim().toLowerCase()===s.partnerWord.toLowerCase()){const d=Q.map(n=>n.pairId===l?{...n,isFilled:!0,text:n.fullText}:n),m=[...O];U(d),W(l,m,d)}else i.trim().length>0&&!s.choices.includes(i)&&(U(d=>d.map(m=>m.pairId===l?{...m,error:!0}:m)),setTimeout(()=>U(d=>d.map(m=>({...m,error:!1}))),600))},w=l=>l.isDone?"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default shadow-none":l.error?"bg-red-50 border-red-500 text-red-700 animate-shake":l.isSelected?"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-[1.02]":l.isLinked?"bg-indigo-50 border-indigo-300 text-indigo-900 shadow-sm":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-400 hover:bg-neutral-50 cursor-pointer shadow-sm";if(R==="SETUP"){const l=({type:s,label:o,icon:d})=>e.jsxs("button",{onClick:()=>J(s),className:`flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all min-w-[70px] ${P===s?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-300"}`,children:[e.jsx(d,{size:20,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:o})]}),i=({level:s,label:o,desc:d})=>e.jsxs("button",{onClick:()=>Y(s),className:`flex flex-col items-start p-4 rounded-2xl border-2 transition-all text-left group ${g===s?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${g===s?"text-indigo-700":"text-neutral-400"}`,children:o}),g===s&&e.jsx(we,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 leading-tight",children:d})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center text-center space-y-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(de,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Context Match Setup"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm mx-auto",children:"Link meanings and fill the blanks."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[e.jsx(l,{type:"PARAPHRASE",label:"Paraphrase",icon:de}),e.jsx(l,{type:"COLLOCATION",label:"Collocation",icon:dt}),e.jsx(l,{type:"IDIOM",label:"Idiom",icon:kt}),e.jsx(l,{type:"MIX",label:"Mix All",icon:He})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Items"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:M})]}),e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:M,onChange:s=>$(parseInt(s.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-3",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(i,{level:"EASY",label:"Easy",desc:"Match definitions to phrases. No typing required."}),e.jsx(i,{level:"MEDIUM",label:"Medium",desc:"Match meanings and select the missing word from a dropdown."}),e.jsx(i,{level:"HARD",label:"Hard",desc:"Match meanings and type the missing word from memory."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md mb-auto",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:H,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(ue,{size:18,fill:"white"})," Start"]})]})]})}const C=O.filter(l=>l.isDone).length/O.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Context Match ‚Ä¢ ",g]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:`${C}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 no-scrollbar pb-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," Definition & Headword"]}),O.map(l=>e.jsxs("button",{onClick:()=>S(l.id),className:`relative w-full p-5 rounded-[2rem] border-2 text-left transition-all duration-200 flex flex-col gap-2 ${w(l)}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-black tracking-tight ${l.isSelected?"text-white":"text-indigo-600"}`,children:l.headword}),e.jsxs("div",{className:"flex gap-2",children:[l.isLinked&&e.jsx(tt,{size:16,className:l.isSelected?"text-white":"text-indigo-400"}),l.isDone&&e.jsx(xe,{size:18,className:"text-emerald-500"})]})]}),e.jsx("p",{className:`font-medium text-sm leading-relaxed ${l.isSelected?"text-indigo-100":"text-neutral-600"}`,children:l.context})]},l.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:12})," Target Phrase"]}),Q.map(l=>e.jsxs("div",{onClick:()=>u(l.id),className:`relative w-full p-6 rounded-[2rem] border-2 text-left transition-all duration-200 ${w(l)}`,children:[e.jsx("div",{className:`text-lg font-bold flex flex-wrap items-center gap-x-2 leading-relaxed ${l.isSelected?"text-white":"text-neutral-900"}`,children:l.text.split(" ").map((i,s)=>i!=="___"?e.jsx("span",{children:i},s):g==="MEDIUM"?e.jsxs("div",{className:"inline-flex items-center gap-1 bg-white border-2 border-indigo-200 rounded-xl px-2 py-1 shadow-sm",onClick:o=>o.stopPropagation(),children:[e.jsxs("select",{disabled:l.isDone,className:`appearance-none bg-transparent text-sm font-black outline-none pr-6 relative ${l.isFilled?"text-emerald-600":"text-indigo-700"}`,onChange:o=>_(l.pairId,o.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),l.choices.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx(Be,{size:14,className:"text-indigo-400 pointer-events-none -ml-5"})]},s):g==="HARD"?e.jsx("input",{type:"text",disabled:l.isDone,onClick:o=>o.stopPropagation(),className:`w-32 px-3 py-1 bg-white border-2 rounded-xl text-sm font-black outline-none transition-all ${l.isFilled?"border-emerald-500 text-emerald-600":"border-indigo-200 text-indigo-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"}`,placeholder:"...",onKeyDown:o=>{o.key==="Enter"&&_(l.pairId,o.currentTarget.value)}},s):e.jsx("span",{className:"text-neutral-300 font-black",children:"_____"},s))}),e.jsxs("div",{className:"absolute top-4 right-6 flex gap-2",children:[l.isLinked&&e.jsx(tt,{size:16,className:l.isSelected?"text-white":"text-indigo-400"}),l.isDone&&e.jsx(xe,{size:18,className:"text-emerald-500"})]})]},l.id))]})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsxs("button",{onClick:()=>k("SETUP"),className:"flex items-center gap-2 text-xs font-black uppercase tracking-widest text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(nt,{size:14})," Restart"]})})]})]})},Ce=10,st=50;function ye(a){const p=[...a];for(let z=p.length-1;z>0;z--){const R=Math.floor(Math.random()*(z+1));[p[z],p[R]]=[p[R],p[z]]}return p}const us=({words:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState("MATRIX"),[g,Y]=t.useState(12),[M,$]=t.useState({library:!0,collocations:!0,idioms:!0}),[O,B]=t.useState([]),[Q,U]=t.useState([]),[A,K]=t.useState([]),[r,x]=t.useState([]),[E,T]=t.useState(0),[H,W]=t.useState(0),[b,S]=t.useState(new Set),[u,_]=t.useState(null),[w,C]=t.useState(null),l=t.useMemo(()=>r.map((c,L)=>({...c,originalIndex:L})).filter(c=>!b.has(c.id)),[r,b]);t.useEffect(()=>{if(R!=="PLAYING")return;const c=[];if(a.forEach(G=>{M.library&&G.meaningVi&&G.meaningVi.trim()&&c.push({text:G.word,d:G.meaningVi,cueId:`cue-${G.id}-word`}),M.collocations&&(G.collocationsArray||[]).filter(N=>!N.isIgnored&&N.d&&N.d.trim()).forEach((N,f)=>{c.push({text:N.text,d:N.d,cueId:`cue-${G.id}-col-${f}`})}),M.idioms&&(G.idiomsList||[]).filter(N=>!N.isIgnored&&N.d&&N.d.trim()).forEach((N,f)=>{c.push({text:N.text,d:N.d,cueId:`cue-${G.id}-idm-${f}`})})}),c.length<Ce){alert(`Not enough items found (found ${c.length}, need min ${Ce}).`),k("SETUP");return}const v=ye(c).slice(0,g),V=[],y=[],j=[],D=[];v.forEach(G=>{const h=G.cueId;V.push({id:h,text:G.d}),y.push({id:`card-${h}`,text:G.text,cueId:h,pairId:h,state:"default",type:"word"}),j.push({id:`l-${h}`,text:G.text,cueId:h,pairId:h,state:"default",type:"word"}),D.push({id:`r-${h}`,text:G.d,cueId:h,pairId:h,state:"default",type:"meaning"})}),B(ye(y)),U(ye(j)),K(ye(D)),x(ye(V)),T(0),W(0),S(new Set),_(null),C(null)},[R,g,a,M]),t.useEffect(()=>{R==="PLAYING"&&g>0&&b.size===g&&setTimeout(()=>p(H),800)},[R,b,g,H,p]);const i=c=>{const L=r[E];!L||b.has(L.id)||c.state!=="default"||(c.cueId===L.id?(W(v=>v+10),B(v=>v.map(V=>V.id===c.id?{...V,state:"correct"}:V)),U(v=>v.map(V=>V.pairId===c.pairId?{...V,state:"correct"}:V)),K(v=>v.map(V=>V.pairId===c.pairId?{...V,state:"correct"}:V)),setTimeout(()=>{const v=new Set(b).add(L.id);S(v);let V=-1;for(let y=E+1;y<r.length;y++)if(!v.has(r[y].id)){V=y;break}if(V===-1){for(let y=0;y<E;y++)if(!v.has(r[y].id)){V=y;break}}V!==-1&&T(V)},400)):(W(v=>Math.max(0,v-5)),B(v=>v.map(V=>V.id===c.id?{...V,state:"incorrect"}:V)),setTimeout(()=>{B(v=>v.map(V=>V.id===c.id?{...V,state:"default"}:V))},600)))},s=c=>{c.state==="correct"||c.state==="incorrect"||(c.type==="word"?w?o(c.id,w):_(c.id===u?null:c.id):u?o(u,c.id):C(c.id===w?null:c.id))},o=(c,L)=>{const v=Q.find(y=>y.id===c),V=A.find(y=>y.id===L);if(v&&V&&v.pairId===V.pairId){W(j=>j+10);const y=new Set(b).add(v.pairId);S(y),U(j=>j.map(D=>D.id===c?{...D,state:"correct"}:D)),K(j=>j.map(D=>D.id===L?{...D,state:"correct"}:D)),B(j=>j.map(D=>D.pairId===v.pairId?{...D,state:"correct"}:D)),_(null),C(null)}else W(y=>Math.max(0,y-5)),U(y=>y.map(j=>j.id===c?{...j,state:"incorrect"}:j)),K(y=>y.map(j=>j.id===L?{...j,state:"incorrect"}:j)),setTimeout(()=>{U(y=>y.map(j=>({...j,state:j.state==="incorrect"?"default":j.state}))),K(y=>y.map(j=>({...j,state:j.state==="incorrect"?"default":j.state}))),_(null),C(null)},600)},d=()=>{const c=l.findIndex(L=>L.originalIndex===E);if(c>0){const L=l[c-1];T(L.originalIndex)}},m=()=>{const c=l.findIndex(L=>L.originalIndex===E);if(c<l.length-1){const L=l[c+1];T(L.originalIndex)}},n=r[E],I=l.findIndex(c=>c.originalIndex===E);if(R==="SETUP"){const c=({label:v,checked:V,onChange:y})=>e.jsxs("label",{className:"flex items-center gap-3 p-4 rounded-2xl bg-neutral-50 border-2 border-transparent hover:border-fuchsia-100 cursor-pointer transition-all",onClick:y,children:[V?e.jsx(Ut,{size:20,className:"text-fuchsia-600"}):e.jsx(It,{size:20,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-sm text-neutral-800",children:v})]}),L=M.library||M.collocations||M.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-fuchsia-100 text-fuchsia-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(nt,{size:32})}),e.jsx("h2",{className:"text-4xl font-black text-neutral-900 tracking-tight",children:"Word Scatter"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Match hidden words to their definitions in a structured matrix or column match."})]}),e.jsx("div",{className:"w-full max-w-md space-y-6",children:e.jsxs("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:["Items: ",e.jsx("span",{className:"text-xl font-black text-fuchsia-600",children:g})]}),e.jsx("input",{id:"sessionSize",type:"range",min:Ce,max:st,value:g,onChange:v=>Y(parseInt(v.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-full appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-[10px] font-black text-neutral-300 uppercase px-1",children:[e.jsx("span",{children:Ce}),e.jsx("span",{children:st})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:"Content Sources"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(c,{label:"Library Definitions",checked:M.library,onChange:()=>$(v=>({...v,library:!v.library}))}),e.jsx(c,{label:"Collocations",checked:M.collocations,onChange:()=>$(v=>({...v,collocations:!v.collocations}))}),e.jsx(c,{label:"Idioms",checked:M.idioms,onChange:()=>$(v=>({...v,idioms:!v.idioms}))})]})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:()=>k("PLAYING"),disabled:!L,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",children:[e.jsx(ue,{size:18,fill:"white"})," Start"]})]})]})}const Z=b.size/g*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>p(H),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Finish"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>J("MATRIX"),className:`p-2 rounded-lg transition-all ${P==="MATRIX"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Matrix View",children:e.jsx(Ht,{size:18})}),e.jsx("button",{onClick:()=>J("MATCH"),className:`p-2 rounded-lg transition-all ${P==="MATCH"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Match View",children:e.jsx(Wt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:"Progress"}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-500 transition-all duration-300",style:{width:`${Z}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:H})]}),P==="MATRIX"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shrink-0 mb-6 py-6 px-8 bg-neutral-50 border border-neutral-200 rounded-[2rem] shadow-sm relative overflow-hidden flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:d,disabled:I<=0,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(ct,{size:24})}),e.jsx("div",{className:"text-center flex-1 px-10",children:n?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-fuchsia-500 tracking-widest flex items-center justify-center gap-1.5 mb-2",children:[e.jsx(St,{size:12})," Find the term for:"]}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-neutral-800 leading-tight",children:n.text})]}):e.jsx("p",{className:"text-center font-black text-emerald-600 text-xl animate-bounce",children:"CLEARED!"})}),e.jsx("button",{onClick:m,disabled:I>=l.length-1,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx($e,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-6",children:e.jsx("div",{className:`grid gap-3 ${g<=12?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":g<=24?"grid-cols-3 md:grid-cols-4 lg:grid-cols-6":"grid-cols-4 md:grid-cols-6 lg:grid-cols-8"}`,children:O.map(c=>{const L=c.state==="correct",v=c.state==="incorrect";return e.jsxs("button",{onClick:()=>i(c),disabled:L,className:`
                                            relative h-16 px-2 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center text-center shadow-sm font-bold text-xs leading-tight
                                            ${L?"bg-emerald-500 border-emerald-500 text-white scale-90 opacity-0 pointer-events-none":v?"bg-rose-50 border-rose-500 text-rose-600 animate-shake":"bg-white border-neutral-100 text-neutral-700 hover:border-fuchsia-300 hover:text-neutral-900 hover:-translate-y-0.5 active:scale-95"}
                                        `,children:[e.jsx("span",{className:"line-clamp-2",children:c.text}),L&&e.jsx(we,{size:20,className:"absolute inset-auto animate-ping"})]},c.id)})})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," English"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Q.map(c=>{const L=u===c.id,v=c.state==="correct",V=c.state==="incorrect";if(v)return e.jsx("div",{className:"h-16 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(xe,{size:32})},c.id);let y="bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-300 hover:-translate-y-0.5";return L&&(y="bg-fuchsia-600 border-fuchsia-600 text-white shadow-lg ring-4 ring-fuchsia-100 scale-105"),V&&(y="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>s(c),className:`h-16 px-4 rounded-xl border-b-4 font-bold text-sm transition-all duration-200 flex items-center justify-center text-center leading-tight shadow-sm ${y}`,children:c.text},c.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(Ct,{size:12})," Meaning"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:A.map(c=>{const L=w===c.id,v=c.state==="correct",V=c.state==="incorrect";if(v)return e.jsx("div",{className:"h-20 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(xe,{size:32})},c.id);let y="bg-white border-neutral-200 text-neutral-700 hover:border-indigo-300 hover:-translate-y-0.5";return L&&(y="bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-105"),V&&(y="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>s(c),className:`min-h-20 px-4 py-3 rounded-xl border-b-4 font-medium text-xs transition-all duration-200 flex items-center justify-center text-center leading-relaxed shadow-sm ${y}`,children:c.text},c.id)})})]})]})}),e.jsxs("footer",{className:"shrink-0 mt-2 flex items-center justify-between text-[10px] font-black uppercase text-neutral-400 tracking-widest px-4 border-t border-neutral-100 pt-4",children:[e.jsxs("span",{children:["Total Items: ",g]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Matched"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-neutral-200"})," Hidden"]})]}),e.jsxs("span",{children:["Completed: ",b.size]})]})]})},be=a=>a.toLowerCase().replace(/[^a-z0-9]/g,""),Fe=a=>a.replace(/(\d{1,2}:\d{2}(?::\d{2})?)|(\b\d{4}\b)|(\d+)/g,(p,z,R,k)=>z?z.replace(/:/g," "):R?`${R.slice(0,2)} ${R.slice(2)}`:k?k.split("").join(" "):p),ms=({words:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState(10),[g,Y]=t.useState("EASY"),[M,$]=t.useState("LIBRARY"),[O,B]=t.useState(!1),[Q,U]=t.useState([]),[A,K]=t.useState(()=>{const f=qe("dictation_selected_voices",["System"]);return new Set(f)}),[r,x]=t.useState(()=>qe("dictation_hover_preview",!0)),[E,T]=t.useState([]),[H,W]=t.useState(0),[b,S]=t.useState(0),[u,_]=t.useState({}),[w,C]=t.useState(""),[l,i]=t.useState(!1),[s,o]=t.useState(!1),d=t.useRef(null),{showToast:m}=pe();t.useEffect(()=>{Xe("dictation_selected_voices",Array.from(A))},[A]),t.useEffect(()=>{Xe("dictation_hover_preview",r)},[r]),t.useEffect(()=>((async()=>{const F=Ze(),q=Je(F);try{const X=await Rt(q);if(X&&X.voices){const te=X.voices.filter(ee=>ee.language==="en"&&(ee.name.includes("Premium")||ee.name.includes("Enhanced")));U(te)}}catch(X){console.warn("Could not load server voices",X)}})(),()=>{ze()}),[]),t.useEffect(()=>{M==="SERVER"&&Y("HARD")},[M]);const n=async f=>{const F=Ze(),q=Je(F),X="Dictation";try{const te=await fetch(`${q}/api/reading/files/${X}`);if(!te.ok)throw new Error("Could not access 'Dictation' folder on server.");const se=((await te.json()).items||[]).filter(ae=>ae.type==="file"&&!ae.name.startsWith("."));if(se.length===0)throw new Error("No files found in 'Dictation' folder.");const ce=se.sort(()=>Math.random()-.5).slice(0,5),re=[];if(await Promise.all(ce.map(async ae=>{try{const le=ae.name,me=await fetch(`${q}/api/reading/content/${X}/${encodeURIComponent(le)}`);if(me.ok){const Qe=(await me.json()).essay||"";if(Qe){const ft=Qe.split(/\r?\n/).map(Ae=>Ae.trim()).filter(Ae=>Ae.length>0);re.push(...ft)}}}catch(le){console.warn(`Failed to read file ${ae.name}`,le)}})),re.length===0)throw new Error("No valid text lines found.");return re.sort(()=>Math.random()-.5).slice(0,f)}catch(te){return m(te.message||"Server Error","error"),[]}},I=()=>{const f=Array.from(A);if(f.length===0)return;const F=f[Math.floor(Math.random()*f.length)];return F==="System"?void 0:F},Z=async()=>{let f=[];if(M==="SERVER"){if(B(!0),f=await n(P),B(!1),f.length===0)return}else{const q=a.filter(X=>X.example&&X.example.trim().split(/\s+/).length>=4);if(q.length===0){m("No suitable example sentences found in Library.","error");return}f=[...q].sort(()=>Math.random()-.5).slice(0,P).map(X=>X.example.trim())}const F=f.map((q,X)=>{const te=q.replace(/\s+/g," ").trim(),ee=te.split(" "),se=new Set;if(g==="EASY"){ee.forEach((le,me)=>{/\d/.test(le)&&se.add(me)});const re=Math.max(1,Math.floor(ee.length*.4));let ae=0;for(;se.size<re&&ae<100;){ae++;const le=Math.floor(Math.random()*ee.length);!se.has(le)&&/[a-zA-Z0-9]/.test(ee[le])&&se.add(le)}}const oe=ee.map((re,ae)=>{const le=g==="EASY"&&se.has(ae);return{text:re,isMasked:le}}),ce=I();return{id:`dict-${X}-${Date.now()}`,originalSentence:te,tokenized:oe,mode:g,voice:ce}});T(F),k("PLAYING"),W(0),S(0),_({}),C(""),i(!1),o(!1),setTimeout(()=>{const q=F[0];ge(Fe(q.originalSentence),!1,"en",q.voice)},600)},c=E[H];t.useEffect(()=>{R==="PLAYING"&&!l&&setTimeout(()=>{var f;return(f=d.current)==null?void 0:f.focus()},150)},[H,R,l]);const L=()=>{c&&ge(Fe(c.originalSentence),!1,"en",c.voice)},v=()=>{j()},V=()=>{ze(),z()},y=()=>{if(l)return;let f=!0;if(c.mode==="HARD"?f=be(w)===be(c.originalSentence):c.tokenized.forEach((F,q)=>{if(F.isMasked){const X=F.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");be(u[q]||"")!==be(X)&&(f=!1)}}),o(f),i(!0),f){const F=c.mode==="HARD"?25:15;S(q=>q+F)}},j=()=>{if(H<E.length-1){W(F=>F+1),_({}),C(""),i(!1),o(!1);const f=E[H+1];setTimeout(()=>{ge(Fe(f.originalSentence),!1,"en",f.voice)},500)}else p(b)},D=f=>{K(F=>{const q=new Set(F);return q.has(f)?q.size>1&&q.delete(f):q.add(f),q})},G=f=>{if(!r)return;ze(),ge("Voice preview.",!1,"en",f==="System"?void 0:f)},h=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-5 justify-center items-center leading-relaxed",children:c.tokenized.map((f,F)=>{if(!f.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:f.text},F);const q=u[F]||"",X=f.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),te=l&&be(q)===be(X);return e.jsxs("div",{className:"relative inline-flex flex-col items-center",children:[e.jsx("input",{ref:F===c.tokenized.findIndex(ee=>ee.isMasked)?d:null,type:"text",value:q,disabled:l,onChange:ee=>_(se=>({...se,[F]:ee.target.value})),onKeyDown:ee=>ee.key==="Enter"&&y(),className:`w-28 text-center px-2 py-1.5 rounded-lg border-b-2 font-bold text-sm outline-none transition-all ${l?te?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-indigo-600"}`,autoComplete:"off"}),l&&!te&&e.jsx("div",{className:"absolute -bottom-5 text-[10px] font-black text-green-600 uppercase whitespace-nowrap",children:X})]},F)})}),N=()=>e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsx("textarea",{ref:d,value:w,onChange:f=>C(f.target.value),disabled:l,onKeyDown:f=>f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),y()),placeholder:"Type the full sentence...",className:`w-full p-5 rounded-3xl border-2 text-lg font-medium resize-none outline-none transition-all h-32 ${l?s?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800":"bg-white border-neutral-200 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-100"}`}),l&&!s&&e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-2xl animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-base font-bold text-green-900 leading-relaxed",children:c.originalSentence})]})]});if(R==="SETUP"){const f=({id:F,label:q,icon:X,desc:te,disabled:ee})=>e.jsxs("button",{onClick:()=>!ee&&Y(F),disabled:ee,className:`p-3 rounded-xl border-2 transition-all text-left flex flex-col gap-1 relative ${g===F?"border-cyan-500 bg-cyan-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"} ${ee?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded-lg ${g===F?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(X,{size:14})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${g===F?"text-cyan-700":"text-neutral-500"}`,children:q})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:te}),ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-[1px] font-black text-xs text-neutral-400 uppercase tracking-widest",children:"Locked"})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-6 animate-in fade-in max-w-4xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(Lt,{size:32})}),e.jsx("h2",{className:"text-2xl font-black text-neutral-900 tracking-tight",children:"Dictation Lab"}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium",children:"Bridge the gap between hearing and writing."})]}),e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>$("LIBRARY"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${M==="LIBRARY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Et,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Sentence"})]}),e.jsxs("button",{onClick:()=>$("SERVER"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${M==="SERVER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Bt,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Phrase"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-sm font-black text-cyan-600",children:P})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:P,onChange:F=>J(parseInt(F.target.value)),className:"w-full h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2 flex flex-col justify-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(f,{id:"EASY",label:"Easy",icon:Zap,desc:"Type in missing words. Numbers are always masked.",disabled:M==="SERVER"}),e.jsx(f,{id:"HARD",label:"Hard",icon:Ge,desc:"Transcribe the full sentence from scratch."})]})]})]}),e.jsxs("div",{className:"w-full bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ue,{size:12})," Voice Pool"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 group-hover:text-cyan-600 transition-colors",children:"Hover to hear"}),e.jsx("div",{className:`w-8 h-4 rounded-full p-0.5 transition-colors ${r?"bg-cyan-500":"bg-neutral-200"}`,onClick:()=>x(!r),children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full shadow-sm transition-transform ${r?"translate-x-4":"translate-x-0"}`})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-1",children:[e.jsxs("button",{onClick:()=>D("System"),onMouseEnter:()=>G("System"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${A.has("System")?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[A.has("System")&&e.jsx(we,{size:10})," System Default"]}),Q.map(F=>e.jsxs("button",{onClick:()=>D(F.name),onMouseEnter:()=>G(F.name),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${A.has(F.name)?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[A.has(F.name)&&e.jsx(we,{size:10})," ",F.name.replace("Microsoft ","")]},F.name)),Q.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-400 italic",children:"Connect to server for HQ voices."})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:V,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50 transition-all text-xs",children:"Back"}),e.jsxs("button",{onClick:Z,disabled:O,className:"px-10 py-3 bg-cyan-600 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-cyan-700 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[O?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(ue,{size:16,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:V,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Level ",H+1," of ",E.length," ‚Ä¢ ",c.mode]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-300",style:{width:`${H/E.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:b})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12",children:[e.jsxs("button",{onClick:L,className:"w-28 h-28 bg-cyan-50 text-cyan-600 rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition-all group active:scale-95 relative",children:[e.jsx(ue,{size:48,className:"ml-1.5 fill-cyan-600 group-hover:scale-110 transition-transform"}),c.voice&&e.jsx("div",{className:"absolute -bottom-6 text-[9px] font-bold text-neutral-300 bg-white px-2 py-0.5 rounded-full shadow-sm border border-neutral-100 whitespace-nowrap",children:c.voice})]}),e.jsx("div",{className:"w-full min-h-[160px] flex items-center justify-center px-4",children:c.mode==="EASY"?h():N()}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:l?e.jsxs("button",{onClick:j,className:`w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 ${s?"bg-emerald-600 text-white shadow-emerald-200":"bg-neutral-900 text-white"}`,children:[e.jsx("span",{children:H===E.length-1?"Finish":"Next Item"}),e.jsx(ke,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:v,className:"flex-1 py-4 bg-white border-2 border-neutral-200 text-neutral-400 font-black text-xs uppercase tracking-widest rounded-2xl hover:text-neutral-600 hover:border-neutral-300 transition-all",children:"Skip"}),e.jsx("button",{onClick:y,className:"flex-[2] py-4 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl shadow-neutral-900/10 active:scale-95",children:"Check Answer"})]})})]})]})},at=a=>a.toLowerCase().replace(/[^a-z0-9]/g,""),hs=({userId:a,onComplete:p,onExit:z})=>{var G;const[R,k]=t.useState("SETUP"),[P,J]=t.useState("MASTER"),[g,Y]=t.useState("MEDIUM"),[M,$]=t.useState(0),[O,B]=t.useState(0),[Q,U]=t.useState([]),[A,K]=t.useState(0),[r,x]=t.useState(0),[E,T]=t.useState(""),[H,W]=t.useState(!1),[b,S]=t.useState(!1),[u,_]=t.useState(!1),[w,C]=t.useState(!1),[l,i]=t.useState({}),s=t.useRef(new At),o=t.useRef(null),d=t.useRef(null),{showToast:m}=pe(),n=async()=>{const h=await Te();let N=0,f=0;h.forEach(F=>{F.answers.forEach(q=>{N++,q.lastResult==="correct"&&f++})}),$(N),B(f)};t.useEffect(()=>{n()},[a,R]),t.useEffect(()=>{u&&setTimeout(()=>{var h;(h=d.current)==null||h.scrollIntoView({behavior:"smooth",block:"end"})},100)},[u]);const I=async()=>{const h=await Te();let N=h;if(P==="MASTER"){const X=h.filter(te=>te.answers.some(ee=>ee.lastResult!=="correct"));X.length>0?N=X:m("All items mastered! Switching to review mode.","info")}if(N.length===0){m("No expressions found.","error");return}const f=[],F=[];h.forEach(X=>{X.answers.forEach(te=>{const ee=te.sentence.match(/\{(.*?)\}/);ee&&F.push(ee[1])})}),N.forEach(X=>{X.answers.forEach((te,ee)=>{if(P==="MASTER"&&te.lastResult==="correct")return;const se=te.sentence.match(/\{(.*?)\}/);if(se){const oe=se[1],ce=te.sentence.replace(se[0],"_______");let re;if(g==="EASY"){const ae=F.filter(le=>le!==oe).sort(()=>.5-Math.random()).slice(0,3);re=[oe,...ae].sort(()=>.5-Math.random())}f.push({id:`${X.id}-${ee}`,nativeSpeakItemId:X.id,answerIndex:ee,answer:te,maskedSentence:ce,choices:re})}})});const q=f.sort(()=>.5-Math.random()).slice(0,10);U(q),K(0),x(0),T(""),_(!1),C(!1),S(!1),i({}),k("PLAYING")},Z=()=>{W(!0),T(""),s.current.start((h,N)=>T(h+N),h=>T(h))},c=()=>{W(!1),s.current.stop()},L=async h=>{const N=Q[A],f=`${N.nativeSpeakItemId}-${N.answerIndex}`;i(X=>({...X,[f]:h?"correct":"incorrect"}));const q=(await Te()).find(X=>X.id===N.nativeSpeakItemId);if(q){const X=q.answers.map((se,oe)=>oe===N.answerIndex?{...se,lastResult:h?"correct":"incorrect"}:se),te=X.filter(se=>se.lastResult==="correct").length,ee=Math.round(te/X.length*100);await Tt({...q,answers:X,bestScore:ee,updatedAt:Date.now()})}},v=()=>{if(w)return;const N=Q[A].answer.sentence.match(/\{(.*?)\}/),f=N?N[1]:"",F=at(E).includes(at(f));C(F),_(!0),F&&(x(q=>q+10),L(!0))},V=()=>{L(!1),y()},y=()=>{A<Q.length-1?(K(h=>h+1),T(""),_(!1),C(!1),S(!1)):(k("SUMMARY"),setTimeout(()=>p(r),2e3))},j=Q[A];if(R==="SETUP"){const h=({id:N,label:f,desc:F})=>e.jsxs("button",{onClick:()=>Y(N),className:`flex flex-col items-center justify-center py-2 rounded-lg text-[10px] font-black transition-all h-full ${g===N?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx("span",{className:"uppercase tracking-widest",children:f}),e.jsx("span",{className:"text-[9px] font-medium opacity-60 text-center px-1 leading-tight mt-0.5",children:F})]});return e.jsxs("div",{className:"flex flex-col h-full items-center justify-center p-6 space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-amber-100 text-amber-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(Mt,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Natural Expression"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Master native phrases by using them in context."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2rem] border border-neutral-200 shadow-sm w-full max-w-sm space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:O}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:M}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>J("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${P==="MASTER"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>J("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${P==="REVIEW"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-3 bg-neutral-100 p-1 rounded-xl",children:[e.jsx(h,{id:"EASY",label:"EASY",desc:"Select from list"}),e.jsx(h,{id:"MEDIUM",label:"MEDIUM",desc:"Fill missing part"}),e.jsx(h,{id:"HARD",label:"HARD",desc:"Type entire phrase"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50",children:"Back"}),e.jsxs("button",{onClick:I,className:"px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg flex items-center gap-2",children:[e.jsx(ue,{size:16,fill:"white"})," Start"]})]})]})}if(R==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(xe,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Your progress has been saved to the library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:r}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"})]});const D=j.answer.tone==="academic"?"bg-purple-100 text-purple-700":j.answer.tone==="semi-academic"?"bg-blue-100 text-blue-700":"bg-neutral-100 text-neutral-600";return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",A+1," of ",Q.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-300",style:{width:`${A/Q.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:r})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar w-full",children:e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-4",children:[e.jsxs("div",{className:"w-full bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-xl text-center space-y-4 relative overflow-hidden shrink-0",children:[e.jsx("div",{className:`absolute top-0 left-1/2 -translate-x-1/2 px-4 py-1 rounded-b-xl text-[10px] font-black uppercase tracking-widest ${D}`,children:j.answer.tone}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest mb-2",children:"Situation / Context"}),e.jsxs("h3",{className:"text-2xl md:text-3xl font-black text-neutral-900 leading-tight",children:['"',j.answer.anchor,'"']})]}),e.jsx("div",{className:"min-h-[100px] flex items-center justify-center py-4",children:g==="HARD"?e.jsx("div",{className:"text-neutral-400 text-sm font-medium italic",children:"(Expression Hidden - Speak or Type it)"}):e.jsx("p",{className:"text-lg md:text-xl text-neutral-700 font-medium",children:j.maskedSentence})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 bg-yellow-50 px-4 py-2 rounded-xl",children:[e.jsx("button",{onClick:()=>ge(j.answer.sentence),className:"p-2 bg-white text-yellow-600 rounded-full shadow-sm hover:scale-110 transition-transform",children:e.jsx(Ue,{size:16})}),e.jsx("span",{className:"text-xs font-bold text-yellow-800 italic",children:j.answer.note||"Listen to the example"})]})})]}),e.jsx("div",{className:"w-full max-w-md space-y-4 shrink-0",children:g==="EASY"?e.jsx("div",{className:"grid grid-cols-1 gap-2",children:(G=j.choices)==null?void 0:G.map(h=>e.jsx("button",{onClick:()=>T(h),disabled:w,className:`p-4 rounded-xl border-2 font-bold text-sm transition-all ${E===h?"bg-amber-50 border-amber-500 text-amber-900":"bg-white border-neutral-100 text-neutral-600 hover:border-neutral-300"}`,children:h},h))}):e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:o,value:E,onChange:h=>T(h.target.value),disabled:w||H,placeholder:g==="HARD"?"Type the full expression...":"Type the missing part...",className:`w-full p-5 pr-14 bg-white border-2 rounded-2xl text-lg font-bold outline-none transition-all resize-none ${u?w?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-amber-500 focus:ring-4 focus:ring-amber-50"}`,rows:2}),e.jsx("div",{className:"absolute right-3 bottom-3",children:e.jsx("button",{onClick:H?c:Z,className:`p-2 rounded-full transition-all ${H?"bg-red-500 text-white animate-pulse":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:H?e.jsx("div",{className:"w-4 h-4 bg-white rounded-sm"}):e.jsx(zt,{size:20})})})]})}),e.jsx("div",{className:"w-full max-w-md flex gap-3 shrink-0",children:w?e.jsxs("div",{className:"w-full space-y-4 animate-in slide-in-from-bottom-2 pb-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl flex items-center gap-3 border-2 bg-emerald-50 border-emerald-100 text-emerald-800",children:[e.jsx(xe,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-lg uppercase tracking-tight",children:"Correct!"}),e.jsx("p",{className:"text-xs font-bold opacity-80",children:"Great job!"})]})]}),e.jsxs("button",{onClick:y,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-sm uppercase tracking-widest transition-all shadow-xl flex items-center justify-center gap-2 hover:bg-emerald-700",children:[e.jsx(ke,{size:18})," ",A===Q.length-1?"Finish":"Continue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:V,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-sm uppercase tracking-widest hover:text-neutral-600 hover:border-neutral-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),e.jsxs("button",{onClick:()=>S(!0),disabled:b,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsx("button",{onClick:v,disabled:!E.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 disabled:active:scale-100",children:u?"Retry":"Check"})]})}),(w||b)&&e.jsxs("div",{className:"w-full max-w-md p-5 bg-white border-2 border-neutral-100 rounded-2xl shadow-sm relative overflow-hidden animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-2",children:"The Correct Expression"}),e.jsx("p",{className:"text-xl font-black text-emerald-600 leading-snug",children:j.answer.sentence.replace(/{|}/g,"")})]}),e.jsx("div",{ref:d})]})})]})},Ie=a=>a.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),fs=({user:a,onComplete:p,onExit:z})=>{const[R,k]=t.useState("SETUP"),[P,J]=t.useState(10),[g,Y]=t.useState("EASY"),[M,$]=t.useState("MASTER"),[O,B]=t.useState(0),[Q,U]=t.useState(0),[A,K]=t.useState([]),[r,x]=t.useState(0),[E,T]=t.useState(0),[H,W]=t.useState([]),[b,S]=t.useState(!1),[u,_]=t.useState(!1),[w,C]=t.useState(!1),[l,i]=t.useState(!1),s=t.useRef({}),{showToast:o}=pe();t.useEffect(()=>{(async()=>{const G=(await je(a.id)).filter(f=>f.type==="intensity"&&f.intensityRows);let h=0,N=0;G.forEach(f=>{f.intensityRows.forEach(F=>{["softened","neutral","intensified"].forEach(q=>{F[q].forEach(X=>{h++,X.lastResult==="correct"&&N++})})})}),B(h),U(N)})()},[a.id,R]);const d=async()=>{const D=(await je(a.id)).filter(f=>f.type==="intensity"&&f.intensityRows&&f.intensityRows.length>0);if(D.length===0){o("No Intensity Scale lessons found in your library.","error");return}const G=[],h=[];if(D.forEach(f=>{f.intensityRows.forEach(F=>{[...F.softened,...F.neutral,...F.intensified].forEach(q=>h.push(q.word))})}),D.forEach(f=>{f.intensityRows.forEach((F,q)=>{const X=["softened","neutral","intensified"];X.forEach(te=>{const ee=F[te];ee.length!==0&&X.forEach(se=>{if(te===se||F[se].length===0)return;const oe=F[se].every(ce=>ce.lastResult==="correct");M==="MASTER"&&oe||ee.forEach(ce=>{const re={lessonId:f.id,rowIdx:q,pivotWord:ce.word,pivotCategory:te,targetCategory:se,expectedWords:F[se].map(ae=>Ie(ae.word)),originalExpectedItems:F[se]};if(g==="EASY"){const ae=F[se].map(me=>me.word),le=h.filter(me=>!ae.includes(me)).sort(()=>.5-Math.random()).slice(0,5);re.choices=[...ae,...le].sort(()=>.5-Math.random())}G.push(re)})})})})}),G.length===0){M==="MASTER"?(o("All items mastered! Switching to Review mode.","success"),$("REVIEW")):o("Not enough data to start game. Add more words to your scales.","error");return}const N=G.sort(()=>.5-Math.random()).slice(0,P);K(N),x(0),T(0),k("PLAYING"),m(N[0])},m=j=>{W(new Array(j.expectedWords.length).fill("")),S(!1),_(!1),i(!1),setTimeout(()=>{var D;(D=s.current[0])==null||D.focus()},100)},n=async()=>{if(w)return;const j=A[r],D=H.map(N=>Ie(N)).filter(Boolean),G=new Set(D);let h=!0;if(G.size!==j.expectedWords.length)h=!1;else for(const N of j.expectedWords)if(!G.has(N)){h=!1;break}S(!0),_(h),h&&(T(N=>N+20),await Z(!0))},I=()=>{i(!0)},Z=async j=>{C(!0);const D=A[r];try{const h=(await je(a.id)).find(N=>N.id===D.lessonId);if(h&&h.intensityRows){const N=[...h.intensityRows],f=[...N[D.rowIdx][D.targetCategory]];N[D.rowIdx][D.targetCategory]=f.map(F=>({...F,lastResult:j?"correct":"incorrect"})),await it({...h,intensityRows:N,updatedAt:Date.now()})}}catch(G){console.error("Failed to save result",G)}finally{C(!1)}},c=()=>{if(r<A.length-1){const j=r+1;x(j),m(A[j])}else k("SUMMARY")},L=async()=>{await Z(!1),c()};if(R==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full items-center justify-center p-6 space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-orange-100 text-orange-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(Ot,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Intensity Scale"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Drill synonyms based on their degree of intensity."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2rem] border border-neutral-200 shadow-sm w-full max-w-sm space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:O}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>$("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${M==="MASTER"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>$("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${M==="REVIEW"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-orange-600",children:P})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:P,onChange:j=>J(parseInt(j.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-orange-500"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>Y("EASY"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${g==="EASY"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Easy",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Select from list"})]}),e.jsxs("button",{onClick:()=>Y("HARD"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${g==="HARD"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Hard",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Fill in the blank"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50",children:"Back"}),e.jsxs("button",{onClick:d,className:"px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg flex items-center gap-2",children:[e.jsx(ue,{size:16,fill:"white"})," Start Game"]})]})]});if(R==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(xe,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Scale Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Progress marks updated in your library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:E}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>p(E),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const v=A[r],V={softened:"Softened",neutral:"Neutral",intensified:"Intensified"},y={softened:"text-blue-500 bg-blue-50 border-blue-100",neutral:"text-neutral-500 bg-neutral-100 border-neutral-200",intensified:"text-orange-500 bg-orange-50 border-orange-100"};return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",r+1," of ",A.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${r/A.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${y[v.pivotCategory]}`,children:V[v.pivotCategory]}),e.jsx("span",{className:"text-neutral-300",children:"‚Üí"}),e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${y[v.targetCategory]}`,children:V[v.targetCategory]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest",children:["What is the ",v.targetCategory," of"]}),e.jsxs("h3",{className:"text-4xl font-black text-neutral-900 tracking-tighter",children:['"',v.pivotWord,'"?']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-3",children:[H.map((j,D)=>{var G;return e.jsx("div",{className:"relative",children:g==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:h=>{s.current[D]=h},value:j,disabled:u,onChange:h=>{const N=[...H];N[D]=h.target.value,W(N)},className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${b?v.expectedWords.includes(Ie(j))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50"}`,children:[e.jsxs("option",{value:"",children:["Select word ",D+1,"..."]}),(G=v.choices)==null?void 0:G.map(h=>e.jsx("option",{value:h,children:h},h))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:h=>{s.current[D]=h},type:"text",value:j,disabled:u,onChange:h=>{const N=[...H];N[D]=h.target.value,W(N)},onKeyDown:h=>h.key==="Enter"&&!u&&n(),placeholder:`Type word ${D+1}...`,className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${b?v.expectedWords.includes(Ie(j))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50 shadow-sm"}`,autoComplete:"off"})},D)}),(u||l)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answers"}),e.jsx("p",{className:"text-lg font-black text-emerald-900",children:v.originalExpectedItems.map(j=>j.word).join(", ")})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:c,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:r===A.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),b&&!u&&e.jsxs("button",{onClick:I,disabled:l,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:n,disabled:w||H.some(j=>!j.trim()),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[w?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:b?"Retry":"Check"})]})]})})]})]})},he=a=>a.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),ps=({user:a,onComplete:p,onExit:z})=>{var V;const[R,k]=t.useState("SETUP"),[P,J]=t.useState(10),[g,Y]=t.useState("EASY"),[M,$]=t.useState("MASTER"),[O,B]=t.useState(0),[Q,U]=t.useState(0),[A,K]=t.useState([]),[r,x]=t.useState(0),[E,T]=t.useState(0),[H,W]=t.useState(""),[b,S]=t.useState(!1),[u,_]=t.useState(!1),[w,C]=t.useState(!1),[l,i]=t.useState(!1),s=t.useRef(null),{showToast:o}=pe();t.useEffect(()=>{(async()=>{const D=(await je(a.id)).filter(N=>N.type==="comparison"&&N.comparisonRows);let G=0,h=0;D.forEach(N=>{N.comparisonRows.forEach(f=>{G++,f.lastResult==="correct"&&h++})}),B(G),U(h)})()},[a.id,R]);const d=async()=>{const j=(await je(a.id)).filter(N=>N.type==="comparison"&&N.comparisonRows&&N.comparisonRows.length>0);if(j.length===0){o("No Comparison Lab lessons found in your library.","error");return}const D=[],G=[];if(j.forEach(N=>{N.comparisonRows.forEach(f=>{f.word&&G.push(f.word)})}),j.forEach(N=>{N.comparisonRows.forEach((f,F)=>{if(!f.word||!f.nuance||M==="MASTER"&&f.lastResult==="correct")return;const q={lessonId:N.id,rowIdx:F,answerWord:f.word,nuance:f.nuance,example:f.example};if(g==="EASY"){const X=G.filter(te=>he(te)!==he(f.word)).sort(()=>.5-Math.random()).slice(0,5);q.choices=[f.word,...X].sort(()=>.5-Math.random())}D.push(q)})}),D.length===0){M==="MASTER"?(o("All items mastered! Switching to Review mode.","success"),$("REVIEW")):o("Not enough data to start game. Add more word pairs to your labs.","error");return}const h=D.sort(()=>.5-Math.random()).slice(0,P);K(h),x(0),T(0),k("PLAYING"),m(h[0])},m=y=>{W(""),S(!1),_(!1),i(!1),setTimeout(()=>{var j;(j=s.current)==null||j.focus()},100)},n=async()=>{if(w)return;const y=A[r],j=he(H)===he(y.answerWord);_(j),S(!0),j&&(T(D=>D+20),await Z(!0))},I=()=>{i(!0)},Z=async y=>{C(!0);const j=A[r];try{const G=(await je(a.id)).find(h=>h.id===j.lessonId);if(G&&G.comparisonRows){const h=[...G.comparisonRows];h[j.rowIdx]={...h[j.rowIdx],lastResult:y?"correct":"incorrect"},await it({...G,comparisonRows:h,updatedAt:Date.now()})}}catch(D){console.error("Failed to save result",D)}finally{C(!1)}},c=()=>{if(r<A.length-1){const y=r+1;x(y),m(A[y])}else k("SUMMARY")},L=async()=>{await Z(!1),c()};if(R==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full items-center justify-center p-6 space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-100 text-indigo-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(dt,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Contrast"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-xs mx-auto",children:"Distinguish and identify confusing word pairs based on their usage nuance."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-[2rem] border border-neutral-200 shadow-sm w-full max-w-sm space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:Q}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:O}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>$("MASTER"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${M==="MASTER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>$("REVIEW"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${M==="REVIEW"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:P})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:P,onChange:y=>J(parseInt(y.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>Y("EASY"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${g==="EASY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Easy",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Select from list"})]}),e.jsxs("button",{onClick:()=>Y("HARD"),className:`p-3 rounded-xl border-2 text-xs font-bold transition-all ${g==="HARD"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Hard",e.jsx("p",{className:"text-[9px] font-normal opacity-70 mt-1",children:"Type from memory"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50",children:"Back"}),e.jsxs("button",{onClick:d,className:"px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg flex items-center gap-2",children:[e.jsx(ue,{size:16,fill:"white"})," Start Game"]})]})]});if(R==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(xe,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"History marks updated in your comparison labs."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:E}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>p(E),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const v=A[r];return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ie,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",r+1," of ",A.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${r/A.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"w-full bg-white p-10 rounded-[3rem] border-2 border-neutral-100 shadow-xl text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest mb-2",children:"Identify the word based on nuance:"}),e.jsxs("h3",{className:"text-xl md:text-2xl font-medium text-neutral-800 leading-relaxed italic",children:['"',v.nuance,'"']})]}),v.example&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-50",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-300 uppercase tracking-widest mb-1",children:"Usage Example"}),e.jsxs("p",{className:"text-sm font-bold text-neutral-500",children:['"',v.example.replace(new RegExp(v.answerWord,"gi"),"_______"),'"']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-4",children:[g==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:s,value:H,disabled:u,onChange:y=>W(y.target.value),className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${b?he(H)===he(v.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50"}`,children:[e.jsx("option",{value:"",children:"Select word..."}),(V=v.choices)==null?void 0:V.map(y=>e.jsx("option",{value:y,children:y},y))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:s,type:"text",value:H,disabled:u,onChange:y=>W(y.target.value),onKeyDown:y=>y.key==="Enter"&&!u&&n(),placeholder:"Type the word...",className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${b?he(H)===he(v.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 shadow-sm"}`,autoComplete:"off"}),(u||l)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-xl font-black text-emerald-900",children:v.answerWord})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:c,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:r===A.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),b&&!u&&e.jsxs("button",{onClick:I,disabled:l,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:n,disabled:w||!H.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[w?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:b?"Retry":"Check"})]})]})})]})]})},As=({user:a,onExit:p,onGainXp:z,onRecalculateXp:R,xpGained:k,xpToNextLevel:P,totalWords:J,onStartSession:g,onUpdateUser:Y,lastMasteryScoreUpdateTimestamp:M,onBulkUpdate:$,initialGameMode:O,onConsumeGameMode:B})=>{const[Q,U]=t.useState("ADVENTURE"),[A,K]=t.useState([]),[r,x]=t.useState(!0),E=t.useRef(0),{showToast:T}=pe();t.useEffect(()=>{O&&O!=="MENU"&&(U(O),B==null||B())},[O,B]);const H=t.useRef(R);t.useEffect(()=>{H.current=R},[R]),t.useEffect(()=>{(async()=>{x(!0);const l=lt().filter(i=>i.userId===a.id).filter(i=>i&&!i.isPassive);if(K(l),M>E.current){const i=l.reduce((s,o)=>s+(o.masteryScore||0),0);await H.current(i),E.current=Date.now()}x(!1)})()},[a.id,M]);const W=w=>{T(`Game Complete! Score: ${w}`,"success"),p()},b=()=>{p()},S=w=>A.filter(C=>C.gameEligibility?C.gameEligibility.includes(w):_t(C).includes(w)),u=()=>A.filter(w=>{const C=w.paraphrases&&w.paraphrases.filter(s=>!s.isIgnored&&s.context&&s.context.trim()).length>=2,l=w.collocationsArray&&w.collocationsArray.filter(s=>!s.isIgnored&&s.d&&s.d.trim()).length>=2,i=w.idiomsList&&w.idiomsList.filter(s=>!s.isIgnored&&s.d&&s.d.trim()).length>=2;return C||l||i}),_=()=>{const w={onComplete:W,onExit:b};switch(Q){case"ADVENTURE":return e.jsx(_e,{user:a,onUpdateUser:Y,onStartSession:g,onExit:p});case"IPA_SORTER":return e.jsx(is,{...w,words:S("IPA_SORTER"),onBulkUpdate:$});case"SENTENCE_SCRAMBLE":return e.jsx(os,{...w,words:S("SENTENCE_SCRAMBLE")});case"DICTATION":return e.jsx(ms,{...w,words:S("DICTATION")});case"PREPOSITION_POWER":return e.jsx(ds,{...w,words:S("PREPOSITION_POWER")});case"PARAPHRASE_CONTEXT":return e.jsx(xs,{...w,words:u()});case"WORD_SCATTER":return e.jsx(us,{...w,words:S("MEANING_MATCH")});case"NATURAL_EXPRESSION":return e.jsx(hs,{userId:a.id,...w});case"INTENSITY_SCALE":return e.jsx(fs,{user:a,...w});case"COMPARISON_LAB":return e.jsx(ps,{user:a,...w});default:return e.jsx(_e,{user:a,onUpdateUser:Y,onStartSession:g,onExit:p})}};return Q==="ADVENTURE"?e.jsx(Xt,{user:a,xpToNextLevel:P,onUpdateUser:Y,isRecalculatingXp:r,children:e.jsx(_e,{user:a,onUpdateUser:Y,onStartSession:g,onExit:p})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-neutral-100 p-4 md:p-6 animate-in zoom-in-95 duration-300 flex flex-col",children:e.jsx("div",{className:"w-full h-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-200 relative p-6",children:_()})})};export{As as default};
