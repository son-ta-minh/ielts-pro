import{c as Ye,r as s,j as e,Y as ge,ak as Ne,O as ke,bB as Se,S as Je,h as Ve,bC as Ke,aE as Xe,ao as Ze,J as je,bD as Ce,V as et,I as tt,A as st,b5 as rt,M as nt,an as at,U as lt,aS as ot,ay as it,a5 as me,am as pe,bi as ct,a4 as ut,bE as be,bF as dt,t as xt,k as ft,aQ as ht,aG as mt,bG as pt}from"./index-Bub_R4oH.js";import{E as bt}from"./ear-Be5lPksq.js";import{C as gt}from"./chevron-left-CpKa_hz6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=Ye("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ze=({isOpen:c,onClose:_,onSave:l,initialData:p})=>{const[f,m]=s.useState(""),$=s.useRef(null);s.useEffect(()=>{c&&(m((p==null?void 0:p.text)||""),setTimeout(()=>{var h;return(h=$.current)==null?void 0:h.focus()},100))},[c,p]);const L=h=>{h.preventDefault(),f.trim()&&l(f.trim())};return c?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:L,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:p?"Edit Phrase":"Add New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Enter the text you want to practice mimicking."})]}),e.jsx("button",{type:"button",onClick:_,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ge,{size:20})})]}),e.jsx("main",{className:"p-8",children:e.jsx("textarea",{ref:$,value:f,onChange:h=>m(h.target.value),placeholder:"e.g. It's not a matter of if, but when.",rows:5,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-base leading-relaxed",required:!0})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(it,{size:14})," Save Phrase"]})})]})}):null},vt=({score:c})=>c===void 0?e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-200",title:"Not practiced yet"}):e.jsx("div",{className:`flex items-center justify-center px-1.5 py-0.5 rounded-md ${c>=80?"bg-green-100 text-green-700":c>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.jsx("span",{className:"text-[9px] font-black",children:c})}),wt=({targetText:c,sourceWord:_,isRecording:l,isRevealed:p,userTranscript:f,userAudioUrl:m,onToggleRecord:$,onPlayTarget:L,onPlayUser:h,onToggleReveal:O,onNext:b,onClearTranscript:ve,isEmpty:de,onClose:w,pagedItems:V,page:y,pageSize:F,totalPages:E,onPageChange:N,onPageSizeChange:xe,onSelect:M,currentAbsoluteIndex:fe,autoSpeak:U,onToggleAutoSpeak:n,autoReveal:k,onToggleAutoReveal:K,isGlobalMode:ae,localAnalysis:g,onAddItem:D,onEditItem:Q,onDeleteItem:X,onRandomize:Z,isModalOpen:q,editingItem:ee,onCloseModal:le,onSaveItem:oe,ipa:ie,showIpa:G,isIpaLoading:I,onToggleIpa:te})=>{const[B,H]=s.useState(!0),[ce,S]=s.useState(null),[T,C]=s.useState(!1),[z,se]=s.useState(()=>{const r=localStorage.getItem("mimic_play_speed");return r?Number(r):1}),P=s.useRef(null),j=s.useRef(null);s.useEffect(()=>{const r=j.current;r&&c&&setTimeout(()=>{if(!j.current)return;r.style.fontSize="1.5rem";const a=r.parentElement;if(a){const u=r.scrollWidth,i=a.clientWidth;if(u>i){const W=i/u*24;r.style.fontSize=`${Math.max(W,14)}px`}}},50)},[c]),s.useEffect(()=>{localStorage.setItem("mimic_play_speed",String(z))},[z]);const x=r=>{const a=r.toLowerCase().replace(/[^a-z]/g,"");if(!a)return 1;const u=a.match(/[aeiouy]+/g);return u?u.length:1},R=()=>{if(!c)return;const r=c.split(/\s+/);if(T){clearTimeout(P.current),C(!1),S(null);return}let a=0;C(!0);const u=()=>{if(a>=r.length){C(!1),S(null);return}S(a);const i=r[a];let v=400*x(i)/z;/[,.]/.test(i)&&(v+=300/z),/[!?;]/.test(i)&&(v+=500/z),/[:]/.test(i)&&(v+=400/z),a++,P.current=setTimeout(u,v)};u()};if(de)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4 relative bg-white",children:[w&&e.jsx("button",{onClick:w,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ge,{size:24})}),e.jsx("div",{className:"p-4 bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(bt,{size:40})}),e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Queue is Empty"}),e.jsxs("button",{onClick:D,className:"mt-4 px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Ne,{size:14})," Add New"]})]}),e.jsx(ze,{isOpen:q,onClose:le,onSave:oe,initialData:ee})]});const A=ae?"h-full":"h-full rounded-[2.5rem] shadow-sm border border-neutral-200";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex w-full bg-white relative overflow-hidden ${A}`,children:[e.jsxs("div",{className:`h-full border-r border-neutral-100 bg-neutral-50/50 flex flex-col shrink-0 transition-all duration-300 ease-in-out ${B?"w-80 opacity-100":"w-0 opacity-0 border-none overflow-hidden"}`,children:[e.jsx("div",{className:"p-4 border-b border-neutral-100 bg-white space-y-3 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-neutral-500",children:[e.jsx(jt,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Queue"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:K,className:`p-2 rounded-lg border transition-all shadow-sm ${k?"bg-sky-100 border-sky-200 text-sky-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Reveal Text: ${k?"ON":"OFF"}`,children:k?e.jsx(ke,{size:14}):e.jsx(Se,{size:14})}),e.jsx("button",{onClick:n,className:`p-2 rounded-lg border transition-all shadow-sm ${U?"bg-amber-100 border-amber-200 text-amber-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Speak: ${U?"ON":"OFF"}`,children:e.jsx(Je,{size:14,fill:U?"currentColor":"none"})}),e.jsx("button",{onClick:Z,className:"p-2 bg-white border border-neutral-200 text-neutral-500 rounded-lg hover:text-indigo-600 transition-all shadow-sm",title:"Shuffle Queue",children:e.jsx(Ve,{size:14})}),e.jsx("button",{onClick:D,className:"p-2 bg-neutral-900 text-white border border-neutral-900 rounded-lg hover:bg-neutral-800 transition-all shadow-sm",children:e.jsx(Ne,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:V.map((r,a)=>{const i=y*F+a===fe;return e.jsxs("div",{className:`w-full text-left rounded-lg border transition-all group relative ${i?"bg-white border-neutral-900 shadow-sm ring-1 ring-neutral-900/5":"border-transparent hover:bg-neutral-100"}`,children:[e.jsxs("button",{onClick:()=>M(a),className:"w-full px-3 py-3 flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:e.jsx(vt,{score:r.lastScore})}),e.jsx("span",{className:`text-xs font-bold leading-snug line-clamp-2 ${i?"text-neutral-900":"text-neutral-600"}`,children:r.text})]}),e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 right-2 flex items-center bg-white/90 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm border border-neutral-100",children:[e.jsx("button",{onClick:()=>Q(r),className:"p-1.5 text-neutral-400 hover:text-indigo-600",children:e.jsx(Ke,{size:12})}),e.jsx("button",{onClick:()=>X(r),className:"p-1.5 text-neutral-400 hover:text-red-600",children:e.jsx(Xe,{size:12})})]})]},r.id)})}),e.jsxs("div",{className:"p-3 border-t border-neutral-100 bg-white flex items-center justify-between shrink-0",children:[e.jsx("select",{value:F,onChange:r=>xe(Number(r.target.value)),className:"bg-neutral-50 border border-neutral-200 rounded-lg px-2 py-1 text-[10px] font-bold text-neutral-600 focus:outline-none focus:ring-1 focus:ring-neutral-900",children:[10,15,20,30].map(r=>e.jsx("option",{value:r,children:r},r))}),E>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>N(y-1),disabled:y===0,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(gt,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 tabular-nums",children:[y+1,"/",E]}),e.jsx("button",{onClick:()=>N(y+1),disabled:y>=E-1,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Ze,{size:16})})]})]})]}),e.jsxs("div",{className:"flex-1 h-full flex flex-col relative overflow-y-auto",children:[w&&e.jsx("button",{onClick:w,className:"absolute top-4 right-4 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full z-50",children:e.jsx(ge,{size:20})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-6 animate-in fade-in",children:[e.jsx("div",{className:"relative w-full max-w-2xl",children:e.jsxs("div",{className:"p-6 md:p-8 rounded-[2rem] border-2 text-center transition-all duration-300 min-h-[180px] flex flex-col items-center justify-center relative bg-white border-neutral-200 shadow-xl shadow-neutral-100",children:[e.jsx("button",{onClick:O,className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-indigo-500",children:p?e.jsx(Se,{size:20}):e.jsx(ke,{size:20})}),e.jsxs("div",{className:"relative px-4 w-full flex flex-col items-center gap-4",children:[e.jsx("div",{ref:j,className:"flex flex-wrap justify-center gap-x-1.5 gap-y-1",style:{fontSize:"1.5rem",lineHeight:"1.4"},children:c==null?void 0:c.split(/\s+/).map((r,a)=>{const u=g==null?void 0:g.words[a];let i="text-neutral-800";if(u)switch(u.status){case"correct":i="text-emerald-600";break;case"near":i="text-amber-500";break;case"wrong":i="text-rose-500";break;case"missing":i="text-neutral-300";break;default:i="text-neutral-800"}const W=u&&u.status!=="missing";return e.jsx("span",{onClick:()=>je(r),onMouseEnter:()=>S(a),onMouseLeave:()=>S(null),className:`font-bold cursor-pointer transition-all leading-normal px-1 rounded ${i} ${ce===a?"bg-indigo-100/70":"bg-transparent"} ${p||W?"opacity-100":"text-transparent blur-md select-none"}`,children:e.jsx("span",{className:i,children:r})},a)})}),G&&ie&&e.jsx("div",{className:"w-full self-stretch px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-2xl text-base font-mono font-normal text-neutral-600 leading-relaxed text-left animate-in slide-in-from-top-2 duration-500 flex flex-wrap gap-x-2 gap-y-1",children:ie.replace(/\//g,"").split(/\s+/).map((r,a)=>e.jsx("span",{className:`px-1 rounded transition-all ${ce===a?"bg-indigo-200 text-indigo-900":""}`,children:r},a))}),!p&&!g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-200 text-xs font-bold uppercase tracking-widest animate-pulse",children:"Speak to reveal result"})})]}),g&&e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-1 animate-in slide-in-from-top-2",children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Accuracy"}),e.jsxs("div",{className:`text-4xl font-black ${g.score>80?"text-emerald-500":g.score>50?"text-amber-500":"text-rose-500"}`,children:[g.score,"%"]})]})]})}),e.jsxs("div",{className:"min-h-16 flex flex-col items-center justify-center w-full max-w-xl text-center",children:[l?e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 animate-pulse",children:[e.jsx(Ce,{size:24}),e.jsx("span",{className:"font-black text-sm uppercase tracking-widest",children:"Listening..."})]}):!f&&e.jsx("p",{className:"text-neutral-300 text-xs font-medium",children:"Tap the microphone and read the phrase aloud"}),f&&!l&&e.jsxs("div",{className:"space-y-1 animate-in fade-in",children:[e.jsx("p",{className:"text-neutral-400 text-[10px] font-black uppercase tracking-widest",children:"What we heard"}),e.jsxs("p",{className:"text-lg font-medium italic text-neutral-600 line-clamp-2",children:['"',f,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:L,className:"p-4 rounded-2xl bg-white border border-neutral-200 text-neutral-600 hover:text-indigo-600 shadow-sm transition-all active:scale-95",children:e.jsx(et,{size:24})}),e.jsx("button",{onClick:te,disabled:I,className:`p-4 rounded-2xl border transition-all shadow-sm ${G?"bg-indigo-600 text-white shadow-lg scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Show Phonetic (IPA)",children:I?e.jsx(tt,{size:24,className:"animate-spin"}):e.jsx(st,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,disabled:!c,className:`p-4 rounded-2xl border transition-all shadow-sm ${T?"bg-neutral-900 text-white scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Auto Highlight",children:e.jsx(Ce,{size:24,className:T?"animate-pulse":""})}),e.jsxs("select",{value:z,onChange:r=>se(Number(r.target.value)),className:"text-xs border border-neutral-200 rounded-lg px-2 py-1 bg-white",children:[e.jsx("option",{value:.5,children:"75 WPM"}),e.jsx("option",{value:.75,children:"110 WPM"}),e.jsx("option",{value:1,children:"150 WPM"}),e.jsx("option",{value:1.25,children:"190 WPM"}),e.jsx("option",{value:1.5,children:"225 WPM"}),e.jsx("option",{value:1.75,children:"260 WPM"}),e.jsx("option",{value:2,children:"300 WPM"}),e.jsx("option",{value:2.25,children:"325 WPM"}),e.jsx("option",{value:2.5,children:"350 WPM"}),e.jsx("option",{value:2.75,children:"375 WPM"}),e.jsx("option",{value:3,children:"400 WPM"})]})]}),e.jsx("button",{onClick:$,className:`w-24 h-24 rounded-full flex items-center justify-center shadow-xl transition-all transform ${l?"bg-rose-500 text-white scale-110 ring-8 ring-rose-100":"bg-white border-4 border-neutral-100 text-neutral-900 hover:border-neutral-200 hover:scale-105"}`,children:l?e.jsx(rt,{size:32,fill:"currentColor"}):e.jsx(nt,{size:32})}),e.jsx("button",{onClick:h,disabled:!m||l,className:`p-4 rounded-2xl border transition-all shadow-sm ${m&&!l?"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600":"bg-neutral-50 border-neutral-100 text-neutral-300 cursor-not-allowed"}`,children:e.jsx(at,{size:24,fill:m&&!l?"currentColor":"none"})})]}),e.jsxs("button",{onClick:b,className:"px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center gap-2 transition-all shadow-lg bg-neutral-900 text-white hover:bg-neutral-800 active:scale-95",children:[e.jsx("span",{children:"Next Phrase"}),e.jsx(lt,{size:16})]})]}),e.jsx("div",{className:"px-8 pb-6",children:e.jsxs("div",{className:"p-4 bg-indigo-50 border border-indigo-100 rounded-2xl flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-indigo-500 text-white rounded-lg shadow-sm",children:e.jsx(ot,{size:16})}),e.jsxs("div",{className:"text-[10px] text-indigo-700 leading-relaxed font-medium",children:[e.jsx("b",{className:"text-[10px] uppercase tracking-wider block mb-0.5",children:"Visual Feedback Guide:"}),e.jsx("span",{className:"text-emerald-600 font-black",children:"GREEN"}),": Correct. ",e.jsx("span",{className:"text-rose-500 font-black",children:"RED"}),": Mispronounced. ",e.jsx("span",{className:"text-neutral-400 font-black",children:"GRAY"}),": Missing."]})]})})]})]}),e.jsx(ze,{isOpen:q,onClose:le,onSave:oe,initialData:ee})]})},Pe="vocab_pro_mimic_practice_queue",Me=1e3,yt=({scopedWord:c,onClose:_})=>{const[l,p]=s.useState([]),[f,m]=s.useState(0),[$,L]=s.useState(!1),[h,O]=s.useState(0),[b,ve]=s.useState(10),[de,w]=s.useState(!1),[V,y]=s.useState(null),[F,E]=s.useState(null),[N,xe]=s.useState(()=>me("vocab_pro_mimic_autospeak",!1)),[M,fe]=s.useState(()=>me("vocab_pro_mimic_autoreveal",!0)),U=s.useRef(N);s.useEffect(()=>{pe("vocab_pro_mimic_autospeak",N),U.current=N},[N]),s.useEffect(()=>{pe("vocab_pro_mimic_autoreveal",M)},[M]);const n=l[f]||null,[k,K]=s.useState(!1),[ae,g]=s.useState(!1),[D,Q]=s.useState(""),[X,Z]=s.useState(0),[q,ee]=s.useState(null),[le,oe]=s.useState("audio/webm"),[ie,G]=s.useState(null),[I,te]=s.useState(null),[B,H]=s.useState(!1),[ce,S]=s.useState(!1),[T,C]=s.useState(null),z=!1,se=s.useRef(new ct),P=s.useRef(null),j=s.useRef(null),x=s.useRef(null),R=s.useRef(()=>{}),A=s.useRef(!1),r=s.useRef(0),a=s.useRef(""),u=s.useRef(null),{showToast:i}=ut(),W=s.useMemo(()=>((n==null?void 0:n.text)||"").toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().split(/\s+/).filter(Boolean).length===1,[n==null?void 0:n.text]),v=D.substring(X).trimStart(),we=s.useCallback(t=>t.substring(r.current).trimStart(),[]);s.useEffect(()=>{r.current=X,a.current=v},[X,v]);const re=s.useCallback(t=>{if(!n)return null;const o=(t||"").trim(),d=o?be(n.text,o):u.current||be(n.text,o);C(d),u.current=d;const Y=l.map((J,he)=>he===f?{...J,lastScore:d.score}:J);return ne(Y),d},[n,l,f]);s.useEffect(()=>{if(!k||!n||!v)return;const t=be(n.text,v);C(t),u.current=t,t.score>=100&&!A.current&&(A.current=!0,(async()=>(await R.current(),re(a.current)))())},[v,k,n,re]);const ne=t=>{p(t),pe(Pe,t),L(t.length===0)};s.useEffect(()=>{const t=me(Pe,[]);p(t),L(t.length===0),m(0)},[]),s.useEffect(()=>{const t=Math.ceil(l.length/b);h>=t&&t>0&&O(t-1)},[l.length,b]),s.useEffect(()=>{const t=Math.floor(f/b);t!==h&&O(t)},[f,b]);const Te=t=>{const d=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...l];ne(d),m(0),w(!1)},Ee=(t,o)=>{ne(l.map(d=>d.id===t?{...d,text:o}:d)),w(!1),y(null)},Ie=t=>{E(t)},Re=()=>{if(!F)return;const t=l.filter(d=>d.id!==F.id);let o=f;o>=t.length&&(o=Math.max(0,t.length-1)),m(o),ne(t),E(null),i("Phrase removed.","success")},Ae=()=>{if(l.length<2)return;const t=[...l].sort(()=>Math.random()-.5);ne(t),m(0),i("Queue shuffled!","success")},We=t=>{ve(t),O(0)},_e=()=>{y(null),w(!0)},$e=t=>{y(t),w(!0)},Le=t=>{V?Ee(V.id,t):Te(t)},ue=s.useCallback(async(t=!1)=>{j.current&&clearTimeout(j.current),x.current&&(clearTimeout(x.current),x.current=null),K(!1),se.current.stop();try{const o=await dt();!t&&o&&(ee(o.base64),oe(o.mimeType))}catch(o){console.error("Audio capture failed",o)}},[]),ye=s.useRef(async()=>{});s.useEffect(()=>{ye.current=async()=>{await ue(),re(a.current)}},[ue,re]),s.useEffect(()=>{R.current=()=>ye.current()},[]);const Oe=s.useCallback(async()=>{if(n){if(I&&B){H(!1);return}if(I&&!B){H(!0);return}S(!0);try{const t=n.text.trim().toLowerCase(),o=xt().find(d=>d.word.toLowerCase()===t);if(o&&o.ipaUs){te(o.ipaUs),H(!0),S(!1);return}else{const d=ft(),Y=ht(d),J=await fetch(`${Y}/api/convert/ipa?text=${encodeURIComponent(n.text)}`);if(J.ok){const he=await J.json();te(he.ipa),H(!0)}else i("IPA server unavailable","error")}}catch{i("Failed to fetch IPA","error")}finally{S(!1)}}},[n,I,B,i]);s.useEffect(()=>{if(k&&ue(!0),A.current=!1,g(M),Q(""),Z(0),r.current=0,a.current="",u.current=null,ee(null),G(null),C(null),te(null),H(!1),P.current&&(P.current.pause(),P.current=null),U.current&&n){const t=setTimeout(()=>je(n.text),500);return()=>clearTimeout(t)}},[n==null?void 0:n.id,M]),s.useEffect(()=>()=>{se.current.stop(),j.current&&clearTimeout(j.current),x.current&&clearTimeout(x.current)},[]);const Fe=async()=>{if(n)if(k)await ue(),A.current=!1,re(a.current);else{A.current=!1,x.current&&(clearTimeout(x.current),x.current=null),Q(""),Z(0),r.current=0,a.current="",u.current=null,G(null),C(null);try{await pt(),K(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>R.current(),1e4),se.current.start((t,o)=>{const d=t+o;Q(d);const Y=we(d);a.current=Y,W&&!x.current&&Y.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().length>0&&(x.current=setTimeout(()=>{x.current=null,R.current()},Me))},t=>{Q(t);const o=we(t);a.current=o,W&&!x.current&&o.toLowerCase().replace(/[^\p{L}\p{N}]+/gu," ").trim().length>0&&(x.current=setTimeout(()=>{x.current=null,R.current()},Me))})}catch(t){console.error("Failed to start recording",t),K(!1)}}},Ue=()=>{Z(D.length),r.current=D.length,a.current="",u.current=null,G(null),C(null)},De=()=>n&&je(n.text),Qe=()=>{if(q){P.current&&P.current.pause();const t=new Audio(`data:${le};base64,${q}`);P.current=t,t.play()}},qe=()=>{l.length>0&&m(t=>(t+1)%l.length)},Ge=t=>{t>=0&&t<l.length&&m(t)},Be=Math.ceil(l.length/b),He=l.slice(h*b,(h+1)*b);return e.jsxs(e.Fragment,{children:[e.jsx(wt,{targetText:(n==null?void 0:n.text)||null,sourceWord:(n==null?void 0:n.sourceWord)||"",type:(n==null?void 0:n.type)||"",isRecording:k,isRevealed:ae,userTranscript:v,matchStatus:ie,userAudioUrl:q,onToggleRecord:Fe,onPlayTarget:De,onPlayUser:Qe,onToggleReveal:()=>g(!ae),onNext:qe,onClearTranscript:Ue,isEmpty:$,onClose:_,pagedItems:He,page:h,pageSize:b,totalPages:Be,onPageChange:O,onPageSizeChange:We,onSelect:t=>Ge(h*b+t),currentAbsoluteIndex:f,autoSpeak:N,onToggleAutoSpeak:()=>xe(!N),autoReveal:M,onToggleAutoReveal:()=>fe(!M),isGlobalMode:!c,isAnalyzing:z,onAnalyze:()=>{},aiAnalysis:T?{isCorrect:T.score>80,score:T.score,feedbackHtml:""}:null,localAnalysis:T,onAddItem:_e,onEditItem:$e,onDeleteItem:Ie,onRandomize:Ae,isModalOpen:de,editingItem:V,onCloseModal:()=>w(!1),onSaveItem:Le,ipa:I,showIpa:B,isIpaLoading:ce,onToggleIpa:Oe}),e.jsx(mt,{isOpen:!!F,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:Re,onClose:()=>E(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})},Ct=({scopedWord:c,onClose:_})=>e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(yt,{scopedWord:c,onClose:_})})});export{Ct as MimicPractice};
