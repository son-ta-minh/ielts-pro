import{c as H,j as e,a_ as De,q as We,l as Le,aZ as Oe,Z as ee,i as be,aJ as Ne,r as f,P as Be,s as He,b7 as re,A as G,R as ne,X as te,o as ge,a1 as Ue,am as Ve,a as ke,b3 as Qe,b8 as ie,S as oe,v as Ye,D as de,aK as qe,b9 as Ge,T as Xe,p as ae,H as Ke,a9 as Ze,ba as J,bb as ye,J as Ce,bc as Je}from"./index-BiveeiWw.js";import{C as et,S as le,A as tt,T as st}from"./AvatarSelectionModal-DqYKw3ux.js";import{M as at}from"./move-Bzko-Lqy.js";import{T as ce}from"./trophy-CHjMxsEP.js";import{C as Se}from"./chevron-left-NqfRbzA1.js";import{S as rt}from"./square-check-big-HbIjuC7l.js";import"./palette-pqXMOdHM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=H("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=H("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=H("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=H("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=H("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=H("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=H("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=H("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=H("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=H("SquareDashed",[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=H("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),_e=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],mt=r=>{let b="Novice Soul";for(const v of _e)if(r>=v.level)b=v.title;else break;return b},q=({title:r,desc:b,icon:v,color:u,onClick:h})=>e.jsxs("button",{onClick:h,className:"group bg-white p-6 rounded-[2rem] border border-neutral-200 shadow-sm hover:shadow-lg hover:border-neutral-300 transition-all text-left flex flex-col h-full justify-between relative overflow-hidden",children:[e.jsx("div",{className:`absolute -right-6 -top-6 w-32 h-32 rounded-full opacity-20 bg-${u}-500 group-hover:scale-150 transition-transform duration-500`}),e.jsx("div",{className:`p-3 bg-${u}-50 text-${u}-600 rounded-2xl w-fit`,children:e.jsx(v,{size:24})}),e.jsxs("div",{className:"space-y-1 relative z-10 mt-4",children:[e.jsx("h3",{className:"text-lg font-black text-neutral-900",children:r}),e.jsx("p",{className:"text-xs font-medium text-neutral-500",children:b})]})]}),ut=r=>r>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:r>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:r>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:r>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},ht=({user:r,xpToNextLevel:b,onUpdateUser:v,isRecalculatingXp:u})=>{const[h,j]=f.useState(!1),F=b>0?Math.min(100,Math.max(0,r.experience/b*100)):0,w=r.peakLevel||r.level,C=w>0?Math.min(100,Math.max(0,r.level/w*100)):100,k=ut(r.level),x=r.adventure,p=mt(r.level),g=_e.find(m=>m.level>r.level),l=async m=>{await v({...r,avatar:m}),j(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>j(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${k.frame} shadow-md ${k.shadow}`,children:[e.jsx("img",{src:r.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Be,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:r.name}),u&&e.jsx(He,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(et,{size:12,className:"text-yellow-500"})," ",p]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",r.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[r.experience," / ",b," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${F}%`}})})]}),w>r.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[r.level," / ",w," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${C}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(re,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:(x==null?void 0:x.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(Fe,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[(x==null?void 0:x.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(ee,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:(x==null?void 0:x.energy)??0})]})]}),g&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",g.level," for: ",e.jsx("strong",{children:g.title})]}),e.jsx(le,{size:12,className:"text-amber-400"})]})]})]}),e.jsx(tt,{isOpen:h,onClose:()=>j(!1),onSelectAvatar:l,currentUser:r})]})},ft=({user:r,xpToNextLevel:b,gameMode:v,setGameMode:u,score:h,onExit:j,onRestart:F,isGameOver:w,xpGained:C,renderGame:k,onUpdateUser:x,isRecalculatingXp:p})=>v==="MENU"?e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pb-20",children:[e.jsx(ht,{user:r,xpToNextLevel:b,onUpdateUser:x,isRecalculatingXp:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Game Modes"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"Practice specific vocabulary skills through challenges."})]}),e.jsxs("button",{onClick:()=>u("ADVENTURE"),className:"group flex items-center gap-2 px-6 py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all active:scale-95",children:[e.jsx(nt,{size:16}),e.jsx("span",{children:"Adventure"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in fade-in duration-300",children:[e.jsx(q,{title:"Collocation Connect",desc:"Match words with partners.",icon:dt,color:"blue",onClick:()=>u("COLLO_CONNECT")}),e.jsx(q,{title:"Idiom Connect",desc:"Match words to form idioms.",icon:De,color:"amber",onClick:()=>u("IDIOM_CONNECT")}),e.jsx(q,{title:"IPA Sorter",desc:"Distinguish similar sounds.",icon:at,color:"rose",onClick:()=>u("IPA_SORTER")}),e.jsx(q,{title:"Meaning Match",desc:"Word to definition.",icon:We,color:"teal",onClick:()=>u("MEANING_MATCH")}),e.jsx(q,{title:"Sentence Scramble",desc:"Reconstruct sentences.",icon:Le,color:"emerald",onClick:()=>u("SENTENCE_SCRAMBLE")}),e.jsx(q,{title:"Preposition Power",desc:"Fill in the blanks.",icon:Oe,color:"violet",onClick:()=>u("PREPOSITION_POWER")}),e.jsx(q,{title:"Word Transformer",desc:"Change word forms.",icon:ot,color:"orange",onClick:()=>u("WORD_TRANSFORMER")}),e.jsx(q,{title:"Paraphrase Context",desc:"Match variations to context.",icon:ee,color:"cyan",onClick:()=>u("PARAPHRASE_CONTEXT")}),e.jsx(q,{title:"Word Scatter",desc:"Find words that match the cue.",icon:ct,color:"fuchsia",onClick:()=>u("WORD_SCATTER")})]})]})]}):w?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center space-y-8 animate-in zoom-in-95 pb-20",children:[e.jsx("div",{className:"p-8 bg-yellow-100 rounded-full text-yellow-600 mb-4 shadow-lg animate-bounce",children:e.jsx(ce,{size:64})}),e.jsx("h2",{className:"text-4xl font-black text-neutral-900",children:"Stage Cleared!"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-neutral-400 font-bold uppercase tracking-widest text-xs",children:"Final Score"}),e.jsx("p",{className:"text-6xl font-black text-neutral-900",children:h})]}),C&&e.jsxs("div",{className:"text-center space-y-2 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("p",{className:"text-lg font-black text-emerald-600",children:["+ ",C.amount," XP"]}),C.levelUp&&e.jsxs("p",{className:"text-2xl font-black text-yellow-600 flex items-center gap-2",children:[e.jsx(be,{size:24,className:"fill-yellow-500 text-yellow-500"}),e.jsxs("span",{children:["Level Up! Now Level ",C.newLevel,"!"]}),e.jsx(be,{size:24,className:"fill-yellow-500 text-yellow-500"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:j,className:"px-8 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Exit"}),e.jsxs("button",{onClick:F,className:"px-8 py-4 bg-neutral-900 text-white font-bold rounded-2xl hover:bg-neutral-800 transition-all shadow-lg flex items-center gap-2",children:[e.jsx(Ne,{size:18})," Play Again"]})]})]}):e.jsx("div",{className:"bg-white h-full rounded-[2.5rem] border border-neutral-200 shadow-sm animate-in fade-in duration-500 overflow-hidden",children:k()}),pt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(0);f.useEffect(()=>{const x=r.filter(l=>l.collocationsArray&&l.collocationsArray.length>0);if(x.length<5){alert("Not enough words with collocations found (need at least 5)."),v();return}const p=[...x].sort(()=>Math.random()-.5).slice(0,8),g=[];if(p.forEach(l=>{if(!l.collocationsArray)return;const m=l.collocationsArray.filter(d=>!d.isIgnored);if(m.length===0)return;const i=m[Math.floor(Math.random()*m.length)],y=l.id+Math.random(),s=l.word;let t=i.text;const a=[s,s+"s"];l.wordFamily&&(l.wordFamily.nouns&&a.push(...l.wordFamily.nouns.map(d=>d.word)),l.wordFamily.verbs&&a.push(...l.wordFamily.verbs.map(d=>d.word)),l.wordFamily.adjs&&a.push(...l.wordFamily.adjs.map(d=>d.word)),l.wordFamily.advs&&a.push(...l.wordFamily.advs.map(d=>d.word)));const n=[...new Set(a.map(d=>d.trim()).filter(Boolean))];n.sort((d,c)=>c.length-d.length);for(const d of n){const c=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),N=new RegExp(`\\b${c}\\b`,"gi");t=t.replace(N,"___")}g.push({id:`head-${y}`,text:s,type:"head",pairId:y,matched:!1}),g.push({id:`tail-${y}`,text:t,type:"tail",pairId:y,matched:!1})}),g.length===0){alert("Failed to generate game."),v();return}h(g.sort(()=>Math.random()-.5))},[]);const k=x=>{if(x.matched||j.includes(x.id)||j.length>=2)return;const p=[...j,x.id];if(F(p),p.length===2){const g=u.find(m=>m.id===p[0]),l=u.find(m=>m.id===p[1]);g&&l&&g.pairId===l.pairId&&g.id!==l.id?setTimeout(()=>{h(i=>i.map(y=>y.id===g.id||y.id===l.id?{...y,matched:!0}:y)),C(i=>i+10),F([]),u.filter(i=>!i.matched&&i.id!==g.id&&i.id!==l.id).length===0&&b(w+10)},300):(h(m=>m.map(i=>p.includes(i.id)?{...i,error:!0}:i)),setTimeout(()=>{h(m=>m.map(i=>({...i,error:!1}))),F([])},800))}};return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:w}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Collocation Connect"})]}),e.jsx("div",{className:"flex-1 bg-neutral-50/50 rounded-[3rem] border-2 border-dashed border-neutral-200 p-8 overflow-y-auto custom-scrollbar relative",children:u.length===0?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-neutral-300 font-black text-2xl",children:"Loading Deck..."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 auto-rows-[100px]",children:u.map(x=>{const p=j.includes(x.id);if(x.matched)return e.jsx("div",{className:"opacity-0"},x.id);let g="bg-white border-neutral-200 text-neutral-600 hover:border-neutral-400 hover:-translate-y-1 hover:shadow-md";return p&&(g="bg-indigo-600 border-indigo-600 text-white scale-105 shadow-xl ring-4 ring-indigo-100"),x.error&&(g="bg-red-50 border-red-500 text-white animate-shake"),e.jsx("button",{onClick:()=>k(x),className:`rounded-2xl border-b-4 p-4 flex items-center justify-center text-center transition-all duration-200 ${g}`,children:e.jsx("span",{className:"font-bold text-sm md:text-base leading-tight pointer-events-none select-none",children:x.text})},x.id)})})})]})},bt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(0);f.useEffect(()=>{const x=r.filter(l=>l.word&&l.meaningVi&&l.meaningVi.trim().length>0);if(x.length<6){alert("Not enough words with meanings found (need at least 6)."),v();return}const p=[...x].sort(()=>Math.random()-.5).slice(0,8),g=[];if(p.forEach(l=>{const m=l.id+Math.random(),i=l.word;let y=l.meaningVi;const s=[i];l.wordFamily&&(l.wordFamily.nouns&&s.push(...l.wordFamily.nouns.map(a=>a.word)),l.wordFamily.verbs&&s.push(...l.wordFamily.verbs.map(a=>a.word)),l.wordFamily.adjs&&s.push(...l.wordFamily.adjs.map(a=>a.word)),l.wordFamily.advs&&s.push(...l.wordFamily.advs.map(a=>a.word)));const t=[...new Set(s.map(a=>a.trim()).filter(Boolean))];t.sort((a,n)=>n.length-a.length);for(const a of t){const n=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`\\b${n}\\b`,"gi");y=y.replace(d,"___")}g.push({id:`word-${m}`,text:i,type:"word",pairId:m,matched:!1}),g.push({id:`meaning-${m}`,text:y,type:"meaning",pairId:m,matched:!1})}),g.length===0){alert("Failed to generate game."),v();return}h(g.sort(()=>Math.random()-.5))},[]);const k=x=>{if(x.matched||j.includes(x.id)||j.length>=2)return;const p=[...j,x.id];if(F(p),p.length===2){const g=u.find(m=>m.id===p[0]),l=u.find(m=>m.id===p[1]);g&&l&&g.pairId===l.pairId&&g.id!==l.id?setTimeout(()=>{h(i=>i.map(y=>y.id===g.id||y.id===l.id?{...y,matched:!0}:y)),C(i=>i+10),F([]),u.filter(i=>!i.matched&&i.id!==g.id&&i.id!==l.id).length===0&&b(w+10)},300):(h(m=>m.map(i=>p.includes(i.id)?{...i,error:!0}:i)),setTimeout(()=>{h(m=>m.map(i=>({...i,error:!1}))),F([])},800))}};return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:w}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Meaning Match"})]}),e.jsx("div",{className:"flex-1 bg-neutral-50/50 rounded-[3rem] border-2 border-dashed border-neutral-200 p-8 overflow-y-auto custom-scrollbar relative",children:u.length===0?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-neutral-300 font-black text-2xl",children:"Loading Deck..."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 auto-rows-[100px]",children:u.map(x=>{const p=j.includes(x.id);if(x.matched)return e.jsx("div",{className:"opacity-0"},x.id);let g="bg-white border-neutral-200 text-neutral-600 hover:border-neutral-400 hover:-translate-y-1 hover:shadow-md";return p&&(g="bg-teal-600 border-teal-600 text-white scale-105 shadow-xl ring-4 ring-teal-100"),x.error&&(g="bg-red-50 border-red-500 text-white animate-shake"),e.jsx("button",{onClick:()=>k(x),className:`rounded-2xl border-b-4 p-4 flex items-center justify-center text-center transition-all duration-200 ${g}`,children:e.jsx("span",{className:"font-bold text-sm md:text-base leading-tight pointer-events-none select-none",children:x.text})},x.id)})})})]})},gt=[{sym1:"i:",ex1:"Sheep",sym2:"ɪ",ex2:"Ship"},{sym1:"u:",ex1:"Pool",sym2:"ʊ",ex2:"Pull"},{sym1:"æ",ex1:"Bad",sym2:"e",ex2:"Bed"},{sym1:"æ",ex1:"Cat",sym2:"ʌ",ex2:"Cut"},{sym1:"ɑ:",ex1:"Car",sym2:"æ",ex2:"Cat"},{sym1:"ɒ",ex1:"Pot",sym2:"ɔ:",ex2:"Port"},{sym1:"eɪ",ex1:"Late",sym2:"e",ex2:"Let"},{sym1:"əʊ",ex1:"Coat",sym2:"ɔ:",ex2:"Caught"},{sym1:"s",ex1:"See",sym2:"ʃ",ex2:"She"},{sym1:"ʃ",ex1:"Shop",sym2:"tʃ",ex2:"Chop"},{sym1:"tʃ",ex1:"Choke",sym2:"dʒ",ex2:"Joke"},{sym1:"θ",ex1:"Think",sym2:"s",ex2:"Sink"},{sym1:"ð",ex1:"Then",sym2:"d",ex2:"Den"},{sym1:"θ",ex1:"Three",sym2:"t",ex2:"Tree"},{sym1:"n",ex1:"No",sym2:"l",ex2:"Low"},{sym1:"n",ex1:"Thin",sym2:"ŋ",ex2:"Thing"},{sym1:"v",ex1:"Vet",sym2:"w",ex2:"Wet"}],yt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(0),[k,x]=f.useState(null);f.useEffect(()=>{const l=(a,n)=>{if(n==="tʃ"||n==="dʒ")return a.includes(n);const d=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let c;if(n==="d")c=new RegExp(`${d}(?!ʒ)`);else if(n==="t")c=new RegExp(`${d}(?!ʃ)`);else if(n==="ʃ")c=new RegExp(`(?<!t)${d}`);else if(n==="ʒ")c=new RegExp(`(?<!d)${d}`);else if(n==="ɪ")c=new RegExp(`(?<![aeɔ])${d}`);else if(n==="ʊ")c=new RegExp(`(?<![aə])${d}`);else if(n==="e")c=new RegExp(`${d}(?!ɪ)`);else return a.includes(n);return c.test(a)},m=r.filter(a=>a.ipa&&a.ipa.length>2);if(m.length<5){alert("Not enough words with IPA found (need at least 5)."),v();return}const i=[];for(const a of gt){const n=m.filter(c=>l(c.ipa,a.sym1)).length,d=m.filter(c=>l(c.ipa,a.sym2)).length;n>=2&&d>=2&&n+d>=5&&i.push(a)}if(i.length===0){alert("Could not find enough words matching minimal pairs."),v();return}const y=i[Math.floor(Math.random()*i.length)];F([{symbol:y.sym1,example:y.ex1},{symbol:y.sym2,example:y.ex2}]);const s=[],t=[...m].sort(()=>Math.random()-.5);for(const a of t){const n=l(a.ipa,y.sym1),d=l(a.ipa,y.sym2);if(n||d){let c="";n&&d?c=Math.random()>.5?y.sym1:y.sym2:c=n?y.sym1:y.sym2;const N=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let I;c==="d"?I=new RegExp(`${N}(?!ʒ)`,"g"):c==="t"?I=new RegExp(`${N}(?!ʃ)`,"g"):c==="ʃ"?I=new RegExp(`(?<!t)${N}`,"g"):c==="ʒ"?I=new RegExp(`(?<!d)${N}`,"g"):c==="ɪ"?I=new RegExp(`(?<![aeɔ])${N}`,"g"):c==="ʊ"?I=new RegExp(`(?<![aə])${N}`,"g"):c==="e"?I=new RegExp(`${N}(?!ɪ)`,"g"):I=new RegExp(N,"g");let _=a.ipa.replace(I,"___");_===a.ipa&&(_=a.ipa.split(c).join("___")),s.push({id:a.id,word:a.word,ipa:a.ipa,maskedIpa:_,targetSymbol:c})}if(s.length>=15)break}if(s.length<5){alert(`Failed to build a long enough IPA queue (found ${s.length}). Need at least 5 matching words.`),v();return}h(s)},[]);const p=l=>{const m=u[0];if(!m||k)return;const i=m.targetSymbol===l;x({symbol:l,correct:i});const y=i?w+10:Math.max(0,w-5);C(y),setTimeout(()=>{const s=u.slice(1);h(s),x(null),s.length===0&&b(y)},800)},g=u[0];return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:w}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:g?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:g.word}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:g.maskedIpa.split("___").map((l,m,i)=>e.jsxs(ne.Fragment,{children:[l,m<i.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},m))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Fill the gap"})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl",children:"Loading Words..."})}),e.jsx("div",{className:"h-48 grid grid-cols-2 gap-4 mt-4 shrink-0",children:j.map((l,m)=>{const i=k&&k.symbol===l.symbol,y=i&&k.correct,s=i&&!k.correct;let t="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4",a="text-neutral-400 group-hover:text-indigo-400",n="text-neutral-600 group-hover:text-indigo-600";return y?(t+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600",a="text-emerald-500",n="text-emerald-600"):s?(t+=" bg-rose-50 border-solid border-rose-400 text-rose-600",a="text-rose-500",n="text-rose-600"):t+=" bg-neutral-100/50 border-dashed border-neutral-300 hover:bg-indigo-50 hover:border-indigo-300 hover:text-indigo-600",e.jsxs("button",{onClick:()=>p(l.symbol),disabled:!!k,className:t,children:[e.jsxs("span",{className:"text-5xl font-serif font-medium mb-1 group-hover:scale-110 transition-transform",children:["/",l.symbol,"/"]}),e.jsxs("span",{className:`text-[10px] font-black uppercase tracking-widest ${a}`,children:["As in ",e.jsx("span",{className:`font-bold ${n} underline decoration-indigo-300`,children:l.example})]})]},m)})})]})]})},vt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(new Set),[k,x]=f.useState(null),[p,g]=f.useState(0);f.useEffect(()=>{const t=r.filter(d=>d.example&&d.example.trim().split(/\s+/).filter(Boolean).length>=5);if(t.length<5){alert("Not enough words with suitable example sentences (need at least 5)."),v();return}const n=[...t].sort(()=>Math.random()-.5).slice(0,15).map(d=>{const c=d.example.trim(),I=[...c.split(/\s+/).filter(Boolean)].sort(()=>Math.random()-.5);return{id:d.id,word:d.word,originalSentence:c,shuffledWords:I}});if(n.length===0){alert("Failed to build sentence queue."),v();return}h(n)},[]);const l=u[0],m=(t,a)=>{k===null&&(F(n=>[...n,t]),C(n=>new Set(n).add(a)))},i=t=>{if(k!==null)return;const a=j[t],n=j.filter((c,N)=>N!==t);F(n);const d=l.shuffledWords;C(c=>{const N=new Set(c);for(let I=0;I<d.length;I++)if(d[I]===a&&N.has(I))return N.delete(I),N;return N})},y=()=>{const t=j.join(" ").toLowerCase().trim(),a=l.originalSentence.toLowerCase().trim();t===a?(x(!0),g(n=>n+20),setTimeout(()=>{const n=u.slice(1);h(n),n.length===0?b(p+20):(F([]),C(new Set),x(null))},1e3)):(x(!1),g(n=>Math.max(0,n-10)))},s=()=>{const t=u.slice(1);h(t),t.length===0?b(p):(F([]),C(new Set),x(null))};return e.jsxs("div",{className:"flex flex-col h-full relative p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:p}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Sentence Scramble"})]}),l?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-6",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300",children:l.word})]}),e.jsxs("div",{className:`min-h-[100px] w-full max-w-2xl bg-neutral-50 rounded-[2rem] border-2 border-dashed p-6 flex flex-wrap gap-3 items-center justify-center transition-all ${k===!0?"border-emerald-400 bg-emerald-50":k===!1?"border-rose-400 bg-rose-50":"border-neutral-200"}`,children:[j.length===0&&e.jsx("span",{className:"text-lg font-bold text-neutral-300 italic",children:"Click words below..."}),j.map((t,a)=>e.jsxs("button",{onClick:()=>i(a),className:`px-4 py-2.5 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${k===!0?"bg-emerald-600 text-white":k===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-neutral-300"}`,children:[t," ",e.jsx(te,{size:14,className:"inline-block ml-1"})]},a))]}),k===!1&&e.jsx("div",{className:"text-center text-rose-600 font-bold text-sm",children:"Incorrect! Try again."}),k===!0&&e.jsx("div",{className:"text-center text-emerald-600 font-bold text-sm",children:"Correct!"}),e.jsx("div",{className:"w-full max-w-2xl bg-neutral-100 rounded-[2rem] p-6 flex flex-wrap gap-3 justify-center",children:l.shuffledWords.map((t,a)=>e.jsx("button",{onClick:()=>m(t,a),disabled:w.has(a),className:`px-4 py-2.5 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${w.has(a)?"bg-neutral-200 text-neutral-400 cursor-not-allowed":"bg-white text-neutral-700 border-2 border-neutral-100 hover:border-neutral-300 hover:text-neutral-900"}`,children:t},a))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:s,className:"px-8 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsx("button",{onClick:y,disabled:j.length===0||k!==null,className:"px-8 py-4 bg-neutral-900 text-white font-bold rounded-2xl hover:bg-neutral-800 transition-all shadow-lg disabled:opacity-50",children:"Check Sentence"})]}),k===!1&&e.jsxs("div",{className:"mt-4 p-4 bg-neutral-100 rounded-2xl border border-neutral-200 text-center text-neutral-700 text-sm",children:['Original: "',l.originalSentence,'"']})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Loading..."})]})},wt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState(""),[w,C]=f.useState(null),[k,x]=f.useState(0);f.useEffect(()=>{const m=r.filter(s=>s.prepositions&&s.prepositions.some(t=>!t.isIgnored)&&s.example);if(m.length<5){alert("Not enough words with prepositions and examples (need at least 5)."),v();return}const y=[...m].sort(()=>Math.random()-.5).slice(0,15).map(s=>{const t=s.prepositions.filter(n=>!n.isIgnored);if(t.length===0)return null;const a=[...t].sort(()=>Math.random()-.5);for(const n of a){const d=new RegExp(`\\b${s.word}\\s+${n.prep}\\b`,"i");if(d.test(s.example)){const c=s.example.replace(d,`${s.word} ___`);return{id:s.id,word:s.word,example:c,answer:n.prep}}}return null}).filter(Boolean);if(y.length<5){alert(`Failed to build a long enough preposition queue (found ${y.length}). Need at least 5 usable examples.`),v();return}h(y)},[]);const p=u[0],g=()=>{if(!p)return;const m=j.trim().toLowerCase()===p.answer.toLowerCase();C(m),m?(x(i=>i+15),setTimeout(()=>{const i=u.slice(1);h(i),i.length===0?b(k+15):(F(""),C(null))},800)):x(i=>Math.max(0,i-8))},l=()=>{const m=u.slice(1);h(m),m.length===0?b(k):(F(""),C(null))};return e.jsxs("div",{className:"flex flex-col h-full relative p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:k}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Preposition Power"})]}),p?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-8",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900 leading-tight",children:["Preposition for: ",e.jsx("span",{className:"underline decoration-violet-300",children:p.word})]}),e.jsx("p",{className:"text-neutral-500 text-sm font-medium",children:"Fill in the missing preposition."})]}),e.jsxs("div",{className:"w-full max-w-xl bg-white p-8 rounded-[2rem] shadow-xl border border-neutral-200 text-center space-y-6",children:[e.jsx("div",{className:"text-xl font-medium text-neutral-800 leading-relaxed",children:p.example.split("___").map((m,i,y)=>e.jsxs(ne.Fragment,{children:[m,i<y.length-1&&e.jsx("input",{type:"text",value:j,onChange:s=>F(s.target.value),onKeyDown:s=>{s.key==="Enter"&&g()},disabled:w===!0,className:`inline-block w-24 h-10 mx-2 p-2 text-center text-xl font-bold rounded-lg border-b-2 outline-none transition-colors duration-200 ${w===!0?"bg-emerald-50 border-emerald-500 text-emerald-700":w===!1?"bg-rose-50 border-rose-500 text-rose-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-neutral-900 text-neutral-900 shadow-sm"}`,autoFocus:!0,autoComplete:"off"})]},i))}),w===!1&&e.jsxs("div",{className:"text-center text-rose-600 font-bold text-sm animate-in fade-in slide-in-from-top-1",children:['Incorrect! Hint: "',p.answer,'".']})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:l,className:"px-8 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsx("button",{onClick:g,disabled:j.trim().length===0||w===!0,className:"px-8 py-4 bg-neutral-900 text-white font-bold rounded-2xl hover:bg-neutral-800 transition-all shadow-lg disabled:opacity-50",children:"Check"})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Loading..."})]})},jt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState(""),[w,C]=f.useState(null),[k,x]=f.useState(0);f.useEffect(()=>{const m=r.filter(s=>{var t,a,n,d;return s.wordFamily&&(((t=s.wordFamily.nouns)==null?void 0:t.length)||0)+(((a=s.wordFamily.verbs)==null?void 0:a.length)||0)+(((n=s.wordFamily.adjs)==null?void 0:n.length)||0)+(((d=s.wordFamily.advs)==null?void 0:d.length)||0)>=2&&s.example&&s.example.trim().split(/\s+/).filter(Boolean).length>=5});if(m.length<5){alert("Not enough words with rich word families (need at least 5)."),v();return}const i=[...m].sort(()=>Math.random()-.5),y=[];for(const s of i){const t=[];s.wordFamily&&(s.wordFamily.nouns&&t.push(...s.wordFamily.nouns.filter(M=>!M.isIgnored).map(M=>M.word)),s.wordFamily.verbs&&t.push(...s.wordFamily.verbs.filter(M=>!M.isIgnored).map(M=>M.word)),s.wordFamily.adjs&&t.push(...s.wordFamily.adjs.filter(M=>!M.isIgnored).map(M=>M.word)),s.wordFamily.advs&&t.push(...s.wordFamily.advs.filter(M=>!M.isIgnored).map(M=>M.word))),t.includes(s.word)||t.push(s.word);const a=Array.from(new Set(t.map(M=>M.toLowerCase().trim())));if(a.length<2)continue;const n=s.example.trim(),d=n.split(/\s+|(?=[.,!?;:"])/).filter(Boolean).map(M=>M.toLowerCase().replace(/[.,!?;:"]$/,"")),c=a.filter(M=>d.includes(M));if(c.length===0)continue;const N=c[Math.floor(Math.random()*c.length)],I=a.filter(M=>M!==N);if(I.length===0)continue;const _=I[Math.floor(Math.random()*I.length)],D=new RegExp(`\\b(${N})\\b`,"i"),z=n.match(D);if(z&&z[1]){const M=n.replace(z[1],"___");y.push({id:s.id+N,word:s.word,sentence:M,hintWord:_,answer:N})}if(y.length>=15)break}if(y.length<5){alert(`Failed to create enough transformer items (found ${y.length}). Need at least 5.`),v();return}h(y)},[]);const p=u[0],g=()=>{if(!p)return;const m=j.trim().toLowerCase()===p.answer.toLowerCase();C(m),m?(x(i=>i+20),setTimeout(()=>{const i=u.slice(1);h(i),i.length===0?b(k+20):(F(""),C(null))},800)):x(i=>Math.max(0,i-10))},l=()=>{const m=u.slice(1);h(m),m.length===0?b(k):(F(""),C(null))};return e.jsxs("div",{className:"flex flex-col h-full relative p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:k}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Word Transformer"})]}),p?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-8",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("h3",{className:"text-2xl font-black text-neutral-900 leading-tight",children:"Word Transformation"}),e.jsxs("p",{className:"text-neutral-500 text-sm font-medium",children:['Transform "',e.jsx("span",{className:"font-bold text-orange-600",children:p.hintWord}),'" to fit.']})]}),e.jsxs("div",{className:"w-full max-w-xl bg-white p-8 rounded-[2rem] shadow-xl border border-neutral-200 text-center space-y-6",children:[e.jsx("div",{className:"text-xl font-medium text-neutral-800 leading-relaxed",children:p.sentence.split("___").map((m,i,y)=>e.jsxs(ne.Fragment,{children:[m,i<y.length-1&&e.jsx("input",{type:"text",value:j,onChange:s=>F(s.target.value),onKeyDown:s=>{s.key==="Enter"&&g()},disabled:w===!0,className:`inline-block w-32 h-10 mx-2 p-2 text-center text-xl font-bold rounded-lg border-b-2 outline-none transition-colors duration-200 ${w===!0?"bg-emerald-50 border-emerald-500 text-emerald-700":w===!1?"bg-rose-50 border-rose-500 text-rose-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-neutral-900 text-neutral-900 shadow-sm"}`,autoFocus:!0,autoComplete:"off"})]},i))}),w===!1&&e.jsxs("div",{className:"text-center text-rose-600 font-bold text-sm animate-in fade-in slide-in-from-top-1",children:['Incorrect! Hint: "',p.answer,'".']})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:l,className:"px-8 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsx("button",{onClick:g,disabled:j.trim().length===0||w===!0,className:"px-8 py-4 bg-neutral-900 text-white font-bold rounded-2xl hover:bg-neutral-800 transition-all shadow-lg disabled:opacity-50",children:"Check"})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Loading..."})]})},Nt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(0);f.useEffect(()=>{const x=r.filter(l=>l.idiomsList&&l.idiomsList.length>0);if(x.length<5){alert("Not enough words with idioms found (need at least 5)."),v();return}const p=[...x].sort(()=>Math.random()-.5).slice(0,8),g=[];if(p.forEach(l=>{if(!l.idiomsList)return;const m=l.idiomsList.filter(d=>!d.isIgnored);if(m.length===0)return;const i=m[Math.floor(Math.random()*m.length)],y=l.id+Math.random(),s=l.word;let t=i.text;const a=[s,s+"s"];l.wordFamily&&(l.wordFamily.nouns&&a.push(...l.wordFamily.nouns.map(d=>d.word)),l.wordFamily.verbs&&a.push(...l.wordFamily.verbs.map(d=>d.word)),l.wordFamily.adjs&&a.push(...l.wordFamily.adjs.map(d=>d.word)),l.wordFamily.advs&&a.push(...l.wordFamily.advs.map(d=>d.word)));const n=[...new Set(a.map(d=>d.trim()).filter(Boolean))];n.sort((d,c)=>c.length-d.length);for(const d of n){const c=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),N=new RegExp(`\\b${c}\\b`,"gi");t=t.replace(N,"___")}g.push({id:`head-${y}`,text:s,type:"head",pairId:y,matched:!1}),g.push({id:`tail-${y}`,text:t,type:"tail",pairId:y,matched:!1})}),g.length===0){alert("Failed to generate game."),v();return}h(g.sort(()=>Math.random()-.5))},[r]);const k=x=>{if(x.matched||j.includes(x.id)||j.length>=2)return;const p=[...j,x.id];if(F(p),p.length===2){const g=u.find(m=>m.id===p[0]),l=u.find(m=>m.id===p[1]);g&&l&&g.pairId===l.pairId&&g.id!==l.id?setTimeout(()=>{h(i=>i.map(y=>y.id===g.id||y.id===l.id?{...y,matched:!0}:y)),C(i=>i+10),F([]),u.filter(i=>!i.matched&&i.id!==g.id&&i.id!==l.id).length===0&&b(w+10)},300):(h(m=>m.map(i=>p.includes(i.id)?{...i,error:!0}:i)),setTimeout(()=>{h(m=>m.map(i=>({...i,error:!1}))),F([])},800))}};return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:w}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Idiom Connect"})]}),e.jsx("div",{className:"flex-1 bg-neutral-50/50 rounded-[3rem] border-2 border-dashed border-neutral-200 p-8 overflow-y-auto custom-scrollbar relative",children:u.length===0?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-neutral-300 font-black text-2xl",children:"Loading Deck..."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 auto-rows-[100px]",children:u.map(x=>{const p=j.includes(x.id);if(x.matched)return e.jsx("div",{className:"opacity-0"},x.id);let g="bg-white border-neutral-200 text-neutral-600 hover:border-neutral-400 hover:-translate-y-1 hover:shadow-md";return p&&(g="bg-amber-500 border-amber-500 text-white scale-105 shadow-xl ring-4 ring-amber-100"),x.error&&(g="bg-red-50 border-red-500 text-white animate-shake"),e.jsx("button",{onClick:()=>k(x),className:`rounded-2xl border-b-4 p-4 flex items-center justify-center text-center transition-all duration-200 ${g}`,children:e.jsx("span",{className:"font-bold text-sm md:text-base leading-tight pointer-events-none select-none",children:x.text})},x.id)})})})]})},kt=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState([]),[j,F]=f.useState([]),[w,C]=f.useState(null),[k,x]=f.useState(0),[p,g]=f.useState(null),l=f.useMemo(()=>u.some(t=>t.state==="matched"),[u]),m=()=>{const t=u.filter(a=>a.state==="matched").length;x(a=>Math.max(0,a-t*20)),h(a=>a.map(n=>({...n,state:"default"}))),F(a=>a.map(n=>({...n,state:"default"}))),C(null)};f.useEffect(()=>{const t=r.filter(N=>N.paraphrases&&N.paraphrases.filter(I=>!I.isIgnored&&I.context&&I.context.trim()).length>=4);if(t.length===0){alert("Not enough words with contextual variations found (need at least 1 word with 4+)."),v();return}const a=t[Math.floor(Math.random()*t.length)];g(a);const n=a.paraphrases.filter(N=>!N.isIgnored&&N.context&&N.context.trim()).sort(()=>Math.random()-.5).slice(0,5),d=[],c=[];if(n.forEach((N,I)=>{const _=`${a.id}-${I}`;d.push({id:`context-${_}`,text:N.context,pairId:_,state:"default"}),c.push({id:`word-${_}`,text:N.word,pairId:_,state:"default"})}),d.length<2){alert("The selected word doesn't have enough valid variations to start a game."),v();return}h(d),F(c.sort(()=>Math.random()-.5))},[r,v]);const i=t=>{w||(C(t),F(a=>a.map(n=>n.id===t?{...n,state:"selected"}:n)))},y=t=>{if(!w)return;const a=u.find(d=>d.id===t),n=j.find(d=>d.id===w);!a||!n||(a.pairId===n.pairId?(x(c=>c+20),h(c=>c.map(N=>N.id===t?{...N,state:"matched"}:N)),F(c=>c.map(N=>N.id===w?{...N,state:"matched"}:N)),C(null),u.every(c=>c.id===t||c.state==="matched")&&setTimeout(()=>b(k+20),500)):(x(d=>Math.max(0,d-5)),h(d=>d.map(c=>c.id===t?{...c,state:"error"}:c)),F(d=>d.map(c=>c.id===w?{...c,state:"error"}:c)),setTimeout(()=>{h(d=>d.map(c=>c.state==="error"?{...c,state:"default"}:c)),F(d=>d.map(c=>c.state==="error"?{...c,state:"default"}:c)),C(null)},800)))},s=(t,a)=>{switch(t){case"selected":return"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100";case"matched":return"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default";case"error":return"bg-red-500 border-red-500 text-white animate-shake";default:return a==="context"?"bg-white border-neutral-200 text-neutral-600 hover:border-neutral-400 hover:shadow-md disabled:hover:shadow-none disabled:hover:border-neutral-200":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-900 hover:bg-neutral-50 cursor-pointer disabled:cursor-not-allowed disabled:hover:bg-white"}};return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-4 shrink-0",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Quit"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:k}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Paraphrase Context"})]}),p&&e.jsx("div",{className:"text-center mb-4",children:e.jsxs("p",{className:"text-sm font-bold text-neutral-500",children:['Match variations of "',e.jsx("span",{className:"text-neutral-900 underline decoration-cyan-300",children:p.word}),'" to the correct context.']})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-center text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Context"}),u.map(t=>e.jsxs("button",{onClick:()=>y(t.id),disabled:t.state==="matched"||!w,className:`relative w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${s(t.state,"context")}`,children:[e.jsx("p",{className:"font-medium text-sm leading-snug",children:t.text}),t.state==="matched"&&e.jsx(ge,{size:16,className:"absolute top-2 right-2"})]},t.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-center text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Word / Phrase"}),j.map(t=>e.jsxs("button",{onClick:()=>i(t.id),disabled:t.state!=="default",className:`relative w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${s(t.state,"paraphrase")}`,children:[e.jsx("p",{className:"font-bold text-sm leading-snug",children:t.text}),t.state==="matched"&&e.jsx(ge,{size:16,className:"absolute top-2 right-2 text-emerald-500"})]},t.id))]})]}),l&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsxs("button",{onClick:m,className:"flex items-center gap-1.5 text-xs font-bold text-neutral-500 hover:text-neutral-900 transition-colors",children:[e.jsx(Ne,{size:12})," Reset"]})})]})]})},we=5,je=50;function se(r){const b=[...r];for(let v=b.length-1;v>0;v--){const u=Math.floor(Math.random()*(v+1));[b[v],b[u]]=[b[u],b[v]]}return b}const Ct=({words:r,onComplete:b,onExit:v})=>{const[u,h]=f.useState("SETUP"),[j,F]=f.useState(15),[w,C]=f.useState({library:!0,collocations:!0,idioms:!0}),[k,x]=f.useState([]),[p,g]=f.useState([]),[l,m]=f.useState(0),[i,y]=f.useState(0),[s,t]=f.useState([]),[a,n]=f.useState(new Set),d=f.useRef(null),[c,N]=f.useState(null),I=f.useRef(null),_=f.useMemo(()=>p.map((o,S)=>({...o,originalIndex:S})).filter(o=>!a.has(o.id)),[p,a]);f.useEffect(()=>{if(u!=="PLAYING")return;const o=[];if(r.forEach($=>{w.library&&$.meaningVi&&$.meaningVi.trim()&&o.push({text:$.word,d:$.meaningVi,cueId:`cue-${$.id}-word`}),w.collocations&&($.collocationsArray||[]).filter(L=>!L.isIgnored&&L.d&&L.d.trim()).forEach((L,K)=>{o.push({text:L.text,d:L.d,cueId:`cue-${$.id}-col-${K}`})}),w.idioms&&($.idiomsList||[]).filter(L=>!L.isIgnored&&L.d&&L.d.trim()).forEach((L,K)=>{o.push({text:L.text,d:L.d,cueId:`cue-${$.id}-idm-${K}`})})}),o.length<j){alert(`Not enough items from selected sources for this game. Need at least ${j}, but found only ${o.length}.`),h("SETUP");return}const P=se(o).slice(0,j),E=[],T=[];P.forEach($=>{E.push({id:$.cueId,text:$.d}),T.push({id:`card-${$.cueId}`,text:$.text,cueId:$.cueId,state:"default"})});const B=T.length,V=Math.ceil(Math.sqrt(B*1.6)),Pe=Math.ceil(B/V),me=10,ue=10,Ee=100-me*2,Te=100-ue*2,he=Ee/V,fe=Te/Pe,pe=Array.from({length:B},($,X)=>X);se(pe);const ze=T.map(($,X)=>{const L=pe[X],K=Math.floor(L/V),Re=L%V,Ae=me+Re*he+Math.random()*he,$e=ue+K*fe+Math.random()*fe;return{...$,x:Ae,y:$e,rotation:Math.random()*50-25,zIndex:X}});x(se(ze)),g(se(E)),m(0),y(0),t([]),n(new Set)},[u,j,r,w]),f.useEffect(()=>{u==="PLAYING"&&j>0&&a.size===j&&setTimeout(()=>b(i),800)},[u,a,j,i,b]);const D=o=>{const S=p[l];!S||a.has(S.id)||o.state!=="default"||(o.cueId===S.id?(y(P=>P+10),x(P=>P.map(E=>E.id===o.id?{...E,state:"correct"}:E)),setTimeout(()=>{const P=new Set(a).add(S.id);n(P),t(T=>[...T,o.text]),x(T=>T.filter(B=>B.id!==o.id));let E=-1;for(let T=l+1;T<p.length;T++)if(!P.has(p[T].id)){E=T;break}if(E===-1){for(let T=0;T<l;T++)if(!P.has(p[T].id)){E=T;break}}E!==-1&&m(E)},300)):(y(P=>Math.max(0,P-5)),x(P=>P.map(E=>E.id===o.id?{...E,state:"incorrect"}:E)),setTimeout(()=>{x(P=>P.map(E=>E.id===o.id?{...E,state:"default"}:E))},600)))},z=(o,S)=>{var T;if(((T=k.find(B=>B.id===S))==null?void 0:T.state)!=="default")return;o.preventDefault();const P=o.currentTarget;P.setPointerCapture(o.pointerId),I.current={x:o.clientX,y:o.clientY};const E=P.getBoundingClientRect();N({cardId:S,offsetX:o.clientX-E.left,offsetY:o.clientY-E.top}),x(B=>{const xe=Math.max(...B.map(V=>V.zIndex))+1;return B.map(V=>V.id===S?{...V,zIndex:xe}:V)})},M=o=>{if(!c||!d.current)return;o.preventDefault();const S=d.current.getBoundingClientRect(),P=Math.min(100,Math.max(0,(o.clientX-S.left-c.offsetX)/S.width*100)),E=Math.min(100,Math.max(0,(o.clientY-S.top-c.offsetY)/S.height*100));x(T=>T.map(B=>B.id===c.cardId?{...B,x:P,y:E}:B))},Y=(o,S)=>{if(o.preventDefault(),o.currentTarget.releasePointerCapture(o.pointerId),I.current){const P=o.clientX-I.current.x,E=o.clientY-I.current.y;Math.sqrt(P*P+E*E)<5&&D(S)}N(null),I.current=null},W=()=>{const o=_.findIndex(S=>S.originalIndex===l);if(o>0){const S=_[o-1];m(S.originalIndex)}},R=()=>{const o=_.findIndex(S=>S.originalIndex===l);if(o<_.length-1){const S=_[o+1];m(S.originalIndex)}},O=p[l],A=f.useMemo(()=>_.findIndex(o=>o.originalIndex===l),[_,l]),U=o=>{switch(o){case"correct":return"bg-emerald-500 border-emerald-400 text-white scale-75 opacity-0 shadow-xl z-20 pointer-events-none";case"incorrect":return"bg-red-500 border-red-400 text-white animate-shake z-20";default:return"bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-400 hover:shadow-lg"}};if(u==="SETUP"){const o=({label:P,checked:E,onChange:T})=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-neutral-50 cursor-pointer transition-colors",onClick:T,children:[E?e.jsx(rt,{size:20,className:"text-fuchsia-600"}):e.jsx(Qe,{size:20,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-sm text-neutral-800",children:P})]}),S=w.library||w.collocations||w.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Word Scatter Setup"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Choose your content and session size."})]}),e.jsxs("div",{className:"w-full max-w-sm bg-white p-8 rounded-2xl border border-neutral-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-sm font-bold text-neutral-600",children:["Items to match: ",e.jsx("span",{className:"text-2xl font-black text-fuchsia-600",children:j})]}),e.jsx("input",{id:"sessionSize",type:"range",min:we,max:je,value:j,onChange:P=>F(parseInt(P.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-xs font-bold text-neutral-400",children:[e.jsx("span",{children:we}),e.jsx("span",{children:je})]})]}),e.jsxs("div",{className:"space-y-2 pt-6 border-t border-neutral-100",children:[e.jsx("label",{className:"text-sm font-bold text-neutral-600 px-1",children:"Content Sources"}),e.jsx(o,{label:"Library Words",checked:w.library,onChange:()=>C(P=>({...P,library:!P.library}))}),e.jsx(o,{label:"Collocations",checked:w.collocations,onChange:()=>C(P=>({...P,collocations:!P.collocations}))}),e.jsx(o,{label:"Idioms",checked:w.idioms,onChange:()=>C(P=>({...P,idioms:!P.idioms}))})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 items-center",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:v,className:"px-8 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Back"}),e.jsxs("button",{onClick:()=>h("PLAYING"),disabled:!S,className:"px-8 py-4 bg-fuchsia-600 text-white font-bold rounded-2xl hover:bg-fuchsia-700 transition-all shadow-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ue,{size:18})," Start Game"]})]}),!S&&e.jsx("p",{className:"text-xs text-red-500 font-bold",children:"Please select at least one content source."})]})]})}return e.jsxs("div",{className:"flex flex-col absolute inset-0 p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>b(i),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(G,{size:18})," Finish Early"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:i}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"Word Scatter"})]}),e.jsx("div",{ref:d,className:"flex-1 bg-neutral-50/50 rounded-[2rem] border-2 border-dashed border-neutral-200 relative overflow-hidden touch-none",children:k.map(o=>e.jsx("div",{role:"button",tabIndex:o.state==="default"?0:-1,onPointerDown:S=>z(S,o.id),onPointerMove:M,onPointerUp:S=>Y(S,o),onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&D(o)},className:`absolute rounded-xl border-b-4 p-3 flex items-center justify-center text-center transition-all duration-300 cursor-grab ${U(o.state)} ${(c==null?void 0:c.cardId)===o.id?"cursor-grabbing shadow-2xl scale-105":"hover:-translate-y-1"}`,style:{left:`${o.x}%`,top:`${o.y}%`,transform:`translate(-50%, -50%) rotate(${o.rotation}deg)`,minWidth:"120px",maxWidth:"200px",zIndex:o.zIndex},children:e.jsx("span",{className:"font-bold text-sm md:text-base leading-tight pointer-events-none select-none",children:o.text})},o.id))}),e.jsxs("footer",{className:"shrink-0 mt-4 h-28 flex flex-col justify-center items-center gap-2 p-4 bg-white rounded-[2rem] border border-neutral-200 shadow-sm relative",children:[p.length>0&&e.jsxs("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-2 bg-fuchsia-500 text-white rounded-full font-black text-xs flex items-center gap-2 shadow-lg",children:[a.size," / ",j]}),e.jsxs("div",{className:"flex items-center justify-between w-full px-4",children:[e.jsx("button",{onClick:W,disabled:A<=0,className:"p-3 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Se,{size:24})}),e.jsx("div",{className:"text-center flex-1",children:O?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest flex items-center justify-center gap-1.5",children:[e.jsx(Ve,{size:12})," Find the phrase for:"]}),e.jsx("p",{className:"text-center font-bold text-neutral-800 text-base leading-tight px-4",children:O.text})]}):p.length>0&&a.size===j?e.jsx("p",{className:"text-center font-bold text-emerald-800 text-lg",children:"Well done!"}):e.jsx("p",{className:"text-center font-bold text-neutral-800 text-lg",children:"Loading Game..."})}),e.jsx("button",{onClick:R,disabled:A>=_.length-1,className:"p-3 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(ke,{size:24})})]})]}),s.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-emerald-50/50 rounded-2xl border-2 border-dashed border-emerald-200 animate-in fade-in duration-300 overflow-y-auto",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-emerald-600 tracking-widest mb-2",children:["Correct Answers (",s.length,")"]}),e.jsx("div",{className:"columns-2 md:columns-4 gap-x-4 text-sm font-bold text-emerald-800",children:s.map((o,S)=>e.jsx("p",{className:"break-inside-avoid-column mb-1",children:o},S))})]})]})},Q={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},St=r=>{var b,v;switch(r.type){case"boss":return r.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((b=r.boss_details)==null?void 0:b.image)||"👹",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(oe,{size:10,className:"text-white"})})]}):((v=r.boss_details)==null?void 0:v.image)||"👹";case"treasure":return"👑";case"key_fragment":return"🗝️";default:return"★"}},Ft=r=>r>=50?4:r>=25?3:r>=10?2:1,It=({user:r})=>{const b=Ft(r.peakLevel||1),v=b===1?"shadow-indigo-500/50":b===2?"shadow-cyan-500/60":b===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:Q.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:r.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${v}`,children:["Lvl ",r.peakLevel||1]})]})},Mt=({isOpen:r,onClose:b,defeatedBosses:v})=>r?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(ce,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:b,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:v.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(Me,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:v.map(u=>{var h,j;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(oe,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(h=u.boss_details)==null?void 0:h.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(j=u.boss_details)==null?void 0:j.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",u.id+1]})]},u.id)})})})]})}):null,_t=({user:r,progress:b,onExit:v,map:u,onMove:h,onNodeClick:j,onOpenInventory:F,onAdminAction:w})=>{const k=u.length,x=5,[p,g]=f.useState(0),[l,m]=f.useState(!1),i=Math.min(k-6,b.currentNodeIndex),y=u.filter(_=>_.type==="boss"&&_.isDefeated);f.useEffect(()=>{s()},[b.currentNodeIndex]);const s=()=>{let _=b.currentNodeIndex-Math.floor(3);_<0&&(_=0),_>i&&(_=i),g(_)},t=_=>{g(D=>{let z=_==="left"?D-1:D+1;return z<0&&(z=0),z>i&&(z=i),z})},a=k/6*100,n=-(p*(100/k)),d=n*.3,c=50/k,N=u[b.currentNodeIndex],I=(N==null?void 0:N.type)==="boss"&&!(N!=null&&N.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${a}%`,transform:`translateX(${d}%)`},children:[e.jsx("img",{src:Q.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:Q.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:Q.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"🌀"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"🌚"}),e.jsx("img",{src:Q.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:Q.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:Q.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:Q.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:Q.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"🌀"}),e.jsx("img",{src:Q.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"🌚"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(ee,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[b.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(re,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:b.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[b.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(ce,{size:18}),y.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:s,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(lt,{size:18})}),e.jsx("button",{onClick:F,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(Ie,{size:18})}),e.jsx("button",{onClick:v,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(te,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>t("left"),disabled:p===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(Se,{size:32})}),e.jsx("button",{onClick:()=>t("right"),disabled:p>=i,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(ke,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${a}%`,transform:`translateX(${n}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${c}%`,right:`${c}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${b.currentNodeIndex/(k-1)*100}%`}})})}),u.map((_,D)=>{if(D>b.currentNodeIndex+x)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/k}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},_.id);const M=D===b.currentNodeIndex,Y=D<b.currentNodeIndex,W=_.type==="boss",R=_.isDefeated;let O="w-16 h-16",A="bg-slate-800 border-slate-600 text-slate-500 cursor-default",U="",o="scale(1)";return M?(A="bg-slate-700 border-slate-500 text-slate-300",U="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):Y&&(A="bg-emerald-900/80 border-emerald-500 text-emerald-400",U="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),W&&(O="w-24 h-24",R?(A="bg-slate-800 border-slate-600 text-slate-500",M&&(A="bg-slate-700 border-slate-500 text-slate-400")):(A="bg-red-950 border-red-600 text-red-500 cursor-pointer",U="shadow-[0_0_20px_rgba(220,38,38,0.4)]",M&&(A="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",o="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/k}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[M&&e.jsx(It,{user:r}),M&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>j(_),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${O} ${A} ${U}`,style:{transform:o},children:[e.jsx("span",{className:"text-3xl font-black",children:St(_)}),W&&M&&!R&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(ie,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!M&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${Y?"text-emerald-500":"text-slate-600"}`,children:D+1})]})},_.id)})]})})]}),r.isAdmin&&w&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(st,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>w("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(ee,{size:12})," +10"]}),e.jsx("button",{onClick:()=>w("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>w("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(re,{size:12})," +1"]}),e.jsx("button",{onClick:()=>w("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>w("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"🧪+"}),e.jsx("button",{onClick:()=>w("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>w("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"🍎+"}),e.jsx("button",{onClick:()=>w("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>w("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(oe,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",b.currentNodeIndex+1," / ",u.length]}),e.jsxs("button",{onClick:h,disabled:b.energy<=0||I,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(Ye,{size:18})]})]}),e.jsx(Mt,{isOpen:l,onClose:()=>m(!1),defeatedBosses:y})]})},Z=5,Pt=({user:r,boss:b,words:v,onVictory:u,onDefeat:h,onExit:j,onUpdateUser:F})=>{const{showToast:w}=de(),[C,k]=f.useState(b.hp),[x,p]=f.useState(Z),[g,l]=f.useState(0),[m,i]=f.useState("idle"),[y,s]=f.useState("none"),[t,a]=f.useState("intro"),[n,d]=f.useState(600),[c,N]=f.useState(!1),[I,_]=f.useState(!1),D=f.useMemo(()=>[...v].sort(()=>Math.random()-.5),[v]),z=D[g%D.length];f.useEffect(()=>{if(t==="fighting"){const o=setInterval(()=>{d(S=>S<=1?(clearInterval(o),a("lost"),0):S-1)},1e3);return()=>clearInterval(o)}},[t]),f.useEffect(()=>{_(!1)},[g]);const M=async o=>{const S=o!==ae.FORGOT;a("animating"),S?(i("player-attacking"),setTimeout(()=>{i("idle"),s("boss-hit"),k(T=>Math.max(0,T-1)),setTimeout(()=>{s("none"),Y()},800)},600)):(i("boss-attacking"),setTimeout(()=>{i("idle"),s("player-hit"),p(T=>Math.max(0,T-1)),setTimeout(()=>{s("none"),Y()},800)},600));const P=S?ae.EASY:ae.FORGOT,E=Ke(z,P);E.lastReviewSessionType="boss_battle",await Ze(E)},Y=o=>{k(S=>(p(P=>(S<=0?a("won"):P<=0?a("lost"):(l(E=>E+1),a("fighting")),P)),S))},W=o=>{const S=Math.floor(o/60),P=o%60;return`${S}:${P.toString().padStart(2,"0")}`},R=o=>{var S,P;return!(o.type==="SPELLING"||o.type==="COLLOCATION_QUIZ"&&(((S=o.word.collocationsArray)==null?void 0:S.filter(T=>!T.isIgnored&&T.d))||[]).length>2||o.type==="PARAPHRASE_QUIZ"&&(((P=o.word.paraphrases)==null?void 0:P.filter(T=>!T.isIgnored))||[]).length>2)},O=async()=>{if((r.adventure.hpPotions||0)<=0)return;if(x>=Z){w("Health is already full!","info");return}p(S=>Math.min(Z,S+1));const o={...r.adventure};o.hpPotions=(o.hpPotions||0)-1,await F({...r,adventure:o}),w("+1 HP Recovered!","success")},A=async()=>{if((r.adventure.wisdomFruits||0)<=0)return;if(I){w("Hint is already active!","info");return}_(!0);const o={...r.adventure};o.wisdomFruits=(o.wisdomFruits||0)-1,await F({...r,adventure:o}),w("Wisdom Fruit Used! Hint revealed.","success")},U=(r.adventure.hpPotions||0)>0||(r.adventure.wisdomFruits||0)>0;if(t==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:b.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:b.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',b.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>a("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(ie,{size:24})," FIGHT!"]})]});if(t==="won"||t==="lost"){const o=t==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${o?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!o&&"grayscale opacity-50"}`,children:o?"🏆":"💀"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${o?"text-emerald-400":"text-red-500"}`,children:o?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:o?`"${b.dialogueWin}"`:`"${b.dialogueLose}"`}),e.jsx("button",{onClick:o?u:h,className:`px-8 py-3 font-bold rounded-xl transition-all ${o?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:o?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:b.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${C/b.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(ve,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[C," / ",b.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${y==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:b.image}),y==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"💥"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-hidden",children:[m==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(xt,{className:"fill-cyan-400 rotate-45",size:48})}),m==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(Me,{className:"fill-red-900",size:48})}),e.jsxs("div",{className:`absolute top-4 right-4 flex items-center gap-2 px-4 py-2 rounded-xl font-mono font-black border-2 backdrop-blur-md z-20 transition-all duration-300 ${n<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(qe,{size:18,className:n<60?"animate-spin":""}),e.jsx("span",{className:"text-lg tracking-widest",children:W(n)})]}),e.jsx("button",{onClick:()=>N(!c),className:`absolute top-4 left-4 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 z-20 group ${c?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{size:24}),U&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),c&&e.jsxs("div",{className:"absolute top-16 left-4 z-40 bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-left-4 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"🧪"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",r.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:O,disabled:(r.adventure.hpPotions||0)<=0||x>=Z,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"🍎"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",r.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:A,disabled:(r.adventure.wisdomFruits||0)<=0||I,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]}),t==="fighting"&&z?e.jsx("div",{className:"w-full max-w-md h-full max-h-[420px] z-10 animate-in zoom-in-95 duration-300 flex items-center",children:e.jsx(Xe,{word:z,isQuickFire:!0,onComplete:M,onClose:j,isModal:!1,disableHints:!I,forceShowHint:I,challengeFilter:R,skipRecap:!0})}):t==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[y==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"💥"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${y==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:r.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:Z}).map((o,S)=>e.jsx(ve,{size:18,fill:S<x?"#ef4444":"none",className:`transition-all duration-300 ${S<x?"text-red-500 scale-100":"text-slate-600 scale-90"}`},S))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `})]})},Et=({isOpen:r,onClose:b,badges:v,hpPotions:u,wisdomFruits:h,onUseBadge:j})=>{if(!r)return null;const F=new Set(v.filter(C=>C!=="locked_chest")).size,w=Object.keys(J).filter(C=>C!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(Ie,{size:20})," Túi đồ"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Vật phẩm & Huy hiệu thu thập được."})]}),e.jsx("button",{type:"button",onClick:b,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(ie,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"🧪"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",u]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"🍎"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",h]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(ee,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[F,"/",w]})]}),v.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Chưa có huy hiệu."}),e.jsx("p",{className:"text-xs",children:"Mở Rương hoặc đánh Boss để nhận."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:v.map((C,k)=>{const x=J[C];if(!x)return null;const p=C==="locked_chest"||C==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:x.icon}),p&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:x.name}),p&&e.jsxs("button",{onClick:()=>j(C),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(it,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${C}-${k}`)})})]})]})]})})},Tt=30,zt=({onComplete:r,badge:b})=>{const[v]=f.useState(()=>Array.from({length:Tt}).map((u,h)=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return b?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:v.map((u,h)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${u.size}px`,height:`${u.size}px`,backgroundColor:u.color,transform:`rotate(${u.angle}deg) translate(${u.distance}px)`,opacity:0,animation:`explode ${u.duration}s ease-out ${u.delay}s forwards`}},h))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:b.icon}),e.jsx(le,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx(le,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:b.name})]}),e.jsx("button",{onClick:r,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(te,{size:16})]})})]})]}):null},Rt=({user:r,onExit:b,onUpdateUser:v,onStartSession:u})=>{const{showToast:h}=de(),[j,F]=f.useState(null),[w,C]=f.useState(!1),[k,x]=f.useState(null);f.useEffect(()=>{if(!r.adventure.map){const s=ye(100);v({...r,adventure:{...r.adventure,map:s}})}},[]);const p=r.adventure.map||ye(100),g=async()=>{const s={...r.adventure};if(s.energy<=0){h("Not enough energy to move!","error");return}s.energy-=1;const t=s.currentNodeIndex+1;s.currentNodeIndex=t;const a=p[t];a&&(a.type==="standard"?(s.energyShards=(s.energyShards||0)+1,h("+1 Energy Shard ⚡","success",2e3)):a.type==="key_fragment"?(s.keyFragments=(s.keyFragments||0)+1,h("Picked up a Key Fragment 🗝️","success",3e3),s.keyFragments>=3&&(s.keyFragments-=3,s.keys=(s.keys||0)+1,h("✨ Key Fragments assembled into a Magic Key!","success",4e3))):a.type==="treasure"&&(s.badges=[...s.badges||[],"locked_chest"],h("Picked up a Locked Chest! 🧰 (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(s.hpPotions=(s.hpPotions||0)+1,h("You found an HP Potion! 🧪","success",4e3)):(s.wisdomFruits=(s.wisdomFruits||0)+1,h("You found a Wisdom Fruit! 🍎","success",4e3))),Math.random()<.2&&(s.badges=[...s.badges||[],"lucky_dice"],h("You found a Lucky Dice! 🎲","success",4e3)),await v({...r,adventure:s})},l=async s=>{if(s.id===r.adventure.currentNodeIndex&&s.type==="boss"){if(s.isDefeated){h("This boss has already been defeated.","info");return}const t=Ce().filter(c=>c.userId===r.id);if(t.length===0){h("You have no words in your library to fight a boss. Add some words first!","error");return}const a=t.filter(c=>c.lastReview);a.length<20&&h("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let n=[...a].sort(()=>.5-Math.random());if(n.length<20){const c=new Set(n.map(_=>_.id)),N=t.filter(_=>!c.has(_.id)),I=20-n.length;n.push(...[...N].sort(()=>.5-Math.random()).slice(0,I))}n=n.slice(0,20);const d={...s.boss_details,hp:20};F({boss:d,words:n})}},m=async()=>{h("Boss defeated! +1 Key Fragment","success");const s={...r.adventure};if(s.keyFragments=(s.keyFragments||0)+1,s.keyFragments>=3&&(s.keyFragments-=3,s.keys=(s.keys||0)+1,h("Key Fragments assembled into a Magic Key!","success",4e3)),s.map){const t=[...s.map],a=s.currentNodeIndex;t[a]&&(t[a]={...t[a],isDefeated:!0}),s.map=t}await v({...r,adventure:s}),F(null)},i=async s=>{const t={...r.adventure};if(t.badges=t.badges||[],s==="locked_chest"){if((t.keys||0)<=0){h("You need a Magic Key 🗝️ to open this chest!","error");return}t.keys-=1;const a=t.badges.indexOf("locked_chest");a>-1&&t.badges.splice(a,1);const n=Object.keys(J).filter(I=>I!=="locked_chest"&&I!=="lucky_dice"),d=t.badges||[],c=n.filter(I=>!d.includes(I));let N;c.length>0?N=c[Math.floor(Math.random()*c.length)]:N=n[Math.floor(Math.random()*n.length)],t.badges.push(N),await v({...r,adventure:t}),x(J[N]),C(!1)}else if(s==="lucky_dice"){const a=t.badges.indexOf("lucky_dice");if(a>-1)t.badges.splice(a,1);else return;const n=Math.random();n<.2?(t.energy+=3,h("Dice rolled! +3 Energy ⚡","success",3e3)):n<.4?(t.keys=(t.keys||0)+1,h("Dice rolled! +1 Magic Key 🗝️","success",3e3)):n<.6?(t.badges.push("locked_chest"),h("Dice rolled! +1 Locked Chest 🧰","success",3e3)):n<.8?(t.hpPotions=(t.hpPotions||0)+1,h("Dice rolled! +1 HP Potion 🧪","success",3e3)):(t.wisdomFruits=(t.wisdomFruits||0)+1,h("Dice rolled! +1 Wisdom Fruit 🍎","success",3e3)),await v({...r,adventure:t})}else x(J[s])},y=async s=>{const t={...r.adventure};if(s==="add_energy")t.energy=(t.energy||0)+10,h("Admin: +10 Energy","success");else if(s==="remove_energy")t.energy=Math.max(0,(t.energy||0)-1),h("Admin: -1 Energy","info");else if(s==="add_key")t.keys=(t.keys||0)+1,h("Admin: +1 Key","success");else if(s==="remove_key")t.keys=Math.max(0,(t.keys||0)-1),h("Admin: -1 Key","info");else if(s==="add_hp")t.hpPotions=(t.hpPotions||0)+1,h("Admin: +1 HP Potion","success");else if(s==="remove_hp")t.hpPotions=Math.max(0,(t.hpPotions||0)-1),h("Admin: -1 HP Potion","info");else if(s==="add_fruit")t.wisdomFruits=(t.wisdomFruits||0)+1,h("Admin: +1 Wisdom Fruit","success");else if(s==="remove_fruit")t.wisdomFruits=Math.max(0,(t.wisdomFruits||0)-1),h("Admin: -1 Wisdom Fruit","info");else if(s==="pass_boss"){const a=p[t.currentNodeIndex];if(a&&a.type==="boss"){if(j){await m();return}if(h("Admin: Force Boss Victory","success"),t.keyFragments=(t.keyFragments||0)+1,t.keyFragments>=3&&(t.keyFragments-=3,t.keys=(t.keys||0)+1),t.map){const n=[...t.map],d=t.currentNodeIndex;n[d]&&(n[d]={...n[d],isDefeated:!0}),t.map=n}}else h("Not currently at a boss node.","info")}await v({...r,adventure:t})};return j?e.jsx(Pt,{user:r,boss:j.boss,words:j.words,onVictory:m,onDefeat:()=>{h("You were defeated. Study more and try again!","error"),F(null)},onExit:()=>F(null),onUpdateUser:v}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{user:r,progress:r.adventure,onExit:b,map:p,onMove:g,onNodeClick:l,onOpenInventory:()=>C(!0),onAdminAction:y}),e.jsx(Et,{isOpen:w,onClose:()=>C(!1),badges:r.adventure.badges||[],onUseBadge:i,hpPotions:r.adventure.hpPotions||0,wisdomFruits:r.adventure.wisdomFruits||0}),k&&e.jsx(zt,{badge:k,onComplete:()=>x(null)})]})},Ht=({user:r,onExit:b,onGainXp:v,onRecalculateXp:u,xpGained:h,xpToNextLevel:j,totalWords:F,onStartSession:w,onUpdateUser:C,lastMasteryScoreUpdateTimestamp:k,onBulkUpdate:x})=>{const[p,g]=f.useState("MENU"),[l,m]=f.useState([]),[i,y]=f.useState(!0),[s,t]=f.useState(0),[a,n]=f.useState(!1),d=f.useRef(0),{showToast:c}=de(),N=f.useRef(u);f.useEffect(()=>{N.current=u},[u]),f.useEffect(()=>{(async()=>{y(!0);const O=Ce().filter(A=>A.userId===r.id).filter(A=>A&&!A.isPassive);if(m(O),k>d.current){const A=O.reduce((U,o)=>U+(o.masteryScore||0),0);await N.current(A),d.current=Date.now()}y(!1)})()},[r.id,k]);const I=W=>{g(W),n(!1),t(0)},_=async W=>{t(W),n(!0);let R={...r.adventure},O=!1;W>=100&&(R.keyFragments=(R.keyFragments||0)+1,O=!0),Math.random()<.2&&(R.badges=[...R.badges||[],"lucky_dice"],c("You found a Lucky Dice! 🎲","success",4e3),O=!0),Math.random()<.15&&(Math.random()<.5?(R.hpPotions=(R.hpPotions||0)+1,c("Bonus Drop: HP Potion! 🧪","success",4e3)):(R.wisdomFruits=(R.wisdomFruits||0)+1,c("Bonus Drop: Wisdom Fruit! 🍎","success",4e3)),O=!0),O&&await C({...r,adventure:R})},D=()=>{n(!1),t(0);const W=p;g("MENU"),setTimeout(()=>g(W),0)},z=W=>l.filter(R=>R.gameEligibility?R.gameEligibility.includes(W):Je(R).includes(W)),M={onComplete:_,onExit:()=>g("MENU")},Y=()=>{switch(p){case"ADVENTURE":return e.jsx(Rt,{user:r,onUpdateUser:C,onStartSession:w,onExit:()=>g("MENU")});case"COLLO_CONNECT":return e.jsx(pt,{...M,words:z("COLLO_CONNECT")});case"IDIOM_CONNECT":return e.jsx(Nt,{...M,words:z("IDIOM_CONNECT")});case"MEANING_MATCH":return e.jsx(bt,{...M,words:z("MEANING_MATCH")});case"IPA_SORTER":return e.jsx(yt,{...M,words:z("IPA_SORTER")});case"SENTENCE_SCRAMBLE":return e.jsx(vt,{...M,words:z("SENTENCE_SCRAMBLE")});case"PREPOSITION_POWER":return e.jsx(wt,{...M,words:z("PREPOSITION_POWER")});case"WORD_TRANSFORMER":return e.jsx(jt,{...M,words:z("WORD_TRANSFORMER")});case"PARAPHRASE_CONTEXT":return e.jsx(kt,{...M,words:z("PARAPHRASE_CONTEXT")});case"WORD_SCATTER":return e.jsx(Ct,{...M,words:z("MEANING_MATCH")});default:return null}};return e.jsx(ft,{user:r,xpToNextLevel:j,gameMode:p,setGameMode:I,score:s,onExit:b,onRestart:D,isGameOver:a,xpGained:h,renderGame:Y,onUpdateUser:C,isRecalculatingXp:i})};export{Ht as default};
