import{c as Oe,Y as me,r as s,k as W,aK as J,bj as Le,j as e,D as se,z as $e,bz as De,ai as ne,as as qe,i as Qe,_ as ae,ag as oe,bg as Be,bA as ce,bB as He,t as We,E as ue,aA as Je,bC as Ge}from"./index-Dqca_GqM.js";import{C as de}from"./chevron-left-DKEjHSBK.js";import{M as Ke}from"./MimicPractice_UI-BAhTlCO_.js";import"./ear-CwA3V32v.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=Oe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ve=x=>{if(!x)return[];const v=x.split(`
`),a=[];let l=null;const b=()=>{l&&((l.content.trim()||l.title!=="Introduction")&&a.push(l),l=null)};return v.forEach(c=>{const T=c.match(/^#\s+(.+)/),d=c.match(/^##\s+(.+)/);T?(l||(l={title:"Introduction",content:""}),l.content+=c+`
`):d?(b(),l={title:d[1].trim(),content:c+`
`}):(l||(l={title:"Introduction",content:""}),l.content+=c+`
`)}),b(),a.length>0?a:[{title:"General",content:x}]},Xe=()=>{const{showToast:x}=me(),[v,a]=s.useState([]),[l,b]=s.useState(null),[c,T]=s.useState(""),[d,p]=s.useState("home"),[N,m]=s.useState(!0),[O,L]=s.useState(!1),[u,j]=s.useState(0),[P,k]=s.useState(!1),C=s.useRef(null),g=s.useMemo(()=>v.find(n=>n.id===l),[v,l]),w=s.useMemo(()=>Ve(c),[c]),f=w[u],$=s.useCallback(async()=>{m(!0);try{const n=W(),i=J(n),S=await fetch(`${i}/api/ipa/modules`);if(S.ok){const y=await S.json();a(y)}}catch(n){console.error("Failed to load modules",n),x("Failed to load modules","error")}finally{m(!1)}},[x]),D=s.useCallback(async n=>{m(!0);try{const i=W(),S=J(i),y=await fetch(`${S}/api/ipa/modules/${n}`);if(y.ok){const G=await y.json();T(G.content||""),j(0)}}catch(i){console.error("Failed to load module content",i),x("Failed to load module content","error")}finally{m(!1)}},[x]);s.useEffect(()=>{$()},[$]);const o=n=>{b(n.id),D(n.filename),p("module")},I=async()=>{if(g){L(!0);try{const n=W(),i=J(n);if((await fetch(`${i}/api/ipa/modules/${g.filename}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:c})})).ok)x("Module content saved","success"),p("module");else throw new Error("Save failed")}catch(n){console.error("Failed to save content",n),x("Failed to save content","error")}finally{L(!1)}}};s.useEffect(()=>{const n=i=>{C.current&&!C.current.contains(i.target)&&k(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const R=s.useMemo(()=>Le((f==null?void 0:f.content)||""),[f]);return N&&d==="home"&&v.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(se,{className:"w-8 h-8 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"h-full flex flex-col bg-neutral-50/30",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 py-3 border-b flex items-center justify-between bg-white/80 backdrop-blur-md sticky top-0 z-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d!=="home"&&e.jsx("button",{onClick:()=>p("home"),className:"p-2 hover:bg-neutral-100 rounded-full transition-colors text-neutral-500",title:"Back to Home",children:e.jsx($e,{size:20})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-sm font-black text-neutral-900 tracking-tight",children:"Pronunciation Roadmap"}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:d==="home"?"Course Overview":d==="edit"?"Editor":g==null?void 0:g.title})]})]}),d==="module"&&w.length>1&&e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(Math.max(0,u-1)),disabled:u===0,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 disabled:opacity-30 transition-colors",children:e.jsx(de,{size:16})}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsx("button",{onClick:()=>k(!P),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-4 py-1 transition-colors min-w-[140px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-xs text-neutral-900 truncate max-w-[120px]",children:f==null?void 0:f.title}),e.jsx(De,{size:10,className:"text-neutral-400"})]})}),P&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-top z-50",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:w.map((n,i)=>e.jsxs("button",{onClick:()=>{j(i),k(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${i===u?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:[e.jsx("span",{className:"inline-block w-4 text-neutral-300 font-mono text-[10px]",children:i+1}),n.title]},i))})})]}),e.jsx("button",{onClick:()=>j(Math.min(w.length-1,u+1)),disabled:u===w.length-1,className:"p-1.5 bg-neutral-100 rounded-lg text-neutral-600 hover:bg-neutral-200 disabled:opacity-30 transition-colors",children:e.jsx(ne,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-2",children:d==="edit"?e.jsxs("button",{onClick:I,disabled:O,className:"flex items-center gap-2 px-4 py-2 text-xs font-black bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 transition-all shadow-lg shadow-indigo-200 active:scale-95 uppercase tracking-widest",children:[O?e.jsx(se,{size:14,className:"animate-spin"}):e.jsx(qe,{size:14}),"Save Changes"]}):d==="module"?e.jsxs("button",{onClick:()=>p("edit"),className:"flex items-center gap-2 px-4 py-2 text-xs font-black border-2 border-neutral-100 bg-white text-neutral-600 rounded-xl hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(Ye,{size:14}),"Edit Content"]}):null})]}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:d==="home"?e.jsx("div",{className:"h-full overflow-y-auto p-8 md:p-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-10 text-center",children:[e.jsx("h1",{className:"text-3xl font-black text-neutral-900 tracking-tight mb-2",children:"Pronunciation Roadmap"}),e.jsx("p",{className:"text-sm font-medium text-neutral-500",children:"Master English sounds with structured lessons and interactive practice."})]}),N?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(se,{className:"w-8 h-8 animate-spin text-neutral-300"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map((n,i)=>e.jsxs("button",{onClick:()=>o(n),className:"group relative flex flex-col items-start p-6 bg-white border-2 border-neutral-100 rounded-3xl hover:border-indigo-500 hover:shadow-xl hover:shadow-indigo-500/10 transition-all text-left active:scale-[0.98]",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-neutral-50 flex items-center justify-center text-neutral-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors mb-4",children:e.jsx(Qe,{size:20})}),e.jsxs("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-1",children:["Module ",i+1]}),e.jsx("h3",{className:"text-base font-black text-neutral-900 group-hover:text-indigo-600 transition-colors leading-tight",children:n.title}),e.jsxs("div",{className:"mt-4 flex items-center gap-1.5 text-[10px] font-bold text-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity",children:["Start Learning ",e.jsx(ne,{size:12})]})]},n.id))})]})}):d==="edit"?e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("textarea",{value:c,onChange:n=>T(n.target.value),className:"flex-grow w-full p-8 text-sm resize-none focus:outline-none font-mono leading-relaxed bg-neutral-50/50",placeholder:"# Module Title\\n\\nIntro content...\\n\\n## Section 1\\n\\nContent..."})}):e.jsx("div",{className:"h-full overflow-y-auto p-8 md:p-12 bg-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"prose prose-neutral max-w-none prose-headings:font-black prose-headings:tracking-tight prose-p:leading-relaxed prose-strong:font-black prose-a:text-indigo-600 prose-img:rounded-3xl prose-img:shadow-xl",dangerouslySetInnerHTML:{__html:R}}),e.jsxs("div",{className:"mt-16 pt-8 border-t flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>j(Math.max(0,u-1)),disabled:u===0,className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-sm text-neutral-500 hover:bg-neutral-100 disabled:opacity-0 transition-colors",children:[e.jsx(de,{size:18})," Previous"]}),e.jsx("button",{onClick:()=>p("home"),className:"px-4 py-2 rounded-xl font-black text-[10px] uppercase tracking-widest text-neutral-400 hover:text-neutral-900 hover:bg-neutral-50 transition-colors",children:"Back to Overview"}),e.jsxs("button",{onClick:()=>j(Math.min(w.length-1,u+1)),disabled:u===w.length-1,className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-sm text-indigo-600 hover:bg-indigo-50 disabled:opacity-0 transition-colors",children:["Next ",e.jsx(ne,{size:18})]})]})]})})})]})},xe="vocab_pro_mimic_practice_queue",Ze=({scopedWord:x,onClose:v})=>{const[a,l]=s.useState([]),[b,c]=s.useState(0),[T,d]=s.useState(!1),[p,N]=s.useState(0),[m,O]=s.useState(10),[L,u]=s.useState(!1),[j,P]=s.useState(null),[k,C]=s.useState(null),[g,w]=s.useState(()=>ae("vocab_pro_mimic_autospeak",!1)),[f,$]=s.useState(()=>ae("vocab_pro_mimic_autoreveal",!0)),D=s.useRef(g);s.useEffect(()=>{oe("vocab_pro_mimic_autospeak",g),D.current=g},[g]),s.useEffect(()=>{oe("vocab_pro_mimic_autoreveal",f)},[f]);const o=a[b]||null,[I,R]=s.useState(!1),[n,i]=s.useState(!1),[S,y]=s.useState(""),[G,K]=s.useState(0),[Y,le]=s.useState(null),[fe,he]=s.useState("audio/webm"),[pe,V]=s.useState(null),[q,X]=s.useState(null),[Q,E]=s.useState(!1),[ge,Z]=s.useState(!1),[B,z]=s.useState(null),be=!1,ee=s.useRef(new Be),A=s.useRef(null),M=s.useRef(null),re=s.useRef(()=>{}),{showToast:U}=me(),_=S.substring(G).trimStart();s.useEffect(()=>{if(I&&o&&_){const t=ce(o.text,_);z(t)}},[_,I,o]);const F=t=>{l(t),oe(xe,t),d(t.length===0)};s.useEffect(()=>{const t=ae(xe,[]);l(t),d(t.length===0),c(0)},[]),s.useEffect(()=>{const t=Math.ceil(a.length/m);p>=t&&t>0&&N(t-1)},[a.length,m]),s.useEffect(()=>{const t=Math.floor(b/m);t!==p&&N(t)},[b,m]);const ve=t=>{const h=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...a];F(h),c(0),u(!1)},je=(t,r)=>{F(a.map(h=>h.id===t?{...h,text:r}:h)),u(!1),P(null)},we=t=>{C(t)},ye=()=>{if(!k)return;const t=a.filter(h=>h.id!==k.id);let r=b;r>=t.length&&(r=Math.max(0,t.length-1)),c(r),F(t),C(null),U("Phrase removed.","success")},Se=()=>{if(a.length<2)return;const t=[...a].sort(()=>Math.random()-.5);F(t),c(0),U("Queue shuffled!","success")},Ne=t=>{O(t),N(0)},ke=()=>{P(null),u(!0)},Ce=t=>{P(t),u(!0)},Ie=t=>{j?je(j.id,t):ve(t)},H=s.useCallback(async(t=!1)=>{M.current&&clearTimeout(M.current),R(!1),ee.current.stop();try{const r=await He();!t&&r&&(le(r.base64),he(r.mimeType))}catch(r){console.error("Audio capture failed",r)}},[]);s.useEffect(()=>{re.current=H},[H]);const Me=s.useCallback(async()=>{if(o){if(q&&Q){E(!1);return}if(q&&!Q){E(!0);return}Z(!0);try{const t=o.text.trim().toLowerCase(),r=We().find(h=>h.word.toLowerCase()===t);if(r&&r.ipaUs){X(r.ipaUs),E(!0),Z(!1);return}else{const h=W(),te=J(h),ie=await fetch(`${te}/api/convert/ipa?text=${encodeURIComponent(o.text)}`);if(ie.ok){const Fe=await ie.json();X(Fe.ipa),E(!0)}else U("IPA server unavailable","error")}}catch{U("Failed to fetch IPA","error")}finally{Z(!1)}}},[o,q,Q,U]);s.useEffect(()=>{if(I&&H(!0),i(f),y(""),K(0),le(null),V(null),z(null),X(null),E(!1),A.current&&(A.current.pause(),A.current=null),D.current&&o){const t=setTimeout(()=>ue(o.text),500);return()=>clearTimeout(t)}},[o==null?void 0:o.id,f]),s.useEffect(()=>()=>{ee.current.stop(),M.current&&clearTimeout(M.current)},[]);const Te=async()=>{if(o)if(I){await H();const t=ce(o.text,_);z(t);const r=a.map((h,te)=>te===b?{...h,lastScore:t.score}:h);F(r)}else{y(""),K(0),V(null),z(null);try{await Ge(),R(!0),M.current&&clearTimeout(M.current),M.current=setTimeout(()=>re.current(),1e4),ee.current.start((t,r)=>y(t+r),t=>y(t))}catch(t){console.error("Failed to start recording",t),R(!1)}}},Pe=()=>{K(S.length),V(null),z(null)},Ae=()=>o&&ue(o.text),Re=()=>{if(Y){A.current&&A.current.pause();const t=new Audio(`data:${fe};base64,${Y}`);A.current=t,t.play()}},Ee=()=>{a.length>0&&c(t=>(t+1)%a.length)},ze=t=>{t>=0&&t<a.length&&c(t)},Ue=Math.ceil(a.length/m),_e=a.slice(p*m,(p+1)*m);return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{targetText:(o==null?void 0:o.text)||null,sourceWord:(o==null?void 0:o.sourceWord)||"",type:(o==null?void 0:o.type)||"",isRecording:I,isRevealed:n,userTranscript:_,matchStatus:pe,userAudioUrl:Y,onToggleRecord:Te,onPlayTarget:Ae,onPlayUser:Re,onToggleReveal:()=>i(!n),onNext:Ee,onClearTranscript:Pe,isEmpty:T,onClose:v,pagedItems:_e,page:p,pageSize:m,totalPages:Ue,onPageChange:N,onPageSizeChange:Ne,onSelect:t=>ze(p*m+t),currentAbsoluteIndex:b,autoSpeak:g,onToggleAutoSpeak:()=>w(!g),autoReveal:f,onToggleAutoReveal:()=>$(!f),isGlobalMode:!x,isAnalyzing:be,onAnalyze:()=>{},aiAnalysis:B?{isCorrect:B.score>80,score:B.score,feedbackHtml:""}:null,localAnalysis:B,onAddItem:ke,onEditItem:Ce,onDeleteItem:we,onRandomize:Se,isModalOpen:L,editingItem:j,onCloseModal:()=>u(!1),onSaveItem:Ie,ipa:q,showIpa:Q,isIpaLoading:ge,onToggleIpa:Me}),e.jsx(Je,{isOpen:!!k,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:ye,onClose:()=>C(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})},at=({scopedWord:x,onClose:v})=>{const[a,l]=s.useState("IPA");return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"flex-shrink-0 border-b bg-white",children:e.jsxs("div",{className:"px-4 flex items-center justify-center gap-1",children:[e.jsxs("button",{onClick:()=>l("IPA"),className:`px-4 py-2 text-xs font-bold transition-all relative ${a==="IPA"?"text-indigo-600":"text-neutral-500 hover:text-neutral-700"}`,children:["Pronunciation Roadmap",a==="IPA"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>l("FOCUS"),className:`px-4 py-2 text-xs font-bold transition-all relative ${a==="FOCUS"?"text-indigo-600":"text-neutral-500 hover:text-neutral-700"}`,children:["Pronunciation Focus",a==="FOCUS"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]})]})}),e.jsxs("div",{className:"flex-grow overflow-hidden",children:[a==="IPA"&&e.jsx(Xe,{}),a==="FOCUS"&&e.jsx(Ze,{scopedWord:x,onClose:v})]})]})};export{at as MimicPractice};
