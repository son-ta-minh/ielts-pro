import{r as n,D as $,j as e,A as _,a2 as Q,a3 as E,p as B,a6 as J,ao as W,X,aX as G,b3 as H,G as K,a5 as k,a as V}from"./index-DKyvuxlh.js";import{B as P,I as Y,a as Z,C as U,T as ee}from"./ShelfModals-BLvDlSJ-.js";import{U as te}from"./UniversalCard-BfG7pTzy.js";import{P as se}from"./pen-Bz0AOi34.js";import{P as le}from"./palette-CyzRMsQu.js";import{S as re}from"./square-check-big-_ots1SEi.js";const ne=({isOpen:s,onClose:x,items:g,currentIds:v,onAdd:a,itemIcon:h})=>{const[m,o]=n.useState(""),[c,N]=n.useState(new Set),y=n.useMemo(()=>{const l=m.toLowerCase();return g.filter(b=>!v.has(b.id)&&b.title.toLowerCase().includes(l))},[g,m,v]),T=l=>{N(b=>{const j=new Set(b);return j.has(l)?j.delete(l):j.add(l),j})};return s?e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Add Content"}),e.jsx("button",{onClick:x,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(X,{size:20})})]}),e.jsx("div",{className:"p-4 border-b border-neutral-50",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-300",size:14}),e.jsx("input",{value:m,onChange:l=>o(l.target.value),placeholder:"Search library...",className:"w-full pl-9 pr-4 py-2 bg-neutral-50 border border-neutral-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:[y.map(l=>e.jsxs("div",{onClick:()=>T(l.id),className:`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all ${c.has(l.id)?"bg-indigo-50 border-indigo-200":"bg-white border-neutral-100 hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsx("div",{className:"text-neutral-400",children:h}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-neutral-900",children:l.title}),l.subtitle&&e.jsx("div",{className:"text-xs text-neutral-500",children:l.subtitle})]})]}),c.has(l.id)?e.jsx(re,{size:20,className:"text-indigo-600"}):e.jsx(H,{size:20,className:"text-neutral-300"})]},l.id)),y.length===0&&e.jsx("p",{className:"text-center text-xs text-neutral-400 py-10",children:"No matching items found."})]}),e.jsxs("footer",{className:"px-8 py-4 border-t border-neutral-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:x,className:"px-5 py-2 text-xs font-bold text-neutral-500 hover:text-neutral-900",children:"Cancel"}),e.jsxs("button",{onClick:()=>{a(Array.from(c)),x()},disabled:c.size===0,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 disabled:opacity-50",children:[e.jsx(E,{size:14})," Add (",c.size,")"]})]})]})}):null},xe=({book:s,items:x,availableItems:g,onBack:v,onUpdateBook:a,onAddItem:h,onRemoveItem:m,onOpenItem:o,onEditItem:c,onFocusChange:N,onToggleFocus:y,itemIcon:T})=>{const[l,b]=n.useState(!1),[j,u]=n.useState(""),[i,r]=n.useState(!1),[d,p]=n.useState(""),[f,C]=n.useState(!1),[z,I]=n.useState(""),[M,A]=n.useState(!1),L=n.useRef(null),{showToast:R}=$(),O=n.useMemo(()=>{const t=s.title.split(":");return t.length>1?t.slice(1).join(":").trim():s.title},[s.title]);n.useEffect(()=>{var t,w;u(O),p(s.icon||""),I((t=s.color)!=null&&t.startsWith("http")||(w=s.color)!=null&&w.startsWith("data:")?s.color:"")},[s,O]),n.useEffect(()=>{const t=w=>{L.current&&!L.current.contains(w.target)&&C(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const F=()=>{const w=`${s.title.split(":")[0].trim()}: ${j.trim()}`;w!==s.title&&a({title:w}),b(!1)},D=()=>{d!==s.icon&&a({icon:d.trim()}),r(!1)},q=t=>{h(t),R(`Added ${t.length} items.`,"success")};return e.jsxs("div",{className:"h-full flex flex-col animate-in fade-in duration-500",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 gap-4 shrink-0 bg-white border-b border-neutral-100 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors",children:[" ",e.jsx(_,{size:16})," Back "]}),e.jsxs("div",{className:"flex items-center gap-4",children:[i?e.jsx("input",{value:d,onChange:t=>p(t.target.value),onBlur:D,onKeyDown:t=>{t.key==="Enter"&&t.currentTarget.blur()},autoFocus:!0,placeholder:"Emoji",className:"text-2xl w-24 text-center bg-neutral-100 border border-neutral-300 rounded-lg py-1 outline-none ring-2 ring-indigo-300"}):e.jsx("div",{onClick:()=>r(!0),className:"p-1 rounded-lg hover:bg-neutral-100 cursor-pointer min-w-10 flex items-center justify-center",children:s.icon?e.jsx(P,{icon:s.icon,className:"text-2xl w-10 h-10 flex items-center justify-center mx-auto"}):e.jsx("div",{className:"w-10 h-10 rounded-xl border-2 border-dashed border-neutral-200 flex items-center justify-center text-neutral-300",children:e.jsx(Y,{size:18})})}),l?e.jsx("input",{value:j,onChange:t=>u(t.target.value),onBlur:F,onKeyDown:t=>{t.key==="Enter"&&t.currentTarget.blur()},autoFocus:!0,className:"text-xl font-black text-neutral-900 bg-neutral-100 border border-neutral-300 rounded-lg px-2 py-1 outline-none ring-2 ring-indigo-300"}):e.jsxs("div",{onClick:()=>b(!0),className:"group/title relative p-1 rounded-lg hover:bg-neutral-100 cursor-pointer flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-black text-neutral-900 tracking-tight",style:{color:s.titleColor||"#171717",fontSize:s.titleSize?`${s.titleSize}px`:"inherit"},children:j}),e.jsx(se,{size:14,className:"text-neutral-400 opacity-0 group-hover/title:opacity-100 transition-opacity"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",ref:L,children:[e.jsxs("button",{onClick:()=>C(!f),className:`p-2.5 rounded-xl transition-all border shadow-sm flex items-center justify-center gap-2 ${f?"bg-neutral-900 text-white border-neutral-900 shadow-md":"bg-white text-neutral-500 border-neutral-200 hover:bg-neutral-50 hover:text-neutral-900"}`,title:"Change Cover Design",children:[e.jsx(le,{size:18}),f&&e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest mr-1",children:"Design"})]}),f&&e.jsxs("div",{className:"absolute top-full right-0 mt-3 p-5 bg-white rounded-3xl shadow-[0_20px_50px_-12px_rgba(0,0,0,0.25)] border border-neutral-100 z-[100] animate-in fade-in zoom-in-95 origin-top-right w-80 space-y-5",children:[e.jsx("div",{className:"flex justify-center border-b border-neutral-100 pb-4",children:e.jsx("div",{className:"w-32 h-44 shadow-lg rounded-lg overflow-hidden transform rotate-2",children:e.jsx(Z,{id:s.id,title:j,icon:e.jsx(P,{icon:d||s.icon||"",className:"text-3xl"}),color:s.color,titleColor:s.titleColor,titleSize:s.titleSize,titleTop:s.titleTop,titleLeft:s.titleLeft,iconTop:s.iconTop,iconLeft:s.iconLeft,onClick:()=>{}})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 px-1 border-b border-neutral-50 pb-2",children:e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Cover Color"})}),e.jsx("div",{className:"grid grid-cols-5 gap-3 justify-items-center",children:U.map(t=>e.jsx("button",{onClick:()=>a({color:t}),className:`w-8 h-8 rounded-full transition-all hover:scale-125 active:scale-90 ${s.color===t?"ring-2 ring-neutral-900 ring-offset-2 scale-110 shadow-md":"opacity-90 hover:opacity-100 shadow-sm border border-black/5"}`,style:{backgroundColor:t}},t))})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-neutral-50",children:[e.jsx("div",{className:"flex items-center gap-2 px-1",children:e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Title Style"})}),e.jsxs("div",{className:"space-y-3 px-1",children:[e.jsx("div",{className:"grid grid-cols-5 gap-3 justify-items-center",children:ee.map(t=>e.jsx("button",{onClick:()=>a({titleColor:t}),className:`w-6 h-6 rounded-md border transition-all ${s.titleColor===t?"ring-2 ring-indigo-500":"border-neutral-200"}`,style:{backgroundColor:t}},t))}),e.jsxs("div",{className:"flex items-center gap-3 bg-neutral-50 p-2 rounded-xl",children:[e.jsx(Q,{size:14,className:"text-neutral-400"}),e.jsx("input",{type:"range",min:"12",max:"48",value:s.titleSize||24,onChange:t=>a({titleSize:parseInt(t.target.value)}),className:"flex-1 accent-neutral-900 h-1"})]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-neutral-50",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Layout"}),e.jsx("button",{onClick:()=>a({titleTop:void 0,titleLeft:void 0,iconTop:void 0,iconLeft:void 0}),className:"text-[8px] font-black text-indigo-600 hover:underline uppercase",children:"Center All"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-1",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[8px] font-bold text-neutral-400 uppercase flex items-center gap-1",children:"Title Pos"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"number",value:s.titleTop??50,onChange:t=>a({titleTop:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"}),e.jsx("input",{type:"number",value:s.titleLeft??50,onChange:t=>a({titleLeft:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[8px] font-bold text-neutral-400 uppercase flex items-center gap-1",children:"Icon Pos"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"number",value:s.iconTop??40,onChange:t=>a({iconTop:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"}),e.jsx("input",{type:"number",value:s.iconLeft??50,onChange:t=>a({iconLeft:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"})]})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-neutral-50",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Image URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:z,onChange:t=>I(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(a({color:z.trim()}),C(!1))},placeholder:"https://...",className:"flex-1 px-3 py-1.5 bg-neutral-50 border border-neutral-200 rounded-lg text-[10px] font-medium focus:ring-1 focus:ring-neutral-900 outline-none"}),e.jsx("button",{onClick:()=>a({color:z.trim()}),className:"p-1.5 bg-neutral-900 text-white rounded-lg hover:bg-neutral-800",children:e.jsx(E,{size:14})})]})]})]})]}),e.jsxs("button",{onClick:()=>A(!0),className:"px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(E,{size:14})," Add Content"]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 bg-neutral-50/50 relative",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 relative z-10",children:[x.map((t,w)=>e.jsx(te,{title:t.title,compact:!1,onClick:()=>o(t),isCompleted:t.isCompleted,focusColor:t.focusColor,onFocusChange:S=>N(t,S),isFocused:t.isFocused,onToggleFocus:()=>y(t),actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),o(t)},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(B,{size:14})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),c(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(J,{size:14})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),m(t.id)},className:"p-1.5 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove from Book",children:e.jsx(W,{size:14})})]}),children:t.subtitle&&e.jsx("p",{className:"line-clamp-2 text-xs",children:t.subtitle})},`${t.id}-${w}`)),x.length===0&&e.jsxs("div",{className:"col-span-full py-20 text-center text-neutral-400 border-2 border-dashed border-neutral-200 rounded-3xl",children:[e.jsx("p",{className:"font-bold",children:"This book is empty."}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Add Content" to fill it up.'})]})]})}),e.jsx(ne,{isOpen:M,onClose:()=>A(!1),items:g,currentIds:new Set(x.map(t=>t.id)),onAdd:q,itemIcon:T})]})},he=(s,x)=>{const[g,v]=n.useState(()=>K(x,[])),[a,h]=n.useState(0),{showToast:m}=$(),o=n.useMemo(()=>{const i=new Set(s.map(p=>{const f=p.title.split(":");return f.length>1?f[0].trim():"General"})),r=new Set([...g,...Array.from(i)]),d=Array.from(r).sort((p,f)=>p==="General"?-1:f==="General"?1:p.localeCompare(f));return d.length>0?d:["General"]},[s,g]);n.useEffect(()=>{a>=o.length&&h(Math.max(0,o.length-1))},[o.length]);const c=o[a]||"General",N=n.useMemo(()=>s.filter(i=>{const r=i.title.split(":");return(r.length>1?r[0].trim():"General")===c}),[s,c]);return{allShelves:o,currentShelfName:c,booksOnCurrentShelf:N,currentShelfIndex:a,addShelf:i=>{const r=i.trim();if(o.map(p=>p.toLowerCase()).includes(r.toLowerCase()))return m("Shelf name already exists.","error"),!1;const d=[...g,r];return v(d),k(x,d),o.length,setTimeout(()=>{},0),m(`Shelf "${r}" created.`,"success"),!0},renameShelf:(i,r)=>{const d=c,p=i.trim();if(o.map(C=>C.toLowerCase()).includes(p.toLowerCase()))return m("Shelf name already exists.","error"),!1;let f;return g.includes(d)?f=g.map(C=>C===d?p:C):f=[...g,p],v(f),k(x,f),r(d,p),m(`Renamed to "${p}".`,"success"),!0},removeShelf:()=>{if(N.length>0)return m("Cannot remove a shelf that contains books.","error"),!1;if(c==="General")return m("Cannot remove General shelf.","error"),!1;const i=g.filter(r=>r!==c);return v(i),k(x,i),h(r=>Math.max(0,r-1)),!0},nextShelf:()=>h((a+1)%o.length),prevShelf:()=>h((a-1+o.length)%o.length),selectShelf:i=>{const r=o.indexOf(i);r!==-1&&h(r)}}},me=({shelves:s,books:x,onNavigateShelf:g,onNavigateBook:v,placeholder:a="Search shelf or book..."})=>{const[h,m]=n.useState(""),[o,c]=n.useState(!1),N=n.useRef(null);n.useEffect(()=>{const l=b=>{N.current&&!N.current.contains(b.target)&&c(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const y=n.useMemo(()=>{if(!h.trim())return[];const l=h.toLowerCase(),b=s.filter(u=>u.toLowerCase().includes(l)).map(u=>({type:"shelf",id:u,label:u})),j=x.filter(u=>{const i=u.title||u.topic||"",r=i.split(":");return(r.length>1?r.slice(1).join(":").trim():i).toLowerCase().includes(l)}).map(u=>{const i=u.title||u.topic||"",r=i.split(":"),d=r.length>1?r.slice(1).join(":").trim():i;return{type:"book",id:u.id,label:d,shelf:r[0].trim()||"General",data:u}});return[...b,...j].slice(0,10)},[h,s,x]),T=l=>{l.type==="shelf"?g(l.id):v(l.data),m(""),c(!1)};return e.jsxs("div",{className:"flex-1 max-w-md relative mx-4",ref:N,children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:h,onChange:l=>{m(l.target.value),c(!0)},onFocus:()=>c(!0),placeholder:a,className:"w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-2xl text-xs font-bold focus:ring-2 focus:ring-neutral-900 outline-none transition-all shadow-sm"})]}),o&&y.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-neutral-100 rounded-2xl shadow-xl z-[100] overflow-hidden animate-in fade-in zoom-in-95",children:y.map((l,b)=>e.jsxs("button",{onClick:()=>T(l),className:"w-full text-left px-4 py-3 hover:bg-neutral-50 transition-colors flex items-center justify-between border-b border-neutral-50 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-black text-neutral-900",children:l.label}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest",children:l.type==="shelf"?"Shelf":`Book â€¢ ${l.shelf}`})]}),e.jsx(V,{size:14,className:"text-neutral-300"})]},b))})]})};export{xe as G,me as S,he as u};
