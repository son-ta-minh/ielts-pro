import{c as Fe,r as s,j as e,X as oe,ae as xe,I as he,by as me,S as Oe,h as Ue,bz as Le,ay as We,ai as Qe,H as ie,bA as qe,V as De,E as Ge,A as Be,b2 as He,M as Ke,ah as Ve,K as Je,aM as Ye,as as Xe,$ as ae,ag as le,bf as Ze,_ as et,bB as fe,bC as tt,t as st,k as rt,aK as nt,aA as at,bD as lt}from"./index-DBwLYmpY.js";import{E as ot}from"./ear-Cfizephv.js";import{C as it}from"./chevron-left-nViReqLp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=Fe("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),pe=({isOpen:o,onClose:z,onSave:a,initialData:m})=>{const[u,h]=s.useState(""),I=s.useRef(null);s.useEffect(()=>{o&&(h((m==null?void 0:m.text)||""),setTimeout(()=>{var c;return(c=I.current)==null?void 0:c.focus()},100))},[o,m]);const E=c=>{c.preventDefault(),u.trim()&&a(u.trim())};return o?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:E,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:m?"Edit Phrase":"Add New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Enter the text you want to practice mimicking."})]}),e.jsx("button",{type:"button",onClick:z,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(oe,{size:20})})]}),e.jsx("main",{className:"p-8",children:e.jsx("textarea",{ref:I,value:u,onChange:c=>h(c.target.value),placeholder:"e.g. It's not a matter of if, but when.",rows:5,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-base leading-relaxed",required:!0})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Xe,{size:14})," Save Phrase"]})})]})}):null},ut=({score:o})=>o===void 0?e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-200",title:"Not practiced yet"}):e.jsx("div",{className:`flex items-center justify-center px-1.5 py-0.5 rounded-md ${o>=80?"bg-green-100 text-green-700":o>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.jsx("span",{className:"text-[9px] font-black",children:o})}),dt=({targetText:o,sourceWord:z,isRecording:a,isRevealed:m,userTranscript:u,userAudioUrl:h,onToggleRecord:I,onPlayTarget:E,onPlayUser:c,onToggleReveal:M,onNext:f,onClearTranscript:ce,isEmpty:ee,onClose:b,pagedItems:O,page:g,pageSize:T,totalPages:k,onPageChange:w,onPageSizeChange:te,onSelect:y,currentAbsoluteIndex:se,autoSpeak:P,onToggleAutoSpeak:r,autoReveal:N,onToggleAutoReveal:U,isGlobalMode:V,localAnalysis:p,onAddItem:L,onEditItem:A,onDeleteItem:re,onRandomize:W,isModalOpen:R,editingItem:Q,onCloseModal:J,onSaveItem:Y,ipa:X,showIpa:$,isIpaLoading:S,onToggleIpa:q})=>{const[_,F]=s.useState(!0),D=s.useRef(null);if(s.useEffect(()=>{const n=D.current;n&&o&&setTimeout(()=>{if(!D.current)return;n.style.fontSize="1.5rem";const d=n.parentElement;if(d){const j=n.scrollWidth,i=d.clientWidth;if(j>i){const v=i/j*24;n.style.fontSize=`${Math.max(v,14)}px`}}},50)},[o]),ee)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4 relative bg-white",children:[b&&e.jsx("button",{onClick:b,className:"absolute top-6 right-6 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(oe,{size:24})}),e.jsx("div",{className:"p-4 bg-neutral-100 rounded-full text-neutral-400",children:e.jsx(ot,{size:40})}),e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Queue is Empty"}),e.jsxs("button",{onClick:L,className:"mt-4 px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(xe,{size:14})," Add New"]})]}),e.jsx(pe,{isOpen:R,onClose:J,onSave:Y,initialData:Q})]});const G=V?"h-full":"h-full rounded-[2.5rem] shadow-sm border border-neutral-200";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex w-full bg-white relative overflow-hidden ${G}`,children:[e.jsxs("div",{className:`h-full border-r border-neutral-100 bg-neutral-50/50 flex flex-col shrink-0 transition-all duration-300 ease-in-out ${_?"w-80 opacity-100":"w-0 opacity-0 border-none overflow-hidden"}`,children:[e.jsx("div",{className:"p-4 border-b border-neutral-100 bg-white space-y-3 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-neutral-500",children:[e.jsx(ct,{size:18}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:"Queue"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:U,className:`p-2 rounded-lg border transition-all shadow-sm ${N?"bg-sky-100 border-sky-200 text-sky-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Reveal Text: ${N?"ON":"OFF"}`,children:N?e.jsx(he,{size:14}):e.jsx(me,{size:14})}),e.jsx("button",{onClick:r,className:`p-2 rounded-lg border transition-all shadow-sm ${P?"bg-amber-100 border-amber-200 text-amber-600":"bg-white border-neutral-200 text-neutral-400 hover:text-neutral-600"}`,title:`Auto Speak: ${P?"ON":"OFF"}`,children:e.jsx(Oe,{size:14,fill:P?"currentColor":"none"})}),e.jsx("button",{onClick:W,className:"p-2 bg-white border border-neutral-200 text-neutral-500 rounded-lg hover:text-indigo-600 transition-all shadow-sm",title:"Shuffle Queue",children:e.jsx(Ue,{size:14})}),e.jsx("button",{onClick:L,className:"p-2 bg-neutral-900 text-white border border-neutral-900 rounded-lg hover:bg-neutral-800 transition-all shadow-sm",children:e.jsx(xe,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:O.map((n,d)=>{const i=g*T+d===se;return e.jsxs("div",{className:`w-full text-left rounded-lg border transition-all group relative ${i?"bg-white border-neutral-900 shadow-sm ring-1 ring-neutral-900/5":"border-transparent hover:bg-neutral-100"}`,children:[e.jsxs("button",{onClick:()=>y(d),className:"w-full px-3 py-3 flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:e.jsx(ut,{score:n.lastScore})}),e.jsx("span",{className:`text-xs font-bold leading-snug line-clamp-2 ${i?"text-neutral-900":"text-neutral-600"}`,children:n.text})]}),e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 right-2 flex items-center bg-white/90 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm border border-neutral-100",children:[e.jsx("button",{onClick:()=>A(n),className:"p-1.5 text-neutral-400 hover:text-indigo-600",children:e.jsx(Le,{size:12})}),e.jsx("button",{onClick:()=>re(n),className:"p-1.5 text-neutral-400 hover:text-red-600",children:e.jsx(We,{size:12})})]})]},n.id)})}),e.jsxs("div",{className:"p-3 border-t border-neutral-100 bg-white flex items-center justify-between shrink-0",children:[e.jsx("select",{value:T,onChange:n=>te(Number(n.target.value)),className:"bg-neutral-50 border border-neutral-200 rounded-lg px-2 py-1 text-[10px] font-bold text-neutral-600 focus:outline-none focus:ring-1 focus:ring-neutral-900",children:[10,15,20,30].map(n=>e.jsx("option",{value:n,children:n},n))}),k>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>w(g-1),disabled:g===0,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(it,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 tabular-nums",children:[g+1,"/",k]}),e.jsx("button",{onClick:()=>w(g+1),disabled:g>=k-1,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-400 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Qe,{size:16})})]})]})]}),e.jsxs("div",{className:"flex-1 h-full flex flex-col relative overflow-y-auto",children:[b&&e.jsx("button",{onClick:b,className:"absolute top-4 right-4 p-2 text-neutral-400 hover:bg-neutral-100 rounded-full z-50",children:e.jsx(oe,{size:20})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-6 animate-in fade-in",children:[e.jsx("div",{className:"relative w-full max-w-2xl",children:e.jsxs("div",{className:"p-6 md:p-8 rounded-[2rem] border-2 text-center transition-all duration-300 min-h-[180px] flex flex-col items-center justify-center relative bg-white border-neutral-200 shadow-xl shadow-neutral-100",children:[e.jsx("button",{onClick:M,className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-indigo-500",children:m?e.jsx(me,{size:20}):e.jsx(he,{size:20})}),e.jsxs("div",{className:"relative px-4 w-full flex flex-col items-center gap-4",children:[e.jsx("div",{ref:D,className:"flex flex-wrap justify-center gap-x-1.5 gap-y-1",style:{fontSize:"1.5rem",lineHeight:"1.4"},children:o==null?void 0:o.split(/\s+/).map((n,d)=>{const j=p==null?void 0:p.words[d];let i="text-neutral-800";if(j)switch(j.status){case"correct":i="text-emerald-600";break;case"near":i="text-amber-500";break;case"wrong":i="text-rose-500";break;case"missing":i="text-neutral-300";break;default:i="text-neutral-800"}const v=j&&j.status!=="missing";return e.jsx("span",{onClick:()=>ie(n),className:`font-bold cursor-pointer hover:underline decoration-neutral-200 transition-all leading-normal ${m||v?"opacity-100":"text-transparent blur-md select-none"}`,children:e.jsx("span",{className:i,children:n})},d)})}),$&&X&&e.jsx("div",{className:"px-4 py-1.5 bg-neutral-50 border border-neutral-100 rounded-xl text-lg font-mono font-medium text-neutral-500 animate-in slide-in-from-top-2 duration-500",children:X}),!m&&!p&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-200 text-xs font-bold uppercase tracking-widest animate-pulse",children:"Speak to reveal result"})})]}),p&&e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-1 animate-in slide-in-from-top-2",children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Accuracy"}),e.jsxs("div",{className:`text-4xl font-black ${p.score>80?"text-emerald-500":p.score>50?"text-amber-500":"text-rose-500"}`,children:[p.score,"%"]})]})]})}),e.jsxs("div",{className:"min-h-16 flex flex-col items-center justify-center w-full max-w-xl text-center",children:[a?e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 animate-pulse",children:[e.jsx(qe,{size:24}),e.jsx("span",{className:"font-black text-sm uppercase tracking-widest",children:"Listening..."})]}):!u&&e.jsx("p",{className:"text-neutral-300 text-xs font-medium",children:"Tap the microphone and read the phrase aloud"}),u&&!a&&e.jsxs("div",{className:"space-y-1 animate-in fade-in",children:[e.jsx("p",{className:"text-neutral-400 text-[10px] font-black uppercase tracking-widest",children:"What we heard"}),e.jsxs("p",{className:"text-lg font-medium italic text-neutral-600 line-clamp-2",children:['"',u,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:E,className:"p-4 rounded-2xl bg-white border border-neutral-200 text-neutral-600 hover:text-indigo-600 shadow-sm transition-all active:scale-95",children:e.jsx(De,{size:24})}),e.jsx("button",{onClick:q,disabled:S,className:`p-4 rounded-2xl border transition-all shadow-sm ${$?"bg-indigo-600 text-white shadow-lg scale-105":"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600"}`,title:"Show Phonetic (IPA)",children:S?e.jsx(Ge,{size:24,className:"animate-spin"}):e.jsx(Be,{size:24})}),e.jsx("button",{onClick:I,className:`w-24 h-24 rounded-full flex items-center justify-center shadow-xl transition-all transform ${a?"bg-rose-500 text-white scale-110 ring-8 ring-rose-100":"bg-white border-4 border-neutral-100 text-neutral-900 hover:border-neutral-200 hover:scale-105"}`,children:a?e.jsx(He,{size:32,fill:"currentColor"}):e.jsx(Ke,{size:32})}),e.jsx("button",{onClick:c,disabled:!h||a,className:`p-4 rounded-2xl border transition-all shadow-sm ${h&&!a?"bg-white border-neutral-200 text-neutral-600 hover:text-indigo-600":"bg-neutral-50 border-neutral-100 text-neutral-300 cursor-not-allowed"}`,children:e.jsx(Ve,{size:24,fill:h&&!a?"currentColor":"none"})})]}),e.jsxs("button",{onClick:f,className:"px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center gap-2 transition-all shadow-lg bg-neutral-900 text-white hover:bg-neutral-800 active:scale-95",children:[e.jsx("span",{children:"Next Phrase"}),e.jsx(Je,{size:16})]})]}),e.jsx("div",{className:"px-8 pb-6",children:e.jsxs("div",{className:"p-4 bg-indigo-50 border border-indigo-100 rounded-2xl flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-indigo-500 text-white rounded-lg shadow-sm",children:e.jsx(Ye,{size:16})}),e.jsxs("div",{className:"text-[10px] text-indigo-700 leading-relaxed font-medium",children:[e.jsx("b",{className:"text-[10px] uppercase tracking-wider block mb-0.5",children:"Visual Feedback Guide:"}),e.jsx("span",{className:"text-emerald-600 font-black",children:"GREEN"}),": Correct. ",e.jsx("span",{className:"text-rose-500 font-black",children:"RED"}),": Mispronounced. ",e.jsx("span",{className:"text-neutral-400 font-black",children:"GRAY"}),": Missing."]})]})})]})]}),e.jsx(pe,{isOpen:R,onClose:J,onSave:Y,initialData:Q})]})},be="vocab_pro_mimic_practice_queue",xt=({scopedWord:o,onClose:z})=>{const[a,m]=s.useState([]),[u,h]=s.useState(0),[I,E]=s.useState(!1),[c,M]=s.useState(0),[f,ce]=s.useState(10),[ee,b]=s.useState(!1),[O,g]=s.useState(null),[T,k]=s.useState(null),[w,te]=s.useState(()=>ae("vocab_pro_mimic_autospeak",!1)),[y,se]=s.useState(()=>ae("vocab_pro_mimic_autoreveal",!0)),P=s.useRef(w);s.useEffect(()=>{le("vocab_pro_mimic_autospeak",w),P.current=w},[w]),s.useEffect(()=>{le("vocab_pro_mimic_autoreveal",y)},[y]);const r=a[u]||null,[N,U]=s.useState(!1),[V,p]=s.useState(!1),[L,A]=s.useState(""),[re,W]=s.useState(0),[R,Q]=s.useState(null),[J,Y]=s.useState("audio/webm"),[X,$]=s.useState(null),[S,q]=s.useState(null),[_,F]=s.useState(!1),[D,G]=s.useState(!1),[n,d]=s.useState(null),j=!1,i=s.useRef(new Ze),v=s.useRef(null),C=s.useRef(null),ue=s.useRef(()=>{}),{showToast:B}=et(),H=L.substring(re).trimStart();s.useEffect(()=>{if(N&&r&&H){const t=fe(r.text,H);d(t)}},[H,N,r]);const K=t=>{m(t),le(be,t),E(t.length===0)};s.useEffect(()=>{const t=ae(be,[]);m(t),E(t.length===0),h(0)},[]),s.useEffect(()=>{const t=Math.ceil(a.length/f);c>=t&&t>0&&M(t-1)},[a.length,f]),s.useEffect(()=>{const t=Math.floor(u/f);t!==c&&M(t)},[u,f]);const ge=t=>{const x=[{id:`mimic-${Date.now()}`,text:t,sourceWord:"Manual",type:"Phrase"},...a];K(x),h(0),b(!1)},je=(t,l)=>{K(a.map(x=>x.id===t?{...x,text:l}:x)),b(!1),g(null)},ve=t=>{k(t)},we=()=>{if(!T)return;const t=a.filter(x=>x.id!==T.id);let l=u;l>=t.length&&(l=Math.max(0,t.length-1)),h(l),K(t),k(null),B("Phrase removed.","success")},Ne=()=>{if(a.length<2)return;const t=[...a].sort(()=>Math.random()-.5);K(t),h(0),B("Queue shuffled!","success")},ye=t=>{ce(t),M(0)},ke=()=>{g(null),b(!0)},Se=t=>{g(t),b(!0)},Ce=t=>{O?je(O.id,t):ge(t)},Z=s.useCallback(async(t=!1)=>{C.current&&clearTimeout(C.current),U(!1),i.current.stop();try{const l=await tt();!t&&l&&(Q(l.base64),Y(l.mimeType))}catch(l){console.error("Audio capture failed",l)}},[]);s.useEffect(()=>{ue.current=Z},[Z]);const ze=s.useCallback(async()=>{if(r){if(S&&_){F(!1);return}if(S&&!_){F(!0);return}G(!0);try{const t=r.text.trim().toLowerCase(),l=st().find(x=>x.word.toLowerCase()===t);if(l&&l.ipaUs){q(l.ipaUs),F(!0),G(!1);return}else{const x=rt(),ne=nt(x),de=await fetch(`${ne}/api/convert/ipa?text=${encodeURIComponent(r.text)}`);if(de.ok){const _e=await de.json();q(_e.ipa),F(!0)}else B("IPA server unavailable","error")}}catch{B("Failed to fetch IPA","error")}finally{G(!1)}}},[r,S,_,B]);s.useEffect(()=>{if(N&&Z(!0),p(y),A(""),W(0),Q(null),$(null),d(null),q(null),F(!1),v.current&&(v.current.pause(),v.current=null),P.current&&r){const t=setTimeout(()=>ie(r.text),500);return()=>clearTimeout(t)}},[r==null?void 0:r.id,y]),s.useEffect(()=>()=>{i.current.stop(),C.current&&clearTimeout(C.current)},[]);const Ie=async()=>{if(r)if(N){await Z();const t=fe(r.text,H);d(t);const l=a.map((x,ne)=>ne===u?{...x,lastScore:t.score}:x);K(l)}else{A(""),W(0),$(null),d(null);try{await lt(),U(!0),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>ue.current(),1e4),i.current.start((t,l)=>A(t+l),t=>A(t))}catch(t){console.error("Failed to start recording",t),U(!1)}}},Ee=()=>{W(L.length),$(null),d(null)},Me=()=>r&&ie(r.text),Te=()=>{if(R){v.current&&v.current.pause();const t=new Audio(`data:${J};base64,${R}`);v.current=t,t.play()}},Pe=()=>{a.length>0&&h(t=>(t+1)%a.length)},Ae=t=>{t>=0&&t<a.length&&h(t)},Re=Math.ceil(a.length/f),$e=a.slice(c*f,(c+1)*f);return e.jsxs(e.Fragment,{children:[e.jsx(dt,{targetText:(r==null?void 0:r.text)||null,sourceWord:(r==null?void 0:r.sourceWord)||"",type:(r==null?void 0:r.type)||"",isRecording:N,isRevealed:V,userTranscript:H,matchStatus:X,userAudioUrl:R,onToggleRecord:Ie,onPlayTarget:Me,onPlayUser:Te,onToggleReveal:()=>p(!V),onNext:Pe,onClearTranscript:Ee,isEmpty:I,onClose:z,pagedItems:$e,page:c,pageSize:f,totalPages:Re,onPageChange:M,onPageSizeChange:ye,onSelect:t=>Ae(c*f+t),currentAbsoluteIndex:u,autoSpeak:w,onToggleAutoSpeak:()=>te(!w),autoReveal:y,onToggleAutoReveal:()=>se(!y),isGlobalMode:!o,isAnalyzing:j,onAnalyze:()=>{},aiAnalysis:n?{isCorrect:n.score>80,score:n.score,feedbackHtml:""}:null,localAnalysis:n,onAddItem:ke,onEditItem:Se,onDeleteItem:ve,onRandomize:Ne,isModalOpen:ee,editingItem:O,onCloseModal:()=>b(!1),onSaveItem:Ce,ipa:S,showIpa:_,isIpaLoading:D,onToggleIpa:ze}),e.jsx(at,{isOpen:!!T,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase from your pronunciation queue?",confirmText:"Delete",isProcessing:!1,onConfirm:we,onClose:()=>k(null),icon:null,confirmButtonClass:"bg-red-600 text-white hover:bg-red-700"})]})},pt=({scopedWord:o,onClose:z})=>e.jsx("div",{className:"flex flex-col h-full bg-white",children:e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(xt,{scopedWord:o,onClose:z})})});export{pt as MimicPractice};
