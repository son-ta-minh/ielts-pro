import{c as O,r as i,D as F,bN as q,j as e,P as W,aj as P,i as J,_ as M,al as B,ae as V,bO as _,X as K,ac as Q,bP as I,bQ as H,k as X}from"./index-Bn272AP0.js";import{R as Y,a as Z}from"./ResourceActions-CXSC5ez9.js";import{U as ee}from"./UniversalCard-BKLp9_Qb.js";import{L as D}from"./list-todo-LN2S4a4S.js";import{C as te}from"./circle-CQV0CXJx.js";import"./search-BF3hARhN.js";import"./chevron-left-CleKQY0z.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=O("CircleDashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);function ne(n){return`You are an expert study planner and productivity coach.

TASK:
Create a structured learning goal based on the user's request. The goal should be broken down into specific, actionable tasks (todos).

USER REQUEST: "${n}"

INSTRUCTIONS:
1.  **Analyze the Request**: Identify the main subject (e.g., "Collins Reading for IELTS", "Learn 50 phrasal verbs", "Writing Task 1 practice").
2.  **Create a Title**: A concise, motivating title for the goal.
3.  **Create a Description**: A brief overview of what this goal achieves.
4.  **Generate Todos**: Break the goal down into logical steps or units.
    -   If the request refers to a specific book or course (e.g., "18 lessons of Collins Reading"), generate exactly that number of tasks, matching the unit titles if possible or using logical generic titles.
    -   If the request is general (e.g., "Learn vocabulary"), create a logical progression (e.g., "Day 1: Family", "Day 2: Work").
    -   Each task should be clear and actionable.

STRICT JSON OUTPUT FORMAT:
Return a single JSON object. Do not include any text outside the JSON block.

{
  "title": "string (Goal Title)",
  "description": "string (Goal Description)",
  "todos": [
    {
      "text": "string (Task description, e.g., 'Unit 1: Family & Relationships - Complete exercises')"
    },
    {
      "text": "string (Task description, e.g., 'Unit 2: Health & Fitness - Review vocabulary')"
    }
  ]
}`}const E={NEW:{icon:te,color:"text-neutral-300",bg:"bg-neutral-100",label:"New"},IN_PROGRESS:{icon:se,color:"text-blue-500",bg:"bg-blue-50",label:"In Progress"},CLOSED:{icon:X,color:"text-green-500",bg:"bg-green-50",label:"Closed"}},re=({todo:n,readOnly:p,onStatusChange:b,onTextChange:l,onDelete:m})=>{const[j,u]=i.useState(!1),g=E[n.status],x=g.icon;return p?e.jsxs("div",{className:`flex items-start gap-2.5 py-1.5 ${n.status==="CLOSED"?"opacity-50":""}`,children:[e.jsx(x,{size:14,className:`mt-0.5 shrink-0 ${g.color}`}),e.jsx("span",{className:`text-xs font-medium leading-snug ${n.status==="CLOSED"?"line-through text-neutral-400":"text-neutral-700"}`,children:n.text})]}):e.jsxs("div",{className:"group flex items-start gap-2 p-2 bg-white border border-neutral-200 rounded-xl hover:border-neutral-300 transition-all focus-within:ring-2 focus-within:ring-neutral-900/5 focus-within:border-neutral-400",children:[e.jsxs("div",{className:"relative shrink-0 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>u(!j),className:`p-1 rounded-md hover:bg-neutral-100 transition-colors ${g.color}`,title:"Change Status",children:e.jsx(x,{size:18})}),j&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white rounded-xl shadow-xl border border-neutral-100 z-50 p-1 flex flex-col gap-1 animate-in fade-in zoom-in-95",children:Object.keys(E).map(o=>{const c=E[o],h=c.icon;return e.jsxs("button",{type:"button",onClick:()=>{b==null||b(o),u(!1)},className:`flex items-center gap-2 px-2 py-2 rounded-lg text-xs font-bold transition-colors w-full text-left ${n.status===o?"bg-neutral-100":"hover:bg-neutral-50"}`,children:[e.jsx(h,{size:14,className:c.color}),e.jsx("span",{className:"text-neutral-600",children:c.label})]},o)})})]}),e.jsx("input",{type:"text",value:n.text,onChange:o=>l==null?void 0:l(o.target.value),className:`flex-1 bg-transparent border-none outline-none text-sm font-medium py-1 ${n.status==="CLOSED"?"text-neutral-400 line-through":"text-neutral-900"}`,placeholder:"Task description..."}),e.jsx("button",{type:"button",onClick:m,className:"p-1.5 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all self-start mt-0.5",title:"Remove Task",children:e.jsx(P,{size:14})})]})},le=({isOpen:n,onClose:p,onSave:b,initialData:l})=>{const[m,j]=i.useState(""),[u,g]=i.useState(""),[x,o]=i.useState([]),[c,h]=i.useState("");i.useEffect(()=>{n&&(j((l==null?void 0:l.title)||""),g((l==null?void 0:l.description)||""),o((l==null?void 0:l.todos)||[]),h(""))},[n,l]);const N=()=>{if(!c.trim())return;const a={id:`todo-${Date.now()}-${Math.random()}`,text:c.trim(),status:"NEW"};o([...x,a]),h("")},w=(a,f)=>{o(T=>T.map(S=>S.id===a?{...S,...f}:S))},C=a=>{o(f=>f.filter(T=>T.id!==a))},v=()=>{m.trim()&&b({title:m,description:u,todos:x})};return n?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:l?"Edit Goal":"New Goal"}),e.jsx("button",{onClick:p,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(K,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-6 flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Goal Title"}),e.jsx("input",{value:m,onChange:a=>j(a.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none",placeholder:"e.g. Master Phrasal Verbs",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Description (Optional)"}),e.jsx("textarea",{value:u,onChange:a=>g(a.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-900 outline-none resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-end px-1",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(D,{size:14})," Task List"]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 bg-neutral-100 px-2 py-0.5 rounded-full",children:x.length})]}),e.jsx("div",{className:"space-y-2",children:x.map(a=>e.jsx(re,{todo:a,readOnly:!1,onStatusChange:f=>w(a.id,{status:f}),onTextChange:f=>w(a.id,{text:f}),onDelete:()=>C(a.id)},a.id))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{value:c,onChange:a=>h(a.target.value),onKeyDown:a=>a.key==="Enter"&&N(),className:"flex-1 px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none transition-all focus:bg-white",placeholder:"Add a new task..."}),e.jsx("button",{onClick:N,disabled:!c.trim(),className:"px-4 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 disabled:opacity-50 transition-colors shadow-sm",children:e.jsx(M,{size:20})})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:e.jsxs("button",{onClick:v,disabled:!m.trim(),className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50 hover:scale-105 transition-transform",children:[e.jsx(Q,{size:14})," ",e.jsx("span",{children:"Save Changes"})]})})]})}):null},ge=({user:n})=>{const[p,b]=i.useState([]),[l,m]=i.useState(!0),[j,u]=i.useState(!1),[g,x]=i.useState(null),[o,c]=i.useState(null),[h,N]=i.useState(null),[w,C]=i.useState(!1),{showToast:v}=F(),a=i.useCallback(async()=>{m(!0);const t=await q(n.id);b(t.sort((s,r)=>s.order!==void 0&&r.order!==void 0?s.order-r.order:s.order!==void 0?-1:r.order!==void 0?1:r.createdAt-s.createdAt)),m(!1)},[n.id]);i.useEffect(()=>{a()},[a]);const f=async t=>{const s=Date.now();if(g){const r={...g,...t,updatedAt:s};await I(r),v("Goal updated.","success")}else{const r={id:`goal-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos||[],createdAt:s,updatedAt:s,order:p.length};await I(r),v("Goal created.","success")}u(!1),a()},T=async()=>{o&&(await H(o.id),v("Goal deleted.","success"),c(null),a())},S=async t=>{if(t.title&&Array.isArray(t.todos)){const s=Date.now(),r={id:`goal-ai-${s}-${Math.random()}`,userId:n.id,title:t.title,description:t.description||"",todos:t.todos.map(y=>({id:`todo-${s}-${Math.random()}`,text:y.text,status:"NEW"})),createdAt:s,updatedAt:s,order:0};await I(r),v("Goal generated by AI!","success"),C(!1),a()}else v("Invalid AI response.","error")},R=t=>ne(t.request),z=(t,s)=>{N(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s)},$=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},L=async(t,s)=>{if(t.preventDefault(),!h||h===s)return;const r=p.findIndex(G=>G.id===h),y=p.findIndex(G=>G.id===s);if(r===-1||y===-1)return;const k=[...p],[A]=k.splice(r,1);k.splice(y,0,A);const d=k.map((G,U)=>({...G,order:U}));b(d),N(null),await _(d)};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Planning Board",subtitle:"Track your learning goals and tasks.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Spiral%20Calendar.png",className:"w-8 h-8 object-contain",alt:"Planning"}),config:{},isLoading:l,isEmpty:p.length===0,emptyMessage:"No goals set. Start planning!",activeFilters:{},onFilterChange:()=>{},actions:e.jsx(Z,{addActions:[{label:"New (AI)",icon:J,onClick:()=>C(!0)},{label:"New (Manual)",icon:M,onClick:()=>{x(null),u(!0)}}]}),children:()=>e.jsx(e.Fragment,{children:p.map(t=>{const s=t.todos.length,r=t.todos.filter(d=>d.status==="CLOSED").length,y=s>0?Math.round(r/s*100):0,k=s>0&&r===s,A=h===t.id;return e.jsx("div",{draggable:!0,onDragStart:d=>z(d,t.id),onDragOver:$,onDrop:d=>L(d,t.id),className:`transition-all duration-200 h-full ${A?"opacity-40 scale-95":"opacity-100 hover:scale-[1.01]"}`,children:e.jsx(ee,{title:e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-snug mb-0.5 select-none",children:t.title}),compact:!0,onClick:()=>{x(t),u(!0)},isCompleted:k,className:"h-full",actions:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 text-neutral-300 cursor-grab active:cursor-grabbing hover:text-neutral-500 rounded-lg transition-colors mr-1",children:e.jsx(ae,{size:14})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),x(t),u(!0)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(W,{size:14})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),c(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(P,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-3 select-none",children:[t.description&&e.jsx("p",{className:"text-[10px] text-neutral-400 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-neutral-500 bg-neutral-50 px-2 py-1.5 rounded-lg w-fit self-start",children:[e.jsx(D,{size:12}),e.jsxs("span",{children:[s," Tasks"]}),r>0&&e.jsxs("span",{className:"text-green-600",children:["(",r," done)"]})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[y,"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${k?"bg-green-500":"bg-indigo-500"}`,style:{width:`${y}%`}})})]})]})})},t.id)})})}),e.jsx(le,{isOpen:j,onClose:()=>u(!1),onSave:f,initialData:g,user:n}),e.jsx(B,{isOpen:!!o,title:"Delete Goal?",message:"This will remove the goal and all its tasks.",confirmText:"Delete",isProcessing:!1,onConfirm:T,onClose:()=>c(null),icon:e.jsx(P,{size:40,className:"text-red-500"})}),w&&e.jsx(V,{isOpen:w,onClose:()=>C(!1),type:"GENERATE_PLAN",title:"AI Goal Planner",description:"Describe your goal (e.g. 'Complete Collins Reading book') and let AI generate the task list.",initialData:{request:""},onGeneratePrompt:R,onJsonReceived:S,actionLabel:"Create Plan",closeOnSuccess:!0})]})};export{ge as PlanningPage};
