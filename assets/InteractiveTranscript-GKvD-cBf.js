import{c as T,r as h,j as e,V as Z,bZ as K,H as te}from"./index-D-83NIjs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=T("Baseline",[["path",{d:"M4 20h16",key:"14thso"}],["path",{d:"m6 16 6-12 6 12",key:"1b4byz"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=T("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=T("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),le=({isOpen:o,onClose:b,onConfirm:g,audioFiles:f,initialData:p})=>{const[z,k]=h.useState(""),[I,N]=h.useState(""),[M,w]=h.useState("");if(h.useEffect(()=>{if(o)if(p){const d=p.filename&&f.includes(p.filename)?p.filename:p.filename||(f.length>0?f[0]:"");k(d),N(p.start||""),w(p.duration||"")}else k(f.length>0?f[0]:""),N(""),w("")},[o,f,p]),!o)return null;const A=d=>{d.preventDefault(),g({filename:z,start:I.trim(),duration:M.trim()})},W=d=>decodeURIComponent(d.split("/").pop()||"");return e.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-2xl border border-neutral-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-black text-neutral-900 mb-4 flex items-center gap-2",children:[p?e.jsx(F,{size:20,className:"text-indigo-600"}):e.jsx(Z,{size:20,className:"text-indigo-600"}),p?"Edit Audio Settings":"Mark Audio Segment"]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Source Audio (Optional)"}),e.jsxs("select",{value:z,onChange:d=>k(d.target.value),className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none",children:[e.jsx("option",{value:"",children:"None (Use Text-to-Speech)"}),f.map((d,H)=>e.jsx("option",{value:d,children:W(d)},H))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Start (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:I,onChange:d=>N(d.target.value),placeholder:"e.g. 5.5",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase",children:"Duration (Sec)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:M,onChange:d=>w(d.target.value),placeholder:"e.g. 10",className:"w-full p-2 bg-neutral-50 border border-neutral-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-neutral-500 font-bold text-xs hover:bg-neutral-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-neutral-900 text-white font-bold text-xs rounded-lg hover:bg-neutral-800 transition-colors",children:"Apply"})]})]})]})})},re=({text:o})=>{const b=o.split(/({.*?}|\[.*?\]\(.*?\)|\[.*?\])/g);return e.jsx("span",{className:"leading-relaxed",children:b.map((g,f)=>g.startsWith("{")&&g.endsWith("}")?e.jsx("span",{className:"text-red-600 font-bold mx-0.5",children:g.slice(1,-1)},f):e.jsx("span",{children:g},f))})},ae=({rawText:o,onUpdate:b,readOnly:g=!1,showDash:f=!0,audioLinks:p=[],onPlaySegment:z})=>{const[k,I]=h.useState(f),[N,M]=h.useState(!1),[w,A]=h.useState(o);h.useEffect(()=>{A(o)},[o]);const W=()=>{b(w),M(!1)},d=()=>{A(o),M(!1)},H=h.useRef(null),[i,m]=h.useState(null),[q,E]=h.useState(!1),[G,S]=h.useState(null),[v,R]=h.useState(null),y=h.useRef(null),j=h.useMemo(()=>{const n=[],l=/({[\s\S]*?}|\[[\s\S]*?\]\([\s\S]*?\)|\[[\s\S]*?\])/g;let s,a=0;for(;(s=l.exec(o))!==null;){s.index>a&&n.push({text:o.slice(a,s.index),type:"text",start:a,end:s.index});let r="text",t=s[0];if(s[0].startsWith("{"))r="highlight",t=s[0].slice(1,-1);else if(s[0].startsWith("["))if(r="audio",s[0].includes("](")){const c=s[0].match(/^\[(.*?)\]/);t=c?c[1]:"error"}else t=s[0].slice(1,-1);n.push({text:s[0],type:r,start:s.index,end:l.lastIndex,displayContent:t}),a=l.lastIndex}return a<o.length&&n.push({text:o.slice(a),type:"text",start:a,end:o.length}),n},[o]),J=()=>{var n;m(null),(n=window.getSelection())==null||n.removeAllRanges(),M(!0)},V=()=>{if(g||N)return;const n=window.getSelection(),l=r=>{if(!r)return null;let t=r.nodeType===3?r.parentElement:r;for(;t&&t!==H.current&&!t.hasAttribute("data-index");)t=t.parentElement;return t&&t.hasAttribute("data-index")?parseInt(t.getAttribute("data-index"),10):null};if(!n||!n.anchorNode||!n.focusNode||n.isCollapsed){m(null);return}const s=l(n.anchorNode),a=l(n.focusNode);if(s===null||a===null){m(null);return}if(s===a&&j[s].type==="text"){let r=n.anchorOffset,t=n.focusOffset;r>t&&([r,t]=[t,r]),m({start:j[s].start+r,end:j[s].start+t,currentType:"text"})}else{const r=Math.min(s,a),t=Math.max(s,a);let c=!1;for(let u=r;u<=t;u++)j[u].type==="audio"&&(c=!0);m(c?null:{start:j[r].start,end:j[t].end,currentType:"text"})}},D=n=>{var a,r;if(!i)return;const{start:l,end:s}=i;if(n==="audio"){S(null),E(!0);return}if(n==="clear"){const t=o.slice(0,l),c=o.slice(l,s);let u=c;c.startsWith("{")?u=c.slice(1,-1):c.startsWith("[")&&(c.includes("](")?u=((a=c.match(/^\[(.*?)\]/))==null?void 0:a[1])||"":u=c.slice(1,-1));const C=o.slice(s);b(t+u+C)}else{const t=o.slice(0,l),c=o.slice(l,s),u=o.slice(s);b(`${t}{${c}}${u}`)}m(null),(r=window.getSelection())==null||r.removeAllRanges()},Q=()=>{if(!i||i.currentType!=="audio")return;const l=o.slice(i.start,i.end).match(/\((.*?)\)$/);if(l){const s=l[1].split("|");S({filename:s[0]||"",start:s[1]||"",duration:s[2]||""})}else S(null);E(!0)},X=n=>{var U;if(!i)return;const{start:l,end:s,currentType:a}=i,r=o.slice(0,l);let t=o.slice(l,s);if(a==="audio"){const x=t.match(/^\[(.*?)\]/);x?t=x[1]:t=t.replace(/^\[/,"").replace(/\](\(.*?\))?$/,"")}const c=o.slice(s);let u=`[${t}]`;const C=n.filename,$=n.start,L=n.duration;if(C||$||L){const x=[];for(C?x.push(C):x.push(""),$?x.push($):L&&x.push(""),L&&x.push(L);x.length>0&&!x[x.length-1];)x.pop();x.length>0&&(u+=`(${x.join("|")})`)}b(`${r}${u}${c}`),E(!1),S(null),m(null),(U=window.getSelection())==null||U.removeAllRanges()},Y=(n,l)=>{var a;if(n.stopPropagation(),l.text.includes("](")){const r=l.text.match(/\((.*?)\)$/);if(r){const t=r[1].split("|"),c=t[0]?t[0]:void 0,u=t[1]?parseFloat(t[1]):void 0,C=t[2]?parseFloat(t[2]):void 0,$=((a=l.displayContent)==null?void 0:a.replace(/[{}]/g,""))||"";z(c,u,C,$);return}}const s=(l.displayContent||l.text.slice(1,-1)).replace(/[{}]/g,"");te(s)},B=(n,l,s)=>{if(g||s==="text")return;y.current&&(clearTimeout(y.current),y.current=null);const a=n.currentTarget.getBoundingClientRect();R(r=>(r==null?void 0:r.idx)===l?r:{idx:l,rect:a,type:s})},O=()=>{g||(y.current=setTimeout(()=>{R(null)},600))},_=()=>{y.current&&(clearTimeout(y.current),y.current=null)},ee=()=>{y.current=setTimeout(()=>{R(null)},600)},P=n=>{var a;if(!v)return;const l=j[v.idx],s={start:l.start,end:l.end,currentType:l.type};if(m(s),R(null),n==="unmark"){const r=o.slice(0,l.start);let t=l.text;t.startsWith("{")?t=t.slice(1,-1):t.startsWith("[")&&(t.includes("](")?t=((a=t.match(/^\[(.*?)\]/))==null?void 0:a[1])||"":t=t.slice(1,-1));const c=o.slice(l.end);b(r+t+c),m(null)}else if(n==="edit"){const r=l.text.match(/\((.*?)\)$/);if(r){const t=r[1].split("|");S({filename:t[0]||"",start:t[1]||"",duration:t[2]||""})}else S(null);E(!0)}};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[!g&&e.jsx("div",{className:"absolute top-4 right-6 z-10 flex items-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W,className:"px-4 py-2 text-xs font-bold text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:d,className:"px-4 py-2 text-xs font-bold text-neutral-700 bg-neutral-200 rounded-lg hover:bg-neutral-300 transition-colors",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(!k),className:`p-2 text-xs font-bold rounded-lg transition-colors border ${k?"text-indigo-600 bg-indigo-50 border-indigo-200":"text-neutral-500 bg-neutral-100 border-neutral-200 hover:bg-neutral-200"}`,title:"Toggle Dashed Line",children:e.jsx(ne,{size:16})}),e.jsx("button",{onClick:J,className:"px-4 py-2 text-xs font-bold text-neutral-700 bg-neutral-100 rounded-lg hover:bg-neutral-200 transition-colors border border-neutral-200",children:"Edit"})]})}),e.jsx(le,{isOpen:q,onClose:()=>{E(!1),S(null),m(null)},onConfirm:X,audioFiles:p,initialData:G}),e.jsxs("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible gap-2",children:[(i==null?void 0:i.currentType)==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.preventDefault(),D("highlight")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-neutral-900 text-white shadow-neutral-200 hover:scale-105 active:scale-95",children:[e.jsx(se,{size:14}),e.jsx("span",{children:"Highlight"})]}),e.jsxs("button",{onClick:n=>{n.preventDefault(),D("audio")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-indigo-600 text-white shadow-indigo-200 hover:scale-105 active:scale-95",children:[e.jsx(Z,{size:14}),e.jsx("span",{children:"Mark Audio"})]})]}),(i==null?void 0:i.currentType)!=="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{n.preventDefault(),D("clear")},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-rose-600 shadow-rose-100 hover:bg-rose-50 ${i?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(K,{size:14}),e.jsx("span",{children:(i==null?void 0:i.currentType)==="highlight"?"Unhighlight":"Unmark Audio"})]}),(i==null?void 0:i.currentType)==="audio"&&e.jsxs("button",{onClick:n=>{n.preventDefault(),Q()},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-indigo-600 shadow-indigo-100 hover:bg-indigo-50 ${i?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(F,{size:14}),e.jsx("span",{children:"Edit Audio"})]})]})]}),v&&e.jsxs("div",{className:"fixed z-[60] flex items-center gap-1 p-1 bg-neutral-900 rounded-lg shadow-xl animate-in fade-in zoom-in-95",style:{top:v.rect.top-40,left:v.rect.left+v.rect.width/2-(v.type==="audio"?60:35)},onMouseEnter:_,onMouseLeave:ee,children:[v.type==="audio"&&e.jsx("button",{onClick:()=>P("edit"),className:"p-2 text-white hover:bg-white/20 rounded-md transition-colors",title:"Edit",children:e.jsx(F,{size:14})}),e.jsx("button",{onClick:()=>P("unmark"),className:"p-2 text-rose-400 hover:bg-white/20 rounded-md transition-colors",title:"Unmark",children:e.jsx(K,{size:14})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-neutral-900"})]}),N?e.jsx("textarea",{value:w,onChange:n=>A(n.target.value),className:"flex-1 w-full p-6 text-lg font-mono bg-neutral-50 border-0 focus:ring-0 resize-none"}):e.jsx("div",{ref:H,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap px-6 pb-8 pt-8 select-text cursor-text font-mono",onMouseUp:V,onKeyUp:V,children:j.map((n,l)=>n.type==="highlight"?e.jsx("span",{"data-index":l,onMouseEnter:s=>B(s,l,"highlight"),onMouseLeave:O,className:"text-red-600 font-bold cursor-pointer hover:bg-red-50 transition-colors rounded mx-0.5 border border-transparent hover:border-red-100",children:n.displayContent},`${l}-${n.start}`):n.type==="audio"?e.jsxs("span",{"data-index":l,onClick:s=>Y(s,n),onMouseEnter:s=>B(s,l,"audio"),onMouseLeave:O,className:`${k?"bg-indigo-100/50":""} text-indigo-900 cursor-pointer hover:bg-indigo-100 transition-colors mx-0.5 relative group/audio py-0.5 rounded`,title:"Click to listen",children:[e.jsx(re,{text:n.displayContent||"error"}),n.text.includes("](")&&e.jsx("span",{className:"absolute -top-1 -right-1 w-1.5 h-1.5 bg-indigo-500 rounded-full"})]},`${l}-${n.start}`):e.jsx("span",{"data-index":l,children:n.text},`${l}-${n.start}`))})]})};export{ae as I};
