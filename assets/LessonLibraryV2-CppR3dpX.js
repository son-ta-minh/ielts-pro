import{c as mt,r as a,t as fe,j as e,A as we,q as se,s as Be,ac as ft,a2 as Fe,i as ae,P as Se,E as bt,D as Ee,ae as oe,m as ie,bK as me,a1 as Re,b5 as Me,bL as Nt,bM as ne,G as wt,a0 as St,bN as Et,bO as Tt,J as vt,bP as X,aj as te,_ as De,al as Pe,bQ as Ct,l as At,am as jt,bR as kt}from"./index-D8XBKDkm.js";import{R as It,a as yt}from"./ResourceActions-BlOISKSK.js";import{T as Lt}from"./TagBrowser-DGaeplHY.js";import{U as Ot}from"./UniversalCard-BjJnI1Bu.js";import{p as $e,W as Rt}from"./markdownParser-B9SfjZrG.js";import{B as _e}from"./book-text-_xizTU7J.js";import{H as be,P as Ue}from"./pause-H2qdD93K.js";import{u as Mt,G as Dt,S as Ge,V as Pt}from"./ShelfSearchBar-CSYiCYcc.js";import{F as Ut,U as Gt,a as zt,M as Bt,A as Ft,R as $t}from"./ShelfModals-1rVUeBsd.js";import{M as _t}from"./move-B50_7kin.js";import{P as Wt}from"./pen-BlZ04jdM.js";import{L as Yt}from"./library-D9JED8JK.js";import{F as Vt}from"./file-clock-CSl6Bz3n.js";import"./chevron-left-DxzTjFM0.js";import"./square-check-big-Td1wNTeG.js";import"./circle-DHo2E9qE.js";import"./palette-CJMrQ8ON.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=mt("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);function Te(s){const{currentLesson:d,userRequest:M,language:L,tone:C,coachName:c,task:w,topic:S}=s,T=L==="Vietnamese",E=T?"Vietnamese":"English",g=T?"[Audio-VN]":"[Audio-EN]";let m="",h="",o="",A="";return w==="create_reading"?(m=`Create an immersive, high-impact lesson for a ${s.targetAudience} on: "${S}".`,h=`
       STYLE: COMPACT RICH ARTICLE (READING)
       - **COMPACT FORMAT**: Minimize vertical space. **NO double newlines (

)**. **NO horizontal rules (---)**. Keep the layout dense.
       - Use Markdown Headers (###) to separate sections.
       - **RICH ELEMENTS**: 
         1. **TABLES**: Use strictly for **Comparative Matrices** or **System Maps**. âŒ **PROHIBITED**: Do NOT use tables to enumerate words without contrast or explanation per cell. Use bullet points for lists.
         2. Use **[Tip: ...]** blocks for "Did you know?" or "Examiner Tip".
         3. Use **[HIDDEN: ...]** tags ONLY for **Interactive Q&A**. 
            - **RULE**: The QUESTION must be visible OUTSIDE the tag. Only the ANSWER is inside.
            - Format: "Question? [HIDDEN: Answer]"
         4. Use **Emojis** to engage the ${s.targetAudience} audience.
       - **EXAMPLES**: Use Markdown Blockquotes (>) for examples.
       - **AUDIO STRATEGY**: Wrap the ${E} EXPLANATIONS in ${g} tags. Do NOT put audio tags on the English examples.`,A=`
      PEDAGOGICAL STRUCTURE (MANDATORY):
      1. **DIVERGENCE PHASE** (Body): Teach concepts with nuance and examples.
      2. **CONVERGENCE PHASE** (Ending): MUST end with a "System Map" or "Comparison Matrix" (Table) to consolidate learning.

      STRICT TEACHING RULES:
      1. **EXPLAIN EVERY ITEM**: For every vocabulary item, collocation, or idiom:
         - You MUST explain the **Nuance** (Why this word? What does it imply that others don't?).
         - You MUST provide a natural **Example Sentence**.
      2. **COMPARE PARAPHRASES**: Do not just list synonyms. Explain the **Scenario Change**. 
      3. **COACHING FLOW**: Structure the lesson as a guided walkthrough.
      `):w==="convert_to_listening"?(m="TRANSFORM the provided Reading Lesson into a high-quality NATURAL AUDIO SCRIPT.",o=`SOURCE: ${d==null?void 0:d.title}
${d==null?void 0:d.content}`,h=`
    - **Narrative Style**: Convert bullet points into natural spoken sentences.
    - **Context Focus**: For every term, explain 'When' and 'Why'.
    - **Individual Examples**: Provide an example sentence for every phrase mentioned.
    - **Language**: All coaching in ${E}.
    - **Audio Tags**: Wrap EVERY sentence in either ${g} (for explanations) or [Audio-EN] (for examples/terms).`):(m="REFINE the lesson to focus on Contextual Nuance and Visual Clarity.",o=`CURRENT: ${d==null?void 0:d.title}
${d==null?void 0:d.content}
REQUEST: "${M||"Improve layout and examples."}"`,h=`
    - **Teach, Don't List**: Convert any bulleted lists of words into guided explanations.
    - **COMPACT FORMAT**: Minimize vertical space. **NO double newlines (

)**. **NO horizontal rules (---)**.
    - **Rich Formatting**: Incorporate Markdown Tables ONLY for Comparisons/Matrices. âŒ **PROHIBITED**: Do NOT use tables for simple word lists without contrast. Use **[HIDDEN: ...]** ONLY for Q&A reveals (Question outside, Answer inside).
    - **Nuance Mapping**: Explain the difference between similar paraphrases or collocations.
    - **Audio Strategy**: Wrap ${E} explanations in ${g}. No audio tags on English examples.
    - **REMOVE QUIZZES**: Strictly remove any [Quiz:], [Select:], or [Multi:] tags. This content is for reading only.`,A=`
    PEDAGOGICAL STRUCTURE (MANDATORY):
    1. **DIVERGENCE PHASE**: Ensure concepts are explained separately first.
    2. **CONVERGENCE PHASE**: Ensure the lesson ends with a structural wrap-up or comparison matrix.
    `),`You are expert IELTS coach '${c}', acting as a ${C==="friendly_elementary"?"friendly mentor":"professor"}.
    
  TASK: ${m}

  ${o}

  ${A}

  ${h}

  STRICT CONTENT RULES:
  1. NO generic introductions.
  2. MANDATORY: All coaching text in ${E}.
  3. **NO QUIZZES**: Absolutely NO interactive tags ([Quiz], [Select], [Multi]). Provide pure educational content.
  4. **TAGS**: Select tags ONLY from: ["grammar", "pattern", "speaking", "listening", "reading", "writing", "general", "comparison", "vocabulary"].
  5. **QUANTITY**: Return EXACTLY ONE tag. Choose the most primary skill only.

  CRITICAL OUTPUT RULES:
  1. **MARKDOWN CODE BLOCK**: You MUST wrap your entire JSON response in a markdown code block (e.g. \`\`\`json { ... } \`\`\`).
  2. **VALID JSON**: The content inside the code block must be valid, parsable JSON.
  3. **NO RAW NEWLINES IN STRINGS**: Inside the "content" string, you MUST use literal '\\n' for line breaks. Do NOT use actual newline characters.
  4. **ESCAPE CHARACTERS**: Properly escape all double quotes and backslashes within strings.

  OUTPUT TEMPLATE:
  \`\`\`json
  {
    "title": "string",
    "description": "string",
    "content": "string",
    "tags": ["string"]
  }
  \`\`\``}function Ht(s,d,M){var E,g,m,h;const L=d.language||"English",c=(d.format||"reading")==="listening",w=L==="Vietnamese"?"[Audio-VN]":"[Audio-EN]",S={word:s.word,meaning:s.meaningVi,family:s.wordFamily,collocations:(E=s.collocationsArray)==null?void 0:E.filter(o=>!o.isIgnored).map(o=>({text:o.text,hint:o.d})),idioms:(g=s.idiomsList)==null?void 0:g.filter(o=>!o.isIgnored).map(o=>({text:o.text,hint:o.d})),paraphrases:(m=s.paraphrases)==null?void 0:m.filter(o=>!o.isIgnored).map(o=>({word:o.word,tone:o.tone,context:o.context})),prepositions:(h=s.prepositions)==null?void 0:h.filter(o=>!o.isIgnored)},T=c?`STYLE: NATURAL SPOKEN AUDIO SCRIPT
       - Structure the content as a natural spoken narrative or conversation.
       - **EVERY SENTENCE** must be wrapped in either ${w} (for explanations) or [Audio-EN] (for examples/terms).
       - No Markdown headers (###). Use transitional phrases instead.`:`STYLE: COMPACT RICH TEXTBOOK (READING)
       - **COMPACT FORMAT**: Minimize vertical space. **NO double newlines (

)**. **NO horizontal rules (---)**.
       - Structure the content with Markdown Headers (###) for sections.
       - **RICH ELEMENTS**: 
         1. **TABLES**: Use Markdown Tables strictly for **comparing data** (e.g. Columns: Phrase | Nuance | Context) or **System Maps**. âŒ **PROHIBITED**: Do NOT use tables to enumerate words without contrast or explanation per cell.
         2. Use **[Tip: ...]** blocks for pronunciation tips or common mistakes.
         3. Use **[HIDDEN: ...]** tags ONLY for **Interactive Q&A**. 
            - **RULE**: The QUESTION must be visible OUTSIDE the tag. Only the ANSWER is inside.
            - Format: "Question? [HIDDEN: Answer]"
         4. Use **Emojis** liberally to make sections distinct.
       - **VISUALS**: Use Blockquotes (>) for ALL example sentences. Never use nested bullets.
       - **AUDIO**: Wrap the ${L} EXPLANATIONS/TEACHING in ${w} tags. 
       - **NO AUDIO ON EXAMPLES**: Leave English examples as plain text (or bold) within the blockquote.`;return`You are expert IELTS Coach '${M}'.
  
  TASK: Generate a high-quality ${c?"AUDIO SCRIPT":"READING"} lesson for the word: "${s.word}".
  
  DATA: ${JSON.stringify(S)}

  PEDAGOGICAL STRUCTURE (MANDATORY):
  1. **DIVERGENCE PHASE** (Body): Teach the word's family, collocations, and nuances separately with examples.
  2. **CONVERGENCE PHASE** (Ending): MUST end with a "System Map" or "Comparison Matrix" (Table) that summarizes the word's ecosystem (e.g., Collocation types vs Tones).

  ${T}

  STRICT RULES:
  1. **NO SIMPLE LISTS**: Do not just list the data. Teach it with context and nuance.
  2. **EXAMPLE MANDATE**: Every key term MUST have an example sentence.
  3. **NO QUIZZES**: Do NOT generate [Select:], [Quiz:], or [Multi:] tags. This content is for explanation only.
  4. **TAGS**: Select tags ONLY from: ["grammar", "pattern", "speaking", "listening", "reading", "writing", "general", "comparison", "vocabulary"].
  5. **QUANTITY**: Return EXACTLY ONE tag. Choose the most primary skill only.

  CRITICAL OUTPUT RULES:
  1. **MARKDOWN CODE BLOCK**: You MUST wrap your entire JSON response in a markdown code block (e.g. \`\`\`json { ... } \`\`\`).
  2. **VALID JSON**: The content inside the code block must be valid, parsable JSON.
  3. **NO RAW NEWLINES IN STRINGS**: Inside the "content" string, you MUST use literal '\\n' for line breaks. Do NOT use actual newline characters.
  4. **ESCAPE CHARACTERS**: Properly escape all double quotes and backslashes within strings.

  OUTPUT TEMPLATE:
  \`\`\`json
  {
    "title": "Mastering: ${s.word}",
    "description": "string (Strategic usage overview)",
    "content": "string (Markdown formatted with \\n for newlines)",
    "tags": ["vocabulary"]
  }
  \`\`\``}function We(s,d){return`You are an expert IELTS examiner. 
  
  TASK: Generate a high-quality PRACTICE TEST based on the following lesson content:
  LESSON TITLE: "${s}"
  LESSON CONTENT: "${d}"

  TEST STRUCTURE REQUIREMENTS:
  1. **Section 1: Vocabulary Selection (3-5 items)**: Use [Select: Correct | Wrong 1 | Wrong 2] to test the nuance of collocations or specific words from the lesson.
  2. **Section 2: Meaning Matching (2-4 items)**: Use [Multi: Correct | Option 2 | Option 3] to match a term to its definition.
  3. **Section 3: Contextual Use (2-4 items)**: Provide short sentences with blanks using [Select: ...] where the user chooses the best synonym for a specific tone.

  STRICT RULES:
  - **NO ESSAY TEXT**: This content is ONLY for the test questions. Do not repeat the lesson text.
  - **INTERACTIVE TAGS ONLY**: Use [Select: ...], [Multi: ...], and [Audio-EN] (for questions/examples).
  - **NO AMBIGUITY**: Distractors must be clearly less suitable than the correct answer based on the lesson's teaching.
  - **LANGUAGE**: Explanations/Instructions in Vietnamese if the context requires, English for the target material.

  Return a JSON object:
  {
    "content": "string (Markdown with interactive test components)"
  }`}const qt=s=>{const{title:d,setTitle:M,description:L,setDescription:C,tagsInput:c,setTagsInput:w,content:S,setContent:T,listeningContent:E,setListeningContent:g,testContent:m,setTestContent:h,isSaving:o,onSave:A,onPractice:j,onCancel:D,onOpenAiRefine:G}=s,[p,I]=a.useState("READING"),[k,O]=a.useState(!1),v=a.useMemo(()=>{let x="";return p==="READING"?x=S:p==="LISTENING"?x=E:x=m,$e(x)},[S,E,m,p]);return a.useEffect(()=>(window.handleLessonSpeak=x=>{fe(x)},()=>{delete window.handleLessonSpeak}),[]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:D,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(we,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,disabled:o,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(se,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:A,disabled:o,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[o?e.jsx(Be,{size:14,className:"animate-spin"}):e.jsx(ft,{size:14}),e.jsx("span",{children:o?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:d,onChange:x=>M(x.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Fe,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:c,onChange:x=>w(x.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 mb-1",children:"Short Description"}),e.jsx("textarea",{value:L,onChange:x=>C(x.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:()=>{I("READING"),O(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(_e,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{I("LISTENING"),O(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(be,{size:12,className:"inline mr-1"})," Audio Script"]}),e.jsxs("button",{onClick:()=>{I("TEST"),O(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${p==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Ne,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>G(p==="READING"?"reading":p==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(ae,{size:12}),e.jsxs("span",{children:["Generate ",p==="LISTENING"?"Audio Script":p]})]}),e.jsxs("button",{onClick:()=>O(!k),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[k?e.jsx(Se,{size:12}):e.jsx(bt,{size:12}),e.jsx("span",{children:k?"Edit":"Preview"})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[500px] relative overflow-hidden",children:k?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:v}}):e.jsx("textarea",{value:p==="READING"?S:p==="LISTENING"?E:m,onChange:x=>{p==="READING"?T(x.target.value):p==="LISTENING"?g(x.target.value):h(x.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${p.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},Qt=({lesson:s,user:d,onSave:M,onPractice:L,onCancel:C})=>{const[c,w]=a.useState(s.title),[S,T]=a.useState(s.description||""),[E,g]=a.useState(s.path||"/"),[m,h]=a.useState((s.tags||[]).join(", ")),[o,A]=a.useState(s.content),[j,D]=a.useState(s.listeningContent||""),[G,p]=a.useState(s.testContent||""),[I,k]=a.useState(!1),[O,v]=a.useState(null),{showToast:x}=Ee(),B=s.topic1,V=s.topic2;a.useEffect(()=>{if(s.path===void 0&&s.tags){const i=s.tags||[],U=i.find(f=>f.startsWith("/")),y=i.filter(f=>!f.startsWith("/"));g(U||"/"),h(y.join(", "))}else g(s.path||"/"),h((s.tags||[]).join(", "))},[s]);const _=()=>{const i=m.split(",").map(U=>U.trim()).filter(Boolean);return{...s,title:c,description:S,topic1:B,topic2:V,path:E.trim(),tags:i,content:o,listeningContent:j,testContent:G,updatedAt:Date.now()}},N=()=>{k(!0);const i=_();M(i)},b=()=>{k(!0);const i=_();L(i)},P=i=>{var F,H,q;const U=ie(),y=U.audioCoach.activeCoach,f=U.audioCoach.coaches[y].name;return i.format==="test"?We(c,o):Te({task:i.format==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:c,description:S,content:o},userRequest:i.request,language:i.language||((F=d.lessonPreferences)==null?void 0:F.language)||"English",targetAudience:((H=d.lessonPreferences)==null?void 0:H.targetAudience)||"Adult",tone:i.tone||((q=d.lessonPreferences)==null?void 0:q.tone)||"professional_professor",coachName:f,format:i.format||"reading"})},R=i=>{const{result:U,format:y}=i,f=U||i;y==="listening"?(D(f.content),x("Listening script updated!","success")):y==="test"?(p(f.content),x("Practice test generated!","success")):(w(f.title),T(f.description),A(f.content),!m.trim()&&f.tags&&f.tags.length>0&&h(f.tags.join(", ")),x("Lesson content refined!","success")),v(null)};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{title:c,setTitle:w,description:S,setDescription:T,path:E,setPath:g,tagsInput:m,setTagsInput:h,content:o,setContent:A,listeningContent:j,setListeningContent:D,testContent:G,setTestContent:p,isSaving:I,onSave:N,onPractice:b,onCancel:C,onOpenAiRefine:i=>v({format:i})}),O&&e.jsx(oe,{isOpen:!!O,onClose:()=>v(null),type:"REFINE_UNIT",title:`Generate ${O.format}`,description:`AI will create the ${O.format} component for this lesson.`,initialData:{...d.lessonPreferences,format:O.format},onGeneratePrompt:P,onJsonReceived:R,actionLabel:"Apply Changes"})]})},Jt=({lesson:s,onComplete:d,onEdit:M,onAddSound:L,onAddTest:C})=>{var _;const[c,w]=a.useState("READING"),[S,T]=a.useState("IDLE"),[E,g]=a.useState(-1),[m,h]=a.useState(!1),[o,A]=a.useState(0),j=a.useRef(!1),D=a.useRef(new Map),G=a.useRef(new Map),p=a.useMemo(()=>{let N="";return c==="READING"?N=s.content||"":c==="LISTENING"?N=s.listeningContent||"":c==="TEST"&&(N=s.testContent||""),$e(N)},[s.content,s.listeningContent,s.testContent,c]),I=a.useMemo(()=>{if(!s.listeningContent)return[];const N=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,b=[];let P;for(;(P=N.exec(s.listeningContent))!==null;)b.push({lang:P[1].toUpperCase()==="VN"?"vi":"en",text:P[2].replace(/\[.*?\]/g,"").trim()});return b},[s.listeningContent]),k=N=>{if(D.current.has(N))return Promise.resolve(D.current.get(N));if(G.current.has(N))return G.current.get(N);const b=I[N],P=Nt(b.text,b.lang).then(R=>(R&&(D.current.set(N,R),A(i=>i+1)),R));return G.current.set(N,P),P},O=async N=>{for(let b=N;b<I.length&&!j.current;b++)await k(b)},v=async()=>{S==="PAUSED"?(T("PLAYING"),j.current=!1):(j.current=!1,T("PLAYING"),O(0));const N=E===-1?0:E;for(let b=N;b<I.length&&!j.current;b++){g(b);const P=I[b];let R=D.current.get(b);if(R||(h(!0),R=await k(b),h(!1)),j.current)break;try{await fe(P.text,!0,P.lang,void 0,void 0,R||void 0)}catch(i){console.error("Speech playback error at index",b,i)}}j.current||(T("IDLE"),g(-1),A(0),D.current.clear(),G.current.clear())},x=()=>{j.current=!0,me(),T("IDLE"),g(-1),A(0),D.current.clear(),G.current.clear(),h(!1)};a.useEffect(()=>(window.handleLessonSpeak=N=>{fe(N)},()=>{x(),delete window.handleLessonSpeak}),[]);const B=I.length>0,V=o>=I.length;return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300",children:[e.jsxs("header",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:d,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(we,{size:14}),e.jsx("span",{children:"Back to Library"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:s.title}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[e.jsxs("button",{onClick:()=>w("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${c==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(_e,{size:12,className:"inline mr-1"})," Read"]}),e.jsxs("button",{onClick:()=>w("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${c==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(be,{size:12,className:"inline mr-1"})," Listen"]}),e.jsxs("button",{onClick:()=>w("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${c==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(Ne,{size:12,className:"inline mr-1"})," Test"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c==="LISTENING"&&B&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[S==="PLAYING"?e.jsx("button",{onClick:()=>{T("PAUSED"),me(),j.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(Ue,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:v,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(Re,{size:20,fill:"currentColor"})}),S!=="IDLE"&&e.jsx("button",{onClick:x,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Me,{size:20,fill:"currentColor"})})]}),c==="LISTENING"&&!B&&L&&e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-lg active:scale-95",children:[e.jsx(ae,{size:16}),e.jsx("span",{children:"Add Audio"})]}),c==="TEST"&&!s.testContent&&C&&e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-emerald-600 transition-all shadow-lg active:scale-95",children:[e.jsx(ae,{size:16}),e.jsx("span",{children:"Add Test"})]}),e.jsx("button",{onClick:M,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(Se,{size:20})})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px]",children:c==="TEST"&&!s.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(Ne,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available for this lesson."})]}):c==="LISTENING"&&!s.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(be,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."}),e.jsx("p",{className:"text-xs text-neutral-300 mt-2",children:'Click "Add Audio" to generate one.'})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:p}})}),c==="LISTENING"&&S!=="IDLE"&&e.jsxs("div",{className:"fixed bottom-10 left-1/2 -translate-x-1/2 bg-neutral-900/95 backdrop-blur-md text-white px-8 py-6 rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row items-center gap-8 animate-in slide-in-from-bottom-8 z-50 border border-neutral-800 ring-4 ring-black/10 w-[95%] max-w-4xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em]",children:["Narrating ",E+1," / ",I.length]}),m?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-amber-500/20 rounded-full",children:[e.jsx(Be,{size:10,className:"animate-spin text-amber-400"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-amber-400 tracking-wider",children:"Buffering..."})]}):!V&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-white/10 rounded-full",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-400"}),e.jsxs("span",{className:"text-[8px] font-black uppercase text-emerald-400 tracking-wider",children:["Downloaded ",o,"/",I.length]})]})]})}),e.jsxs("p",{className:"text-lg font-bold text-neutral-100 leading-relaxed italic line-clamp-2",children:['"',((_=I[E])==null?void 0:_.text)||"...",'"']})]}),e.jsxs("div",{className:"flex items-center gap-5 shrink-0 border-l border-white/10 pl-6 h-full self-stretch md:self-center",children:[e.jsx("button",{onClick:x,className:"p-4 text-neutral-400 hover:text-white transition-colors bg-white/5 rounded-full hover:bg-white/10",children:e.jsx(Me,{size:24,fill:"currentColor"})}),S==="PLAYING"?e.jsx("button",{onClick:()=>{T("PAUSED"),me(),j.current=!0},className:"w-16 h-16 bg-white text-neutral-900 rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",children:e.jsx(Ue,{size:32,fill:"currentColor"})}):e.jsx("button",{onClick:v,className:"w-16 h-16 bg-indigo-500 text-white rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",children:e.jsx(Re,{size:32,fill:"currentColor"})})]})]})]})},Kt=({user:s,lesson:d,onComplete:M,onEdit:L,onUpdate:C})=>{const[c,w]=a.useState(null),{showToast:S}=Ee(),T=g=>{var o,A,j;const m=ie(),h=m.audioCoach.coaches[m.audioCoach.activeCoach].name;return g.format==="test"||c==="test"?We(d.title,d.content):Te({task:"convert_to_listening",currentLesson:{title:d.title,description:d.description,content:d.content},userRequest:g.request,language:g.language||((o=s.lessonPreferences)==null?void 0:o.language)||"English",targetAudience:((A=s.lessonPreferences)==null?void 0:A.targetAudience)||"Adult",tone:g.tone||((j=s.lessonPreferences)==null?void 0:j.tone)||"professional_professor",coachName:h})},E=async g=>{const m=g.result||g,h=g.format||c,o={...d,updatedAt:Date.now()};h==="listening"?(o.listeningContent=m.content,S("Audio script added successfully!","success")):(o.testContent=m.content,S("Practice test added successfully!","success")),await ne(o),C&&C(o),w(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Jt,{lesson:d,onComplete:M,onEdit:L,onAddSound:()=>w("listening"),onAddTest:()=>w("test")}),c&&e.jsx(oe,{isOpen:!!c,onClose:()=>w(null),type:"GENERATE_AUDIO_SCRIPT",title:c==="listening"?"Add Lesson Sound":"Add Practice Test",description:c==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...s.lessonPreferences,format:c},onGeneratePrompt:T,onJsonReceived:E,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},Xt={filterSchema:[],viewSchema:[]},ze="vocab_pro_lesson_view_settings",ms=({user:s,onStartSession:d,onNavigate:M,onUpdateUser:L})=>{var Le;const[C,c]=a.useState([]),[w,S]=a.useState([]),[T,E]=a.useState([]),[g,m]=a.useState(!0),[h,o]=a.useState(null),[A,j]=a.useState(!1),[D,G]=a.useState(!1),[p,I]=a.useState("ALL"),[k,O]=a.useState("all"),[v,x]=a.useState("all"),[B,V]=a.useState(()=>wt(ze,{showDesc:!0,compact:!1})),[_,N]=a.useState(0),[b,P]=a.useState(12),[R,i]=a.useState("list"),[U,y]=a.useState(null),[f,F]=a.useState(null),[H,q]=a.useState(null),[Q,re]=a.useState(null),[Ye,le]=a.useState(!1),[Ve,ce]=a.useState(!1),[ve,de]=a.useState(!1),[Z,He]=a.useState(null),{currentShelfName:ue,booksOnCurrentShelf:he,allShelves:ee,addShelf:qe,renameShelf:Qe,removeShelf:Je,nextShelf:Ke,prevShelf:Xe,selectShelf:Ze}=Mt(w,"lesson_books_shelves"),[et,pe]=a.useState(!1),[tt,ge]=a.useState(!1),[W,xe]=a.useState(null),{showToast:J}=Ee();a.useEffect(()=>{St(ze,B)},[B]);const $=a.useCallback(async()=>{m(!0);try{const[t,l,u]=await Promise.all([Et(s.id),Tt(s.id),vt()]),n=[...t.map(r=>({type:"ESSAY",data:r,path:r.path,tags:r.tags,date:r.createdAt}))];c(n.sort((r,z)=>z.date-r.date)),S(l.sort((r,z)=>z.createdAt-r.createdAt)),E(u)}finally{m(!1)}},[s.id]);a.useEffect(()=>{$()},[$]),a.useEffect(()=>{N(0)},[h,p,k,v,b]);const st=a.useMemo(()=>p!=="ALL"||k!=="all"||v!=="all",[p,k,v]),Y=a.useMemo(()=>C.filter(t=>{var l,u;if(p!=="ALL"&&t.type!==p||k==="focused"&&!t.data.isFocused||v!=="all"&&t.data.focusColor!==v)return!1;if(h){if(h==="Uncategorized"){const n=t.path??(t.tags||[]).find(z=>z.startsWith("/"));if(n&&n!=="/")return!1}else if(!((l=t.path)!=null&&l.startsWith(h))&&!((u=t.tags)!=null&&u.includes(h)))return!1}return!0}),[C,h,p,k,v]),nt=a.useMemo(()=>{const t=_*b;return Y.slice(t,t+b)},[Y,_,b]),at=t=>{Qe(t,async(u,n)=>{m(!0);const r=w.filter(z=>{const K=z.title.split(":");return(K.length>1?K[0].trim():"General")===u});await Promise.all(r.map(z=>{const K=z.title.split(":"),Oe=K.length>1?K.slice(1).join(":").trim():K[0],xt=`${n}: ${Oe}`;return X({...z,title:xt,updatedAt:Date.now()})})),await $()})&&ge(!1)},Ce=async()=>{const t={id:`lb-${Date.now()}`,userId:s.id,title:`${ue}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#1a237e",icon:"ðŸ“˜"};await X(t),await $(),F(t),i("book_detail"),J("New book created.","success")},ot=async t=>{if(!f)return;const l={...f,...t,updatedAt:Date.now()};S(u=>u.map(n=>n.id===l.id?l:n)),F(l),await X(l)},it=async t=>{if(!W)return;const l=W.title.split(":"),u=l.length>1?l.slice(1).join(":").trim():l[0],n=`${t}: ${u}`,r={...W,title:n,updatedAt:Date.now()};await X(r),xe(null),await $(),J(`Moved to "${t}".`,"success")},rt=async()=>{H&&(await kt(H.id),J("Lesson deleted.","success"),q(null),$())},lt=async t=>{await ne(t),J("Lesson saved!","success"),i(f?"book_detail":"list"),y(null),$()},ct=()=>{const t={id:`lesson-${Date.now()}`,userId:s.id,topic1:"",topic2:"",title:"New Lesson",description:"",content:"",tags:[],createdAt:Date.now(),updatedAt:Date.now()};y(t),i("edit_lesson")},Ae=async t=>{const{result:l,preferences:u}=t;JSON.stringify(s.lessonPreferences)!==JSON.stringify(u)&&await L({...s,lessonPreferences:u});const n={id:`lesson-ai-${Date.now()}`,userId:s.id,title:l.title,description:l.description,content:l.content,tags:l.tags||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"",topic2:""};await ne(n),J("Lesson created with AI!","success"),le(!1),ce(!1),y(n),i("read_lesson"),$()},je=async(t,l)=>{const u={...t.data,focusColor:l||void 0,updatedAt:Date.now()};l||delete u.focusColor,await ne(u),c(n=>n.map(r=>r.data.id===t.data.id?{...r,data:{...r.data,focusColor:l||void 0,updatedAt:Date.now()}}:r))},ke=async t=>{const l={...t.data,isFocused:!t.data.isFocused,updatedAt:Date.now()};await ne(l),c(u=>u.map(n=>n.data.id===t.data.id?{...n,data:{...n.data,isFocused:!n.data.isFocused,updatedAt:Date.now()}}:n))},dt=()=>{if(Y.length===0){J("No items to randomize.","info");return}const t=Y[Math.floor(Math.random()*Y.length)];y(t.data),i("read_lesson")},Ie=t=>{Ze(t),i("shelf")},ye=t=>{F(t),i("book_detail")},ut=[{label:"Topic Lesson (AI)",icon:ae,onClick:()=>le(!0)},{label:"Word Lesson (AI)",icon:se,onClick:()=>de(!0)},{label:"New Lesson (Manual)",icon:De,onClick:ct}],ht=t=>{const l=ie(),u=l.audioCoach.activeCoach,n=l.audioCoach.coaches[u].name;return Te({topic:t.topic,language:t.language,targetAudience:t.targetAudience,tone:t.tone,format:t.format,coachName:n,task:"create_reading"})},pt=t=>{if(!Z)return"";const l=ie(),u=l.audioCoach.activeCoach,n=l.audioCoach.coaches[u].name;return Ht(Z,{language:t.language,targetAudience:t.targetAudience,tone:t.tone,format:t.format},n)},gt=t=>{if(t.length===0)return;const l=t[0],u=T.find(n=>n.word.toLowerCase()===l.toLowerCase());u&&(He(u),de(!1),ce(!0))};if(R==="read_lesson"&&U)return e.jsx(Kt,{user:s,lesson:U,onComplete:()=>i(f?"book_detail":"list"),onEdit:()=>i("edit_lesson"),onUpdate:t=>y(t)});if(R==="edit_lesson"&&U)return e.jsx(Qt,{lesson:U,user:s,onSave:lt,onPractice:t=>{y(t),i("read_lesson")},onCancel:()=>i(f?"book_detail":"list")});if(R==="book_detail"&&f){const t=new Map(C.map(n=>[n.data.id,n])),l=f.itemIds.map(n=>{const r=t.get(n);return r?{id:n,title:r.data.title,subtitle:r.data.description,data:r.data,focusColor:r.data.focusColor,isFocused:r.data.isFocused}:null}).filter(n=>n!==null),u=C.map(n=>({id:n.data.id,title:n.data.title,subtitle:n.data.description,data:n.data}));return e.jsx(Dt,{book:f,items:l,availableItems:u,onBack:()=>{F(null),i("shelf"),$()},onUpdateBook:ot,onAddItem:async n=>{const r={...f,itemIds:Array.from(new Set([...f.itemIds,...n]))};await X(r),F(r)},onRemoveItem:async n=>{const r={...f,itemIds:f.itemIds.filter(z=>z!==n)};await X(r),F(r)},onOpenItem:n=>{y(n.data),i("read_lesson")},onEditItem:n=>{y(n.data),i("edit_lesson")},onFocusChange:(n,r)=>je({data:n.data},r),onToggleFocus:n=>ke({data:n.data}),itemIcon:e.jsx(se,{size:16})})}return R==="shelf"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>i("list"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(we,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Lesson Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Browse your lesson collections."})]}),e.jsx(Ge,{shelves:ee,books:w,onNavigateShelf:Ie,onNavigateBook:ye}),e.jsxs("button",{onClick:()=>pe(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Ut,{size:14})," Add Shelf"]})]})]}),e.jsxs(Gt,{label:ue,onNext:ee.length>1?Ke:void 0,onPrev:ee.length>1?Xe:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ge(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Wt,{size:14})}),e.jsx("button",{onClick:Je,disabled:he.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(te,{size:14})})]}),isEmpty:he.length===0,emptyAction:e.jsx("button",{onClick:Ce,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[he.map(t=>{var u;const l=((u=t.title.split(":").pop())==null?void 0:u.trim())||t.title;return e.jsx(zt,{id:t.id,title:l,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(se,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{F(t),i("book_detail")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),xe(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(_t,{size:16})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),re(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(te,{size:16})})]})},t.id)}),e.jsx("div",{className:"group translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:Ce,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(De,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(Pe,{isOpen:!!Q,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Le=Q==null?void 0:Q.title.split(":").pop())==null?void 0:Le.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:async()=>{Q&&await Ct(Q.id),re(null),$()},onClose:()=>re(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(Bt,{isOpen:!!W,onClose:()=>xe(null),onConfirm:it,shelves:ee,currentShelf:W?W.title.split(":")[0].trim():"General",bookTitle:(W==null?void 0:W.title)||""}),e.jsx(Ft,{isOpen:et,onClose:()=>pe(!1),onSave:t=>{qe(t)&&pe(!1)}}),e.jsx($t,{isOpen:tt,onClose:()=>ge(!1),onSave:at,initialName:ue})]}):e.jsxs(e.Fragment,{children:[e.jsx(It,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),centerContent:e.jsx(Ge,{shelves:ee,books:w,onNavigateShelf:Ie,onNavigateBook:ye}),minorSkills:e.jsxs("button",{onClick:()=>M("IRREGULAR_VERBS"),className:"flex items-center gap-2 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-xs font-bold hover:bg-orange-100 transition-colors",children:[e.jsx(Vt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Irregular Verbs"})]}),pagination:{page:_,totalPages:Math.ceil(Y.length/b),onPageChange:N,pageSize:b,onPageSizeChange:P,totalItems:Y.length},actions:e.jsx(yt,{viewMenu:e.jsx(Pt,{isOpen:D,setIsOpen:G,hasActiveFilters:st,filterOptions:[{label:"All",value:"ALL",isActive:p==="ALL",onClick:()=>I("ALL")},{label:"Lesson",value:"ESSAY",isActive:p==="ESSAY",onClick:()=>I("ESSAY")}],customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(jt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>O(k==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${k==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:k==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(v==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${v==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>x(v==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${v==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>x(v==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${v==="red"?"bg-rose-50 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:B.showDesc,onChange:()=>V(t=>({...t,showDesc:!t.showDesc}))},{label:"Compact",checked:B.compact,onChange:()=>V(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:A,onToggle:()=>{j(!A)}},addActions:ut,extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:dt,disabled:C.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(At,{size:16})}),e.jsxs("button",{onClick:()=>i("shelf"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(Yt,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),aboveGrid:e.jsx(e.Fragment,{children:A&&e.jsx(Lt,{items:C,selectedTag:h,onSelectTag:o,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Fe,{size:16})})}),config:Xt,activeFilters:{},onFilterChange:()=>{},isLoading:g,isEmpty:Y.length===0,emptyMessage:"No items found matching your criteria.",children:()=>e.jsx(e.Fragment,{children:nt.map(t=>{const l=()=>{y(t.data),i("read_lesson")},u=()=>{y(t.data),i("edit_lesson")},n=()=>q(t.data);return e.jsx(Ot,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:t.data.title}),tags:t.data.tags,compact:B.compact,onClick:l,focusColor:t.data.focusColor,onFocusChange:r=>je(t,r),isFocused:t.data.isFocused,onToggleFocus:()=>ke(t),isCompleted:t.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),l()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),u()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Se,{size:14})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),n()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(te,{size:14})})]}),children:B.showDesc&&t.data.description&&e.jsx("p",{className:"line-clamp-2",children:t.data.description})},`${t.type}-${t.data.id}`)})})}),e.jsx(Pe,{isOpen:!!H,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:rt,onClose:()=>q(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(oe,{isOpen:Ye,onClose:()=>le(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:s.lessonPreferences,onGeneratePrompt:ht,onJsonReceived:Ae,actionLabel:"Create Lesson",closeOnSuccess:!0}),e.jsx(oe,{isOpen:Ve,onClose:()=>ce(!1),type:"GENERATE_WORD_LESSON",title:`AI Word Lesson: ${Z==null?void 0:Z.word}`,description:"Creating a deep-dive lesson based on your library data.",initialData:s.lessonPreferences,onGeneratePrompt:pt,onJsonReceived:Ae,actionLabel:"Create Word Lesson",closeOnSuccess:!0}),ve&&e.jsx(Rt,{isOpen:ve,onClose:()=>de(!1),onSelect:gt,allWords:T,wordsToExclude:new Set,loading:g})]})};export{ms as LessonLibraryV2,ms as default};
