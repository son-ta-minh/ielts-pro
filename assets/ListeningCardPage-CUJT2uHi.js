import{c as ee,r as n,G as nt,a5 as lt,D as Ce,j as e,A as rt,ao as J,a3 as ue,aq as ve,aI as at,P as ot,a6 as Ie,l as it,ar as ct,a7 as dt,bI as ut,bJ as xt,bK as Q,bL as ht,bM as Y,X as D,ah as ft,bN as we,bO as mt,m as pt,aE as gt,s as bt,a as Ne,bP as jt,t as vt}from"./index-CMQqxrid.js";import{R as wt,a as Nt}from"./ResourceActions-QXdUhQgw.js";import{u as yt,G as kt,S as ye,V as St}from"./ShelfSearchBar-CWxdLaJ0.js";import{U as Ct}from"./UniversalCard-B6hfb4tD.js";import{T as It}from"./TagBrowser-Cpvbz8ig.js";import{F as Tt,U as At,a as Ft,M as zt,A as Lt,R as Pt}from"./ShelfModals-C1usJcHQ.js";import{E as Z}from"./ear-wSrosEk_.js";import{M as Mt}from"./move-CoVq279E.js";import{P as Bt}from"./pen-DfbuXqx4.js";import{L as Et}from"./library-CUTfZHO-.js";import{F as Te,C as Ot}from"./file-audio-IhqI2iGW.js";import{P as $t}from"./pause-Kg13yPfL.js";import{F as ke}from"./folder-BZ95i3E9.js";import"./chevron-left-Bz0xBzMD.js";import"./circle-BFdDN-84.js";import"./palette-D0CO4zEM.js";import"./square-check-big-Dj3Ze1lB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=ee("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ee("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ee("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=ee("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Se="vocab_pro_listening_view",Gt=({text:u})=>{const N=u.split(/({.*?})/g);return e.jsx("span",{className:"leading-relaxed",children:N.map((b,o)=>b.startsWith("{")&&b.endsWith("}")?e.jsx("span",{className:"inline-block bg-red-100 text-red-700 px-1.5 py-0.5 rounded-md font-bold mx-0.5 border border-red-200 text-[0.9em] align-baseline",children:b.slice(1,-1)},o):e.jsx("span",{children:b},o))})},_t=({rawText:u,onUpdate:N,readOnly:b=!1})=>{const o=n.useRef(null),[a,g]=n.useState(null),k=n.useMemo(()=>{const l=[],x=/({.*?})/g;let p,c=0;for(;(p=x.exec(u))!==null;)p.index>c&&l.push({text:u.slice(c,p.index),isHighlight:!1,start:c,end:p.index}),l.push({text:p[0],isHighlight:!0,start:p.index,end:x.lastIndex}),c=x.lastIndex;return c<u.length&&l.push({text:u.slice(c),isHighlight:!1,start:c,end:u.length}),l},[u]),I=()=>{if(b)return;const l=window.getSelection(),x=c=>{if(!c)return null;let h=c.nodeType===3?c.parentElement:c;for(;h&&h!==o.current&&!h.hasAttribute("data-index");)h=h.parentElement;return h&&h.hasAttribute("data-index")?parseInt(h.getAttribute("data-index"),10):null};if(!l||!l.anchorNode||!l.focusNode){g(null);return}const p=x(l.anchorNode);if(p!==null){const c=k[p];if(c.isHighlight){g({type:"remove",start:c.start,end:c.end});return}}if(!l.isCollapsed){const c=x(l.focusNode);if(p!==null&&p===c){const h=k[p];if(!h.isHighlight){const S=l.anchorNode;if(S&&S.nodeType===3){const v=Math.min(l.anchorOffset,l.focusOffset),E=Math.max(l.anchorOffset,l.focusOffset),y=h.start+v,$=h.start+E;if(l.toString()){g({type:"add",start:y,end:$});return}}}}}g(null)},d=()=>{var l;if(a){if(a.type==="remove"){const x=u.slice(0,a.start),p=u.slice(a.start+1,a.end-1),c=u.slice(a.end);N(x+p+c)}else{const x=u.slice(0,a.start),p=u.slice(a.start,a.end),c=u.slice(a.end);N(`${x}{${p}}${c}`)}g(null),(l=window.getSelection())==null||l.removeAllRanges()}};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx("div",{className:"absolute top-2 left-2 z-20 h-8",children:e.jsxs("button",{onClick:l=>{l.preventDefault(),d()},disabled:!a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shadow-lg transition-all transform duration-200 ${a?"translate-y-0 opacity-100 pointer-events-auto":"-translate-y-2 opacity-0 pointer-events-none"} ${(a==null?void 0:a.type)==="remove"?"bg-white text-rose-600 border border-rose-100 hover:bg-rose-50":"bg-neutral-900 text-white border border-neutral-800 hover:bg-neutral-800"}`,children:[(a==null?void 0:a.type)==="remove"?e.jsx(jt,{size:12}):e.jsx(Rt,{size:12}),e.jsx("span",{children:(a==null?void 0:a.type)==="remove"?"Unhighlight":"Highlight"})]})}),e.jsx("div",{ref:o,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap pt-12 pb-4 px-4 select-text cursor-text font-mono",onMouseUp:I,onKeyUp:I,children:k.map((l,x)=>e.jsx("span",{"data-index":x,className:l.isHighlight?"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200 cursor-pointer hover:bg-red-200 hover:border-red-300 transition-colors":"",children:l.isHighlight?l.text.slice(1,-1):l.text},`${x}-${l.start}`))})]})},Vt=({isOpen:u,onClose:N,onSelect:b})=>{const o=pt(),a=gt(o),{showToast:g}=Ce(),[k,I]=n.useState({}),[d,l]=n.useState(null),[x,p]=n.useState(""),[c,h]=n.useState([]),[S,v]=n.useState(!1);n.useEffect(()=>{u&&(E(),l(null),p(""),h([]))},[u]);const E=async()=>{v(!0);try{const r=await fetch(`${a}/api/audio/mappings`);r.ok?I(await r.json()):g("Failed to connect to audio server","error")}catch{g("Audio server unreachable","error")}finally{v(!1)}},y=async(r,m="")=>{v(!0);try{const T=encodeURIComponent(m),z=await fetch(`${a}/api/audio/files/${r}?path=${T}`);if(z.ok){const O=await z.json();let F=[];Array.isArray(O.items)?F=O.items:Array.isArray(O.files)&&(F=O.files.map(w=>({name:w,type:"file"}))),h(F),p(O.currentPath||"")}else g("Failed to load files","error")}catch{g("Connection error","error")}finally{v(!1)}},$=r=>{l(r),y(r,"")},A=r=>{if(!d)return;const m=x?`${x}/${r}`:r;y(d,m)},M=()=>{if(d)if(!x)l(null),h([]);else{const r=x.split("/");r.pop();const m=r.join("/");y(d,m)}},f=r=>{if(!d)return;const m=x?`${x}/${r}`:r,T=`${a}/api/audio/stream/${d}/${m}`;b(T,r),N()};return u?e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(Ae,{size:20})," Select Audio"]}),e.jsx("button",{onClick:N,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(D,{size:20})})]}),e.jsxs("div",{className:"p-4 bg-neutral-50 border-b border-neutral-100 flex items-center gap-2 overflow-hidden",children:[d&&e.jsx("button",{onClick:M,className:"p-1.5 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-100 transition-colors",children:e.jsx(Ot,{size:14})}),e.jsx("div",{className:"flex-1 truncate text-xs font-mono font-medium text-neutral-600",children:d?`/${d}/${x}`:"Root"})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:S?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(bt,{size:24,className:"animate-spin text-neutral-300"})}):d?e.jsxs("div",{className:"space-y-1",children:[c.map((r,m)=>e.jsxs("button",{onClick:()=>r.type==="directory"?A(r.name):f(r.name),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-neutral-50 transition-colors text-left group",children:[r.type==="directory"?e.jsx(ke,{size:18,className:"text-indigo-400"}):e.jsx(Te,{size:18,className:"text-emerald-500"}),e.jsx("span",{className:"text-xs font-medium text-neutral-700 truncate flex-1",children:r.name}),r.type==="directory"&&e.jsx(Ne,{size:14,className:"text-neutral-300"})]},`${r.name}-${m}`)),c.length===0&&e.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"Empty folder."})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest px-2 mb-2",children:"Mapped Folders"}),Object.keys(k).map(r=>e.jsxs("button",{onClick:()=>$(r),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-neutral-50 transition-colors text-left group",children:[e.jsx(ke,{size:18,className:"text-indigo-400 group-hover:text-indigo-600"}),e.jsx("span",{className:"text-sm font-bold text-neutral-700",children:r}),e.jsx(Ne,{size:14,className:"ml-auto text-neutral-300"})]},r)),Object.keys(k).length===0&&e.jsx("p",{className:"text-center text-xs text-neutral-400 py-4",children:"No mappings found. Configure in Settings."})]})})]})}):null},Kt=({isOpen:u,onClose:N,item:b,onUpdate:o})=>{const a=b.audioLinks||[],[g,k]=n.useState(0),[I,d]=n.useState(!1),[l,x]=n.useState(0),[p,c]=n.useState(0),[h,S]=n.useState(b.text),[v,E]=n.useState(!1),y=n.useRef(null);n.useEffect(()=>()=>{A()},[]),n.useEffect(()=>{u?(S(b.text),M(0,!1)):(A(),k(0))},[u,b]);const $=w=>{S(w),o({...b,text:w})},A=()=>{y.current&&(y.current.pause(),y.current=null),we(),d(!1),c(0),x(0)},M=(w,L)=>{if(A(),k(w),a.length>0&&a[w]){const _=a[w],P=new Audio(_);y.current=P,P.addEventListener("loadedmetadata",()=>{x(P.duration)}),P.addEventListener("timeupdate",()=>{c(P.currentTime)}),P.addEventListener("ended",()=>{d(!1),w<a.length-1?M(w+1,!0):c(0)}),P.addEventListener("error",()=>{d(!1)}),L&&(P.play().catch(console.error),d(!0))}},f=()=>{if(a.length>0)y.current?I?(y.current.pause(),d(!1)):(y.current.play().catch(console.error),d(!0)):M(g,!0);else if(I)we(),d(!1);else{const w=b.text.replace(/[{}]/g,"");vt(w),d(!0);const L=w.length/10*1e3;setTimeout(()=>d(!1),L)}},r=w=>{const L=Number(w.target.value);c(L),y.current&&(y.current.currentTime=L)},m=()=>{g>0&&M(g-1,!0)},T=()=>{g<a.length-1&&M(g+1,!0)},z=()=>{A(),N()};if(!u)return null;const O=a.length>0?decodeURIComponent(a[g].split("/").pop()||`Track ${g+1}`):"System Voice (TTS)",F=w=>{const L=Math.floor(w/60),_=Math.floor(w%60);return`${L}:${_.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-7xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center bg-white z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(Z,{size:20})," Listening Practice"]}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1 max-w-[250px] truncate",children:b.title||b.note||"Practice Session"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-neutral-100 p-1 rounded-xl flex items-center",children:[e.jsx("button",{onClick:()=>E(!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${v?"text-neutral-500":"bg-white shadow-sm text-neutral-900"}`,children:"Read"}),e.jsx("button",{onClick:()=>E(!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${v?"bg-white shadow-sm text-neutral-900":"text-neutral-500"}`,children:"Edit Raw"})]}),e.jsx("button",{onClick:z,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(D,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden relative bg-neutral-50/50",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar relative",children:v?e.jsx("textarea",{value:h,onChange:w=>$(w.target.value),className:"w-full h-full p-6 bg-white border border-neutral-200 rounded-2xl resize-none outline-none text-lg font-medium leading-relaxed font-mono text-neutral-700 shadow-sm",placeholder:"Paste transcript here..."}):e.jsx("div",{className:"h-full flex flex-col bg-white border border-neutral-200 rounded-2xl shadow-sm p-8 overflow-y-auto",children:e.jsx(_t,{rawText:h,onUpdate:$})})})}),e.jsxs("div",{className:"px-6 py-3 bg-white border-t border-neutral-100 shrink-0 flex items-center gap-4",children:[e.jsxs("div",{className:"w-48 shrink-0",children:[e.jsx("h4",{className:"text-xs font-bold text-neutral-900 truncate",children:O}),a.length>1&&e.jsxs("p",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:["Track ",g+1,"/",a.length]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("button",{onClick:m,disabled:g===0,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Ut,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:f,className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center shadow-md hover:scale-105 active:scale-95 transition-all",children:I?e.jsx($t,{size:16,fill:"currentColor"}):e.jsx(Ie,{size:16,fill:"currentColor",className:"ml-0.5"})}),e.jsx("button",{onClick:T,disabled:g===a.length-1,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Ht,{size:18,fill:"currentColor"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 ml-2",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:F(p)}),e.jsxs("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full relative group cursor-pointer",children:[a.length>0&&e.jsx("input",{type:"range",min:"0",max:l||100,value:p,onChange:r,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-neutral-900 rounded-full transition-all",style:{width:`${l?p/l*100:0}%`}})]}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:F(l)})]})]})]})]})})},Wt=({isOpen:u,onClose:N,onSave:b,initialData:o})=>{const[a,g]=n.useState(""),[k,I]=n.useState(""),[d,l]=n.useState(""),[x,p]=n.useState("/"),[c,h]=n.useState(""),[S,v]=n.useState([]),[E,y]=n.useState(!1);n.useEffect(()=>{var f;if(u)if(g((o==null?void 0:o.title)||""),I((o==null?void 0:o.text)||""),l((o==null?void 0:o.note)||""),v((o==null?void 0:o.audioLinks)||[]),(o==null?void 0:o.path)===void 0){const r=(o==null?void 0:o.tags)||[],m=r.find(z=>z.startsWith("/")),T=r.filter(z=>!z.startsWith("/"));p(m||"/"),h(T.join(", "))}else p((o==null?void 0:o.path)||"/"),h(((f=o==null?void 0:o.tags)==null?void 0:f.join(", "))||"")},[u,o]);const $=f=>{if(f.preventDefault(),k.trim()){const r=c.split(",").map(m=>m.trim()).filter(Boolean);b(a.trim(),k.trim(),d.trim(),x.trim(),r,S)}},A=f=>{v(r=>[...r,f])},M=f=>{v(r=>r.filter((m,T)=>T!==f))};return u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:$,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:o?"Edit Listening Card":"New Listening Card"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text script and attach audio."})]}),e.jsx("button",{type:"button",onClick:N,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(D,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title"}),e.jsx("input",{value:a,onChange:f=>g(f.target.value),placeholder:"e.g. Unit 1 Podcast",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Script / Transcript"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:k,onChange:f=>I(f.target.value),placeholder:"Paste full transcript here...",rows:6,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0})}),e.jsx("p",{className:"text-[10px] text-neutral-400 italic",children:"You can highlight key phrases in Practice mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Attached Audio"}),e.jsxs("button",{type:"button",onClick:()=>y(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(ue,{size:12})," From Server"]})]}),e.jsxs("div",{className:"space-y-2",children:[S.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2",children:"No audio files attached."}),S.map((f,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-50 rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(Te,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(f.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>M(r),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(D,{size:14})})]},r))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:d,onChange:f=>l(f.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags"}),e.jsx("input",{value:c,onChange:f=>h(f.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(ft,{size:14})," Save Item"]})})]})}),e.jsx(Vt,{isOpen:E,onClose:()=>y(!1),onSelect:A})]}):null},ds=({user:u})=>{var je;const[N,b]=n.useState([]),[o,a]=n.useState([]),[g,k]=n.useState(!0),[I,d]=n.useState("LIST"),[l,x]=n.useState(null),[p,c]=n.useState(!1),[h,S]=n.useState(()=>nt(Se,{showNote:!0,compact:!1,showType:!0})),[v,E]=n.useState(null),[y,$]=n.useState(!1),[A,M]=n.useState(!1),[f,r]=n.useState("all"),[m,T]=n.useState("all"),[z,O]=n.useState(0),[F,w]=n.useState(12),[L,_]=n.useState(null),{currentShelfName:P,booksOnCurrentShelf:te,allShelves:W,addShelf:Fe,renameShelf:ze,removeShelf:Le,nextShelf:Pe,prevShelf:Me,selectShelf:Be}=yt(o,"listening_books_shelves"),[Ee,se]=n.useState(!1),[Oe,ne]=n.useState(!1),[R,le]=n.useState(null);n.useEffect(()=>{lt(Se,h)},[h]);const[$e,X]=n.useState(!1),[re,xe]=n.useState(null),[ae,oe]=n.useState(null),[V,ie]=n.useState(null),{showToast:H}=Ce(),U=async()=>{k(!0);const[t,s]=await Promise.all([ut(u.id),xt(u.id)]);b(t.sort((i,j)=>j.createdAt-i.createdAt)),a(s.sort((i,j)=>j.createdAt-i.createdAt)),k(!1)};n.useEffect(()=>{U()},[u.id]),n.useEffect(()=>{O(0)},[v,F,f,m]);const Re=n.useMemo(()=>f!=="all"||m!=="all",[f,m]),q=n.useMemo(()=>{let t=N;return f==="focused"&&(t=t.filter(s=>s.isFocused)),m!=="all"&&(t=t.filter(s=>s.focusColor===m)),v&&(v==="Uncategorized"?t=t.filter(s=>{const i=s.path??(s.tags||[]).find(C=>C.startsWith("/"));return!(i&&i!=="/"&&i!=="")}):t=t.filter(s=>{var i,j;return((i=s.path)==null?void 0:i.startsWith(v))||((j=s.tags)==null?void 0:j.includes(v))})),t},[N,v,f,m]),Ue=n.useMemo(()=>{const t=z*F;return q.slice(t,t+F)},[q,z,F]),He=()=>{xe(null),X(!0)},he=t=>{xe(t),X(!0)},Ge=async()=>{ae&&(await mt(ae.id),oe(null),H("Deleted item.","success"),U())},_e=async(t,s,i,j,C,G)=>{try{const B=Date.now();if(re){const K={...re,title:t,text:s,note:i,path:j,tags:C,audioLinks:G,updatedAt:B};await Y(K),H("Item updated!","success")}else{const K={id:`lst-${B}-${Math.random()}`,userId:u.id,title:t,text:s,note:i,path:j,tags:C,audioLinks:G,createdAt:B,updatedAt:B};await Y(K),H("Item added!","success")}X(!1),U()}catch{H("Failed to save item.","error")}},Ve=async t=>{await Y(t),_(t),U()},ce=t=>{_(t)},Ke=()=>{b(t=>[...t].sort(()=>Math.random()-.5)),H("Shuffled!","success")},fe=async(t,s)=>{const i={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete i.focusColor,b(j=>j.map(C=>C.id===t.id?i:C)),await Y(i)},me=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};b(i=>i.map(j=>j.id===t.id?s:j)),await Y(s)},We=t=>{ze(t,async(i,j)=>{k(!0);const C=o.filter(G=>{const B=G.title.split(":");return(B.length>1?B[0].trim():"General")===i});await Promise.all(C.map(G=>{const B=G.title.split(":"),K=B.length>1?B.slice(1).join(":").trim():G.title,st=`${j}: ${K}`;return Q({...G,title:st,updatedAt:Date.now()})})),await U()})&&ne(!1)},pe=async()=>{const t={id:`lb-${Date.now()}`,userId:u.id,title:`${P}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#ff9800",icon:"ðŸŽ§"};await Q(t),await U(),x(t),d("BOOK_DETAIL"),H("New book created.","success")},de=async t=>{if(!l)return;const s={...l,...t,updatedAt:Date.now()};a(i=>i.map(j=>j.id===s.id?s:j)),x(s),await Q(s)},qe=async()=>{V&&(await ht(V.id),H("Book deleted.","success"),ie(null),await U())},Je=async t=>{if(!R)return;const s=R.title.split(":"),i=s.length>1?s.slice(1).join(":").trim():s[0],j=`${t}: ${i}`,C={...R,title:j,updatedAt:Date.now()};await Q(C),le(null),await U(),H(`Moved to "${t}".`,"success")},Ye=n.useMemo(()=>l?l.itemIds.map(t=>{const s=N.find(i=>i.id===t);return s?{id:s.id,title:s.title||s.text,subtitle:s.note||"Listening Practice",data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[l,N]),Xe=n.useMemo(()=>N.map(t=>({id:t.id,title:t.title||t.text,subtitle:`${t.text.length} characters`,data:t})),[N]),Qe=t=>{if(!l)return;const s=Array.from(new Set([...l.itemIds,...t]));de({itemIds:s})},Ze=t=>{if(!l)return;const s=l.itemIds.filter(i=>i!==t);de({itemIds:s})},De=(t,s)=>{const i=t.data;fe(i,s)},et=t=>{const s=t.data;me(s)},ge=t=>{Be(t),d("SHELF")},be=t=>{x(t),d("BOOK_DETAIL")},tt=t=>{if(t.title)return e.jsx("div",{className:"font-black text-lg text-neutral-900 leading-tight",children:t.title});const s=t.text.split(/\s+/),i=s.length>15?s.slice(0,15).join(" ")+"...":t.text;return e.jsx("div",{className:"font-medium text-lg text-neutral-700 leading-tight",children:e.jsx(Gt,{text:i})})};return I==="BOOK_DETAIL"&&l?e.jsx(kt,{book:l,items:Ye,availableItems:Xe,onBack:()=>{x(null),d("SHELF"),U()},onUpdateBook:de,onAddItem:Qe,onRemoveItem:Ze,onOpenItem:t=>ce(t.data),onEditItem:t=>he(t.data),onFocusChange:De,onToggleFocus:et,itemIcon:e.jsx(Z,{size:16})}):I==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>d("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(rt,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Listening Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your listening practice."})]}),e.jsx(ye,{shelves:W,books:o,onNavigateShelf:ge,onNavigateBook:be}),e.jsxs("button",{onClick:()=>se(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Tt,{size:14})," Add Shelf"]})]})]}),e.jsxs(At,{label:P,onNext:W.length>1?Pe:void 0,onPrev:W.length>1?Me:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ne(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Bt,{size:14})}),e.jsx("button",{onClick:Le,disabled:te.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(J,{size:14})})]}),isEmpty:te.length===0,emptyAction:e.jsx("button",{onClick:pe,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[te.map(t=>{const s=t.title,i=s.split(":"),j=i.length>1?i.slice(1).join(":").trim():s;return e.jsx(Ft,{id:t.id,title:j,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(Z,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{x(t),d("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),le(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Mt,{size:16})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),ie(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(J,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:pe,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(ue,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(ve,{isOpen:!!V,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(je=V==null?void 0:V.title.split(":").pop())==null?void 0:je.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:qe,onClose:()=>ie(null),icon:e.jsx(J,{size:40,className:"text-red-500"})}),e.jsx(zt,{isOpen:!!R,onClose:()=>le(null),onConfirm:Je,shelves:W,currentShelf:R?R.title.split(":")[0].trim():"General",bookTitle:(R==null?void 0:R.title)||""}),e.jsx(Lt,{isOpen:Ee,onClose:()=>se(!1),onSave:t=>{Fe(t)&&se(!1)}}),e.jsx(Pt,{isOpen:Oe,onClose:()=>ne(!1),onSave:We,initialName:P})]}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),centerContent:e.jsx(ye,{shelves:W,books:o,onNavigateShelf:ge,onNavigateBook:be}),config:{},isLoading:g,isEmpty:q.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:z,totalPages:Math.ceil(q.length/F),onPageChange:O,pageSize:F,onPageSizeChange:w,totalItems:q.length},aboveGrid:e.jsx(e.Fragment,{children:A&&e.jsx(It,{items:N,selectedTag:v,onSelectTag:E,forcedView:"tags",title:"Browse Tags",icon:e.jsx(dt,{size:16})})}),actions:e.jsx(Nt,{viewMenu:e.jsx(St,{isOpen:p,setIsOpen:c,hasActiveFilters:Re,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(ct,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>r(f==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${f==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:f==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>T(m==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>T(m==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>T(m==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${m==="red"?"bg-rose-50 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:h.showNote,onChange:()=>S(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:h.showType,onChange:()=>S(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:h.compact,onChange:()=>S(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:A,onToggle:()=>{M(!A)}},addActions:[{label:"Add Phrase",icon:ue,onClick:He}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Ke,disabled:N.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(it,{size:16})}),e.jsxs("button",{onClick:()=>d("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(Et,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:Ue.map(t=>e.jsx(Ct,{title:tt(t),badge:h.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:Z}:void 0,tags:t.tags,compact:h.compact,onClick:()=>ce(t),focusColor:t.focusColor,onFocusChange:s=>fe(t,s),isFocused:t.isFocused,onToggleFocus:()=>me(t),isCompleted:t.focusColor==="green",footer:e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.audioLinks&&t.audioLinks.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full w-fit uppercase tracking-wider border border-emerald-100",children:[e.jsx(Ae,{size:10})," ",t.audioLinks.length," Tracks"]})}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),ce(t)},className:"flex items-center gap-1.5 px-4 py-2 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-md shadow-indigo-200 active:scale-95",title:"Practice",children:[e.jsx(Ie,{size:12,fill:"currentColor"})," ",e.jsx("span",{children:"Practice"})]})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),he(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ot,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),oe(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(J,{size:14})})]}),children:h.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit mb-2",children:[e.jsx(at,{size:12})," ",t.note]})},t.id))})}),e.jsx(Wt,{isOpen:$e,onClose:()=>X(!1),onSave:_e,initialData:re}),L&&e.jsx(Kt,{isOpen:!!L,onClose:()=>_(null),item:L,onUpdate:Ve}),e.jsx(ve,{isOpen:!!ae,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:Ge,onClose:()=>oe(null),icon:e.jsx(J,{size:40,className:"text-red-500"})})]})};export{ds as ListeningCardPage,ds as default};
