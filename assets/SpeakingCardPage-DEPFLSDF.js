import{c as oe,r as a,h as Se,x as ke,G as Ce,j as e,F as le,q as ie,e as Ie,al as _,X as H,aD as Te,Y as Ae,a6 as Ee,a5 as Y,a0 as te,bo as ze,aG as ce,ak as de,P as Me,bp as R,b as Re,bq as Oe,Z as Fe,br as Pe,bs as Ue,bb as Je,b9 as Le,E as $e,y as Ge,a as We,ao as Be,L as se,am as qe,bc as Ve,be as _e}from"./index-Gt8en8nb.js";import{R as He,a as Ye,V as Ke}from"./ResourceActions-C2FUQ3Kz.js";import{T as ae,F as Qe}from"./TagBrowser-BKDot2N6.js";import{U as Xe}from"./UniversalCard-B4PHYGpU.js";import{T as Ze}from"./target-CDeXYkpk.js";import{S as De}from"./square-check-big-CuUXJce7.js";import{C as et}from"./chevron-left-CHoHolDa.js";import{S as tt}from"./school-DIAmz0pt.js";import"./search-zoyTxZGY.js";import"./circle-BWUoDYmY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=oe("AudioLines",[["path",{d:"M2 10v3",key:"1fnikh"}],["path",{d:"M6 6v11",key:"11sgs0"}],["path",{d:"M10 3v18",key:"yhl04a"}],["path",{d:"M14 8v7",key:"3a1oy3"}],["path",{d:"M18 5v13",key:"123xd1"}],["path",{d:"M22 10v3",key:"154ddg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=oe("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);function nt(n,p){return`You are an expert English linguist and communication coach.
    
    TASK: Analyze a user's input to identify a core concept and example phrases. You MUST refine the provided phrases and generate additional ones to create a structured set of native-like expressions.

    RAW USER INPUT:
    "${n}"

    USER REFINEMENT REQUEST: "${p||"Generate a variety of expressions."}"

    INSTRUCTIONS:
    1.  **Analyze and Split Input (CRITICAL FIRST STEP)**:
        -   Read the "RAW USER INPUT". It may contain both a core concept and several example phrases, often separated by colons or newlines.
        -   **Identify the Core Concept**: Extract the main idea or topic (e.g., "Disagree", "Expressing excitement"). This will be the value for the "standard" field in your output JSON.
        -   **Extract Example Phrases**: Identify any full example sentences or phrases from the input. These are your primary material.

    2.  **Refine and Augment**:
        -   **MUST REFINE**: Take each "Example Phrase" you extracted. Improve its wording, identify its core 'anchor', and assign it to the most appropriate tone ('casual', 'semi-academic', or 'academic'). These refined phrases will form the base of your "answers" list.
        -   **MUST AUGMENT**: After refining the user's examples, check if you have at least one answer for EACH of the three tones. If any tone is missing, generate a NEW, high-quality expression for that tone.
        -   The final "answers" list must contain a mix of refined user examples and newly generated expressions, with at least one for each tone.

    3.  **Identify Anchor**: For EACH answer in your final list, identify the single most important keyword or short phrase. This is the 'anchor'.
    4.  **Create Sentence**: Write a full, natural example sentence for each expression.
    5.  **Keyword Highlighting**: In the 'sentence' field, you MUST highlight the core lexical chunk using curly braces \`{}\`. Example: "I'm {skeptical about} that."
    6.  **Add Optional Note**: If useful, add a brief 'note'. Use angle brackets \`<...>\` for grammar tips (e.g., preposition variations) inside the sentence. Example: "I'm {skeptical} about that <'skeptical' can be followed by 'about' or 'of'>".
    7.  **Format Final JSON**: The "standard" field must contain ONLY the core concept you identified. The "answers" list must contain the final, combined set of refined and augmented expressions.

    EXAMPLE WALKTHROUGH:
    -   RAW USER INPUT: "Disagree: Iâ€™m not convinced that would work\\nI'm strongly against..."
    -   Step 1 Result:
        -   Core Concept identified: "Expressing disagreement". This becomes the 'standard' value.
        -   Extracted examples: "I'm not convinced that would work", "I'm strongly against...".
    -   Step 2-7: You will now **refine** these two examples, assign them to tones, then **augment** by creating new expressions for any missing tones, and finally format them all into the final JSON.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (The extracted core concept, e.g., 'Expressing disagreement')",
      "answers": [
        {
          "tone": "casual",
          "anchor": "string (e.g., 'not buying it')",
          "sentence": "string (e.g., 'Honestly, I'm {not buying it}.')",
          "note": "string (e.g., 'A very informal way to show disbelief.')"
        },
        {
          "tone": "semi-academic",
          "anchor": "string (e.g., 'skeptical')",
          "sentence": "string (e.g., 'I'm a bit {skeptical of} that claim.')"
        },
        {
          "tone": "academic",
          "anchor": "string (e.g., 'reservations')",
          "sentence": "string (e.g., 'I {have some reservations about} the validity of this data.')",
          "note": "string (e.g., 'Use 'reservations' in formal contexts to express doubt politely.')"
        }
      ]
    }
    `}function rt(n){return`You are an expert English linguist and communication coach.
    
    TASK: Merge the following speaking cards into a single, cohesive card.

    CARDS TO MERGE:
    ${JSON.stringify(n.map(s=>({standard:s.standard,answers:s.answers,note:s.note,tags:s.tags})),null,2)}

    INSTRUCTIONS:
    1.  **Synthesize Context**: Analyze the "standard" contexts from all cards and create a new, overarching "standard" context that covers all of them. For example, if you see "Expressing doubt" and "Showing skepticism", the new context could be "Expressing doubt and skepticism".
    2.  **Combine & De-duplicate Expressions**:
        -   Collect all unique expressions ('answers') from all cards.
        -   If two expressions are very similar, keep only the best one.
        -   Organize the final list of expressions logically by tone (casual, semi-academic, academic).
    3.  **Create a New Card**: Format the result as a single JSON object that follows the same structure as the input cards. The goal is to produce one high-quality card that replaces all the input cards.

    STRICT JSON OUTPUT FORMAT:
    {
      "standard": "string (The new, synthesized core concept)",
      "answers": [
        {
          "tone": "casual",
          "anchor": "string (The core phrase)",
          "sentence": "string (Example sentence with {highlight})",
          "note": "string (Optional usage note)"
        }
      ]
    }
    `}const ne="vocab_pro_speaking_card_view",re=({text:n})=>{const p=n.split(/({.*?}|\[.*?\]|<.*?>)/g);if(p.length===3&&p[0]===""&&p[2]===""&&p[1].startsWith("[")&&p[1].endsWith("]")){const s=p[1].slice(1,-1);return e.jsxs("div",{className:"flex items-start gap-3 my-2 p-3 bg-sky-50 border-l-4 border-sky-400 rounded-r-lg shadow-sm",children:[e.jsx(se,{size:18,className:"shrink-0 mt-0.5 text-sky-500"}),e.jsx("div",{className:"text-xs text-sky-900 font-medium leading-relaxed",children:s})]})}return e.jsx(e.Fragment,{children:p.map((s,o)=>{if(s.startsWith("{")&&s.endsWith("}"))return e.jsx("span",{className:"mx-0.5 px-1 py-0.5 rounded bg-amber-100 text-amber-800 font-bold font-mono text-[0.9em] border border-amber-200 inline-block shadow-sm",children:s.slice(1,-1)},o);if(s.startsWith("[")&&s.endsWith("]")){const f=s.slice(1,-1);return e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-sky-700 bg-sky-100 border border-sky-200 px-2 py-1 rounded-full font-medium",children:[e.jsx(se,{size:12}),f]},o)}if(s.startsWith("<")&&s.endsWith(">")){const f=s.slice(1,-1);return e.jsxs("span",{className:"mx-1 inline-flex items-center gap-1.5 text-[10px] text-slate-600 bg-slate-100 border border-slate-200 px-2 py-1 rounded-full font-medium italic",children:[e.jsx(qe,{size:12}),f]},o)}return e.jsx("span",{children:s},o)})})},ot=({isOpen:n,onClose:p,onSave:s,initialData:o,onOpenAiRefine:f})=>{const[b,m]=a.useState(""),[j,w]=a.useState(""),[y,g]=a.useState(""),[x,h]=a.useState([]);a.useEffect(()=>{var r;n&&(m((o==null?void 0:o.standard)||""),g((o==null?void 0:o.note)||""),w(((r=o==null?void 0:o.tags)==null?void 0:r.join(", "))||""),h((o==null?void 0:o.answers)||[]))},[n,o]);const I=r=>{if(r.preventDefault(),!b.trim())return;const i=j.split(",").map(d=>d.trim()).filter(Boolean);s({standard:b.trim(),tags:i,note:y.trim(),answers:x})},N=()=>{f({standard:b,tags:j.split(",").map(r=>r.trim()).filter(Boolean),note:y,answers:x})},z=()=>{h(r=>[...r,{tone:"casual",anchor:"",sentence:"",note:""}])},v=(r,i,d)=>{h(C=>{const T=[...C];return T[r]={...T[r],[i]:d},T})},k=r=>{h(i=>i.filter((d,C)=>C!==r))},l=r=>{const i=r.target.value;if(!i.trim()){h([]);return}try{const d=JSON.parse(i);d.standard&&Array.isArray(d.answers)?(m(d.standard),h(d.answers)):Array.isArray(d.answers)&&h(d.answers)}catch{console.warn("Invalid JSON pasted")}};return n?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:I,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:o?"Edit Expression":"New Expression"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Define context and generate expressions."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:N,className:"p-2 bg-amber-50 text-amber-600 rounded-xl hover:bg-amber-100 transition-colors",title:"Generate/Refine with AI",children:e.jsx(Re,{size:18})}),e.jsx("button",{type:"button",onClick:p,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(H,{size:20})})]})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Context / Standard Meaning"}),e.jsx("textarea",{value:b,onChange:r=>m(r.target.value),placeholder:"e.g., Expressing skepticism or doubt",rows:3,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium focus:ring-2 focus:ring-neutral-900 outline-none resize-none",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(Oe,{size:12})," User Note (Optional)"]}),e.jsx("textarea",{rows:2,value:y,onChange:r=>g(r.target.value),placeholder:"Usage tips, nuance explanation...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none resize-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1",children:[e.jsx(le,{size:12})," Tags (Optional)"]}),e.jsx("input",{value:j,onChange:r=>w(r.target.value),placeholder:"Business, Casual, Speaking Part 3...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-300 outline-none"})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500 flex items-center gap-1.5",children:[e.jsx(st,{size:12})," Expressions (",x.length,")"]}),e.jsxs("button",{type:"button",onClick:z,className:"px-3 py-1.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-1.5 hover:bg-neutral-200 transition-colors",children:[e.jsx(ie,{size:14})," Add"]})]}),e.jsxs("div",{className:"space-y-3 max-h-[250px] overflow-y-auto -mr-3 pr-3 stable-scrollbar",children:[x.length===0&&e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-xl",children:[e.jsx("p",{className:"text-sm font-bold text-neutral-400",children:"No expressions yet."}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:'Click "Add" or paste JSON below.'})]}),x.map((r,i)=>e.jsxs("div",{className:"p-3 bg-white border border-neutral-200 rounded-xl space-y-2 relative group animate-in fade-in",children:[e.jsx("button",{type:"button",onClick:()=>k(i),className:"absolute top-2 right-2 p-1 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(Y,{size:12})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:r.tone,onChange:d=>v(i,"tone",d.target.value),className:"px-2 py-1 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-bold text-neutral-600 focus:ring-1 focus:ring-neutral-900 outline-none",children:[e.jsx("option",{value:"casual",children:"Casual"}),e.jsx("option",{value:"semi-academic",children:"Semi-Academic"}),e.jsx("option",{value:"academic",children:"Academic"})]}),e.jsx("input",{type:"text",placeholder:"Anchor",value:r.anchor,onChange:d=>v(i,"anchor",d.target.value),className:"flex-1 px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-bold text-neutral-800 focus:ring-1 focus:ring-neutral-900 outline-none"})]}),e.jsx("textarea",{rows:2,placeholder:"Sentence (use {curly braces} to highlight)",value:r.sentence,onChange:d=>v(i,"sentence",d.target.value),className:"w-full px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-xs font-medium text-neutral-800 focus:ring-1 focus:ring-neutral-900 outline-none resize-none"}),e.jsx("input",{type:"text",placeholder:"Note (optional)",value:r.note||"",onChange:d=>v(i,"note",d.target.value),className:"w-full px-3 py-1.5 bg-neutral-100 border border-neutral-200 rounded-md text-[10px] font-medium text-neutral-500 focus:ring-1 focus:ring-neutral-900 outline-none"})]},i))]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Quick-add from JSON"}),e.jsx("textarea",{placeholder:"Paste JSON from AI here to populate expressions...",rows:2,onFocus:r=>r.target.select(),onChange:l,className:"w-full p-3 bg-neutral-50 border border-neutral-200 rounded-xl font-mono text-xs focus:ring-1 focus:ring-neutral-900 outline-none resize-none"})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Fe,{size:14})," Save"]})})]})}):null},lt=({item:n,viewSettings:p,isSelected:s,onSelect:o,onEdit:f,onDelete:b,onFocusChange:m,onToggleFocus:j,onPractice:w})=>{var g;const y=((g=n.answers)==null?void 0:g.length)||0;return e.jsxs(Xe,{title:n.standard,path:n.path,tags:p.showTags?n.tags:void 0,compact:p.compact,onClick:()=>y>0&&w(n),focusColor:n.focusColor,onFocusChange:x=>m(n,x),isFocused:n.isFocused,onToggleFocus:()=>j(n),className:s?"ring-2 ring-indigo-500 border-indigo-500":"",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),f(n)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),b(n)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",children:e.jsx(Y,{size:14})})]}),children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsx("button",{onClick:x=>{x.stopPropagation(),o(n.id)},className:`p-1 rounded-md transition-all duration-200 ${s?"bg-indigo-600 text-white":"bg-white/30 backdrop-blur-sm text-neutral-400 opacity-0 group-hover:opacity-100"}`,"aria-label":s?`Deselect ${n.standard}`:`Select ${n.standard}`,children:s?e.jsx(De,{size:18}):e.jsx(ce,{size:18})})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-500",children:y>0?`${y} expressions available`:"No expressions yet. Refine with AI!"}),e.jsxs("button",{onClick:x=>{x.stopPropagation(),w(n)},className:"flex items-center gap-2 px-4 py-2 bg-rose-500 text-white rounded-xl font-black text-xs uppercase tracking-wider hover:bg-rose-600 transition-all shadow-lg shadow-rose-200 active:scale-95 disabled:opacity-50",disabled:y===0,children:[e.jsx(de,{size:14})," Speak"]})]})]},n.id)},it=({isOpen:n,onClose:p,item:s})=>{const[o,f]=a.useState(0),[b,m]=a.useState(!1),[j,w]=a.useState(!1),[y,g]=a.useState(""),x=a.useRef(new Je);if(a.useEffect(()=>{n&&(f(0),m(!1),g(""),w(!1))},[n]),!n||!s||!s.answers||s.answers.length===0)return null;const h=s.answers[o],I=o===0,N=o===s.answers.length-1,z=async()=>{if(j)x.current.stop(),await Ve(),w(!1);else{g("");try{await _e(),w(!0),x.current.start((l,r)=>g(l+r),l=>{g(l),w(!1)})}catch(l){console.error(l),w(!1)}}},k=(l=>{switch(l){case"casual":return{icon:at,colorClass:"bg-sky-100 text-sky-700 border-sky-200",label:"Casual"};case"semi-academic":return{icon:tt,colorClass:"bg-indigo-100 text-indigo-700 border-indigo-200",label:"Semi-Academic"};case"academic":return{icon:Be,colorClass:"bg-purple-100 text-purple-700 border-purple-200",label:"Academic"};default:return{icon:_,colorClass:"bg-neutral-100 text-neutral-600 border-neutral-200",label:"Expression"}}})(h.tone);return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsx("header",{className:"px-6 py-4 flex justify-end items-center shrink-0",children:e.jsx("button",{type:"button",onClick:p,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(H,{size:20})})}),e.jsxs("main",{className:"p-6 pt-0 flex-1 flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-neutral-800 tracking-tight",children:s.standard}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-black uppercase tracking-wider border ${k.colorClass}`,children:[e.jsx(k.icon,{size:12})," ",k.label]}),e.jsx("div",{className:"w-full min-h-[150px] p-6 bg-neutral-50 rounded-2xl border border-neutral-200 flex flex-col items-center justify-center",children:b?e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"text-xl font-medium leading-relaxed text-neutral-900",children:e.jsx(re,{text:h.sentence})}),h.note&&e.jsx("div",{className:"p-3 bg-sky-50 rounded-xl border border-sky-200 text-xs font-medium text-sky-800 leading-relaxed",children:e.jsx(re,{text:h.note})})]}):e.jsx("h2",{className:"text-4xl font-black text-neutral-900 animate-in fade-in duration-300",children:h.anchor})}),e.jsxs("button",{onClick:()=>m(l=>!l),className:"flex items-center gap-2 px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[b?e.jsx(Le,{size:14}):e.jsx($e,{size:14}),e.jsx("span",{children:b?"Hide Answer":"Show Answer"})]}),y&&e.jsxs("p",{className:"text-sm font-medium italic text-neutral-500 mt-4",children:['"',y,'"']})]}),e.jsxs("footer",{className:"px-6 py-6 border-t border-neutral-100 flex items-center justify-between shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:[e.jsx("button",{onClick:()=>{m(!1),f(l=>l-1)},disabled:I,className:"p-4 rounded-full bg-white border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30",children:e.jsx(et,{size:20})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>Ge(h.sentence),className:"p-5 rounded-full bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-100 hover:text-indigo-600 transition-colors shadow-sm",children:e.jsx(de,{size:24})}),e.jsx("button",{onClick:z,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-lg transition-all ${j?"bg-red-500 text-white animate-pulse":"bg-rose-500 text-white hover:bg-rose-600"}`,children:j?e.jsx(ce,{size:28,fill:"currentColor"}):e.jsx(_,{size:28})})]}),e.jsx("button",{onClick:()=>{m(!1),f(l=>l+1)},disabled:N,className:"p-4 rounded-full bg-white border border-neutral-200 text-neutral-400 hover:text-neutral-900 disabled:opacity-30",children:e.jsx(We,{size:20})})]})]})})},wt=({user:n,onNavigate:p})=>{const[s,o]=a.useState([]),[f,b]=a.useState(!0),[m,j]=a.useState(!1),[w,y]=a.useState(!1),[g,x]=a.useState(()=>Se(ne,{showTags:!0,compact:!1})),[h,I]=a.useState(0),[N,z]=a.useState(12),[v,k]=a.useState("all"),[l,r]=a.useState("all");a.useEffect(()=>{ke(ne,g)},[g]);const[i,d]=a.useState(null),[C,T]=a.useState(!1),[U,K]=a.useState(!1),[ue,O]=a.useState(!1),[J,L]=a.useState(null),[$,G]=a.useState(null),[Q,W]=a.useState(!1),[B,xe]=a.useState(null),[X,q]=a.useState(!1),{showToast:A}=Ce(),[Z,D]=a.useState(null),[S,V]=a.useState(new Set),F=async()=>{b(!0);const t=await ze(n.id);o(t.sort((c,u)=>u.createdAt-c.createdAt)),b(!1)};a.useEffect(()=>{F()},[n.id]),a.useEffect(()=>{I(0)},[i,N,v,l]);const M=a.useMemo(()=>s.filter(t=>{var c,u;if(v==="focused"&&!t.isFocused||l!=="all"&&t.focusColor!==l)return!1;if(i){if(i==="Uncategorized"){if(t.path&&t.path!=="/")return!1}else if(!((c=t.path)!=null&&c.startsWith(i))&&!((u=t.tags)!=null&&u.includes(i)))return!1}return!0}),[s,i,v,l]),pe=a.useMemo(()=>{const t=h*N;return M.slice(t,t+N)},[M,h,N]),he=()=>{o(t=>[...t].sort(()=>Math.random()-.5)),A("Shuffled!","success")},ge=()=>{L(null),O(!0)},me=t=>{L(t),O(!0)},fe=async()=>{$&&(await Pe($.id),G(null),F())},be=async t=>{const c=Date.now();if(J)await R({...J,...t,updatedAt:c});else{const u={id:`ns-${c}-${Math.random()}`,userId:n.id,createdAt:c,updatedAt:c,...t};await R(u)}O(!1),F(),A("Saved successfully!","success")},we=async(t,c)=>{const u={...t,focusColor:c||void 0,updatedAt:Date.now()};c||delete u.focusColor,o(E=>E.map(P=>P.id===t.id?u:P)),await R(u)},ye=async t=>{const c={...t,isFocused:!t.isFocused,updatedAt:Date.now()};o(u=>u.map(E=>E.id===t.id?c:E)),await R(c)},je=t=>{V(c=>{const u=new Set(c);return u.has(t)?u.delete(t):u.add(t),u})},ee=a.useMemo(()=>s.filter(t=>S.has(t.id)),[s,S]),ve=async t=>{if(!t||!t.standard||!Array.isArray(t.answers)){A("Invalid JSON format from AI for merging.","error");return}q(!1),j(!0);try{const c=Date.now(),u=new Set;ee.forEach(P=>{(P.tags||[]).forEach(Ne=>u.add(Ne))}),u.add("merged");const E={id:`ns-${c}-${Math.random()}`,userId:n.id,standard:t.standard,answers:t.answers,tags:Array.from(u),createdAt:c,updatedAt:c};await R(E),await Ue(Array.from(S)),A(`Successfully merged ${S.size} cards!`,"success"),V(new Set),await F()}catch{A("Failed to merge cards.","error")}finally{j(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"Speaking Library",subtitle:"Master natural phrases and expressions for any context.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Microphone.png",className:"w-8 h-8 object-contain",alt:"Speaking"}),config:{},isLoading:f||m,isEmpty:M.length===0,emptyMessage:"No expressions found.",activeFilters:{},onFilterChange:()=>{},pagination:{page:h,totalPages:Math.ceil(M.length/N),onPageChange:I,pageSize:N,onPageSizeChange:z,totalItems:M.length},minorSkills:p?e.jsxs("button",{onClick:()=>p("MIMIC"),className:"flex items-center gap-2 px-3 py-2 bg-neutral-100 text-neutral-600 rounded-lg text-xs font-bold hover:bg-neutral-200 transition-colors",children:[e.jsx(_,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Pronunciation"})]}):void 0,actions:e.jsx(Ye,{viewMenu:e.jsx(Ke,{isOpen:w,setIsOpen:y,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Ze,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>k(v==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${v==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:v==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>r(l==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>r(l==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>r(l==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${l==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Tags",checked:g.showTags,onChange:()=>x(t=>({...t,showTags:!t.showTags}))},{label:"Compact",checked:g.compact,onChange:()=>x(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:U,onToggle:()=>{K(!U),T(!1)}},browseTags:{isOpen:C,onToggle:()=>{T(!C),K(!1)}},addActions:[{label:"Add",icon:ie,onClick:ge}],extraActions:e.jsx("button",{onClick:he,disabled:s.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Ie,{size:16})})}),aboveGrid:e.jsxs(e.Fragment,{children:[U&&e.jsx(ae,{items:s,selectedTag:i,onSelectTag:d,forcedView:"groups",title:"Browse Groups",icon:e.jsx(Qe,{size:16})}),C&&e.jsx(ae,{items:s,selectedTag:i,onSelectTag:d,forcedView:"tags",title:"Browse Tags",icon:e.jsx(le,{size:16})})]}),children:()=>e.jsx(e.Fragment,{children:pe.map(t=>e.jsx(lt,{item:t,viewSettings:g,isSelected:S.has(t.id),onSelect:je,onEdit:me,onDelete:G,onFocusChange:we,onToggleFocus:ye,onPractice:D},t.id))})}),S.size>0&&e.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-[150] w-full max-w-md px-4 animate-in slide-in-from-bottom-8",children:e.jsxs("div",{className:"bg-neutral-900 text-white rounded-2xl p-3 shadow-2xl flex items-center justify-between border border-neutral-800 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-2",children:[e.jsx("button",{onClick:()=>V(new Set),className:"p-1 text-neutral-500 hover:text-white",children:e.jsx(H,{size:16})}),e.jsxs("span",{className:"text-sm font-bold",children:[S.size," selected"]})]}),e.jsxs("button",{onClick:()=>q(!0),disabled:S.size<2||m,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-black text-xs flex items-center gap-2 uppercase tracking-wider hover:bg-indigo-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Te,{size:14})," Merge"]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-white/50 backdrop-blur-sm z-[250] flex items-center justify-center",children:e.jsx(Ae,{size:32,className:"animate-spin text-neutral-900"})}),e.jsx(ot,{isOpen:ue,onClose:()=>O(!1),onSave:be,initialData:J,onOpenAiRefine:t=>{xe(t),W(!0)}}),e.jsx(Ee,{isOpen:!!$,title:"Delete Card?",message:"Delete this expression?",confirmText:"Delete",isProcessing:!1,onConfirm:fe,onClose:()=>G(null),icon:e.jsx(Y,{size:40,className:"text-red-500"})}),Q&&e.jsx(te,{isOpen:Q,onClose:()=>W(!1),type:"REFINE_UNIT",title:"Refine Expression",description:"Enter instructions for the AI to generate expressions.",initialData:{},onGeneratePrompt:t=>nt((B==null?void 0:B.standard)||"",t.request),onJsonReceived:t=>{t.answers&&(L(c=>({...c||{id:"",userId:n.id,createdAt:0,updatedAt:0,standard:"",answers:[],tags:[],note:""},standard:t.standard,answers:t.answers})),W(!1),A("Refined! Expressions generated.","success"))},actionLabel:"Apply"}),X&&e.jsx(te,{isOpen:X,onClose:()=>q(!1),type:"REFINE_UNIT",title:"Merge Expressions",description:"AI will combine the selected cards into a single, cohesive one.",initialData:{},onGeneratePrompt:()=>rt(ee),onJsonReceived:ve,actionLabel:"Apply Merge"}),e.jsx(it,{isOpen:!!Z,onClose:()=>D(null),item:Z})]})};export{wt as SpeakingCardPage};
