import{c as ee,r as n,G as rt,a5 as at,D as it,j as e,A as ct,ao as X,a3 as he,aq as xe,aI as dt,P as ut,a6 as Ie,l as ht,ar as xt,a7 as pt,bD as ft,bE as mt,bF as Z,bG as gt,bH as K,X as pe,ah as bt,bI as ye,bJ as jt,bK as vt,t as wt}from"./index-DGJ8pI6b.js";import{R as kt,a as Nt}from"./ResourceActions-CUMjs2k8.js";import{u as yt,G as St,S as Se,V as Ct}from"./ShelfSearchBar-5kFy2Azw.js";import{U as It}from"./UniversalCard-dj22GCRq.js";import{T as Tt}from"./TagBrowser-IeSMbUYn.js";import{F as At,U as Ft,a as Lt,M as Bt,A as Pt,R as Mt}from"./ShelfModals-xbEYUUtN.js";import{M as zt,F as Te}from"./FileSelector-Bd0nHpcf.js";import{E as D}from"./ear-a139_nm1.js";import{M as Ot}from"./move-ByKgjUXo.js";import{P as Et}from"./pen-C3mmQx_z.js";import{L as $t}from"./library-BM03FBlq.js";import{F as Rt}from"./file-text-fChqOZiM.js";import{P as Ut}from"./pause-CiqHvaFj.js";import"./chevron-left-J6RKxoGo.js";import"./folder-n66ThGOn.js";import"./palette-Lmjn_xUZ.js";import"./square-check-big-DTHqJH21.js";import"./server-BFeTvLIR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ee("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=ee("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=ee("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=ee("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Ce="vocab_pro_listening_view",Vt=({text:c})=>{const k=c.split(/({.*?})/g);return e.jsx("span",{className:"leading-relaxed",children:k.map((m,r)=>m.startsWith("{")&&m.endsWith("}")?e.jsx("span",{className:"inline-block bg-red-100 text-red-700 px-1.5 py-0.5 rounded-md font-bold mx-0.5 border border-red-200 text-[0.9em] align-baseline",children:m.slice(1,-1)},r):e.jsx("span",{children:m},r))})},Kt=({rawText:c,onUpdate:k,readOnly:m=!1})=>{const r=n.useRef(null),[o,b]=n.useState(null),S=n.useMemo(()=>{const l=[],p=/({.*?})/g;let x,i=0;for(;(x=p.exec(c))!==null;)x.index>i&&l.push({text:c.slice(i,x.index),isHighlight:!1,start:i,end:x.index}),l.push({text:x[0],isHighlight:!0,start:x.index,end:p.lastIndex}),i=p.lastIndex;return i<c.length&&l.push({text:c.slice(i),isHighlight:!1,start:i,end:c.length}),l},[c]),I=()=>{if(m)return;const l=window.getSelection(),p=i=>{if(!i)return null;let u=i.nodeType===3?i.parentElement:i;for(;u&&u!==r.current&&!u.hasAttribute("data-index");)u=u.parentElement;return u&&u.hasAttribute("data-index")?parseInt(u.getAttribute("data-index"),10):null};if(!l||!l.anchorNode||!l.focusNode){b(null);return}const x=p(l.anchorNode);if(x!==null){const i=S[x];if(i.isHighlight){b({type:"remove",start:i.start,end:i.end});return}}if(!l.isCollapsed){const i=p(l.focusNode);if(x!==null&&x===i){const u=S[x];if(!u.isHighlight){const F=l.anchorNode;if(F&&F.nodeType===3){const N=Math.min(l.anchorOffset,l.focusOffset),U=Math.max(l.anchorOffset,l.focusOffset),C=u.start+N,H=u.start+U;if(l.toString()){b({type:"add",start:C,end:H});return}}}}}b(null)},g=()=>{var l;if(o){if(o.type==="remove"){const p=c.slice(0,o.start),x=c.slice(o.start+1,o.end-1),i=c.slice(o.end);k(p+x+i)}else{const p=c.slice(0,o.start),x=c.slice(o.start,o.end),i=c.slice(o.end);k(`${p}{${x}}${i}`)}b(null),(l=window.getSelection())==null||l.removeAllRanges()}};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible",children:e.jsxs("button",{onClick:l=>{l.preventDefault(),g()},disabled:!o,className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 ${o?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"} ${(o==null?void 0:o.type)==="remove"?"bg-white text-rose-600 shadow-rose-100":"bg-neutral-900 text-white shadow-neutral-200"}`,children:[(o==null?void 0:o.type)==="remove"?e.jsx(vt,{size:14}):e.jsx(Ht,{size:14}),e.jsx("span",{children:(o==null?void 0:o.type)==="remove"?"Unhighlight":"Highlight"})]})}),e.jsx("div",{ref:r,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap px-6 pb-20 pt-6 select-text cursor-text font-mono",onMouseUp:I,onKeyUp:I,children:S.map((l,p)=>e.jsx("span",{"data-index":p,className:l.isHighlight?"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200 cursor-pointer hover:bg-red-200 hover:border-red-300 transition-colors":"",children:l.isHighlight?l.text.slice(1,-1):l.text},`${p}-${l.start}`))})]})},Wt=({isOpen:c,onClose:k,item:m,onUpdate:r})=>{const o=m.audioLinks||[],[b,S]=n.useState(0),[I,g]=n.useState(!1),[l,p]=n.useState(0),[x,i]=n.useState(0),[u,F]=n.useState(m.text),[N,U]=n.useState(!1),C=n.useRef(null);n.useEffect(()=>()=>{L()},[]),n.useEffect(()=>{c?(F(m.text),E(0,!1)):(L(),S(0))},[c,m]);const H=d=>{F(d),r({...m,text:d})},L=()=>{C.current&&(C.current.pause(),C.current=null),ye(),g(!1),i(0),p(0)},E=(d,v)=>{if(L(),S(d),o.length>0&&o[d]){const P=o[d],B=new Audio(P);C.current=B,B.addEventListener("loadedmetadata",()=>{p(B.duration)}),B.addEventListener("timeupdate",()=>{i(B.currentTime)}),B.addEventListener("ended",()=>{g(!1),d<o.length-1?E(d+1,!0):i(0)}),B.addEventListener("error",()=>{g(!1)}),v&&(B.play().catch(console.error),g(!0))}},T=()=>{if(o.length>0)C.current?I?(C.current.pause(),g(!1)):(C.current.play().catch(console.error),g(!0)):E(b,!0);else if(I)ye(),g(!1);else{const d=m.text.replace(/[{}]/g,"");wt(d),g(!0);const v=d.length/10*1e3;setTimeout(()=>g(!1),v)}},W=d=>{const v=Number(d.target.value);i(v),C.current&&(C.current.currentTime=v)},y=()=>{b>0&&E(b-1,!0)},G=()=>{b<o.length-1&&E(b+1,!0)},_=()=>{L(),k()};if(!c)return null;const f=o.length>0?decodeURIComponent(o[b].split("/").pop()||`Track ${b+1}`):"System Voice (TTS)",j=d=>{const v=Math.floor(d/60),P=Math.floor(d%60);return`${v}:${P.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-7xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center bg-white z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(D,{size:20})," Listening Practice"]}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1 max-w-[250px] truncate",children:m.title||m.note||"Practice Session"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-neutral-100 p-1 rounded-xl flex items-center",children:[e.jsx("button",{onClick:()=>U(!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${N?"text-neutral-500":"bg-white shadow-sm text-neutral-900"}`,children:"Read"}),e.jsx("button",{onClick:()=>U(!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${N?"bg-white shadow-sm text-neutral-900":"text-neutral-500"}`,children:"Edit Raw"})]}),e.jsx("button",{onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(pe,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden relative bg-neutral-50/50",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar relative",children:N?e.jsx("textarea",{value:u,onChange:d=>H(d.target.value),className:"w-full h-full p-6 bg-white border border-neutral-200 rounded-2xl resize-none outline-none text-lg font-medium leading-relaxed font-mono text-neutral-700 shadow-sm",placeholder:"Paste transcript here..."}):e.jsx("div",{className:"h-full flex flex-col bg-white border border-neutral-200 rounded-2xl shadow-sm p-8 overflow-y-auto",children:e.jsx(Kt,{rawText:u,onUpdate:H})})})}),e.jsxs("div",{className:"px-6 py-3 bg-white border-t border-neutral-100 shrink-0 flex items-center gap-4",children:[e.jsxs("div",{className:"w-48 shrink-0",children:[e.jsx("h4",{className:"text-xs font-bold text-neutral-900 truncate",children:f}),o.length>1&&e.jsxs("p",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:["Track ",b+1,"/",o.length]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("button",{onClick:y,disabled:b===0,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Gt,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:T,className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center shadow-md hover:scale-105 active:scale-95 transition-all",children:I?e.jsx(Ut,{size:16,fill:"currentColor"}):e.jsx(Ie,{size:16,fill:"currentColor",className:"ml-0.5"})}),e.jsx("button",{onClick:G,disabled:b===o.length-1,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(_t,{size:18,fill:"currentColor"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 ml-2",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:j(x)}),e.jsxs("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full relative group cursor-pointer",children:[o.length>0&&e.jsx("input",{type:"range",min:"0",max:l||100,value:x,onChange:W,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-neutral-900 rounded-full transition-all",style:{width:`${l?x/l*100:0}%`}})]}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:j(l)})]})]})]})]})})},qt=({isOpen:c,onClose:k,onSave:m,initialData:r})=>{const[o,b]=n.useState(""),[S,I]=n.useState(""),[g,l]=n.useState(""),[p,x]=n.useState("/"),[i,u]=n.useState(""),[F,N]=n.useState([]),[U,C]=n.useState(!1),[H,L]=n.useState(null),[E,T]=n.useState(!1);n.useEffect(()=>{var f;if(c)if(b((r==null?void 0:r.title)||""),I((r==null?void 0:r.text)||""),l((r==null?void 0:r.note)||""),N((r==null?void 0:r.audioLinks)||[]),(r==null?void 0:r.path)===void 0){const j=(r==null?void 0:r.tags)||[],d=j.find(P=>P.startsWith("/")),v=j.filter(P=>!P.startsWith("/"));x(d||"/"),u(v.join(", "))}else x((r==null?void 0:r.path)||"/"),u(((f=r==null?void 0:r.tags)==null?void 0:f.join(", "))||"")},[c,r]);const W=f=>{if(f.preventDefault(),S.trim()){const j=i.split(",").map(d=>d.trim()).filter(Boolean);m(o.trim(),S.trim(),g.trim(),p.trim(),j,F)}},y=f=>{const{url:j,transcript:d}=f;N(v=>[...v,j]),d&&(S.trim()?(L(d),T(!0)):I(d))},G=()=>{H&&I(H),L(null),T(!1)},_=f=>{N(j=>j.filter((d,v)=>v!==f))};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:W,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:r?"Edit Listening Card":"New Listening Card"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text script and attach audio."})]}),e.jsx("button",{type:"button",onClick:k,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(pe,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title"}),e.jsx("input",{value:o,onChange:f=>b(f.target.value),placeholder:"e.g. Unit 1 Podcast",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Script / Transcript"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:S,onChange:f=>I(f.target.value),placeholder:"Paste full transcript here...",rows:6,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0})}),e.jsx("p",{className:"text-[10px] text-neutral-400 italic",children:"You can highlight key phrases in Practice mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Attached Audio"}),e.jsxs("button",{type:"button",onClick:()=>C(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(he,{size:12})," From Server"]})]}),e.jsxs("div",{className:"space-y-2",children:[F.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2",children:"No audio files attached."}),F.map((f,j)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-50 rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(Ae,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(f.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>_(j),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(pe,{size:14})})]},j))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:g,onChange:f=>l(f.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags"}),e.jsx("input",{value:i,onChange:f=>u(f.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(bt,{size:14})," Save Item"]})})]})}),e.jsx(Te,{isOpen:U,onClose:()=>C(!1),onSelect:y,type:"audio",title:"Select Audio"}),e.jsx(xe,{isOpen:E,title:"Replace Script?",message:"This audio file comes with a linked transcript. Do you want to replace your current text content with it?",confirmText:"Replace",isProcessing:!1,onConfirm:G,onClose:()=>T(!1),icon:e.jsx(Rt,{size:40,className:"text-indigo-500"}),confirmButtonClass:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200"})]}):null},xs=({user:c})=>{var Ne;const[k,m]=n.useState([]),[r,o]=n.useState([]),[b,S]=n.useState(!0),[I,g]=n.useState("LIST"),[l,p]=n.useState(null),[x,i]=n.useState(!1),[u,F]=n.useState(()=>rt(Ce,{showNote:!0,compact:!1,showType:!0})),[N,U]=n.useState(null),[C,H]=n.useState(!1),[L,E]=n.useState(!1),[T,W]=n.useState("all"),[y,G]=n.useState("all"),[_,f]=n.useState(0),[j,d]=n.useState(12),[v,P]=n.useState(null),{currentShelfName:B,booksOnCurrentShelf:te,allShelves:q,addShelf:Fe,renameShelf:Le,removeShelf:Be,nextShelf:Pe,prevShelf:Me,selectShelf:ze}=yt(r,"listening_books_shelves"),[Oe,se]=n.useState(!1),[Ee,ne]=n.useState(!1),[$,le]=n.useState(null);n.useEffect(()=>{at(Ce,u)},[u]);const[$e,Q]=n.useState(!1),[oe,fe]=n.useState(null),[re,ae]=n.useState(null),[V,ie]=n.useState(null),[Re,me]=n.useState(!1),{showToast:M}=it(),z=async()=>{S(!0);const[t,s]=await Promise.all([ft(c.id),mt(c.id)]);m(t.sort((a,h)=>h.createdAt-a.createdAt)),o(s.sort((a,h)=>h.createdAt-a.createdAt)),S(!1)};n.useEffect(()=>{z()},[c.id]),n.useEffect(()=>{f(0)},[N,j,T,y]);const Ue=n.useMemo(()=>T!=="all"||y!=="all",[T,y]),J=n.useMemo(()=>{let t=k;return T==="focused"&&(t=t.filter(s=>s.isFocused)),y!=="all"&&(t=t.filter(s=>s.focusColor===y)),N&&(N==="Uncategorized"?t=t.filter(s=>{const a=s.path??(s.tags||[]).find(w=>w.startsWith("/"));return!(a&&a!=="/"&&a!=="")}):t=t.filter(s=>{var a,h;return((a=s.path)==null?void 0:a.startsWith(N))||((h=s.tags)==null?void 0:h.includes(N))})),t},[k,N,T,y]),He=n.useMemo(()=>{const t=_*j;return J.slice(t,t+j)},[J,_,j]),Ge=()=>{fe(null),Q(!0)},ge=t=>{fe(t),Q(!0)},_e=async()=>{re&&(await jt(re.id),ae(null),M("Deleted item.","success"),z())},Ve=async(t,s,a,h,w,O)=>{try{const A=Date.now();if(oe){const R={...oe,title:t,text:s,note:a,path:h,tags:w,audioLinks:O,updatedAt:A};await K(R),M("Item updated!","success")}else{const R={id:`lst-${A}-${Math.random()}`,userId:c.id,title:t,text:s,note:a,path:h,tags:w,audioLinks:O,createdAt:A,updatedAt:A};await K(R),M("Item added!","success")}Q(!1),z()}catch{M("Failed to save item.","error")}},Ke=async t=>{const{url:s,filename:a,transcript:h,transcriptTitle:w,map:O,path:A}=t;if(!h){M("No transcript found for selected file.","error");return}const R=O||"Unknown",Y=A?`/${A}`:"",lt=w?`${R}${Y} - ${w}`:a,ue=Date.now(),ot={id:`lst-scripted-${ue}-${Math.random()}`,userId:c.id,title:lt,text:h,note:`Imported from ${R}${Y}`,path:Y||"/",tags:["scripted-audio"],audioLinks:[s],createdAt:ue,updatedAt:ue};try{await K(ot),M("Scripted Audio Card Created!","success"),z()}catch{M("Failed to create card.","error")}},We=async t=>{await K(t),P(t),z()},ce=t=>{P(t)},qe=()=>{m(t=>[...t].sort(()=>Math.random()-.5)),M("Shuffled!","success")},be=async(t,s)=>{const a={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete a.focusColor,m(h=>h.map(w=>w.id===t.id?a:w)),await K(a)},je=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};m(a=>a.map(h=>h.id===t.id?s:h)),await K(s)},Je=t=>{Le(t,async(a,h)=>{S(!0);const w=r.filter(O=>{const A=O.title.split(":");return(A.length>1?A[0].trim():"General")===a});await Promise.all(w.map(O=>{const A=O.title.split(":"),R=A.length>1?A.slice(1).join(":").trim():O.title,Y=`${h}: ${R}`;return Z({...O,title:Y,updatedAt:Date.now()})})),await z()})&&ne(!1)},ve=async()=>{const t={id:`lb-${Date.now()}`,userId:c.id,title:`${B}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#ff9800",icon:"ðŸŽ§"};await Z(t),await z(),p(t),g("BOOK_DETAIL"),M("New book created.","success")},de=async t=>{if(!l)return;const s={...l,...t,updatedAt:Date.now()};o(a=>a.map(h=>h.id===s.id?s:h)),p(s),await Z(s)},Ye=async()=>{V&&(await gt(V.id),M("Book deleted.","success"),ie(null),await z())},Xe=async t=>{if(!$)return;const s=$.title.split(":"),a=s.length>1?s.slice(1).join(":").trim():s[0],h=`${t}: ${a}`,w={...$,title:h,updatedAt:Date.now()};await Z(w),le(null),await z(),M(`Moved to "${t}".`,"success")},Qe=n.useMemo(()=>l?l.itemIds.map(t=>{const s=k.find(a=>a.id===t);return s?{id:s.id,title:s.title||s.text,subtitle:s.note||"Listening Practice",data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[l,k]),Ze=n.useMemo(()=>k.map(t=>({id:t.id,title:t.title||t.text,subtitle:`${t.text.length} characters`,data:t})),[k]),De=t=>{if(!l)return;const s=Array.from(new Set([...l.itemIds,...t]));de({itemIds:s})},et=t=>{if(!l)return;const s=l.itemIds.filter(a=>a!==t);de({itemIds:s})},tt=(t,s)=>{const a=t.data;be(a,s)},st=t=>{const s=t.data;je(s)},we=t=>{ze(t),g("SHELF")},ke=t=>{p(t),g("BOOK_DETAIL")},nt=t=>{if(t.title)return e.jsx("div",{className:"font-black text-lg text-neutral-900 leading-tight",children:t.title});const s=t.text.split(/\s+/),a=s.length>15?s.slice(0,15).join(" ")+"...":t.text;return e.jsx("div",{className:"font-medium text-lg text-neutral-700 leading-tight",children:e.jsx(Vt,{text:a})})};return I==="BOOK_DETAIL"&&l?e.jsx(St,{book:l,items:Qe,availableItems:Ze,onBack:()=>{p(null),g("SHELF"),z()},onUpdateBook:de,onAddItem:De,onRemoveItem:et,onOpenItem:t=>ce(t.data),onEditItem:t=>ge(t.data),onFocusChange:tt,onToggleFocus:st,itemIcon:e.jsx(D,{size:16})}):I==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>g("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(ct,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Listening Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your listening practice."})]}),e.jsx(Se,{shelves:q,books:r,onNavigateShelf:we,onNavigateBook:ke}),e.jsxs("button",{onClick:()=>se(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(At,{size:14})," Add Shelf"]})]})]}),e.jsxs(Ft,{label:B,onNext:q.length>1?Pe:void 0,onPrev:q.length>1?Me:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ne(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Et,{size:14})}),e.jsx("button",{onClick:Be,disabled:te.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(X,{size:14})})]}),isEmpty:te.length===0,emptyAction:e.jsx("button",{onClick:ve,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[te.map(t=>{const s=t.title,a=s.split(":"),h=a.length>1?a.slice(1).join(":").trim():s;return e.jsx(Lt,{id:t.id,title:h,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(D,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{p(t),g("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),le(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Ot,{size:16})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),ie(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(X,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:ve,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(he,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(xe,{isOpen:!!V,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Ne=V==null?void 0:V.title.split(":").pop())==null?void 0:Ne.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Ye,onClose:()=>ie(null),icon:e.jsx(X,{size:40,className:"text-red-500"})}),e.jsx(Bt,{isOpen:!!$,onClose:()=>le(null),onConfirm:Xe,shelves:q,currentShelf:$?$.title.split(":")[0].trim():"General",bookTitle:($==null?void 0:$.title)||""}),e.jsx(Pt,{isOpen:Oe,onClose:()=>se(!1),onSave:t=>{Fe(t)&&se(!1)}}),e.jsx(Mt,{isOpen:Ee,onClose:()=>ne(!1),onSave:Je,initialName:B})]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),centerContent:e.jsx(Se,{shelves:q,books:r,onNavigateShelf:we,onNavigateBook:ke}),config:{},isLoading:b,isEmpty:J.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:_,totalPages:Math.ceil(J.length/j),onPageChange:f,pageSize:j,onPageSizeChange:d,totalItems:J.length},aboveGrid:e.jsx(e.Fragment,{children:L&&e.jsx(Tt,{items:k,selectedTag:N,onSelectTag:U,forcedView:"tags",title:"Browse Tags",icon:e.jsx(pt,{size:16})})}),actions:e.jsx(Nt,{viewMenu:e.jsx(Ct,{isOpen:x,setIsOpen:i,hasActiveFilters:Ue,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(xt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>W(T==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${T==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:T==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>G(y==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${y==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>G(y==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${y==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>G(y==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${y==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:u.showNote,onChange:()=>F(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:u.showType,onChange:()=>F(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:u.compact,onChange:()=>F(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:L,onToggle:()=>{E(!L)}},addActions:[{label:"Add Scripted Audio",icon:Ae,onClick:()=>me(!0)},{label:"Add Phrase",icon:he,onClick:Ge}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:qe,disabled:k.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(ht,{size:16})}),e.jsxs("button",{onClick:()=>g("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx($t,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:He.map(t=>e.jsx(It,{title:nt(t),badge:u.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:D}:void 0,tags:t.tags,compact:u.compact,onClick:()=>ce(t),focusColor:t.focusColor,onFocusChange:s=>be(t,s),isFocused:t.isFocused,onToggleFocus:()=>je(t),isCompleted:t.focusColor==="green",footer:e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.audioLinks&&t.audioLinks.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full w-fit uppercase tracking-wider border border-emerald-100",children:[e.jsx(zt,{size:10})," ",t.audioLinks.length," Tracks"]})}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),ce(t)},className:"flex items-center gap-1.5 px-4 py-2 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-md shadow-indigo-200 active:scale-95",title:"Practice",children:[e.jsx(Ie,{size:12,fill:"currentColor"})," ",e.jsx("span",{children:"Practice"})]})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),ge(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(ut,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),ae(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{size:14})})]}),children:u.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit mb-2",children:[e.jsx(dt,{size:12})," ",t.note]})},t.id))})}),e.jsx(qt,{isOpen:$e,onClose:()=>Q(!1),onSave:Ve,initialData:oe}),v&&e.jsx(Wt,{isOpen:!!v,onClose:()=>P(null),item:v,onUpdate:We}),e.jsx(Te,{isOpen:Re,onClose:()=>me(!1),onSelect:Ke,type:"audio",title:"Select Audio"}),e.jsx(xe,{isOpen:!!re,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:_e,onClose:()=>ae(null),icon:e.jsx(X,{size:40,className:"text-red-500"})})]})};export{xs as ListeningCardPage,xs as default};
