import{c as B,r as l,a0 as K,u as Q,j as e,P as V,aA as P,S as _,ag as O,aC as H,ax as X,bL as Y,X as Z,au as ee,bM as E,bN as te,Q as se}from"./index-DtfRLDN6.js";import{R as ae,a as ne}from"./ResourceActions-BCqxjjaS.js";import{U as re,C as oe}from"./UniversalCard-CmT4W1nb.js";import{F as le}from"./FileSelector-Cvxfdtt_.js";import{L as D,D as ie}from"./list-todo-29DeyqCt.js";import{G as ce}from"./grip-vertical-B3IOdw1h.js";import"./chevron-left-CW2OtC6F.js";import"./tag-Bz-2JhPt.js";import"./server-Dwt4K8zP.js";import"./music-8xfenBAJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=B("CircleDashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]);function ue(r){return`You are an expert study planner and productivity coach.

TASK:
Create a structured learning goal based on the user's request. The goal should be broken down into specific, actionable tasks (todos).

USER REQUEST: "${r}"

INSTRUCTIONS:
1.  **Analyze the Request**: Identify the main subject (e.g., "Collins Reading for IELTS", "Learn 50 phrasal verbs", "Writing Task 1 practice").
2.  **Create a Title**: A concise, motivating title for the goal.
3.  **Create a Description**: A brief overview of what this goal achieves.
4.  **Generate Todos**: Break the goal down into logical steps or units.
    -   If the request refers to a specific book or course (e.g., "18 lessons of Collins Reading"), generate exactly that number of tasks, matching the unit titles if possible or using logical generic titles.
    -   If the request is general (e.g., "Learn vocabulary"), create a logical progression (e.g., "Day 1: Family", "Day 2: Work").
    -   Each task should be clear and actionable.

STRICT JSON OUTPUT FORMAT:
Return in code block format a single JSON object. Do not include any text outside the JSON block.

{
  "title": "string (Goal Title)",
  "description": "string (Goal Description)",
  "todos": [
    {
      "text": "string (Task description, e.g., 'Unit 1: Family & Relationships - Complete exercises')"
    },
    {
      "text": "string (Task description, e.g., 'Unit 2: Health & Fitness - Review vocabulary')"
    }
  ]
}`}const A={NEW:{icon:oe,color:"text-neutral-300",bg:"bg-neutral-100",label:"New"},IN_PROGRESS:{icon:de,color:"text-blue-500",bg:"bg-blue-50",label:"In Progress"},CLOSED:{icon:se,color:"text-green-500",bg:"bg-green-50",label:"Closed"}},pe=({todo:r,readOnly:j,onStatusChange:x,onTextChange:n,onDelete:h})=>{const[f,y]=l.useState(!1),w=A[r.status],c=w.icon;return j?e.jsxs("div",{className:`flex items-start gap-2.5 py-1.5 ${r.status==="CLOSED"?"opacity-50":""}`,children:[e.jsx(c,{size:14,className:`mt-0.5 shrink-0 ${w.color}`}),e.jsx("span",{className:`text-xs font-medium leading-snug ${r.status==="CLOSED"?"line-through text-neutral-400":"text-neutral-700"}`,children:r.text})]}):e.jsxs("div",{className:"group flex items-start gap-2 p-2 bg-white border border-neutral-200 rounded-xl hover:border-neutral-300 transition-all focus-within:ring-2 focus-within:ring-neutral-900/5 focus-within:border-neutral-400",children:[e.jsxs("div",{className:"relative shrink-0 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>y(!f),className:`p-1 rounded-md hover:bg-neutral-100 transition-colors ${w.color}`,title:"Change Status",children:e.jsx(c,{size:18})}),f&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white rounded-xl shadow-xl border border-neutral-100 z-50 p-1 flex flex-col gap-1 animate-in fade-in zoom-in-95",children:Object.keys(A).map(i=>{const d=A[i],b=d.icon;return e.jsxs("button",{type:"button",onClick:()=>{x==null||x(i),y(!1)},className:`flex items-center gap-2 px-2 py-2 rounded-lg text-xs font-bold transition-colors w-full text-left ${r.status===i?"bg-neutral-100":"hover:bg-neutral-50"}`,children:[e.jsx(b,{size:14,className:d.color}),e.jsx("span",{className:"text-neutral-600",children:d.label})]},i)})})]}),e.jsx("input",{type:"text",value:r.text,onChange:i=>n==null?void 0:n(i.target.value),className:`flex-1 bg-transparent border-none outline-none text-sm font-medium py-1 ${r.status==="CLOSED"?"text-neutral-400 line-through":"text-neutral-900"}`,placeholder:"Task description..."}),e.jsx("button",{type:"button",onClick:h,className:"p-1.5 text-neutral-300 hover:text-red-500 hover:bg-red-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all self-start mt-0.5",title:"Remove Task",children:e.jsx(P,{size:14})})]})},xe=({isOpen:r,onClose:j,onSave:x,initialData:n})=>{const[h,f]=l.useState(""),[y,w]=l.useState(""),[c,i]=l.useState([]),[d,b]=l.useState("");l.useEffect(()=>{r&&(f((n==null?void 0:n.title)||""),w((n==null?void 0:n.description)||""),i((n==null?void 0:n.todos)||[]),b(""))},[r,n]);const S=()=>{if(!d.trim())return;const a={id:`todo-${Date.now()}-${Math.random()}`,text:d.trim(),status:"NEW"};i([...c,a]),b("")},N=(a,v)=>{i(k=>k.map(p=>p.id===a?{...p,...v}:p))},G=a=>{i(v=>v.filter(k=>k.id!==a))},I=()=>{h.trim()&&x({title:h,description:y,todos:c})};return r?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:n?"Edit Goal":"New Goal"}),e.jsx("button",{onClick:j,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Z,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-6 flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Goal Title"}),e.jsx("input",{value:h,onChange:a=>f(a.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none",placeholder:"e.g. Master Phrasal Verbs",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider px-1",children:"Description (Optional)"}),e.jsx("textarea",{value:y,onChange:a=>w(a.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm focus:ring-1 focus:ring-neutral-900 outline-none resize-none",placeholder:"Add context..."})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-end px-1",children:[e.jsxs("label",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(D,{size:14})," Task List"]}),e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 bg-neutral-100 px-2 py-0.5 rounded-full",children:c.length})]}),e.jsx("div",{className:"space-y-2",children:c.map(a=>e.jsx(pe,{todo:a,readOnly:!1,onStatusChange:v=>N(a.id,{status:v}),onTextChange:v=>N(a.id,{text:v}),onDelete:()=>G(a.id)},a.id))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{value:d,onChange:a=>b(a.target.value),onKeyDown:a=>a.key==="Enter"&&S(),className:"flex-1 px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none transition-all focus:bg-white",placeholder:"Add a new task..."}),e.jsx("button",{onClick:S,disabled:!d.trim(),className:"px-4 bg-neutral-900 text-white rounded-xl hover:bg-red-800 disabled:opacity-50 transition-colors shadow-sm",children:e.jsx(O,{size:20})})]})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:e.jsxs("button",{onClick:I,disabled:!h.trim(),className:"px-8 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50 hover:scale-105 transition-transform",children:[e.jsx(ee,{size:14})," ",e.jsx("span",{children:"Save Changes"})]})})]})}):null},ke=({user:r,initialAction:j,onActionConsumed:x})=>{const[n,h]=l.useState([]),[f,y]=l.useState(!0),[w,c]=l.useState(!1),[i,d]=l.useState(null),[b,S]=l.useState(null),[N,G]=l.useState(null),[I,a]=l.useState(!1),[v,k]=l.useState(!1),{showToast:p}=K(),T=l.useCallback(async()=>{y(!0);const t=await Q(r.id);h(t.sort((s,o)=>s.order!==void 0&&o.order!==void 0?s.order-o.order:s.order!==void 0?-1:o.order!==void 0?1:o.createdAt-s.createdAt)),y(!1)},[r.id]);l.useEffect(()=>{T()},[T]),l.useEffect(()=>{!f&&j&&(j==="AI"?a(!0):j==="IMPORT"&&k(!0),x==null||x())},[f,j,x]);const R=async t=>{const s=Date.now();if(i){const o={...i,...t,updatedAt:s};await E(o),p("Goal updated.","success")}else{const o={id:`goal-${s}-${Math.random()}`,userId:r.id,title:t.title,description:t.description||"",todos:t.todos||[],createdAt:s,updatedAt:s,order:n.length};await E(o),p("Goal created.","success")}c(!1),T()},$=async()=>{b&&(await te(b.id),p("Goal deleted.","success"),S(null),T())},z=async t=>{if(t.title&&Array.isArray(t.todos)){const s=Date.now(),o={id:`goal-ai-${s}-${Math.random()}`,userId:r.id,title:t.title,description:t.description||"",todos:t.todos.map(m=>({id:`todo-${s}-${Math.random()}`,text:m.text,status:"NEW"})),createdAt:s,updatedAt:s,order:0};await E(o),p("Goal generated by AI!","success"),a(!1),T()}else p("Invalid AI response.","error")},L=async t=>{const s=Date.now(),o=(t.todos||[]).map(g=>({id:`todo-imp-${s}-${Math.random()}`,text:g.text||g,status:"NEW"})),m={id:`goal-imp-${s}-${Math.random()}`,userId:r.id,title:t.title||"Imported Goal",description:t.description||"Imported from server.",todos:o,createdAt:s,updatedAt:s,order:0};try{await E(m),p(`Imported "${m.title}" successfully!`,"success"),await T()}catch{p("Failed to save imported goal.","error")}},F=t=>ue(t.request),U=(t,s)=>{G(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s)},q=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},W=async(t,s)=>{if(t.preventDefault(),!N||N===s)return;const o=n.findIndex(C=>C.id===N),m=n.findIndex(C=>C.id===s);if(o===-1||m===-1)return;const g=[...n],[M]=g.splice(o,1);g.splice(m,0,M);const u=g.map((C,J)=>({...C,order:J}));h(u),G(null),await Y(u)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Planning Board",subtitle:"Track your learning goals and tasks.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Spiral%20Calendar.png",className:"w-8 h-8 object-contain",alt:"Planning"}),config:{},isLoading:f,isEmpty:n.length===0,emptyMessage:"No goals set. Start planning!",activeFilters:{},onFilterChange:()=>{},actions:e.jsx(ne,{addActions:[{label:"New (AI)",icon:_,onClick:()=>a(!0)},{label:"New (Manual)",icon:O,onClick:()=>{d(null),c(!0)}},{label:"Add from Server",icon:ie,onClick:()=>k(!0)}]}),children:()=>e.jsx(e.Fragment,{children:n.map(t=>{const s=t.todos.length,o=t.todos.filter(u=>u.status==="CLOSED").length,m=s>0?Math.round(o/s*100):0,g=s>0&&o===s,M=N===t.id;return e.jsx("div",{draggable:!0,onDragStart:u=>U(u,t.id),onDragOver:q,onDrop:u=>W(u,t.id),className:`transition-all duration-200 h-full ${M?"opacity-40 scale-95":"opacity-100 hover:scale-[1.01]"}`,children:e.jsx(re,{title:e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-snug mb-0.5 select-none",children:t.title}),compact:!0,onClick:()=>{d(t),c(!0)},isCompleted:g,className:"h-full",actions:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1.5 text-neutral-300 cursor-grab active:cursor-grabbing hover:text-neutral-50 rounded-lg transition-colors mr-1",children:e.jsx(ce,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),d(t),c(!0)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(V,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),S(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(P,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-3 select-none",children:[t.description&&e.jsx("p",{className:"text-[10px] text-neutral-400 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-neutral-500 bg-neutral-50 px-2 py-1.5 rounded-lg w-fit self-start",children:[e.jsx(D,{size:12}),e.jsxs("span",{children:[s," Tasks"]}),o>0&&e.jsxs("span",{className:"text-green-600",children:["(",o," done)"]})]}),e.jsxs("div",{className:"space-y-1 pt-1",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[m,"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${g?"bg-green-500":"bg-indigo-500"}`,style:{width:`${m}%`}})})]})]})})},t.id)})})}),e.jsx(xe,{isOpen:w,onClose:()=>c(!1),onSave:R,initialData:i,user:r}),e.jsx(H,{isOpen:!!b,title:"Delete Goal?",message:"This will remove the goal and all its tasks.",confirmText:"Delete",isProcessing:!1,onConfirm:$,onClose:()=>S(null),icon:e.jsx(P,{size:40,className:"text-red-500"})}),I&&e.jsx(X,{isOpen:I,onClose:()=>a(!1),type:"GENERATE_PLAN",title:"AI Goal Planner",description:"Describe your goal (e.g. 'Complete Collins Reading book') and let AI generate the task list.",initialData:{request:""},onGeneratePrompt:F,onJsonReceived:z,actionLabel:"Create Plan",closeOnSuccess:!0}),e.jsx(le,{isOpen:v,onClose:()=>k(!1),onSelect:L,type:"planning",title:"Import Goal from Server"})]})};export{ke as PlanningPage};
