import{c as G,r as n,a1 as Ne,ai as ke,a0 as Se,j as e,aL as Ce,P as Te,ay as D,ag as se,b9 as Ie,T as Ae,az as ne,t as Fe,bv as q,X as Y,at as Pe,bw as ee,aj as ze,bx as Le,V as $e,by as Me,I as re}from"./index-C2HBAOCD.js";import{R as Ee,a as Oe}from"./ResourceActions-CR4Q5qCJ.js";import{V as Re}from"./ViewMenu-DZ8CwC5_.js";import{U as Ue}from"./UniversalCard-GglReKDR.js";import{T as Ve}from"./TagBrowser-DYcJEyYz.js";import{M as We,a as le,F as Be}from"./FileSelector-f3QiPvXb.js";import{E as ae}from"./ear-kC4CkrXD.js";import{F as oe}from"./file-audio-BQ00j0n8.js";import{T as qe}from"./tag-D8Hdmp_1.js";import{P as He}from"./pause-DoFp-xQS.js";import"./chevron-left-C7dR-E_S.js";import"./filter-BCq5qGMP.js";import"./folder-BGwNn9ou.js";import"./server-CoAtMImr.js";import"./list-todo-D3QAyxB2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=G("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=G("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=G("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=G("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),te="vocab_pro_listening_view",X=({text:d,showDash:A=!0})=>{const j=d.split(/({.*?}|\[.*?\])/g);return e.jsx("span",{className:"leading-relaxed",children:j.map((r,C)=>r.startsWith("{")&&r.endsWith("}")?e.jsx("span",{className:"text-red-600 font-bold mx-0.5",children:r.slice(1,-1)},C):r.startsWith("[")&&r.endsWith("]")?e.jsx("span",{className:`${A?"border-b-2 border-dashed border-indigo-400":""} text-indigo-900 font-medium mx-0.5 pb-0.5 transition-colors hover:bg-indigo-50/50`,children:e.jsx(X,{text:r.slice(1,-1),showDash:A})},C):e.jsx("span",{children:r},C))})},Ke=({rawText:d,onUpdate:A,readOnly:j=!1,showDash:r=!0})=>{const C=n.useRef(null),[w,u]=n.useState(null),o=n.useMemo(()=>{const s=[],i=/({.*?}|\[.*?\])/g;let a,f=0;for(;(a=i.exec(d))!==null;){a.index>f&&s.push({text:d.slice(f,a.index),type:"text",start:f,end:a.index});let m="text";a[0].startsWith("{")?m="highlight":a[0].startsWith("[")&&(m="audio"),s.push({text:a[0],type:m,start:a.index,end:i.lastIndex}),f=i.lastIndex}return f<d.length&&s.push({text:d.slice(f),type:"text",start:f,end:d.length}),s},[d]),F=()=>{if(j)return;const s=window.getSelection(),i=h=>{if(!h)return null;let l=h.nodeType===3?h.parentElement:h;for(;l&&l!==C.current&&!l.hasAttribute("data-index");)l=l.parentElement;return l&&l.hasAttribute("data-index")?parseInt(l.getAttribute("data-index"),10):null};if(!s||!s.anchorNode||!s.focusNode||s.isCollapsed){if(s&&s.isCollapsed&&s.anchorNode){const h=i(s.anchorNode);if(h!==null){const l=o[h];if(l.type!=="text"){u({start:l.start,end:l.end,currentType:l.type});return}}}u(null);return}const a=i(s.anchorNode),f=i(s.focusNode);if(a===null||f===null){u(null);return}const m=(h,l,E)=>{const y=o[E],$=y.type!=="text"?1:0;return y.start+l+$};let S=m(s.anchorNode,s.anchorOffset,a),c=m(s.focusNode,s.focusOffset,f);if(S>c&&([S,c]=[c,S]),a===f&&o[a].type!=="text"){const h=o[a];u({start:h.start,end:h.end,currentType:h.type});return}u(S!==c?{start:S,end:c,currentType:"text"}:null)},T=s=>{var m;if(!w)return;const{start:i,end:a,currentType:f}=w;if(s==="clear"){const S=d.slice(0,i),c=d.slice(i+1,a-1),h=d.slice(a);A(S+c+h)}else{const S=d.slice(0,i),c=d.slice(i,a),h=d.slice(a),l=s==="highlight"?["{","}"]:["[","]"];A(`${S}${l[0]}${c}${l[1]}${h}`)}u(null),(m=window.getSelection())==null||m.removeAllRanges()},I=(s,i)=>{s.stopPropagation();const f=i.slice(1,-1).replace(/[{}]/g,"");re(f)};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-4 z-50 h-0 flex justify-center pointer-events-none overflow-visible gap-2",children:[(w==null?void 0:w.currentType)==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s=>{s.preventDefault(),T("highlight")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-neutral-900 text-white shadow-neutral-200 hover:scale-105 active:scale-95",children:[e.jsx(_e,{size:14}),e.jsx("span",{children:"Highlight"})]}),e.jsxs("button",{onClick:s=>{s.preventDefault(),T("audio")},className:"pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-indigo-600 text-white shadow-indigo-200 hover:scale-105 active:scale-95",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"Mark Audio"})]})]}),(w==null?void 0:w.currentType)!=="text"&&e.jsxs("button",{onClick:s=>{s.preventDefault(),T("clear")},className:`pointer-events-auto flex items-center gap-1.5 px-4 py-2.5 rounded-full text-xs font-black shadow-xl transition-all transform duration-200 border-2 border-white ring-1 ring-black/5 bg-white text-rose-600 shadow-rose-100 hover:bg-rose-50 ${w?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95 pointer-events-none"}`,children:[e.jsx(Me,{size:14}),e.jsx("span",{children:(w==null?void 0:w.currentType)==="highlight"?"Unhighlight":"Unmark Audio"})]})]}),e.jsx("div",{ref:C,className:"text-lg font-medium text-neutral-800 leading-relaxed whitespace-pre-wrap px-6 pb-20 pt-6 select-text cursor-text font-mono",onMouseUp:F,onKeyUp:F,children:o.map((s,i)=>s.type==="highlight"?e.jsx("span",{"data-index":i,className:"text-red-600 font-bold cursor-pointer hover:bg-red-50 transition-colors rounded mx-0.5",children:s.text.slice(1,-1)},`${i}-${s.start}`):s.type==="audio"?e.jsx("span",{"data-index":i,onClick:a=>I(a,s.text),className:`${r?"border-b-2 border-dashed border-indigo-400":""} text-indigo-900 cursor-pointer hover:bg-indigo-50 transition-colors mx-0.5`,title:"Click to listen",children:e.jsx(X,{text:s.text.slice(1,-1),showDash:r})},`${i}-${s.start}`):e.jsx("span",{"data-index":i,children:s.text},`${i}-${s.start}`))})]})},Ye=({isOpen:d,onClose:A,item:j,onUpdate:r,showDash:C,onToggleDash:w})=>{const u=j.audioLinks||[],[o,F]=n.useState(0),[T,I]=n.useState(!1),[s,i]=n.useState(0),[a,f]=n.useState(0),[m,S]=n.useState(j.text),[c,h]=n.useState(!1),l=n.useRef(null);n.useEffect(()=>()=>{y()},[]),n.useEffect(()=>{d?(S(j.text),$(0,!1)):(y(),F(0))},[d,j]);const E=p=>{S(p),r({...j,text:p})},y=()=>{l.current&&(l.current.pause(),l.current=null),ee(),I(!1),f(0),i(0)},$=(p,M)=>{if(y(),F(p),u.length>0&&u[p]){const V=u[p],N=new Audio(V);l.current=N,N.addEventListener("loadedmetadata",()=>{i(N.duration)}),N.addEventListener("timeupdate",()=>{f(N.currentTime)}),N.addEventListener("ended",()=>{I(!1),p<u.length-1?$(p+1,!0):f(0)}),N.addEventListener("error",()=>{I(!1)}),M&&(N.play().catch(console.error),I(!0))}},R=()=>{if(u.length>0)l.current?T?(l.current.pause(),I(!1)):(l.current.play().catch(console.error),I(!0)):$(o,!0);else if(T)ee(),I(!1);else{const p=j.text.replace(/[{}]/g,"").replace(/\[|\]/g,"");re(p),I(!0);const M=p.length/10*1e3;setTimeout(()=>I(!1),M)}},U=p=>{const M=Number(p.target.value);f(M),l.current&&(l.current.currentTime=M)},H=()=>{o>0&&$(o-1,!0)},g=()=>{o<u.length-1&&$(o+1,!0)},v=()=>{y(),A()};if(!d)return null;const P=u.length>0?decodeURIComponent(u[o].split("/").pop()||`Track ${o+1}`):"System Voice (TTS)",z=p=>{const M=Math.floor(p/60),V=Math.floor(p%60);return`${M}:${V.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-7xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col h-[90vh] overflow-hidden",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center bg-white z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(ae,{size:20})," Listening Practice"]}),e.jsx("p",{className:"text-xs text-neutral-500 font-bold mt-1 max-w-[250px] truncate",children:j.title||j.note||"Practice Session"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-neutral-100 p-1 rounded-xl flex items-center",children:[e.jsx("button",{onClick:w,className:`p-2 rounded-lg transition-all ${C?"bg-white shadow-sm text-indigo-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Toggle Audio Marks",children:e.jsx(Qe,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:()=>h(!1),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${c?"text-neutral-500":"bg-white shadow-sm text-neutral-900"}`,children:"Read"}),e.jsx("button",{onClick:()=>h(!0),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all ${c?"bg-white shadow-sm text-neutral-900":"text-neutral-500"}`,children:"Edit Raw"})]}),e.jsx("button",{onClick:v,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Y,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden relative bg-neutral-50/50",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar relative",children:c?e.jsx("textarea",{value:m,onChange:p=>E(p.target.value),className:"w-full h-full p-6 bg-white border border-neutral-200 rounded-2xl resize-none outline-none text-lg font-medium leading-relaxed font-mono text-neutral-700 shadow-sm",placeholder:"Paste transcript here..."}):e.jsx("div",{className:"h-full flex flex-col bg-white border border-neutral-200 rounded-2xl shadow-sm p-8 overflow-y-auto",children:e.jsx(Ke,{rawText:m,onUpdate:E,showDash:C})})})}),e.jsxs("div",{className:"px-6 py-3 bg-white border-t border-neutral-100 shrink-0 flex items-center gap-4",children:[e.jsxs("div",{className:"w-48 shrink-0",children:[e.jsx("h4",{className:"text-xs font-bold text-neutral-900 truncate",children:P}),u.length>1&&e.jsxs("p",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest",children:["Track ",o+1,"/",u.length]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("button",{onClick:H,disabled:o===0,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Ge,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:R,className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center shadow-md hover:scale-105 active:scale-95 transition-all",children:T?e.jsx(He,{size:16,fill:"currentColor"}):e.jsx(ze,{size:16,fill:"currentColor",className:"ml-0.5"})}),e.jsx("button",{onClick:g,disabled:o===u.length-1,className:"p-2 text-neutral-400 hover:text-neutral-900 disabled:opacity-30 transition-colors",children:e.jsx(Je,{size:18,fill:"currentColor"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 ml-2",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-right",children:z(a)}),e.jsxs("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full relative group cursor-pointer",children:[u.length>0&&e.jsx("input",{type:"range",min:"0",max:s||100,value:a,onChange:U,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-neutral-900 rounded-full transition-all",style:{width:`${s?a/s*100:0}%`}})]}),e.jsx("span",{className:"text-[10px] font-mono font-bold text-neutral-400 w-8 text-left",children:z(s)})]})]})]})]})})},Xe=({isOpen:d,onClose:A,onSave:j,initialData:r})=>{const[C,w]=n.useState(""),[u,o]=n.useState(""),[F,T]=n.useState(""),[I,s]=n.useState("/"),[i,a]=n.useState(""),[f,m]=n.useState([]),[S,c]=n.useState(!1),[h,l]=n.useState(null),[E,y]=n.useState(!1);n.useEffect(()=>{var g;if(d)if(w((r==null?void 0:r.title)||""),o((r==null?void 0:r.text)||""),T((r==null?void 0:r.note)||""),m((r==null?void 0:r.audioLinks)||[]),(r==null?void 0:r.path)===void 0){const v=(r==null?void 0:r.tags)||[],P=v.find(p=>p.startsWith("/")),z=v.filter(p=>!p.startsWith("/"));s(P||"/"),a(z.join(", "))}else s((r==null?void 0:r.path)||"/"),a(((g=r==null?void 0:r.tags)==null?void 0:g.join(", "))||"")},[d,r]);const $=g=>{if(g.preventDefault(),u.trim()){const v=i.split(",").map(P=>P.trim()).filter(Boolean);j(C.trim(),u.trim(),F.trim(),I.trim(),v,f)}},R=g=>{const{url:v,transcript:P}=g;m(z=>[...z,v]),P&&(u.trim()?(l(P),y(!0)):o(P))},U=()=>{h&&o(h),l(null),y(!1)},H=g=>{m(v=>v.filter((P,z)=>z!==g))};return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:$,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:r?"Edit Listening Card":"New Listening Card"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text script and attach audio."})]}),e.jsx("button",{type:"button",onClick:A,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Y,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Title"}),e.jsx("input",{value:C,onChange:g=>w(g.target.value),placeholder:"e.g. Unit 1 Podcast",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Script / Transcript"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:u,onChange:g=>o(g.target.value),placeholder:"Paste full transcript here...",rows:6,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0})}),e.jsx("p",{className:"text-[10px] text-neutral-400 italic",children:"You can highlight key phrases in Practice mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Attached Audio"}),e.jsxs("button",{type:"button",onClick:()=>c(!0),className:"flex items-center gap-1 text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:[e.jsx(se,{size:12})," From Server"]})]}),e.jsxs("div",{className:"space-y-2",children:[f.length===0&&e.jsx("p",{className:"text-[10px] text-neutral-400 italic px-2",children:"No audio files attached."}),f.map((g,v)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-50 rounded-lg border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(oe,{size:14,className:"text-emerald-500 shrink-0"}),e.jsx("span",{className:"text-xs font-mono text-neutral-600 truncate",children:decodeURIComponent(g.split("/").pop()||"file")})]}),e.jsx("button",{type:"button",onClick:()=>H(v),className:"p-1 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(Y,{size:14})})]},v))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:F,onChange:g=>T(g.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags"}),e.jsx("input",{value:i,onChange:g=>a(g.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Pe,{size:14})," Save Item"]})})]})}),e.jsx(le,{isOpen:S,onClose:()=>c(!1),onSelect:R,type:"audio",title:"Select Audio"}),e.jsx(ne,{isOpen:E,title:"Replace Script?",message:"This audio file comes with a linked transcript. Do you want to replace your current text content with it?",confirmText:"Replace",isProcessing:!1,onConfirm:U,onClose:()=>y(!1),icon:e.jsx(Be,{size:40,className:"text-indigo-500"}),confirmButtonClass:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200"})]}):null},pt=({user:d})=>{const[A,j]=n.useState([]),[r,C]=n.useState(!0),[w,u]=n.useState(!1),[o,F]=n.useState(()=>Ne(te,{showNote:!0,compact:!1,showType:!0,showDash:!1})),[T,I]=n.useState(""),[s,i]=n.useState(null),[a,f]=n.useState(!1),[m,S]=n.useState("all"),[c,h]=n.useState("all"),[l,E]=n.useState(0),[y,$]=n.useState(12),[R,U]=n.useState(null);n.useEffect(()=>{ke(te,o)},[o]);const[H,g]=n.useState(!1),[v,P]=n.useState(null),[z,p]=n.useState(null),[M,V]=n.useState(!1),{showToast:N}=Se(),_=async()=>{C(!0);const t=await Fe(d.id);j(t.sort((b,x)=>x.createdAt-b.createdAt)),C(!1)};n.useEffect(()=>{_()},[d.id]),n.useEffect(()=>{E(0)},[s,y,m,c,T]);const ie=n.useMemo(()=>m!=="all"||c!=="all",[m,c]),Q=n.useMemo(()=>{let t=A;const b=T.toLowerCase().trim();return b&&(t=t.filter(x=>(x.title||"").toLowerCase().includes(b)||(x.text||"").toLowerCase().includes(b))),m==="focused"&&(t=t.filter(x=>x.isFocused)),c!=="all"&&(t=t.filter(x=>x.focusColor===c)),s&&(s==="Uncategorized"?t=t.filter(x=>{const k=x.path??(x.tags||[]).find(W=>W.startsWith("/"));return!(k&&k!=="/"&&k!=="")}):t=t.filter(x=>{var k,L;return((k=x.path)==null?void 0:k.startsWith(s))||((L=x.tags)==null?void 0:L.includes(s))})),t},[A,s,m,c,T]),ce=n.useMemo(()=>{const t=l*y;return Q.slice(t,t+y)},[Q,l,y]),de=()=>{P(null),g(!0)},ue=t=>{P(t),g(!0)},xe=async()=>{z&&(await Le(z.id),p(null),N("Deleted item.","success"),_())},he=async(t,b,x,k,L,W)=>{try{const O=Date.now();if(v){const B={...v,title:t,text:b,note:x,path:k,tags:L,audioLinks:W,updatedAt:O};await q(B),N("Item updated!","success")}else{const B={id:`lst-${O}-${Math.random()}`,userId:d.id,title:t,text:b,note:x,path:k,tags:L,audioLinks:W,createdAt:O,updatedAt:O};await q(B),N("Item added!","success")}g(!1),_()}catch{N("Failed to save item.","error")}},pe=async t=>{const{url:b,filename:x,transcript:k,transcriptTitle:L,map:W,path:O}=t;if(!k){N("No transcript found for selected file.","error");return}const B=W||"Unknown",J=O?`/${O}`:"",ye=L?`${B}${J} - ${L}`:x,K=Date.now(),ve={id:`lst-scripted-${K}-${Math.random()}`,userId:d.id,title:ye,text:k,note:`Imported from ${B}${J}`,path:J||"/",tags:["scripted-audio"],audioLinks:[b],createdAt:K,updatedAt:K};try{await q(ve),N("Scripted Audio Card Created!","success"),_()}catch{N("Failed to create card.","error")}},fe=async t=>{await q(t),U(t),_()},me=t=>{U(t)},ge=()=>{j(t=>[...t].sort(()=>Math.random()-.5)),N("Shuffled!","success")},be=async(t,b)=>{const x={...t,focusColor:b||void 0,updatedAt:Date.now()};b||delete x.focusColor,j(k=>k.map(L=>L.id===t.id?x:L)),await q(x)},je=async t=>{const b={...t,isFocused:!t.isFocused,updatedAt:Date.now()};j(x=>x.map(k=>k.id===t.id?b:k)),await q(b)},Z=()=>{F(t=>({...t,showDash:!t.showDash}))},we=t=>{if(t.title)return e.jsx("div",{className:"font-black text-lg text-neutral-900 leading-tight",children:t.title});const b=t.text.split(/\s+/),x=b.length>15?b.slice(0,15).join(" ")+"...":t.text;return e.jsx("div",{className:"font-medium text-lg text-neutral-700 leading-tight",children:e.jsx(X,{text:x,showDash:o.showDash})})};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),query:T,onQueryChange:I,searchPlaceholder:"Search title or text...",config:{},isLoading:r,isEmpty:Q.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:l,totalPages:Math.ceil(Q.length/y),onPageChange:E,pageSize:y,onPageSizeChange:$,totalItems:Q.length},aboveGrid:e.jsx(e.Fragment,{children:a&&e.jsx(Ve,{items:A,selectedTag:s,onSelectTag:i,forcedView:"tags",title:"Browse Tags",icon:e.jsx(qe,{size:16})})}),actions:e.jsx(Oe,{viewMenu:e.jsx(Re,{isOpen:w,setIsOpen:u,hasActiveFilters:ie,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Ae,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>S(m==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${m==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:m==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>h(c==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>h(c==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>h(c==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${c==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:o.showNote,onChange:()=>F(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:o.showType,onChange:()=>F(t=>({...t,showType:!t.showType}))},{label:"Show Dash Lines",checked:o.showDash,onChange:Z},{label:"Compact Mode",checked:o.compact,onChange:()=>F(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:a,onToggle:()=>{f(!a)}},addActions:[{label:"Add Scripted Audio",icon:oe,onClick:()=>V(!0)},{label:"Add Phrase",icon:se,onClick:de}],extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:ge,disabled:A.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Ie,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:ce.map(t=>e.jsx(Ue,{title:we(t),badge:o.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:ae}:void 0,tags:t.tags,compact:o.compact,onClick:()=>me(t),focusColor:t.focusColor,onFocusChange:b=>be(t,b),isFocused:t.isFocused,onToggleFocus:()=>je(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),ue(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Te,{size:14})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),p(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(D,{size:14})})]}),children:e.jsxs("div",{className:"flex flex-col gap-2 h-full justify-between",children:[o.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit",children:[e.jsx(Ce,{size:12})," ",t.note]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full w-fit uppercase tracking-wider border border-emerald-100 self-start",children:[e.jsx(We,{size:10})," ",t.audioLinks?t.audioLinks.length:0," Tracks"]})]})},t.id))})}),e.jsx(Xe,{isOpen:H,onClose:()=>g(!1),onSave:he,initialData:v}),R&&e.jsx(Ye,{isOpen:!!R,onClose:()=>U(null),item:R,onUpdate:fe,showDash:o.showDash,onToggleDash:Z}),e.jsx(le,{isOpen:M,onClose:()=>V(!1),onSelect:pe,type:"audio",title:"Select Audio"}),e.jsx(ne,{isOpen:!!z,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:xe,onClose:()=>p(null),icon:e.jsx(D,{size:40,className:"text-red-500"})})]})};export{pt as ListeningCardPage,pt as default};
