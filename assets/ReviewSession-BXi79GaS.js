import{j as e,o as Z,p as i,Z as K,B as oe,f as ce,e as de,q as xe,A as ue,s as pe,V as me,t as fe,E as he,u as ge,v as be,k as se,X as te,d as je,w as we,x as ve,T as ye,y as Ne,z as ke,D as Se,r,G as ee,H as J,I as X}from"./index-CaR-JOI2.js";import{T as Ce}from"./trophy-AmBhknCE.js";const Re=(s,d,C)=>{if(C)return s?s==="GAVE_UP"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-amber-100 text-amber-700",children:[e.jsx(ke,{size:10})," Gave Up"]}):s==="PASS"||s===i.EASY?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-700",children:[e.jsx(se,{size:10})," Pass"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:[e.jsx(te,{size:10})," Fail"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:[e.jsx(Ne,{size:10})," No Answer"]});if(!s)return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:"Skipped"});if(d&&(s===i.EASY||s===i.LEARNED))return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-cyan-100 text-cyan-700",children:"Learned"});switch(s){case i.FORGOT:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:"Forgot"});case i.HARD:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-orange-100 text-orange-600",children:"Hard"});case i.EASY:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-600",children:"Easy"});default:return null}},Ee=({score:s})=>{const p=2*Math.PI*16,R=p-s/100*p;let j="text-neutral-400";return s>=80?j="text-green-500":s>=50?j="text-yellow-500":s>0&&(j="text-orange-500"),e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:36,height:36},children:[e.jsxs("svg",{className:"absolute",width:36,height:36,children:[e.jsx("circle",{className:"text-neutral-100",stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2}),e.jsx("circle",{className:j,stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2,strokeDasharray:p,strokeDashoffset:R,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.5s ease-out"}})]}),e.jsx("span",{className:`text-[10px] font-black ${j}`,children:s})]})},ze=({word:s})=>{const d=s.masteryScore??0;return e.jsxs("div",{className:"relative group/score",children:[e.jsx(Ee,{score:d}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/score:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Mastery Score",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]})},Ie=({complexity:s})=>e.jsxs("div",{className:"relative group/complexity",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 transition-all hover:bg-amber-100 shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black opacity-50",children:"CX"}),e.jsx("span",{className:"text-xs font-black",children:s})]}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/complexity:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Complexity Level",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]}),Me=s=>{const{user:d,initialWords:C,sessionWords:o,sessionType:p,newWordIds:R,progress:j,setProgress:A,sessionOutcomes:D,sessionFinished:_,wordInModal:k,setWordInModal:S,editingWordInModal:F,setEditingWordInModal:w,isTesting:P,setIsTesting:O,currentWord:c,isNewWord:h,onUpdate:N,onComplete:v,nextItem:re,handleReview:f,handleTestComplete:E,handleRetry:V,handleEndSession:G,handleQuickReview:Y,handleManualPractice:L,isQuickReviewMode:H}=s,{current:y,max:Q}=j,l=p==="random_test",x=n=>{S(null),w(n)},B=n=>{N(n),w(null)};if(C.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 py-20 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner",children:e.jsx(Z,{size:32})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"All clear!"}),e.jsx("button",{onClick:v,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-semibold text-sm hover:bg-neutral-800 transition-colors",children:"Back to Dashboard"})]});if(_){if(p==="new"||p==="due"||p==="new_study"||p==="custom"||l){const n=Object.values(D).filter(g=>g==="PASS"||g===i.EASY||g===i.LEARNED).length;return e.jsxs("div",{className:"max-w-2xl mx-auto py-10 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center mb-4 ${l?"bg-amber-100 text-amber-600":"bg-neutral-100 text-neutral-900"}`,children:l?e.jsx(K,{size:40,fill:"currentColor"}):e.jsx(oe,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:l?"Test Result":"Session Recap"}),l&&e.jsxs("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-[0.2em] mt-2",children:["Score: ",n," / ",o.length]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You've completed this focused session."})]}),e.jsx("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm mb-8 overflow-hidden",children:e.jsx("div",{className:"max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 p-2",children:o.map(g=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50/70 p-2.5 rounded-xl border border-neutral-100",children:[e.jsx("span",{className:"font-bold text-neutral-800 text-xs truncate pr-2",children:g.word}),Re(D[g.id],R.has(g.id),l)]},g.id))})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:v,className:"px-6 py-4 bg-white border border-neutral-200 text-neutral-500 rounded-2xl font-bold text-xs hover:bg-neutral-50 hover:border-neutral-900 transition-all active:scale-95 uppercase tracking-widest",children:"Finish Session"}),e.jsxs("button",{onClick:V,className:"px-6 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center justify-center space-x-2 shadow-lg hover:bg-neutral-800 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(ce,{size:14}),e.jsx("span",{children:"Retry This Session"})]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in zoom-in-95 duration-500",children:[e.jsx(Ce,{size:64,className:"text-yellow-500 mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You have finished this review session."}),e.jsx("button",{onClick:v,className:"mt-8 px-10 py-3.5 bg-neutral-900 text-white rounded-2xl font-bold shadow-xl hover:scale-105 transition-all text-sm",children:"Return to Dashboard"})]})}if(!c)return null;const W=h?de:xe,U=h?"text-blue-500":"text-neutral-500",z=c.ipa||c.word,I=!!c.ipa;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-100px)] flex flex-col animate-in fade-in duration-300",children:[e.jsxs("div",{className:"px-6 shrink-0 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"w-24"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{size:14,className:U}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:[y+1," / ",o.length]})]}),e.jsx("div",{className:"w-24 text-right",children:e.jsx("button",{onClick:G,className:"px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider text-neutral-500 hover:bg-neutral-100 transition-colors",children:"End Session"})})]}),e.jsx("div",{className:"h-1 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-neutral-900 transition-all duration-300 ease-in-out",style:{width:`${(y+1)/o.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative gap-4",children:[e.jsx("button",{onClick:()=>A(n=>({...n,current:(n.current-1+o.length)%o.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Previous word",children:e.jsx(ue,{size:28})}),e.jsx("div",{className:"w-full max-w-xl h-full bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col relative overflow-hidden group select-none",children:l?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-4",children:[e.jsx(pe,{className:"animate-spin text-neutral-200",size:32}),e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Loading Next Test..."})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:`font-black text-neutral-900 tracking-tight text-4xl ${I?"font-serif":""}`,children:z}),h?e.jsx(Ie,{complexity:c.complexity??0}):e.jsx(ze,{word:c}),e.jsx("button",{onClick:n=>{n.stopPropagation(),fe(c.word)},className:"p-3 text-neutral-400 bg-neutral-50 hover:bg-neutral-100 hover:text-neutral-900 rounded-full transition-colors",title:"Pronounce",children:e.jsx(me,{size:22})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>S(c),className:"flex items-center gap-2 px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-black text-[10px] hover:bg-amber-600 transition-all active:scale-95 uppercase tracking-widest shadow-lg shadow-amber-500/20",children:[e.jsx(ge,{size:14}),e.jsx("span",{children:"Practice"})]})]})]})}),e.jsx("button",{onClick:()=>A(n=>({...n,current:(n.current+1)%o.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Next word",children:e.jsx(be,{size:28})})]}),e.jsx("div",{className:"shrink-0 pt-6 pb-2 mt-auto",children:h?e.jsxs("div",{className:"max-w-lg mx-auto grid grid-cols-3 items-stretch gap-4",children:[e.jsx("div",{})," ",e.jsxs("button",{onClick:()=>f(i.LEARNED),className:"py-5 bg-green-500 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 shadow-lg shadow-green-500/20 hover:bg-green-600 transition-all active:scale-95",children:[e.jsx(se,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"LEARNED"})]}),e.jsx("div",{})," "]}):!l&&e.jsxs("div",{className:"max-w-xl mx-auto grid grid-cols-4 items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>f(i.FORGOT),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-red-600 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(te,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"FORGOT"})]}),e.jsxs("button",{onClick:()=>f(i.HARD),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-orange-600 hover:bg-orange-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(je,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Hard"})]}),e.jsxs("button",{onClick:()=>f(i.EASY),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-green-600 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(Z,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Easy"})]}),e.jsxs("button",{onClick:Y,className:"py-5 bg-indigo-600 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all hover:bg-indigo-700 shadow-md shadow-indigo-200",children:[e.jsx(K,{size:20,fill:"currentColor"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Quick Review"})]})]})})]}),k&&e.jsx(we,{word:k,onUpdate:N,onClose:()=>S(null),onNavigateToWord:S,onEditRequest:x,onGainXp:async()=>0,isViewOnly:!0}),F&&e.jsx(ve,{user:d,word:F,onSave:B,onClose:()=>w(null),onSwitchToView:()=>{w(null),S(F)}}),P&&c&&e.jsx(ye,{word:c,isQuickFire:l,sessionPosition:l?{current:y+1,total:o.length}:void 0,onPrevWord:()=>A(n=>({...n,current:Math.max(0,n.current-1)})),onClose:()=>{l?v():O(!1)},onComplete:E,skipSetup:H})]})},_e=(s,d,C)=>{},Fe=({user:s,sessionWords:d,sessionFocus:C,sessionType:o,onUpdate:p,onBulkUpdate:R,onComplete:j,onRetry:A})=>{const{showToast:D}=Se(),_=d,k=r.useRef(null),[S,F]=r.useState(new Set),[w,P]=r.useState(()=>{const t=ee("vocab_pro_session_progress",null);return t&&typeof t.current=="number"&&typeof t.max=="number"&&t.current<=t.max&&t.max<d.length?t:{current:0,max:0}}),[O,c]=r.useState(()=>ee("vocab_pro_session_outcomes",{})),[h,N]=r.useState(new Map),{current:v,max:re}=w,[f,E]=r.useState(!1),[V,G]=r.useState(null),[Y,L]=r.useState(null),[H,y]=r.useState(o==="random_test"),[Q,l]=r.useState(!1),x=_[v],B=r.useMemo(()=>!(x!=null&&x.lastReview),[x]),W=r.useRef(h);r.useEffect(()=>{W.current=h},[h]);const U=r.useRef(f);r.useEffect(()=>{U.current=f},[f]),r.useEffect(()=>{const t=d.map(a=>a.id).sort().join(",");(k.current===null||k.current!==t)&&(k.current=t,F(new Set(d.filter(a=>!a.lastReview).map(a=>a.id))),P({current:0,max:0}),c({}),E(!1),N(new Map),sessionStorage.removeItem("vocab_pro_session_progress"),sessionStorage.removeItem("vocab_pro_session_outcomes"))},[d]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_progress",JSON.stringify(w))},[w]),r.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_outcomes",JSON.stringify(O))},[O]),r.useEffect(()=>{G(null),L(null),y(o==="random_test"),l(!1)},[v,o]);const z=r.useCallback(async()=>{const t=Array.from(W.current.values());t.length!==0&&(await R(t),N(new Map))},[R]);r.useEffect(()=>()=>{!U.current&&W.current.size>0&&z()},[z]),r.useEffect(()=>{f&&h.size>0&&z()},[f,z,h.size]);const I=()=>{if(v<_.length-1){const t=v+1;P(a=>({current:t,max:Math.max(a.max,t)}))}else E(!0)},n=async t=>{if(!x)return;c(M=>({...M,[x.id]:t}));const a=J(x,t);N(M=>new Map(M).set(a.id,a)),I()},g=()=>{l(!0),y(!0)},ae=()=>{l(!1),y(!0)},ne=async(t,a,M=!1,$)=>{if(y(!1),!x)return;let T={...x};if(a){const m=a.PRONUNCIATION===!1,u=a.IPA_QUIZ===!1;(m||u)&&!T.needsPronunciationFocus&&(T.needsPronunciationFocus=!0,D(`"${T.word}" marked for pronunciation focus.`,"info"))}if(Q&&$){const m=$.tested-$.correct;let u=i.FORGOT;m===0?u=i.EASY:m===1&&(u=i.HARD),c(q=>({...q,[x.id]:u}));const b=J(T,u);a&&(b.lastTestResults={...b.lastTestResults||{},...a}),b.masteryScore=X(b),N(q=>new Map(q).set(b.id,b)),l(!1),I();return}if(o==="random_test"){let m=M?"GAVE_UP":t===i.EASY?"PASS":"FAIL";c(b=>({...b,[x.id]:m}));const u=J(T,t);a&&(u.lastTestResults={...u.lastTestResults||{},...a}),u.masteryScore=X(u),N(b=>new Map(b).set(u.id,u)),M?E(!0):I()}else{const m={...T};a&&(m.lastTestResults={...m.lastTestResults||{},...a}),m.masteryScore=X(m),await p(m)}},le=()=>{k.current=null,A()},ie=()=>{E(!0)};return e.jsx(Me,{user:s,initialWords:d,sessionWords:_,sessionType:o,newWordIds:S,progress:w,setProgress:P,sessionOutcomes:O,sessionFinished:f,wordInModal:V,setWordInModal:G,editingWordInModal:Y,setEditingWordInModal:L,isTesting:H,setIsTesting:y,currentWord:x,isNewWord:B,onUpdate:p,onComplete:j,nextItem:I,handleReview:n,handleTestComplete:ne,handleRetry:le,handleEndSession:ie,handleQuickReview:g,handleManualPractice:ae,isQuickReviewMode:Q})};export{Fe as default,_e as logSrsUpdate};
