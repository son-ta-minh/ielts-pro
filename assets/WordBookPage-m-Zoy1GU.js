import{c as Z,r as a,h as We,G as ft,ab as bt,a2 as gt,a1 as wt,j as e,Y as Ee,A as jt,T as Me,q as _,b as Ie,a8 as Oe,ak as vt,y as yt,E as Nt,a5 as xe,V as kt,l as Ct,a0 as Ue,a as fe,X as z,a4 as St,a6 as Tt,a9 as B,n as At,by as Fe,x as X,Z as be,bz as Bt,bA as Lt}from"./index-BW-hC1Rh.js";import{U as zt}from"./UniversalCard-C8LUGz8r.js";import{P as $e}from"./pen-C9nWCXhS.js";import{P as Wt,M as me}from"./palette-CZoYDv8m.js";import{L as Et}from"./library-DMk-JOYu.js";import{C as Mt}from"./chevron-left-DgKk1qXL.js";import{S as It}from"./search-blkVTTR9.js";import"./target-DrQleIR5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Z("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=Z("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Z("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=Z("Layers3",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m6.08 9.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1e5n1m"}],["path",{d:"m6.08 14.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1iwflc"}]]);function $t(l){return`You are an expert IELTS coach and vocabulary curator. Your task is to generate a thematic "Word Book".
    
    USER REQUESTED TOPIC: "${l}"

    INSTRUCTIONS:
    1.  **Analyze the Topic**: Understand the core concept of "${l}".
    2.  **Find a Central Icon**: Select a single, simple, high-quality emoji that best represents the topic.
    3.  **Generate Vocabulary**: Create a list of 15-20 essential, high-value vocabulary items (words or short phrases) directly related to the topic.
    4.  **Provide Definitions**: For each vocabulary item, write a very concise, easy-to-understand definition in English.
    5.  **Format Topic**: The "topic" field MUST be in the format 'Category: Topic Name'. For example, if the user requests 'Trees', a good response would be 'Environment: Trees'.
    6.  **Select a Color**: From the provided list of classic book cover colors, choose ONE hex code that best fits the theme. For example, 'Environment' topics might be green or brown, 'Ocean' topics might be blue. AVAILABLE COLORS: ["#5d4037", "#263238", "#2e7d32", "#821c21", "#4a2c2a", "#37474f", "#4e342e", "#004d40"].
    
    STRICT JSON OUTPUT FORMAT:
    Return a single JSON object with the following structure. Do not include any text outside the JSON block.

    {
      "topic": "string (The topic name, MUST be in 'Category: Topic Name' format. e.g., 'Environment: Trees')",
      "icon": "string (A single emoji character, e.g., 'ðŸŒ³')",
      "color": "string (The chosen hex code from the available list, e.g., '#2e7d32')",
      "words": [
        {
          "word": "string (e.g., 'Trunk')",
          "definition": "string (e.g., 'The main woody stem of a tree.')"
        },
        {
          "word": "string (e.g., 'Branch')",
          "definition": "string (e.g., 'A limb extending from the main trunk.')"
        },
        {
          "word": "string (e.g., 'Canopy')",
          "definition": "string (e.g., 'The upper layer of leaves and branches.')"
        }
      ]
    }
    `}function Rt(l,u,p){const h=u.join(", ");return`You are an expert IELTS coach and vocabulary curator.
    
    TASK: Generate new vocabulary items for an existing Word Book based on a user's request.

    CONTEXT:
    - Word Book Topic: "${l}"
    - Words Already in the Book (DO NOT REPEAT THESE): [${h}]

    USER REQUEST: "${p||"Suggest 5-10 more relevant words."}"

    INSTRUCTIONS:
    1.  Analyze the topic, the existing words, and the user's request.
    2.  Generate a list of NEW, high-value vocabulary items (words or short phrases) that fit the request and topic.
    3.  You MUST NOT include any of the words from the "Words Already in the Book" list.
    4.  For each new word, provide a very concise, easy-to-understand definition in English.
    
    STRICT JSON OUTPUT FORMAT:
    Return a single JSON array of objects. Do not include any text outside the JSON block.

    [
      {
        "word": "string (The new word)",
        "definition": "string (The concise definition)"
      },
      {
        "word": "string (Another new word)",
        "definition": "string (Its definition)"
      }
    ]
    `}const he=["#5d4037","#3e2723","#1a237e","#1b5e20","#b71c1c","#0ea5e9","#10b981","#f59e0b","#ec4899","#8b5cf6","#0f172a","#171717","#334155","#450a0a","#1e1b4b","#bae6fd","#bbf7d0","#fef08a","#fecaca","#ddd6fe"],Dt=["#ffffff","#000000","#fef08a","#bae6fd","#fecaca","#ddd6fe","#f59e0b","#0ea5e9","#10b981","#ef4444","#8b5cf6","#ec4899","#3e2723","#1e1b4b","#1b5e20","#450a0a","#171717","#334155","#94a3b8","#475569"],pe=({icon:l,className:u})=>l?(l==null?void 0:l.startsWith("http"))||(l==null?void 0:l.startsWith("data:image"))?e.jsx("img",{src:l,className:`object-contain ${u}`,alt:"Book icon"}):e.jsx("span",{className:u,children:l}):null,Pt=({isOpen:l,onClose:u,onSave:p})=>{const[h,v]=a.useState(""),[y,m]=a.useState("");a.useEffect(()=>{l&&(v(""),m(""))},[l]);const N=()=>{h.trim()&&p(h.trim(),y.trim())};return l?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Add Word to Book"})}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-bold text-sm",children:"Word / Phrase"}),e.jsx("input",{value:h,onChange:f=>v(f.target.value),className:"w-full px-3 py-2 bg-neutral-50 border border-neutral-200 rounded-lg font-medium",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-bold text-sm",children:"Definition (Optional)"}),e.jsx("textarea",{value:y,onChange:f=>m(f.target.value),rows:3,className:"w-full p-3 bg-neutral-50 border border-neutral-200 rounded-lg font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{onClick:N,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(be,{size:14})," Save Word"]})})]})}):null},_t=({isOpen:l,onClose:u,onSave:p,units:h,libraryWords:v,wordsInBook:y})=>{const[m,N]=a.useState(null),[f,r]=a.useState([]),b=a.useMemo(()=>new Set(y.map(n=>n.word.toLowerCase())),[y]),C=a.useMemo(()=>new Map(v.map(n=>[n.id,n])),[v]);a.useEffect(()=>{l&&(N(null),r([]))},[l]);const g=n=>{N(n);const S=h.find(E=>E.id===n);if(S){const E=S.wordIds.map(I=>C.get(I)).filter(I=>!!I&&!b.has(I.word.toLowerCase()));r(E)}},k=n=>r(S=>S.filter(E=>E.id!==n)),W=()=>p(f);return l?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-4xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[85vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Add from Reading Unit"}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-4 overflow-hidden",children:[e.jsx("h4",{className:"text-sm font-bold text-neutral-500 px-1",children:"1. Select a Unit"}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-1 custom-scrollbar",children:h.map(n=>e.jsxs("button",{onClick:()=>g(n.id),className:`w-full text-left p-3 rounded-xl border transition-all ${m===n.id?"bg-indigo-50 border-indigo-200 shadow-sm":"bg-white border-neutral-100 hover:bg-neutral-50"}`,children:[e.jsx("p",{className:`font-bold text-sm ${m===n.id?"text-indigo-900":"text-neutral-700"}`,children:n.name}),e.jsxs("p",{className:"text-[10px] text-neutral-400 font-bold uppercase tracking-wider",children:[n.wordIds.length," words"]})]},n.id))})]}),e.jsxs("div",{className:"flex flex-col gap-4 bg-neutral-50/50 p-4 rounded-2xl border border-neutral-200 overflow-hidden",children:[e.jsxs("h4",{className:"text-sm font-bold text-neutral-500 px-1",children:["2. Candidate List (",f.length,")"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2 custom-scrollbar",children:[f.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 pl-3 rounded-lg bg-white border border-neutral-200 shadow-sm animate-in fade-in",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:n.word}),e.jsx("p",{className:"text-[10px] text-neutral-500 truncate",children:n.meaningVi})]}),e.jsx("button",{onClick:()=>k(n.id),className:"p-1.5 text-neutral-300 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",children:e.jsx(z,{size:14})})]},n.id)),m&&f.length===0&&e.jsx("div",{className:"text-center py-10 text-neutral-400 italic text-xs font-medium",children:"All words from this unit are already in the book."}),!m&&e.jsx("div",{className:"text-center py-10 text-neutral-300 italic text-xs font-medium",children:"Select a unit to see candidates."})]})]})]}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end items-center gap-3 bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:[e.jsx("button",{onClick:u,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-xl font-bold text-xs hover:bg-neutral-200",children:"Cancel"}),e.jsxs("button",{onClick:W,disabled:f.length===0,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50",children:[e.jsx(_,{size:14})," Add Selected (",f.length,")"]})]})]})}):null},Gt=({isOpen:l,onClose:u,onSave:p})=>{const[h,v]=a.useState("");if(a.useEffect(()=>{l&&v("")},[l]),!l)return null;const y=()=>{h.trim()&&p(h.trim())};return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Add New Shelf"})}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-2",children:[e.jsx("label",{htmlFor:"shelf-name-input",className:"font-bold text-sm",children:"Shelf Name"}),e.jsx("input",{id:"shelf-name-input",value:h,onChange:m=>v(m.target.value),className:"w-full px-3 py-2 bg-neutral-50 border border-neutral-200 rounded-lg font-medium",autoFocus:!0,onKeyDown:m=>{m.key==="Enter"&&y()}})]}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end items-center gap-3 bg-neutral-50/50 rounded-b-[2.5rem]",children:[e.jsx("button",{onClick:u,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-xl font-bold text-xs hover:bg-neutral-200",children:"Cancel"}),e.jsxs("button",{onClick:y,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(be,{size:14})," Save"]})]})]})})},qt=({isOpen:l,onClose:u,onSave:p,initialName:h})=>{const[v,y]=a.useState("");if(a.useEffect(()=>{l&&y(h)},[l,h]),!l)return null;const m=()=>{v.trim()&&p(v.trim())};return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Rename Shelf"})}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-2",children:[e.jsx("label",{htmlFor:"shelf-rename-input",className:"font-bold text-sm",children:"New Shelf Name"}),e.jsx("input",{id:"shelf-rename-input",value:v,onChange:N=>y(N.target.value),className:"w-full px-3 py-2 bg-neutral-50 border border-neutral-200 rounded-lg font-medium",autoFocus:!0,onKeyDown:N=>{N.key==="Enter"&&m()}})]}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end items-center gap-3 bg-neutral-50/50 rounded-b-[2.5rem]",children:[e.jsx("button",{onClick:u,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-xl font-bold text-xs hover:bg-neutral-200",children:"Cancel"}),e.jsxs("button",{onClick:m,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(be,{size:14})," Save"]})]})]})})},Vt=({isOpen:l,onClose:u,onConfirm:p,shelves:h,currentShelf:v,bookTitle:y})=>l?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Move Book"}),e.jsxs("p",{className:"text-xs text-neutral-500 font-bold mt-1 truncate",children:['"',y,'"']})]}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-6 overflow-y-auto max-h-[50vh] space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest px-2 mb-2",children:"Select Destination Shelf"}),h.filter(m=>m!==v).map(m=>e.jsxs("button",{onClick:()=>p(m),className:"w-full text-left px-4 py-3 rounded-xl border border-neutral-100 hover:border-neutral-300 hover:bg-neutral-50 transition-all font-bold text-sm text-neutral-700 flex items-center justify-between group",children:[e.jsx("span",{children:m}),e.jsx(fe,{size:16,className:"text-neutral-300 group-hover:text-neutral-900 transition-colors"})]},m)),h.length<=1&&e.jsx("p",{className:"text-center py-4 text-xs font-medium text-neutral-400 italic",children:"No other shelves available."})]}),e.jsx("footer",{className:"px-8 py-4 border-t border-neutral-100 bg-neutral-50/50 rounded-b-[2.5rem] flex justify-end",children:e.jsx("button",{onClick:u,className:"px-5 py-2 text-xs font-bold text-neutral-500 hover:text-neutral-900",children:"Cancel"})})]})}):null,Jt=({isOpen:l,onClose:u,onConfirm:p,books:h,currentBookId:v,wordText:y})=>{const[m,N]=a.useState(""),f=a.useMemo(()=>{const b=h.filter(g=>g.id!==v),C=new Map;return b.forEach(g=>{const k=g.topic.split(":")[0].trim()||"General";C.has(k)||C.set(k,[]),C.get(k).push(g)}),Array.from(C.entries()).sort((g,k)=>g[0].localeCompare(k[0]))},[h,v]),r=a.useMemo(()=>{if(!m.trim())return f;const b=m.toLowerCase();return f.map(([C,g])=>{const k=g.filter(W=>W.topic.toLowerCase().includes(b));return[C,k]}).filter(([C,g])=>g.length>0)},[f,m]);return l?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Move Word"}),e.jsxs("p",{className:"text-xs text-neutral-500 font-bold mt-1 truncate",children:['Moving "',y,'" to another book...']})]}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsx("div",{className:"p-4 border-b border-neutral-50",children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-300",size:14}),e.jsx("input",{value:m,onChange:b=>N(b.target.value),placeholder:"Search destination book...",className:"w-full pl-9 pr-4 py-2 bg-neutral-50 border border-neutral-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-neutral-900 outline-none",autoFocus:!0})]})}),e.jsxs("main",{className:"p-4 overflow-y-auto flex-1 space-y-6 custom-scrollbar",children:[r.map(([b,C])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"px-3 text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:b}),e.jsx("div",{className:"space-y-1",children:C.map(g=>{const k=g.topic.split(":").slice(1).join(":").trim()||g.topic;return e.jsxs("button",{onClick:()=>p(g.id),className:"w-full text-left px-4 py-3 rounded-xl border border-neutral-100 hover:border-neutral-300 hover:bg-neutral-50 transition-all font-bold text-sm text-neutral-700 flex items-center gap-3 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center bg-neutral-100 group-hover:bg-white border border-transparent group-hover:border-neutral-200 shrink-0",children:e.jsx(pe,{icon:g.icon,className:"text-base"})}),e.jsx("span",{className:"flex-1 truncate",children:k}),e.jsx(fe,{size:14,className:"text-neutral-300 group-hover:text-neutral-900"})]},g.id)})})]},b)),r.length===0&&e.jsx("div",{className:"text-center py-10 text-neutral-400 italic text-xs font-medium",children:"No other books found."})]}),e.jsx("footer",{className:"px-8 py-4 border-t border-neutral-100 bg-neutral-50/50 rounded-b-[2.5rem] flex justify-end",children:e.jsx("button",{onClick:u,className:"px-5 py-2 text-xs font-bold text-neutral-500 hover:text-neutral-900",children:"Cancel"})})]})}):null},Yt=({isOpen:l,onClose:u,onSave:p,libraryWords:h,wordsInBook:v})=>{const[y,m]=a.useState(""),[N,f]=a.useState([]);a.useEffect(()=>{l&&(m(""),f([]))},[l]);const r=a.useMemo(()=>new Set(v.map(n=>n.word.toLowerCase())),[v]),b=a.useMemo(()=>new Set(N.map(n=>n.id)),[N]),C=a.useMemo(()=>{if(!y)return[];const n=y.toLowerCase();return h.filter(S=>S.word.toLowerCase().includes(n)&&!r.has(S.word.toLowerCase())&&!b.has(S.id)).slice(0,10)},[y,h,r,b]),g=n=>f(S=>[...S,n]),k=n=>f(S=>S.filter(E=>E.id!==n)),W=()=>p(N);return l?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Add from Library"}),e.jsx("button",{onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(z,{size:20})})]}),e.jsxs("main",{className:"p-6 grid grid-cols-2 gap-6 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{value:y,onChange:n=>m(n.target.value),placeholder:"Search your library...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium",autoFocus:!0}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2",children:C.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white hover:bg-neutral-50 border border-neutral-100",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:n.word}),e.jsx("p",{className:"text-xs text-neutral-500 truncate",children:n.meaningVi})]}),e.jsx("button",{onClick:()=>g(n),className:"p-2 text-neutral-400 hover:text-green-600 hover:bg-green-50 rounded-full",children:e.jsx(_,{size:16})})]},n.id))})]}),e.jsxs("div",{className:"flex flex-col gap-4 bg-neutral-50/50 p-4 rounded-2xl border border-neutral-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-neutral-500 px-1",children:["Selected Words (",N.length,")"]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2",children:N.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 pl-3 rounded-lg bg-white border border-neutral-200 shadow-sm",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:n.word}),e.jsx("button",{onClick:()=>k(n.id),className:"p-1.5 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-full",children:e.jsx(z,{size:14})})]},n.id))})]})]}),e.jsxs("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end items-center gap-3 bg-neutral-50/50 rounded-b-[2.5rem] shrink-0",children:[e.jsx("button",{onClick:u,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-xl font-bold text-xs hover:bg-neutral-200",children:"Cancel"}),e.jsxs("button",{onClick:W,disabled:N.length===0,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest disabled:opacity-50",children:[e.jsx(_,{size:14})," Add (",N.length,")"]})]})]})}):null},Ht=l=>{let u=0;for(let p=0;p<l.length;p++)u=l.charCodeAt(p)+((u<<5)-u);return u},as=({user:l})=>{var Le,ze;const[u,p]=a.useState([]),[h,v]=a.useState([]),[y,m]=a.useState([]),[N,f]=a.useState(!0),[r,b]=a.useState(null),[C,g]=a.useState(!1),[k,W]=a.useState(null),[n,S]=a.useState(null),[E,I]=a.useState(!1),[De,G]=a.useState(!1),[Pe,ee]=a.useState(!1),[ge,$]=a.useState(!1),[_e,te]=a.useState(!1),[R,se]=a.useState(""),[Ge,re]=a.useState(!1),[we,je]=a.useState(""),[D,ae]=a.useState(()=>We("wordbook_custom_shelves",[])),[ve,oe]=a.useState(0),[qe,ne]=a.useState(!1),[Ve,q]=a.useState(!1),[V,le]=a.useState(null),[J,Y]=a.useState(!1),ie=a.useRef(null),[de,ye]=a.useState(""),[Ne,ce]=a.useState(new Map),[P,U]=a.useState(null),[H,K]=a.useState(null),[ke,Ce]=a.useState({}),[Je,Se]=a.useState(null),[O,ue]=a.useState(null),{showToast:w}=ft();a.useEffect(()=>{const s=t=>{ie.current&&!ie.current.contains(t.target)&&Y(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const Ye=s=>{if(!s)return null;if(!s.lastReview)return{text:"New",classes:"bg-blue-50 text-blue-700 border-blue-100"};switch(s.lastGrade){case"FORGOT":return{text:"Forgot",classes:"bg-rose-50 text-rose-700 border-rose-100"};case"HARD":return{text:"Hard",classes:"bg-orange-50 text-orange-700 border-orange-100"};case"EASY":return{text:"Easy",classes:"bg-green-50 text-green-700 border-green-100"};case"LEARNED":return{text:"Learned",classes:"bg-cyan-50 text-cyan-700 border-cyan-100"};default:return{text:"Studied",classes:"bg-neutral-50 text-neutral-500 border-neutral-100"}}},F=a.useCallback(async()=>{f(!0);const[s,t,o]=await Promise.all([bt(l.id),gt(l.id),wt(l.id)]);p(s.sort((d,i)=>i.createdAt-d.createdAt)),v(t),m(o.sort((d,i)=>d.name.localeCompare(i.name))),f(!1)},[l.id]);a.useEffect(()=>{F()},[F]),a.useEffect(()=>{var s,t;if(r){const o=r.topic.split(":").map(x=>x.trim()),d=o.length>1?o.slice(1).join(":").trim():r.topic;se(d),je(r.icon),ye((s=r.color)!=null&&s.startsWith("http")||(t=r.color)!=null&&t.startsWith("data:image")?r.color:"");const i=new Map;h.forEach(x=>i.set(x.word.toLowerCase(),x)),ce(i);const c=We(`wordbook_focus_${r.id}`,{});Ce(c)}},[r,l.id,h]);const M=a.useMemo(()=>{const s=new Set(u.map(d=>d.topic.split(":")[0].trim()).filter(Boolean)),t=new Set([...D,...Array.from(s)]),o=Array.from(t).sort((d,i)=>d.localeCompare(i));return o.length>0?o:["General"]},[u,D]);a.useEffect(()=>{if(V&&M.includes(V)){const s=M.findIndex(t=>t===V);s!==-1&&oe(s),le(null)}},[M,V]);const A=M[ve],Q=a.useMemo(()=>u.filter(s=>(s.topic.split(":")[0].trim()||"General")===A),[u,A]),He=()=>ne(!0),Ke=()=>q(!0),Qe=s=>{const t=s.trim();if(M.map(d=>d.toLowerCase()).includes(t.toLowerCase())){w("Shelf name already exists.","error");return}const o=[...D,t];ae(o),X("wordbook_custom_shelves",o),le(t),w(`Shelf "${t}" created.`,"success"),ne(!1)},Xe=async s=>{const t=A;if(s&&s!==t){const o=s.trim();if(M.map(x=>x.toLowerCase()).includes(o.toLowerCase())){w("Shelf name already exists.","error");return}q(!1),f(!0);const i=u.filter(x=>(x.topic.split(":")[0].trim()||"General")===t).map(x=>{const T=x.topic.split(":").map(pt=>pt.trim()),j=T.length>1?T.slice(1).join(":").trim():T[0];return{...x,topic:`${o}: ${j}`}});await Promise.all(i.map(x=>B(x)));const c=D.map(x=>x===t?o:x);ae(c),X("wordbook_custom_shelves",c),await F(),le(o),w(`Renamed to "${o}".`,"success")}else q(!1)},Ze=()=>{if(Q.length>0){w("Cannot remove a shelf that contains books.","error");return}if(window.confirm(`Are you sure you want to delete the empty shelf "${A}"?`)){const s=D.filter(t=>t!==A);ae(s),X("wordbook_custom_shelves",s),oe(t=>Math.max(0,t-1))}},Te=s=>oe((ve+s+M.length)%M.length),et=async s=>{g(!1),f(!0);try{const t=s.topic||"Untitled",o=t.split(":").map(x=>x.trim()),d=o.length>1?o.slice(1).join(": ").trim():t,i=`${A}: ${d}`,c={id:`wb-${Date.now()}`,userId:l.id,topic:i,icon:s.icon,words:s.words,color:s.color,createdAt:Date.now(),updatedAt:Date.now()};await B(c),w("Word Book created!","success"),await F()}catch(t){w(t.message||"Failed to create Word Book.","error")}finally{f(!1)}},tt=async()=>{try{const s={id:`wb-${Date.now()}`,userId:l.id,topic:`${A}: Untitled Book`,icon:"ðŸ“–",words:[],createdAt:Date.now(),updatedAt:Date.now()};await B(s),await F(),w("New empty book created.","success")}catch(s){w(s.message||"Failed to create empty book.","error")}},st=async()=>{k&&(await Lt(k.id,l.id),w("Word Book deleted.","success"),W(null),b(null),await F())},rt=async s=>{if(!n)return;const t=n.topic.split(":").map(c=>c.trim()),o=t.length>1?t.slice(1).join(":").trim():t[0],d=`${s}: ${o}`,i={...n,topic:d,updatedAt:Date.now()};await B(i),S(null),await F(),w(`Moved to "${s}".`,"success")},at=async s=>{if(r){Se(s.word);try{const t=At(s.word,"",s.definition,"",`From Word Book: ${r.topic}`,[r.topic.split(":")[0].trim()]);t.userId=l.id,await Fe(t),ce(o=>new Map(o).set(s.word.toLowerCase(),t)),w(`'${s.word}' added to your main library!`,"success")}catch{w("Failed to add word to library.","error")}finally{Se(null)}}},ot=(s,t)=>{if(!r)return;const o={...ke,[s]:t};Ce(o),X(`wordbook_focus_${r.id}`,o)},nt=async()=>{if(!r)return;const s=r.topic.split(":").map(c=>c.trim()),t=s.length>1?s.slice(1).join(":").trim():r.topic;if(!R.trim()||R.trim()===t){te(!1),se(t);return}const d=`${s[0].trim()}: ${R.trim()}`,i={...r,topic:d,updatedAt:Date.now()};await B(i),b(i),p(c=>c.map(x=>x.id===i.id?i:x)),te(!1)},lt=async()=>{if(!r)return;const s=we.trim();if(s===r.icon){re(!1);return}const t={...r,icon:s,updatedAt:Date.now()};await B(t),b(t),p(o=>o.map(d=>d.id===t.id?t:d)),re(!1)},L=async s=>{if(!r)return;const t={...r,...s,updatedAt:Date.now()};await B(t),b(t),p(o=>o.map(d=>d.id===t.id?t:d))},it=async s=>{if(!r)return;const t=r.words.filter(d=>d.word!==s),o={...r,words:t,updatedAt:Date.now()};await B(o),b(o),w(`'${s}' removed from book.`,"success")},dt=async s=>{var o;if(!r||!O)return;const t=u.find(d=>d.id===s);if(t){if(t.words.some(d=>d.word.toLowerCase()===O.word.toLowerCase())){w("Word already exists in destination book.","error");return}f(!0);try{const d=r.words.filter(T=>T.word!==O.word),i={...r,words:d,updatedAt:Date.now()},c=[...t.words,O].sort((T,j)=>T.word.toLowerCase().localeCompare(j.word.toLowerCase())),x={...t,words:c,updatedAt:Date.now()};await Bt([i,x]),b(i),p(T=>T.map(j=>j.id===i.id?i:j.id===x.id?x:j)),ue(null),w(`Moved to "${(o=t.topic.split(":").pop())==null?void 0:o.trim()}"`,"success")}catch{w("Move failed.","error")}finally{f(!1)}}},ct=async(s,t)=>{if(!r||!s)return;if(r.words.some(i=>i.word.toLowerCase()===s.toLowerCase())){w("Word already exists in this book.","error");return}const o=[...r.words,{word:s,definition:t}],d={...r,words:o.sort((i,c)=>i.word.toLowerCase().localeCompare(c.word.toLowerCase())),updatedAt:Date.now()};await B(d),b(d),w(`'${s}' added.`,"success"),I(!1)},Ae=async s=>{if(!r)return;const t=new Set(r.words.map(c=>c.word.toLowerCase())),o=s.filter(c=>!t.has(c.word.toLowerCase())).map(c=>({word:c.word,definition:c.meaningVi}));if(o.length===0){w("All selected words are already in this book.","info"),G(!1);return}const d=[...r.words,...o].sort((c,x)=>c.word.toLowerCase().localeCompare(x.word.toLowerCase())),i={...r,words:d,updatedAt:Date.now()};await B(i),b(i),w(`Added ${o.length} words from your library.`,"success"),G(!1),ee(!1)},Be=async s=>{await Fe(s),ce(t=>new Map(t).set(s.word.toLowerCase(),s)),P&&P.id===s.id&&U(s),H&&P&&H.id===s.id&&K(s)},ut=s=>{if(!r)return"";const t=r.words.map(o=>o.word);return Rt(r.topic,t,s.request)},xt=async s=>{if(!r||!s||s.length===0){w("AI did not return any new words.","info"),$(!1);return}const t=new Set(r.words.map(c=>c.word.toLowerCase())),o=s.filter(c=>c.word&&!t.has(c.word.toLowerCase()));if(o.length===0){w("AI returned words that are already in the book.","info"),$(!1);return}const d=[...r.words,...o],i={...r,words:d.sort((c,x)=>c.word.toLowerCase().localeCompare(x.word.toLowerCase())),updatedAt:Date.now()};await B(i),b(i),w(`Added ${o.length} new words via AI.`,"success"),$(!1)},mt=a.useMemo(()=>{if(!k)return null;const s=k.topic.split(":"),t=s[s.length-1].trim();return e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',t,'"']}),"? This is permanent."]})},[k]),ht=a.useMemo(()=>{if(!n)return"";const s=n.topic.split(":");return s[s.length-1].trim()},[n]);if(N)return e.jsx("div",{className:"flex justify-center p-20",children:e.jsx(Ee,{className:"animate-spin text-neutral-300",size:32})});if(r){const s=!!((Le=r.color)!=null&&Le.startsWith("http")||(ze=r.color)!=null&&ze.startsWith("data:image"));return e.jsxs("div",{className:"h-full flex flex-col animate-in fade-in duration-500",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 gap-4 shrink-0 bg-white border-b border-neutral-100 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>b(null),className:"flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors",children:[" ",e.jsx(jt,{size:16})," Back "]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Ge?e.jsx("input",{value:we,onChange:t=>je(t.target.value),onBlur:lt,onKeyDown:t=>{t.key==="Enter"&&t.currentTarget.blur()},autoFocus:!0,placeholder:"Emoji/URL",className:"text-2xl w-24 text-center bg-neutral-100 border border-neutral-300 rounded-lg py-1 outline-none ring-2 ring-indigo-300"}):e.jsx("div",{onClick:()=>re(!0),className:"p-1 rounded-lg hover:bg-neutral-100 cursor-pointer min-w-10 flex items-center justify-center",children:r.icon?e.jsx(pe,{icon:r.icon,className:"text-2xl w-10 h-10 flex items-center justify-center mx-auto"}):e.jsx("div",{className:"w-10 h-10 rounded-xl border-2 border-dashed border-neutral-200 flex items-center justify-center text-neutral-300",children:e.jsx(Re,{size:18})})}),_e?e.jsx("input",{value:R,onChange:t=>se(t.target.value),onBlur:nt,onKeyDown:t=>{t.key==="Enter"&&t.currentTarget.blur()},autoFocus:!0,className:"text-xl font-black text-neutral-900 bg-neutral-100 border border-neutral-300 rounded-lg px-2 py-1 outline-none ring-2 ring-indigo-300"}):e.jsxs("div",{onClick:()=>te(!0),className:"group/title relative p-1 rounded-lg hover:bg-neutral-100 cursor-pointer flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-black text-neutral-900 tracking-tight",style:{color:r.titleColor||"#171717",fontSize:r.titleSize?`${r.titleSize}px`:"inherit"},children:R}),e.jsx($e,{size:14,className:"text-neutral-400 opacity-0 group-hover/title:opacity-100 transition-opacity"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",ref:ie,children:[e.jsxs("button",{onClick:()=>Y(!J),className:`p-2.5 rounded-xl transition-all border shadow-sm flex items-center justify-center gap-2 ${J?"bg-neutral-900 text-white border-neutral-900 shadow-md":"bg-white text-neutral-500 border-neutral-200 hover:bg-neutral-50 hover:text-neutral-900"}`,title:"Change Cover Design",children:[e.jsx(Wt,{size:18}),J&&e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest mr-1",children:"Design"})]}),J&&e.jsxs("div",{className:"absolute top-full right-0 mt-3 p-5 bg-white rounded-3xl shadow-[0_20px_50px_-12px_rgba(0,0,0,0.25)] border border-neutral-100 z-[100] animate-in fade-in zoom-in-95 origin-top-right w-80 space-y-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 px-1 border-b border-neutral-50 pb-2",children:e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Select Cover Color"})}),e.jsx("div",{className:"grid grid-cols-5 gap-3 justify-items-center",children:he.map(t=>e.jsx("button",{onClick:()=>L({color:t}),className:`w-8 h-8 rounded-full transition-all hover:scale-125 active:scale-90 ${r.color===t?"ring-2 ring-neutral-900 ring-offset-2 scale-110 shadow-md":"opacity-90 hover:opacity-100 shadow-sm border border-black/5"}`,style:{backgroundColor:t},title:"Choose color"},t))})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-neutral-50",children:[e.jsx("div",{className:"flex items-center gap-2 px-1",children:e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Title Font Style"})}),e.jsxs("div",{className:"space-y-3 px-1",children:[e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-5 gap-3 justify-items-center",children:Dt.map(t=>e.jsx("button",{onClick:()=>L({titleColor:t}),className:`w-6 h-6 rounded-md border transition-all ${r.titleColor===t?"ring-2 ring-indigo-500":"border-neutral-200"}`,style:{backgroundColor:t}},t))})}),e.jsxs("div",{className:"flex items-center gap-3 bg-neutral-50 p-2 rounded-xl",children:[e.jsx(Me,{size:14,className:"text-neutral-400"}),e.jsx("input",{type:"range",min:"12",max:"48",value:r.titleSize||24,onChange:t=>L({titleSize:parseInt(t.target.value)}),className:"flex-1 accent-neutral-900 h-1"}),e.jsx("span",{className:"text-[10px] font-black text-neutral-500 w-5",children:r.titleSize||24})]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-neutral-50",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Layout Positioning"}),e.jsx("button",{onClick:()=>L({titleTop:void 0,titleLeft:void 0,iconTop:void 0,iconLeft:void 0}),className:"text-[8px] font-black text-indigo-600 hover:underline uppercase",children:"Center All"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-1",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[8px] font-bold text-neutral-400 uppercase flex items-center gap-1",children:[e.jsx(Me,{size:10})," Title (Top/Left %)"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"number",value:r.titleTop??50,onChange:t=>L({titleTop:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"}),e.jsx("input",{type:"number",value:r.titleLeft??50,onChange:t=>L({titleLeft:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[8px] font-bold text-neutral-400 uppercase flex items-center gap-1",children:[e.jsx(me,{size:10})," Icon (Top/Left %)"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"number",value:r.iconTop??40,onChange:t=>L({iconTop:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"}),e.jsx("input",{type:"number",value:r.iconLeft??50,onChange:t=>L({iconLeft:parseInt(t.target.value)}),className:"w-full px-2 py-1 bg-neutral-50 border border-neutral-200 rounded-md text-[10px] font-bold"})]})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-neutral-50",children:[e.jsxs("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1.5",children:[e.jsx(Re,{size:10})," Custom Image URL / Base64"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:de,onChange:t=>ye(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(L({color:de.trim()}),Y(!1))},placeholder:"https://... or data:image/...",className:"flex-1 px-3 py-1.5 bg-neutral-50 border border-neutral-200 rounded-lg text-[10px] font-medium focus:ring-1 focus:ring-neutral-900 outline-none"}),e.jsx("button",{onClick:()=>{L({color:de.trim()}),Y(!1)},className:"p-1.5 bg-neutral-900 text-white rounded-lg hover:bg-neutral-800 transition-colors",children:e.jsx(_,{size:14})})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-neutral-50 transition-all",children:[e.jsx(Ie,{size:14,className:"text-amber-500"})," Auto Add"]}),e.jsxs("button",{onClick:()=>ee(!0),className:"px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-neutral-50 transition-all",children:[e.jsx(Ft,{size:14})," Unit"]}),e.jsxs("button",{onClick:()=>G(!0),className:"px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-neutral-50 transition-all",children:[e.jsx(Et,{size:14})," Library"]}),e.jsxs("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-white border border-neutral-200 text-neutral-600 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-neutral-50 transition-all",children:[e.jsx(Ot,{size:14})," Add Word"]})]})]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 bg-neutral-50/50 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-48 pointer-events-none transition-all duration-700 overflow-hidden",children:s?e.jsx("img",{src:r.color,className:"w-full h-full object-cover opacity-10",alt:""}):e.jsx("div",{className:"w-full h-full opacity-10",style:{backgroundColor:r.color||"#5d4037"}})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 relative z-10",children:r.words.map((t,o)=>{const d=Ne.has(t.word.toLowerCase()),i=d?Ne.get(t.word.toLowerCase()):null,c=ke[t.word]||null,x=Je===t.word;let T;if(!d)T={label:"Not in library",colorClass:"bg-neutral-50 text-neutral-500 border-neutral-100"};else if(i&&(i.quality===Oe.RAW||i.quality===Oe.REFINED))T={label:"Not verified",colorClass:"bg-amber-50 text-amber-700 border-amber-100"};else{const j=Ye(i);j&&(T={label:j.text,colorClass:j.classes})}return e.jsx(zt,{onClick:()=>d&&i&&U(i),title:e.jsx("h3",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight line-clamp-2",children:t.word}),badge:T,focusColor:c,onFocusChange:j=>ot(t.word,j),actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),yt(t.word)},className:"p-1.5 text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 rounded-lg transition-colors","aria-label":`Pronounce ${t.word}`,children:e.jsx(vt,{size:14})}),e.jsx("button",{onClick:j=>{j.stopPropagation(),ue(t)},className:"p-1.5 text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 rounded-lg transition-colors",title:"Move to another book",children:e.jsx(me,{size:14})}),d&&i?e.jsx("button",{onClick:j=>{j.stopPropagation(),U(i)},className:"p-1.5 text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 rounded-lg transition-colors",title:"View Details",children:e.jsx(Nt,{size:14})}):e.jsx("button",{onClick:j=>{j.stopPropagation(),at(t)},disabled:x,className:"p-1.5 text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 rounded-lg transition-colors",title:"Add to Library",children:x?e.jsx(Ee,{size:14,className:"animate-spin"}):e.jsx(_,{size:14})}),e.jsx("button",{onClick:j=>{j.stopPropagation(),it(t.word)},className:"p-1.5 text-neutral-400 hover:bg-red-50 hover:text-red-600 rounded-lg transition-colors",title:"Remove from this book",children:e.jsx(xe,{size:14})})]}),children:e.jsx("p",{className:"text-sm text-neutral-600 leading-relaxed",children:t.definition})},o)})})]}),P&&e.jsx(kt,{word:P,onClose:()=>U(null),onNavigateToWord:U,onUpdate:Be,onEditRequest:t=>{U(null),K(t)},onGainXp:async()=>0,isViewOnly:!1}),H&&e.jsx(Ct,{user:l,word:H,onSave:Be,onClose:()=>K(null),onSwitchToView:t=>{K(null),U(t)}}),e.jsx(Pt,{isOpen:E,onClose:()=>I(!1),onSave:ct}),e.jsx(Yt,{isOpen:De,onClose:()=>G(!1),onSave:Ae,libraryWords:h,wordsInBook:r.words}),e.jsx(_t,{isOpen:Pe,onClose:()=>ee(!1),onSave:Ae,units:y,libraryWords:h,wordsInBook:r.words}),ge&&e.jsx(Ue,{isOpen:ge,onClose:()=>$(!1),type:"GENERATE_UNIT",title:"Auto-Add Words",description:"Let AI suggest new words for your book.",onGeneratePrompt:ut,onJsonReceived:xt,actionLabel:"Add to Book",closeOnSuccess:!1}),e.jsx(Jt,{isOpen:!!O,onClose:()=>ue(null),onConfirm:dt,books:u,currentBookId:r.id,wordText:(O==null?void 0:O.word)||""})]})}return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Bookmark%20Tabs.png",className:"w-10 h-10 object-contain",alt:"Word Books"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Books"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Visual vocabulary collections by topic."})]})]}),e.jsxs("button",{onClick:He,className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Ut,{size:14})," Add Shelf"]})]}),e.jsxs("div",{className:"px-12 pt-10 pb-4 rounded-3xl",style:{backgroundColor:"#4e342e",backgroundImage:"repeating-linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02) 1px, transparent 1px, transparent 30px)",boxShadow:"inset 0 0 100px rgba(0,0,0,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between group mb-12 relative -top-3.5",style:{borderBottom:"3px solid rgba(0,0,0,0.4)",paddingBottom:"0.1rem",boxShadow:"0 5px 5px -3px rgba(0,0,0,0.5)"},children:[e.jsx("button",{onClick:()=>Te(-1),className:"p-3 bg-black/20 text-white/50 rounded-full hover:bg-black/40 hover:text-white transition-all",children:e.jsx(Mt,{size:24})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-gradient-to-b from-slate-200 to-slate-400 px-6 py-2 rounded-lg shadow-inner border-t border-slate-400/50 w-fit flex items-center gap-4",children:e.jsx("h3",{className:"text-xl font-black text-neutral-900 tracking-tight",children:A})}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:Ke,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx($e,{size:14})}),e.jsx("button",{onClick:Ze,disabled:Q.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white/20",title:Q.length>0?"Cannot remove non-empty shelf":"Remove Empty Shelf",children:e.jsx(xe,{size:14})})]})]}),e.jsx("button",{onClick:()=>Te(1),className:"p-3 bg-black/20 text-white/50 rounded-full hover:bg-black/40 hover:text-white transition-all",children:e.jsx(fe,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-[repeat(auto-fill,10rem)] gap-x-8 gap-y-10 min-h-[50vh] -mt-12",style:{backgroundImage:"repeating-linear-gradient(to bottom, transparent, transparent 14rem, rgba(0,0,0,0.4) 14rem, rgba(0,0,0,0.4) 14.25rem, transparent 14.25rem, transparent 16.5rem)"},children:[Q.map(s=>{const t=s.color||he[Math.abs(Ht(s.id))%he.length],o=s.topic.split(":").map(c=>c.trim()),d=o.length>1?o.slice(1).join(":").trim():s.topic,i=!!(t.startsWith("http")||t.startsWith("data:image"));return e.jsx("div",{className:"group [perspective:1000px] translate-y-0 cursor-pointer",onClick:()=>b(s),children:e.jsxs("div",{className:"relative w-full aspect-[5/7] rounded-lg shadow-lg transition-all duration-300 transform group-hover:shadow-2xl group-hover:shadow-black/40 group-hover:[transform:rotateY(-15deg)_scale(1.05)] overflow-hidden",style:{backgroundColor:i?"#262626":t,transformStyle:"preserve-3d",transform:"rotateY(-5deg) rotateX(2deg)"},children:[i&&e.jsx("img",{src:t,className:"absolute inset-0 w-full h-full object-cover",alt:""}),e.jsx("div",{className:"absolute top-0 left-0 bottom-0 w-6 bg-gradient-to-r from-black/40 to-transparent rounded-l-lg z-10"}),e.jsxs("div",{className:`absolute inset-2 border-2 border-black/10 rounded-sm z-10 ${i?"":"bg-black/5"}`,children:[s.icon&&e.jsx("div",{className:"absolute flex items-center justify-center w-12 h-12",style:{top:`${s.iconTop??40}%`,left:`${s.iconLeft??50}%`,transform:"translate(-50%, -50%)"},children:e.jsx(pe,{icon:s.icon,className:"text-4xl w-full h-full object-contain drop-shadow-lg"})}),e.jsx("h3",{className:"absolute w-full text-center font-serif font-bold leading-tight drop-shadow-md px-2 line-clamp-3",style:{color:s.titleColor||"#ffffff",fontSize:s.titleSize?`${Math.min(s.titleSize,18)}px`:"18px",top:`${s.titleTop??55}%`,left:`${s.titleLeft??50}%`,transform:"translate(-50%, -50%)"},children:d})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 left-4 right-4 h-px bg-gradient-to-r from-transparent via-white/40 to-transparent z-10"}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4 h-px bg-gradient-to-r from-transparent via-white/40 to-transparent z-10"})]}),e.jsxs("div",{className:"absolute top-2 right-2 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),S(s)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",children:e.jsx(me,{size:16})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W(s)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",children:e.jsx(z,{size:16})})]})]})},s.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsxs("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:[e.jsxs("button",{onClick:()=>g(!0),className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(Ie,{size:28,className:"mb-2 text-amber-400/80"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New via AI"})]}),e.jsx("div",{className:"w-4/5 mx-auto h-px bg-neutral-50/50"}),e.jsxs("button",{onClick:tt,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(St,{size:28,className:"mb-2 text-neutral-400/80"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Empty"})]})]})})]})]}),C&&e.jsx(Ue,{isOpen:C,onClose:()=>g(!1),type:"GENERATE_UNIT",title:"Create a New Word Book",description:`Enter a topic for the "${A}" shelf.`,onGeneratePrompt:s=>$t(`${A}: ${s.request}`),onJsonReceived:et,actionLabel:"Create",closeOnSuccess:!0}),e.jsx(Tt,{isOpen:!!k,title:"Delete Word Book?",message:mt,confirmText:"Delete",isProcessing:!1,onConfirm:st,onClose:()=>W(null),icon:e.jsx(xe,{size:40,className:"text-red-500"})}),e.jsx(Vt,{isOpen:!!n,onClose:()=>S(null),onConfirm:rt,shelves:M,currentShelf:(n==null?void 0:n.topic.split(":")[0].trim())||"General",bookTitle:ht}),e.jsx(Gt,{isOpen:qe,onClose:()=>ne(!1),onSave:Qe}),e.jsx(qt,{isOpen:Ve,onClose:()=>q(!1),onSave:Xe,initialName:A})]})};export{as as WordBookPage};
