import{c as Te,r,j as e,ah as de,ae as Me,E as ae,as as be,S as me,aX as Fe,ai as Le,b2 as ue,I as fe,aR as ce,w as ie,P as Ee,ay as ne,W as $e,aA as qe,X as te,aM as Oe,J as Be,Z as ge,bp as We,bq as De,K as Ue,br as Y,_ as _e,n as Qe,t as Ke,av as Ge,bs as Ye,a4 as xe,bt as he,bu as le,bv as Xe,bw as oe,aa as Je,ab as Ze,bx as He}from"./index-CAxcut-o.js";import{F as et}from"./file-clock-Cylb04C3.js";import{C as tt}from"./chevron-left-BgIDBsj4.js";import{S as pe}from"./square-check-big-D2IPySgM.js";import{L as st}from"./library-Bl1jJv21.js";import{C as rt}from"./chart-no-axes-column-increasing-CPOdnxr2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=Te("Dices",[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]]),nt=({isOpen:m,onClose:R,onSave:l,initialData:c})=>{const[f,I]=r.useState(""),[j,x]=r.useState(""),[C,P]=r.useState("");r.useEffect(()=>{m&&(I((c==null?void 0:c.v1)||""),x((c==null?void 0:c.v2)||""),P((c==null?void 0:c.v3)||""))},[m,c]);const d=g=>{g.preventDefault(),f.trim()&&l({v1:f.trim().toLowerCase(),v2:j.trim(),v3:C.trim()})};return m?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:d,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:c?"Edit Verb":"Add New Verb"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Define the principal parts of an irregular verb."})]}),e.jsx("button",{type:"button",onClick:R,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsxs("main",{className:"p-8 grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 mb-1",children:"V1 (Base Form)"}),e.jsx("input",{value:f,onChange:g=>I(g.target.value),placeholder:"e.g., go",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 mb-1",children:"V2 (Past Simple)"}),e.jsx("input",{value:j,onChange:g=>x(g.target.value),placeholder:"e.g., went",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500 mb-1",children:"V3 (Past Participle)"}),e.jsx("input",{value:C,onChange:g=>P(g.target.value),placeholder:"e.g., gone",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium"})]})]}),!c&&e.jsx("div",{className:"px-8 pb-4 -mt-2",children:e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-indigo-50/50 text-indigo-900 rounded-lg border border-indigo-100",children:[e.jsx(Oe,{size:16,className:"shrink-0 mt-0.5 text-indigo-500"}),e.jsxs("p",{className:"text-xs font-medium",children:[e.jsx("strong",{children:"Pro-tip:"}),' You only need to enter the V1 (base form). You can use "Refine with AI" on the main table to fill in V2 & V3 for multiple verbs at once.']})]})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(be,{size:14})," Save Verb"]})})]})}):null},lt=({isOpen:m,onClose:R,onStart:l,verbs:c})=>{const[f,I]=r.useState(!1);if(!m)return null;const j=c.some(d=>d.lastTestResult==="fail"),x=c.length,C=c.filter(d=>d.lastTestResult==="pass").length,P=x-C;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Start Practice"}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["Choose a mode for the ",x," selected verb(s)."]})]}),e.jsx("button",{type:"button",onClick:R,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsxs("main",{className:"p-8 flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>I(!1),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${f?"text-neutral-500 hover:text-neutral-700":"bg-white text-neutral-900 shadow-sm"}`,children:["All (",x,")"]}),e.jsxs("button",{onClick:()=>I(!0),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${f?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:["Not Learned (",P,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>l("headword",f),className:"p-6 bg-neutral-50 border-2 border-neutral-200 rounded-2xl text-left hover:border-neutral-900 hover:bg-white hover:shadow-lg transition-all group",children:[e.jsx(Be,{size:24,className:"text-neutral-500 group-hover:text-neutral-900 mb-2"}),e.jsx("h4",{className:"font-bold",children:"Test from V1"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Recall V2 and V3 from the base form."})]}),e.jsxs("button",{onClick:()=>l("random",f),className:"p-6 bg-neutral-50 border-2 border-neutral-200 rounded-2xl text-left hover:border-neutral-900 hover:bg-white hover:shadow-lg transition-all group",children:[e.jsx(at,{size:24,className:"text-neutral-500 group-hover:text-neutral-900 mb-2"}),e.jsx("h4",{className:"font-bold",children:"Test Random Form"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Recall forms from a random V1/V2/V3."})]})]}),e.jsxs("div",{className:"p-6 bg-neutral-50 border-2 border-neutral-200 rounded-2xl text-left space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{size:24,className:"text-neutral-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:"Quick Review"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Rapidly mark verbs as known or forgotten."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>l("quick_forgot"),disabled:!j,className:"px-4 py-2 bg-white text-rose-700 rounded-lg font-bold text-xs flex items-center justify-center gap-2 hover:bg-rose-50 border border-rose-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{size:14}),e.jsx("span",{children:"Review Forgot"})]}),e.jsxs("button",{onClick:()=>l("quick_all"),className:"px-4 py-2 bg-white text-neutral-700 rounded-lg font-bold text-xs flex items-center justify-center gap-2 hover:bg-neutral-100 border border-neutral-200 transition-colors",children:[e.jsx(me,{size:14}),e.jsx("span",{children:"Review All"})]})]})]})]})]})})},ot=m=>{const{loading:R,verbs:l,totalCount:c,searchQuery:f,onSearchChange:I,page:j,pageSize:x,onPageSizeChange:C,totalPages:P,onPageChange:d,isModalOpen:g,editingVerb:M,selectedIds:w,setSelectedIds:D,isProcessing:y,libraryWords:O,onGlobalViewWord:A,onNew:z,onEdit:T,onDelete:p,onSave:k,onCloseModal:N,onBulkDelete:F,onAddToLibrary:B,onRefine:v,onPractice:h,onPracticeAll:S,isPracticeSetupOpen:U,onClosePracticeSetup:W,onStartPractice:L,isAddPanelOpen:_,addInput:Q,onAddInputChange:se,onBulkAdd:b,onQuickSetStatus:ee,practiceVerbs:E}=m,[$,X]=r.useState(null);return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight flex items-center gap-3",children:[e.jsx(et,{size:28})," Verb Library"]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"A dedicated space for reviewing irregular verb forms."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:S,disabled:c===0,className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-50 active:scale-95 uppercase tracking-widest shadow-sm disabled:opacity-50",children:[e.jsx(de,{size:16}),e.jsx("span",{children:"Practice All"})]}),e.jsxs("button",{onClick:z,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all hover:bg-neutral-800 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Me,{size:16}),e.jsx("span",{children:"New Verb"})]})]})]}),_&&e.jsxs("div",{className:"bg-white p-6 rounded-[2rem] border-2 border-neutral-100 shadow-xl space-y-4 animate-in slide-in-from-top-4 duration-300",children:[e.jsx("textarea",{autoFocus:!0,value:Q,onChange:o=>se(o.target.value),placeholder:"Enter base form verbs, separated by comma, semicolon, or newline...",className:"w-full h-24 p-4 bg-neutral-50 border border-neutral-200 rounded-2xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 focus:outline-none resize-y"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{onClick:()=>b(!1),disabled:y||!Q.trim(),className:"px-6 py-3 bg-neutral-100 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 hover:bg-neutral-200 transition-all disabled:opacity-50",children:[y?e.jsx(ae,{className:"animate-spin",size:14}):e.jsx(be,{size:14}),e.jsx("span",{children:"Add Verbs"})]}),e.jsxs("button",{onClick:()=>b(!0),disabled:y||!Q.trim(),className:"px-6 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center space-x-2 hover:bg-indigo-500 transition-all disabled:opacity-50 shadow-lg shadow-indigo-200",children:[y?e.jsx(ae,{className:"animate-spin",size:14}):e.jsx(me,{size:14}),e.jsx("span",{children:"Add with AI"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Fe,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:f,onChange:o=>I(o.target.value),placeholder:"Search verbs (V1, V2, V3)...",className:"w-full pl-10 pr-4 py-3 bg-white border border-neutral-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c>x&&e.jsxs("div",{className:"flex items-center gap-2 bg-white border border-neutral-200 rounded-xl px-2 py-1.5 shadow-sm shrink-0",children:[e.jsx("button",{disabled:j===0,onClick:()=>d(j-1),className:"p-1.5 rounded-lg text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(tt,{size:16})}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-500 uppercase tracking-widest px-2",children:["Page ",j+1," of ",P]}),e.jsx("button",{disabled:j>=P-1,onClick:()=>d(j+1),className:"p-1.5 rounded-lg text-neutral-400 hover:bg-neutral-100 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-transparent",children:e.jsx(Le,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white border border-neutral-200 rounded-xl px-3 py-1.5 shadow-sm shrink-0",children:[e.jsx("label",{htmlFor:"pageSizeSelect",className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Size"}),e.jsxs("select",{id:"pageSizeSelect",value:x,onChange:o=>C(Number(o.target.value)),className:"bg-transparent text-xs font-bold text-neutral-800 focus:outline-none border-none p-0",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})]}),R?e.jsx("div",{className:"flex items-center justify-center p-20",children:e.jsx(ae,{className:"animate-spin text-neutral-300",size:32})}):l.length===0?e.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2",children:f?"No verbs match your search.":"No irregular verbs added yet."}),!f&&e.jsx("p",{children:'Click "New Verb" to add verbs like "go", "went", "gone".'})]}):e.jsxs("div",{className:"bg-white rounded-[2rem] border border-neutral-200 shadow-sm overflow-hidden",children:[e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-neutral-50/50",children:[e.jsx("th",{className:"p-4 w-12",children:e.jsx("button",{onClick:()=>D(w.size===l.length&&l.length>0?new Set:new Set(l.map(o=>o.id))),className:"text-neutral-300 hover:text-neutral-900",children:w.size===l.length&&l.length>0?e.jsx(pe,{size:18,className:"text-neutral-900"}):e.jsx(ue,{size:18})})}),e.jsx("th",{className:"p-3 text-left text-[10px] font-black uppercase tracking-wider text-neutral-400",children:"V1 (Base)"}),e.jsx("th",{className:"p-3 text-left text-[10px] font-black uppercase tracking-wider text-neutral-400",children:"V2 (Past Simple)"}),e.jsx("th",{className:"p-3 text-left text-[10px] font-black uppercase tracking-wider text-neutral-400",children:"V3 (Past Participle)"}),e.jsx("th",{className:"p-3 text-right text-[10px] font-black uppercase tracking-wider text-neutral-400",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(o=>{const K=w.has(o.id),re=O.has(o.v1.toLowerCase()),J=new Set(o.lastTestIncorrectForms||[]);return e.jsxs("tr",{className:`border-t border-neutral-100 transition-colors ${K?"bg-blue-50/50":"hover:bg-neutral-50/80 group"}`,children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"w-4 h-4 flex items-center justify-center",children:[o.lastTestResult==="pass"&&o.lastTestTimestamp&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500",title:`Known (on ${new Date(o.lastTestTimestamp).toLocaleDateString()})`}),o.lastTestResult==="fail"&&o.lastTestTimestamp&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500",title:`Forgot (on ${new Date(o.lastTestTimestamp).toLocaleDateString()})`})]}),e.jsx("button",{onClick:()=>D(q=>{const G=new Set(q);return G.has(o.id)?G.delete(o.id):G.add(o.id),G}),children:K?e.jsx(pe,{size:18,className:"text-blue-600"}):e.jsx(ue,{size:18,className:"text-neutral-200 group-hover:text-neutral-400"})})]})}),e.jsx("td",{className:`p-3 font-bold text-sm ${J.has("v1")?"bg-rose-50/50":""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:o.v1}),re&&e.jsx("button",{onClick:()=>A(O.get(o.v1.toLowerCase())),title:"View in library",children:e.jsx(fe,{size:14,className:"text-neutral-400 hover:text-neutral-800"})})]})}),e.jsx("td",{className:`p-3 font-mono text-sm text-neutral-600 ${J.has("v2")?"bg-rose-50/50":""}`,children:o.v2||"..."}),e.jsx("td",{className:`p-3 font-mono text-sm text-neutral-600 ${J.has("v3")?"bg-rose-50/50":""}`,children:o.v3||"..."}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity focus-within:opacity-100",children:[e.jsx("button",{onClick:q=>{q.stopPropagation(),ee(o,"fail")},className:"p-2 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg",title:"Mark as Forgot",children:e.jsx(ce,{size:16})}),e.jsx("button",{onClick:q=>{q.stopPropagation(),ee(o,"pass")},className:"p-2 text-neutral-400 hover:text-green-600 hover:bg-green-50 rounded-lg",title:"Mark as Known",children:e.jsx(ie,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:q=>{q.stopPropagation(),T(o)},className:"p-2 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg",children:e.jsx(Ee,{size:14})}),e.jsx("button",{onClick:q=>{q.stopPropagation(),X(o)},className:"p-2 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg",children:e.jsx(ne,{size:14})})]})})]},o.id)})})]}),w.size>0&&e.jsxs("div",{className:"p-4 bg-neutral-50 border-t border-neutral-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs font-bold text-neutral-500",children:[w.size," selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:h,disabled:y,className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-blue-100 disabled:opacity-50",children:[e.jsx(de,{size:14}),e.jsx("span",{children:"Practice"})]}),e.jsxs("button",{onClick:v,disabled:y,className:"px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-indigo-100 disabled:opacity-50",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"Refine with AI"})]}),e.jsxs("button",{onClick:B,disabled:y,className:"px-4 py-2 bg-green-50 text-green-700 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-green-100 disabled:opacity-50",children:[e.jsx(st,{size:14}),e.jsx("span",{children:"Add to Library"})]}),e.jsxs("button",{onClick:F,disabled:y,className:"px-4 py-2 bg-rose-50 text-rose-700 rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-rose-100 disabled:opacity-50",children:[e.jsx(ne,{size:14}),e.jsx("span",{children:"Delete"})]})]})]})]}),e.jsx(nt,{isOpen:g,onClose:N,onSave:k,initialData:M}),e.jsx(lt,{isOpen:U,onClose:W,onStart:L,verbs:E}),e.jsx(qe,{isOpen:!!$,title:"Delete Verb?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',$==null?void 0:$.v1,'"']}),"? This is permanent."]}),confirmText:"Yes, Delete",isProcessing:!1,onConfirm:()=>{$&&p($),X(null)},onClose:()=>X(null),icon:e.jsx(ne,{size:40,className:"text-red-500"})})]})},it=({verbs:m,mode:R,currentIndex:l,practiceQueue:c,answers:f,onAnswerChange:I,onEnterPress:j,isAnswered:x,isFinished:C,isRevealed:P,sessionResults:d,onCheck:g,onNext:M,onQuickAnswer:w,onReveal:D,onFinish:y,onExit:O})=>{const A=r.useRef(null);r.useEffect(()=>{!C&&!x&&A.current&&A.current.focus()},[l,x,C]);const z=c[l],T=(p,k)=>{if(!z)return null;const{verb:N,promptType:F}=z,v=["v1","v2","v3"].find(L=>L!==F),h=p===v;if(F===p)return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:k}),e.jsx("div",{className:"w-full px-4 py-3 bg-neutral-100 border border-neutral-200 rounded-xl font-bold text-lg text-neutral-900",children:N[p]})]});const S=f[p]||"",U=(S||"").trim().toLowerCase()===N[p].toLowerCase();let W="bg-white focus:bg-white focus:border-neutral-900";return x&&(W=U?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:k}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:h?A:null,value:S,onChange:L=>I(p,L.target.value),disabled:x,onKeyDown:L=>{L.key==="Enter"&&!x&&j()},className:`w-full px-4 py-3 border-2 border-neutral-200 rounded-xl font-bold text-lg focus:ring-2 focus:ring-neutral-900 outline-none transition-colors ${W}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"}),x&&!U&&e.jsx("div",{className:"absolute top-full mt-1 text-xs font-bold text-green-600 animate-in fade-in slide-in-from-top-1",children:N[p]})]})]})};if(C){const p=d.filter(k=>k.result==="pass").length;return e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsx("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(rt,{size:20})," Session Recap"]}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["You got ",p," out of ",m.length," correct."]})]})}),e.jsx("main",{className:"p-6 overflow-y-auto space-y-2",children:m.map(k=>{const N=d.find(B=>B.verbId===k.id),F=(N==null?void 0:N.result)==="pass";return e.jsxs("div",{className:`p-3 rounded-lg flex items-center justify-between border ${F?"bg-green-50 border-green-100":"bg-red-50 border-red-100"}`,children:[e.jsxs("span",{className:"font-bold text-sm text-neutral-800",children:[k.v1," ",e.jsxs("span",{className:"text-neutral-400 font-normal",children:["â†’ ",k.v2,", ",k.v3]})]}),F?e.jsx(We,{className:"text-green-500",size:18}):e.jsx(De,{className:"text-red-500",size:18})]},k.id)})}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsx("button",{onClick:y,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-colors",children:"Finish"})})]})})}return R==="quick"&&z?e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-4 border-b border-neutral-100 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-amber-100 rounded-lg text-amber-600",children:e.jsx(ge,{size:16})}),e.jsx("h3",{className:"text-lg font-black text-neutral-900",children:"Quick Review"})]}),e.jsx("button",{type:"button",onClick:O,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:16})})]}),e.jsxs("main",{className:"p-8 flex flex-col items-center text-center space-y-6",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 bg-neutral-100 px-2 py-1 rounded-md",children:["Verb ",l+1," of ",c.length]}),e.jsxs("div",{className:"min-h-[100px] flex flex-col justify-center w-full",children:[e.jsx("h2",{className:"text-4xl font-black text-neutral-900 mb-2",children:z.verb.v1}),P?e.jsxs("p",{className:"text-xl font-mono text-neutral-600 animate-in fade-in slide-in-from-bottom-2 bg-neutral-50 py-2 rounded-xl border border-neutral-200",children:[z.verb.v2,", ",z.verb.v3]}):e.jsx("div",{className:"h-[46px] flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-2 bg-neutral-100 rounded-full animate-pulse"})})]})]}),e.jsxs("footer",{className:"px-6 pb-6 pt-2 flex items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>w("fail"),className:"flex-1 py-4 bg-white border-2 border-neutral-100 text-neutral-500 hover:text-red-600 hover:border-red-200 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1 transition-all active:scale-95 group",children:[e.jsx(ce,{size:20,className:"group-hover:rotate-180 transition-transform"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Forgot"})]}),e.jsxs("button",{onClick:D,disabled:P,className:"flex-1 py-4 bg-white border-2 border-neutral-100 text-neutral-500 hover:text-neutral-900 hover:border-neutral-300 hover:bg-neutral-50 rounded-2xl flex flex-col items-center justify-center space-y-1 transition-all active:scale-95 disabled:opacity-50 disabled:bg-neutral-50",children:[e.jsx(fe,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Show"})]}),e.jsxs("button",{onClick:()=>w("pass"),className:"flex-1 py-4 bg-white border-2 border-neutral-100 text-neutral-500 hover:text-green-600 hover:border-green-200 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1 transition-all active:scale-95 group",children:[e.jsx(ie,{size:20,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Known"})]})]})]})}):e.jsx("div",{className:"fixed inset-0 z-[210] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Verb Practice"}),e.jsxs("p",{className:"text-sm text-neutral-500 font-medium",children:["Verb ",l+1," of ",c.length]})]}),e.jsx("button",{type:"button",onClick:O,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(te,{size:20})})]}),e.jsxs("main",{className:"p-8 grid grid-cols-1 gap-6",children:[T("v1","V1 (Base Form)"),T("v2","V2 (Past Simple)"),T("v3","V3 (Past Participle)")]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:x?e.jsxs("button",{onClick:M,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-800 transition-all active:scale-95",children:[e.jsx("span",{children:l===c.length-1?"Finish":"Next"}),e.jsx(Ue,{size:14})]}):e.jsxs("button",{onClick:g,className:"px-6 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-indigo-500 transition-all active:scale-95 shadow-lg shadow-indigo-200",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Check Answer"})]})})]})})},ct=({verbs:m,mode:R,onComplete:l,onExit:c})=>{const[f,I]=r.useState(0),[j,x]=r.useState({}),[C,P]=r.useState(!1),[d,g]=r.useState([]),[M,w]=r.useState(!1),[D,y]=r.useState(!1),O=r.useRef(l),A=r.useRef(d),z=r.useRef(M);r.useEffect(()=>{O.current=l},[l]),r.useEffect(()=>{A.current=d,z.current=M},[d,M]),r.useEffect(()=>()=>{A.current.length>0&&!z.current&&O.current(A.current)},[]);const T=r.useMemo(()=>m.map(v=>{let h="v1";if(R==="random"){const S=["v1"];v.v2&&S.push("v2"),v.v3&&S.push("v3"),h=S[Math.floor(Math.random()*S.length)]}return{verb:v,promptType:h}}).sort(()=>Math.random()-.5),[m,R]),p=T[f],k=(v,h)=>{x(S=>({...S,[v]:h}))},N=()=>{if(!p)return;const{verb:v,promptType:h}=p,S=Y(j.v1||"")===Y(v.v1),U=Y(j.v2||"")===Y(v.v2),W=Y(j.v3||"")===Y(v.v3),L=(h!=="v1"?S:!0)&&(h!=="v2"?U:!0)&&(h!=="v3"?W:!0),_=[];h!=="v1"&&!S&&_.push("v1"),h!=="v2"&&!U&&_.push("v2"),h!=="v3"&&!W&&_.push("v3"),P(!0),g(Q=>[...Q,{verbId:v.id,result:L?"pass":"fail",incorrectForms:_}])},F=()=>{f<T.length-1?(I(f+1),x({}),P(!1),y(!1)):w(!0)},B=v=>{M||!p||(g(h=>[...h,{verbId:p.verb.id,result:v,incorrectForms:v==="fail"?["v1","v2","v3"]:[]}]),F())};return!p&&!M?null:e.jsx(it,{verbs:m,mode:R,currentIndex:f,practiceQueue:T,answers:j,onAnswerChange:k,onEnterPress:N,isAnswered:C,isFinished:M,isRevealed:D,sessionResults:d,onCheck:N,onNext:F,onQuickAnswer:B,onReveal:()=>y(!0),onFinish:()=>l(d),onExit:c})},mt=({user:m,onGlobalViewWord:R})=>{const[l,c]=r.useState([]),[f,I]=r.useState(!0),[j,x]=r.useState(!1),[C,P]=r.useState(null),[d,g]=r.useState(new Set),[M,w]=r.useState(!1),[D,y]=r.useState(!1),[O,A]=r.useState(!1),[z,T]=r.useState(null),[p,k]=r.useState("all"),[N,F]=r.useState(""),[B,v]=r.useState(0),[h,S]=r.useState(15),[U,W]=r.useState(!1),[L,_]=r.useState(""),[Q,se]=r.useState(new Map),{showToast:b}=_e(),ee=async t=>{const n=new Map,a=[];for(const s of t){const i=s.v1.toLowerCase().trim();if(n.has(i)){const u=n.get(i),V=!!(u.v2&&u.v3),Z=!!(s.v2&&s.v3);Z&&!V||Z===V&&s.updatedAt>u.updatedAt?(a.push(u.id),n.set(i,s)):a.push(s.id)}else n.set(i,s)}return a.length>0&&(console.log(`[IrregularVerbs] Cleaning up ${a.length} duplicates...`),he(a)),Array.from(n.values())},E=r.useCallback(async()=>{I(!0);const[t,n]=await Promise.all([Qe(m.id),Ke()]),a=await ee(t);c(a.sort((i,u)=>i.v1.localeCompare(u.v1)));const s=new Map;n.forEach(i=>s.set(i.word.toLowerCase(),i)),se(s),I(!1)},[m.id]);r.useEffect(()=>{E()},[E]);const $=r.useMemo(()=>{if(!N.trim())return l;const t=N.toLowerCase().trim();return l.filter(n=>n.v1.toLowerCase().includes(t)||n.v2.toLowerCase().includes(t)||n.v3.toLowerCase().includes(t))},[l,N]),X=r.useMemo(()=>{const t=B*h;return $.slice(t,t+h)},[$,B,h]),o=Math.ceil($.length/h);r.useEffect(()=>{v(0)},[N,h]);const K=r.useMemo(()=>l.filter(t=>d.has(t.id)&&(!t.v2||!t.v3)),[l,d]),re=()=>{W(t=>!t)},J=t=>{P(t),x(!0)},q=async t=>{await He(t.id),b(`Deleted "${t.v1}".`,"success"),await E(),g(n=>{const a=new Set(n);return a.delete(t.id),a})},G=async t=>{const n=Date.now(),a=t.v1.trim().toLowerCase();try{if(C){const s={...C,...t,v1:a,updatedAt:n};await le(s),b("Verb updated!","success")}else{const s={id:`iv-${n}`,userId:m.id,...t,v1:a,createdAt:n,updatedAt:n};await le(s),b("Verb created!","success")}x(!1),await E()}catch(s){b(s.message||"Failed to save verb.","error")}},ve=async()=>{d.size!==0&&(w(!0),await he(Array.from(d)),b(`Deleted ${d.size} verbs.`,"success"),g(new Set),await E(),w(!1))},je=async t=>{const n=xe(L);if(n.length!==0){w(!0);try{let a=[];const s=Date.now(),i=new Map(l.map(u=>[u.v1.toLowerCase(),u]));if(t){const u=await Xe(n);for(const V of u){const Z=V.v1.toLowerCase(),H=i.get(Z);if(H){const Ie=!H.v2||!H.v3,Ae=V.v2&&V.v3;if(Ie&&Ae){const Re={...H,v2:V.v2,v3:V.v3,updatedAt:s};a.push(Re)}}else a.push({id:`iv-${s}-${Math.random()}`,userId:m.id,v1:Z,v2:V.v2,v3:V.v3,createdAt:s,updatedAt:s})}}else n.forEach(u=>{const V=u.toLowerCase().trim();i.has(V)||(a.push({id:`iv-${s}-${Math.random()}`,userId:m.id,v1:V,v2:"",v3:"",createdAt:s,updatedAt:s}),i.set(V,a[a.length-1]))});a.length>0?(await oe(a),b(`Processed ${a.length} verb(s) (Added or Updated).`,"success"),_(""),W(!1),await E()):b("No new or better verbs to add.","info")}catch(a){b(a.message||"Failed to add verbs.","error")}finally{w(!1)}}},we=async()=>{if(d.size===0)return;w(!0);const t=l.filter(a=>d.has(a.id)),n=[];for(const a of t)if(!Q.has(a.v1.toLowerCase())){const s=Je(a.v1,"","","","",["irregular-verb"]);s.userId=m.id,s.isIrregular=!0,n.push(s)}n.length>0?(await Ze(n),b(`Added ${n.length} new verbs to your library.`,"success"),await E()):b("Selected verbs are already in your library.","info"),w(!1),g(new Set)},Ne=()=>{if(d.size===0){b("Please select verbs to refine.","info");return}if(K.length===0){b("All selected verbs are already complete.","info");return}y(!0)},ye=async t=>{y(!1),w(!0);try{if(!Array.isArray(t))throw new Error("AI response was not in the expected array format.");const n=new Map(t.map(s=>[s.v1.toLowerCase(),s])),a=K.map(s=>{const i=n.get(s.v1.toLowerCase());return i?{...s,v2:i.v2,v3:i.v3,updatedAt:Date.now()}:null}).filter(s=>s!==null);a.length>0?(await oe(a),b(`Refined ${a.length} verbs.`,"success"),await E()):b("AI could not refine the selected verbs.","info")}catch(n){b(n.message||"AI refinement failed.","error")}finally{w(!1),g(new Set)}},ke=()=>{if(d.size===0){b("Please select verbs to practice.","info");return}k(l.filter(t=>d.has(t.id))),A(!0)},Ce=()=>{if(l.length===0){b("There are no verbs to practice.","info");return}k("all"),A(!0)},Se=(t,n)=>{const a=p==="all"?l:p;let s=a,i="headword";if(n&&(s=s.filter(u=>u.lastTestResult!=="pass")),t==="quick_forgot"?(s=a.filter(u=>u.lastTestResult==="fail"),i="quick"):t==="quick_all"||t==="quick"?(s=a,i="quick"):i=t,s.length===0){b(t==="quick_forgot"?"No forgotten verbs in this selection.":n?"No unlearned verbs in this selection.":"No verbs available for this practice session.","info");return}T({verbs:s,mode:i}),A(!1)},Ve=async t=>{const n=Date.now(),s=l.map(i=>{const u=t.find(V=>V.verbId===i.id);return u?{...i,lastTestResult:u.result,lastTestTimestamp:n,lastTestIncorrectForms:u.result==="fail"?u.incorrectForms:void 0}:i}).filter(i=>t.some(u=>u.verbId===i.id));s.length>0&&await oe(s),T(null),g(new Set),E()},Pe=async(t,n)=>{const a=Date.now(),s={...t,lastTestResult:n,lastTestTimestamp:a,lastTestIncorrectForms:n==="fail"?["v2","v3"]:void 0};try{await le(s),c(i=>i.map(u=>u.id===t.id?s:u)),b(`Marked "${t.v1}" as ${n==="pass"?"Known":"Forgot"}.`,"success")}catch{b("Failed to update status.","error")}},ze=r.useMemo(()=>p==="all"?l:p,[p,l]);return e.jsxs(e.Fragment,{children:[e.jsx(ot,{loading:f,verbs:X,totalCount:$.length,searchQuery:N,onSearchChange:F,page:B,pageSize:h,onPageSizeChange:S,totalPages:o,onPageChange:v,isModalOpen:j,editingVerb:C,selectedIds:d,setSelectedIds:g,isProcessing:M,libraryWords:Q,onGlobalViewWord:R,onNew:re,onEdit:J,onDelete:q,onSave:G,onCloseModal:()=>x(!1),onBulkDelete:ve,onAddToLibrary:we,onRefine:Ne,onPractice:ke,onPracticeAll:Ce,isPracticeSetupOpen:O,onClosePracticeSetup:()=>A(!1),onStartPractice:Se,isAddPanelOpen:U,addInput:L,onAddInputChange:_,onBulkAdd:je,onQuickSetStatus:Pe,practiceVerbs:ze}),z&&e.jsx(ct,{verbs:z.verbs,mode:z.mode,onComplete:Ve,onExit:()=>T(null)}),D&&e.jsx(Ge,{isOpen:D,onClose:()=>y(!1),type:"REFINE_WORDS",title:"Refine Irregular Verbs",description:`Generating V2 & V3 for ${K.length} selected verb(s).`,initialData:{words:K.map(t=>t.v1).join("; ")},hidePrimaryInput:!0,onGeneratePrompt:t=>Ye(xe(t.words)),onJsonReceived:ye,actionLabel:"Update Verbs"})]})};export{mt as default};
