import{c as ge,r as a,bk as ue,J as xe,j as e,H as Ae,f as Te,I as Be,au as Je,Z as fe,g as oe,bG as pe,S as re,P as be,K as He,aA as le,ag as he,a0 as we,ax as Ne,k as je,Q as Ee,bs as Le,bH as Ke,bf as Se,aj as qe,b4 as Xe,bI as Qe,ak as Ze,bJ as et,bj as ae,a1 as tt,ai as st,l as at,t as nt,h as rt,aB as ot,aC as lt,aZ as it,bK as ct}from"./index-DtfRLDN6.js";import{R as dt,a as ut}from"./ResourceActions-BCqxjjaS.js";import{T as xt}from"./TagBrowser-CYKgK1CM.js";import{U as pt}from"./UniversalCard-CmT4W1nb.js";import{T as Re}from"./tag-Bz-2JhPt.js";import{a as ye,S as Ce}from"./split-O05QxZrY.js";import{H as me}from"./headphones-B4KvhfNo.js";import{g as Pe,a as ve}from"./getGenerateLessonTestPrompt-CmfFHSDH.js";import{C as ht}from"./chevron-left-CW2OtC6F.js";import{V as mt}from"./ViewMenu-cVAs2O8c.js";import{L as gt}from"./layout-grid-cpHMsMFr.js";import"./filter-C5YDlQL1.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=ge("FileDiff",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=ge("GalleryHorizontalEnd",[["path",{d:"M2 7v10",key:"a2pl2d"}],["path",{d:"M6 5v14",key:"1kq3d7"}],["rect",{width:"12",height:"18",x:"10",y:"3",rx:"2",key:"13i7bc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=ge("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);function wt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Word Intensity Scale" table.
    
    INPUT DATA (Existing Rows):
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the existing word(s). 
    2. Complete any missing columns (Softened, Neutral, Intensified) to create a perfect scale.
    3. Ensure the progression is logical (e.g., chilly -> cold -> freezing).
    4. For EACH word, assign a register if it is distinctly "academic" or "casual". Leave empty if neutral.
    5. **EXPANSION**: You MUST introduce 1-2 ADDITIONAL rows of related vocabulary that fit the theme of the provided words. Choose only natural, high-frequency words useful for IELTS.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Frozen Heat", "Moral Compass".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return in code block format a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "softened": [{"word": "string", "register": "academic" | "casual" | null}],
          "neutral": [{"word": "string", "register": "academic" | "casual" | null}],
          "intensified": [{"word": "string", "register": "academic" | "casual" | null}]
        }
      ]
    }
    `}function Nt(t){return`You are an expert English linguist and IELTS coach.
    
    TASK: Refine and complete a "Confusing Word Comparison" table.
    
    INPUT DATA:
    ${JSON.stringify(t)}

    INSTRUCTIONS:
    1. For each row provided, analyze the word(s). 
    2. If a nuance or example is missing, generate high-quality explanations.
    3. The "nuance" should explain exactly WHEN and WHY to use this word compared to its synonyms. Be sharp and IELTS-focused.
    4. Provide one natural, clear example sentence.
    5. **EXPANSION**: If the list is short, you MUST suggest 1-2 ADDITIONAL confusing words that belong to the same semantic group.

    METADATA RULES:
    1. **title**: Concept-driven, metaphorical title (MAX 5 WORDS). Think: "Visual Deception", "Mental Strain".
    2. **description**: Define the core conceptual boundary (MAX 15 WORDS). Sharp and precise. NO fluff.

    STRICT JSON OUTPUT FORMAT:
    Return in code block format a single JSON object:
    {
      "title": "string",
      "description": "string",
      "data": [
        {
          "word": "string",
          "nuance": "string (The sharp explanation of usage)",
          "example": "string (The example sentence)"
        }
      ]
    }
    `}const jt=t=>{const{type:u,title:f,setTitle:Y,description:v,setDescription:o,tagsInput:g,setTagsInput:w,content:P,setContent:y,listeningContent:h,setListeningContent:S,testContent:E,setTestContent:C,intensityRows:M,setIntensityRows:U,comparisonRows:L,setComparisonRows:J,isSaving:_,onSave:V,onPractice:K,onCancel:W,onOpenAiRefine:T}=t,[p,b]=a.useState("READING"),[R,m]=a.useState(!1);a.useEffect(()=>{b(u==="intensity"?"INTENSITY":u==="comparison"?"COMPARISON":"READING")},[u]);const k=a.useMemo(()=>{let d="";return p==="READING"?d=P:p==="LISTENING"?d=h:d=E,ue(d)},[P,h,E,p]);a.useEffect(()=>(window.handleLessonSpeak=(d,n)=>{xe(d,!1,n)},()=>{delete window.handleLessonSpeak}),[]);const I=()=>U([...M,{softened:[],neutral:[],intensified:[]}]),O=d=>U(M.filter((n,c)=>c!==d)),$=(d,n,c)=>{const l=[...M],r=c.split(/[;,]+/).map(i=>{const j=i.trim();if(!j)return null;const A=j.match(/\[(academic|casual)\]$/i);return A?{word:j.replace(A[0],"").trim(),register:A[1].toLowerCase()}:{word:j}}).filter(i=>i!==null);l[d][n]=r,U(l)},H=d=>d.map(n=>n.register?`${n.word} [${n.register}]`:n.word).join("; "),X=()=>J([...L,{word:"",nuance:"",example:""}]),Q=d=>J(L.filter((n,c)=>c!==d)),z=(d,n,c)=>{const l=[...L];l[d]={...l[d],[n]:c},J(l)};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:W,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(Ae,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:K,disabled:_,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Te,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:V,disabled:_,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[_?e.jsx(Be,{size:14,className:"animate-spin"}):e.jsx(Je,{size:14}),e.jsx("span",{children:_?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:f,onChange:d=>Y(d.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Re,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:g,onChange:d=>w(d.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 overflow-x-auto no-scrollbar",children:[u==="intensity"&&e.jsxs("button",{onClick:()=>{b("INTENSITY"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${p==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(fe,{size:12,className:"inline mr-1"})," Intensity"]}),u==="comparison"&&e.jsxs("button",{onClick:()=>{b("COMPARISON"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${p==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ye,{size:12,className:"inline mr-1"})," Contrast"]}),e.jsxs("button",{onClick:()=>{b("READING"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${p==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(oe,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{b("LISTENING"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${p==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Listening"]}),e.jsxs("button",{onClick:()=>{b("TEST"),m(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all shrink-0 ${p==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(pe,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p==="INTENSITY"&&e.jsxs("button",{onClick:()=>T("intensity"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-orange-50 border border-orange-100 hover:bg-orange-100 transition-all text-[10px] font-black uppercase text-orange-600 shadow-sm",children:[e.jsx(re,{size:12}),e.jsx("span",{children:"AI Refine"})]}),p==="COMPARISON"&&e.jsxs("button",{onClick:()=>T("comparison"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(re,{size:12}),e.jsx("span",{children:"AI Refine"})]}),(p==="READING"||p==="LISTENING"||p==="TEST")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>T(p==="READING"?"reading":p==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(re,{size:12}),e.jsx("span",{children:"AI Generate"})]}),e.jsxs("button",{onClick:()=>m(!R),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[R?e.jsx(be,{size:12}):e.jsx(He,{size:12}),e.jsx("span",{children:R?"Edit":"Preview"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[550px] relative overflow-hidden",children:p==="INTENSITY"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Intensity Rows"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Separate multiple words with semicolons. Use [academic] or [casual] tags for register."})]}),e.jsxs("div",{className:"space-y-4",children:[M.map((d,n)=>e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm grid grid-cols-1 md:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-blue-500 uppercase tracking-wider pl-1",children:"Softened"}),e.jsx("textarea",{value:H(d.softened),onChange:c=>$(n,"softened",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"chilly; cool..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Neutral"}),e.jsx("textarea",{value:H(d.neutral),onChange:c=>$(n,"neutral",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"hot; warm..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-orange-500 uppercase tracking-wider pl-1",children:"Intensified"}),e.jsx("textarea",{value:H(d.intensified),onChange:c=>$(n,"intensified",c.target.value),rows:2,className:"w-full p-2 bg-neutral-50 border border-neutral-100 rounded-xl text-xs font-bold focus:bg-white outline-none resize-none",placeholder:"scorching; boiling..."})]}),e.jsx("button",{onClick:()=>O(n),className:"p-2 text-neutral-300 hover:text-red-500 mt-5",children:e.jsx(le,{size:16})})]},n)),e.jsxs("button",{onClick:I,className:"w-full py-4 border-2 border-dashed border-neutral-200 rounded-[2rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(he,{size:16})," Add Scale Row"]})]})]}):p==="COMPARISON"?e.jsxs("div",{className:"absolute inset-0 p-6 overflow-y-auto space-y-4 bg-neutral-50/30 no-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Edit Contrast Pairs"}),e.jsx("p",{className:"text-[10px] text-neutral-500 italic",children:"Break down confusing word pairs with clear nuances and examples."})]}),e.jsxs("div",{className:"space-y-4",children:[L.map((d,n)=>e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-4 animate-in fade-in slide-in-from-top-2 relative group",children:[e.jsx("button",{onClick:()=>Q(n),className:"absolute top-4 right-4 p-2 text-neutral-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(le,{size:18})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 md:col-span-1",children:[e.jsx("label",{className:"text-[9px] font-black text-indigo-500 uppercase tracking-wider pl-1",children:"Target Word"}),e.jsx("input",{value:d.word,onChange:c=>z(n,"word",c.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-black focus:bg-white outline-none",placeholder:"e.g. Damage"})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Usage & Nuance"}),e.jsx("input",{value:d.nuance,onChange:c=>z(n,"nuance",c.target.value),className:"w-full px-4 py-2.5 bg-neutral-50 border border-neutral-100 rounded-xl text-sm font-medium focus:bg-white outline-none italic",placeholder:"When and why to use this..."})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-black text-neutral-400 uppercase tracking-wider pl-1",children:"Contextual Example"}),e.jsx("textarea",{value:d.example,onChange:c=>z(n,"example",c.target.value),rows:2,className:"w-full p-4 bg-neutral-50 border border-neutral-100 rounded-2xl text-sm font-bold focus:bg-white outline-none resize-none leading-relaxed",placeholder:"Write a clear example sentence..."})]})]},n)),e.jsxs("button",{onClick:X,className:"w-full py-6 border-2 border-dashed border-neutral-200 rounded-[2.5rem] text-neutral-400 font-black text-xs uppercase tracking-widest hover:border-indigo-300 hover:text-indigo-600 transition-all flex items-center justify-center gap-2 bg-white/50",children:[e.jsx(he,{size:20})," Add Comparison Pair"]})]})]}):R?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:k}}):e.jsx("textarea",{value:p==="READING"?P:p==="LISTENING"?h:E,onChange:d=>{p==="READING"?y(d.target.value):p==="LISTENING"?S(d.target.value):C(d.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${p.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},yt=({lesson:t,user:u,onSave:f,onPractice:Y,onCancel:v})=>{const[o,g]=a.useState(t.title),[w,P]=a.useState(t.description||""),[y,h]=a.useState(t.path||"/"),[S,E]=a.useState((t.tags||[]).join(", ")),[C,M]=a.useState(t.content),[U,L]=a.useState(t.listeningContent||""),[J,_]=a.useState(t.testContent||""),[V,K]=a.useState(t.intensityRows||[]),[W,T]=a.useState(t.comparisonRows||[]),[p,b]=a.useState(t.searchKeywords||[]),[R,m]=a.useState(!1),[k,I]=a.useState(null),{showToast:O}=we();a.useEffect(()=>{t.type==="comparison"&&(!t.comparisonRows||t.comparisonRows.length===0)&&t.id.startsWith("lesson-")&&I({format:"comparison"})},[]),a.useEffect(()=>{if(t.path===void 0&&t.tags){const n=t.tags||[],c=n.find(r=>r.startsWith("/")),l=n.filter(r=>!r.startsWith("/"));$(c||"/"),E(l.join(", "))}else h(t.path||"/"),E((t.tags||[]).join(", "))},[t]);const $=n=>h(n),H=()=>{const n=S.split(",").map(l=>l.trim()).filter(Boolean);let c=t.type||"essay";return V.length>0?c="intensity":W.length>0&&(c="comparison"),{...t,title:o,description:w,type:c,path:y.trim(),tags:n,content:C,listeningContent:U,testContent:J,intensityRows:V.length>0?V:void 0,comparisonRows:W.length>0?W:void 0,searchKeywords:p,updatedAt:Date.now()}},X=()=>{m(!0);const n=H();f(n)},Q=()=>{m(!0);const n=H();Y(n)},z=n=>{var A,G,B;const c=je(),l=c.audioCoach.activeCoach,r=c.audioCoach.coaches[l].name,i=(k==null?void 0:k.format)||n.format;if(i==="intensity")return wt(V);if(i==="comparison")return Nt(W);if(i==="test"){const q=S.split(",").map(te=>te.trim()).filter(Boolean);return Pe(o,C,n.request,q)}const j=!C&&(t.type==="comparison"||t.type==="intensity"||!t.id.includes("ai"));return ve({task:j?"create_reading":i==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:o,description:w,content:C,type:t.type,intensityRows:V,comparisonRows:W},topic:n.request||n.topic||o,userRequest:n.request,language:n.language||((A=u.lessonPreferences)==null?void 0:A.language)||"English",targetAudience:((G=u.lessonPreferences)==null?void 0:G.targetAudience)||"Adult",tone:n.tone||((B=u.lessonPreferences)==null?void 0:B.tone)||"professional_professor",coachName:r})},d=n=>{const{result:c}=n,l=c||n,r=k==null?void 0:k.format;if(r==="intensity"){const i=Array.isArray(l)?l:l.data;l.title&&g(l.title),l.description&&P(l.description),Array.isArray(i)&&(K(i),O("Intensity scale refined!","success"))}else if(r==="comparison"){const i=Array.isArray(l)?l:l.data;l.title&&g(l.title),l.description&&P(l.description),Array.isArray(i)&&(T(i),O("Comparison lab updated!","success"))}else r==="listening"?l.content&&(L(l.content),O("Listening script updated!","success")):r==="test"?l.content&&(_(l.content),O("Practice test generated!","success")):(l.title&&g(l.title),l.description&&P(l.description),l.content&&M(l.content),l.searchKeywords&&Array.isArray(l.searchKeywords)&&b(l.searchKeywords),!S.trim()&&l.tags&&l.tags.length>0&&E(l.tags.join(", ")),O("Lesson content refined!","success"));I(null)};return e.jsxs(e.Fragment,{children:[e.jsx(jt,{type:t.type||"essay",title:o,setTitle:g,description:w,setDescription:P,path:y,setPath:h,tagsInput:S,setTagsInput:E,content:C,setContent:M,listeningContent:U,setListeningContent:L,testContent:J,setTestContent:_,intensityRows:V,setIntensityRows:K,comparisonRows:W,setComparisonRows:T,isSaving:R,onSave:X,onPractice:Q,onCancel:v,onOpenAiRefine:n=>I({format:n||"reading"})}),k&&e.jsx(Ne,{isOpen:!!k,onClose:()=>I(null),type:"REFINE_UNIT",title:k.format==="intensity"?"Refine Intensity Scale":k.format==="comparison"?"Refine Word Contrast":C?"Refine Lesson":"Generate Lesson",description:k.format==="intensity"?"AI will complete the intensity scale.":k.format==="comparison"?"AI will complete the comparison pairs with nuances.":"Enter instructions for the AI.",initialData:{...u.lessonPreferences,format:k.format},onGeneratePrompt:z,onJsonReceived:d,actionLabel:"Apply Changes"})]})},vt=({register:t})=>{if(!t)return null;const u=t==="academic";return e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[8px] font-black uppercase border ml-1 ${u?"bg-purple-50 text-purple-700 border-purple-100":"bg-sky-50 text-sky-700 border-sky-100"}`,children:t})},de=({item:t})=>e.jsxs("div",{className:"flex items-center gap-1.5 group/item",children:[e.jsx("span",{className:"font-bold text-neutral-800",children:t.word}),e.jsx(vt,{register:t.register}),t.lastResult==="correct"&&e.jsx(Ee,{size:12,className:"text-emerald-500 shrink-0"}),t.lastResult==="incorrect"&&e.jsx(Le,{size:12,className:"text-rose-500 shrink-0"})]}),St=({rows:t,compact:u=!1})=>!t||t.length===0?null:e.jsx("div",{className:`bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm ${u?"scale-95 origin-top":""}`,children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-blue-500 tracking-[0.2em] w-1/3",children:"Softened"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-1/3",children:"Neutral"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-orange-500 tracking-[0.2em] w-1/3",children:"Intensified"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((f,Y)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top bg-blue-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[f.softened.map((v,o)=>e.jsx(de,{item:v},o)),f.softened.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[f.neutral.map((v,o)=>e.jsx(de,{item:v},o)),f.neutral.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})}),e.jsx("td",{className:"px-6 py-4 align-top bg-orange-50/10",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[f.intensified.map((v,o)=>e.jsx(de,{item:v},o)),f.intensified.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-300 italic",children:"..."})]})})]},Y))})]})}),Ct=({rows:t})=>!t||t.length===0?null:e.jsx("div",{className:"bg-white border border-neutral-200 rounded-[2rem] overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-indigo-600 tracking-[0.2em] w-[25%]",children:"Word"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[35%]",children:"Nuance"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-neutral-400 tracking-[0.2em] w-[40%]",children:"Example"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:t.map((u,f)=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-neutral-900 text-sm",children:u.word}),u.lastResult==="correct"&&e.jsx(Ee,{size:14,className:"text-emerald-500 shrink-0"}),u.lastResult==="incorrect"&&e.jsx(Le,{size:14,className:"text-rose-500 shrink-0"})]})}),e.jsx("td",{className:"px-6 py-4 align-top",children:e.jsx("p",{className:"text-xs text-neutral-600 font-medium italic leading-relaxed",children:u.nuance||"-"})}),e.jsx("td",{className:"px-6 py-4 align-top bg-neutral-50/20",children:e.jsx("p",{className:"text-xs text-neutral-800 leading-relaxed font-medium",children:u.example||"-"})})]},f))})]})}),kt=t=>{if(!t)return[];const u=t.split(`
`),f=[];let Y="Introduction",v=[];const o=()=>{(v.length>0||f.length===0&&Y==="Introduction")&&(v.join(`
`).trim()||f.length>0)&&f.push({title:Y,content:v.join(`
`)})};return u.forEach(g=>{const w=g.trim().match(/^(#{1,3})\s+(.+)/);w?(o(),Y=w[2].trim(),v=[g]):v.push(g)}),o(),f.length>1&&f[0].title==="Introduction"&&!f[0].content.trim()&&f.shift(),f.length>0?f:[{title:"Lesson",content:t}]},It=({lesson:t,onComplete:u,onEdit:f,onAddSound:Y,onAddTest:v})=>{const[o,g]=a.useState("READING"),[w,P]=a.useState("SCROLL"),[y,h]=a.useState(0),[S,E]=a.useState("IDLE"),[C,M]=a.useState(-1),[U,L]=a.useState(!1),[J,_]=a.useState(0),[V,K]=a.useState(!1),W=a.useRef(null),T=a.useRef(!1),p=a.useRef(new Map),b=a.useRef(new Map);a.useEffect(()=>{t.type==="intensity"&&t.intensityRows&&t.intensityRows.length>0?g("INTENSITY"):t.type==="comparison"&&t.comparisonRows&&t.comparisonRows.length>0&&g("COMPARISON")},[t]);const R=a.useMemo(()=>o==="READING"?t.content||"":o==="LISTENING"?t.listeningContent||"":t.testContent||"",[t,o]),m=a.useMemo(()=>kt(R),[R]),k=a.useMemo(()=>{const r=new Map;return m.forEach((i,j)=>{i.content.split(`
`).forEach(A=>{const G=A.trim().match(/^#{1,4}\s+(.+)/);if(!G)return;const B=G[1].trim().toLowerCase();B&&!r.has(B)&&r.set(B,j)})}),r},[m]);a.useEffect(()=>{h(0)},[o]),a.useEffect(()=>{const r=i=>{W.current&&!W.current.contains(i.target)&&K(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const I=a.useMemo(()=>{if(w==="SCROLL")return ue(R);{const r=m[y]||m[0];return ue((r==null?void 0:r.content)||"")}},[R,w,m,y]),O=a.useMemo(()=>{if(!t.listeningContent)return[];const r=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,i=[];let j;for(;(j=r.exec(t.listeningContent))!==null;)i.push({lang:j[1].toUpperCase()==="VN"?"vi":"en",text:j[2].replace(/\[.*?\]/g,"").trim()});return i},[t.listeningContent]),$=r=>{if(p.current.has(r))return Promise.resolve(p.current.get(r));if(b.current.has(r))return b.current.get(r);const i=O[r],j=et(i.text,i.lang).then(A=>(A&&(p.current.set(r,A),_(G=>G+1)),A));return b.current.set(r,j),j},H=async r=>{for(let i=r;i<O.length&&!T.current;i++)await $(i)},X=async()=>{S==="PAUSED"?(E("PLAYING"),T.current=!1):(T.current=!1,E("PLAYING"),H(0));const r=C===-1?0:C;for(let i=r;i<O.length&&!T.current;i++){M(i);const j=O[i];let A=p.current.get(i);if(A||(L(!0),A=await $(i),L(!1)),T.current)break;try{await xe(j.text,!0,j.lang,void 0,void 0,A||void 0)}catch(G){console.error("Speech playback error at index",i,G)}}T.current||(E("IDLE"),M(-1),_(0),p.current.clear(),b.current.clear())},Q=()=>{T.current=!0,Se(),E("IDLE"),M(-1),_(0),p.current.clear(),b.current.clear(),L(!1)};a.useEffect(()=>(window.handleLessonSpeak=(r,i)=>{xe(r,!1,i)},()=>{Q(),delete window.handleLessonSpeak}),[]),a.useEffect(()=>(window.resolveMarkdownNav=r=>{if(w!=="PAGED"||o==="INTENSITY"||o==="COMPARISON")return!1;const i=k.get(r);if(i===void 0)return!1;const j=()=>{const A=Array.from(document.querySelectorAll("h1, h2, h3, h4")),G=A.find(te=>(te.textContent||"").trim().toLowerCase()===r),B=A.find(te=>(te.textContent||"").trim().toLowerCase().includes(r)),q=G||B;q?q.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})};return i!==y?(h(i),requestAnimationFrame(()=>requestAnimationFrame(j))):j(),!0},()=>{delete window.resolveMarkdownNav}),[w,o,k,y]);const z=!!t.listeningContent,d=!!t.testContent,n=!!(t.intensityRows&&t.intensityRows.length>0),c=!!(t.comparisonRows&&t.comparisonRows.length>0),l=(n?1:0)+(c?1:0)+1+(z?1:0)+(d?1:0);return a.useEffect(()=>{w==="PAGED"&&window.scrollTo({top:0,behavior:"smooth"})},[y,w]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300 relative min-h-screen",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("button",{onClick:u,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(Ae,{size:14}),e.jsx("span",{children:"Back to Library"})]}),m.length>1&&o!=="INTENSITY"&&o!=="COMPARISON"&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>P("SCROLL"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${w==="SCROLL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Scroll View",children:[e.jsx(bt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Scroll"})]}),e.jsxs("button",{onClick:()=>P("PAGED"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${w==="PAGED"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Chapter View",children:[e.jsx(ft,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Paged"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:t.title}),l>1&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[n&&e.jsxs("button",{onClick:()=>g("INTENSITY"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="INTENSITY"?"bg-white text-orange-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(fe,{size:12,className:"inline mr-1"})," Scale"]}),c&&e.jsxs("button",{onClick:()=>g("COMPARISON"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="COMPARISON"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ye,{size:12,className:"inline mr-1"})," Contrast"]}),e.jsxs("button",{onClick:()=>g("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(oe,{size:12,className:"inline mr-1"})," Read"]}),z&&e.jsxs("button",{onClick:()=>g("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Listen"]}),d&&e.jsxs("button",{onClick:()=>g("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${o==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(pe,{size:12,className:"inline mr-1"})," Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o==="LISTENING"&&z&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[S==="PLAYING"?e.jsx("button",{onClick:()=>{E("PAUSED"),Se(),T.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(Ke,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:X,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(qe,{size:20,fill:"currentColor"})}),S!=="IDLE"&&e.jsx("button",{onClick:Q,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Xe,{size:20,fill:"currentColor"})})]}),e.jsx("button",{onClick:f,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(be,{size:20})})]})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px] relative",children:o==="INTENSITY"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Intensity Scale"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Analyze how word choices change based on emphasis and context."})]}),e.jsx(St,{rows:t.intensityRows||[]})]}):o==="COMPARISON"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-1 text-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Word Contrast"}),e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:"Deep dive into the nuances of confusing or similar vocabulary."})]}),e.jsx(Ct,{rows:t.comparisonRows||[]})]}):o==="TEST"&&!t.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(pe,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available."})]}):o==="LISTENING"&&!t.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(me,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:I}})}),w==="PAGED"&&o!=="INTENSITY"&&o!=="COMPARISON"&&m.length>1&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-neutral-200 flex items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsx("button",{onClick:()=>h(Math.max(0,y-1)),disabled:y===0,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(ht,{size:18})}),e.jsxs("div",{className:"relative px-2",ref:W,children:[e.jsxs("button",{onClick:()=>K(!V),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-2 py-1 transition-colors",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Chapter"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-sm text-neutral-900 max-w-[120px] truncate",children:m[y].title}),e.jsx(Qe,{size:12,className:"text-neutral-400"})]})]}),V&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-56 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-bottom",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:m.map((r,i)=>e.jsx("button",{onClick:()=>{h(i),K(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${i===y?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:r.title},i))})})]}),e.jsx("button",{onClick:()=>h(Math.min(m.length-1,y+1)),disabled:y===m.length-1,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(Ze,{size:18})})]})]})},At=({user:t,lesson:u,onComplete:f,onEdit:Y,onUpdate:v})=>{const[o,g]=a.useState(null),{showToast:w}=we(),P=h=>{var C,M,U;const S=je(),E=S.audioCoach.coaches[S.audioCoach.activeCoach].name;return h.format==="test"||o==="test"?Pe(u.title,u.content,h.request,u.tags):ve({task:"convert_to_listening",currentLesson:{title:u.title,description:u.description,content:u.content},userRequest:h.request,language:h.language||((C=t.lessonPreferences)==null?void 0:C.language)||"English",targetAudience:((M=t.lessonPreferences)==null?void 0:M.targetAudience)||"Adult",tone:h.tone||((U=t.lessonPreferences)==null?void 0:U.tone)||"professional_professor",coachName:E})},y=async h=>{const S=h.result||h,E=h.format||o,C={...u,updatedAt:Date.now()};E==="listening"?(C.listeningContent=S.content,w("Audio script added successfully!","success")):(C.testContent=S.content,w("Practice test added successfully!","success")),await ae(C),v&&v(C),g(null)};return e.jsxs(e.Fragment,{children:[e.jsx(It,{lesson:u,onComplete:f,onEdit:Y,onAddSound:()=>g("listening"),onAddTest:()=>g("test")}),o&&e.jsx(Ne,{isOpen:!!o,onClose:()=>g(null),type:"GENERATE_AUDIO_SCRIPT",title:o==="listening"?"Add Lesson Sound":"Add Practice Test",description:o==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...t.lessonPreferences,format:o},onGeneratePrompt:P,onJsonReceived:y,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},Tt={filterSchema:[],viewSchema:[]},Ie="vocab_pro_lesson_view_settings",Yt=({user:t,onStartSession:u,onNavigate:f,onUpdateUser:Y,initialLessonId:v,onConsumeLessonId:o,initialTag:g,onConsumeTag:w,initialType:P,onConsumeType:y})=>{const[h,S]=a.useState([]),[E,C]=a.useState([]),[M,U]=a.useState(!0),[L,J]=a.useState(null),[_,V]=a.useState(!1),[K,W]=a.useState(!1),[T,p]=a.useState(""),[b,R]=a.useState("ALL"),[m,k]=a.useState("all"),[I,O]=a.useState("all"),[$,H]=a.useState(()=>tt(Ie,{showDesc:!0,compact:!1})),[X,Q]=a.useState(0),[z,d]=a.useState(12),[n,c]=a.useState("list"),[l,r]=a.useState(null),[i,j]=a.useState(null),[A,G]=a.useState(!1),{showToast:B}=we();a.useEffect(()=>{st(Ie,$)},[$]);const q=a.useCallback(async()=>{U(!0);try{const[s,x]=await Promise.all([at(t.id),nt()]),F=[...s.map(N=>{let D="ESSAY";return N.type==="intensity"&&(D="INTENSITY"),N.type==="comparison"&&(D="COMPARISON"),{type:D,data:N,path:N.path,tags:N.tags,date:N.createdAt}})];S(F.sort((N,D)=>D.date-N.date)),C(x)}finally{U(!1)}},[t.id]);a.useEffect(()=>{q()},[q]),a.useEffect(()=>{if(v&&h.length>0){const s=h.find(x=>x.data.id===v);s&&(r(s.data),c("read_lesson"),o==null||o())}},[v,h,o]),a.useEffect(()=>{g&&(J(g),w==null||w())},[g,w]),a.useEffect(()=>{P&&(R(P),y==null||y())},[P,y]),a.useEffect(()=>{Q(0)},[L,T,b,m,I,z]);const te=a.useCallback(()=>{J(null),R("ALL"),k("all"),O("all")},[]),Oe=s=>{p(s),s.trim()&&te()},De=a.useMemo(()=>b!=="ALL"||m!=="all"||I!=="all",[b,m,I]),se=a.useMemo(()=>{const s=T.toLowerCase().trim();return h.filter(x=>{var F,N;if(s){const D=(x.data.title||"").toLowerCase().includes(s),ne=(x.data.description||"").toLowerCase().includes(s),ee=(x.data.searchKeywords||[]).some(ce=>(ce||"").toLowerCase().includes(s)),Z=(x.data.tags||[]).some(ce=>(ce||"").toLowerCase().includes(s));return!(!D&&!ne&&!ee&&!Z)}if(b!=="ALL"&&x.type!==b||m==="focused"&&!x.data.isFocused||I!=="all"&&x.data.focusColor!==I)return!1;if(L){if(L==="Uncategorized"){const D=x.path??(x.tags||[]).find(ee=>ee.startsWith("/"));if(D&&D!=="/")return!1}else if(!((F=x.path)!=null&&F.startsWith(L))&&!((N=x.tags)!=null&&N.includes(L)))return!1}return!0})},[h,L,T,b,m,I]),Me=a.useMemo(()=>{const s=X*z;return se.slice(s,s+z)},[se,X,z]),ze=async()=>{i&&(await ct(i.id),B("Lesson deleted.","success"),j(null),q())},Ge=async s=>{await ae(s),B("Lesson saved!","success"),c("list"),r(null),q()},ie=(s="essay")=>{const x={id:`lesson-${Date.now()}`,userId:t.id,topic1:"General",topic2:"General",type:s,title:s==="intensity"?"New Intensity Scale":s==="comparison"?"New Comparison Lab":"New Lesson",description:"",content:"",tags:[],intensityRows:s==="intensity"?[{softened:[],neutral:[],intensified:[]}]:void 0,comparisonRows:s==="comparison"?[{word:"",nuance:"",example:""}]:void 0,createdAt:Date.now(),updatedAt:Date.now()};r(x),c("edit_lesson")},Fe=async s=>{const{result:x,preferences:F}=s;JSON.stringify(t.lessonPreferences)!==JSON.stringify(F)&&await Y({...t,lessonPreferences:F});const N={id:`lesson-ai-${Date.now()}`,userId:t.id,title:x.title,description:x.description,content:x.content,tags:x.tags||[],searchKeywords:x.searchKeywords||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"General",topic2:"General"};await ae(N),B("Lesson created with AI!","success"),G(!1),r(N),c("read_lesson"),q()},_e=async(s,x)=>{const F={...s.data,focusColor:x||void 0,updatedAt:Date.now()};x||delete F.focusColor,await ae(F),S(N=>N.map(D=>D.data.id===s.data.id?{...D,data:{...D.data,focusColor:x||void 0,updatedAt:Date.now()}}:D))},$e=async s=>{const x={...s.data,isFocused:!s.data.isFocused,updatedAt:Date.now()};await ae(x),S(F=>F.map(N=>N.data.id===s.data.id?{...N,data:{...N.data,isFocused:!N.data.isFocused,updatedAt:Date.now()}}:N))},Ye=()=>{S(s=>[...s].sort(()=>Math.random()-.5)),B("Deck shuffled!","success")},We=[{label:"Topic Lesson (AI)",icon:re,onClick:()=>G(!0)},{label:"Intensity Scale",icon:fe,onClick:()=>ie("intensity")},{label:"Comparison Lab",icon:ye,onClick:()=>ie("comparison")},{label:"New Lesson (Manual)",icon:he,onClick:()=>ie("essay")}],Ue=s=>{const x=je(),F=x.audioCoach.activeCoach,N=x.audioCoach.coaches[F].name;return ve({topic:s.topic,language:s.language,targetAudience:s.targetAudience,tone:s.tone,format:s.format,coachName:N,task:"create_reading"})};if(n==="read_lesson"&&l)return e.jsx(At,{user:t,lesson:l,onComplete:()=>c("list"),onEdit:()=>c("edit_lesson"),onUpdate:s=>r(s)});if(n==="edit_lesson"&&l)return e.jsx(yt,{lesson:l,user:t,onSave:Ge,onPractice:s=>{r(s),c("read_lesson")},onCancel:()=>c("list")});const Ve=()=>e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[_&&e.jsx(xt,{items:h.map(s=>s.data),selectedTag:L,onSelectTag:J,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Re,{size:16})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:flex-1 max-w-sm",children:[e.jsx(it,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),e.jsx("input",{type:"text",value:T,onChange:s=>Oe(s.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-neutral-200 rounded-xl text-xs font-bold focus:outline-none focus:ring-2 focus:ring-neutral-900 transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto w-full sm:w-auto pb-2 sm:pb-0 no-scrollbar",children:[e.jsxs("button",{onClick:()=>R("ALL"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${b==="ALL"?"bg-neutral-900 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-neutral-900"}`,children:[e.jsx(gt,{size:12})," All"]}),e.jsxs("button",{onClick:()=>R("ESSAY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${b==="ESSAY"?"bg-emerald-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-emerald-600"}`,children:[e.jsx(oe,{size:12})," Lesson"]}),e.jsxs("button",{onClick:()=>R("INTENSITY"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${b==="INTENSITY"?"bg-orange-500 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-orange-500"}`,children:[e.jsx(Ce,{size:12})," Scale"]}),e.jsxs("button",{onClick:()=>R("COMPARISON"),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${b==="COMPARISON"?"bg-indigo-600 text-white shadow-md":"bg-white border border-neutral-200 text-neutral-500 hover:text-indigo-600"}`,children:[e.jsx(ke,{size:12})," Diff"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(dt,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),pagination:{page:X,totalPages:Math.ceil(se.length/z),onPageChange:Q,pageSize:z,onPageSizeChange:d,totalItems:se.length},aboveGrid:e.jsx(Ve,{}),config:Tt,activeFilters:{},onFilterChange:()=>{},isLoading:M,isEmpty:se.length===0,emptyMessage:"No items found matching your criteria.",actions:e.jsx(ut,{viewMenu:e.jsx(mt,{isOpen:K,setIsOpen:W,hasActiveFilters:De,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(ot,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>k(m==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${m==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:m==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>O(I==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>O(I==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>O(I==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${I==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:$.showDesc,onChange:()=>H(s=>({...s,showDesc:!s.showDesc}))},{label:"Compact",checked:$.compact,onChange:()=>H(s=>({...s,compact:!s.compact}))}]}),browseTags:{isOpen:_,onToggle:()=>{V(!_)}},addActions:We,extraActions:e.jsx(e.Fragment,{children:e.jsx("button",{onClick:Ye,disabled:se.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Shuffle Deck",children:e.jsx(rt,{size:16})})})}),children:()=>e.jsx(e.Fragment,{children:Me.map(s=>{const x=()=>{r(s.data),c("read_lesson")},F=()=>{r(s.data),c("edit_lesson")},N=()=>j(s.data),D=s.type==="INTENSITY",ne=s.type==="COMPARISON";let ee;return D?ee={label:"Scale",colorClass:"bg-orange-50 text-orange-700 border-orange-100",icon:Ce}:ne?ee={label:"Diff",colorClass:"bg-indigo-50 text-indigo-700 border-indigo-100",icon:ke}:ee={label:"Lesson",colorClass:"bg-emerald-50 text-emerald-700 border-emerald-100",icon:oe},e.jsx(pt,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:s.data.title}),tags:s.data.tags,badge:ee,compact:$.compact,onClick:x,focusColor:s.data.focusColor,onFocusChange:Z=>_e(s,Z),isFocused:s.data.isFocused,onToggleFocus:()=>$e(s),isCompleted:s.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z=>{Z.stopPropagation(),x()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(Te,{size:14})}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),F()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(be,{size:14})}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),N()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(le,{size:14})})]}),children:$.showDesc&&s.data.description&&e.jsx("p",{className:"line-clamp-3 mt-1",children:s.data.description})},`${s.type}-${s.data.id}`)})})}),e.jsx(lt,{isOpen:!!i,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:ze,onClose:()=>j(null),icon:e.jsx(le,{size:40,className:"text-red-500"})}),e.jsx(Ne,{isOpen:A,onClose:()=>G(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:t.lessonPreferences,onGeneratePrompt:Ue,onJsonReceived:Fe,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{Yt as LessonLibraryV2,Yt as default};
