import{c as ue,j as e,r as t,P as pt,I as Ee,b8 as De,Z as oe,X as Re,ak as Le,b9 as Oe,e as He,O as ke,a0 as be,ba as bt,bb as gt,Y as jt,x as ze,a2 as wt,ar as vt,bc as Ne,bd as Ke,t as lt,H as ce,b0 as We,V as Ae,J as pe,y as Ue,Q as ne,h as yt,aj as xe,w as we,aZ as Nt,a$ as kt,f as rt,b as Be,aT as nt,aB as St,be as Ct,b4 as It,a1 as qe,ai as Xe,bf as Te,bg as Et,k as Ze,aM as Je,aQ as Rt,bh as At,b2 as Mt,M as zt,aO as Ve,o as _e,bi as Tt,l as je,bj as it,ab as _t}from"./index-CJDIgYpE.js";import{C as Ft,S as $e,A as Pt,T as Dt,L as $t}from"./AvatarSelectionModal-DHgMTXCd.js";import{T as ot}from"./trophy-DolDTFz9.js";import{C as ct}from"./chevron-left-BvvTPoBO.js";import{B as Ge,K as Lt}from"./keyboard-MtTNGF4g.js";import{a as dt,S as Ot}from"./split-C5Px8Ejn.js";import{L as Ht}from"./layout-grid-B6-vXS-3.js";import{C as Wt}from"./columns-2-DF7z-sBU.js";import{S as Ut}from"./square-check-big-ByVv9raK.js";import{S as Bt}from"./server-BQWvnC0p.js";import"./palette-Zyiijx2E.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ue("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ue("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=ue("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ue("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=ue("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ue("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ue("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ue("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ue("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),ht=[{level:1,title:"Novice Soul"},{level:5,title:"Forest Kin"},{level:10,title:"Lamp Spirit"},{level:20,title:"Undead Walker"},{level:30,title:"Night Stalker"},{level:50,title:"Mystic Fairy"},{level:75,title:"Arcane Mage"},{level:100,title:"Shadow Ninja"},{level:150,title:"Heroic Savior"},{level:200,title:"Master Villain"},{level:500,title:"Royal Heir"},{level:999,title:"The Legend"}],Qt=a=>{let h="Novice Soul";for(const A of ht)if(a>=A.level)h=A.title;else break;return h},Kt=a=>a>=50?{frame:"bg-gradient-to-br from-amber-400 to-yellow-600",shadow:"shadow-amber-400/20"}:a>=30?{frame:"bg-gradient-to-br from-yellow-300 to-amber-400",shadow:"shadow-yellow-400/15"}:a>=20?{frame:"bg-gradient-to-br from-slate-300 to-gray-500",shadow:"shadow-slate-400/15"}:a>=10?{frame:"bg-gradient-to-br from-amber-600 to-yellow-800",shadow:"shadow-amber-600/15"}:{frame:"bg-gradient-to-br from-neutral-600 to-neutral-800",shadow:"shadow-neutral-500/10"},qt=({user:a,xpToNextLevel:h,onUpdateUser:A,isRecalculatingXp:d})=>{const[B,z]=t.useState(!1),J=h>0?Math.min(100,Math.max(0,a.experience/h*100)):0,f=a.peakLevel||a.level,G=f>0?Math.min(100,Math.max(0,a.level/f*100)):100,C=Kt(a.level),O=a.adventure,Y=Qt(a.level),V=ht.find(W=>W.level>a.level),X=async W=>{await A({...a,avatar:W}),z(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>z(!0),className:"group relative focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 rounded-2xl",children:e.jsxs("div",{className:`relative p-1 rounded-2xl ${C.frame} shadow-md ${C.shadow}`,children:[e.jsx("img",{src:a.avatar,className:"w-16 h-16 rounded-xl bg-white border-2 border-white/50 object-contain p-1",alt:"User Avatar"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(pt,{size:20,className:"text-white"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:a.name}),d&&e.jsx(Ee,{size:14,className:"animate-spin text-neutral-400"})]}),e.jsxs("p",{className:"text-xs font-bold text-neutral-400 flex items-center gap-1.5",children:[e.jsx(Ft,{size:12,className:"text-yellow-500"})," ",Y]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-[200px]",children:[e.jsxs("div",{className:"px-4 py-1 bg-neutral-900 text-white rounded-full font-black text-xs border-2 border-white shadow-sm text-center",children:["LVL ",a.level]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Experience"}),e.jsxs("span",{children:[a.experience," / ",h," XP"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${J}%`}})})]}),f>a.level&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-400 uppercase tracking-wider",children:[e.jsx("span",{children:"Level vs Peak"}),e.jsxs("span",{children:[a.level," / ",f," (Peak)"]})]}),e.jsx("div",{className:"h-2 w-full bg-neutral-100 rounded-full overflow-hidden border border-neutral-200/80 mt-1",children:e.jsx("div",{className:"h-full bg-amber-500",style:{width:`${G}%`}})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-neutral-50 border border-neutral-100 rounded-xl",title:"Unlock Keys & Fragments",children:[e.jsx(De,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-sm font-black text-neutral-900",children:(O==null?void 0:O.keys)??0}),e.jsx("div",{className:"w-px h-4 bg-neutral-200"}),e.jsx(xt,{size:14,className:"text-neutral-500"}),e.jsxs("span",{className:"text-sm font-black text-neutral-900",children:[(O==null?void 0:O.keyFragments)??0,"/3"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-100 rounded-xl",title:"Energy",children:[e.jsx(oe,{size:14,className:"text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-sm font-black text-yellow-900",children:(O==null?void 0:O.energy)??0})]})]}),V&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] font-bold text-neutral-400 animate-in fade-in",children:[e.jsxs("span",{children:["Reach LVL ",V.level," for: ",e.jsx("strong",{children:V.title})]}),e.jsx($e,{size:12,className:"text-amber-400"})]})]})]}),e.jsx(Pt,{isOpen:B,onClose:()=>z(!1),onSelectAvatar:X,currentUser:a})]})},Xt=({user:a,xpToNextLevel:h,onUpdateUser:A,isRecalculatingXp:d,children:B})=>e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(qt,{user:a,xpToNextLevel:h,onUpdateUser:A,isRecalculatingXp:d})}),e.jsx("div",{className:"flex-1 min-h-0 relative",children:B})]}),ie={rocket:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Rocket.png",planet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Ringed%20Planet.png",comet:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Comet.png",saucer:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Flying%20Saucer.png",star:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Star.png"},Zt=a=>{var h,A;switch(a.type){case"boss":return a.isDefeated?e.jsxs("div",{className:"relative grayscale opacity-60",children:[((h=a.boss_details)==null?void 0:h.image)||"üëπ",e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-0.5 border border-white",children:e.jsx(He,{size:10,className:"text-white"})})]}):((A=a.boss_details)==null?void 0:A.image)||"üëπ";case"treasure":return"üëë";case"key_fragment":return"üóùÔ∏è";default:return"‚òÖ"}},Jt=a=>a>=50?4:a>=25?3:a>=10?2:1,es=({user:a})=>{const h=Jt(a.peakLevel||1),A=h===1?"shadow-indigo-500/50":h===2?"shadow-cyan-500/60":h===3?"shadow-orange-500/70":"shadow-fuchsia-500/80";return e.jsxs("div",{className:"absolute -top-24 z-30 flex flex-col items-center animate-bounce duration-[2000ms]",children:[e.jsxs("div",{className:"relative w-24 h-24 transition-all duration-500",children:[e.jsx("img",{src:ie.rocket,alt:"Rocket",className:"w-full h-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] filter",style:{transform:"rotate(-45deg)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-[50%] -translate-y-[50%] w-8 h-8 rounded-full overflow-hidden border-2 border-white/50 shadow-inner bg-black/20",children:e.jsx("img",{src:a.avatar,className:"w-full h-full object-cover",alt:"Pilot"})}),e.jsx("div",{className:"absolute bottom-2 left-2 w-4 h-4 bg-orange-500 rounded-full blur-md animate-ping opacity-75"}),e.jsx("div",{className:"absolute bottom-3 left-3 w-2 h-2 bg-yellow-300 rounded-full blur-sm animate-pulse"})]}),e.jsxs("div",{className:`mt-1 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-wider text-white border border-white/20 shadow-lg ${A}`,children:["Lvl ",a.peakLevel||1]})]})},ts=({isOpen:a,onClose:h,defeatedBosses:A})=>a?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[80vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-amber-500 flex items-center gap-2",children:[e.jsx(ot,{size:20,fill:"currentColor"})," Hall of Fame"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Bosses conquered on your journey."})]}),e.jsx("button",{onClick:h,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsx("main",{className:"p-8 overflow-y-auto",children:A.length===0?e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx(mt,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-bold text-xs",children:"No bosses defeated yet."}),e.jsx("p",{className:"text-[10px] mt-1",children:"Defeat bosses at every 10th level!"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:A.map(d=>{var B,z;return e.jsxs("div",{className:"bg-neutral-50 border border-neutral-100 p-4 rounded-2xl flex flex-col items-center text-center shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-2 right-2 text-green-500",children:e.jsx(He,{size:16})}),e.jsx("div",{className:"text-5xl mb-3 grayscale group-hover:grayscale-0 transition-all duration-300 transform group-hover:scale-110",children:(B=d.boss_details)==null?void 0:B.image}),e.jsx("h4",{className:"text-sm font-black text-neutral-900 leading-tight",children:(z=d.boss_details)==null?void 0:z.name}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:["Level ",d.id+1]})]},d.id)})})})]})}):null,ss=({user:a,progress:h,onExit:A,map:d,onMove:B,onNodeClick:z,onOpenInventory:J,onAdminAction:f})=>{const C=d.length,O=5,[Y,V]=t.useState(0),[X,W]=t.useState(!1),_=Math.min(C-6,h.currentNodeIndex),x=d.filter(u=>u.type==="boss"&&u.isDefeated);t.useEffect(()=>{s()},[h.currentNodeIndex]);const s=()=>{let u=h.currentNodeIndex-Math.floor(3);u<0&&(u=0),u>_&&(u=_),V(u)},D=u=>{V(R=>{let F=u==="left"?R-1:R+1;return F<0&&(F=0),F>_&&(F=_),F})},E=C/6*100,q=-(Y*(100/C)),P=q*.3,$=50/C,g=d[h.currentNodeIndex],v=(g==null?void 0:g.type)==="boss"&&!(g!=null&&g.isDefeated);return e.jsxs("div",{className:"h-full flex flex-col bg-[#0f172a] text-white rounded-[2rem] overflow-hidden relative border-4 border-[#1e293b] shadow-2xl",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-[#1e1b4b] via-[#0f172a] to-[#020617]"}),e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 transition-transform duration-500 ease-out will-change-transform",style:{width:`${E}%`,transform:`translateX(${P}%)`},children:[e.jsx("img",{src:ie.planet,alt:"Planet",className:"absolute w-40 h-40 opacity-40 animate-float",style:{animationDuration:"8s",top:"5%",left:"2%"}}),e.jsx("img",{src:ie.comet,alt:"Comet",className:"absolute w-28 h-28 opacity-60 animate-pulse",style:{animationDuration:"3s",top:"50%",left:"5%"}}),e.jsx("img",{src:ie.saucer,alt:"Saucer",className:"absolute w-20 h-20 opacity-30 animate-bounce",style:{animationDuration:"6s",bottom:"10%",left:"7%"}}),e.jsx("div",{className:"absolute text-9xl opacity-10 animate-spin-slow",style:{top:"60%",left:"8%",animationDuration:"50s"},children:"üåÄ"}),e.jsx("div",{className:"absolute text-5xl opacity-50 animate-float",style:{top:"10%",left:"1%",animationDuration:"7s"},children:"üåö"}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-10 h-10 opacity-70 animate-pulse",style:{top:"15%",left:"9%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-6 h-6 opacity-50 animate-pulse",style:{animationDelay:"0.5s",bottom:"40%",left:"3%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{animationDelay:"1s",top:"75%",left:"6%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70 animate-pulse",style:{top:"25%",left:"1%"}}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"80%",left:"4%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-purple-300 rounded-full opacity-60 animate-ping",style:{animationDuration:"4s",bottom:"60%",left:"8.5%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-50 animate-pulse",style:{animationDelay:"1.5s",top:"5%",left:"7%"}}),e.jsx("div",{className:"absolute w-1 h-1 bg-white rounded-full opacity-70",style:{top:"90%",left:"9.5%"}}),e.jsx("img",{src:ie.planet,alt:"Planet",className:"absolute w-32 h-32 opacity-30 animate-float",style:{animationDuration:"7s",top:"15%",left:"22%"}}),e.jsx("img",{src:ie.star,alt:"Star",className:"absolute w-8 h-8 opacity-60 animate-pulse",style:{top:"70%",left:"35%"}}),e.jsx("div",{className:"absolute text-8xl opacity-10 animate-spin-slow",style:{top:"20%",left:"55%",animationDuration:"45s"},children:"üåÄ"}),e.jsx("img",{src:ie.comet,alt:"Comet",className:"absolute w-24 h-24 opacity-50",style:{bottom:"25%",left:"65%"}}),e.jsx("div",{className:"absolute text-6xl opacity-40 animate-float",style:{top:"60%",left:"80%",animationDuration:"9s"},children:"üåö"}),e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-blue-200 rounded-full opacity-50",style:{top:"10%",left:"95%"}})]})]}),e.jsxs("header",{className:"relative z-20 px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/20 rounded-lg",children:e.jsx(oe,{size:16,className:"text-yellow-400 fill-yellow-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Energy"}),e.jsxs("span",{className:"text-sm font-black leading-none",children:[h.energy," ",e.jsx("span",{className:"text-slate-500 text-[10px]",children:"/ 10"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-slate-700 shadow-lg",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg",children:e.jsx(De,{size:16,className:"text-amber-400 fill-amber-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Keys"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-black leading-none",children:h.keys}),e.jsx("div",{className:"h-3 w-px bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:12,className:"text-slate-400"}),e.jsxs("span",{className:"text-xs font-bold text-slate-300",children:[h.keyFragments,"/3"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>W(!0),className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-amber-400 hover:text-amber-300 rounded-xl transition-all active:scale-95 relative",title:"Hall of Fame",children:[e.jsx(ot,{size:18}),x.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-slate-800"})]}),e.jsx("button",{onClick:s,className:"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-95",title:"Jump to my location",children:e.jsx(Vt,{size:18})}),e.jsx("button",{onClick:J,className:"p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 rounded-xl transition-all active:scale-95",children:e.jsx(ut,{size:18})}),e.jsx("button",{onClick:A,className:"p-3 bg-slate-800 hover:bg-red-900/50 border border-slate-600 hover:border-red-500/50 text-slate-300 hover:text-red-200 rounded-xl transition-all active:scale-95",children:e.jsx(Re,{size:18})})]})]}),e.jsxs("main",{className:"flex-1 relative z-10 flex flex-col justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>D("left"),disabled:Y===0,className:"absolute left-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(ct,{size:32})}),e.jsx("button",{onClick:()=>D("right"),disabled:Y>=_,className:"absolute right-4 z-30 p-3 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full border border-white/10 text-white transition-all disabled:opacity-0 hover:scale-110 active:scale-95",children:e.jsx(Le,{size:32})}),e.jsx("div",{className:"w-full h-96 relative overflow-hidden",children:e.jsxs("div",{className:"absolute top-0 h-full flex items-center transition-transform duration-500 ease-out will-change-transform",style:{width:`${E}%`,transform:`translateX(${q}%)`},children:[e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1",style:{left:`${$}%`,right:`${$}%`},children:e.jsx("div",{className:"w-full h-full bg-slate-800 rounded-full relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 via-cyan-400 to-emerald-400 shadow-[0_0_15px_rgba(34,211,238,0.5)] transition-all duration-1000",style:{width:`${h.currentNodeIndex/(C-1)*100}%`}})})}),d.map((u,R)=>{if(R>h.currentNodeIndex+O)return e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-black shadow-[0_0_25px_rgba(0,0,0,1)] border border-slate-800 opacity-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-900 animate-pulse opacity-50"})}),e.jsx("div",{className:"absolute w-14 h-14 border border-slate-800/30 rounded-full animate-spin-slow pointer-events-none"})]})},u.id);const y=R===h.currentNodeIndex,l=R<h.currentNodeIndex,I=u.type==="boss",c=u.isDefeated;let p="w-16 h-16",i="bg-slate-800 border-slate-600 text-slate-500 cursor-default",n="",r="scale(1)";return y?(i="bg-slate-700 border-slate-500 text-slate-300",n="shadow-[0_0_30px_rgba(99,102,241,0.2)]"):l&&(i="bg-emerald-900/80 border-emerald-500 text-emerald-400",n="shadow-[0_0_15px_rgba(16,185,129,0.3)]"),I&&(p="w-24 h-24",c?(i="bg-slate-800 border-slate-600 text-slate-500",y&&(i="bg-slate-700 border-slate-500 text-slate-400")):(i="bg-red-950 border-red-600 text-red-500 cursor-pointer",n="shadow-[0_0_20px_rgba(220,38,38,0.4)]",y&&(i="bg-red-900 border-red-500 text-red-400 ring-4 ring-red-500/30",r="scale(1.1)"))),e.jsx("div",{className:"h-full flex items-center justify-center relative",style:{width:`${100/C}%`},children:e.jsxs("div",{className:"relative group flex flex-col items-center",children:[y&&e.jsx(es,{user:a}),y&&e.jsxs("div",{className:"absolute -top-32 bg-amber-500 text-black text-[10px] font-black py-1 px-3 rounded-full shadow-lg animate-bounce whitespace-nowrap z-40 mb-2",children:["HERE",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-amber-500"})]}),e.jsxs("div",{onClick:()=>z(u),className:`rounded-full border-[3px] flex items-center justify-center transition-all duration-300 z-10 relative ${p} ${i} ${n}`,style:{transform:r},children:[e.jsx("span",{className:"text-3xl font-black",children:Zt(u)}),I&&y&&!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/90 rounded-full opacity-0 hover:opacity-100 transition-opacity z-20 backdrop-blur-sm cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center animate-pulse",children:[e.jsx(Oe,{size:32,className:"text-white"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-red-200 tracking-widest mt-1",children:"Fight!"})]})})]}),!y&&e.jsx("div",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold ${l?"text-emerald-500":"text-slate-600"}`,children:R+1})]})},u.id)})]})})]}),a.isAdmin&&f&&e.jsxs("div",{className:"absolute bottom-28 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-yellow-500/30 shadow-2xl flex flex-wrap items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 border-r border-white/10 pr-3",children:[e.jsx(Dt,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Admin"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("add_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 10 Energy",children:[e.jsx(oe,{size:12})," +10"]}),e.jsx("button",{onClick:()=>f("remove_energy"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Energy",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/10 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("add_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add 1 Key",children:[e.jsx(De,{size:12})," +1"]}),e.jsx("button",{onClick:()=>f("remove_key"),className:"px-2 py-1 hover:bg-yellow-500/20 text-yellow-400 rounded-md text-[10px] font-bold",title:"Remove 1 Key",children:"-1"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-green-500/10 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>f("add_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add HP",children:"üß™+"}),e.jsx("button",{onClick:()=>f("remove_hp"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove HP",children:"-"}),e.jsx("button",{onClick:()=>f("add_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold flex items-center gap-1",title:"Add Fruit",children:"üçé+"}),e.jsx("button",{onClick:()=>f("remove_fruit"),className:"px-2 py-1 hover:bg-green-500/20 text-green-400 rounded-md text-[10px] font-bold",title:"Remove Fruit",children:"-"})]}),e.jsxs("button",{onClick:()=>f("pass_boss"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-[10px] font-bold uppercase transition-colors",children:[e.jsx(He,{size:12})," Pass Boss"]})]}),e.jsxs("footer",{className:"relative z-20 p-6 bg-gradient-to-t from-black/80 to-transparent flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"text-slate-400 text-xs font-medium tracking-wide",children:["Level ",h.currentNodeIndex+1," / ",d.length]}),e.jsxs("button",{onClick:B,disabled:h.energy<=0||v,className:"w-full max-w-sm py-4 bg-white hover:bg-slate-200 text-slate-900 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_25px_rgba(255,255,255,0.2)] transition-all active:scale-95 disabled:opacity-50 disabled:bg-slate-500 disabled:shadow-none flex items-center justify-center gap-3",children:[e.jsx("span",{children:"Move Forward"}),e.jsx(ke,{size:18})]})]}),e.jsx(ts,{isOpen:X,onClose:()=>W(!1),defeatedBosses:x})]})},ve=5,as=({user:a,boss:h,words:A,onVictory:d,onDefeat:B,onExit:z,onUpdateUser:J})=>{const{showToast:f}=be(),[G,C]=t.useState(h.hp),[O,Y]=t.useState(ve),[V,X]=t.useState(0),[W,_]=t.useState("idle"),[x,s]=t.useState("none"),[D,E]=t.useState("intro"),[q,P]=t.useState(600),[$,g]=t.useState(!1),[v,u]=t.useState(!1),R=t.useMemo(()=>[...A].sort(()=>Math.random()-.5),[A]),F=R[V%R.length];t.useEffect(()=>{if(D==="fighting"){const r=setInterval(()=>{P(j=>j<=1?(clearInterval(r),E("lost"),0):j-1)},1e3);return()=>clearInterval(r)}},[D]),t.useEffect(()=>{u(!1)},[V]);const y=async r=>{const j=r!==ze.FORGOT;E("animating"),j?(_("player-attacking"),setTimeout(()=>{_("idle"),s("boss-hit"),C(L=>Math.max(0,L-1)),setTimeout(()=>{s("none"),l()},800)},600)):(_("boss-attacking"),setTimeout(()=>{_("idle"),s("player-hit"),Y(L=>Math.max(0,L-1)),setTimeout(()=>{s("none"),l()},800)},600));const Q=j?ze.EASY:ze.FORGOT,o=wt(F,Q);o.lastReviewSessionType="boss_battle",await vt(o)},l=()=>{C(r=>(Y(j=>(r<=0?E("won"):j<=0?E("lost"):(X(Q=>Q+1),E("fighting")),j)),r))},I=r=>{const j=Math.floor(r/60),Q=r%60;return`${j}:${Q.toString().padStart(2,"0")}`},c=r=>{var j,Q;return!(r.type==="SPELLING"||r.type==="COLLOCATION_QUIZ"&&(((j=r.word.collocationsArray)==null?void 0:j.filter(L=>!L.isIgnored&&L.d))||[]).length>2||r.type==="PARAPHRASE_QUIZ"&&(((Q=r.word.paraphrases)==null?void 0:Q.filter(L=>!L.isIgnored))||[]).length>2)},p=async()=>{if((a.adventure.hpPotions||0)<=0)return;if(O>=ve){f("Health is already full!","info");return}Y(j=>Math.min(ve,j+1));const r={...a.adventure};r.hpPotions=(r.hpPotions||0)-1,await J({...a,adventure:r}),f("+1 HP Recovered!","success")},i=async()=>{if((a.adventure.wisdomFruits||0)<=0)return;if(v){f("Hint is already active!","info");return}u(!0);const r={...a.adventure};r.wisdomFruits=(r.wisdomFruits||0)-1,await J({...a,adventure:r}),f("Wisdom Fruit Used! Hint revealed.","success")},n=(a.adventure.hpPotions||0)>0||(a.adventure.wisdomFruits||0)>0;if(D==="intro")return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center text-white p-6 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:h.image}),e.jsx("h2",{className:"text-4xl font-black text-red-500 mb-2 uppercase tracking-widest",children:h.name}),e.jsx("div",{className:"bg-neutral-800/80 p-6 rounded-2xl border-l-4 border-red-500 max-w-md mb-8",children:e.jsxs("p",{className:"text-xl font-medium italic",children:['"',h.dialogueIntro,'"']})}),e.jsxs("button",{onClick:()=>E("fighting"),className:"px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black text-xl rounded-2xl uppercase tracking-widest shadow-[0_0_30px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-3",children:[e.jsx(Oe,{size:24})," FIGHT!"]})]});if(D==="won"||D==="lost"){const r=D==="won";return e.jsxs("div",{className:`absolute inset-0 z-[100] flex flex-col items-center justify-center text-white p-6 text-center animate-in zoom-in duration-500 ${r?"bg-emerald-900/90":"bg-neutral-900/95"}`,children:[e.jsx("div",{className:`text-8xl mb-6 ${!r&&"grayscale opacity-50"}`,children:r?"üèÜ":"üíÄ"}),e.jsx("h2",{className:`text-4xl font-black mb-2 ${r?"text-emerald-400":"text-red-500"}`,children:r?"VICTORY!":"DEFEATED"}),e.jsx("p",{className:"text-lg opacity-80 mb-8 italic",children:r?`&quot;${h.dialogueWin}&quot;`:`&quot;${h.dialogueLose}&quot;`}),e.jsx("button",{onClick:r?d:B,className:`px-8 py-3 font-bold rounded-xl transition-all ${r?"bg-white text-emerald-900 hover:scale-105":"bg-neutral-700 text-white hover:bg-neutral-600"}`,children:r?"Claim Reward":"Retreat & Study"})]})}return e.jsxs("div",{className:"absolute inset-0 z-[100] bg-slate-900 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-black opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center pt-2 pb-2 h-[25%] shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-center w-64 mb-2",children:[e.jsx("h3",{className:"text-red-500 font-black uppercase tracking-widest text-base drop-shadow-md",children:h.name}),e.jsx("div",{className:"w-full h-3 bg-slate-800 rounded-full border border-slate-600 mt-1 overflow-hidden relative shadow-inner",children:e.jsx("div",{className:"h-full bg-red-600 transition-all duration-300 ease-out",style:{width:`${G/h.hp*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(et,{size:14,className:"text-red-500 fill-red-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-black text-red-100 tracking-wider text-shadow-sm",children:[G," / ",h.hp," HP"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`text-7xl transition-transform duration-200 ${x==="boss-hit"?"scale-90 brightness-200 translate-x-2":"animate-float"}`,children:h.image}),x==="boss-hit"&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-yellow-500",children:"üí•"}),e.jsx("div",{className:"absolute -top-10 -right-10 text-4xl text-red-500 font-black animate-bounce",children:"-1"})]})]})]}),e.jsxs("div",{className:"flex-1 relative z-10 flex items-center justify-center w-full px-4 overflow-hidden",children:[W==="player-attacking"&&e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-up text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)] z-30 pointer-events-none",children:e.jsx(Yt,{className:"fill-cyan-400 rotate-45",size:48})}),W==="boss-attacking"&&e.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 text-6xl animate-fly-down text-red-500 drop-shadow-[0_0_15px_rgba(239,68,68,0.8)] z-30 pointer-events-none",children:e.jsx(mt,{className:"fill-red-900",size:48})}),e.jsxs("div",{className:`absolute top-4 right-4 flex items-center gap-2 px-4 py-2 rounded-xl font-mono font-black border-2 backdrop-blur-md z-20 transition-all duration-300 ${q<60?"bg-red-950/90 border-red-500 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.6)] animate-pulse scale-110":"bg-cyan-950/80 border-cyan-500/60 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]"}`,children:[e.jsx(bt,{size:18,className:q<60?"animate-spin":""}),e.jsx("span",{className:"text-lg tracking-widest",children:I(q)})]}),e.jsx("button",{onClick:()=>g(!$),className:`absolute top-4 left-4 p-3 rounded-xl border-2 backdrop-blur-md transition-all duration-300 z-20 group ${$?"bg-indigo-600 border-indigo-300 text-white shadow-[0_0_25px_rgba(99,102,241,0.6)] scale-105":"bg-indigo-950/80 border-indigo-500/60 text-indigo-300 shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:bg-indigo-900 hover:text-white hover:border-indigo-400 hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] active:scale-95"}`,title:"Items",children:e.jsxs("div",{className:"relative",children:[e.jsx(gt,{size:24}),n&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white animate-bounce shadow-sm"})]})}),$&&e.jsxs("div",{className:"absolute top-16 left-4 z-40 bg-slate-800/95 border border-slate-600 rounded-2xl p-4 shadow-xl backdrop-blur-md animate-in fade-in slide-in-from-left-4 w-64",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-3",children:"Battle Supplies"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üß™"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"HP Potion"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",a.adventure.hpPotions||0]})]})]}),e.jsx("button",{onClick:p,disabled:(a.adventure.hpPotions||0)<=0||O>=ve,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-2 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xl",children:"üçé"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-200",children:"Wisdom Fruit"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["x",a.adventure.wisdomFruits||0]})]})]}),e.jsx("button",{onClick:i,disabled:(a.adventure.wisdomFruits||0)<=0||v,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-[10px] font-bold uppercase disabled:opacity-50 disabled:bg-slate-700",children:"Use"})]})]})]}),D==="fighting"&&F?e.jsx("div",{className:"w-full max-w-md h-full max-h-[420px] z-10 animate-in zoom-in-95 duration-300 flex items-center",children:e.jsx(jt,{word:F,isQuickFire:!0,onComplete:y,onClose:z,isModal:!1,disableHints:!v,forceShowHint:v,challengeFilter:c,skipRecap:!0})}):D==="animating"?e.jsx("div",{className:"text-white/50 font-black text-sm uppercase tracking-widest animate-pulse",children:"Battle in progress..."}):null]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-end pb-6 h-[20%] shrink-0",children:[x==="player-hit"&&e.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 z-20 pointer-events-none",children:[e.jsx("div",{className:"text-6xl animate-ping opacity-75 absolute text-red-600",children:"üí•"}),e.jsx("div",{className:"absolute -top-16 text-4xl text-red-500 font-black animate-bounce",children:"-1 HP"})]}),e.jsx("div",{className:`relative mb-3 w-16 h-16 rounded-2xl overflow-hidden border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.5)] bg-indigo-900 transition-transform duration-100 ${x==="player-hit"?"animate-shake border-red-500":""}`,children:e.jsx("img",{src:a.avatar,alt:"Hero",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center gap-3 bg-slate-800/80 backdrop-blur-md px-6 py-2 rounded-2xl border border-slate-700",children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:ve}).map((r,j)=>e.jsx(et,{size:18,fill:j<O?"#ef4444":"none",className:`transition-all duration-300 ${j<O?"text-red-500 scale-100":"text-slate-600 scale-90"}`},j))})})]}),e.jsx("style",{children:`
                @keyframes flyUp {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(-40vh) scale(1.5); opacity: 1; }
                }
                @keyframes flyDown {
                    0% { transform: translateY(0) scale(0.5); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(40vh) scale(1.5); opacity: 1; }
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                .animate-fly-up { animation: flyUp 0.6s ease-in forwards; }
                .animate-fly-down { animation: flyDown 0.6s ease-in forwards; }
                .animate-shake { animation: shake 0.3s ease-in-out; }
                .animate-float { animation: float 3s ease-in-out infinite; }
            `})]})},ls=({isOpen:a,onClose:h,badges:A,hpPotions:d,wisdomFruits:B,onUseBadge:z})=>{if(!a)return null;const J=new Set(A.filter(G=>G!=="locked_chest")).size,f=Object.keys(Ne).filter(G=>G!=="locked_chest").length;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(ut,{size:20})," T√∫i ƒë·ªì"]})}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"V·∫≠t ph·∫©m & Huy hi·ªáu thu th·∫≠p ƒë∆∞·ª£c."})]}),e.jsx("button",{type:"button",onClick:h,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(Re,{size:20})})]}),e.jsxs("main",{className:"p-8 overflow-y-auto space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(Oe,{size:12})," Battle Supplies"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-50 border border-indigo-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üß™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-indigo-900",children:"HP Potion"}),e.jsxs("div",{className:"text-xs font-medium text-indigo-600",children:["Quantity: ",d]}),e.jsx("div",{className:"text-[9px] text-indigo-400 mt-0.5 font-bold uppercase tracking-wider",children:"Restores 1 HP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("div",{className:"text-3xl bg-white p-2 rounded-xl shadow-sm",children:"üçé"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-amber-900",children:"Wisdom Fruit"}),e.jsxs("div",{className:"text-xs font-medium text-amber-600",children:["Quantity: ",B]}),e.jsx("div",{className:"text-[9px] text-amber-400 mt-0.5 font-bold uppercase tracking-wider",children:"Reveals Hint"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 flex items-center gap-2",children:[e.jsx(oe,{size:12})," Badges & Loot"]}),e.jsxs("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-2 py-0.5 rounded-full",children:[J,"/",f]})]}),A.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 rounded-2xl text-neutral-400",children:[e.jsx("p",{className:"font-bold mb-2 text-xs",children:"Ch∆∞a c√≥ huy hi·ªáu."}),e.jsx("p",{className:"text-xs",children:"M·ªü R∆∞∆°ng ho·∫∑c ƒë√°nh Boss ƒë·ªÉ nh·∫≠n."})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-4",children:A.map((G,C)=>{const O=Ne[G];if(!O)return null;const Y=G==="locked_chest"||G==="lucky_dice";return e.jsxs("div",{className:"group relative flex flex-col items-center text-center gap-2",children:[e.jsxs("div",{className:"aspect-square w-full bg-neutral-100 rounded-2xl flex items-center justify-center p-4 border border-neutral-200 relative overflow-hidden",children:[e.jsx("span",{className:"text-4xl relative z-10",children:O.icon}),Y&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-700 leading-tight",children:O.name}),Y&&e.jsxs("button",{onClick:()=>z(G),className:"absolute inset-0 bg-black/80 rounded-2xl flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all backdrop-blur-[1px]",children:[e.jsx(Gt,{size:20}),e.jsx("span",{className:"text-[10px] font-bold mt-1 uppercase tracking-widest",children:"Use"})]})]},`${G}-${C}`)})})]})]})]})})},rs=30,ns=({onComplete:a,badge:h})=>{const[A]=t.useState(()=>Array.from({length:rs}).map(()=>({angle:Math.random()*360,distance:Math.random()*200+100,size:Math.random()*6+2,color:["#FFD700","#FFA500","#FF4500","#00FFFF","#FF00FF"][Math.floor(Math.random()*5)],delay:Math.random()*.5,duration:Math.random()*1+.5})));return h?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 animate-in fade-in duration-500 backdrop-blur-sm",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden flex items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"w-[200vw] h-[200vw] opacity-20 animate-spin-slow",style:{background:"conic-gradient(from 0deg, transparent 0deg, #FCD34D 20deg, transparent 40deg, #FCD34D 60deg, transparent 80deg, #FCD34D 100deg, transparent 120deg, #FCD34D 140deg, transparent 160deg, #FCD34D 180deg, transparent 200deg, #FCD34D 220deg, transparent 240deg, #FCD34D 260deg, transparent 280deg, #FCD34D 300deg, transparent 320deg, #FCD34D 340deg, transparent 360deg)",animationDuration:"20s"}}),e.jsx("div",{className:"absolute w-[150vw] h-[150vw] opacity-10 animate-spin-slow",style:{background:"conic-gradient(from 15deg, transparent 0deg, #FFFFFF 20deg, transparent 40deg, #FFFFFF 60deg, transparent 80deg, #FFFFFF 100deg, transparent 120deg, #FFFFFF 140deg, transparent 160deg, #FFFFFF 180deg, transparent 200deg, #FFFFFF 220deg, transparent 240deg, #FFFFFF 260deg, transparent 280deg, #FFFFFF 300deg, transparent 320deg, #FFFFFF 340deg, transparent 360deg)",animationDuration:"15s",animationDirection:"reverse"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:A.map((d,B)=>e.jsx("div",{className:"absolute rounded-full",style:{width:`${d.size}px`,height:`${d.size}px`,backgroundColor:d.color,transform:`rotate(${d.angle}deg) translate(${d.distance}px)`,opacity:0,animation:`explode ${d.duration}s ease-out ${d.delay}s forwards`}},B))})}),e.jsx("style",{children:`
                @keyframes explode {
                    0% { transform: rotate(var(--tw-rotate)) translate(0px); opacity: 1; }
                    100% { transform: rotate(var(--tw-rotate)) translate(var(--tw-translate-x)); opacity: 0; }
                }
                @keyframes spin-slow {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center text-center p-8 animate-in zoom-in-50 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-40 rounded-full animate-pulse"}),e.jsx("div",{className:"relative text-9xl animate-bounce",style:{animationDuration:"2s"},children:h.icon}),e.jsx($e,{className:"absolute -top-4 -right-8 text-yellow-300 w-12 h-12 animate-ping",style:{animationDuration:"3s"},fill:"currentColor"}),e.jsx($e,{className:"absolute top-1/2 -left-12 text-white w-8 h-8 animate-pulse",fill:"currentColor"})]}),e.jsxs("div",{className:"space-y-2 mb-10",children:[e.jsx("h2",{className:"text-sm font-black text-yellow-400 uppercase tracking-[0.3em] animate-in slide-in-from-bottom-4 duration-1000 delay-200",children:"Unlocked Reward"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-in slide-in-from-bottom-8 duration-1000 delay-300",children:h.name})]}),e.jsx("button",{onClick:a,className:"group relative px-10 py-4 bg-white hover:bg-yellow-50 text-neutral-900 rounded-full font-black text-sm uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-in fade-in duration-1000 delay-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:["Collect Reward ",e.jsx(Re,{size:16})]})})]})]}):null},Fe=({user:a,onExit:h,onUpdateUser:A})=>{const{showToast:d}=be(),[B,z]=t.useState(null),[J,f]=t.useState(!1),[G,C]=t.useState(null);t.useEffect(()=>{if(!a.adventure.map){const x=Ke(100);A({...a,adventure:{...a.adventure,map:x}})}},[]);const O=a.adventure.map||Ke(100),Y=async()=>{const x={...a.adventure};if(x.energy<=0){d("Not enough energy to move!","error");return}x.energy-=1;const s=x.currentNodeIndex+1;x.currentNodeIndex=s;const D=O[s];D&&(D.type==="standard"?(x.energyShards=(x.energyShards||0)+1,d("+1 Energy Shard ‚ö°","success",2e3)):D.type==="key_fragment"?(x.keyFragments=(x.keyFragments||0)+1,d("Picked up a Key Fragment üóùÔ∏è","success",3e3),x.keyFragments>=3&&(x.keyFragments-=3,x.keys=(x.keys||0)+1,d("‚ú® Key Fragments assembled into a Magic Key!","success",4e3))):D.type==="treasure"&&(x.badges=[...x.badges||[],"locked_chest"],d("Picked up a Locked Chest! üß∞ (Check Inventory)","success",3e3))),Math.random()<.15&&(Math.random()<.5?(x.hpPotions=(x.hpPotions||0)+1,d("You found an HP Potion! üß™","success",4e3)):(x.wisdomFruits=(x.wisdomFruits||0)+1,d("You found a Wisdom Fruit! üçé","success",4e3))),Math.random()<.2&&(x.badges=[...x.badges||[],"lucky_dice"],d("You found a Lucky Dice! üé≤","success",4e3)),await A({...a,adventure:x})},V=async x=>{if(x.id===a.adventure.currentNodeIndex&&x.type==="boss"){if(x.isDefeated){d("This boss has already been defeated.","info");return}const s=lt().filter(P=>P.userId===a.id);if(s.length===0){d("You have no words in your library to fight a boss. Add some words first!","error");return}const D=s.filter(P=>P.lastReview);D.length<20&&d("Warning: Boss ahead! You need more learned words to fight effectively. Other words from your library will be used.","info");let E=[...D].sort(()=>.5-Math.random());if(E.length<20){const P=new Set(E.map(v=>v.id)),$=s.filter(v=>!P.has(v.id)),g=20-E.length;E.push(...[...$].sort(()=>.5-Math.random()).slice(0,g))}E=E.slice(0,20);const q={...x.boss_details,hp:20};z({boss:q,words:E})}},X=async()=>{d("Boss defeated! +1 Key Fragment","success");const x={...a.adventure};if(x.keyFragments=(x.keyFragments||0)+1,x.keyFragments>=3&&(x.keyFragments-=3,x.keys=(x.keys||0)+1,d("Key Fragments assembled into a Magic Key!","success",4e3)),x.map){const s=[...x.map],D=x.currentNodeIndex;s[D]&&(s[D]={...s[D],isDefeated:!0}),x.map=s}await A({...a,adventure:x}),z(null)},W=async x=>{const s={...a.adventure};if(s.badges=s.badges||[],x==="locked_chest"){if((s.keys||0)<=0){d("You need a Magic Key üóùÔ∏è to open this chest!","error");return}s.keys-=1;const D=s.badges.indexOf("locked_chest");D>-1&&s.badges.splice(D,1);const E=Object.keys(Ne).filter(g=>g!=="locked_chest"&&g!=="lucky_dice"),q=s.badges||[],P=E.filter(g=>!q.includes(g));let $;P.length>0?$=P[Math.floor(Math.random()*P.length)]:$=E[Math.floor(Math.random()*E.length)],s.badges.push($),await A({...a,adventure:s}),C(Ne[$]),f(!1)}else if(x==="lucky_dice"){const D=s.badges.indexOf("lucky_dice");if(D>-1)s.badges.splice(D,1);else return;const E=Math.random();E<.2?(s.energy+=3,d("Dice rolled! +3 Energy ‚ö°","success",3e3)):E<.4?(s.keys=(s.keys||0)+1,d("Dice rolled! +1 Magic Key üóùÔ∏è","success",3e3)):E<.6?(s.badges.push("locked_chest"),d("Dice rolled! +1 Locked Chest üß∞","success",3e3)):E<.8?(s.hpPotions=(s.hpPotions||0)+1,d("Dice rolled! +1 HP Potion üß™","success",3e3)):(s.wisdomFruits=(s.wisdomFruits||0)+1,d("Dice rolled! +1 Wisdom Fruit üçé","success",3e3)),await A({...a,adventure:s})}else C(Ne[x])},_=async x=>{const s={...a.adventure};if(x==="add_energy")s.energy=(s.energy||0)+10,d("Admin: +10 Energy","success");else if(x==="remove_energy")s.energy=Math.max(0,(s.energy||0)-1),d("Admin: -1 Energy","info");else if(x==="add_key")s.keys=(s.keys||0)+1,d("Admin: +1 Key","success");else if(x==="remove_key")s.keys=Math.max(0,(s.keys||0)-1),d("Admin: -1 Key","info");else if(x==="add_hp")s.hpPotions=(s.hpPotions||0)+1,d("Admin: +1 HP Potion","success");else if(x==="remove_hp")s.hpPotions=Math.max(0,(s.hpPotions||0)-1),d("Admin: -1 HP Potion","info");else if(x==="add_fruit")s.wisdomFruits=(s.wisdomFruits||0)+1,d("Admin: +1 Wisdom Fruit","success");else if(x==="remove_fruit")s.wisdomFruits=Math.max(0,(s.wisdomFruits||0)-1),d("Admin: -1 Wisdom Fruit","info");else if(x==="pass_boss"){const D=O[s.currentNodeIndex];if(D&&D.type==="boss"){if(B){await X();return}if(d("Admin: Force Boss Victory","success"),s.keyFragments=(s.keyFragments||0)+1,s.keyFragments>=3&&(s.keyFragments-=3,s.keys=(s.keys||0)+1),s.map){const E=[...s.map],q=s.currentNodeIndex;E[q]&&(E[q]={...E[q],isDefeated:!0}),s.map=E}}else d("Not currently at a boss node.","info")}await A({...a,adventure:s})};return B?e.jsx(as,{user:a,boss:B.boss,words:B.words,onVictory:X,onDefeat:()=>{d("You were defeated. Study more and try again!","error"),z(null)},onExit:()=>z(null),onUpdateUser:A}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{user:a,progress:a.adventure,onExit:h,map:O,onMove:Y,onNodeClick:V,onOpenInventory:()=>f(!0),onAdminAction:_}),e.jsx(ls,{isOpen:J,onClose:()=>f(!1),badges:a.adventure.badges||[],onUseBadge:W,hpPotions:a.adventure.hpPotions||0,wisdomFruits:a.adventure.wisdomFruits||0}),G&&e.jsx(ns,{badge:G,onComplete:()=>C(null)})]})},Se=[{id:"i_ii",sym1:"…™",sym2:"iÀê",label:"Short i vs Long ee",example:"sit / seat",category:"VOWELS"},{id:"u_uu",sym1:" ä",sym2:"uÀê",label:"Short u vs Long oo",example:"full / fool",category:"VOWELS"},{id:"ae_e",sym1:"√¶",sym2:"e",label:"Short a vs Short e",example:"man / men",category:"VOWELS"},{id:"ae_v",sym1:"√¶",sym2:" å",label:"Short a vs Short u",example:"cat / cut",category:"VOWELS"},{id:"o_or",sym1:"…í",sym2:"…îÀê",label:"Short o vs Long aw",example:"cot / caught",category:"VOWELS"},{id:"er_or",sym1:"…úÀê",sym2:"…îÀê",label:"Stressed er vs aw",example:"bird / board",category:"VOWELS"},{id:"aa_ae",sym1:"…ëÀê",sym2:"√¶",label:"Long a vs Short a",example:"cart / cat",category:"VOWELS"},{id:"th_t",sym1:"Œ∏",sym2:"t",label:"Voiceless TH vs T",example:"think / tin",category:"CONSONANTS"},{id:"dh_d",sym1:"√∞",sym2:"d",label:"Voiced TH vs D",example:"this / dis",category:"CONSONANTS"},{id:"s_sh",sym1:"s",sym2:" É",label:"S vs SH",example:"see / she",category:"CONSONANTS"},{id:"ch_j",sym1:"t É",sym2:"d í",label:"CH vs J",example:"cheap / jeep",category:"CONSONANTS"},{id:"f_v",sym1:"f",sym2:"v",label:"F vs V",example:"fan / van",category:"CONSONANTS"},{id:"b_p",sym1:"b",sym2:"p",label:"B vs P",example:"bat / pat",category:"CONSONANTS"},{id:"k_g",sym1:"k",sym2:"g",label:"K vs G",example:"coat / goat",category:"CONSONANTS"},{id:"s_z",sym1:"s",sym2:"z",label:"S vs Z",example:"rice / rise",category:"CONSONANTS"},{id:"t_d_ed",sym1:"t",sym2:"d",label:"Past tense -ed",example:"worked / played",category:"CONSONANTS"},{id:"ng_n",sym1:"≈ã",sym2:"n",label:"Final NG vs N",example:"sing / sin",category:"CONSONANTS"},{id:"r_l",sym1:"r",sym2:"l",label:"R vs L",example:"right / light",category:"CONSONANTS"},{id:"ay_ae",sym1:"e…™",sym2:"√¶",label:"Diphthong ay vs Short a",example:"face / fat",category:"DIPHTHONGS"},{id:"ai_ii",sym1:"a…™",sym2:"iÀê",label:"Diphthong ai vs Long ee",example:"time / team",category:"DIPHTHONGS"},{id:"oh_aw",sym1:"…ô ä",sym2:"…îÀê",label:"Diphthong oh vs aw",example:"go / saw",category:"DIPHTHONGS"},{id:"ear_ee",sym1:"…™…ô",sym2:"iÀê",label:"ear vs ee",example:"here / he",category:"DIPHTHONGS"},{id:"air_ae",sym1:"e…ô",sym2:"√¶",label:"air vs short a",example:"hair / hat",category:"DIPHTHONGS"}],is=({words:a,onComplete:h,onExit:A,onBulkUpdate:d})=>{const[B,z]=t.useState("SETUP"),[J,f]=t.useState("MASTER"),[G,C]=t.useState(null),[O,Y]=t.useState([]),[V,X]=t.useState(0),[W,_]=t.useState(null),x=t.useRef(new Map),s=(g,v)=>{if(!g)return!1;(v==="t"||v==="d")&&(g.includes("t É")||g.includes("d í"));const u=v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let R;return v==="d"?R=new RegExp(`${u}(?! í)`):v==="t"?R=new RegExp(`${u}(?! É)`):v===" É"?R=new RegExp(`(?<!t)${u}`):v===" í"?R=new RegExp(`(?<!d)${u}`):v==="…™"?R=new RegExp(`(?<![ae…î])${u}(?!…ô)`):v===" ä"?R=new RegExp(`(?<![a…ô])${u}`):v==="e"?R=new RegExp(`${u}(?!…™|…ô)`):v==="…ô"?R=new RegExp(`(?<![…™ äe])${u}(?! ä)`):R=new RegExp(u),R.test(g)},D=t.useMemo(()=>{const g=new Map,v=a.filter(u=>u.ipaUs&&u.ipaUs.length>2);return Se.forEach(u=>{const R=v.filter(I=>s(I.ipaUs,u.sym1)||s(I.ipaUs,u.sym2)),F=R.length,y=R.filter(I=>{const c=`IPA_SORTER:${u.id}`;return I.lastTestResults&&I.lastTestResults[c]===!0}).length,l=R.filter(I=>{const c=`IPA_SORTER:${u.id}`;return!I.lastTestResults||I.lastTestResults[c]!==!0}).length;g.set(u.id,{total:F,correct:y,availableForMaster:l})}),g},[a]),E=g=>{let u=a.filter(y=>y.ipaUs&&y.ipaUs.length>2).filter(y=>s(y.ipaUs,g.sym1)||s(y.ipaUs,g.sym2));if(J==="MASTER"&&(u=u.filter(y=>{const l=`IPA_SORTER:${g.id}`;return!y.lastTestResults||y.lastTestResults[l]!==!0})),u.length<3){alert(`Not enough words found for this mode (${u.length}). Try 'Review All' or add more words.`);return}const R=[],F=u.sort(()=>Math.random()-.5).slice(0,15);for(const y of F){const l=s(y.ipaUs,g.sym1),I=s(y.ipaUs,g.sym2),c=l&&I?Math.random()>.5?g.sym1:g.sym2:l?g.sym1:g.sym2,p=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let i;c==="d"?i=new RegExp(`${p}(?! í)`,"g"):c==="t"?i=new RegExp(`${p}(?! É)`,"g"):c===" É"?i=new RegExp(`(?<!t)${p}`,"g"):c===" í"?i=new RegExp(`(?<!d)${p}`,"g"):c==="…™"?i=new RegExp(`(?<![ae…î])${p}(?!…ô)`,"g"):c==="e"?i=new RegExp(`${p}(?!…™|…ô)`,"g"):i=new RegExp(p,"g");const n=y.ipaUs.replace(i,"___");R.push({id:y.id,wordObj:y,word:y.word,ipa:y.ipaUs,maskedIpa:n,targetSymbol:c})}Y(R),C(g),X(0),z("PLAYING")},q=g=>{const v=O[0];if(!v||W||!G)return;const u=v.targetSymbol===g;_({symbol:g,correct:u});const R=u?V+10:Math.max(0,V-5);X(R);const F=`IPA_SORTER:${G.id}`,y={...v.wordObj};y.lastTestResults||(y.lastTestResults={}),y.lastTestResults[F]=u,y.updatedAt=Date.now(),x.current.set(y.id,y),setTimeout(()=>{const l=O.slice(1);Y(l),_(null),l.length===0&&(d(Array.from(x.current.values())),x.current.clear(),h(R))},800)},P=()=>{x.current.size>0&&(d(Array.from(x.current.values())),x.current.clear()),B==="PLAYING"?z("SETUP"):A()};if(B==="SETUP"){const g=I=>{const c=D.get(I.id)||{total:0,correct:0,availableForMaster:0},p=c.total>=3,i=J==="ALL"?p:c.availableForMaster>=3,n=c.total>0?c.correct/c.total*100:0;let r;return p?n>=80?r="text-emerald-700 bg-emerald-100 border-emerald-200":n>0?r="text-amber-700 bg-amber-100 border-amber-200":r="text-rose-700 bg-rose-100 border-rose-200":r="text-neutral-300 bg-neutral-50 border-neutral-100",e.jsxs("button",{onClick:()=>i&&E(I),disabled:!i,className:`
                        w-full flex flex-col gap-1 p-3 rounded-xl border transition-all text-left relative overflow-hidden group shrink-0
                        ${i?"bg-white border-neutral-100 hover:border-indigo-400 hover:bg-indigo-50/30 cursor-pointer shadow-sm":"bg-neutral-50 border-neutral-100 opacity-60 cursor-not-allowed"}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-black text-neutral-800 font-serif",children:["/",I.sym1,"/ vs /",I.sym2,"/"]}),!p&&e.jsx($t,{size:10,className:"text-neutral-400"})]}),p&&e.jsxs("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-full border ${r}`,children:[c.correct,"/",c.total]})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 font-medium truncate",children:I.example})]},I.id)},v=Se.filter(I=>I.category==="VOWELS"),u=Se.filter(I=>I.category==="DIPHTHONGS"),R=Se.filter(I=>I.category==="CONSONANTS"),F=Math.ceil(R.length/2),y=R.slice(0,F),l=R.slice(F);return e.jsxs("div",{className:"flex flex-col h-full relative p-6 bg-white animate-in fade-in",children:[e.jsxs("header",{className:"flex flex-col gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Back"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-black text-neutral-900 tracking-tight",children:"Phonetic Accuracy"}),e.jsx("p",{className:"text-[10px] text-neutral-500 font-bold uppercase tracking-widest",children:"Select a pair to practice"})]}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 self-center",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>f("MASTER"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="MASTER"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(oe,{size:10,fill:J==="MASTER"?"currentColor":"none"})," Master It"]}),e.jsxs("button",{onClick:()=>f("ALL"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${J==="ALL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,children:[e.jsx(We,{size:10})," Review All"]})]}),e.jsx("p",{className:"text-[9px] text-neutral-400 font-bold",children:J==="MASTER"?"Focus on unmastered words":"Practice with full library"})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-indigo-400 tracking-widest px-1 border-b border-neutral-100",children:"Vowels"}),e.jsx("div",{className:"flex flex-col gap-2",children:v.map(g)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:y.map(g)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-emerald-400 tracking-widest px-1 border-b border-neutral-100 md:text-transparent select-none",children:"Consonants"}),e.jsx("div",{className:"flex flex-col gap-2",children:l.map(g)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"sticky top-0 bg-white z-10 py-2 text-[9px] font-black uppercase text-amber-400 tracking-widest px-1 border-b border-neutral-100",children:"Diphthongs"}),e.jsx("div",{className:"flex flex-col gap-2",children:u.map(g)})]})]})})]})}const $=O[0];return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 shrink-0",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Pairs"]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:V}),e.jsx("div",{className:"text-neutral-400 font-bold text-sm uppercase tracking-widest",children:"IPA Sorter"})]}),G&&e.jsx("div",{className:"text-center mb-6 animate-in slide-in-from-top-2",children:e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold border border-indigo-100",children:[G.label," ",e.jsx("span",{className:"opacity-50 mx-1",children:"‚Ä¢"})," ",e.jsx("span",{className:"italic font-normal",children:G.example})]})}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center relative",children:$?e.jsxs("div",{className:"bg-white px-10 py-16 rounded-[2rem] shadow-2xl border border-neutral-200 text-center space-y-4 animate-in zoom-in duration-300 w-full max-w-sm mx-auto z-10 hover:scale-105 transition-transform",children:[e.jsx("h3",{className:"text-4xl font-black text-neutral-900",children:$.word}),e.jsxs("button",{onClick:()=>pe($.word,!1,"en"),className:"mx-auto flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-50 text-indigo-600 border border-indigo-100 hover:bg-indigo-100 transition-colors text-xs font-black uppercase tracking-wider",title:"Speak this word",children:[e.jsx(Ae,{size:14}),"Speak"]}),e.jsx("div",{className:"inline-block bg-neutral-100 px-6 py-3 rounded-xl border border-neutral-200",children:e.jsx("p",{className:"text-xl font-mono font-medium text-neutral-500 tracking-wide",children:$.maskedIpa.split("___").map((g,v,u)=>e.jsxs(Ue.Fragment,{children:[g,v<u.length-1&&e.jsx("span",{className:"text-rose-500 font-bold bg-rose-50 px-1 rounded mx-0.5",children:"?"})]},v))})}),e.jsx("p",{className:"text-neutral-400 font-bold text-xs uppercase tracking-widest pt-2",children:"Which sound fits?"})]}):e.jsxs("div",{className:"text-neutral-300 font-black text-xl flex flex-col items-center gap-2",children:[e.jsx(ne,{size:40,className:"text-green-500"}),e.jsx("span",{children:"Session Complete"})]})}),e.jsx("div",{className:"h-40 grid grid-cols-2 gap-6 mt-4 shrink-0 max-w-lg mx-auto w-full",children:[G.sym1,G.sym2].map((g,v)=>{const u=W&&W.symbol===g,R=u&&W.correct,F=u&&!W.correct;let y="border-2 rounded-[2.5rem] flex flex-col items-center justify-center transition-all group p-4 shadow-sm",l="text-neutral-400 group-hover:text-indigo-400";return R?(y+=" bg-emerald-50 border-solid border-emerald-400 text-emerald-600 ring-4 ring-emerald-100",l="text-emerald-500"):F?(y+=" bg-rose-50 border-solid border-rose-400 text-rose-600 ring-4 ring-rose-100",l="text-rose-500"):y+=" bg-white border-neutral-200 hover:border-indigo-400 hover:shadow-lg hover:-translate-y-1 active:scale-95",e.jsxs("button",{onClick:()=>q(g),disabled:!!W||!$,className:y,children:[e.jsxs("span",{className:"text-6xl font-serif font-medium mb-1",children:["/",g,"/"]}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${l}`,children:"Tap to Select"})]},v)})})]})]})},os=({words:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState("MEDIUM"),[f,G]=t.useState(10),[C,O]=t.useState([]),[Y,V]=t.useState([]),[X,W]=t.useState([]),[_,x]=t.useState(new Set),[s,D]=t.useState(null),[E,q]=t.useState(0),[P,$]=t.useState(0),g=i=>{const n=i.match(/.*?[.!?](?:\s|$)/);return n?n[0].trim():i.trim()},v=(i,n)=>{const r=i.split(/\s+/).filter(Boolean);if(n==="HARD")return r;const j=[];let Q=0;const o=n==="EASY"?3:2;for(;Q<r.length;){const L=Math.floor(Math.random()*o)+1,N=r.slice(Q,Q+L).join(" ");j.push(N),Q+=L}return j},u=()=>{const i=a.filter(j=>j.example&&j.example.trim().split(/\s+/).filter(Boolean).length>=5);if(i.length<5){alert("Not enough words with suitable example sentences (need at least 5).");return}const r=[...i].sort(()=>Math.random()-.5).slice(0,f).map(j=>{const Q=g(j.example),L=[...v(Q,z)].sort(()=>Math.random()-.5);return{id:j.id,word:j.word,originalSentence:Q,shuffledChunks:L}});O(r),B("PLAYING"),q(0),R()},R=()=>{V([]),W([]),x(new Set),$(0),D(null)},F=C[0],y=(i,n)=>{if(s!==null)return;const r=[...Y];r.splice(P,0,i),V(r),W(j=>{const Q=[...j];return Q.splice(P,0,n),Q}),x(j=>new Set(j).add(n)),$(j=>j+1)},l=i=>{s===null&&(V(n=>n.filter((r,j)=>j!==i)),W(n=>{const r=[...n],j=r[i];return r.splice(i,1),x(Q=>{const o=new Set(Q);return o.delete(j),o}),r}),P>i&&$(n=>n-1))},I=()=>{const i=Y.join(" ").toLowerCase().trim(),n=F.originalSentence.toLowerCase().trim();i===n?(D(!0),q(r=>r+(z==="HARD"?25:z==="MEDIUM"?15:10)),setTimeout(()=>{const r=C.slice(1);O(r),r.length===0?h(E+(z==="HARD"?25:15)):R()},1e3)):(D(!1),q(r=>Math.max(0,r-5)),setTimeout(()=>D(null),1500))},c=()=>{const i=C.slice(1);O(i),i.length===0?h(E):R()},p=({index:i})=>{const n=i===P;return e.jsx("div",{onClick:()=>$(i),className:`h-8 w-2 rounded-full cursor-pointer transition-all duration-200 mx-0.5 flex items-center justify-center ${n?"bg-indigo-500 scale-110 shadow-sm":"bg-transparent hover:bg-neutral-200"}`,children:e.jsx("div",{className:`w-1 h-4 rounded-full ${n?"bg-white/50":"bg-transparent"}`})})};if(d==="SETUP"){const i=({id:n,label:r,icon:j,desc:Q})=>e.jsxs("button",{onClick:()=>J(n),className:`p-3 rounded-2xl border-2 transition-all text-left flex flex-col gap-1 ${z===n?"border-emerald-500 bg-emerald-50 shadow-sm":"border-neutral-100 bg-white hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${z===n?"bg-emerald-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(j,{size:14})}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${z===n?"text-emerald-700":"text-neutral-500"}`,children:r})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:Q})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in max-w-5xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(yt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Sentence Scramble"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm",children:"Reconstruct examples to master syntax and flow."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsx("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm flex flex-col justify-center space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-emerald-600",children:f})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:f,onChange:n=>G(parseInt(n.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-neutral-300 uppercase tracking-tighter px-1",children:[e.jsx("span",{children:"5 Items"}),e.jsx("span",{children:"15 Items"}),e.jsx("span",{children:"25 Items"})]})]})}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-4",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(i,{id:"EASY",label:"Easy",icon:We,desc:"Chunks of 1-3 words. Great for collocations."}),e.jsx(i,{id:"MEDIUM",label:"Medium",icon:oe,desc:"Chunks of 1-2 words. More challenging."}),e.jsx(i,{id:"HARD",label:"Hard",icon:Ge,desc:"Individual words only. True mastery."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:u,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Scramble ‚Ä¢ ",z]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${(1-C.length/f)*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:F?e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsxs("h3",{className:"text-2xl font-black text-neutral-900",children:["Build the sentence for: ",e.jsx("span",{className:"underline decoration-emerald-300 decoration-2 underline-offset-4",children:F.word})]}),e.jsx("button",{onClick:()=>pe(F.originalSentence),className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl hover:bg-emerald-100 transition-all active:scale-90",title:"Hear full sentence",children:e.jsx(Ae,{size:24})})]}),e.jsx("p",{className:"text-neutral-400 text-xs font-bold uppercase tracking-widest",children:"Tap chunks to insert at cursor"})]}),e.jsx("div",{className:`w-full max-w-3xl bg-neutral-50 rounded-[2.5rem] border-2 border-dashed p-8 transition-all ${s===!0?"border-emerald-400 bg-emerald-50":s===!1?"border-rose-400 bg-rose-50 animate-shake":"border-neutral-200"}`,children:e.jsxs("div",{className:"flex flex-wrap gap-y-3 items-center justify-center min-h-[60px]",children:[Y.length===0&&e.jsx("span",{className:"absolute text-lg font-bold text-neutral-300 italic pointer-events-none",children:"Draft your sentence here..."}),e.jsx(p,{index:0}),Y.map((i,n)=>e.jsxs(Ue.Fragment,{children:[e.jsx("button",{onClick:()=>l(n),className:`px-4 py-2 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 animate-in zoom-in-95 flex items-center gap-1 group ${s===!0?"bg-emerald-600 text-white":s===!1?"bg-rose-600 text-white":"bg-white text-neutral-900 border border-neutral-100 hover:border-red-200 hover:text-red-500"}`,children:i}),e.jsx(p,{index:n+1})]},`${i}-${n}`))]})}),e.jsx("div",{className:"w-full max-w-3xl bg-neutral-100 rounded-[2.5rem] p-8 flex flex-wrap gap-3 justify-center",children:F.shuffledChunks.map((i,n)=>e.jsx("button",{onClick:()=>y(i,n),disabled:_.has(n),className:`px-5 py-3 rounded-xl text-lg font-bold shadow-sm transition-all active:scale-95 ${_.has(n)?"bg-neutral-200 text-neutral-400 cursor-not-allowed opacity-30":"bg-white text-neutral-700 border-2 border-white hover:border-emerald-300 hover:text-neutral-900"}`,children:i},n))}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:c,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all",children:"Skip"}),e.jsxs("button",{onClick:I,disabled:Y.length===0||s!==null,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(we,{size:18})," Check"]})]}),s===!1&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 p-4 bg-emerald-50 rounded-2xl border border-emerald-100 text-center max-w-2xl",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Original Sentence"}),e.jsxs("p",{className:"text-sm font-bold text-emerald-900 italic",children:['`"`',F.originalSentence,'`"`']})]})]}):e.jsx("div",{className:"text-neutral-300 font-black text-xl flex items-center justify-center h-full",children:"Preparing..."})})]})},cs=["in","on","at","to","for","with","of","from","by","about","into","through","over","under","between","among","against","during","without","before","after","toward","upon","within","along"].sort(),ds=({words:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState(10),[f,G]=t.useState([]),[C,O]=t.useState(0),[Y,V]=t.useState(""),[X,W]=t.useState(null),[_,x]=t.useState(0),[s,D]=t.useState([]),[E,q]=t.useState(0),[P,$]=t.useState(!1),g=t.useRef(null),v=t.useRef(null),u=()=>{const c=a.filter(n=>n.prepositions&&n.prepositions.some(r=>!r.isIgnored)&&n.example);if(c.length<3){alert("Not enough vocabulary with prepositions and examples found in your library.");return}const p=[...c].sort(()=>Math.random()-.5),i=[];for(const n of p){if(i.length>=z)break;const j=[...n.prepositions.filter(Q=>!Q.isIgnored)].sort(()=>Math.random()-.5);for(const Q of j){const o=n.word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`\\b${o}\\s+${Q.prep}\\b`,"i");if(L.test(n.example)){const N=n.example.split(".")[0]+".";if(L.test(N)){const U=N.replace(L,`${n.word} ___`);i.push({id:`${n.id}-${Q.prep}`,word:n.word,example:U,answer:Q.prep.toLowerCase(),meaning:n.meaningVi});break}}}}if(i.length<1){alert("Could not generate questions from existing data.");return}G(i),B("PLAYING"),O(0),x(0),V(""),W(null)},R=f[C];t.useEffect(()=>{d==="PLAYING"&&g.current&&g.current.focus()},[C,d]);const F=c=>{if(!R||X===!0)return;const i=(c!==void 0?c:Y).trim().toLowerCase()===R.answer;W(i),$(!1),i?(x(n=>n+15),setTimeout(()=>{C<f.length-1?(O(n=>n+1),V(""),W(null)):h(_+15)},800)):(x(n=>Math.max(0,n-5)),setTimeout(()=>W(null),800))},y=c=>{if(V(c),c.trim()){const p=cs.filter(i=>i.startsWith(c.toLowerCase())&&i!==c.toLowerCase());D(p),q(0),$(p.length>0)}else $(!1)},l=c=>{if(!P){c.key==="Enter"&&F();return}switch(c.key){case"ArrowDown":c.preventDefault(),q(p=>(p+1)%s.length);break;case"ArrowUp":c.preventDefault(),q(p=>(p-1+s.length)%s.length);break;case"Enter":case"Tab":{c.preventDefault();const p=s[E];V(p),$(!1),F(p);break}case"Escape":$(!1);break}};if(d==="SETUP")return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 text-violet-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(oe,{size:40,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Preposition Power"}),e.jsx("p",{className:"text-neutral-500 font-medium max-w-sm",children:"Master dependent prepositions in IELTS contexts with smart suggestions."})]}),e.jsx("div",{className:"w-full max-w-sm bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-violet-600",children:z})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:z,onChange:c=>J(parseInt(c.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-violet-500"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:u,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start Practice"]})]})]});const I=C/f.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-8 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-10 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Exit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Question ",C+1," / ",f.length]}),e.jsx("div",{className:"h-1.5 w-40 bg-neutral-100 rounded-full mt-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-500",style:{width:`${I}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest min-w-[80px] text-center",children:_})]}),e.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center space-y-12 max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:`w-full bg-neutral-50 border-2 rounded-[3rem] p-10 md:p-16 text-center space-y-8 transition-all duration-300 ${X===!0?"border-emerald-400 bg-emerald-50/30":X===!1?"border-rose-400 bg-rose-50/30 animate-shake":"border-neutral-100 shadow-sm"}`,children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("span",{className:"px-3 py-1 bg-violet-100 text-violet-700 rounded-lg text-[10px] font-black uppercase tracking-widest border border-violet-200",children:"Fill Blank"})})}),e.jsx("div",{className:"text-xl md:text-2xl font-medium text-neutral-700 leading-relaxed min-h-[4rem]",children:R.example.split("___").map((c,p,i)=>e.jsxs(Ue.Fragment,{children:[e.jsx("span",{children:c}),p<i.length-1&&e.jsxs("div",{className:"inline-block mx-2 relative",children:[e.jsx("input",{ref:g,type:"text",value:Y,onChange:n=>y(n.target.value),onKeyDown:l,disabled:X===!0,placeholder:"...",className:`
                                                w-[5ch] min-w-[100px] text-center bg-transparent border-b-4 outline-none font-black transition-all
                                                ${X===!0?"border-emerald-500 text-emerald-600":X===!1?"border-rose-500 text-rose-600":"border-neutral-300 focus:border-violet-600 text-neutral-900"}
                                            `,autoComplete:"off"}),X===!0&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 animate-bounce text-emerald-500",children:e.jsx(we,{size:20,strokeWidth:4})}),P&&e.jsx("div",{ref:v,className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 w-32 bg-white rounded-2xl shadow-2xl border border-neutral-100 z-50 overflow-hidden animate-in fade-in zoom-in-95",children:s.map((n,r)=>e.jsx("button",{onClick:()=>{V(n),$(!1),F(n)},className:`w-full px-4 py-2.5 text-sm font-bold text-left transition-colors ${E===r?"bg-violet-500 text-white":"text-neutral-600 hover:bg-neutral-50"}`,children:n},n))})]})]},p))})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsxs("button",{onClick:()=>{C<f.length-1?(O(c=>c+1),V(""),W(null)):h(_)},className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all flex items-center gap-2",children:["Skip ",e.jsx(Le,{size:18})]}),e.jsx("button",{onClick:()=>F(),disabled:Y.trim().length===0||X===!0,className:"px-12 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-30 flex items-center gap-2",children:"Check Answer"})]})]}),e.jsxs("footer",{className:"mt-auto pt-8 flex items-center justify-between text-[10px] font-black uppercase text-neutral-300 tracking-widest border-t border-neutral-50",children:[e.jsx("span",{children:"IELTS VOCAB PRO ‚Ä¢ PREPOSITION POWER"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{size:12}),e.jsx("span",{children:"Type to see autocomplete suggestions"})]}),e.jsxs("span",{children:["LEVEL ",C+1]})]})]})},xs=({words:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState("MIX"),[f,G]=t.useState("MEDIUM"),[C,O]=t.useState(8),[Y,V]=t.useState([]),[X,W]=t.useState([]),[_,x]=t.useState(null),[s,D]=t.useState(null),[E,q]=t.useState(0),P=()=>{const l=[];if(a.forEach(r=>{(z==="PARAPHRASE"||z==="MIX")&&(r.paraphrases||[]).filter(j=>!j.isIgnored&&j.context&&j.context.trim()).forEach(j=>{l.push({context:j.context,fullText:j.word,headword:r.word,pairId:`${r.id}-p-${j.word}`})}),(z==="COLLOCATION"||z==="MIX")&&(r.collocationsArray||[]).filter(j=>!j.isIgnored&&j.d&&j.d.trim()).forEach(j=>{l.push({context:j.d,fullText:j.text,headword:r.word,pairId:`${r.id}-c-${j.text}`})}),(z==="IDIOM"||z==="MIX")&&(r.idiomsList||[]).filter(j=>!j.isIgnored&&j.d&&j.d.trim()).forEach(j=>{l.push({context:j.d,fullText:j.text,headword:r.word,pairId:`${r.id}-i-${j.text}`})})}),l.length<5){alert("Not enough items found. Add more variations or idioms to your library.");return}const I=Math.min(l.length,C),c=[...l].sort(()=>.5-Math.random()).slice(0,I),p=c.map(r=>{const j=r.fullText.split(/\s+/);if(j.length>1){const Q=j.findIndex(L=>L.toLowerCase().includes(r.headword.toLowerCase())),o=Q===-1?0:Q===0?j.length-1:0;return j[o].replace(/[^a-zA-Z]/g,"")}return r.fullText}),i=[],n=[];c.forEach((r,j)=>{let Q,o=r.fullText,L=!1;const N=r.fullText.split(/\s+/);if(N.length>1){const T=N.findIndex(m=>m.toLowerCase().includes(r.headword.toLowerCase())),H=T===-1?0:T===0?N.length-1:0;o=N[H].replace(/[^a-zA-Z]/g,""),Q=N.map((m,S)=>S===H?"___":m).join(" ")}else o=r.fullText,Q=r.fullText,L=!0;const U=p.filter((T,H)=>H!==j&&T.toLowerCase()!==o.toLowerCase()),k=[o,...Array.from(new Set(U))].sort(()=>.5-Math.random()).slice(0,5);k.includes(o)||(k[Math.floor(Math.random()*k.length)]=o);const w={text:Q,fullText:r.fullText,headword:r.headword,context:r.context,partnerWord:o,choices:k,pairId:r.pairId};i.push({...w,id:`ctx-${r.pairId}`,isLinked:!1,isFilled:!1,isSelected:!1,isDone:!1,error:!1}),n.push({...w,id:`itm-${r.pairId}`,isLinked:!1,isFilled:L,isSelected:!1,isDone:!1,error:!1})}),V(i),W(n.sort(()=>.5-Math.random())),q(0),x(null),D(null),B("PLAYING")},$=(l,I,c)=>{const p=I.find(n=>n.pairId===l),i=c.find(n=>n.pairId===l);p!=null&&p.isLinked&&(i!=null&&i.isFilled)&&(p.isDone=!0,i.isDone=!0,q(r=>r+(f==="HARD"?25:f==="MEDIUM"?15:10)),I.every(r=>r.isDone)&&setTimeout(()=>h(E+25),1e3))},g=(l,I)=>{const c=Y.find(i=>i.id===l),p=X.find(i=>i.id===I);if(!(!c||!p))if(c.pairId===p.pairId){const i=Y.map(r=>r.id===l?{...r,isLinked:!0,isSelected:!1}:r),n=X.map(r=>r.id===I?{...r,isLinked:!0,isSelected:!1}:r);V(i),W(n),x(null),D(null),$(c.pairId,i,n)}else V(i=>i.map(n=>n.id===l?{...n,error:!0}:n)),W(i=>i.map(n=>n.id===I?{...n,error:!0}:n)),q(i=>Math.max(0,i-5)),setTimeout(()=>{V(i=>i.map(n=>({...n,error:!1,isSelected:!1}))),W(i=>i.map(n=>({...n,error:!1,isSelected:!1}))),x(null),D(null)},600)},v=l=>{const I=Y.find(c=>c.id===l);!I||I.isDone||(s?g(l,s):(x(l===_?null:l),V(c=>c.map(p=>({...p,isSelected:p.id===l?!p.isSelected:!1})))))},u=l=>{const I=X.find(c=>c.id===l);!I||I.isDone||(_?g(_,l):(D(l===s?null:l),W(c=>c.map(p=>({...p,isSelected:p.id===l?!p.isSelected:!1})))))},R=(l,I)=>{const c=X.find(i=>i.pairId===l);if(!c||c.isDone)return;if(I.trim().toLowerCase()===c.partnerWord.toLowerCase()){const i=X.map(n=>n.pairId===l?{...n,isFilled:!0,text:n.fullText}:n);W(i),$(l,Y,i)}else I.trim().length>0&&!c.choices.includes(I)&&(W(i=>i.map(n=>n.pairId===l?{...n,error:!0}:n)),setTimeout(()=>W(i=>i.map(n=>({...n,error:!1}))),600))},F=l=>l.isDone?"bg-emerald-50 border-emerald-300 text-emerald-800 opacity-50 cursor-default shadow-none":l.error?"bg-red-50 border-red-500 text-red-700 animate-shake":l.isSelected?"bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-[1.02]":l.isLinked?"bg-indigo-50 border-indigo-300 text-indigo-900 shadow-sm":"bg-white border-neutral-200 text-neutral-800 hover:border-neutral-400 hover:bg-neutral-50 cursor-pointer shadow-sm";if(d==="SETUP"){const l=({type:c,label:p,icon:i})=>e.jsxs("button",{onClick:()=>J(c),className:`flex flex-col items-center justify-center p-2 rounded-2xl border-2 transition-all min-w-[60px] ${z===c?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-300"}`,children:[e.jsx(i,{size:18,className:"mb-1"}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:p})]}),I=({level:c,label:p,desc:i})=>e.jsxs("button",{onClick:()=>G(c),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${f===c?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===c?"text-indigo-700":"text-neutral-400"}`,children:p}),f===c&&e.jsx(we,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:i})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(oe,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Context Match"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-sm mx-auto",children:"Link meanings and fill the blanks."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[e.jsx(l,{type:"PARAPHRASE",label:"Paraphrase",icon:oe}),e.jsx(l,{type:"COLLOCATION",label:"Collocation",icon:dt}),e.jsx(l,{type:"IDIOM",label:"Idiom",icon:kt}),e.jsx(l,{type:"MIX",label:"Mix All",icon:We})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Items"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:C})]}),e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:C,onChange:c=>O(parseInt(c.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(I,{level:"EASY",label:"Easy",desc:"Match definitions to phrases. No typing required."}),e.jsx(I,{level:"MEDIUM",label:"Medium",desc:"Match meanings and select word from dropdown."}),e.jsx(I,{level:"HARD",label:"Hard",desc:"Match meanings and type word from memory."})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:P,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}const y=Y.filter(l=>l.isDone).length/Y.length*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:["Context Match ‚Ä¢ ",f]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:`${y}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 no-scrollbar pb-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," Definition & Headword"]}),Y.map(l=>e.jsxs("button",{onClick:()=>v(l.id),className:`relative w-full p-5 rounded-[2rem] border-2 text-left transition-all duration-200 flex flex-col gap-2 ${F(l)}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-black tracking-tight ${l.isSelected?"text-white":"text-indigo-600"}`,children:l.headword}),e.jsxs("div",{className:"flex gap-2",children:[l.isLinked&&e.jsx(tt,{size:16,className:l.isSelected?"text-white":"text-indigo-400"}),l.isDone&&e.jsx(ne,{size:18,className:"text-emerald-500"})]})]}),e.jsx("p",{className:`font-medium text-sm leading-relaxed ${l.isSelected?"text-indigo-100":"text-neutral-600"}`,children:l.context})]},l.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-6 flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:12})," Target Phrase"]}),X.map(l=>e.jsxs("div",{onClick:()=>u(l.id),className:`relative w-full p-6 rounded-[2rem] border-2 text-left transition-all duration-200 ${F(l)}`,children:[e.jsx("div",{className:`text-lg font-bold flex flex-wrap items-center gap-x-2 leading-relaxed ${l.isSelected?"text-white":"text-neutral-900"}`,children:l.text.split(" ").map((I,c)=>I!=="___"?e.jsx("span",{children:I},c):f==="MEDIUM"?e.jsxs("div",{className:"inline-flex items-center gap-1 bg-white border-2 border-indigo-200 rounded-xl px-2 py-1 shadow-sm",onClick:p=>p.stopPropagation(),children:[e.jsxs("select",{disabled:l.isDone,className:`appearance-none bg-transparent text-sm font-black outline-none pr-6 relative ${l.isFilled?"text-emerald-600":"text-indigo-700"}`,onChange:p=>R(l.pairId,p.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),l.choices.map(p=>e.jsx("option",{value:p,children:p},p))]}),e.jsx(Be,{size:14,className:"text-indigo-400 pointer-events-none -ml-5"})]},c):f==="HARD"?e.jsx("input",{type:"text",disabled:l.isDone,onClick:p=>p.stopPropagation(),className:`w-32 px-3 py-1 bg-white border-2 rounded-xl text-sm font-black outline-none transition-all ${l.isFilled?"border-emerald-500 text-emerald-600":"border-indigo-200 text-indigo-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"}`,placeholder:"...",onKeyDown:p=>{p.key==="Enter"&&R(l.pairId,p.currentTarget.value)}},c):e.jsx("span",{className:"text-neutral-300 font-black",children:"_____"},c))}),e.jsxs("div",{className:"absolute top-4 right-6 flex gap-2",children:[l.isLinked&&e.jsx(tt,{size:16,className:l.isSelected?"text-white":"text-indigo-400"}),l.isDone&&e.jsx(ne,{size:18,className:"text-emerald-500"})]})]},l.id))]})]}),e.jsx("div",{className:"flex justify-center pt-10",children:e.jsxs("button",{onClick:()=>B("SETUP"),className:"flex items-center gap-2 text-xs font-black uppercase tracking-widest text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(nt,{size:14})," Restart"]})})]})]})},Ce=10,st=50;function ye(a){const h=[...a];for(let A=h.length-1;A>0;A--){const d=Math.floor(Math.random()*(A+1));[h[A],h[d]]=[h[d],h[A]]}return h}const us=({words:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState("MATRIX"),[f,G]=t.useState(12),[C,O]=t.useState({library:!0,collocations:!0,idioms:!0}),[Y,V]=t.useState([]),[X,W]=t.useState([]),[_,x]=t.useState([]),[s,D]=t.useState([]),[E,q]=t.useState(0),[P,$]=t.useState(0),[g,v]=t.useState(new Set),[u,R]=t.useState(null),[F,y]=t.useState(null),l=t.useMemo(()=>s.map((o,L)=>({...o,originalIndex:L})).filter(o=>!g.has(o.id)),[s,g]);t.useEffect(()=>{if(d!=="PLAYING")return;const o=[];if(a.forEach(H=>{C.library&&H.meaningVi&&H.meaningVi.trim()&&o.push({text:H.word,d:H.meaningVi,cueId:`cue-${H.id}-word`}),C.collocations&&(H.collocationsArray||[]).filter(S=>!S.isIgnored&&S.d&&S.d.trim()).forEach((S,b)=>{o.push({text:S.text,d:S.d,cueId:`cue-${H.id}-col-${b}`})}),C.idioms&&(H.idiomsList||[]).filter(S=>!S.isIgnored&&S.d&&S.d.trim()).forEach((S,b)=>{o.push({text:S.text,d:S.d,cueId:`cue-${H.id}-idm-${b}`})})}),o.length<Ce){alert(`Not enough items found (found ${o.length}, need min ${Ce}).`),B("SETUP");return}const N=ye(o).slice(0,f),U=[],k=[],w=[],T=[];N.forEach(H=>{const m=H.cueId;U.push({id:m,text:H.d}),k.push({id:`card-${m}`,text:H.text,cueId:m,pairId:m,state:"default",type:"word"}),w.push({id:`l-${m}`,text:H.text,cueId:m,pairId:m,state:"default",type:"word"}),T.push({id:`r-${m}`,text:H.d,cueId:m,pairId:m,state:"default",type:"meaning"})}),V(ye(k)),W(ye(w)),x(ye(T)),D(ye(U)),q(0),$(0),v(new Set),R(null),y(null)},[d,f,a,C]),t.useEffect(()=>{d==="PLAYING"&&f>0&&g.size===f&&setTimeout(()=>h(P),800)},[d,g,f,P,h]);const I=o=>{const L=s[E];!L||g.has(L.id)||o.state!=="default"||(o.cueId===L.id?($(N=>N+10),V(N=>N.map(U=>U.id===o.id?{...U,state:"correct"}:U)),W(N=>N.map(U=>U.pairId===o.pairId?{...U,state:"correct"}:U)),x(N=>N.map(U=>U.pairId===o.pairId?{...U,state:"correct"}:U)),setTimeout(()=>{const N=new Set(g).add(L.id);v(N);let U=-1;for(let k=E+1;k<s.length;k++)if(!N.has(s[k].id)){U=k;break}if(U===-1){for(let k=0;k<E;k++)if(!N.has(s[k].id)){U=k;break}}U!==-1&&q(U)},400)):($(N=>Math.max(0,N-5)),V(N=>N.map(U=>U.id===o.id?{...U,state:"incorrect"}:U)),setTimeout(()=>{V(N=>N.map(U=>U.id===o.id?{...U,state:"default"}:U))},600)))},c=o=>{o.state==="correct"||o.state==="incorrect"||(o.type==="word"?F?p(o.id,F):R(o.id===u?null:o.id):u?p(u,o.id):y(o.id===F?null:o.id))},p=(o,L)=>{const N=X.find(k=>k.id===o),U=_.find(k=>k.id===L);if(N&&U&&N.pairId===U.pairId){$(w=>w+10);const k=new Set(g).add(N.pairId);v(k),W(w=>w.map(T=>T.id===o?{...T,state:"correct"}:T)),x(w=>w.map(T=>T.id===L?{...T,state:"correct"}:T)),V(w=>w.map(T=>T.pairId===N.pairId?{...T,state:"correct"}:T)),R(null),y(null)}else $(k=>Math.max(0,k-5)),W(k=>k.map(w=>w.id===o?{...w,state:"incorrect"}:w)),x(k=>k.map(w=>w.id===L?{...w,state:"incorrect"}:w)),setTimeout(()=>{W(k=>k.map(w=>({...w,state:w.state==="incorrect"?"default":w.state}))),x(k=>k.map(w=>({...w,state:w.state==="incorrect"?"default":w.state}))),R(null),y(null)},600)},i=()=>{const o=l.findIndex(L=>L.originalIndex===E);if(o>0){const L=l[o-1];q(L.originalIndex)}},n=()=>{const o=l.findIndex(L=>L.originalIndex===E);if(o<l.length-1){const L=l[o+1];q(L.originalIndex)}},r=s[E],j=l.findIndex(o=>o.originalIndex===E);if(d==="SETUP"){const o=({label:N,checked:U,onChange:k})=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-2xl bg-neutral-50 border-2 border-transparent hover:border-fuchsia-100 cursor-pointer transition-all",onClick:k,children:[U?e.jsx(Ut,{size:18,className:"text-fuchsia-600"}):e.jsx(It,{size:18,className:"text-neutral-300"}),e.jsx("span",{className:"font-bold text-xs text-neutral-800",children:N})]}),L=C.library||C.collocations||C.idioms;return e.jsxs("div",{className:"flex flex-col h-full relative p-6 items-center animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-fuchsia-100 text-fuchsia-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm",children:e.jsx(nt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Scatter"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-sm mx-auto",children:"Match hidden words to their definitions."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-4 flex flex-col justify-center",children:[e.jsxs("label",{htmlFor:"sessionSize",className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:["Items: ",e.jsx("span",{className:"text-xl font-black text-fuchsia-600",children:f})]}),e.jsx("input",{id:"sessionSize",type:"range",min:Ce,max:st,value:f,onChange:N=>G(parseInt(N.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-full appearance-none cursor-pointer accent-fuchsia-500"}),e.jsxs("div",{className:"flex justify-between text-[9px] font-black text-neutral-300 uppercase px-1",children:[e.jsx("span",{children:Ce}),e.jsx("span",{children:st})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest block text-left px-1",children:"Content Sources"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(o,{label:"Library Definitions",checked:C.library,onChange:()=>O(N=>({...N,library:!N.library}))}),e.jsx(o,{label:"Collocations",checked:C.collocations,onChange:()=>O(N=>({...N,collocations:!N.collocations}))}),e.jsx(o,{label:"Idioms",checked:C.idioms,onChange:()=>O(N=>({...N,idioms:!N.idioms}))})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:()=>B("PLAYING"),disabled:!L,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}const Q=g.size/f*100;return e.jsxs("div",{className:"flex flex-col h-full relative p-4 md:p-6 bg-white rounded-[2.5rem]",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>h(P),className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Finish"]}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>J("MATRIX"),className:`p-2 rounded-lg transition-all ${z==="MATRIX"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Matrix View",children:e.jsx(Ht,{size:18})}),e.jsx("button",{onClick:()=>J("MATCH"),className:`p-2 rounded-lg transition-all ${z==="MATCH"?"bg-white shadow-sm text-fuchsia-600":"text-neutral-400 hover:text-neutral-600"}`,title:"Match View",children:e.jsx(Wt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-neutral-400 font-black text-[10px] uppercase tracking-widest",children:"Progress"}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-fuchsia-500 transition-all duration-300",style:{width:`${Q}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:P})]}),z==="MATRIX"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shrink-0 mb-6 py-6 px-8 bg-neutral-50 border border-neutral-200 rounded-[2rem] shadow-sm relative overflow-hidden flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:i,disabled:j<=0,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(ct,{size:24})}),e.jsx("div",{className:"text-center flex-1 px-10",children:r?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase text-fuchsia-500 tracking-widest flex items-center justify-center gap-1.5 mb-2",children:[e.jsx(St,{size:12})," Find the term for:"]}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-neutral-800 leading-tight",children:r.text})]}):e.jsx("p",{className:"text-center font-black text-emerald-600 text-xl animate-bounce",children:"CLEARED!"})}),e.jsx("button",{onClick:n,disabled:j>=l.length-1,className:"p-3 bg-white border border-neutral-200 rounded-xl text-neutral-400 hover:text-neutral-900 disabled:opacity-20 transition-all shadow-sm",children:e.jsx(Le,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-6",children:e.jsx("div",{className:`grid gap-3 ${f<=12?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":f<=24?"grid-cols-3 md:grid-cols-4 lg:grid-cols-6":"grid-cols-4 md:grid-cols-6 lg:grid-cols-8"}`,children:Y.map(o=>{const L=o.state==="correct",N=o.state==="incorrect";return e.jsxs("button",{onClick:()=>I(o),disabled:L,className:`
                                            relative h-16 px-2 rounded-2xl border-2 transition-all duration-300 flex items-center justify-center text-center shadow-sm font-bold text-xs leading-tight
                                            ${L?"bg-emerald-500 border-emerald-500 text-white scale-90 opacity-0 pointer-events-none":N?"bg-rose-50 border-rose-500 text-rose-600 animate-shake":"bg-white border-neutral-100 text-neutral-700 hover:border-fuchsia-300 hover:text-neutral-900 hover:-translate-y-0.5 active:scale-95"}
                                        `,children:[e.jsx("span",{className:"line-clamp-2",children:o.text}),L&&e.jsx(we,{size:20,className:"absolute inset-auto animate-ping"})]},o.id)})})})]}):e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(rt,{size:12})," English"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:X.map(o=>{const L=u===o.id,N=o.state==="correct",U=o.state==="incorrect";if(N)return e.jsx("div",{className:"h-16 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(ne,{size:32})},o.id);let k="bg-white border-neutral-200 text-neutral-800 hover:border-fuchsia-300 hover:-translate-y-0.5";return L&&(k="bg-fuchsia-600 border-fuchsia-600 text-white shadow-lg ring-4 ring-fuchsia-100 scale-105"),U&&(k="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>c(o),className:`h-16 px-4 rounded-xl border-b-4 font-bold text-sm transition-all duration-200 flex items-center justify-center text-center leading-tight shadow-sm ${k}`,children:o.text},o.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-center text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx(Ct,{size:12})," Meaning"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:_.map(o=>{const L=F===o.id,N=o.state==="correct",U=o.state==="incorrect";if(N)return e.jsx("div",{className:"h-20 flex items-center justify-center text-teal-500 opacity-20",children:e.jsx(ne,{size:32})},o.id);let k="bg-white border-neutral-200 text-neutral-700 hover:border-indigo-300 hover:-translate-y-0.5";return L&&(k="bg-indigo-600 border-indigo-600 text-white shadow-lg ring-4 ring-indigo-100 scale-105"),U&&(k="bg-red-50 border-red-500 text-red-700 animate-shake"),e.jsx("button",{onClick:()=>c(o),className:`min-h-20 px-4 py-3 rounded-xl border-b-4 font-medium text-xs transition-all duration-200 flex items-center justify-center text-center leading-relaxed shadow-sm ${k}`,children:o.text},o.id)})})]})]})}),e.jsxs("footer",{className:"shrink-0 mt-2 flex items-center justify-between text-[10px] font-black uppercase text-neutral-400 tracking-widest px-4 border-t border-neutral-100 pt-4",children:[e.jsxs("span",{children:["Total Items: ",f]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Matched"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-neutral-200"})," Hidden"]})]}),e.jsxs("span",{children:["Completed: ",g.size]})]})]})},ge=a=>a.toLowerCase().replace(/[^a-z0-9]/g,""),ms=a=>{const h=a.match(/.*?[.!?](?:\s|$)/);return h?h[0].trim():a.trim()},Pe=a=>a.replace(/(\d{1,2}:\d{2}(?::\d{2})?)|(\b\d{4}\b)|(\d+)/g,(h,A,d,B)=>A?A.replace(/:/g," "):d?`${d.slice(0,2)} ${d.slice(2)}`:B?B.split("").join(" "):h),hs=({words:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState(10),[f,G]=t.useState("EASY"),[C,O]=t.useState("LIBRARY"),[Y,V]=t.useState(!1),[X,W]=t.useState([]),[_,x]=t.useState(()=>{const b=qe("dictation_selected_voices",["System"]);return new Set(b)}),[s,D]=t.useState(()=>qe("dictation_hover_preview",!0)),[E,q]=t.useState([]),[P,$]=t.useState(0),[g,v]=t.useState(0),[u,R]=t.useState({}),[F,y]=t.useState(""),[l,I]=t.useState(!1),[c,p]=t.useState(!1),i=t.useRef(null),{showToast:n}=be();t.useEffect(()=>{Xe("dictation_selected_voices",Array.from(_))},[_]),t.useEffect(()=>{Xe("dictation_hover_preview",s)},[s]),t.useEffect(()=>((async()=>{const M=Ze(),K=Je(M);try{const Z=await Rt(K);if(Z&&Z.voices){const te=Z.voices.filter(ee=>ee.language==="en"&&(ee.name.includes("Premium")||ee.name.includes("Enhanced")));W(te)}}catch(Z){console.warn("Could not load server voices",Z)}})(),()=>{Te()}),[]),t.useEffect(()=>{C==="SERVER"&&G("HARD")},[C]);const r=async b=>{const M=Ze(),K=Je(M),Z="Dictation";try{const te=await fetch(`${K}/api/reading/files/${Z}`);if(!te.ok)throw new Error("Could not access 'Dictation' folder on server.");const se=((await te.json()).items||[]).filter(ae=>ae.type==="file"&&!ae.name.startsWith("."));if(se.length===0)throw new Error("No files found in 'Dictation' folder.");const de=se.sort(()=>Math.random()-.5).slice(0,5),re=[];if(await Promise.all(de.map(async ae=>{try{const le=ae.name,me=await fetch(`${K}/api/reading/content/${Z}/${encodeURIComponent(le)}`);if(me.ok){const Qe=(await me.json()).essay||"";if(Qe){const ft=Qe.split(/\r?\n/).map(Me=>Me.trim()).filter(Me=>Me.length>0);re.push(...ft)}}}catch(le){console.warn(`Failed to read file ${ae.name}`,le)}})),re.length===0)throw new Error("No valid text lines found.");return re.sort(()=>Math.random()-.5).slice(0,b)}catch(te){return n(te.message||"Server Error","error"),[]}},j=()=>{const b=Array.from(_);if(b.length===0)return;const M=b[Math.floor(Math.random()*b.length)];return M==="System"?void 0:M},Q=async()=>{let b;if(C==="SERVER"){if(V(!0),b=await r(z),V(!1),b.length===0)return}else{const K=a.filter(Z=>Z.example&&Z.example.trim().split(/\s+/).length>=4);if(K.length===0){n("No suitable example sentences found in Library.","error");return}b=[...K].sort(()=>Math.random()-.5).slice(0,z).map(Z=>ms(Z.example))}const M=b.map((K,Z)=>{const te=K.replace(/\s+/g," ").trim(),ee=te.split(" "),se=new Set;if(f==="EASY"){ee.forEach((le,me)=>{/\d/.test(le)&&se.add(me)});const re=Math.max(1,Math.floor(ee.length*.4));let ae=0;for(;se.size<re&&ae<100;){ae++;const le=Math.floor(Math.random()*ee.length);!se.has(le)&&/[a-zA-Z0-9]/.test(ee[le])&&se.add(le)}}const fe=ee.map((re,ae)=>{const le=f==="EASY"&&se.has(ae);return{text:re,isMasked:le}}),de=j();return{id:`dict-${Z}-${Date.now()}`,originalSentence:te,tokenized:fe,mode:f,voice:de}});q(M),B("PLAYING"),$(0),v(0),R({}),y(""),I(!1),p(!1),setTimeout(()=>{const K=M[0];pe(Pe(K.originalSentence),!1,"en",K.voice)},600)},o=E[P];t.useEffect(()=>{d==="PLAYING"&&!l&&setTimeout(()=>{var b;return(b=i.current)==null?void 0:b.focus()},150)},[P,d,l]);const L=()=>{o&&pe(Pe(o.originalSentence),!1,"en",o.voice)},N=()=>{w()},U=()=>{Te(),A()},k=()=>{if(l)return;let b=!0;if(o.mode==="HARD"?b=ge(F)===ge(o.originalSentence):o.tokenized.forEach((M,K)=>{if(M.isMasked){const Z=M.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");ge(u[K]||"")!==ge(Z)&&(b=!1)}}),p(b),I(!0),b){const M=o.mode==="HARD"?25:15;v(K=>K+M)}},w=()=>{if(P<E.length-1){$(M=>M+1),R({}),y(""),I(!1),p(!1);const b=E[P+1];setTimeout(()=>{pe(Pe(b.originalSentence),!1,"en",b.voice)},500)}else h(g)},T=b=>{x(M=>{const K=new Set(M);return K.has(b)?K.size>1&&K.delete(b):K.add(b),K})},H=b=>{if(!s)return;Te(),pe("Voice preview.",!1,"en",b==="System"?void 0:b)},m=()=>e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-5 justify-center items-center leading-relaxed",children:o.tokenized.map((b,M)=>{if(!b.isMasked)return e.jsx("span",{className:"text-lg font-medium text-neutral-600",children:b.text},M);const K=u[M]||"",Z=b.text.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,""),te=l&&ge(K)===ge(Z);return e.jsxs("div",{className:"relative inline-flex flex-col items-center",children:[e.jsx("input",{ref:M===o.tokenized.findIndex(ee=>ee.isMasked)?i:null,type:"text",value:K,disabled:l,onChange:ee=>R(se=>({...se,[M]:ee.target.value})),onKeyDown:ee=>ee.key==="Enter"&&k(),className:`w-28 text-center px-2 py-1.5 rounded-lg border-b-2 font-bold text-sm outline-none transition-all ${l?te?"bg-green-50 border-green-500 text-green-700":"bg-red-50 border-red-500 text-red-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-indigo-600"}`,autoComplete:"off"}),l&&!te&&e.jsx("div",{className:"absolute -bottom-5 text-[10px] font-black text-green-600 uppercase whitespace-nowrap",children:Z})]},M)})}),S=()=>e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsx("textarea",{ref:i,value:F,onChange:b=>y(b.target.value),disabled:l,onKeyDown:b=>b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),k()),placeholder:"Type the full sentence...",className:`w-full p-5 rounded-3xl border-2 text-lg font-medium resize-none outline-none transition-all h-32 ${l?c?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800":"bg-white border-neutral-200 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-100"}`}),l&&!c&&e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-2xl animate-in slide-in-from-top-2",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-base font-bold text-green-900 leading-relaxed",children:o.originalSentence})]})]});if(d==="SETUP"){const b=({id:M,label:K,icon:Z,desc:te,disabled:ee})=>e.jsxs("button",{onClick:()=>!ee&&G(M),disabled:ee,className:`p-3 rounded-xl border-2 transition-all text-left flex flex-col gap-1 relative ${f===M?"border-cyan-500 bg-cyan-50 shadow-md":"border-neutral-100 bg-white hover:border-neutral-300"} ${ee?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded-lg ${f===M?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-400"}`,children:e.jsx(Z,{size:14})}),e.jsx("span",{className:`text-xs font-black uppercase tracking-wider ${f===M?"text-cyan-700":"text-neutral-500"}`,children:K})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:te}),ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-[1px] font-black text-xs text-neutral-400 uppercase tracking-widest",children:"Locked"})]});return e.jsxs("div",{className:"flex flex-col h-full relative p-6 justify-center items-center text-center space-y-6 animate-in fade-in max-w-4xl mx-auto overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(Lt,{size:32})}),e.jsx("h2",{className:"text-2xl font-black text-neutral-900 tracking-tight",children:"Dictation Lab"}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium",children:"Bridge the gap between hearing and writing."})]}),e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left",children:"Source"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>O("LIBRARY"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="LIBRARY"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Et,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Sentence"})]}),e.jsxs("button",{onClick:()=>O("SERVER"),className:`flex flex-col items-center p-2 rounded-xl border-2 transition-all ${C==="SERVER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500"}`,children:[e.jsx(Bt,{size:16,className:"mb-1"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Phrase"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-sm font-black text-cyan-600",children:z})]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"5",value:z,onChange:M=>J(parseInt(M.target.value)),className:"w-full h-1.5 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2 flex flex-col justify-center",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest block text-left px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(b,{id:"EASY",label:"Easy",icon:oe,desc:"Type in missing words. Numbers are always masked.",disabled:C==="SERVER"}),e.jsx(b,{id:"HARD",label:"Hard",icon:Ge,desc:"Transcribe the full sentence from scratch."})]})]})]}),e.jsxs("div",{className:"w-full bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ae,{size:12})," Voice Pool"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 group-hover:text-cyan-600 transition-colors",children:"Hover to hear"}),e.jsx("div",{className:`w-8 h-4 rounded-full p-0.5 transition-colors ${s?"bg-cyan-500":"bg-neutral-200"}`,onClick:()=>D(!s),children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full shadow-sm transition-transform ${s?"translate-x-4":"translate-x-0"}`})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-1",children:[e.jsxs("button",{onClick:()=>T("System"),onMouseEnter:()=>H("System"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${_.has("System")?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[_.has("System")&&e.jsx(we,{size:10})," System Default"]}),X.map(M=>e.jsxs("button",{onClick:()=>T(M.name),onMouseEnter:()=>H(M.name),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${_.has(M.name)?"bg-cyan-50 text-cyan-700 border-cyan-200":"bg-white text-neutral-500 border-neutral-100 hover:border-neutral-200"}`,children:[_.has(M.name)&&e.jsx(we,{size:10})," ",M.name.replace("Microsoft ","")]},M.name)),X.length===0&&e.jsx("span",{className:"text-[10px] text-neutral-400 italic",children:"Connect to server for HQ voices."})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:U,className:"px-8 py-3 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-xl hover:bg-neutral-50 transition-all text-xs",children:"Back"}),e.jsxs("button",{onClick:Q,disabled:Y,className:"px-10 py-3 bg-cyan-600 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-cyan-700 transition-all shadow-xl active:scale-95 flex items-center gap-2",children:[Y?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(xe,{size:16,fill:"white"})," Start"]})]})]})}return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:U,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Level ",P+1," of ",E.length," ‚Ä¢ ",o.mode]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-300",style:{width:`${P/E.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:g})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12",children:[e.jsxs("button",{onClick:L,className:"w-28 h-28 bg-cyan-50 text-cyan-600 rounded-full flex items-center justify-center shadow-xl hover:scale-105 transition-all group active:scale-95 relative",children:[e.jsx(xe,{size:48,className:"ml-1.5 fill-cyan-600 group-hover:scale-110 transition-transform"}),o.voice&&e.jsx("div",{className:"absolute -bottom-6 text-[9px] font-bold text-neutral-300 bg-white px-2 py-0.5 rounded-full shadow-sm border border-neutral-100 whitespace-nowrap",children:o.voice})]}),e.jsx("div",{className:"w-full min-h-[160px] flex items-center justify-center px-4",children:o.mode==="EASY"?m():S()}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:l?e.jsxs("button",{onClick:w,className:`w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 ${c?"bg-emerald-600 text-white shadow-emerald-200":"bg-neutral-900 text-white"}`,children:[e.jsx("span",{children:P===E.length-1?"Finish":"Next Item"}),e.jsx(ke,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:N,className:"flex-1 py-4 bg-white border-2 border-neutral-200 text-neutral-400 font-black text-xs uppercase tracking-widest rounded-2xl hover:text-neutral-600 hover:border-neutral-300 transition-all",children:"Skip"}),e.jsx("button",{onClick:k,className:"flex-[2] py-4 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl shadow-neutral-900/10 active:scale-95",children:"Check Answer"})]})})]})]})},at=a=>a.toLowerCase().replace(/[^a-z0-9]/g,""),fs=({userId:a,onComplete:h,onExit:A})=>{var H;const[d,B]=t.useState("SETUP"),[z,J]=t.useState("MASTER"),[f,G]=t.useState("MEDIUM"),[C,O]=t.useState(10),[Y,V]=t.useState(0),[X,W]=t.useState(0),[_,x]=t.useState([]),[s,D]=t.useState(0),[E,q]=t.useState(0),[P,$]=t.useState(""),[g,v]=t.useState(!1),[u,R]=t.useState(!1),[F,y]=t.useState(!1),[l,I]=t.useState(!1),c=t.useRef(new At),p=t.useRef(null),i=t.useRef(null),{showToast:n}=be(),r=async()=>{const m=await _e();let S=0,b=0;m.forEach(M=>{M.answers.forEach(K=>{S++,K.lastResult==="correct"&&b++})}),V(S),W(b)};t.useEffect(()=>{r()},[a,d]),t.useEffect(()=>{F&&setTimeout(()=>{var m;(m=i.current)==null||m.scrollIntoView({behavior:"smooth",block:"end"})},100)},[F]);const j=async()=>{const m=await _e();let S=m;if(z==="MASTER"){const Z=m.filter(te=>te.answers.some(ee=>ee.lastResult!=="correct"));Z.length>0?S=Z:n("All items mastered! Switching to review mode.","info")}if(S.length===0){n("No expressions found.","error");return}const b=[],M=[];m.forEach(Z=>{Z.answers.forEach(te=>{const ee=te.sentence.match(/\{(.*?)\}/);ee&&M.push(ee[1])})}),S.forEach(Z=>{Z.answers.forEach((te,ee)=>{if(z==="MASTER"&&te.lastResult==="correct")return;const se=te.sentence.match(/\{(.*?)\}/);if(se){const fe=se[1],de=te.sentence.replace(se[0],"_______");let re;if(f==="EASY"){const ae=M.filter(le=>le!==fe).sort(()=>.5-Math.random()).slice(0,3);re=[fe,...ae].sort(()=>.5-Math.random())}b.push({id:`${Z.id}-${ee}`,nativeSpeakItemId:Z.id,answerIndex:ee,answer:te,maskedSentence:de,choices:re})}})});const K=b.sort(()=>.5-Math.random()).slice(0,C);x(K),D(0),q(0),$(""),y(!1),I(!1),R(!1),B("PLAYING")},Q=()=>{v(!0),$(""),c.current.start((m,S)=>$(m+S),m=>$(m))},o=()=>{v(!1),c.current.stop()},L=async m=>{const S=_[s],M=(await _e()).find(K=>K.id===S.nativeSpeakItemId);if(M){const K=M.answers.map((ee,se)=>se===S.answerIndex?{...ee,lastResult:m?"correct":"incorrect"}:ee),Z=K.filter(ee=>ee.lastResult==="correct").length,te=Math.round(Z/K.length*100);await Tt({...M,answers:K,bestScore:te,updatedAt:Date.now()})}},N=()=>{if(l)return;const S=_[s].answer.sentence.match(/\{(.*?)\}/),b=S?S[1]:"",M=at(P).includes(at(b));I(M),y(!0),M&&(q(K=>K+10),L(!0))},U=()=>{L(!1),k()},k=()=>{s<_.length-1?(D(m=>m+1),$(""),y(!1),I(!1),R(!1)):(B("SUMMARY"),setTimeout(()=>h(E),2e3))},w=_[s];if(d==="SETUP"){const m=({id:S,label:b,desc:M})=>e.jsxs("button",{onClick:()=>G(S),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${f===S?"bg-amber-50 border-amber-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===S?"text-amber-700":"text-neutral-400"}`,children:b}),f===S&&e.jsx(ne,{size:14,className:"text-amber-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:M})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm rotate-3",children:e.jsx(Mt,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Natural Expression"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Master native phrases by using them in context."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:X}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>J("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${z==="MASTER"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>J("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${z==="REVIEW"?"bg-amber-50 border-amber-500 text-amber-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Session Size"}),e.jsx("span",{className:"text-xl font-black text-amber-600",children:C})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:C,onChange:S=>O(parseInt(S.target.value,10)),className:"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-amber-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(m,{id:"EASY",label:"EASY",desc:"Select from list"}),e.jsx(m,{id:"MEDIUM",label:"MEDIUM",desc:"Fill missing part"}),e.jsx(m,{id:"HARD",label:"HARD",desc:"Type entire phrase"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:j,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}if(d==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Your progress has been saved to the library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:E}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"})]});const T=w.answer.tone==="academic"?"bg-purple-100 text-purple-700":w.answer.tone==="semi-academic"?"bg-blue-100 text-blue-700":"bg-neutral-100 text-neutral-600";return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",s+1," of ",_.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-300",style:{width:`${s/_.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar w-full",children:e.jsxs("div",{className:"min-h-full flex flex-col items-center justify-center space-y-8 pb-4",children:[e.jsxs("div",{className:"w-full bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-xl text-center space-y-4 relative overflow-hidden shrink-0",children:[e.jsx("div",{className:`absolute top-0 left-1/2 -translate-x-1/2 px-4 py-1 rounded-b-xl text-[10px] font-black uppercase tracking-widest ${T}`,children:w.answer.tone}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest mb-2",children:"Situation / Context"}),e.jsxs("h3",{className:"text-2xl md:text-3xl font-black text-neutral-900 leading-tight",children:['"',w.answer.anchor,'"']})]}),e.jsx("div",{className:"min-h-[100px] flex items-center justify-center py-4",children:f==="HARD"?e.jsx("div",{className:"text-neutral-400 text-sm font-medium italic",children:"(Expression Hidden - Speak or Type it)"}):e.jsx("p",{className:"text-lg md:text-xl text-neutral-700 font-medium",children:w.maskedSentence})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 bg-yellow-50 px-4 py-2 rounded-xl",children:[e.jsx("button",{onClick:()=>pe(w.answer.sentence),className:"p-2 bg-white text-yellow-600 rounded-full shadow-sm hover:scale-110 transition-transform",children:e.jsx(Ae,{size:16})}),e.jsx("span",{className:"text-xs font-bold text-yellow-800 italic",children:w.answer.note||"Listen to the example"})]})})]}),e.jsx("div",{className:"w-full max-w-md space-y-4 shrink-0",children:f==="EASY"?e.jsx("div",{className:"grid grid-cols-1 gap-2",children:(H=w.choices)==null?void 0:H.map(m=>e.jsx("button",{onClick:()=>$(m),disabled:l,className:`p-4 rounded-xl border-2 font-bold text-sm transition-all ${P===m?"bg-amber-50 border-amber-500 text-amber-900":"bg-white border-neutral-100 text-neutral-600 hover:border-neutral-300"}`,children:m},m))}):e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:p,value:P,onChange:m=>$(m.target.value),disabled:l||g,placeholder:f==="HARD"?"Type the full expression...":"Type the missing part...",className:`w-full p-5 pr-14 bg-white border-2 rounded-2xl text-lg font-bold outline-none transition-all resize-none ${F?l?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-amber-500 focus:ring-4 focus:ring-amber-50"}`,rows:2}),e.jsx("div",{className:"absolute right-3 bottom-3",children:e.jsx("button",{onClick:g?o:Q,className:`p-2 rounded-full transition-all ${g?"bg-red-500 text-white animate-pulse":"bg-neutral-100 text-neutral-500 hover:bg-neutral-200"}`,children:g?e.jsx("div",{className:"w-4 h-4 bg-white rounded-sm"}):e.jsx(zt,{size:20})})})]})}),e.jsx("div",{className:"w-full max-w-md flex gap-3 shrink-0",children:l?e.jsxs("div",{className:"w-full space-y-4 animate-in slide-in-from-bottom-2 pb-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl flex items-center gap-3 border-2 bg-emerald-50 border-emerald-100 text-emerald-800",children:[e.jsx(ne,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-lg uppercase tracking-tight",children:"Correct!"}),e.jsx("p",{className:"text-xs font-bold opacity-80",children:"Great job!"})]})]}),e.jsxs("button",{onClick:k,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-sm uppercase tracking-widest transition-all shadow-xl flex items-center justify-center gap-2 hover:bg-emerald-700",children:[e.jsx(ke,{size:18})," ",s===_.length-1?"Finish":"Continue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:U,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-sm uppercase tracking-widest hover:text-neutral-600 hover:border-neutral-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),e.jsxs("button",{onClick:()=>R(!0),disabled:u,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsx("button",{onClick:N,disabled:!P.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 disabled:active:scale-100",children:F?"Retry":"Check"})]})}),(l||u)&&e.jsxs("div",{className:"w-full max-w-md p-5 bg-white border-2 border-neutral-100 rounded-2xl shadow-sm relative overflow-hidden animate-in slide-in-from-bottom-2",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mb-2",children:"The Correct Expression"}),e.jsx("p",{className:"text-xl font-black text-emerald-600 leading-snug",children:w.answer.sentence.replace(/{|}/g,"")})]}),e.jsx("div",{ref:i})]})})]})},Ie=a=>a.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),ps=({user:a,onComplete:h,onExit:A})=>{const[d,B]=t.useState("SETUP"),[z,J]=t.useState(10),[f,G]=t.useState("EASY"),[C,O]=t.useState("MASTER"),[Y,V]=t.useState(0),[X,W]=t.useState(0),[_,x]=t.useState([]),[s,D]=t.useState(0),[E,q]=t.useState(0),[P,$]=t.useState([]),[g,v]=t.useState(!1),[u,R]=t.useState(!1),[F,y]=t.useState(!1),[l,I]=t.useState(!1),c=t.useRef({}),{showToast:p}=be();t.useEffect(()=>{(async()=>{const H=(await je(a.id)).filter(b=>b.type==="intensity"&&b.intensityRows);let m=0,S=0;H.forEach(b=>{b.intensityRows.forEach(M=>{["softened","neutral","intensified"].forEach(K=>{M[K].forEach(Z=>{m++,Z.lastResult==="correct"&&S++})})})}),V(m),W(S)})()},[a.id,d]);const i=async()=>{const T=(await je(a.id)).filter(b=>b.type==="intensity"&&b.intensityRows&&b.intensityRows.length>0);if(T.length===0){p("No Intensity Scale lessons found in your library.","error");return}const H=[],m=[];if(T.forEach(b=>{b.intensityRows.forEach(M=>{[...M.softened,...M.neutral,...M.intensified].forEach(K=>m.push(K.word))})}),T.forEach(b=>{b.intensityRows.forEach((M,K)=>{const Z=["softened","neutral","intensified"];Z.forEach(te=>{const ee=M[te];ee.length!==0&&Z.forEach(se=>{if(te===se||M[se].length===0)return;const fe=M[se].every(de=>de.lastResult==="correct");C==="MASTER"&&fe||ee.forEach(de=>{const re={lessonId:b.id,rowIdx:K,pivotWord:de.word,pivotCategory:te,targetCategory:se,expectedWords:M[se].map(ae=>Ie(ae.word)),originalExpectedItems:M[se]};if(f==="EASY"){const ae=M[se].map(me=>me.word),le=m.filter(me=>!ae.includes(me)).sort(()=>.5-Math.random()).slice(0,5);re.choices=[...ae,...le].sort(()=>.5-Math.random())}H.push(re)})})})})}),H.length===0){C==="MASTER"?(p("All items mastered! Switching to Review mode.","success"),O("REVIEW")):p("Not enough data to start game. Add more words to your scales.","error");return}const S=H.sort(()=>.5-Math.random()).slice(0,z);x(S),D(0),q(0),B("PLAYING"),n(S[0])},n=w=>{$(new Array(w.expectedWords.length).fill("")),v(!1),R(!1),I(!1),setTimeout(()=>{var T;(T=c.current[0])==null||T.focus()},100)},r=async()=>{if(F)return;const w=_[s],T=P.map(S=>Ie(S)).filter(Boolean),H=new Set(T);let m=!0;if(H.size!==w.expectedWords.length)m=!1;else for(const S of w.expectedWords)if(!H.has(S)){m=!1;break}v(!0),R(m),m&&(q(S=>S+20),await Q(!0))},j=()=>{I(!0)},Q=async w=>{y(!0);const T=_[s];try{const m=(await je(a.id)).find(S=>S.id===T.lessonId);if(m&&m.intensityRows){const S=[...m.intensityRows],b=[...S[T.rowIdx][T.targetCategory]];S[T.rowIdx][T.targetCategory]=b.map(M=>({...M,lastResult:w?"correct":"incorrect"})),await it({...m,intensityRows:S,updatedAt:Date.now()})}}catch(H){console.error("Failed to save result",H)}finally{y(!1)}},o=()=>{if(s<_.length-1){const w=s+1;D(w),n(_[w])}else B("SUMMARY")},L=async()=>{await Q(!1),o()};if(d==="SETUP"){const w=({id:T,label:H,desc:m})=>e.jsxs("button",{onClick:()=>G(T),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${f===T?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===T?"text-orange-700":"text-neutral-400"}`,children:H}),f===T&&e.jsx(ne,{size:14,className:"text-orange-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:m})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(Ot,{size:32,fill:"currentColor"})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Intensity Scale"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Drill synonyms based on their degree of intensity."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:X}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>O("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="MASTER"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>O("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="REVIEW"?"bg-orange-50 border-orange-500 text-orange-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-orange-600",children:z})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:z,onChange:T=>J(parseInt(T.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-orange-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(w,{id:"EASY",label:"Easy",desc:"Select from list"}),e.jsx(w,{id:"HARD",label:"Hard",desc:"Type from memory"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:i,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}if(d==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Scale Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"Progress marks updated in your library."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:E}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>h(E),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const N=_[s],U={softened:"Softened",neutral:"Neutral",intensified:"Intensified"},k={softened:"text-blue-500 bg-blue-50 border-blue-100",neutral:"text-neutral-500 bg-neutral-100 border-neutral-200",intensified:"text-orange-500 bg-orange-50 border-orange-100"};return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",s+1," of ",_.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${s/_.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${k[N.pivotCategory]}`,children:U[N.pivotCategory]}),e.jsx("span",{className:"text-neutral-300",children:"‚Üí"}),e.jsx("span",{className:`px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest border ${k[N.targetCategory]}`,children:U[N.targetCategory]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-neutral-400 uppercase tracking-widest",children:["What is the ",N.targetCategory," of"]}),e.jsxs("h3",{className:"text-4xl font-black text-neutral-900 tracking-tighter",children:['"',N.pivotWord,'"?']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-3",children:[P.map((w,T)=>{var H;return e.jsx("div",{className:"relative",children:f==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:m=>{c.current[T]=m},value:w,disabled:u,onChange:m=>{const S=[...P];S[T]=m.target.value,$(S)},className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${g?N.expectedWords.includes(Ie(w))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50"}`,children:[e.jsxs("option",{value:"",children:["Select word ",T+1,"..."]}),(H=N.choices)==null?void 0:H.map(m=>e.jsx("option",{value:m,children:m},m))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:m=>{c.current[T]=m},type:"text",value:w,disabled:u,onChange:m=>{const S=[...P];S[T]=m.target.value,$(S)},onKeyDown:m=>m.key==="Enter"&&!u&&r(),placeholder:`Type word ${T+1}...`,className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${g?N.expectedWords.includes(Ie(w))?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-50 shadow-sm"}`,autoComplete:"off"})},T)}),(u||l)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answers"}),e.jsx("p",{className:"text-lg font-black text-emerald-900",children:N.originalExpectedItems.map(w=>w.word).join(", ")})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:o,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:s===_.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),g&&!u&&e.jsxs("button",{onClick:j,disabled:l,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:r,disabled:F||P.some(w=>!w.trim()),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[F?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:g?"Retry":"Check"})]})]})})]})]})},he=a=>a.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),bs=({user:a,onComplete:h,onExit:A})=>{var U;const[d,B]=t.useState("SETUP"),[z,J]=t.useState(10),[f,G]=t.useState("EASY"),[C,O]=t.useState("MASTER"),[Y,V]=t.useState(0),[X,W]=t.useState(0),[_,x]=t.useState([]),[s,D]=t.useState(0),[E,q]=t.useState(0),[P,$]=t.useState(""),[g,v]=t.useState(!1),[u,R]=t.useState(!1),[F,y]=t.useState(!1),[l,I]=t.useState(!1),c=t.useRef(null),{showToast:p}=be();t.useEffect(()=>{(async()=>{const T=(await je(a.id)).filter(S=>S.type==="comparison"&&S.comparisonRows);let H=0,m=0;T.forEach(S=>{S.comparisonRows.forEach(b=>{H++,b.lastResult==="correct"&&m++})}),V(H),W(m)})()},[a.id,d]);const i=async()=>{const w=(await je(a.id)).filter(S=>S.type==="comparison"&&S.comparisonRows&&S.comparisonRows.length>0);if(w.length===0){p("No Comparison Lab lessons found in your library.","error");return}const T=[],H=[];if(w.forEach(S=>{S.comparisonRows.forEach(b=>{b.word&&H.push(b.word)})}),w.forEach(S=>{S.comparisonRows.forEach((b,M)=>{if(!b.word||!b.nuance||C==="MASTER"&&b.lastResult==="correct")return;const K={lessonId:S.id,rowIdx:M,answerWord:b.word,nuance:b.nuance,example:b.example};if(f==="EASY"){const Z=H.filter(te=>he(te)!==he(b.word)).sort(()=>.5-Math.random()).slice(0,5);K.choices=[b.word,...Z].sort(()=>.5-Math.random())}T.push(K)})}),T.length===0){C==="MASTER"?(p("All items mastered! Switching to Review mode.","success"),O("REVIEW")):p("Not enough data to start game. Add more word pairs to your labs.","error");return}const m=T.sort(()=>.5-Math.random()).slice(0,z);x(m),D(0),q(0),B("PLAYING"),n(m[0])},n=()=>{$(""),v(!1),R(!1),I(!1),setTimeout(()=>{var k;(k=c.current)==null||k.focus()},100)},r=async()=>{if(F)return;const k=_[s],w=he(P)===he(k.answerWord);R(w),v(!0),w&&(q(T=>T+20),await Q(!0))},j=()=>{I(!0)},Q=async k=>{y(!0);const w=_[s];try{const H=(await je(a.id)).find(m=>m.id===w.lessonId);if(H&&H.comparisonRows){const m=[...H.comparisonRows];m[w.rowIdx]={...m[w.rowIdx],lastResult:k?"correct":"incorrect"},await it({...H,comparisonRows:m,updatedAt:Date.now()})}}catch(T){console.error("Failed to save result",T)}finally{y(!1)}},o=()=>{if(s<_.length-1){const k=s+1;D(k),n(_[k])}else B("SUMMARY")},L=async()=>{await Q(!1),o()};if(d==="SETUP"){const k=({id:w,label:T,desc:H})=>e.jsxs("button",{onClick:()=>G(w),className:`flex flex-col items-start p-3 rounded-2xl border-2 transition-all text-left group ${f===w?"bg-indigo-50 border-indigo-500 shadow-sm":"bg-white border-neutral-100 hover:border-neutral-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${f===w?"text-indigo-700":"text-neutral-400"}`,children:T}),f===w&&e.jsx(ne,{size:14,className:"text-indigo-600"})]}),e.jsx("span",{className:"text-[9px] font-bold text-neutral-400 leading-tight",children:H})]});return e.jsxs("div",{className:"flex flex-col h-full items-center p-6 animate-in fade-in overflow-y-auto",children:[e.jsxs("div",{className:"text-center space-y-2 mb-6 mt-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm -rotate-3",children:e.jsx(dt,{size:32})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Word Contrast"}),e.jsx("p",{className:"text-neutral-500 font-medium text-sm max-w-xs mx-auto",children:"Distinguish confusing word pairs based on usage nuance."})]}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 mb-auto items-start",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50 p-3 rounded-2xl",children:[e.jsxs("div",{className:"text-center flex-1 border-r border-neutral-200",children:[e.jsx("p",{className:"text-2xl font-black text-emerald-500",children:X}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Mastered"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-black text-neutral-900",children:Y}),e.jsx("p",{className:"text-[10px] font-bold text-neutral-400 uppercase",children:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Game Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>O("MASTER"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="MASTER"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Master It",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Focus on weak items"})]}),e.jsxs("button",{onClick:()=>O("REVIEW"),className:`p-2.5 rounded-xl border-2 text-[10px] font-bold transition-all ${C==="REVIEW"?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-neutral-100 text-neutral-500 hover:border-neutral-200"}`,children:["Review All",e.jsx("p",{className:"text-[8px] font-normal opacity-70 mt-0.5",children:"Random practice"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:"Question Count"}),e.jsx("span",{className:"text-xl font-black text-indigo-600",children:z})]}),e.jsx("input",{type:"range",min:"5",max:"25",step:"5",value:z,onChange:w=>J(parseInt(w.target.value,10)),className:"w-full h-2 bg-neutral-100 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-neutral-200 shadow-sm space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Difficulty"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(k,{id:"EASY",label:"Easy",desc:"Select from list"}),e.jsx(k,{id:"HARD",label:"Hard",desc:"Type from memory"})]})]})]}),e.jsxs("div",{className:"flex gap-4 w-full max-w-md",children:[e.jsx("button",{onClick:A,className:"px-10 py-4 bg-white border border-neutral-200 text-neutral-500 font-bold rounded-2xl hover:bg-neutral-50 transition-all active:scale-95",children:"Back"}),e.jsxs("button",{onClick:i,className:"flex-1 py-4 bg-neutral-900 text-white font-black text-sm uppercase tracking-widest rounded-2xl hover:bg-neutral-800 transition-all shadow-xl active:scale-95 flex justify-center items-center gap-2",children:[e.jsx(xe,{size:18,fill:"white"})," Start"]})]})]})}if(d==="SUMMARY")return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 animate-in zoom-in-95",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-full mb-4 shadow-inner",children:e.jsx(ne,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Practice Complete!"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:"History marks updated in your comparison labs."}),e.jsx("div",{className:"mt-8 text-6xl font-black text-neutral-900",children:E}),e.jsx("p",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest mt-2",children:"Points Earned"}),e.jsx("button",{onClick:()=>h(E),className:"mt-8 px-10 py-3 bg-neutral-900 text-white font-black text-xs uppercase tracking-widest rounded-xl hover:bg-neutral-800 shadow-lg",children:"Back to Discover"})]});const N=_[s];return e.jsxs("div",{className:"flex flex-col h-full relative p-6 max-w-4xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 shrink-0",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-neutral-400 hover:text-neutral-900 transition-colors font-bold text-sm",children:[e.jsx(ce,{size:18})," Quit"]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-neutral-300 tracking-widest",children:["Question ",s+1," of ",_.length]}),e.jsx("div",{className:"h-1 w-32 bg-neutral-100 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${s/_.length*100}%`}})})]}),e.jsx("div",{className:"px-6 py-2 bg-neutral-900 text-white rounded-full font-black text-lg shadow-lg tracking-widest",children:E})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center space-y-12 pb-20",children:[e.jsxs("div",{className:"w-full bg-white p-10 rounded-[3rem] border-2 border-neutral-100 shadow-xl text-center space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest mb-2",children:"Identify the word based on nuance:"}),e.jsxs("h3",{className:"text-xl md:text-2xl font-medium text-neutral-800 leading-relaxed italic",children:['"',N.nuance,'"']})]}),N.example&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-50",children:[e.jsx("p",{className:"text-[10px] font-black text-neutral-300 uppercase tracking-widest mb-1",children:"Usage Example"}),e.jsxs("p",{className:"text-sm font-bold text-neutral-500",children:['"',N.example.replace(new RegExp(N.answerWord,"gi"),"_______"),'"']})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-4",children:[f==="EASY"?e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:c,value:P,disabled:u,onChange:k=>$(k.target.value),className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all appearance-none cursor-pointer ${g?he(P)===he(N.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50"}`,children:[e.jsx("option",{value:"",children:"Select word..."}),(U=N.choices)==null?void 0:U.map(k=>e.jsx("option",{value:k,children:k},k))]}),!u&&e.jsx(Be,{size:20,className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none"})]}):e.jsx("input",{ref:c,type:"text",value:P,disabled:u,onChange:k=>$(k.target.value),onKeyDown:k=>k.key==="Enter"&&!u&&r(),placeholder:"Type the word...",className:`w-full p-4 bg-white border-2 rounded-2xl text-lg font-black outline-none transition-all text-center placeholder:text-neutral-200 ${g?he(P)===he(N.answerWord)?"border-emerald-500 bg-emerald-50 text-emerald-800":"border-rose-500 bg-rose-50 text-rose-800":"border-neutral-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 shadow-sm"}`,autoComplete:"off"}),(u||l)&&e.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl animate-in slide-in-from-top-2 text-center shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1",children:"Correct Answer"}),e.jsx("p",{className:"text-xl font-black text-emerald-900",children:N.answerWord})]})]}),e.jsx("div",{className:"w-full max-w-xs flex gap-3",children:u?e.jsxs("button",{onClick:o,className:"w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-xl active:scale-95 bg-emerald-600 text-white",children:[e.jsx("span",{children:s===_.length-1?"Finish":"Next Question"}),e.jsx(ke,{size:18})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,className:"flex-1 py-4 bg-white border border-neutral-200 text-neutral-400 rounded-2xl font-black text-xs uppercase tracking-widest hover:text-neutral-600 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:16})," Skip"]}),g&&!u&&e.jsxs("button",{onClick:j,disabled:l,className:"flex-1 py-4 bg-amber-50 border border-amber-200 text-amber-600 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-amber-100 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{size:16})," Hint"]}),e.jsxs("button",{onClick:r,disabled:F||!P.trim(),className:"flex-[2] py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-neutral-800 transition-all shadow-xl active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2",children:[F?e.jsx(Ee,{size:16,className:"animate-spin"}):null,e.jsx("span",{children:g?"Retry":"Check"})]})]})})]})]})},As=({user:a,onExit:h,onRecalculateXp:A,xpToNextLevel:d,onStartSession:B,onUpdateUser:z,lastMasteryScoreUpdateTimestamp:J,onBulkUpdate:f,initialGameMode:G,onConsumeGameMode:C})=>{const[O,Y]=t.useState("ADVENTURE"),[V,X]=t.useState([]),[W,_]=t.useState(!0),x=t.useRef(0),{showToast:s}=be();t.useEffect(()=>{G&&G!=="MENU"&&(Y(G),C==null||C())},[G,C]);const D=t.useRef(A);t.useEffect(()=>{D.current=A},[A]),t.useEffect(()=>{(async()=>{_(!0);const R=lt().filter(F=>F.userId===a.id).filter(F=>F&&!F.isPassive);if(X(R),J>x.current){const F=R.reduce((y,l)=>y+(l.masteryScore||0),0);await D.current(F),x.current=Date.now()}_(!1)})()},[a.id,J]);const E=v=>{s(`Game Complete! Score: ${v}`,"success"),h()},q=()=>{h()},P=v=>V.filter(u=>u.gameEligibility?u.gameEligibility.includes(v):_t(u).includes(v)),$=()=>V.filter(v=>{const u=v.paraphrases&&v.paraphrases.filter(y=>!y.isIgnored&&y.context&&y.context.trim()).length>=2,R=v.collocationsArray&&v.collocationsArray.filter(y=>!y.isIgnored&&y.d&&y.d.trim()).length>=2,F=v.idiomsList&&v.idiomsList.filter(y=>!y.isIgnored&&y.d&&y.d.trim()).length>=2;return u||R||F}),g=()=>{const v={onComplete:E,onExit:q};switch(O){case"ADVENTURE":return e.jsx(Fe,{user:a,onUpdateUser:z,onStartSession:B,onExit:h});case"IPA_SORTER":return e.jsx(is,{...v,words:P("IPA_SORTER"),onBulkUpdate:f});case"SENTENCE_SCRAMBLE":return e.jsx(os,{...v,words:P("SENTENCE_SCRAMBLE")});case"DICTATION":return e.jsx(hs,{...v,words:P("DICTATION")});case"PREPOSITION_POWER":return e.jsx(ds,{...v,words:P("PREPOSITION_POWER")});case"PARAPHRASE_CONTEXT":return e.jsx(xs,{...v,words:$()});case"WORD_SCATTER":return e.jsx(us,{...v,words:P("MEANING_MATCH")});case"NATURAL_EXPRESSION":return e.jsx(fs,{userId:a.id,...v});case"INTENSITY_SCALE":return e.jsx(ps,{user:a,...v});case"COMPARISON_LAB":return e.jsx(bs,{user:a,...v});default:return e.jsx(Fe,{user:a,onUpdateUser:z,onStartSession:B,onExit:h})}};return O==="ADVENTURE"?e.jsx(Xt,{user:a,xpToNextLevel:d,onUpdateUser:z,isRecalculatingXp:W,children:e.jsx(Fe,{user:a,onUpdateUser:z,onStartSession:B,onExit:h})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-neutral-100 p-4 md:p-6 animate-in zoom-in-95 duration-300 flex flex-col",children:e.jsx("div",{className:"w-full h-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-neutral-200 relative p-6",children:g()})})};export{As as default};
