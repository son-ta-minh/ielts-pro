import{c as de,r as s,j as e,x as Oe,T as ct,y as we,L as dt,X as ye,z as ut,k as ke,R as xt,C as mt,d as je,o as $e,A as We,D as ht,G as Ne,H as Me,P as Se,I as pt,J as Ce,V as gt,s as ft,E as Ve,K as _e,M as bt,N as wt,O as jt,Q as vt,t as ge,U as ce,u as yt,v as Qe,Y as kt,Z as Nt,_ as St,$ as Ct,i as He,a0 as Tt,a1 as Et,a2 as At,a3 as Ge,w as It,a4 as Ut,a5 as Mt,a6 as zt,a7 as ze,a8 as Le,a9 as he,aa as Lt,ab as Re,ac as Rt,ad as be,ae as pe,af as Dt}from"./index-CzjYEa5v.js";import{W as Bt}from"./WordTable-B6S362q0.js";import{U as Ft}from"./WordTable_UI-DzdHJSal.js";import{D as Pt}from"./download-DINdxnRY.js";import{C as qe}from"./circle-D5lELFOI.js";import{u as Ot,G as $t,U as Wt,a as Vt,V as _t}from"./useShelfLogic-DhIjXuk2.js";import{R as Qt,a as Ht}from"./ResourceActions-J3g5r_2o.js";import{T as De,F as Gt}from"./TagBrowser-ePyJLDNS.js";import{U as qt}from"./UniversalCard-BIXh0yt6.js";import{F as Kt,M as Jt,A as Yt,R as Xt}from"./ShelfModals-B9mUQLsK.js";import{M as Zt}from"./move-CiY9C7zA.js";import{P as es}from"./pen-DCPBcE_g.js";import{L as ts}from"./library-C3yf_R6H.js";import"./search-CCKdQC-2.js";import"./square-check-big-DjoSBntH.js";import"./chevron-left-Ce_8X7zx.js";import"./palette-BiTp-MRO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=de("BookText",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=de("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=de("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=de("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=de("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=de("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);function Je(c,n,d,i,p,f){const v=c==="New Unit",N=!n.trim()&&!d.trim()&&!i.trim(),w=v&&N;let b="";w||(b=`CURRENT UNIT DATA:
- Name: ${c}
- Description: ${n||"(empty)"}
- Current Words: ${d||"(empty)"} (Add more words/phrase/idioms from new essay for user to learn, max additional 20 items)
- Essay: ${i||"(empty)"}
`);const g=p?`USER REQUEST FOR REFINEMENT: "${p}"`:"USER REQUEST FOR REFINEMENT: General improvement.";return`You are an expert IELTS coach, examiner, and native English speaker. Your task is to refine a vocabulary unit based on user context, existing data, and a new request.

USER PROFILE:
- Role: ${f.role}
- Level: ${f.currentLevel}

${b}
${g}

TASK:
1.  Read the user request and apply it to the CURRENT UNIT DATA to generate an improved essay.
2.  After generating the new essay, you MUST re-analyze its content to identify all relevant, high-value vocabulary.
3.  The 'words' array in your JSON response must be EXPANDED. It must include both original words (if they still appear in the essay) AND any NEW, useful words you've added to the essay. The goal is to grow the vocabulary list based on the new essay.
4.  Generate 3-5 reading comprehension questions based on the new essay. For each question, provide a concise, correct answer.

Return a strict JSON object with this schema:
{ 
  "name": "string (The updated unit name)", 
  "description": "string (The updated description)", 
  "words": ["string"], 
  "essay": "string (The full, updated essay text)",
  "comprehensionQuestions": [
    { "question": "string (Question 1)", "answer": "string (Concise answer 1)" },
    { "question": "string (Question 2)", "answer": "string (Concise answer 2)" }
  ]
}

'words' array format rules:
- Use "essay_word:base_word" ONLY if the word in the essay is a variation of the base form (e.g., "running:run", "cities:city").
- If the essay word IS the base form, use just the word (e.g., "environment"). DO NOT use "environment:environment".`}const ls={amber:"bg-amber-200/60 text-neutral-900 border-amber-300",emerald:"bg-emerald-200/60 text-neutral-900 border-emerald-300",sky:"bg-sky-200/60 text-neutral-900 border-sky-300",rose:"bg-rose-200/60 text-neutral-900 border-rose-300"},is=10,cs=4,ds=({isUnderlined:c,toggleUnderline:n,highlightColor:d,setHighlightColor:i,fontSize:p,setFontSize:f,isSerif:v,toggleFontFamily:N,isPracticeMode:w,onResetPractice:b,currentSelection:g,onWordAction:j,onClearSelection:u})=>e.jsxs("div",{className:"highlight-controls-container flex items-center gap-2 bg-white p-1 rounded-xl border border-neutral-200 shadow-sm h-[42px]",children:[e.jsxs("div",{className:"flex items-center gap-1 px-1",children:[e.jsx("button",{onClick:N,className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-500 hover:text-neutral-900 transition-colors",title:v?"Switch to Sans-Serif":"Switch to Serif",children:e.jsx(ct,{size:14})}),e.jsx("div",{className:"w-px h-3 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:()=>f(Math.max(12,p-1)),className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-500 hover:text-neutral-900 transition-colors",children:e.jsx(ns,{size:12})}),e.jsx("span",{className:"text-[10px] font-black min-w-[16px] text-center select-none text-neutral-400",children:p}),e.jsx("button",{onClick:()=>f(Math.min(24,p+1)),className:"p-1.5 rounded-lg hover:bg-neutral-100 text-neutral-500 hover:text-neutral-900 transition-colors",children:e.jsx(we,{size:12})})]}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:n,className:`p-1.5 rounded-lg transition-all duration-200 ${c?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-400 hover:text-neutral-600"}`,title:"Toggle Underline",children:e.jsx(os,{size:14})}),e.jsx("div",{className:"flex items-center gap-1.5 pl-1",children:["amber","emerald","sky","rose"].map(o=>e.jsx("button",{onClick:()=>i(o),className:`w-3.5 h-3.5 rounded-full transition-all duration-200 ${d===o?`ring-2 ring-offset-2 ring-neutral-300 scale-110 bg-${o}-400`:`opacity-40 hover:opacity-100 bg-${o}-400`}`,title:`Highlight ${o}`},o))}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsx("button",{onClick:b,className:"px-3 py-1 bg-neutral-100 hover:bg-neutral-200 text-neutral-600 rounded-lg text-[10px] font-black uppercase tracking-tighter transition-all",children:"New Random Blanks"})]}),g&&j&&u&&!w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"}),e.jsxs("div",{className:"flex items-center gap-2 pr-1 animate-in fade-in slide-in-from-left-2 duration-200",children:[e.jsxs("span",{className:"text-[10px] font-bold text-neutral-400 max-w-[100px] truncate hidden sm:inline-block pointer-events-none select-none",children:['"',g.text,'"']}),e.jsxs("button",{onMouseDown:o=>{o.preventDefault(),j(g.text,g.isLinked?"remove":"add"),u()},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all shadow-sm active:scale-95 ${g.isLinked?"bg-orange-50 text-orange-600 border border-orange-200 hover:bg-orange-100":"bg-green-50 text-green-600 border border-green-200 hover:bg-green-100"}`,children:[g.isLinked?e.jsx(Ft,{size:12}):e.jsx(dt,{size:12}),e.jsx("span",{children:g.isLinked?"Unlink":"Link"})]}),e.jsx("button",{onMouseDown:o=>{o.preventDefault(),u()},className:"p-1.5 text-neutral-300 hover:text-neutral-500 rounded-lg hover:bg-neutral-100 transition-colors",title:"Clear Selection",children:e.jsx(ye,{size:14})})]})]})]}),us=({answer:c,wordObj:n,candidates:d,onCorrect:i})=>{const[p,f]=s.useState(""),[v,N]=s.useState(!1),[w,b]=s.useState(!1),g=s.useRef(null),j=p.trim().toLowerCase()===c.toLowerCase(),u=p.trim().length>0&&!c.toLowerCase().startsWith(p.trim().toLowerCase());s.useEffect(()=>{j&&(i(),b(!1))},[j,i]),s.useEffect(()=>{const h=m=>{g.current&&!g.current.contains(m.target)&&b(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const o=h=>{f(h),b(!1)};return e.jsxs("span",{ref:g,className:"relative inline-block align-baseline group/input",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",value:p,onFocus:()=>!j&&b(!0),onChange:h=>f(h.target.value),disabled:j,className:`
                        h-[1.4em] px-2 py-0 ml-1 rounded-md border-b-2 font-bold transition-all outline-none text-center
                        ${j?"bg-emerald-50 border-emerald-500 text-emerald-700 min-w-[2ch]":u?"bg-rose-50 border-rose-400 text-rose-700":"bg-neutral-50 border-neutral-300 focus:bg-white focus:border-neutral-900 focus:shadow-sm"}
                    `,style:{width:`${Math.max(c.length,3)}ch`},placeholder:"...",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"}),!j&&e.jsx("button",{onClick:()=>b(!w),className:"p-1 text-neutral-300 hover:text-neutral-600 transition-colors",children:e.jsx(mt,{size:10,className:`transition-transform ${w?"rotate-180":""}`})})]}),w&&d.length>0&&e.jsx("div",{className:"absolute left-0 top-full mt-1 z-[60] bg-white border border-neutral-200 rounded-xl shadow-xl overflow-hidden min-w-[120px] animate-in fade-in zoom-in-95",children:e.jsx("div",{className:"p-1 flex flex-col",children:d.map((h,m)=>e.jsx("button",{onClick:()=>o(h),className:"w-full text-left px-3 py-1.5 rounded-lg text-xs font-bold text-neutral-700 hover:bg-neutral-50 hover:text-neutral-900 transition-colors truncate",children:h},m))})}),!j&&n&&e.jsx("button",{onMouseDown:h=>{h.preventDefault(),N(!v)},className:"absolute -top-3 -right-2 p-0.5 text-neutral-300 hover:text-amber-500 opacity-0 group-hover/input:opacity-100 transition-opacity",title:"Hint",children:e.jsx(je,{size:10})}),v&&n&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 z-50 animate-in fade-in zoom-in-95",children:e.jsxs("div",{className:"bg-neutral-900 text-white rounded-xl shadow-xl px-4 py-2 flex flex-col items-center gap-1 min-w-[120px]",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-amber-400 tracking-widest",children:n.ipa||"/?/"}),e.jsx("span",{className:"text-xs font-bold leading-tight text-center",children:n.meaningVi}),e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-900 rotate-45"})]})})]})},xs=({text:c,vocabString:n,wordsByText:d,highlightColor:i,isUnderlined:p,onHoverWord:f,isPracticeMode:v,practiceSessionKey:N})=>{const w=s.useMemo(()=>Oe(n),[n]),b=s.useMemo(()=>ut(w),[w]),[g,j]=s.useState(new Set),u=s.useMemo(()=>Array.from(w.keys()).filter(C=>C.length>2),[w]),o=s.useMemo(()=>{if(!v||!c||!b)return{blanks:new Set,choices:new Map};const k=c.split(b),C=[];k.forEach((z,A)=>{A%2===1&&C.push(A)});const I=[...C].sort(()=>Math.random()-.5),$=new Set(I.slice(0,is)),B=new Map;return $.forEach(z=>{const A=k[z],_=u.filter(V=>V.toLowerCase()!==A.toLowerCase()).sort(()=>Math.random()-.5).slice(0,cs-1);B.set(z,[A,..._].sort(()=>Math.random()-.5))}),{blanks:$,choices:B}},[v,N,c,b,u]);if(s.useEffect(()=>{j(new Set)},[N]),!c)return null;if(!b)return e.jsx("span",{children:c});const h=c.split(b),m=o.blanks.size,E=m>0&&g.size===m;return e.jsxs("div",{children:[v&&m>0&&e.jsxs("div",{className:"sticky top-0 z-20 bg-white/80 backdrop-blur-sm p-3 rounded-b-xl mb-4 border-b border-x border-neutral-200 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-500",children:"Practice Progress"}),e.jsxs("p",{className:"text-sm font-bold text-neutral-800",children:[g.size," / ",m," correct"]})]}),E&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-bold text-sm animate-in fade-in zoom-in-95",children:[e.jsx(ke,{size:18}),e.jsx("span",{children:"Complete!"})]})]}),e.jsx("span",{children:h.map((k,C)=>{if(C%2===1){const $=k.toLowerCase(),B=w.get($),z=B?d.get(B):void 0;return v&&o.blanks.has(C)?e.jsx(us,{answer:k,wordObj:z,candidates:o.choices.get(C)||[],onCorrect:()=>j(A=>new Set(A).add(C))},`${N}-${C}`):z?e.jsx("span",{className:`transition-all font-semibold ${v?"text-neutral-900 border-b border-neutral-200":`${ls[i]} ${p?"border-b-2":""} px-0.5 rounded-t-sm cursor-help`}`,onMouseEnter:A=>!v&&(f==null?void 0:f(z,A.currentTarget.getBoundingClientRect())),onMouseLeave:()=>!v&&(f==null?void 0:f(null,null)),children:k},C):e.jsx("span",{children:k},C)}return e.jsx(xt.Fragment,{children:k},C)})},N)]})},ms=({text:c,vocabString:n,wordsByText:d,highlightColor:i,setHighlightColor:p,isUnderlined:f,setIsUnderlined:v,fontSize:N,setFontSize:w,isSerif:b,setIsSerif:g,onHoverWord:j,onWordAction:u,isPracticeMode:o,className:h})=>{const[m,E]=s.useState(null),[k,C]=s.useState(Date.now());s.useEffect(()=>{E(null)},[c,n]);const I=B=>{!u||o||B.target.closest(".highlight-controls-container")||setTimeout(()=>{const z=window.getSelection();if(!z||z.isCollapsed){E(null);return}const A=z.toString().trim();if(!A||A.includes(`
`)||A.length>50){E(null);return}const V=Oe(n).has(A.toLowerCase());E({text:A,isLinked:V})},10)},$=()=>{var B;E(null),(B=window.getSelection())==null||B.removeAllRanges()};return e.jsxs("div",{className:`flex flex-col h-full bg-white relative overflow-hidden ${h||""}`,onMouseUp:I,children:[e.jsx("div",{className:"px-6 py-2 border-b border-neutral-100 bg-neutral-50/30 flex justify-between items-center min-h-[52px] sticky top-0 z-10",children:e.jsx(ds,{isUnderlined:f,toggleUnderline:()=>v(!f),highlightColor:i,setHighlightColor:p,fontSize:N,setFontSize:w,isSerif:b,toggleFontFamily:()=>g(!b),isPracticeMode:o,onResetPractice:()=>C(Date.now()),currentSelection:m,onWordAction:u,onClearSelection:$})}),e.jsxs("div",{className:`p-5 md:p-8 flex-1 overflow-y-auto stable-scrollbar relative ${o?"bg-neutral-50/20":""}`,children:[e.jsx("div",{className:"text-neutral-800 font-normal whitespace-pre-wrap leading-relaxed transition-all duration-200",style:{fontSize:`${N}px`,fontFamily:b?"Georgia, serif":"Inter, sans-serif"},children:e.jsx(xs,{text:c,vocabString:n,wordsByText:d,highlightColor:i,isUnderlined:f,onHoverWord:j,isPracticeMode:o,practiceSessionKey:k})}),!c&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-neutral-300 pointer-events-none",children:[e.jsx(Ke,{size:48,className:"mb-4 opacity-10"}),e.jsx("p",{className:"font-bold text-neutral-400 uppercase tracking-widest text-[10px]",children:"No essay content."})]})]})]})},Be="ielts_pro_essay_view_settings",hs={highlightColor:"amber",isUnderlined:!1,fontSize:16,isSerif:!1},Ye=c=>{const[n,d]=s.useState(()=>$e(Be,hs));return s.useEffect(()=>{We(Be,n)},[n]),e.jsx(ms,{...c,highlightColor:n.highlightColor,setHighlightColor:i=>d(p=>({...p,highlightColor:i})),isUnderlined:n.isUnderlined,setIsUnderlined:i=>d(p=>({...p,isUnderlined:i})),fontSize:n.fontSize,setFontSize:i=>d(p=>({...p,fontSize:i})),isSerif:n.isSerif,setIsSerif:i=>d(p=>({...p,isSerif:i}))})},ps=({isOpen:c,onClose:n,questions:d,answers:i,onAnswerChange:p,results:f,onResultChange:v})=>{const[N,w]=s.useState(new Set),b=u=>{w(o=>new Set(o).add(u))},g=Object.values(f).filter(u=>u==="correct").length,j=d.length;return c?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx(je,{size:20})," Comprehension Check"]}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Test your understanding of the passage."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"text-xs font-black uppercase text-neutral-400",children:"Score"}),e.jsxs("p",{className:"text-2xl font-black text-neutral-900",children:[g," ",e.jsxs("span",{className:"text-lg text-neutral-400",children:["/ ",j]})]})]}),e.jsx("button",{type:"button",onClick:n,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ye,{size:20})})]})]}),e.jsx("main",{className:"p-6 overflow-y-auto space-y-4",children:d.map((u,o)=>{const h=N.has(o),m=f[o],E=m!==null;return e.jsxs("div",{className:`p-4 rounded-2xl border transition-all ${E?m==="correct"?"bg-green-50/50 border-green-200":"bg-red-50/50 border-red-200":"bg-neutral-50/50 border-neutral-200"}`,children:[e.jsxs("p",{className:"text-sm font-bold text-neutral-800 mb-2",children:["Q",o+1,": ",u.question]}),e.jsx("textarea",{value:i[o]||"",onChange:k=>p(o,k.target.value),rows:3,placeholder:"Type your answer here...",disabled:E,className:"w-full text-sm p-3 bg-white rounded-lg border border-neutral-200 focus:ring-1 focus:ring-neutral-900 outline-none resize-y disabled:opacity-70"}),h&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-neutral-200 space-y-3 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h5",{className:"text-[10px] font-black uppercase text-neutral-500",children:"Suggested Answer"}),e.jsx("p",{className:"text-xs font-medium p-3 bg-white/50 rounded-lg",children:u.answer})]}),!E&&e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("h5",{className:"text-xs font-bold text-neutral-600 mr-2",children:"Was your answer correct?"}),e.jsxs("button",{onClick:()=>v(o,"incorrect"),className:"flex items-center gap-1.5 px-4 py-2 bg-white text-red-600 rounded-lg font-bold text-xs border border-red-200 hover:bg-red-50",children:[e.jsx(as,{size:14})," Incorrect"]}),e.jsxs("button",{onClick:()=>v(o,"correct"),className:"flex items-center gap-1.5 px-4 py-2 bg-white text-green-600 rounded-lg font-bold text-xs border border-green-200 hover:bg-green-50",children:[e.jsx(rs,{size:14})," Correct"]})]})]}),!h&&!E&&e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("button",{onClick:()=>b(o),className:"flex items-center gap-1.5 px-3 py-1.5 bg-white text-neutral-600 rounded-lg font-bold text-[10px] uppercase tracking-wider border border-neutral-200 hover:bg-neutral-50",children:[e.jsx(Ve,{size:12})," Show Answer"]})})]},o)})})]})}):null},gs=c=>{const{user:n,unit:d,allWords:i,unitWords:p,pagedUnitWords:f,filteredUnitWords:v,viewingWord:N,setViewingWord:w,editingWord:b,setEditingWord:g,isPracticeMode:j,setIsPracticeMode:u,unitTablePage:o,setUnitTablePage:h,unitTablePageSize:m,setUnitTablePageSize:E,unitTableQuery:k,setUnitTableQuery:C,unitTableFilters:I,setUnitTableFilters:$,onBack:B,onStartSession:z,onSwitchToEdit:A,handleRemoveWordFromUnit:_,onBulkDelete:V,onHardDelete:ne,onBulkHardDelete:P,handleSaveWordUpdate:y,handleToggleLearnedStatus:W,onWordAction:O,handleExportUnit:R,isComprehensionModalOpen:ae,onOpenComprehensionModal:te,onCloseComprehensionModal:K,comprehensionAnswers:M,onComprehensionAnswerChange:q,comprehensionResults:F,onComprehensionResultChange:Q}=c,[G,re]=s.useState(null),ee=s.useMemo(()=>new Map(i.map(a=>[a.word.toLowerCase().trim(),a])),[i]);s.useEffect(()=>(window.handleLessonSpeak=a=>{ht(a)},()=>{delete window.handleLessonSpeak}),[]);const oe=(a,r)=>{j||re(!a||!r?null:{word:a,rect:r})},x=async a=>{await y(a),g(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-24 relative animate-in fade-in duration-300",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("button",{onClick:B,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors",children:[e.jsx(Ne,{size:16}),e.jsx("span",{children:"Back to Essay Library"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>u(!j),className:`px-4 py-2 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest border transition-all ${j?"bg-amber-100 text-amber-700 border-amber-200 shadow-inner":"bg-white text-neutral-600 border-neutral-200"}`,children:[e.jsx(Me,{size:16}),e.jsx("span",{children:"Context Recall"})]}),e.jsxs("button",{onClick:te,className:"px-4 py-2 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest border transition-all bg-white text-neutral-600 border-neutral-200",children:[e.jsx(je,{size:16}),e.jsx("span",{children:"Fill Answers"})]}),e.jsx("div",{className:"w-px h-6 bg-neutral-200 mx-1 hidden sm:block"}),e.jsx("button",{onClick:R,className:"p-2 bg-white text-neutral-600 rounded-xl border border-neutral-200 hover:bg-neutral-100 transition-all active:scale-95",title:"Export Unit",children:e.jsx(Pt,{size:16})}),e.jsx("button",{onClick:A,className:"p-2 bg-white text-neutral-600 rounded-xl border border-neutral-200 hover:bg-neutral-100 transition-all active:scale-95",title:"Edit Unit",children:e.jsx(Se,{size:16})}),e.jsxs("button",{onClick:()=>z(p),disabled:p.length===0,className:"px-6 py-2 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[e.jsx(pt,{size:16,fill:"white"}),e.jsx("span",{children:"Practice"})]})]})]}),e.jsxs("div",{className:"px-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-xl font-bold text-neutral-900 tracking-tight",children:d.name}),e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-xs font-bold text-neutral-500 hover:text-neutral-900 transition-colors",children:[d.isLearned?e.jsx(ke,{size:16,className:"text-green-500"}):e.jsx(qe,{size:16,className:"text-neutral-300"}),e.jsx("span",{className:"whitespace-nowrap",children:d.isLearned?"Completed":"Mark as Completed"})]})]}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium",children:d.description||"Description is empty"}),d.tags&&d.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:[e.jsx(Ce,{size:12,className:"text-neutral-400"}),d.tags.map(a=>e.jsx("span",{className:"px-2 py-0.5 bg-neutral-100 text-neutral-600 rounded text-[10px] font-bold border border-neutral-200",children:a.replace(/\//g," / ")},a))]})]}),e.jsxs("div",{className:"rounded-[2rem] border border-neutral-200 shadow-sm min-h-[30vh] max-h-[60vh] flex flex-col relative",children:[j&&e.jsxs("div",{className:"absolute top-4 right-6 z-20 flex items-center gap-2 bg-amber-100 text-amber-800 px-3 py-1.5 rounded-full border border-amber-200 animate-in fade-in slide-in-from-top-2",children:[e.jsx(Me,{size:12}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter",children:"Active Context Recall Active"})]}),e.jsx(Ye,{className:"rounded-[2rem]",text:d.essay||"",vocabString:d.customVocabString,wordsByText:ee,onHoverWord:oe,onWordAction:O,isPracticeMode:j})]}),e.jsx(Bt,{user:n,words:f,total:v.length,loading:!1,page:o,pageSize:m,onPageChange:h,onPageSizeChange:E,onSearch:C,onFilterChange:$,onAddWords:async()=>{},onViewWord:w,onEditWord:g,onDelete:async a=>{await _(a.id)},onHardDelete:ne,onBulkDelete:V,onBulkHardDelete:P,onPractice:a=>z(i.filter(r=>a.has(r.id))),settingsKey:"ielts_pro_unit_table_settings",context:"unit"})]}),G&&e.jsx("div",{className:"fixed z-50 pointer-events-none transition-all duration-150 animate-in fade-in zoom-in-95",style:{top:`${G.rect.top-10}px`,left:`${G.rect.left}px`,transform:"translateY(-100%)"},children:e.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.2)] border border-cyan-100 flex flex-col items-start text-left space-y-1 min-w-[140px] relative",children:[e.jsx("div",{className:"text-sky-600 font-sans text-xs font-bold tracking-wide",children:G.word.ipa||"/?/"}),e.jsx("div",{className:"text-sm font-black text-slate-800 leading-none",children:G.word.meaningVi}),e.jsx("div",{className:"absolute top-full left-4 -mt-1 w-3 h-3 bg-white border-r border-b border-cyan-100 rotate-45 transform"})]})}),N&&e.jsx(gt,{word:N,onClose:()=>w(null),onNavigateToWord:w,onUpdate:y,onEditRequest:a=>{w(null),g(a)},onGainXp:async()=>0,isViewOnly:!0}),b&&e.jsx(ft,{user:n,word:b,onSave:x,onClose:()=>g(null),onSwitchToView:a=>{g(null),w(a)}}),e.jsx(ps,{isOpen:ae,onClose:K,questions:d.comprehensionQuestions||[],answers:M,onAnswerChange:q,results:F,onResultChange:Q})]})},fs=({user:c,unit:n,allWords:d,onDataChange:i,onStartSession:p,onUpdateUser:f,...v})=>{const[N,w]=s.useState(null),[b,g]=s.useState(null),[j,u]=s.useState(!1),[o,h]=s.useState(0),[m,E]=s.useState(10),[k,C]=s.useState(""),[I,$]=s.useState({types:new Set(["all"]),refined:"all",status:"all",register:"all",composition:"all",book:"all"}),[B,z]=s.useState(!1),[A,_]=s.useState({}),[V,ne]=s.useState({}),P=s.useMemo(()=>new Map(d.map(x=>[x.id,x])),[d]),{showToast:y}=_e(),W=s.useMemo(()=>n.wordIds.map(x=>P.get(x)).filter(Boolean),[n,P]);s.useEffect(()=>(window.addEventListener("datastore-updated",i),()=>{window.removeEventListener("datastore-updated",i)}),[i]);const O=s.useCallback(x=>{C(x),h(0)},[]),R=s.useCallback(x=>{$(x),h(0)},[]),ae=()=>{if(n.comprehensionQuestions&&n.comprehensionQuestions.length>0){const x={};n.comprehensionQuestions.forEach((a,r)=>{x[r]=null}),ne(x),_({}),z(!0)}else y("This unit has no comprehension questions.","info")},te=s.useMemo(()=>W.filter(x=>bt(x,k,Array.from(I.types),I.refined,I.status,I.register,"all",null,I.composition,wt(),I.book,jt())),[W,k,I]),K=s.useMemo(()=>{const x=o*m;return te.slice(x,x+m)},[te,o,m]),M=async x=>{let a=n.customVocabString;const r=P.get(x);r&&a&&(a=ge(a).filter(S=>{const[U,H]=S.split(":");return(H||U).trim().toLowerCase()!==r.word.toLowerCase()}).join("; "));const T={...n,wordIds:n.wordIds.filter(S=>S!==x),customVocabString:a,updatedAt:Date.now()};await ce(T),i()},q=async x=>{const a=Array.from(x);let r=n.customVocabString;if(r){const S=new Set(a.map(U=>{var H;return(H=P.get(U))==null?void 0:H.word.toLowerCase()}).filter(Boolean));r=ge(r).filter(U=>{const[H,J]=U.split(":");return!S.has((J||H).trim().toLowerCase())}).join("; ")}const T={...n,wordIds:n.wordIds.filter(S=>!a.includes(S)),customVocabString:r,updatedAt:Date.now()};await ce(T),i()},F=async x=>{await M(x.id),await Ct(x.id),y(`"${x.word}" permanently deleted.`,"success"),i()},Q=async x=>{await q(x),await St(Array.from(x)),y(`Permanently deleted ${x.size} raw word(s).`,"success"),i()},G=async(x,a)=>{const r=x.trim();if(!r)return;const T=r.toLowerCase(),S=ge(n.customVocabString);if(a==="remove"){const U=S.findIndex(Z=>Z.split(":")[0].trim().toLowerCase()===T);if(U===-1)return;const H=S[U].split(":"),J=(H[1]||H[0]).trim();S.splice(U,1);const ie=S.join("; "),le=d.find(Z=>Z.word.toLowerCase()===J.toLowerCase());let Y=n.wordIds;le&&(Y=n.wordIds.filter(Z=>Z!==le.id)),await ce({...n,customVocabString:ie,wordIds:Y,updatedAt:Date.now()})}else{if(S.some(Z=>Z.split(":")[0].trim().toLowerCase()===T))return;const H=await yt(c.id,r);let J=null,ie;if(H)ie=H.id;else{const Z=r.includes(" ");J=Qe(r,"","","","",["ielts"],!1,!1,!1,!1,Z),J.userId=c.id,ie=J.id}const le=Array.from(new Set([...n.wordIds,ie]));S.push(r);const Y=S.join("; ");await kt(J,{...n,customVocabString:Y,wordIds:le,updatedAt:Date.now()})}i()},re=async x=>{await Nt(x),N&&N.id===x.id&&w(x)},ee=async()=>{const x=n.isLearned,a={...n,isLearned:!n.isLearned,updatedAt:Date.now()};if(!x&&c.adventure){const r={...c.adventure,keyFragments:(c.adventure.keyFragments||0)+1};let T=!1;for(;r.keyFragments>=3;)r.keyFragments-=3,r.keys=(r.keys||0)+1,T=!0;const S={...c,adventure:r};await ce(a),await f(S),y("Essay Complete! +1 Key Fragment ðŸŽ‰","success"),T&&y("âœ¨ Key Fragments assembled into a Magic Key!","success",4e3)}else await ce(a);i()},oe=async()=>{try{await vt([n],c.id),y(`Unit "${n.name}" exported successfully.`,"success")}catch{y("Failed to export unit.","error")}};return e.jsx(gs,{...v,user:c,unit:n,allWords:d,onDataChange:i,onStartSession:p,unitWords:W,wordsById:P,pagedUnitWords:K,filteredUnitWords:te,viewingWord:N,setViewingWord:w,editingWord:b,setEditingWord:g,isPracticeMode:j,setIsPracticeMode:u,unitTablePage:o,setUnitTablePage:h,unitTablePageSize:m,setUnitTablePageSize:E,unitTableQuery:k,setUnitTableQuery:O,unitTableFilters:I,setUnitTableFilters:R,handleRemoveWordFromUnit:M,onBulkDelete:q,onHardDelete:F,onBulkHardDelete:Q,handleSaveWordUpdate:re,handleToggleLearnedStatus:ee,onWordAction:G,onUpdateUser:f,handleExportUnit:oe,isComprehensionModalOpen:B,onOpenComprehensionModal:ae,onCloseComprehensionModal:()=>z(!1),comprehensionAnswers:A,onComprehensionAnswerChange:(x,a)=>_(r=>({...r,[x]:a})),comprehensionResults:V,onComprehensionResultChange:(x,a)=>ne(r=>({...r,[x]:a}))})},bs=({isOpen:c,onClose:n,initialName:d,initialDesc:i,onSave:p})=>{const[f,v]=s.useState(d),[N,w]=s.useState(i);return s.useEffect(()=>{c&&(v(d),w(i))},[c,d,i]),c?e.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95",children:e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:"Edit Header"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{value:f,onChange:b=>v(b.target.value),placeholder:"Enter unit title...",className:"w-full px-5 py-4 bg-neutral-50 border border-neutral-200 rounded-2xl text-lg font-bold",autoFocus:!0}),e.jsx("textarea",{value:N,onChange:b=>w(b.target.value),placeholder:"Enter a brief description...",className:"w-full h-32 px-5 py-4 bg-neutral-50 border border-neutral-200 rounded-2xl text-sm font-medium resize-none"})]}),e.jsx("button",{onClick:()=>{p(f,N),n()},className:"px-8 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs uppercase tracking-widest",children:"Update Header"})]})})}):null},ws=({user:c,allWords:n,allLibraryTags:d,onCancel:i,editName:p,setEditName:f,editDesc:v,setEditDesc:N,editPath:w,setEditPath:b,editTags:g,setEditTags:j,editWords:u,setEditWords:o,editEssay:h,setEditEssay:m,editComprehensionQuestions:E,setEditComprehensionQuestions:k,isLearned:C,setIsLearned:I,isSaving:$,handleSaveUnitChanges:B,handleGenerateUnitRefinePrompt:z,handleApplyRefinement:A})=>{const[_,V]=s.useState(!1),[ne,P]=s.useState(!1),[y,W]=s.useState(!1),O=s.useMemo(()=>new Map(n.map(a=>[a.word.toLowerCase().trim(),a])),[n]),[R,ae]=s.useState([]),[te,K]=s.useState(!1),M=s.useRef(null),q=s.useRef(null),F=s.useMemo(()=>u.trim()?ge(u).filter(r=>{const[T,S]=r.split(":"),U=S||T;return!O.has(U.toLowerCase())}):[],[u,O]);s.useEffect(()=>{const a=r=>{q.current&&!q.current.contains(r.target)&&K(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),s.useEffect(()=>{const a=g.split(","),r=a[a.length-1].trim().toLowerCase();if(!r){K(!1);return}const T=new Set(a.slice(0,-1).map(U=>U.trim().toLowerCase())),S=d.filter(U=>U.toLowerCase().includes(r)&&!T.has(U.toLowerCase()));ae(S),K(S.length>0)},[g,d]);const Q=a=>{var T;const r=g.split(",");r[r.length-1]=a,j(r.join(", ")+", "),K(!1),(T=M.current)==null||T.focus()},G=a=>{a.key==="Enter"&&R.length>0?(a.preventDefault(),Q(R[0])):a.key==="Escape"&&K(!1)},re=(a,r)=>{const T=a.trim();if(!T)return;const S=u.split(/[;\n]+/).map(U=>U.trim()).filter(Boolean);if(r==="add"){if(!S.some(U=>U.split(":")[0].trim().toLowerCase()===T.toLowerCase())){const U=S.concat(T).join("; ");o(U)}}else{const U=T.toLowerCase(),H=S.filter(J=>J.split(":")[0].trim().toLowerCase()!==U);o(H.join("; "))}},ee=(a,r,T)=>{const S=[...E];S[a]={...S[a],[r]:T},k(S)},oe=()=>{k([...E,{question:"",answer:""}])},x=a=>{k(E.filter((r,T)=>T!==a))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-[1600px] mx-auto space-y-4 pb-12 relative animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(Ne,{size:14}),e.jsx("span",{children:"Back"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Unit"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>I(!C),className:`px-5 py-2.5 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest transition-all ${C?"bg-green-50 text-green-700 border border-green-200":"bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-50"}`,children:[C?e.jsx(ke,{size:14}):e.jsx(qe,{size:14}),e.jsx("span",{children:C?"Completed":"Mark Complete"})]}),e.jsxs("button",{onClick:()=>W(!0),className:"px-5 py-2.5 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] flex items-center space-x-2 active:scale-95 uppercase tracking-widest hover:bg-neutral-50 transition-all",children:[e.jsx(He,{size:14,className:"text-amber-500"}),e.jsx("span",{children:"AI Refine"})]}),e.jsxs("button",{onClick:B,disabled:$,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-black text-[10px] flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-lg shadow-neutral-900/10",children:[$?e.jsx(Tt,{size:14,className:"animate-spin"}):e.jsx(Et,{size:14}),e.jsx("span",{children:"Save Changes"})]})]})]}),e.jsxs("div",{className:"bg-white px-5 py-4 rounded-3xl border border-neutral-200 shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center gap-6 animate-in slide-in-from-bottom-2 group",children:[e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900 leading-tight",children:p||"Untitled Unit"}),e.jsx("p",{className:"text-sm font-medium text-neutral-500 leading-relaxed whitespace-pre-wrap line-clamp-2",children:v||"No description provided."}),e.jsx("div",{className:"pt-2",ref:q,children:e.jsxs("div",{className:"space-y-1 relative",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-2",children:[e.jsx(Ce,{size:12})," Tags (Keywords)"]}),e.jsx("input",{ref:M,type:"text",value:g,onChange:a=>j(a.target.value),onFocus:()=>K(!0),onKeyDown:G,placeholder:"e.g. Environment, Technology",className:"w-full px-4 py-2 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none",autoComplete:"off"}),te&&R.length>0&&e.jsx("div",{className:"absolute top-full mt-2 w-full bg-white border border-neutral-200 rounded-xl shadow-lg z-10 p-1 animate-in fade-in duration-150",children:R.slice(0,5).map(a=>e.jsx("button",{type:"button",onMouseDown:()=>Q(a),className:"w-full text-left px-3 py-1.5 rounded-md text-sm font-medium hover:bg-neutral-100",children:a},a))})]})})]}),e.jsxs("button",{onClick:()=>P(!0),className:"shrink-0 flex items-center space-x-2 px-4 py-2.5 bg-neutral-50 hover:bg-neutral-100 text-neutral-600 rounded-xl font-bold text-xs transition-all active:scale-95",children:[e.jsx(ss,{size:16}),e.jsx("span",{children:"Edit Name & Desc"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100vh-420px)] min-h-[600px]",children:[e.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center px-1 shrink-0",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ke,{size:12})," Reading Passage"]}),e.jsxs("button",{onClick:()=>V(!_),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[_?e.jsx(Se,{size:12}):e.jsx(Ve,{size:12}),e.jsx("span",{children:_?"Edit Text":"Preview"})]})]}),e.jsx("div",{className:"flex-1 rounded-3xl border border-neutral-200 bg-white shadow-sm relative flex flex-col",children:_?e.jsx(Ye,{className:"rounded-3xl",text:h,vocabString:u,wordsByText:O,onWordAction:re}):e.jsx("textarea",{value:h,onChange:a=>m(a.target.value),placeholder:"Paste or write your reading material here...",className:"w-full h-full p-6 bg-white resize-none focus:bg-neutral-50/30 outline-none transition-all text-sm font-medium leading-relaxed text-neutral-900 placeholder:text-neutral-300 overflow-y-auto stable-scrollbar rounded-3xl"})})]}),e.jsxs("div",{className:"flex flex-col gap-4 h-full overflow-y-auto pr-2 custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-[3] min-h-[350px]",children:[e.jsxs("div",{className:"flex justify-between items-center px-1 shrink-0",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:"Target Vocabulary"}),e.jsxs("span",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest",children:[u.split(/[:;,\n]+/).filter(Boolean).length," items"]})]}),e.jsx("div",{className:"flex-1 relative rounded-3xl border border-neutral-200 bg-white shadow-sm overflow-hidden flex flex-col",children:e.jsx("textarea",{value:u,onChange:a=>o(a.target.value),placeholder:"word; essay_word:base_word; ...",className:"w-full flex-1 p-6 bg-transparent resize-none outline-none text-sm font-medium leading-relaxed text-neutral-900 overflow-auto font-sans placeholder:text-neutral-300 focus:bg-neutral-50/10",spellCheck:!1})}),F.length>0&&e.jsxs("div",{className:"p-4 bg-rose-50 border border-rose-100 rounded-2xl animate-in slide-in-from-top-2 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-rose-600",children:[e.jsx(At,{size:14}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest",children:["Not in Library (",F.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:F.map((a,r)=>e.jsx("span",{className:"px-2 py-0.5 bg-white border border-rose-200 rounded-md text-[10px] font-bold text-rose-700 shadow-sm",children:a},r))}),e.jsx("p",{className:"mt-2 text-[9px] text-rose-400 italic",children:"These will be automatically created when you save."})]}),e.jsxs("p",{className:"text-[9px] text-neutral-400 px-2 font-medium italic text-right shrink-0",children:["Use ",e.jsx("span",{className:"text-neutral-600 font-bold",children:"essay_word:base_word"})," format for complex sentences."]})]}),e.jsxs("div",{className:"flex flex-col gap-2 flex-[2] min-h-[200px]",children:[e.jsx("div",{className:"flex justify-between items-center px-1 shrink-0",children:e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(je,{size:12})," Comprehension Questions"]})}),e.jsxs("div",{className:"flex-1 space-y-3 p-4 bg-white border border-neutral-200 rounded-3xl shadow-sm overflow-y-auto custom-scrollbar",children:[E.map((a,r)=>e.jsxs("div",{className:"p-3 bg-neutral-50 rounded-2xl border border-neutral-200/80 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("textarea",{value:a.question,onChange:T=>ee(r,"question",T.target.value),rows:2,placeholder:`Question ${r+1}`,className:"w-full text-xs font-bold text-neutral-800 p-2 bg-white rounded-lg border border-neutral-200 focus:ring-1 focus:ring-neutral-900 outline-none resize-y"}),e.jsx("button",{onClick:()=>x(r),className:"p-2 text-neutral-400 hover:text-red-500 hover:bg-red-50 rounded-full",children:e.jsx(ye,{size:14})})]}),e.jsx("textarea",{value:a.answer,onChange:T=>ee(r,"answer",T.target.value),rows:2,placeholder:`Answer ${r+1}`,className:"w-full text-xs font-medium text-neutral-600 p-2 bg-white rounded-lg border border-neutral-200 focus:ring-1 focus:ring-neutral-900 outline-none resize-y"})]},r)),e.jsxs("button",{onClick:oe,className:"w-full flex items-center justify-center gap-2 py-3 bg-neutral-100 text-neutral-500 hover:text-neutral-900 rounded-xl text-xs font-bold uppercase tracking-wider transition-colors",children:[e.jsx(we,{size:14})," Add Question"]})]})]})]})]})]}),e.jsx(bs,{isOpen:ne,onClose:()=>P(!1),initialName:p,initialDesc:v,onSave:(a,r)=>{f(a),N(r)}}),y&&e.jsx(Ge,{isOpen:y,onClose:()=>W(!1),type:"REFINE_UNIT",title:"Refine Unit",description:"Update vocabulary and essay content with AI context.",initialData:{request:""},onGeneratePrompt:z,onJsonReceived:A,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},js=({user:c,unit:n,allWords:d,allLibraryTags:i,onCancel:p,onSave:f})=>{const[v,N]=s.useState(n.name),[w,b]=s.useState(n.description),[g,j]=s.useState(n.path||"/"),[u,o]=s.useState((n.tags||[]).join(", ")),[h,m]=s.useState(""),[E,k]=s.useState(n.essay||""),[C,I]=s.useState([]),[$,B]=s.useState(n.isLearned||!1),[z,A]=s.useState(!1),_=s.useMemo(()=>new Map(d.map(y=>[y.word.toLowerCase().trim(),y])),[d]);s.useEffect(()=>{if(N(n.name),b(n.description),n.path===void 0){const y=n.tags||[],W=y.find(R=>R.startsWith("/")),O=y.filter(R=>!R.startsWith("/"));j(W||"/"),o(O.join(", "))}else j(n.path||"/"),o((n.tags||[]).join(", "));if(k(n.essay||""),I(n.comprehensionQuestions||[]),B(n.isLearned||!1),n.customVocabString)m(n.customVocabString);else{const y=new Map(d.map(O=>[O.id,O])),W=n.wordIds.map(O=>{var R;return(R=y.get(O))==null?void 0:R.word}).filter(Boolean).join("; ");m(W)}},[n,d]);const V=async()=>{A(!0);try{const y=ge(h),W=new Set;for(const M of y){const[q,F]=M.split(":"),Q=(F||q).trim();Q&&W.add(Q.toLowerCase())}const O=[],R=[];for(const M of W){const q=_.get(M);if(q)O.push(q.id);else{const F=M.includes(" "),Q=Qe(M,"","","","",["ielts"],!1,!1,!1,!1,F);Q.userId=c.id,R.push(Q),O.push(Q.id)}}R.length>0&&await It(R);const ae=u.split(",").map(M=>M.trim()).filter(Boolean),te=C.filter(M=>M.question.trim()&&M.answer.trim()),K={...n,name:v,description:w,essay:E,wordIds:O,customVocabString:h,path:g,tags:ae,comprehensionQuestions:te,isLearned:$,updatedAt:Date.now()};await ce(K),f()}finally{A(!1)}},ne=y=>Je(v,w,h,E,y.request,c),P=async y=>{N(y.name),b(y.description),m(Array.isArray(y.words)?y.words.join("; "):y.words),k(y.essay),I(y.comprehensionQuestions||[])};return e.jsx(ws,{user:c,unit:n,allWords:d,allLibraryTags:i,onCancel:p,editName:v,setEditName:N,editDesc:w,setEditDesc:b,editPath:g,setEditPath:j,editTags:u,setEditTags:o,editWords:h,setEditWords:m,editEssay:E,setEditEssay:k,editComprehensionQuestions:C,setEditComprehensionQuestions:I,isLearned:$,setIsLearned:B,isSaving:z,handleSaveUnitChanges:V,handleGenerateUnitRefinePrompt:ne,handleApplyRefinement:P})},Fe=()=>"u-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Pe="vocab_pro_reading_view_settings",Fs=({user:c,onStartSession:n,onUpdateUser:d})=>{var Ie;const[i,p]=s.useState([]),[f,v]=s.useState([]),[N,w]=s.useState([]),[b,g]=s.useState(!0),[j,u]=s.useState("LIST"),[o,h]=s.useState(null),[m,E]=s.useState(null),[k,C]=s.useState(null),[I,$]=s.useState(null),[B,z]=s.useState(!1),[A,_]=s.useState(0),[V,ne]=s.useState(12),[P,y]=s.useState(null),[W,O]=s.useState(!1),[R,ae]=s.useState(!1),[te,K]=s.useState(!1),[M,q]=s.useState("all"),[F,Q]=s.useState("all"),[G,re]=s.useState(()=>$e(Pe,{showDesc:!0,compact:!1})),{currentShelfName:ee,booksOnCurrentShelf:oe,allShelves:x,addShelf:a,renameShelf:r,removeShelf:T,nextShelf:S,prevShelf:U}=Ot(f,"reading_books_shelves"),[H,J]=s.useState(!1),[ie,le]=s.useState(!1),[Y,Z]=s.useState(null),{showToast:fe}=_e();s.useEffect(()=>{We(Pe,G)},[G]);const X=s.useCallback(async()=>{g(!0);try{const[t,l,L]=await Promise.all([Ut(c.id),Mt(c.id),zt(c.id)]);p(t.sort((D,se)=>se.createdAt-D.createdAt)),v(l.sort((D,se)=>se.createdAt-D.createdAt)),w(L)}finally{g(!1)}},[c.id]);s.useEffect(()=>{X()},[X]),s.useEffect(()=>{_(0)},[P,M,F,V]);const ue=s.useMemo(()=>i.filter(t=>{var l,L;if(M==="focused"&&!t.isFocused||F!=="all"&&t.focusColor!==F)return!1;if(P){if(P==="Uncategorized"){const D=t.path;return!(D&&D!=="/"&&D!=="")}return((l=t.path)==null?void 0:l.startsWith(P))||((L=t.tags)==null?void 0:L.includes(P))}return!0}),[i,P,M,F]),Xe=s.useMemo(()=>{const t=A*V;return ue.slice(t,t+V)},[ue,A,V]),Ze=t=>{r(t,async(L,D)=>{g(!0);const se=f.filter(xe=>{const me=xe.title.split(":");return(me.length>1?me[0].trim():"General")===L});await Promise.all(se.map(xe=>{const me=xe.title.split(":"),Ue=me.length>1?me.slice(1).join(":").trim():xe.title,it=`${D}: ${Ue}`;return pe({...xe,title:it,updatedAt:Date.now()})})),await X()})&&le(!1)},Te=async()=>{const t={id:`rb-${Date.now()}`,userId:c.id,title:`${ee}: New Book`,unitIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#5d4037",icon:"ðŸ“š"};await pe(t),await X(),E(t),u("BOOK_DETAIL"),fe("New book created.","success")},ve=t=>{if(!m)return;const l={...m,...t,updatedAt:Date.now()};v(L=>L.map(D=>D.id===l.id?l:D)),E(l),pe(l)},et=async()=>{I&&(await Dt(I.id),fe("Book deleted.","success"),$(null),await X())},tt=async t=>{if(!Y)return;const l=Y.title.split(":"),L=l.length>1?l.slice(1).join(":").trim():l[0],D=`${t}: ${L}`,se={...Y,title:D,updatedAt:Date.now()};await pe(se),Z(null),await X(),fe(`Moved to "${t}".`,"success")},st=async()=>{const t={id:Fe(),userId:c.id,name:"New Unit",description:"",wordIds:[],createdAt:Date.now(),updatedAt:Date.now(),essay:"",path:"/"};await be(t),await X(),h(t),u("EDIT")},nt=async()=>{if(!k)return;await ze(k.id);const t=f.filter(l=>l.unitIds.includes(k.id));t.length>0&&await Promise.all(t.map(l=>pe({...l,unitIds:l.unitIds.filter(L=>L!==k.id)}))),fe("Unit deleted.","success"),C(null),X()},Ee=async(t,l)=>{const L={...t,focusColor:l||void 0,updatedAt:Date.now()};l||delete L.focusColor,p(D=>D.map(se=>se.id===t.id?L:se)),await be(L)},Ae=async t=>{const l={...t,isFocused:!t.isFocused,updatedAt:Date.now()};p(L=>L.map(D=>D.id===t.id?l:D)),await be(l)},at=s.useMemo(()=>m?m.unitIds.map(t=>{const l=i.find(L=>L.id===t);return l?{id:l.id,title:l.name,subtitle:l.description,data:l,isCompleted:l.isLearned,focusColor:l.focusColor,isFocused:l.isFocused}:null}).filter(t=>t!==null):[],[m,i]),rt=s.useMemo(()=>i.map(t=>({id:t.id,title:t.name,subtitle:`${t.wordIds.length} words`,data:t})),[i]),ot=t=>{if(!m)return;const l=Array.from(new Set([...m.unitIds,...t]));ve({unitIds:l})},lt=t=>{if(!m)return;const l=m.unitIds.filter(L=>L!==t);ve({unitIds:l})};if(j==="READ"&&o)return e.jsx(fs,{user:c,unit:o,allWords:N,onBack:()=>{u(m?"BOOK_DETAIL":"LIST"),m||h(null),X()},onDataChange:X,onStartSession:n,onSwitchToEdit:()=>u("EDIT"),onUpdateUser:d});if(j==="EDIT"&&o){const t=[...new Set(i.flatMap(l=>l.tags||[]))].sort();return e.jsx(js,{user:c,unit:o,allWords:N,allLibraryTags:t,onCancel:()=>{o.name==="New Unit"&&!o.essay&&o.wordIds.length===0&&ze(o.id),u(m?"BOOK_DETAIL":"LIST"),m||h(null),X()},onSave:()=>{X(),u("READ")}})}return j==="BOOK_DETAIL"&&m?e.jsx($t,{book:m,items:at,availableItems:rt,onBack:()=>{E(null),u("SHELF"),X()},onUpdateBook:ve,onAddItem:ot,onRemoveItem:lt,onOpenItem:t=>{h(t.data),u("READ")},onEditItem:t=>{h(t.data),u("EDIT")},onFocusChange:(t,l)=>Ee(t.data,l),onToggleFocus:t=>Ae(t.data),itemIcon:e.jsx(Le,{size:16})}):j==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>u("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(Ne,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Reading Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Browse your books."})]}),e.jsxs("button",{onClick:()=>J(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(Kt,{size:14})," Add Shelf"]})]})]}),e.jsxs(Wt,{label:ee,onNext:x.length>1?S:void 0,onPrev:x.length>1?U:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>le(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(es,{size:14})}),e.jsx("button",{onClick:T,disabled:oe.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(he,{size:14})})]}),isEmpty:oe.length===0,emptyAction:e.jsx("button",{onClick:Te,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[oe.map(t=>{const l=t.title.split(":"),L=l.length>1?l.slice(1).join(":").trim():t.title;return e.jsx(Vt,{id:t.id,title:L,subTitle:`${t.unitIds.length} Units`,icon:e.jsx(Lt,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{E(t),u("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:D=>{D.stopPropagation(),Z(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Zt,{size:16})}),e.jsx("button",{onClick:D=>{D.stopPropagation(),$(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(he,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:Te,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(we,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(Re,{isOpen:!!I,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(Ie=I==null?void 0:I.title.split(":").pop())==null?void 0:Ie.trim(),'"']}),"? Units inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:et,onClose:()=>$(null),icon:e.jsx(he,{size:40,className:"text-red-500"})}),e.jsx(Jt,{isOpen:!!Y,onClose:()=>Z(null),onConfirm:tt,shelves:x,currentShelf:Y?Y.title.split(":")[0].trim():"General",bookTitle:(Y==null?void 0:Y.title)||""}),e.jsx(Yt,{isOpen:H,onClose:()=>J(!1),onSave:t=>{a(t)&&J(!1)}}),e.jsx(Xt,{isOpen:ie,onClose:()=>le(!1),onSave:Ze,initialName:ee})]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{title:"Reading Library",subtitle:"Curated collections for intensive reading & vocab.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Open%20Book.png",className:"w-8 h-8 object-contain",alt:"Reading"}),config:{},isLoading:b,isEmpty:ue.length===0,emptyMessage:"No reading units found.",activeFilters:{},onFilterChange:()=>{},pagination:{page:A,totalPages:Math.ceil(ue.length/V),onPageChange:_,pageSize:V,onPageSizeChange:ne,totalItems:ue.length},aboveGrid:e.jsxs(e.Fragment,{children:[W&&e.jsx(De,{items:i,selectedTag:P,onSelectTag:y,forcedView:"groups",title:"Browse Groups",icon:e.jsx(Gt,{size:16})}),R&&e.jsx(De,{items:i,selectedTag:P,onSelectTag:y,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Ce,{size:16})})]}),actions:e.jsx(Ht,{viewMenu:e.jsx(_t,{isOpen:te,setIsOpen:K,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Rt,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>q(M==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${M==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:M==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Q(F==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${F==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>Q(F==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${F==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>Q(F==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${F==="red"?"bg-rose-500 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Description",checked:G.showDesc,onChange:()=>re(t=>({...t,showDesc:!t.showDesc}))},{label:"Compact",checked:G.compact,onChange:()=>re(t=>({...t,compact:!t.compact}))}]}),browseGroups:{isOpen:W,onToggle:()=>{O(!W),ae(!1)}},browseTags:{isOpen:R,onToggle:()=>{ae(!R),O(!1)}},addActions:[{label:"AI Unit",icon:He,onClick:()=>z(!0)},{label:"New Unit",icon:we,onClick:st}],extraActions:e.jsxs("button",{onClick:()=>u("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(ts,{size:16}),e.jsx("span",{children:"Bookshelf"})]})}),children:()=>e.jsx(e.Fragment,{children:Xe.map(t=>e.jsx(qt,{title:t.name,tags:t.tags,compact:G.compact,onClick:()=>{h(t),u("READ")},focusColor:t.focusColor,onFocusChange:l=>Ee(t,l),isFocused:t.isFocused,onToggleFocus:()=>Ae(t),isCompleted:t.isLearned,actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),h(t),u("READ")},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(Le,{size:14})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),h(t),u("EDIT")},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Se,{size:14})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),C(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(he,{size:14})})]}),children:G.showDesc&&t.description&&e.jsx("p",{className:"line-clamp-2",children:t.description})},t.id))})}),e.jsx(Re,{isOpen:!!k,title:"Delete Unit?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',k==null?void 0:k.name,'"']}),"?"]}),confirmText:"Delete",isProcessing:!1,onConfirm:nt,onClose:()=>C(null),icon:e.jsx(he,{size:40,className:"text-red-500"})}),B&&e.jsx(Ge,{isOpen:B,onClose:()=>z(!1),type:"GENERATE_UNIT",title:"AI Reading Unit",description:"Generate a new reading unit from a topic.",initialData:{request:""},onGeneratePrompt:t=>Je("New Unit","","","",t.request,c),onJsonReceived:async t=>{const l={id:Fe(),userId:c.id,name:t.name,description:t.description,wordIds:[],customVocabString:(t.words||[]).join("; "),essay:t.essay,comprehensionQuestions:t.comprehensionQuestions||[],createdAt:Date.now(),updatedAt:Date.now(),path:ee==="General"?"/":`/${ee}`};await be(l),await X(),h(l),u("EDIT")},actionLabel:"Generate",closeOnSuccess:!0})]})};export{Fs as ReadingUnitPage};
