import{c as Ge,r as s,bd as he,s as pe,j as e,A as fe,p as ae,q as Ue,ah as it,a0 as ze,bG as xe,i as ge,a6 as be,E as lt,D as Ne,aj as we,k as Se,bD as ue,a7 as Le,b3 as Re,bH as rt,a as ct,bI as dt,bJ as se,G as ut,a5 as ht,bK as pt,bL as xt,K as gt,bM as K,ao as te,a3 as mt,aq as Oe,bN as ft,bO as bt}from"./index-DslJiicI.js";import{R as Nt}from"./ResourcePage-BfOjKlOc.js";import{T as wt}from"./TagBrowser-yV2AW7bC.js";import{U as St}from"./UniversalCard-B81WlXfN.js";import{T as Be}from"./tag-CltrWNWf.js";import{H as me}from"./headphones-Bfv0K41V.js";import{P as De}from"./pause-CVUaeKtI.js";import{C as vt}from"./chevron-left-CpRtvSZX.js";import{F as jt,U as Ct,a as Tt,M as Et,A as kt,R as At}from"./ShelfModals-SsVZm6UP.js";import{u as yt,G as It,S as Me}from"./ShelfSearchBar-DbFxhcw7.js";import{M as Lt}from"./move-mHVSVAQG.js";import{P as Rt}from"./pen-91lbKJrp.js";import{F as Ot}from"./file-clock-mWzz2EKt.js";import"./folder-B97S4y_F.js";import"./palette-D96tiXJO.js";import"./square-check-big-Cq_cWMW9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Ge("GalleryHorizontalEnd",[["path",{d:"M2 7v10",key:"a2pl2d"}],["path",{d:"M6 5v14",key:"1kq3d7"}],["rect",{width:"12",height:"18",x:"10",y:"3",rx:"2",key:"13i7bc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Ge("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);function ve(n){const{currentLesson:d,userRequest:v,language:A,tone:j,coachName:l,task:h,topic:g}=n,I=A==="Vietnamese",N=I?"Vietnamese":"English",b=I?"[Audio-VN]":"[Audio-EN]";let m="",w="",p="",C="";return h==="create_reading"?(m=`Create an immersive, high-impact lesson for a ${n.targetAudience} on: "${g}".`,w=`
       STYLE: COMPACT RICH ARTICLE (READING)
       - **COMPACT FORMAT**: Minimize vertical space. **NO double newlines (

)**. **NO horizontal rules (---)**. Keep the layout dense.
       - Use Markdown Headers (###) to separate sections.
       - **RICH ELEMENTS**: 
         1. **TABLES**: Use strictly for **Comparative Matrices** or **System Maps** at the end. âŒ **PROHIBITED**: Do NOT use tables to enumerate words without contrast or explanation per cell. Use bullet points for lists.
         2. Use **[Tip: ...]** blocks for "Did you know?" or "Examiner Tip".
         3. Use **[HIDDEN: ...]** tags ONLY for **Interactive Q&A**. 
            - **RULE**: The QUESTION must be visible OUTSIDE the tag. Only the ANSWER is inside.
            - Format: "Question? [HIDDEN: Answer]"
         4. Use **[Formula: Part | Part]** for grammar patterns. Format: "[Formula: If | S | V(past)]".
         5. Use **Emojis** to engage the ${n.targetAudience} audience.
       - **EXAMPLES**: Use Markdown Blockquotes (>) for examples.`,C=`
      PEDAGOGICAL FLOW:
      1. **TEACHING**: Teach concepts clearly with nuance and examples.
      2. **CONSOLIDATION**: End with a summary or comparison table.
      
      CRITICAL FORMATTING RULES:
      1. **NO META LABELS**: DO NOT use labels like "Nuance:", "Scenario Change:", "Context:", "Meaning:", "Definition:".
      2. **NATURAL WRITING**: Weave the nuance and context *into* the sentence naturally.
      3. **HEADERS**: Use standard Markdown headers (###) for the specific content topics.

      STRICT TEACHING RULES:
      1. **EXPLAIN EVERY ITEM**: For every vocabulary item, collocation, or idiom:
         - You MUST explain the **Nuance** (Why this word? What does it imply that others don't?).
         - You MUST provide a natural **Example Sentence**.
      2. **COMPARE PARAPHRASES**: Do not just list synonyms. Explain the **Scenario Change**. 
      3. **COACHING FLOW**: Structure the lesson as a guided walkthrough.
      `):h==="convert_to_listening"?(m="TRANSFORM the provided Reading Lesson into a high-quality NATURAL AUDIO SCRIPT.",p=`SOURCE: ${d==null?void 0:d.title}
${d==null?void 0:d.content}`,w=`
    - **Narrative Style**: Convert bullet points into natural spoken sentences.
    - **Context Focus**: For every term, explain 'When' and 'Why'.
    - **Individual Examples**: Provide an example sentence for every phrase mentioned.
    - **Language**: All coaching in ${N}.
    - **Audio Strategy (CRITICAL)**: 
      1. Wrap EVERY sentence in audio tags. 
      2. **NO MIXED LANGUAGES**: Do NOT put English words inside ${b} tags. Split them out into [Audio-EN] tags.
         - âŒ Bad: ${b}Tá»« hello nghÄ©a lÃ  xin chÃ o[/]
         - âœ… Good: ${b}Tá»«[/] [Audio-EN]hello[/] ${b}nghÄ©a lÃ  xin chÃ o[/]`):(m="REFINE the lesson to focus on Contextual Nuance and Visual Clarity.",p=`CURRENT: ${d==null?void 0:d.title}
${d==null?void 0:d.content}
REQUEST: "${v||"Improve layout and examples."}"`,w=`
    - **Teach, Don't List**: Convert any bulleted lists of words into guided explanations.
    - **COMPACT FORMAT**: Minimize vertical space. **NO double newlines (

)**. **NO horizontal rules (---)**.
    - **Rich Formatting**: Incorporate Markdown Tables ONLY for Comparisons/Matrices. âŒ **PROHIBITED**: Do NOT use tables for simple word lists without contrast. Use **[HIDDEN: ...]** ONLY for Q&A reveals (Question outside, Answer inside).
    - **Nuance Mapping**: Explain the difference between similar paraphrases or collocations.
    - **REMOVE QUIZZES**: Strictly remove any [Quiz:], [Select:], or [Multi:] tags. This content is for reading only.`,C=`
    PEDAGOGICAL FLOW:
    1. **TEACHING**: Ensure concepts are explained separately first with nuance and examples.
    2. **SUMMARY**: Ensure the lesson ends with a structural summary. Use a table if applicable.
    
    CRITICAL FORMATTING RULES:
    1. **NO META LABELS**: DO NOT use labels like "Nuance:", "Scenario Change:", "Context:", "Meaning:".
    2. **NATURAL WRITING**: Weave the nuance and context *into* the sentence naturally.
    3. **HEADERS**: Use standard Markdown headers (###).
    `),`You are expert IELTS coach '${l}', acting as a ${j==="friendly_elementary"?"friendly mentor":"professor"}.
    
  TASK: ${m}

  ${p}

  ${C}

  ${w}

  STRICT CONTENT RULES:
  1. NO generic introductions.
  2. MANDATORY: All coaching text in ${N}.
  3. **NO QUIZZES**: Absolutely NO interactive tags ([Quiz], [Select], [Multi]). Provide pure educational content.
  4. **TAGS**: Select tags ONLY from: ["Grammar", "Pattern", "Speaking", "Listening", "Reading", "Writing", "General", "Comparison", "Vocabulary"].
  5. **QUANTITY**: Return EXACTLY ONE tag. Choose the most primary skill only.

  CRITICAL OUTPUT RULES:
  1. **MARKDOWN CODE BLOCK**: You MUST wrap your entire JSON response in a markdown code block (e.g. \`\`\`json { ... } \`\`\`).
  2. **VALID JSON**: The content inside the code block must be valid, parsable JSON.
  3. **NO RAW NEWLINES IN STRINGS**: Inside the "content" string, you MUST use literal '\\n' for line breaks. Do NOT use actual newline characters.
  4. **ESCAPE CHARACTERS**: Properly escape all double quotes and backslashes within strings.

  OUTPUT TEMPLATE:
  \`\`\`json
  {
    "title": "string",
    "description": "string",
    "content": "string",
    "tags": ["string"]
  }
  \`\`\``}function Fe(n,d,v,A=[]){const j=A.join(", ");return`You are an expert IELTS examiner. 
  
  TASK: Generate a creative and comprehensive PRACTICE TEST based on the following lesson content.
  
  LESSON TITLE: "${n}"
  LESSON CONTENT: "${d}"
  USER REQUEST: "${v||""}"
  TAGS: "${j}"

  AVAILABLE INTERACTIVE TAGS:
  1. **Dropdown**: [Select: Correct | Distractor 1 | Distractor 2]
     - Use for sentence completion, synonyms, or choosing the best fit.
  2. **Multiple Choice**: [Multi: Correct | Distractor 1 | Distractor 2]
     - Use for checking definitions, tones, or concepts.
  3. **Fill-in-the-blank**: [Quiz: Answer]
     - **CONSTRAINT**: Use this ONLY if the answer is absolutely unambiguous (e.g. spelling check, specific term recall) OR if the User Request specifically asks for fill-in/typing questions.

  STRUCTURE STRATEGY:
  Analyze the content and tags.

  **CASE A: VOCABULARY LESSON** (e.g. tags include "Vocabulary", "Vocab", or content is a list of words/phrases)
  If this is primarily a vocabulary lesson, follow this structure:
  1. **Section 1: Vocabulary Selection (3-5 items)**: Use [Select: Correct | Wrong 1 | Wrong 2] to test the nuance of collocations or specific words from the lesson.
  2. **Section 2: Meaning Matching (2-4 items)**: Use [Multi: Correct | Option 2 | Option 3] to match a term to its definition.
  3. **Section 3: Contextual Use (2-4 items)**: Provide short sentences with blanks using [Select: ...] where the user chooses the best synonym for a specific tone.

  **CASE B: OTHER LESSONS** (Grammar, General, Skills, etc.)
  - **Creative Flow**: Design a test flow that best suits the specific concepts taught (e.g., rewriting sentences, identifying errors, filling gaps).
  - Do NOT follow the fixed 3-section structure of Case A unless it fits perfectly.
  - **Contextual**: Focus on testing application in context.

  GENERAL GUIDELINES:
  - **No Repetition**: Do not simply repeat the essay text. Create new sentences or scenarios to test the knowledge.
  - **Language**: Instructions in the same language as the lesson's explanations (Vietnamese/English). Target material in English.

  Return a JSON object:
  {
    "content": "string (Markdown with interactive test components)"
  }`}const Pt=n=>{const{title:d,setTitle:v,description:A,setDescription:j,tagsInput:l,setTagsInput:h,content:g,setContent:I,listeningContent:N,setListeningContent:b,testContent:m,setTestContent:w,isSaving:p,onSave:C,onPractice:F,onCancel:$,onOpenAiRefine:Y}=n,[T,W]=s.useState("READING"),[y,E]=s.useState(!1),k=s.useMemo(()=>{let x="";return T==="READING"?x=g:T==="LISTENING"?x=N:x=m,he(x)},[g,N,m,T]);return s.useEffect(()=>(window.handleLessonSpeak=x=>{pe(x)},()=>{delete window.handleLessonSpeak}),[]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in duration-300 pb-20",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:$,className:"flex items-center space-x-2 text-sm font-bold text-neutral-400 hover:text-neutral-900 transition-colors mb-1",children:[e.jsx(fe,{size:16}),e.jsx("span",{children:"Back to Lesson Library"})]}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Edit Lesson"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:F,disabled:p,className:"px-5 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center space-x-2 active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(ae,{size:14}),e.jsx("span",{children:"Read Mode"})]}),e.jsxs("button",{onClick:C,disabled:p,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center space-x-2 transition-all active:scale-95 hover:bg-neutral-800 disabled:opacity-50 uppercase tracking-widest shadow-sm",children:[p?e.jsx(Ue,{size:14,className:"animate-spin"}):e.jsx(it,{size:14}),e.jsx("span",{children:p?"Saving...":"Save Lesson"})]})]})]}),e.jsxs("div",{className:"space-y-6 bg-white p-8 rounded-3xl border border-neutral-200 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1",children:"Lesson Title"}),e.jsx("input",{type:"text",value:d,onChange:x=>v(x.target.value),className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-lg font-bold focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 flex items-center gap-1",children:[e.jsx(Be,{size:12})," Tags (Keywords)"]}),e.jsx("input",{type:"text",value:l,onChange:x=>h(x.target.value),placeholder:"e.g. Grammar, Writing Task 2",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-neutral-900 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-neutral-400 uppercase tracking-widest px-1 mb-1",children:"Short Description"}),e.jsx("textarea",{value:A,onChange:x=>j(x.target.value),rows:2,className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-sm leading-relaxed resize-y focus:ring-2 focus:ring-neutral-900 outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1",children:[e.jsxs("button",{onClick:()=>{W("READING"),E(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${T==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ze,{size:12,className:"inline mr-1"})," Reading"]}),e.jsxs("button",{onClick:()=>{W("LISTENING"),E(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${T==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Audio Script"]}),e.jsxs("button",{onClick:()=>{W("TEST"),E(!1)},className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${T==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Test"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Y(T==="READING"?"reading":T==="LISTENING"?"listening":"test"),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-all text-[10px] font-black uppercase text-indigo-600 shadow-sm",children:[e.jsx(ge,{size:12}),e.jsxs("span",{children:["Generate ",T==="LISTENING"?"Audio Script":T]})]}),e.jsxs("button",{onClick:()=>E(!y),className:"flex items-center space-x-1.5 px-3 py-1.5 rounded-lg bg-white border border-neutral-200 hover:bg-neutral-50 transition-all text-[10px] font-black uppercase text-neutral-500 hover:text-neutral-900 shadow-sm",children:[y?e.jsx(be,{size:12}):e.jsx(lt,{size:12}),e.jsx("span",{children:y?"Edit":"Preview"})]})]})]}),e.jsx("div",{className:"bg-white border border-neutral-200 rounded-2xl shadow-sm h-[500px] relative overflow-hidden",children:y?e.jsx("div",{className:"p-6 prose prose-sm max-w-none prose-headings:font-black prose-p:text-neutral-600 prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600 overflow-y-auto absolute inset-0 bg-neutral-50/30",dangerouslySetInnerHTML:{__html:k}}):e.jsx("textarea",{value:T==="READING"?g:T==="LISTENING"?N:m,onChange:x=>{T==="READING"?I(x.target.value):T==="LISTENING"?b(x.target.value):w(x.target.value)},className:"absolute inset-0 w-full h-full p-6 resize-none focus:outline-none text-sm leading-relaxed font-medium text-neutral-900 bg-white font-mono",placeholder:`Write ${T.toLowerCase()} content here...`,spellCheck:!1})})]})]})]})},Gt=({lesson:n,user:d,onSave:v,onPractice:A,onCancel:j})=>{const[l,h]=s.useState(n.title),[g,I]=s.useState(n.description||""),[N,b]=s.useState(n.path||"/"),[m,w]=s.useState((n.tags||[]).join(", ")),[p,C]=s.useState(n.content),[F,$]=s.useState(n.listeningContent||""),[Y,T]=s.useState(n.testContent||""),[W,y]=s.useState(!1),[E,k]=s.useState(null),{showToast:x}=Ne(),G=n.topic1,q=n.topic2;s.useEffect(()=>{if(n.path===void 0&&n.tags){const S=n.tags||[],R=S.find(M=>M.startsWith("/")),r=S.filter(M=>!M.startsWith("/"));b(R||"/"),w(r.join(", "))}else b(n.path||"/"),w((n.tags||[]).join(", "))},[n]);const L=()=>{const S=m.split(",").map(R=>R.trim()).filter(Boolean);return{...n,title:l,description:g,topic1:G,topic2:q,path:N.trim(),tags:S,content:p,listeningContent:F,testContent:Y,updatedAt:Date.now()}},ne=()=>{y(!0);const S=L();v(S)},D=()=>{y(!0);const S=L();A(S)},Q=S=>{var i,u,O;const R=Se(),r=R.audioCoach.activeCoach,M=R.audioCoach.coaches[r].name,P=(E==null?void 0:E.format)||S.format;if(P==="test"){const U=m.split(",").map(z=>z.trim()).filter(Boolean);return Fe(l,p,S.request,U)}return ve({task:P==="listening"?"convert_to_listening":"refine_reading",currentLesson:{title:l,description:g,content:p},userRequest:S.request,language:S.language||((i=d.lessonPreferences)==null?void 0:i.language)||"English",targetAudience:((u=d.lessonPreferences)==null?void 0:u.targetAudience)||"Adult",tone:S.tone||((O=d.lessonPreferences)==null?void 0:O.tone)||"professional_professor",coachName:M})},_=S=>{const{result:R}=S,r=R||S,M=E==null?void 0:E.format;M==="listening"?r.content?($(r.content),x("Listening script updated!","success")):x("Failed to generate listening content.","error"):M==="test"?r.content?(T(r.content),x("Practice test generated!","success")):x("Failed to generate test.","error"):(r.title&&h(r.title),r.description&&I(r.description),r.content&&C(r.content),!m.trim()&&r.tags&&r.tags.length>0&&w(r.tags.join(", ")),x("Lesson content refined!","success")),k(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Pt,{title:l,setTitle:h,description:g,setDescription:I,path:N,setPath:b,tagsInput:m,setTagsInput:w,content:p,setContent:C,listeningContent:F,setListeningContent:$,testContent:Y,setTestContent:T,isSaving:W,onSave:ne,onPractice:D,onCancel:j,onOpenAiRefine:S=>k({format:S||"reading"})}),E&&e.jsx(we,{isOpen:!!E,onClose:()=>k(null),type:"REFINE_UNIT",title:`Generate ${E.format}`,description:`AI will create the ${E.format} component for this lesson.`,initialData:{...d.lessonPreferences,format:E.format},onGeneratePrompt:Q,onJsonReceived:_,actionLabel:"Apply Changes"})]})},Ut=n=>{if(!n)return[];const d=n.split(`
`),v=[];let A="Introduction",j=[];const l=()=>{(j.length>0||v.length===0&&A==="Introduction")&&(j.join(`
`).trim()||v.length>0)&&v.push({title:A,content:j.join(`
`)})};return d.forEach(h=>{const g=h.trim().match(/^(#{1,3})\s+(.+)/);g?(l(),A=g[2].trim(),j=[h]):j.push(h)}),l(),v.length>1&&v[0].title==="Introduction"&&!v[0].content.trim()&&v.shift(),v.length>0?v:[{title:"Lesson",content:n}]},zt=({lesson:n,onComplete:d,onEdit:v,onAddSound:A,onAddTest:j})=>{var P;const[l,h]=s.useState("READING"),[g,I]=s.useState("SCROLL"),[N,b]=s.useState(0),[m,w]=s.useState("IDLE"),[p,C]=s.useState(-1),[F,$]=s.useState(!1),[Y,T]=s.useState(0),[W,y]=s.useState(!1),E=s.useRef(null),k=s.useRef(!1),x=s.useRef(new Map),G=s.useRef(new Map),q=s.useMemo(()=>l==="READING"?n.content||"":l==="LISTENING"?n.listeningContent||"":n.testContent||"",[n,l]),L=s.useMemo(()=>Ut(q),[q]);s.useEffect(()=>{b(0)},[l]),s.useEffect(()=>{const i=u=>{E.current&&!E.current.contains(u.target)&&y(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const ne=s.useMemo(()=>{if(g==="SCROLL")return he(q);{const i=L[N]||L[0];return he((i==null?void 0:i.content)||"")}},[q,g,L,N]),D=s.useMemo(()=>{if(!n.listeningContent)return[];const i=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/\]/gi,u=[];let O;for(;(O=i.exec(n.listeningContent))!==null;)u.push({lang:O[1].toUpperCase()==="VN"?"vi":"en",text:O[2].replace(/\[.*?\]/g,"").trim()});return u},[n.listeningContent]),Q=i=>{if(x.current.has(i))return Promise.resolve(x.current.get(i));if(G.current.has(i))return G.current.get(i);const u=D[i],O=dt(u.text,u.lang).then(U=>(U&&(x.current.set(i,U),T(z=>z+1)),U));return G.current.set(i,O),O},_=async i=>{for(let u=i;u<D.length&&!k.current;u++)await Q(u)},S=async()=>{m==="PAUSED"?(w("PLAYING"),k.current=!1):(k.current=!1,w("PLAYING"),_(0));const i=p===-1?0:p;for(let u=i;u<D.length&&!k.current;u++){C(u);const O=D[u];let U=x.current.get(u);if(U||($(!0),U=await Q(u),$(!1)),k.current)break;try{await pe(O.text,!0,O.lang,void 0,void 0,U||void 0)}catch(z){console.error("Speech playback error at index",u,z)}}k.current||(w("IDLE"),C(-1),T(0),x.current.clear(),G.current.clear())},R=()=>{k.current=!0,ue(),w("IDLE"),C(-1),T(0),x.current.clear(),G.current.clear(),$(!1)};s.useEffect(()=>(window.handleLessonSpeak=i=>{pe(i)},()=>{R(),delete window.handleLessonSpeak}),[]);const r=D.length>0,M=Y>=D.length;return s.useEffect(()=>{g==="PAGED"&&window.scrollTo({top:0,behavior:"smooth"})},[N,g]),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 pb-40 animate-in fade-in duration-300 relative min-h-screen",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("button",{onClick:d,className:"w-fit flex items-center space-x-2 text-xs font-bold text-neutral-400 hover:text-neutral-900 transition-colors uppercase tracking-wider",children:[e.jsx(fe,{size:14}),e.jsx("span",{children:"Back to Library"})]}),L.length>1&&e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>I("SCROLL"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${g==="SCROLL"?"bg-white text-neutral-900 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Scroll View",children:[e.jsx(Mt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Scroll"})]}),e.jsxs("button",{onClick:()=>I("PAGED"),className:`p-2 rounded-lg transition-all flex items-center gap-2 text-[10px] font-black uppercase ${g==="PAGED"?"bg-white text-indigo-600 shadow-sm":"text-neutral-400 hover:text-neutral-600"}`,title:"Chapter View",children:[e.jsx(Dt,{size:14})," ",e.jsx("span",{className:"hidden sm:inline",children:"Paged"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:n.title}),e.jsxs("div",{className:"flex bg-neutral-100 p-1 rounded-xl gap-1 w-fit mt-2",children:[e.jsxs("button",{onClick:()=>h("READING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${l==="READING"?"bg-white text-neutral-900 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(ze,{size:12,className:"inline mr-1"})," Read"]}),e.jsxs("button",{onClick:()=>h("LISTENING"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${l==="LISTENING"?"bg-white text-indigo-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(me,{size:12,className:"inline mr-1"})," Listen"]}),e.jsxs("button",{onClick:()=>h("TEST"),className:`px-4 py-1.5 text-[10px] font-black uppercase rounded-lg transition-all ${l==="TEST"?"bg-white text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(xe,{size:12,className:"inline mr-1"})," Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l==="LISTENING"&&r&&e.jsxs("div",{className:"flex items-center gap-2 bg-indigo-50 border border-indigo-100 p-1.5 rounded-2xl shadow-sm animate-in zoom-in-95",children:[m==="PLAYING"?e.jsx("button",{onClick:()=>{w("PAUSED"),ue(),k.current=!0},className:"p-3 bg-white text-indigo-600 rounded-xl shadow-sm hover:bg-neutral-50 transition-all",children:e.jsx(De,{size:20,fill:"currentColor"})}):e.jsx("button",{onClick:S,className:"p-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95",children:e.jsx(Le,{size:20,fill:"currentColor"})}),m!=="IDLE"&&e.jsx("button",{onClick:R,className:"p-3 bg-white text-rose-500 rounded-xl hover:bg-rose-50 transition-all",children:e.jsx(Re,{size:20,fill:"currentColor"})})]}),l==="LISTENING"&&!r&&A&&e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-6 py-3 bg-indigo-500 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-lg active:scale-95",children:[e.jsx(ge,{size:16}),e.jsx("span",{children:"Add Audio"})]}),l==="TEST"&&!n.testContent&&j&&e.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-emerald-600 transition-all shadow-lg active:scale-95",children:[e.jsx(ge,{size:16}),e.jsx("span",{children:"Add Test"})]}),e.jsx("button",{onClick:v,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-2xl hover:bg-neutral-50 hover:text-neutral-900 transition-all shadow-sm active:scale-95",title:"Edit Lesson",children:e.jsx(be,{size:20})})]})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] border border-neutral-200 shadow-sm min-h-[400px] relative",children:l==="TEST"&&!n.testContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(xe,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No practice test available for this lesson."})]}):l==="LISTENING"&&!n.listeningContent?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-20 text-neutral-300",children:[e.jsx(me,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-neutral-400",children:"No listening script available."}),e.jsx("p",{className:"text-xs text-neutral-300 mt-2",children:'Click "Add Audio" to generate one.'})]}):e.jsx("div",{className:"prose prose-sm max-w-none prose-headings:font-black prose-headings:text-neutral-900 prose-p:text-neutral-600 prose-p:leading-relaxed prose-img:rounded-xl prose-img:shadow-md prose-strong:text-neutral-900 prose-a:text-indigo-600",dangerouslySetInnerHTML:{__html:ne}})}),g==="PAGED"&&L.length>1&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-neutral-200 flex items-center gap-2 animate-in slide-in-from-bottom-4",children:[e.jsx("button",{onClick:()=>b(Math.max(0,N-1)),disabled:N===0,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(vt,{size:18})}),e.jsxs("div",{className:"relative px-2",ref:E,children:[e.jsxs("button",{onClick:()=>y(!W),className:"flex flex-col items-center hover:bg-neutral-100 rounded-lg px-2 py-1 transition-colors",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-neutral-400 tracking-widest",children:"Chapter"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold text-sm text-neutral-900 max-w-[120px] truncate",children:L[N].title}),e.jsx(rt,{size:12,className:"text-neutral-400"})]})]}),W&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-56 bg-white rounded-xl shadow-2xl border border-neutral-100 p-1 animate-in fade-in zoom-in-95 origin-bottom",children:e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:L.map((i,u)=>e.jsx("button",{onClick:()=>{b(u),y(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-xs font-bold truncate ${u===N?"bg-indigo-50 text-indigo-700":"text-neutral-600 hover:bg-neutral-50"}`,children:i.title},u))})})]}),e.jsx("button",{onClick:()=>b(Math.min(L.length-1,N+1)),disabled:N===L.length-1,className:"p-3 bg-neutral-100 rounded-xl text-neutral-600 hover:bg-neutral-200 hover:text-neutral-900 disabled:opacity-30 disabled:hover:bg-neutral-100 transition-colors",children:e.jsx(ct,{size:18})})]}),l==="LISTENING"&&m!=="IDLE"&&e.jsxs("div",{className:"fixed bottom-10 left-1/2 -translate-x-1/2 bg-neutral-900/95 backdrop-blur-md text-white px-8 py-6 rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row items-center gap-8 animate-in slide-in-from-bottom-8 z-50 border border-neutral-800 ring-4 ring-black/10 w-[95%] max-w-4xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em]",children:["Narrating ",p+1," / ",D.length]}),F?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-amber-500/20 rounded-full",children:[e.jsx(Ue,{size:10,className:"animate-spin text-amber-400"}),e.jsx("span",{className:"text-[8px] font-black uppercase text-amber-400 tracking-wider",children:"Buffering..."})]}):!M&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-white/10 rounded-full",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-400"}),e.jsxs("span",{className:"text-[8px] font-black uppercase text-emerald-400 tracking-wider",children:["Downloaded ",Y,"/",D.length]})]})]})}),e.jsxs("p",{className:"text-lg font-bold text-neutral-100 leading-relaxed italic line-clamp-2",children:['"',((P=D[p])==null?void 0:P.text)||"...",'"']})]}),e.jsxs("div",{className:"flex items-center gap-5 shrink-0 border-l border-white/10 pl-6 h-full self-stretch md:self-center",children:[e.jsx("button",{onClick:R,className:"p-4 text-neutral-400 hover:text-white transition-colors bg-white/5 rounded-full hover:bg-white/10",children:e.jsx(Re,{size:24,fill:"currentColor"})}),m==="PLAYING"?e.jsx("button",{onClick:()=>{w("PAUSED"),ue(),k.current=!0},className:"w-16 h-16 bg-white text-neutral-900 rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",children:e.jsx(De,{size:32,fill:"currentColor"})}):e.jsx("button",{onClick:S,className:"w-16 h-16 bg-indigo-500 text-white rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform",children:e.jsx(Le,{size:32,fill:"currentColor"})})]})]})]})},Bt=({user:n,lesson:d,onComplete:v,onEdit:A,onUpdate:j})=>{const[l,h]=s.useState(null),{showToast:g}=Ne(),I=b=>{var p,C,F;const m=Se(),w=m.audioCoach.coaches[m.audioCoach.activeCoach].name;return b.format==="test"||l==="test"?Fe(d.title,d.content,b.request,d.tags):ve({task:"convert_to_listening",currentLesson:{title:d.title,description:d.description,content:d.content},userRequest:b.request,language:b.language||((p=n.lessonPreferences)==null?void 0:p.language)||"English",targetAudience:((C=n.lessonPreferences)==null?void 0:C.targetAudience)||"Adult",tone:b.tone||((F=n.lessonPreferences)==null?void 0:F.tone)||"professional_professor",coachName:w})},N=async b=>{const m=b.result||b,w=b.format||l,p={...d,updatedAt:Date.now()};w==="listening"?(p.listeningContent=m.content,g("Audio script added successfully!","success")):(p.testContent=m.content,g("Practice test added successfully!","success")),await se(p),j&&j(p),h(null)};return e.jsxs(e.Fragment,{children:[e.jsx(zt,{lesson:d,onComplete:v,onEdit:A,onAddSound:()=>h("listening"),onAddTest:()=>h("test")}),l&&e.jsx(we,{isOpen:!!l,onClose:()=>h(null),type:"GENERATE_AUDIO_SCRIPT",title:l==="listening"?"Add Lesson Sound":"Add Practice Test",description:l==="listening"?"AI will transform this lesson into a podcast script.":"AI will design a separate test based on lesson content.",initialData:{...n.lessonPreferences,format:l},onGeneratePrompt:I,onJsonReceived:N,actionLabel:"Apply Changes",closeOnSuccess:!0})]})},Ft={filterSchema:[],viewSchema:[]},Pe="vocab_pro_lesson_view_settings",as=({user:n,onStartSession:d,onNavigate:v,onUpdateUser:A,initialLessonId:j,onConsumeLessonId:l})=>{var ye;const[h,g]=s.useState([]),[I,N]=s.useState([]),[b,m]=s.useState([]),[w,p]=s.useState(!0),[C,F]=s.useState(null),[$,Y]=s.useState(!1),[T,W]=s.useState(!1),[y,E]=s.useState("ALL"),[k,x]=s.useState("all"),[G,q]=s.useState("all"),[L,ne]=s.useState(()=>ut(Pe,{showDesc:!0,compact:!1})),[D,Q]=s.useState(0),[_,S]=s.useState(12),[R,r]=s.useState("list"),[M,P]=s.useState(null),[i,u]=s.useState(null),[O,U]=s.useState(null),[z,oe]=s.useState(null),[$e,je]=s.useState(!1),{currentShelfName:ie,booksOnCurrentShelf:le,allShelves:X,addShelf:_e,renameShelf:Ve,removeShelf:We,nextShelf:He,prevShelf:Ye,selectShelf:qe}=yt(I,"lesson_books_shelves"),[Qe,re]=s.useState(!1),[Je,ce]=s.useState(!1),[H,de]=s.useState(null),{showToast:Z}=Ne();s.useEffect(()=>{ht(Pe,L)},[L]);const V=s.useCallback(async()=>{p(!0);try{const[t,c,f]=await Promise.all([pt(n.id),xt(n.id),gt()]),a=[...t.map(o=>({type:"ESSAY",data:o,path:o.path,tags:o.tags,date:o.createdAt}))];g(a.sort((o,B)=>B.date-o.date)),N(c.sort((o,B)=>B.createdAt-o.createdAt)),m(f)}finally{p(!1)}},[n.id]);s.useEffect(()=>{V()},[V]),s.useEffect(()=>{if(j&&h.length>0){const t=h.find(c=>c.data.id===j);t&&(P(t.data),r("read_lesson"),l==null||l())}},[j,h,l]),s.useEffect(()=>{Q(0)},[C,y,k,G,_]),s.useMemo(()=>y!=="ALL"||k!=="all"||G!=="all",[y,k,G]);const ee=s.useMemo(()=>h.filter(t=>{var c,f;if(y!=="ALL"&&t.type!==y||k==="focused"&&!t.data.isFocused||G!=="all"&&t.data.focusColor!==G)return!1;if(C){if(C==="Uncategorized"){const a=t.path??(t.tags||[]).find(B=>B.startsWith("/"));if(a&&a!=="/")return!1}else if(!((c=t.path)!=null&&c.startsWith(C))&&!((f=t.tags)!=null&&f.includes(C)))return!1}return!0}),[h,C,y,k,G]),Ke=s.useMemo(()=>{const t=D*_;return ee.slice(t,t+_)},[ee,D,_]),Xe=t=>{Ve(t,async(f,a)=>{p(!0);const o=I.filter(B=>{const J=B.title.split(":");return(J.length>1?J[0].trim():"General")===f});await Promise.all(o.map(B=>{const J=B.title.split(":"),Ie=J.length>1?J.slice(1).join(":").trim():J[0],ot=`${a}: ${Ie}`;return K({...B,title:ot,updatedAt:Date.now()})})),await V()})&&ce(!1)},Ce=async()=>{const t={id:`lb-${Date.now()}`,userId:n.id,title:`${ie}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#1a237e",icon:"ðŸ“˜"};await K(t),await V(),u(t),r("book_detail"),Z("New book created.","success")},Ze=async t=>{if(!i)return;const c={...i,...t,updatedAt:Date.now()};N(f=>f.map(a=>a.id===c.id?c:a)),u(c),await K(c)},et=async t=>{if(!H)return;const c=H.title.split(":"),f=c.length>1?c.slice(1).join(":").trim():c[0],a=`${t}: ${f}`,o={...H,title:a,updatedAt:Date.now()};await K(o),de(null),await V(),Z(`Moved to "${t}".`,"success")},tt=async()=>{O&&(await bt(O.id),Z("Lesson deleted.","success"),U(null),V())},st=async t=>{await se(t),Z("Lesson saved!","success"),r(i?"book_detail":"list"),P(null),V()},nt=async t=>{const{result:c,preferences:f}=t;JSON.stringify(n.lessonPreferences)!==JSON.stringify(f)&&await A({...n,lessonPreferences:f});const a={id:`lesson-ai-${Date.now()}`,userId:n.id,title:c.title,description:c.description,content:c.content,tags:c.tags||[],createdAt:Date.now(),updatedAt:Date.now(),topic1:"",topic2:""};await se(a),Z("Lesson created with AI!","success"),je(!1),P(a),r("read_lesson"),V()},Te=async(t,c)=>{const f={...t.data,focusColor:c||void 0,updatedAt:Date.now()};c||delete f.focusColor,await se(f),g(a=>a.map(o=>o.data.id===t.data.id?{...o,data:{...o.data,focusColor:c||void 0,updatedAt:Date.now()}}:o))},Ee=async t=>{const c={...t.data,isFocused:!t.data.isFocused,updatedAt:Date.now()};await se(c),g(f=>f.map(a=>a.data.id===t.data.id?{...a,data:{...a.data,isFocused:!a.data.isFocused,updatedAt:Date.now()}}:a))},ke=t=>{qe(t),r("shelf")},Ae=t=>{u(t),r("book_detail")},at=t=>{const c=Se(),f=c.audioCoach.activeCoach,a=c.audioCoach.coaches[f].name;return ve({topic:t.topic,language:t.language,targetAudience:t.targetAudience,tone:t.tone,format:t.format,coachName:a,task:"create_reading"})};if(R==="read_lesson"&&M)return e.jsx(Bt,{user:n,lesson:M,onComplete:()=>r(i?"book_detail":"list"),onEdit:()=>r("edit_lesson"),onUpdate:t=>P(t)});if(R==="edit_lesson"&&M)return e.jsx(Gt,{lesson:M,user:n,onSave:st,onPractice:t=>{P(t),r("read_lesson")},onCancel:()=>r(i?"book_detail":"list")});if(R==="book_detail"&&i){const t=new Map(h.map(a=>[a.data.id,a])),c=i.itemIds.map(a=>{const o=t.get(a);return o?{id:a,title:o.data.title,subtitle:o.data.description,data:o.data,focusColor:o.data.focusColor,isFocused:o.data.isFocused}:null}).filter(a=>a!==null),f=h.map(a=>({id:a.data.id,title:a.data.title,subtitle:a.data.description,data:a.data}));return e.jsx(It,{book:i,items:c,availableItems:f,onBack:()=>{u(null),r("shelf"),V()},onUpdateBook:Ze,onAddItem:async a=>{const o={...i,itemIds:Array.from(new Set([...i.itemIds,...a]))};await K(o),u(o)},onRemoveItem:async a=>{const o={...i,itemIds:i.itemIds.filter(B=>B!==a)};await K(o),u(o)},onOpenItem:a=>{P(a.data),r("read_lesson")},onEditItem:a=>{P(a.data),r("edit_lesson")},onFocusChange:(a,o)=>Te({data:a.data},o),onToggleFocus:a=>Ee({data:a.data}),itemIcon:e.jsx(ae,{size:16})})}return R==="shelf"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>r("list"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(fe,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Lesson Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Browse your lesson collections."})]}),e.jsx(Me,{shelves:X,books:I,onNavigateShelf:ke,onNavigateBook:Ae}),e.jsxs("button",{onClick:()=>re(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(jt,{size:14})," Add Shelf"]})]})]}),e.jsxs(Ct,{label:ie,onNext:X.length>1?He:void 0,onPrev:X.length>1?Ye:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(Rt,{size:14})}),e.jsx("button",{onClick:We,disabled:le.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(te,{size:14})})]}),isEmpty:le.length===0,emptyAction:e.jsx("button",{onClick:Ce,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[le.map(t=>{var f;const c=((f=t.title.split(":").pop())==null?void 0:f.trim())||t.title;return e.jsx(Tt,{id:t.id,title:c,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(ae,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{u(t),r("book_detail")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),de(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(Lt,{size:16})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),oe(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(te,{size:16})})]})},t.id)}),e.jsx("div",{className:"group translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:Ce,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(mt,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(Oe,{isOpen:!!z,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(ye=z==null?void 0:z.title.split(":").pop())==null?void 0:ye.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:async()=>{z&&await ft(z.id),oe(null),V()},onClose:()=>oe(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(Et,{isOpen:!!H,onClose:()=>de(null),onConfirm:et,shelves:X,currentShelf:H?H.title.split(":")[0].trim():"General",bookTitle:(H==null?void 0:H.title)||""}),e.jsx(kt,{isOpen:Qe,onClose:()=>re(!1),onSave:t=>{_e(t)&&re(!1)}}),e.jsx(At,{isOpen:Je,onClose:()=>ce(!1),onSave:Xe,initialName:ie})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{title:"Knowledge Library",subtitle:"Your collection of lessons and comparisons.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Notebook.png",className:"w-8 h-8 object-contain",alt:"Lessons"}),centerContent:e.jsx(Me,{shelves:X,books:I,onNavigateShelf:ke,onNavigateBook:Ae}),minorSkills:e.jsxs("button",{onClick:()=>v("IRREGULAR_VERBS"),className:"flex items-center gap-2 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-xs font-bold hover:bg-orange-100 transition-colors",children:[e.jsx(Ot,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Irregular Verbs"})]}),pagination:{page:D,totalPages:Math.ceil(ee.length/_),onPageChange:Q,pageSize:_,onPageSizeChange:S,totalItems:ee.length},aboveGrid:e.jsx(e.Fragment,{children:$&&e.jsx(wt,{items:h,selectedTag:C,onSelectTag:F,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Be,{size:16})})}),config:Ft,activeFilters:{},onFilterChange:()=>{},isLoading:w,isEmpty:ee.length===0,emptyMessage:"No items found matching your criteria.",children:()=>e.jsx(e.Fragment,{children:Ke.map(t=>{const c=()=>{P(t.data),r("read_lesson")},f=()=>{P(t.data),r("edit_lesson")},a=()=>U(t.data);return e.jsx(St,{title:e.jsx("div",{className:"font-black text-lg text-neutral-900 tracking-tight leading-tight truncate",children:t.data.title}),tags:t.data.tags,compact:L.compact,onClick:c,focusColor:t.data.focusColor,onFocusChange:o=>Te(t,o),isFocused:t.data.isFocused,onToggleFocus:()=>Ee(t),isCompleted:t.data.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),c()},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Read",children:e.jsx(ae,{size:14})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),f()},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(be,{size:14})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),a()},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(te,{size:14})})]}),children:L.showDesc&&t.data.description&&e.jsx("p",{className:"line-clamp-2",children:t.data.description})},`${t.type}-${t.data.id}`)})})}),e.jsx(Oe,{isOpen:!!O,title:"Delete Lesson?",message:"Confirm delete?",confirmText:"Yes, Delete",isProcessing:!1,onConfirm:tt,onClose:()=>U(null),icon:e.jsx(te,{size:40,className:"text-red-500"})}),e.jsx(we,{isOpen:$e,onClose:()=>je(!1),type:"GENERATE_LESSON",title:"AI Lesson Creator",description:"Design a custom lesson instantly.",initialData:n.lessonPreferences,onGeneratePrompt:at,onJsonReceived:nt,actionLabel:"Create Lesson",closeOnSuccess:!0})]})};export{as as LessonLibraryV2,as as default};
