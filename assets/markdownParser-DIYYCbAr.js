import{r as f,j as c,b2 as k,X as y,s as j,ba as $,a3 as M}from"./index-DGJ8pI6b.js";import{S as v}from"./square-check-big-DTHqJH21.js";const q=({isOpen:n,onClose:t,onSelect:i,allWords:r,wordsToExclude:o,loading:e})=>{const[l,s]=f.useState(""),[a,p]=f.useState(new Set),g=f.useMemo(()=>{if(!l)return r;const d=l.toLowerCase();return r.filter(h=>h.word.toLowerCase().includes(d))},[r,l]),m=d=>{p(h=>{const u=new Set(h);return u.has(d)?u.delete(d):u.add(d),u})},x=()=>{i(Array.from(a)),t()};return n?c.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm animate-in fade-in duration-200",children:c.jsxs("div",{className:"bg-neutral-50 w-full max-w-lg rounded-[2rem] shadow-2xl border border-neutral-200 flex flex-col h-[70vh]",children:[c.jsxs("header",{className:"p-4 border-b border-neutral-200 flex justify-between items-center shrink-0",children:[c.jsxs("div",{className:"relative flex-1",children:[c.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:16}),c.jsx("input",{type:"text",value:l,onChange:d=>s(d.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-4 py-2 bg-white border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900",autoFocus:!0})]}),c.jsx("button",{onClick:t,className:"p-2 ml-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:c.jsx(y,{size:16})})]}),c.jsx("main",{className:"flex-1 overflow-y-auto p-2",children:e?c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsx(j,{size:24,className:"animate-spin text-neutral-300"})}):c.jsx("div",{className:"flex flex-col gap-1",children:g.map(d=>{const h=a.has(d.word),u=o.has(d.word);return c.jsxs("button",{onClick:()=>!u&&m(d.word),disabled:u,className:`flex items-center justify-between p-3 rounded-lg text-left transition-colors ${u?"bg-neutral-100 opacity-50 cursor-not-allowed":h?"bg-indigo-50 text-indigo-800":"hover:bg-neutral-100"}`,children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"font-bold text-sm",children:d.word}),c.jsx("span",{className:"text-xs text-neutral-500",children:d.meaningVi})]}),u?c.jsx(v,{size:18,className:"text-neutral-400"}):h?c.jsx(v,{size:18,className:"text-indigo-600"}):c.jsx($,{size:18,className:"text-neutral-300"})]},d.id)})})}),c.jsxs("footer",{className:"p-4 border-t border-neutral-200 flex justify-end gap-3 shrink-0 bg-white/50 backdrop-blur-sm",children:[c.jsx("button",{onClick:t,className:"px-5 py-2.5 bg-neutral-100 text-neutral-600 rounded-lg font-bold text-xs hover:bg-neutral-200 transition-all",children:"Cancel"}),c.jsxs("button",{onClick:x,disabled:a.size===0,className:"px-5 py-2.5 bg-neutral-900 text-white rounded-lg font-black text-xs flex items-center space-x-2 hover:bg-neutral-800 transition-all disabled:opacity-50",children:[c.jsx(M,{size:14}),c.jsxs("span",{children:["Add (",a.size,")"]})]})]})]})}):null};typeof window<"u"&&(window.checkMarkdownQuiz=n=>{const t=n.getAttribute("data-answer");if(!t)return;const r=n.value.trim().toLowerCase()===t.trim().toLowerCase();n.classList.remove("border-neutral-300","text-neutral-900","focus:border-indigo-600"),n.classList.remove("border-green-500","text-green-700","bg-green-50"),n.classList.remove("border-red-500","text-red-700","bg-red-50"),r?n.classList.add("border-green-500","text-green-700","bg-green-50"):n.classList.add("border-red-500","text-red-700","bg-red-50")},window.checkDropdownQuiz=n=>{const t=n.parentElement;if(!t)return;const i=t.querySelector("select");if(!i)return;const r=i.getAttribute("data-answer"),o=i.value;if(!o)return;const e=o===r;if(i.disabled=!0,n.disabled=!0,n.classList.add("opacity-0","pointer-events-none"),i.classList.remove("border-neutral-300","text-neutral-900","focus:border-indigo-600"),i.classList.remove("bg-white"),e)i.classList.add("border-green-500","text-green-700","bg-green-50","font-bold");else{i.classList.add("border-red-500","text-red-700","bg-red-50","line-through");const l=document.createElement("span");l.className="ml-2 text-xs font-bold text-green-600 bg-green-50 px-1.5 py-0.5 rounded border border-green-200 animate-in fade-in",l.innerText=r||"",t.appendChild(l)}},window.checkMultiChoice=n=>{var e;const t=n.parentElement;if(!t)return;const i=t.getAttribute("data-answer"),r=(e=n.textContent)==null?void 0:e.trim();t.querySelectorAll("button").forEach(l=>{var s;l.disabled=!0,l.classList.add("opacity-50","cursor-not-allowed"),((s=l.textContent)==null?void 0:s.trim())===i&&(l.classList.remove("bg-white","text-neutral-700","opacity-50"),l.classList.add("bg-green-500","text-white","border-green-600"))}),r===i?(n.classList.remove("opacity-50"),n.classList.add("ring-2","ring-green-300")):(n.classList.remove("bg-white","text-neutral-700","opacity-50"),n.classList.add("bg-red-500","text-white","border-red-600"))});const C=n=>{if(!n[0].trim().startsWith("|"))return null;const t=[];for(const a of n)if(a.trim().startsWith("|"))t.push(a);else break;if(t.length===0)return null;const i=a=>{const p=a.split("|");return a.trim().startsWith("|")&&p.shift(),a.trim().endsWith("|")&&p.pop(),p.map(g=>g.trim())},r=/^\|?(\s*:?-+:?\s*\|)+\s*$/;let o=!1;t.length>1&&r.test(t[1].trim())&&(o=!0);let e='<div class="overflow-x-auto my-4 border border-neutral-200 rounded-xl shadow-sm"><table class="w-full text-sm text-left border-collapse">';const l=i(t[0]);e+='<thead class="bg-neutral-50 text-neutral-900 uppercase font-bold text-xs"><tr>',l.forEach(a=>e+=`<th class="px-6 py-3 border-b border-neutral-200 min-w-[100px]">${a}</th>`),e+="</tr></thead>",e+='<tbody class="divide-y divide-neutral-100 bg-white">';const s=o?2:1;for(let a=s;a<t.length;a++){const p=i(t[a]);e+='<tr class="hover:bg-neutral-50/50 transition-colors">';for(let g=0;g<l.length;g++){const m=p[g]||"";e+=`<td class="px-6 py-4 font-medium text-neutral-600 align-top">${m}</td>`}e+="</tr>"}return e+="</tbody></table></div>",{html:e,consumed:t.length}},N=n=>n.replace(/\[HIDDEN:\s*(.*?)\]/gi,(t,i)=>`<button type="button" onclick="this.outerHTML='<span class=\\'px-1.5 py-0.5 bg-green-50 border border-green-200 text-green-800 rounded-md text-sm font-bold animate-in fade-in zoom-in-95 inline-block align-baseline mx-1\\'>${i.trim().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"\\'")}</span>'" class="inline-flex flex-nowrap whitespace-nowrap items-center gap-1.5 px-2 py-0.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 rounded-md text-[10px] font-black uppercase tracking-wider transition-colors select-none border border-indigo-100 shadow-sm align-middle my-0.5 mx-1"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="shrink-0"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>Reveal</button>`),L=n=>n.replace(/\[Quiz:\s*(.*?)\]/gi,(t,i)=>{const r=i.trim(),o=Math.max(3,r.length);return`<span class="inline-flex items-center gap-1 align-middle mx-1 whitespace-nowrap"><input type="text" data-answer="${r.replace(/"/g,"&quot;")}" placeholder="?" class="border-b-2 border-neutral-300 bg-transparent text-center font-bold text-neutral-900 outline-none focus:border-indigo-600 transition-all rounded-t-md px-1 py-0.5 text-sm" style="width: ${o}ch; min-width: 40px;" onkeydown="if(event.key==='Enter') window.checkMarkdownQuiz(this)" /><button onclick="window.checkMarkdownQuiz(this.previousElementSibling)" class="p-1 text-neutral-400 hover:text-indigo-600 transition-colors bg-neutral-100 hover:bg-indigo-50 rounded-full shadow-sm" title="Check Answer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg></button></span>`}),S=n=>n.replace(/\[Select:\s*(.*?)\]/gi,(t,i)=>{const r=i.split("|").map(s=>s.trim()).filter(s=>s.length>0);if(r.length<2)return`[Invalid Select: ${i}]`;const o=r[0],e=[...r];for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[e[s],e[a]]=[e[a],e[s]]}let l='<span class="inline-flex items-center gap-1 align-middle mx-1 whitespace-nowrap">';return l+=`<select data-answer="${o.replace(/"/g,"&quot;")}" class="border-b-2 border-neutral-300 bg-transparent font-bold text-neutral-900 outline-none focus:border-indigo-600 transition-all rounded-t-md px-2 py-0.5 text-sm cursor-pointer hover:bg-neutral-50 appearance-none pr-6 relative" style="min-width: 80px;">`,l+='<option value="" disabled selected>Select...</option>',e.forEach(s=>{l+=`<option value="${s.replace(/"/g,"&quot;")}">${s}</option>`}),l+="</select>",l+='<button onclick="window.checkDropdownQuiz(this)" class="p-1 text-neutral-400 hover:text-indigo-600 transition-colors bg-neutral-100 hover:bg-indigo-50 rounded-full shadow-sm" title="Check Answer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg></button>',l+="</span>",l}),z=n=>n.replace(/\[Multi:\s*(.*?)\]/gi,(t,i)=>{const r=i.split("|").map(s=>s.trim()).filter(s=>s.length>0);if(r.length<2)return`[Invalid Multi: ${i}]`;const o=r[0],e=[...r];for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[e[s],e[a]]=[e[a],e[s]]}let l=`<span class="inline-flex flex-wrap items-center gap-1.5 align-middle mx-1" data-answer="${o.replace(/"/g,"&quot;")}">`;return e.forEach(s=>{l+=`<button onclick="window.checkMultiChoice(this)" class="px-2 py-1 bg-white border border-neutral-200 text-neutral-700 rounded-md text-xs font-bold hover:bg-neutral-50 hover:border-neutral-300 transition-all shadow-sm select-none">${s}</button>`}),l+="</span>",l}),F=n=>n.replace(/\[Formula:?\s*(.*?)\]/gi,(t,i)=>{const r=i.split("|").map(e=>e.trim());let o='<div class="flex flex-wrap items-center gap-2 p-3 my-3 bg-amber-50 border-l-4 border-amber-400 rounded-r-xl shadow-sm">';return o+='<span class="text-[10px] font-black text-amber-500 uppercase tracking-widest mr-1 select-none">Formula</span>',r.forEach(e=>{/^[+,.]+$/.test(e)?o+=`<span class="font-bold text-amber-700">${e}</span>`:o+=`<span class="px-2 py-1 bg-white border border-amber-200 rounded-lg text-amber-900 font-mono text-sm font-bold shadow-sm">${e}</span>`}),o+="</div>",o}),E=n=>{const t=/\[Audio-(VN|EN)\]([\s\S]*?)\[\/(?:Audio-(?:VN|EN))?\]/gi;return n.replace(t,(i,r,o)=>`<button onclick="window.handleLessonSpeak('${o.replace(/\[HIDDEN:.*?\]/gi,"").replace(/\[Quiz:.*?\]/gi,"").replace(/\[Select:.*?\]/gi,"").replace(/\[Multi:.*?\]/gi,"").replace(/\[Formula:.*?\]/gi,"").replace(/[#*`_~[\]()]/g,"").replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu,"").replace(/\n/g," ").trim().replace(/'/g,"\\'")}')" class="inline-flex items-center justify-center w-6 h-6 mr-1.5 bg-indigo-600 text-white hover:bg-indigo-700 rounded-md transition-all active:scale-90 align-middle shadow-sm" title="Listen"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>`+o.trim())},Q=n=>{if(!n)return"";let t=E(n);t=L(t),t=S(t),t=z(t),t=F(t),t=N(t);const i=t.split(`
`),r=[],o=[],e=(l=0)=>{for(;o.length>l;){const s=o.pop();r.push(s.type==="ul"?"</ul>":"</ol>")}};for(let l=0;l<i.length;l++){const s=i[l],a=s.trim();if(!a&&o.length===0){r.push('<br class="block my-2" />');continue}const p=C(i.slice(l));if(p){e(0),r.push(p.html),l+=p.consumed-1;continue}if(/^([-*_])\s*(\1\s*){2,}$/.test(a)){e(0),r.push('<hr class="my-6 border-t-2 border-neutral-100" />');continue}if(a.startsWith("# ")){e(0),r.push(`<h1 class="text-3xl font-black text-neutral-900 mb-4 mt-8 pb-2 border-b border-neutral-100 leading-tight">${a.substring(2)}</h1>`);continue}if(a.startsWith("## ")){e(0),r.push(`<h2 class="text-xl font-extrabold text-neutral-800 mb-3 mt-6 leading-tight">${a.substring(3)}</h2>`);continue}if(a.startsWith("### ")){e(0),r.push(`<h3 class="text-lg font-bold text-neutral-700 mb-2 mt-4 leading-tight">${a.substring(4)}</h3>`);continue}if(a.startsWith("> ")){e(0),r.push(`<blockquote class="border-l-4 border-amber-400 bg-amber-50 pl-4 py-3 pr-2 my-4 rounded-r-lg text-sm text-neutral-700 font-medium italic shadow-sm">${a.substring(2)}</blockquote>`);continue}const g=a.match(/^\[(?!(HIDDEN:|Quiz:|Select:|QUIZ:|Multi:|Formula:|Audio-|(\/\])))(.*)\]$/);if(g){e(0);const u='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 mt-0.5 text-sky-500"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',b=g[3].trim();r.push(`
                <div class="flex items-start gap-3 my-4 p-4 bg-sky-50 border-l-4 border-sky-400 rounded-r-lg shadow-sm">
                    ${u}
                    <div class="text-sm text-sky-900 font-medium leading-relaxed">
                        ${b}
                    </div>
                </div>
            `);continue}const m=s.match(/^(\s*)/),x=m?m[0].length:0,d=s.match(/^\s*[-*]\s+(.*)/),h=s.match(/^\s*(\d+)\.\s+(.*)/);if(d||h){const u=d?"ul":"ol",b=d?d[1]:h[2],w=h?h[1]:void 0;if(o.length===0||x>o[o.length-1].indent)r.push(u==="ul"?'<ul class="list-disc list-outside pl-5 my-3 space-y-1 text-neutral-700 marker:text-neutral-400">':'<ol class="list-decimal list-outside pl-5 my-3 space-y-1 text-neutral-700 marker:font-bold marker:text-neutral-500">'),o.push({type:u,indent:x});else if(x<o[o.length-1].indent)for(;o.length>0&&x<o[o.length-1].indent;)e(o.length-1);u==="ol"&&w?r.push(`<li value="${w}" class="pl-1">${b}</li>`):r.push(`<li class="pl-1">${b}</li>`);continue}a!==""&&(e(0),r.push(`<p class="mb-2 leading-relaxed text-neutral-600">${s}</p>`))}return e(0),r.join("").replace(/!\[(.*?)\]\((.*?)\)/g,'<img alt="$1" src="$2" class="max-w-full h-auto rounded-lg my-4 shadow-md border border-neutral-200" />').replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-indigo-600 font-bold hover:underline">$1</a>').replace(/\*\*(.*?)\*\*/g,'<strong class="font-black text-neutral-900">$1</strong>').replace(/\*(.*?)\*/g,'<span class="italic font-normal text-inherit">$1</span>').replace(/`([^`]+)`/g,'<code class="bg-neutral-100 text-pink-600 px-1.5 py-0.5 rounded text-xs font-mono font-bold border border-neutral-200">$1</code>')};export{q as W,Q as p};
