import{j as e,w as re,x as u,Z as ne,B as fe,R as he,y as ge,f as be,z as je,D as we,V as ve,E as ye,H as Ne,I as ke,J as Se,K as le,X as oe,C as Re,N as Ee,O as Ce,T as _e,Q as Ie,U as ze,Y as Me,r as n,_ as ae,$ as Z,a0 as $,a1 as Ae}from"./index-CkgWBtZg.js";import{T as Te}from"./trophy-Dq2dQ1KP.js";const Oe=(a,d,D)=>{if(D)return a?a==="GAVE_UP"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-amber-100 text-amber-700",children:[e.jsx(ze,{size:10})," Gave Up"]}):a==="PASS"||a===u.EASY?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-700",children:[e.jsx(le,{size:10})," Pass"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:[e.jsx(oe,{size:10})," Fail"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:[e.jsx(Ie,{size:10})," No Answer"]});if(!a)return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-neutral-100 text-neutral-400",children:"Skipped"});if(d&&(a===u.EASY||a===u.LEARNED))return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-cyan-100 text-cyan-700",children:"Learned"});switch(a){case u.FORGOT:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-rose-100 text-rose-600",children:"Forgot"});case u.HARD:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-orange-100 text-orange-600",children:"Hard"});case u.EASY:return e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-black uppercase bg-green-100 text-green-600",children:"Easy"});default:return null}},De=({score:a})=>{const b=2*Math.PI*16,z=b-a/100*b,M=a>=80?"text-green-500":a>=50?"text-yellow-500":a>0?"text-orange-500":"text-neutral-400";return e.jsxs("div",{className:"relative flex items-center justify-center",style:{width:36,height:36},children:[e.jsxs("svg",{className:"absolute",width:36,height:36,children:[e.jsx("circle",{className:"text-neutral-100",stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2}),e.jsx("circle",{className:M,stroke:"currentColor",strokeWidth:4,fill:"transparent",r:16,cx:36/2,cy:36/2,strokeDasharray:b,strokeDashoffset:z,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.5s ease-out"}})]}),e.jsx("span",{className:`text-[10px] font-black ${M}`,children:a})]})},Le=({word:a})=>{const d=a.masteryScore??0;return e.jsxs("div",{className:"relative group/score",children:[e.jsx(De,{score:d}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/score:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Mastery Score",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]})},Ue=({complexity:a})=>e.jsxs("div",{className:"relative group/complexity",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 transition-all hover:bg-amber-100 shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black opacity-50",children:"CX"}),e.jsx("span",{className:"text-xs font-black",children:a})]}),e.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 bg-neutral-800 text-white text-[10px] font-black rounded-lg opacity-0 group-hover/complexity:opacity-100 transition-opacity pointer-events-none z-10 uppercase tracking-wider",children:["Complexity Level",e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-2 h-2 bg-neutral-800 rotate-45"})]})]}),Fe=a=>{const{user:d,initialWords:D,sessionWords:o,sessionType:b,newWordIds:z,progress:M,setProgress:L,sessionOutcomes:q,sessionFinished:W,wordInModal:U,setWordInModal:v,editingWordInModal:F,setEditingWordInModal:C,isTesting:P,setIsTesting:A,currentWord:m,isNewWord:y,onUpdate:_,onComplete:N,nextItem:G,handleReview:w,handleTestComplete:k,handleRetry:S,handleEndSession:f,handleQuickReview:T,handleManualPractice:ee,isQuickReviewMode:R}=a,{current:E,max:te}=M,x=b==="random_test",J=t=>{v(null),C(t)},Q=t=>{_(t),C(null)};if(D.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 py-20 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner",children:e.jsx(re,{size:32})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"All clear!"}),e.jsx("button",{onClick:N,className:"px-6 py-2.5 bg-neutral-900 text-white rounded-xl font-semibold text-sm hover:bg-neutral-800 transition-colors",children:"Back to Dashboard"})]});if(W){if(b==="new"||b==="due"||b==="new_study"||b==="custom"||x){const t=Object.values(q).filter(j=>j==="PASS"||j===u.EASY||j===u.LEARNED).length;return e.jsxs("div",{className:"max-w-2xl mx-auto py-10 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`mx-auto w-20 h-20 rounded-full flex items-center justify-center mb-4 ${x?"bg-amber-100 text-amber-600":"bg-neutral-100 text-neutral-900"}`,children:x?e.jsx(ne,{size:40,fill:"currentColor"}):e.jsx(fe,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:x?"Test Result":"Session Recap"}),x&&e.jsxs("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-[0.2em] mt-2",children:["Score: ",t," / ",o.length]}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You've completed this focused session."})]}),e.jsx("div",{className:"bg-white p-4 rounded-[2rem] border border-neutral-200 shadow-sm mb-8 overflow-hidden",children:e.jsx("div",{className:"max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 p-2",children:o.map(j=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-50/70 p-2.5 rounded-xl border border-neutral-100",children:[e.jsx("span",{className:"font-bold text-neutral-800 text-xs truncate pr-2",children:j.word}),Oe(q[j.id],z.has(j.id),x)]},j.id))})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:N,className:"px-6 py-4 bg-white border border-neutral-200 text-neutral-500 rounded-2xl font-bold text-xs hover:bg-neutral-50 hover:border-neutral-900 transition-all active:scale-95 uppercase tracking-widest",children:"Finish Session"}),e.jsxs("button",{onClick:S,className:"px-6 py-4 bg-neutral-900 text-white rounded-2xl font-black text-xs flex items-center justify-center space-x-2 shadow-lg hover:bg-neutral-800 transition-all active:scale-95 uppercase tracking-widest",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Retry This Session"})]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in zoom-in-95 duration-500",children:[e.jsx(Te,{size:64,className:"text-yellow-500 mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black text-neutral-900",children:"Session Complete!"}),e.jsx("p",{className:"text-neutral-500 mt-2 font-medium",children:"You have finished this review session."}),e.jsx("button",{onClick:N,className:"mt-8 px-10 py-3.5 bg-neutral-900 text-white rounded-2xl font-bold shadow-xl hover:scale-105 transition-all text-sm",children:"Return to Dashboard"})]})}if(!m)return null;const K=y?ge:be,I=y?"text-blue-500":"text-neutral-500",Y=y?m.word:m.ipaUs||m.word,O=!y&&!!m.ipaUs;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-100px)] flex flex-col animate-in fade-in duration-300",children:[e.jsxs("div",{className:"px-6 shrink-0 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"w-24"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{size:14,className:I}),e.jsxs("span",{className:"text-[10px] font-black text-neutral-400 uppercase tracking-widest",children:[E+1," / ",o.length]})]}),e.jsx("div",{className:"w-24 text-right",children:e.jsx("button",{onClick:f,className:"px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider text-neutral-500 hover:bg-neutral-100 transition-colors",children:"End Session"})})]}),e.jsx("div",{className:"h-1 w-full bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-neutral-900 transition-all duration-300 ease-in-out",style:{width:`${(E+1)/o.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative gap-4",children:[e.jsx("button",{onClick:()=>L(t=>({...t,current:(t.current-1+o.length)%o.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Previous word",children:e.jsx(je,{size:28})}),e.jsx("div",{className:"w-full max-w-xl h-full bg-white rounded-[2.5rem] border border-neutral-200 shadow-sm flex flex-col relative overflow-hidden group select-none",children:x?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-4",children:[e.jsx(we,{className:"animate-spin text-neutral-200",size:32}),e.jsx("p",{className:"text-xs font-black text-neutral-400 uppercase tracking-widest",children:"Loading Next Test..."})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 sm:p-12 w-full text-center space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:`font-black text-neutral-900 tracking-tight text-4xl ${O?"font-serif":""}`,children:Y}),y?e.jsx(Ue,{complexity:m.complexity??0}):e.jsx(Le,{word:m}),e.jsx("button",{onClick:t=>{t.stopPropagation(),ye(m.word)},className:"p-3 text-neutral-400 bg-neutral-50 hover:bg-neutral-100 hover:text-neutral-900 rounded-full transition-colors",title:"Pronounce",children:e.jsx(ve,{size:22})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>v(m),className:"flex items-center gap-2 px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-[10px] hover:bg-neutral-50 transition-all active:scale-95 uppercase tracking-widest shadow-sm",children:[e.jsx(Ne,{size:14}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-black text-[10px] hover:bg-amber-600 transition-all active:scale-95 uppercase tracking-widest shadow-lg shadow-amber-500/20",children:[e.jsx(ke,{size:14}),e.jsx("span",{children:"Practice"})]})]})]})}),e.jsx("button",{onClick:()=>L(t=>({...t,current:(t.current+1)%o.length})),className:"p-4 rounded-full text-neutral-300 hover:text-neutral-900 transition-all","aria-label":"Next word",children:e.jsx(Se,{size:28})})]}),e.jsx("div",{className:"shrink-0 pt-6 pb-2 mt-auto",children:y?e.jsxs("div",{className:"max-w-lg mx-auto grid grid-cols-3 items-stretch gap-4",children:[e.jsx("div",{})," ",e.jsxs("button",{onClick:()=>w(u.LEARNED),className:"py-5 bg-green-500 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 shadow-lg shadow-green-500/20 hover:bg-green-600 transition-all active:scale-95",children:[e.jsx(le,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"LEARNED"})]}),e.jsx("div",{})," "]}):!x&&e.jsxs("div",{className:"max-w-xl mx-auto grid grid-cols-4 items-stretch gap-3",children:[e.jsxs("button",{onClick:()=>w(u.FORGOT),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-red-600 hover:bg-red-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(oe,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"FORGOT"})]}),e.jsxs("button",{onClick:()=>w(u.HARD),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-orange-600 hover:bg-orange-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(Re,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Hard"})]}),e.jsxs("button",{onClick:()=>w(u.EASY),className:"py-5 bg-white border border-neutral-100 text-neutral-500 hover:text-green-600 hover:bg-green-50 rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Easy"})]}),e.jsxs("button",{onClick:T,className:"py-5 bg-indigo-600 text-white rounded-2xl flex flex-col items-center justify-center space-y-1.5 transition-all hover:bg-indigo-700 shadow-md shadow-indigo-200",children:[e.jsx(ne,{size:20,fill:"currentColor"}),e.jsx("span",{className:"text-[9px] font-black uppercase",children:"Quick Review"})]})]})})]}),U&&e.jsx(Ee,{word:U,onUpdate:_,onClose:()=>v(null),onNavigateToWord:v,onEditRequest:J,onGainXp:async()=>0,isViewOnly:!0}),F&&e.jsx(Ce,{user:d,word:F,onSave:Q,onClose:()=>C(null),onSwitchToView:t=>{C(null),v(F)}}),P&&m&&e.jsx(_e,{word:m,isQuickFire:x,sessionPosition:x?{current:E+1,total:o.length}:void 0,onPrevWord:()=>L(t=>({...t,current:Math.max(0,t.current-1)})),onClose:()=>{x?N():A(!1)},onComplete:k,skipSetup:R})]})},Ge=({user:a,sessionWords:d,sessionFocus:D,sessionType:o,onUpdate:b,onBulkUpdate:z,onComplete:M,onRetry:L})=>{const{showToast:q}=Me(),W=`vocab_pro_learn_queue_${a.id}`,U=`vocab_pro_learn_queue_date_${a.id}`,v=new Date().toISOString().slice(0,10),[F,C]=n.useState([]);n.useEffect(()=>{if(o==="new"||o==="new_study"){let r=[],l="";try{r=JSON.parse(sessionStorage.getItem(W)||"[]"),l=sessionStorage.getItem(U)||""}catch{}let c=[];l===v&&r.length>0?c=r.map(s=>d.find(i=>i.id===s)).filter(s=>s&&(!s.lastReview||s.lastGrade!=="LEARNED")):c=d.filter(i=>!i.lastReview||i.lastGrade!=="LEARNED").slice(0,20);const g=new Set(c.map(s=>s.id)),p=d.filter(s=>!s.lastReview||s.lastGrade!=="LEARNED");for(const s of p){if(c.length>=20)break;g.has(s.id)||c.push(s)}sessionStorage.setItem(W,JSON.stringify(c.map(s=>s.id))),sessionStorage.setItem(U,v),C(c)}else C(d)},[d,o]);const P=o==="new"||o==="new_study"?F:d,A=n.useRef(null),[m,y]=n.useState(new Set),[_,N]=n.useState(()=>{const r=ae("vocab_pro_session_progress",null);return r&&typeof r.current=="number"&&typeof r.max=="number"&&r.current<=r.max&&r.max<d.length?r:{current:0,max:0}}),[G,w]=n.useState(()=>ae("vocab_pro_session_outcomes",{})),[k,S]=n.useState(new Map),f=n.useRef(null),{current:T,max:ee}=_,[R,E]=n.useState(!1),[te,x]=n.useState(null),[J,Q]=n.useState(null),[K,I]=n.useState(o==="random_test"),[Y,O]=n.useState(!1),t=P[T],j=n.useMemo(()=>!(t!=null&&t.lastReview),[t]),B=n.useRef(k);n.useEffect(()=>{B.current=k},[k]);const se=n.useRef(R);n.useEffect(()=>{se.current=R},[R]),n.useEffect(()=>{const r=d.map(l=>l.id).sort().join(",");(A.current===null||A.current!==r)&&(A.current=r,y(new Set(d.filter(l=>!l.lastReview).map(l=>l.id))),N({current:0,max:0}),w({}),E(!1),S(new Map),sessionStorage.removeItem("vocab_pro_session_progress"),sessionStorage.removeItem("vocab_pro_session_outcomes"))},[d]),n.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_progress",JSON.stringify(_))},[_]),n.useEffect(()=>{sessionStorage.setItem("vocab_pro_session_outcomes",JSON.stringify(G))},[G]),n.useEffect(()=>{x(null),Q(null),I(o==="random_test"),O(!1)},[T,o]);const V=n.useCallback(async()=>{const r=Array.from(B.current.values());r.length!==0&&(await z(r),S(new Map))},[z]);n.useEffect(()=>()=>{!se.current&&B.current.size>0&&V()},[V]),n.useEffect(()=>{R&&k.size>0&&V()},[R,V,k.size]);const H=()=>{if(T<P.length-1){const r=T+1;N(l=>({current:r,max:Math.max(l.max,r)}))}else E(!0)},ie=async r=>{if(!t)return;w(s=>({...s,[t.id]:r}));let l,c;const g=k.get(t.id);g&&g.lastTestResults?(l={...g.lastTestResults},c=g.masteryScore):f.current?(l={...f.current},c=$({...t,lastTestResults:f.current})):t.lastTestResults&&(l={...t.lastTestResults},c=t.masteryScore);let p=Z(t,r);l&&(p={...p,lastTestResults:l,masteryScore:c}),S(s=>new Map(s).set(p.id,p)),f.current=null,H()},ce=()=>{O(!0),I(!0)},de=()=>{O(!1),I(!0)},ue=(r,l)=>{const c={...r.lastTestResults||{}},g=Ae(r);return Object.entries(l).forEach(([p,s])=>{if(c[p]=s,s===!1){const i=g.find(h=>h.testKeys.includes(p));i&&i.testKeys.forEach(h=>{c[h]=!1})}}),c},xe=async(r,l,c=!1,g)=>{if(I(!1),!t)return;let p={...t};if(l&&(f.current=ue(p,l)),Y&&g){const s=g.tested-g.correct;let i=u.FORGOT;s===0?i=u.EASY:s===1&&(i=u.HARD),w(X=>({...X,[t.id]:i}));const h=Z(p,i);l&&(h.lastTestResults=f.current),h.masteryScore=$(h),S(X=>new Map(X).set(h.id,h)),O(!1),H(),f.current=null;return}if(o==="random_test"){let s=c?"GAVE_UP":r===u.EASY?"PASS":"FAIL";w(h=>({...h,[t.id]:s}));const i=Z(p,r);l&&(i.lastTestResults=f.current),i.masteryScore=$(i),S(h=>new Map(h).set(i.id,i)),c?E(!0):H(),f.current=null}else{const s={...p};l&&(s.lastTestResults=f.current),s.masteryScore=$(s),S(i=>new Map(i).set(s.id,s)),f.current=null}},pe=()=>{A.current=null,L()},me=()=>{E(!0)};return e.jsx(Fe,{user:a,initialWords:d,sessionWords:P,sessionType:o,newWordIds:m,progress:_,setProgress:N,sessionOutcomes:G,sessionFinished:R,wordInModal:te,setWordInModal:x,editingWordInModal:J,setEditingWordInModal:Q,isTesting:K,setIsTesting:I,currentWord:t,isNewWord:j,onUpdate:b,onComplete:M,nextItem:H,handleReview:ie,handleTestComplete:xe,handleRetry:pe,handleEndSession:me,handleQuickReview:ce,handleManualPractice:de,isQuickReviewMode:Y})};export{Ge as default};
