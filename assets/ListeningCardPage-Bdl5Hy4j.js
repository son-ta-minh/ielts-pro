import{r as n,o as Ve,A as He,K as We,j as e,G as Ke,a9 as P,y as he,ab as xe,av as Je,as as qe,P as Xe,l as Ye,ac as Qe,J as Ze,bz as De,bA as et,bB as $,D as tt,bC as st,bD as R,X as ot,a1 as nt,bE as lt}from"./index-BeBINpHy.js";import{R as at,a as rt}from"./ResourceActions-B4FNr2vj.js";import{u as it,G as ct,S as me,V as dt}from"./ShelfSearchBar-BH8nwIhz.js";import{U as ut}from"./UniversalCard-CX67S68Z.js";import{T as ht}from"./TagBrowser-BPRRTge4.js";import{F as xt,U as mt,a as gt,M as pt,A as ft,R as bt}from"./ShelfModals-Q9auai6C.js";import{E as te}from"./ear-CiLhMFCh.js";import{M as wt}from"./move-BL81twAO.js";import{P as jt}from"./pen-ChzXJ-2y.js";import{L as vt}from"./library-Dpx4-dcr.js";import"./search-B1tb4K_3.js";import"./chevron-left-D1EVPfk0.js";import"./circle-CuWs-sVS.js";import"./palette-Dq3GLoKS.js";import"./square-check-big-qIvMHrqh.js";const ge="vocab_pro_listening_view",St=({text:h})=>{const u=h.split(/({.*?})/g);return e.jsx("span",{children:u.map((x,l)=>x.startsWith("{")&&x.endsWith("}")?e.jsx("span",{className:"bg-red-100 text-red-700 px-1 rounded-md font-bold mx-0.5 border border-red-200",children:x.slice(1,-1)},l):e.jsx("span",{children:x},l))})},kt=({isOpen:h,onClose:u,onSave:x,initialData:l})=>{const[p,F]=n.useState(""),[N,A]=n.useState(""),[f,d]=n.useState("/"),[w,L]=n.useState("");n.useEffect(()=>{var r;if(h)if(F((l==null?void 0:l.text)||""),A((l==null?void 0:l.note)||""),(l==null?void 0:l.path)===void 0){const c=(l==null?void 0:l.tags)||[],j=c.find(y=>y.startsWith("/")),O=c.filter(y=>!y.startsWith("/"));d(j||"/"),L(O.join(", "))}else d((l==null?void 0:l.path)||"/"),L(((r=l==null?void 0:l.tags)==null?void 0:r.join(", "))||"")},[h,l]);const G=r=>{if(r.preventDefault(),p.trim()){const c=w.split(",").map(j=>j.trim()).filter(Boolean);x(p.trim(),N.trim(),f.trim(),c)}},m=()=>{const r=document.getElementById("listening-text-input");if(!r)return;const c=r.selectionStart,j=r.selectionEnd,O=p.substring(c,j);if(O){const y=p.substring(0,c)+`{${O}}`+p.substring(j);F(y)}};return h?e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("form",{onSubmit:G,className:"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl border border-neutral-200 flex flex-col",children:[e.jsxs("header",{className:"px-8 py-6 border-b border-neutral-100 flex justify-between items-start shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-neutral-900",children:l?"Edit Phrase":"New Phrase"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Add text you find hard to hear."})]}),e.jsx("button",{type:"button",onClick:u,className:"p-2 -mr-2 text-neutral-400 hover:bg-neutral-100 rounded-full",children:e.jsx(ot,{size:20})})]}),e.jsxs("main",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-bold text-neutral-500",children:["Text content",e.jsx("span",{className:"font-normal text-[10px] ml-2 text-neutral-400",children:"(Select text & click Highlight)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"listening-text-input",value:p,onChange:r=>F(r.target.value),placeholder:"e.g. I {wanna} go to the store.",rows:4,className:"w-full p-4 bg-neutral-50 border border-neutral-200 rounded-xl font-medium resize-none focus:ring-2 focus:ring-neutral-900 outline-none text-sm leading-relaxed",required:!0,autoFocus:!0}),e.jsx("button",{type:"button",onClick:m,className:"absolute bottom-3 right-3 px-3 py-1.5 bg-red-100 text-red-600 rounded-lg text-[10px] font-black uppercase tracking-wider hover:bg-red-200 transition-colors",children:"Highlight Selection"})]}),e.jsxs("p",{className:"text-[10px] text-neutral-400 italic",children:["Tip: Use ",e.jsx("strong",{children:"{curly braces}"})," to mark the difficult parts."]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Note (Optional)"}),e.jsx("input",{value:N,onChange:r=>A(r.target.value),placeholder:"e.g. Fast speech, linking sounds...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-500",children:"Tags (Keywords)"}),e.jsx("input",{value:w,onChange:r=>L(r.target.value),placeholder:"linking, elision...",className:"w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl font-medium text-sm"})]})]}),e.jsx("footer",{className:"px-8 py-6 border-t border-neutral-100 flex justify-end shrink-0 bg-neutral-50/50 rounded-b-[2.5rem]",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-neutral-900 text-white rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(nt,{size:14})," Save Item"]})})]})}):null},Rt=({user:h})=>{var de;const[u,x]=n.useState([]),[l,p]=n.useState([]),[F,N]=n.useState(!0),[A,f]=n.useState("LIST"),[d,w]=n.useState(null),[L,G]=n.useState(!1),[m,r]=n.useState(()=>Ve(ge,{showNote:!0,compact:!1,showType:!0})),[c,j]=n.useState(null),[O,y]=n.useState(!1),[U,pe]=n.useState(!1),[C,fe]=n.useState("all"),[g,_]=n.useState("all"),[V,se]=n.useState(0),[T,be]=n.useState(12),{currentShelfName:H,booksOnCurrentShelf:W,allShelves:M,addShelf:we,renameShelf:je,removeShelf:ve,nextShelf:Se,prevShelf:ke,selectShelf:Ne}=it(l,"listening_books_shelves"),[ye,K]=n.useState(!1),[Ce,J]=n.useState(!1),[b,q]=n.useState(null);n.useEffect(()=>{He(ge,m)},[m]);const[Te,z]=n.useState(!1),[X,oe]=n.useState(null),[Y,Q]=n.useState(null),[I,Z]=n.useState(null),{showToast:v}=We(),S=async()=>{N(!0);const[t,s]=await Promise.all([De(h.id),et(h.id)]);x(t.sort((o,a)=>a.createdAt-o.createdAt)),p(s.sort((o,a)=>a.createdAt-o.createdAt)),N(!1)};n.useEffect(()=>{S()},[h.id]),n.useEffect(()=>{se(0)},[c,T,C,g]);const E=n.useMemo(()=>{let t=u;return C==="focused"&&(t=t.filter(s=>s.isFocused)),g!=="all"&&(t=t.filter(s=>s.focusColor===g)),c&&(c==="Uncategorized"?t=t.filter(s=>{const o=s.path??(s.tags||[]).find(i=>i.startsWith("/"));return!(o&&o!=="/"&&o!=="")}):t=t.filter(s=>{var o,a;return((o=s.path)==null?void 0:o.startsWith(c))||((a=s.tags)==null?void 0:a.includes(c))})),t},[u,c,C,g]),Ie=n.useMemo(()=>{const t=V*T;return E.slice(t,t+T)},[E,V,T]),Be=()=>{oe(null),z(!0)},ne=t=>{oe(t),z(!0)},Fe=async()=>{Y&&(await lt(Y.id),Q(null),v("Deleted item.","success"),S())},Ae=async(t,s,o,a)=>{try{const i=Date.now();if(X){const k={...X,text:t,note:s,path:o,tags:a,updatedAt:i};await R(k),v("Item updated!","success")}else{const k={id:`lst-${i}-${Math.random()}`,userId:h.id,text:t,note:s,path:o,tags:a,createdAt:i,updatedAt:i};await R(k),v("Item added!","success")}z(!1),S()}catch{v("Failed to save item.","error")}},D=t=>{const s=t.replace(/[{}]/g,"");tt(s)},Le=()=>{x(t=>[...t].sort(()=>Math.random()-.5)),v("Shuffled!","success")},le=async(t,s)=>{const o={...t,focusColor:s||void 0,updatedAt:Date.now()};s||delete o.focusColor,x(a=>a.map(i=>i.id===t.id?o:i)),await R(o)},ae=async t=>{const s={...t,isFocused:!t.isFocused,updatedAt:Date.now()};x(o=>o.map(a=>a.id===t.id?s:a)),await R(s)},Oe=t=>{je(t,async(o,a)=>{N(!0);const i=l.filter(k=>{const B=k.title.split(":");return(B.length>1?B[0].trim():"General")===o});await Promise.all(i.map(k=>{const B=k.title.split(":"),ue=B.length>1?B.slice(1).join(":").trim():B[0],_e=`${a}: ${ue}`;return $({...k,title:_e,updatedAt:Date.now()})})),await S()})&&J(!1)},re=async()=>{const t={id:`lb-${Date.now()}`,userId:h.id,title:`${H}: New Book`,itemIds:[],createdAt:Date.now(),updatedAt:Date.now(),color:"#ff9800",icon:"ðŸŽ§"};await $(t),await S(),w(t),f("BOOK_DETAIL"),v("New book created.","success")},ee=async t=>{if(!d)return;const s={...d,...t,updatedAt:Date.now()};p(o=>o.map(a=>a.id===s.id?s:a)),w(s),await $(s)},Me=async()=>{I&&(await st(I.id),v("Book deleted.","success"),Z(null),await S())},Ee=async t=>{if(!b)return;const s=b.title.split(":"),o=s.length>1?s.slice(1).join(":").trim():s[0],a=`${t}: ${o}`,i={...b,title:a,updatedAt:Date.now()};await $(i),q(null),await S(),v(`Moved to "${t}".`,"success")},Pe=n.useMemo(()=>d?d.itemIds.map(t=>{const s=u.find(o=>o.id===t);return s?{id:s.id,title:s.text,subtitle:s.note||"Listening Practice",data:s,focusColor:s.focusColor,isFocused:s.isFocused}:null}).filter(t=>t!==null):[],[d,u]),ze=n.useMemo(()=>u.map(t=>({id:t.id,title:t.text,subtitle:`${t.text.length} characters`,data:t})),[u]),$e=t=>{if(!d)return;const s=Array.from(new Set([...d.itemIds,...t]));ee({itemIds:s})},Re=t=>{if(!d)return;const s=d.itemIds.filter(o=>o!==t);ee({itemIds:s})},Ge=(t,s)=>{const o=t.data;le(o,s)},Ue=t=>{const s=t.data;ae(s)},ie=t=>{Ne(t),f("SHELF")},ce=t=>{w(t),f("BOOK_DETAIL")};return A==="BOOK_DETAIL"&&d?e.jsx(ct,{book:d,items:Pe,availableItems:ze,onBack:()=>{w(null),f("SHELF"),S()},onUpdateBook:ee,onAddItem:$e,onRemoveItem:Re,onOpenItem:t=>D(t.data.text),onEditItem:t=>ne(t.data),onFocusChange:Ge,onToggleFocus:Ue,itemIcon:e.jsx(te,{size:16})}):A==="SHELF"?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>f("LIST"),className:"w-fit flex items-center gap-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 transition-colors group",children:[e.jsx(Ke,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{children:"Back to Main Library"})]}),e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("h2",{className:"text-3xl font-black text-neutral-900 tracking-tight",children:"Listening Shelf"}),e.jsx("p",{className:"text-neutral-500 mt-1 font-medium",children:"Organize your listening practice."})]}),e.jsx(me,{shelves:M,books:l,onNavigateShelf:ie,onNavigateBook:ce}),e.jsxs("button",{onClick:()=>K(!0),className:"px-6 py-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl font-black text-xs flex items-center gap-2 uppercase tracking-widest hover:bg-neutral-50 transition-all shadow-sm",children:[e.jsx(xt,{size:14})," Add Shelf"]})]})]}),e.jsxs(mt,{label:H,onNext:M.length>1?Se:void 0,onPrev:M.length>1?ke:void 0,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(!0),className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white",title:"Rename Shelf",children:e.jsx(jt,{size:14})}),e.jsx("button",{onClick:ve,disabled:W.length>0,className:"p-2 bg-white/20 text-white/70 rounded-full hover:bg-white/40 hover:text-white disabled:opacity-30 disabled:hover:bg-white/20",title:"Remove Empty Shelf",children:e.jsx(P,{size:14})})]}),isEmpty:W.length===0,emptyAction:e.jsx("button",{onClick:re,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/20",children:"Create First Book"}),children:[W.map(t=>{const s=t.title,o=s.split(":"),a=o.length>1?o.slice(1).join(":").trim():s;return e.jsx(gt,{id:t.id,title:a,subTitle:`${t.itemIds.length} Items`,icon:e.jsx(te,{size:24}),color:t.color,titleColor:t.titleColor,titleSize:t.titleSize,titleTop:t.titleTop,titleLeft:t.titleLeft,iconTop:t.iconTop,iconLeft:t.iconLeft,onClick:()=>{w(t),f("BOOK_DETAIL")},actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),q(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-neutral-700 hover:text-white transition-all shadow-sm",title:"Move to Shelf",children:e.jsx(wt,{size:16})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),Z(t)},className:"p-1.5 bg-black/30 text-white/60 rounded-full hover:bg-red-600 hover:text-white transition-all shadow-sm",title:"Delete",children:e.jsx(P,{size:16})})]})},t.id)}),e.jsx("div",{className:"group [perspective:1000px] translate-y-0",children:e.jsx("div",{className:"relative w-full aspect-[5/7] rounded-lg bg-neutral-800/50 border-2 border-dashed border-neutral-500/50 transition-all duration-300 group-hover:border-neutral-400 group-hover:bg-neutral-800/80 group-hover:shadow-xl flex flex-col items-stretch justify-center overflow-hidden",children:e.jsxs("button",{onClick:re,className:"flex-1 flex flex-col items-center justify-center p-2 text-center text-neutral-400 hover:bg-white/5 transition-colors",children:[e.jsx(he,{size:32,className:"mb-2 text-neutral-500"}),e.jsx("h3",{className:"font-sans text-xs font-black uppercase tracking-wider",children:"New Book"})]})})})]}),e.jsx(xe,{isOpen:!!I,title:"Delete Book?",message:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',(de=I==null?void 0:I.title.split(":").pop())==null?void 0:de.trim(),'"']}),"? Items inside will not be deleted."]}),confirmText:"Delete",isProcessing:!1,onConfirm:Me,onClose:()=>Z(null),icon:e.jsx(P,{size:40,className:"text-red-500"})}),e.jsx(pt,{isOpen:!!b,onClose:()=>q(null),onConfirm:Ee,shelves:M,currentShelf:b?b.title.split(":")[0].trim():"General",bookTitle:(b==null?void 0:b.title)||""}),e.jsx(ft,{isOpen:ye,onClose:()=>K(!1),onSave:t=>{we(t)&&K(!1)}}),e.jsx(bt,{isOpen:Ce,onClose:()=>J(!1),onSave:Oe,initialName:H})]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{title:"Listening Library",subtitle:"Practice listening reflexes and capture difficult phrases.",icon:e.jsx("img",{src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Headphone.png",className:"w-8 h-8 object-contain",alt:"Listening"}),centerContent:e.jsx(me,{shelves:M,books:l,onNavigateShelf:ie,onNavigateBook:ce}),config:{},isLoading:F,isEmpty:E.length===0,emptyMessage:"No difficult phrases saved.",activeFilters:{},onFilterChange:()=>{},pagination:{page:V,totalPages:Math.ceil(E.length/T),onPageChange:se,pageSize:T,onPageSizeChange:be,totalItems:E.length},aboveGrid:e.jsx(e.Fragment,{children:U&&e.jsx(ht,{items:u,selectedTag:c,onSelectTag:j,forcedView:"tags",title:"Browse Tags",icon:e.jsx(Ze,{size:16})})}),actions:e.jsx(rt,{viewMenu:e.jsx(dt,{isOpen:L,setIsOpen:G,customSection:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[9px] font-black text-neutral-400 uppercase tracking-widest border-b border-neutral-50 flex items-center gap-2",children:[e.jsx(Qe,{size:10})," Focus & Status"]}),e.jsxs("div",{className:"p-1 flex flex-col gap-1 bg-neutral-100 rounded-xl mb-2",children:[e.jsx("button",{onClick:()=>fe(C==="all"?"focused":"all"),className:`w-full py-1.5 text-[9px] font-black rounded-lg transition-all ${C==="focused"?"bg-white shadow-sm text-red-600":"text-neutral-500 hover:text-neutral-700"}`,children:C==="focused"?"Focused Only":"All Items"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>_(g==="green"?"all":"green"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="green"?"bg-emerald-500 border-emerald-600":"bg-white border-neutral-200 hover:bg-emerald-50"}`}),e.jsx("button",{onClick:()=>_(g==="yellow"?"all":"yellow"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="yellow"?"bg-amber-400 border-amber-500":"bg-white border-neutral-200 hover:bg-amber-50"}`}),e.jsx("button",{onClick:()=>_(g==="red"?"all":"red"),className:`flex-1 h-6 rounded-lg border-2 transition-all ${g==="red"?"bg-rose-50 border-rose-600":"bg-white border-neutral-200 hover:bg-rose-50"}`})]})]})]}),viewOptions:[{label:"Show Notes",checked:m.showNote,onChange:()=>r(t=>({...t,showNote:!t.showNote}))},{label:"Show Card Type",checked:m.showType,onChange:()=>r(t=>({...t,showType:!t.showType}))},{label:"Compact Mode",checked:m.compact,onChange:()=>r(t=>({...t,compact:!t.compact}))}]}),browseTags:{isOpen:U,onToggle:()=>{pe(!U)}},addActions:[{label:"Add Phrase",icon:he,onClick:Be}],extraActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Le,disabled:u.length<2,className:"p-3 bg-white border border-neutral-200 text-neutral-600 rounded-xl hover:bg-neutral-50 active:scale-95 transition-all shadow-sm disabled:opacity-50",title:"Randomize",children:e.jsx(Ye,{size:16})}),e.jsxs("button",{onClick:()=>f("SHELF"),className:"px-5 py-3 bg-indigo-600 text-white rounded-xl font-black text-xs flex items-center gap-2 hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",title:"Bookshelf Mode",children:[e.jsx(vt,{size:16}),e.jsx("span",{children:"Bookshelf"})]})]})}),children:()=>e.jsx(e.Fragment,{children:Ie.map(t=>e.jsx(ut,{title:e.jsx(St,{text:t.text}),badge:m.showType?{label:"Listening",colorClass:"bg-red-50 text-red-600 border-red-100",icon:te}:void 0,tags:t.tags,compact:m.compact,onClick:()=>D(t.text),focusColor:t.focusColor,onFocusChange:s=>le(t,s),isFocused:t.isFocused,onToggleFocus:()=>ae(t),isCompleted:t.focusColor==="green",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),D(t.text)},className:"p-1.5 text-neutral-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Play",children:e.jsx(qe,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),ne(t)},className:"p-1.5 text-neutral-400 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",title:"Edit",children:e.jsx(Xe,{size:14})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),Q(t)},className:"p-1.5 text-neutral-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(P,{size:14})})]}),children:m.showNote&&t.note&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 font-medium bg-neutral-50 px-2 py-1 rounded-lg w-fit",children:[e.jsx(Je,{size:12})," ",t.note]})},t.id))})}),e.jsx(kt,{isOpen:Te,onClose:()=>z(!1),onSave:Ae,initialData:X}),e.jsx(xe,{isOpen:!!Y,title:"Delete Phrase?",message:"Are you sure you want to remove this phrase?",confirmText:"Delete",isProcessing:!1,onConfirm:Fe,onClose:()=>Q(null),icon:e.jsx(P,{size:40,className:"text-red-500"})})]})};export{Rt as ListeningCardPage,Rt as default};
